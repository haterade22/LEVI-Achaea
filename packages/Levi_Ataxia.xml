<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE MudletPackage>
<MudletPackage version="1.001">
	<ScriptPackage>
		<ScriptGroup isActive="yes" isFolder="yes">
			<name>For Levi</name>
			<packageName>For Levi</packageName>
			<script></script>
			<eventHandlerList />
			<ScriptGroup isActive="yes" isFolder="yes">
				<name>mudlet-mapper</name>
				<packageName>mudlet-mapper</packageName>
				<script></script>
				<eventHandlerList />
				<ScriptGroup isActive="yes" isFolder="yes">
					<name>Mudlet Mapper</name>
					<packageName></packageName>
					<script>mudlet = mudlet or {}; mudlet.mapper_script = true</script>
					<eventHandlerList />
					<Script isActive="yes" isFolder="no">
						<name>Create Option Table</name>
						<packageName></packageName>
						<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

function createOption(startingValue, onChangeFunc, allowedVarTypes, use, checkOption, games)
	if allowedVarTypes then -- make sure our starting Value follows type rules
		if not table.contains(allowedVarTypes, type(startingValue)) then
			echo("Starting type is not of allowed type!\n")
			display(allowedVarTypes)
			echo("type: " .. type(startingValue) .. "\n")
			return
		end
	end

	local option = {
		value = startingValue,
		onChange = onChangeFunc,
		allowedVarTypes = allowedVarTypes,
		use = use or "",
		games = games,
		checkOption = checkOption or function() return true end
	}

	return option
end

function createOptionsTable(defaultTable)
	local index = {} -- index to store the default table at in our proxy table


	local proxyTable = {} -- This is the table that is returned to the user

	proxyTable.disp = echo

	proxyTable.dispDefaultWriteError = function()
		echo("Can't overwrite default options. Please use the SetOption function to change the value\n")
	end

	proxyTable.dispOption = function(opt, val)
		if not opt or not val then return end
		echo("Name: " .. string.title(opt) .. string.rep(" ", 10 - string.len(opt)))
		echo("Val: " .. tostring(val.value))
		echo(string.rep(" ", 10 - string.len(tostring(val.value))) ..  "- " .. val.use .. "\n")
	end

	function proxyTable:showAllOptions(game)
		proxyTable.disp("Available options: \n")
		for k, v in spairs(self[index]) do
			if not game or not v.games or v.games[game] then
				self.dispOption(k, v)
			end
		end
		echo("\n")
		for k, v in spairs(self["_customOptions"]) do
			self.dispOption(k, v)
		end

	end

	function proxyTable:getAllOptions()
		local t = {}
		for k, v in pairs(self[index]) do
			t[k] = v.value
		end

		return t
	end

   function proxyTable:setOption(option, value, silent)
		if self[option] == nil then
			proxyTable.disp("No such option!\n")
			return
		end

		-- otherwise, set the option
		if self["_customOptions"][option] then
			if not (table.contains(self["_customOptions"][option].allowedVarTypes, type(value)) and self["_customOptions"][option].checkOption(value)) then
				proxyTable.disp("You can't set '" .. option .. "' to that!\n")
				return
			end
			self["_customOptions"][option].value = value
			if self["_customOptions"][option].onChange then
				self["_customOptions"][option].onChange(option, value)
			end
		else
			if not (table.contains(self[index][option].allowedVarTypes, type(value)) and self[index][option].checkOption(value)) then
				proxyTable.disp("You can't set '" .. option .. "' to that!\n")
				return
			end
			rawset(self[index][option], "value", value)
			local opt = rawget(self[index], option)
			if opt.onChange  and not silent then opt.onChange(option, value) end
		end
		if mmp and mmp.clearpathcache then mmp.clearpathcache() end
	end


	proxyTable._customOptions = {}

	local mt = {
		__index = function(t, k)
			local custOp = rawget(t, "_customOptions")
			if custOp[k] then
			 	local opt = custOp[k]
				if opt then return opt.value else return nil end
			else
				local opt = t[index][k]
				if opt then return opt.value else return nil end
			end
		end,

		__newindex = function (t, k, v)
			if t[index][k] then
				proxyTable.dispDefaultWriteError()
			else
				t["_customOptions"][k] = v
			end
		end
	}


	proxyTable[index] = defaultTable

	setmetatable(proxyTable, mt)

	return proxyTable

end</script>
						<eventHandlerList />
					</Script>
					<Script isActive="yes" isFolder="no">
						<name>Load settings</name>
						<packageName></packageName>
						<script>-- mmp = mudlet mapper namespace
mmp =
  mmp or
  {
    paused = false,
    autowalking = false,
    currentroom = 0,
    currentroomname = "(unknown)",
    firstRun = true,
    specials = {},
    ferry_rooms = {},
  }
speedWalkWatch = createStopWatch()
-- populated by Mudlet from getPath() and gotoRoom()
speedWalkPath = speedWalkPath or {}
speedWalkDir = speedWalkDir or {}
speedWalkCounter = 0
-- actually used by the mapper for walking
mmp.speedWalk = mmp.speedWalk or {}
mmp.speedWalkPath = mmp.speedWalkPath or {}
mmp.speedWalkDir = mmp.speedWalkDir or {}
mmp.lagtable = {
    [1] = {
        description = "Normal, default level.",
        time = 0.5
    },
    [2] = {
        description = "Decent, but slightly laggy.",
        time = 1
    },
    [3] = {
        description = "Noticeably laggy with occasional spikes.",
        time = 2
    },
    [4] = {
        description = "Bad. Terrible. Terribad.",
        time = 5
    },
    [5] = {
        description = "Carrier Pigeon",
        time = 10
    }
}
local newversion = "21.4.1"
if mmp.version and mmp.version ~= newversion then
  if not mmp.game then
    mmp.echo(
      "Mapper script updated - Thanks! I don't know what game are you connected to, though - so please reconnect, if you could."
    )
  else
    mmp.echo("Mapper script updated - thanks! You don't need to restart.")
  end
end
mmp.version = newversion

function mmp.startup()
  if not mmp.firstRun then
    return
  end
  local private_settings = {}
  --General settings
  private_settings["echocolour"] =
    createOption(
      "cyan",
      mmp.changeEchoColour,
      {"string"},
      "Set the color for room number echos?",
      function(newSetting)
        return color_table[newSetting] ~= nil
      end
    )
  private_settings["crowdmap"] =
    createOption(
      false,
      mmp.changeMapSource,
      {"boolean"},
      "Use a crowd-sourced map instead of IREs default?",
      nil,
      {achaea = true, starmourn = true, lusternia = true, stickmud = true}
    )
  private_settings["showcmds"] =
    createOption(true, mmp.changeBoolFunc, {"boolean"}, "Show walking commands?")
  private_settings["laglevel"] =
    createOption(1, mmp.changeLaglevel, {"number"}, "How laggy is your connection, (fast 1&lt;-&gt;5 slow)?", mmp.verifyLaglevel)
  private_settings["slowwalk"] =
    createOption(
      false, mmp.setSlowWalk, {"boolean"}, "Walk slowly instead of as quick as possible?"
    )
  private_settings["updatemap"] =
    createOption(true, mmp.changeUpdateMap, {"boolean"}, "Check for new maps from your MUD?")
  private_settings["waterwalk"] =
    createOption(
      true,
      mmp.setWaterWalk,
      {"boolean"},
      "Have waterwalk (don't avoid water)?",
      nil,
      {achaea = true}
    )
  --locking things
  private_settings["lockpathways"] =
    createOption(
      true, mmp.lockPathways, {"boolean"}, "Lock pathway exits?", nil, {lusternia = true}
    )
  private_settings["locksewers"] =
    createOption(false, mmp.lockSewers, {"boolean"}, "Lock all sewers?", nil, {achaea = true})
  private_settings["lockspecials"] =
    createOption(false, mmp.lockSpecials, {"boolean"}, "Lock all special exits?")
  private_settings["lockwormholes"] =
    createOption(
      true,
      mmp.lockWormholes,
      {"boolean"},
      "Lock all wormholes?",
      nil,
      {achaea = true, imperian = true, aetolia = true}
    )
  --Sprint movement
  private_settings["dash"] =
    createOption(
      false,
      mmp.changeBoolFunc,
      {"boolean"},
      "Use Dash?",
      nil,
      {achaea = true, imperian = true, aetolia = true}
    )
  private_settings["sprint"] = createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Sprint?")
  private_settings["gallop"] = createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Gallop?")
  private_settings["runaway"] =
    createOption(
      false, mmp.changeBoolFunc, {"boolean"}, "Use Jester Runaway?", nil, {achaea = true}
    )
  --Achaea wings and things
  private_settings["winglanguage"] =
    createOption(
      "",
      mmp.setWingsLanguage,
      {"string"},
      "Speak non-default language for wings:",
      nil,
      {achaea = true}
    )
  private_settings["pebble"] =
    createOption(
      false, mmp.lockPebble, {"boolean"}, "Make use of your enchanted pebble?", nil, {achaea = true}
    )
  private_settings["removewings"] =
    createOption(
      true,
      mmp.setWingsRemoval,
      {"boolean"},
      "Remove Wings after using them?",
      nil,
      {achaea = true, imperian = true}
    )
  private_settings["harness"] =
    createOption(
      false, mmp.setHarness, {"boolean"}, "Use Stratospheric Harness?", nil, {achaea = true}
    )
  --PapaGuacamole
  private_settings["duantahar"] =
    createOption(false, mmp.setDuantahar, {"boolean"}, "Use Chenubian Wings?", nil, {achaea = true})
  private_settings["duanatharan"] =
    createOption(false, mmp.setDuanatharan, {"boolean"}, "Use Atavian Wings?", nil, {achaea = true})
  private_settings["duanathar"] =
    createOption(false, mmp.setDuanathar, {"boolean"}, "Use Eagle Wings?", nil, {achaea = true})
  private_settings["duanatharic"] =
    createOption(false, mmp.setDuanatharic, {"boolean"}, "Use Island Wings?", nil, {achaea = true})
  private_settings["soar"] =
    createOption(false, mmp.setSoar, {"boolean"}, "Use Aero Soar?", nil, {achaea = true})
  private_settings["shackle"] =
    createOption(false, mmp.changeBoolFunc, {"boolean"}, "Take off shackle?", nil, {achaea = true})
  private_settings["universe"] =
    createOption(false, mmp.setUniverse, {"boolean"}, "Use Universe Tarot?", nil, {achaea = true})
  private_settings["gare"] =
    createOption(false, mmp.setGare, {"boolean"}, "Use Gare?", nil, {achaea = true})
  --Achaea Orb of Confinement
  private_settings["orbashtan"] =
    createOption(
      false,
      function()
        mmp.setOrb("ashtan")
      end,
      {"boolean"},
      "Orb of Confinement active in Ashtan?",
      nil,
      {achaea = true}
    )
  private_settings["orbcyrene"] =
    createOption(
      false,
      function()
        mmp.setOrb("cyrene")
      end,
      {"boolean"},
      "Orb of Confinement active in Cyrene?",
      nil,
      {achaea = true}
    )
  private_settings["orbeleusis"] =
    createOption(
      false,
      function()
        mmp.setOrb("eleusis")
      end,
      {"boolean"},
      "Orb of Confinement active in Eleusis?",
      nil,
      {achaea = true}
    )
  private_settings["orbhashan"] =
    createOption(
      false,
      function()
        mmp.setOrb("hashan")
      end,
      {"boolean"},
      "Orb of Confinement active in Hashan?",
      nil,
      {achaea = true}
    )
  private_settings["orbmhaldor"] =
    createOption(
      false,
      function()
        mmp.setOrb("mhaldor")
      end,
      {"boolean"},
      "Orb of Confinement active in Mhaldor?",
      nil,
      {achaea = true}
    )
  private_settings["orbtargossas"] =
    createOption(
      false,
      function()
        mmp.setOrb("targossas")
      end,
      {"boolean"},
      "Orb of Confinement active in Targossas?",
      nil,
      {achaea = true}
    )
  --Imperian wings
  private_settings["shekinah"] =
    createOption(false, mmp.setShekinah, {"boolean"}, "Use Seraphim Wings?", nil, {imperian = true})
  private_settings["suriel"] =
    createOption(false, mmp.setSuriel, {"boolean"}, "Use Orphanim Wings?", nil, {imperian = true})
  --Lusternia bixes
  private_settings["torus"] =
    createOption(
      false, mmp.setTorus, {"boolean"}, "Make use of your Torus?", nil, {lusternia = true}
    )
  private_settings["prism"] =
    createOption(
      false,
      mmp.setPrism,
      {"boolean"},
      "Make use of your transplanar prism?",
      nil,
      {lusternia = true}
    )
  private_settings["cubix"] =
    createOption(
      false, mmp.setCubix, {"boolean"}, "Make use of your Cubix?", nil, {lusternia = true}
    )
  private_settings["medallion"] =
    createOption(
      false, mmp.setMedallion, {"boolean"}, "Make use of your Medallion?", nil, {lusternia = true}
    )
  --Lusternia Bubblixes
  private_settings["tibia"] =
    createOption(
      false, mmp.setTibia, {"boolean"}, "Make use of your Tibia?", nil, {lusternia = true}
    )
  private_settings["mud"] =
    createOption(false, mmp.setMud, {"boolean"}, "Make use of your Mud?", nil, {lusternia = true})
  private_settings["cookie"] =
    createOption(
      false, mmp.setCookie, {"boolean"}, "Make use of your Cookie?", nil, {lusternia = true}
    )
  private_settings["icicle"] =
    createOption(
      false, mmp.setIcicle, {"boolean"}, "Make use of your Icicle?", nil, {lusternia = true}
    )
  private_settings["screwdriver"] =
    createOption(
      false,
      mmp.setScrewdriver,
      {"boolean"},
      "Make use of your Screwdriver?",
      nil,
      {lusternia = true}
    )
  private_settings["snowglobe"] =
    createOption(
      false, mmp.setSnowglobe, {"boolean"}, "Make use of your Snowglobe?", nil, {lusternia = true}
    )
  private_settings["head"] =
    createOption(
      false, mmp.setHead, {"boolean"}, "Make use of your Doll's Head?", nil, {lusternia = true}
    )
  private_settings["wheel"] =
    createOption(
      false, mmp.setWheel, {"boolean"}, "Make use of your Quartz Wheel?", nil, {lusternia = true}
    )
  --Lusternia Curio collections
  private_settings["bonecurio"] =
    createOption(
      false, mmp.setBonecurio, {"boolean"}, "Make use of your Bone curios?", nil, {lusternia = true}
    )
  private_settings["facecurio"] =
    createOption(
      false, mmp.setFacecurio, {"boolean"}, "Make use of your Face curios?", nil, {lusternia = true}
    )
  private_settings["feathercurio"] =
    createOption(
      false,
      mmp.setFeathercurio,
      {"boolean"},
      "Make use of your Feather curios?",
      nil,
      {lusternia = true}
    )
  private_settings["figurecurio"] =
    createOption(
      false,
      mmp.setFigurecurio,
      {"boolean"},
      "Make use of your Figure curios?",
      nil,
      {lusternia = true}
    )
  private_settings["flowercurio"] =
    createOption(
      false,
      mmp.setFlowercurio,
      {"boolean"},
      "Make use of your Flower curios?",
      nil,
      {lusternia = true}
    )
  private_settings["fluttercurio"] =
    createOption(
      false,
      mmp.setFluttercurio,
      {"boolean"},
      "Make use of your Flutter curios?",
      nil,
      {lusternia = true}
    )
  private_settings["toolcurio"] =
    createOption(
      false,
      mmp.setToolcurio,
      {"boolean"},
      "Make use of your Tool curios]?",
      nil,
      {lusternia = true}
    )
  private_settings["vernalcurio"] =
    createOption(
      false,
      mmp.setVernalcurio,
      {"boolean"},
      "Make use of your Vernal curios?",
      nil,
      {lusternia = true}
    )
  private_settings["utensilcurio"] =
    createOption(
      false,
      mmp.setUtensilcurio,
      {"boolean"},
      "Make use of your Utensil curios?",
      nil,
      {lusternia = true}
    )
  private_settings["toycurio"] =
    createOption(
      false, mmp.setToycurio, {"boolean"}, "Make use of your Toy curios?", nil, {lusternia = true}
    )
  private_settings["soullesscurio"] =
    createOption(
      false,
      mmp.setSoullesscurio,
      {"boolean"},
      "Make use of your Soulless curios?",
      nil,
      {lusternia = true}
    )
  --Lusternia epic
  private_settings["fingerblade"] =
    createOption(
      false,
      mmp.setFingerblade,
      {"boolean"},
      "Make use of your Fingerblade?",
      nil,
      {lusternia = true}
    )
  private_settings["blossom"] =
    createOption(
      false,
      mmp.setBlossom,
      {"boolean"},
      "Make use of your Flame of dae'Seren?",
      nil,
      {lusternia = true}
    )
  private_settings["belt"] =
    createOption(false, mmp.setBelt, {"boolean"}, "Make use of your Belt?", nil, {lusternia = true})
  private_settings["mandala"] =
    createOption(
      false, mmp.setMandala, {"boolean"}, "Make use of your Mandala?", nil, {lusternia = true}
    )
  private_settings["mantle"] =
    createOption(
      false, mmp.setMantle, {"boolean"}, "Make use of your Mantle?", nil, {lusternia = true}
    )
  private_settings["key"] =
    createOption(false, mmp.setKey, {"boolean"}, "Make use of your Key?", nil, {lusternia = true})
  --misc
  private_settings["caravan"] =
    createOption(false, mmp.changeBoolFunc, {"boolean"}, "Walk caravans?", nil, {imperian = true})
  mmp.settings = createOptionsTable(private_settings)
  mmp.settings.disp = mmp.echo
  mmp.game = false
  mmp.settings.dispOption =
    function(opt, val)
      cecho(
        "&lt;green&gt;" ..
        val.use ..
        "&lt;white&gt; (" ..
        opt ..
        ") " ..
        string.rep(" ", 50 - val.use:len() - opt:len()) ..
        tostring(val.value) ..
        "\n"
      )
    end
  mmp.settings.dispDefaultWriteError =
    function()
      mmp.echo("Please use the mconfig alias to set options!")
    end
  raiseEvent("mmp areas changed")
  mmp.firstRun = false
  mmp.echon("Mudlet Mapper script for IREs (" .. tostring(mmp.version) .. ") loaded! (")
  echoLink(
    "homepage",
    "(openUrl or openURL)'http://wiki.mudlet.org/w/IRE_mapping_script'",
    "Clicky clicky to read up on what's this about"
  )
  echo(")\n")
end</script>
						<eventHandlerList />
					</Script>
					<Script isActive="yes" isFolder="no">
						<name>speedwalking</name>
						<packageName></packageName>
						<script>function mmp.gotoRoom(where, dashtype, gotoType)
  mmp.speedWalk.type = gotoType or "room"
  if not where or not tonumber(where) then
    mmp.echo("Where do you want to go to?")
    return
  end
  if tonumber(where) == mmp.currentroom then
    mmp.echo("We're already at " .. where .. "!")
    raiseEvent("mmapper arrived")
    return
  end
  -- allow mapper 'addons' to link their own exits in
  raiseEvent("mmp link externals")
  -- if getPath worked, then the dirs and room #'s tables were populated for us
  if not mmp.getPath(mmp.currentroom, tonumber(where)) then
    mmp.echo("Don't know how to get there (" .. tostring(where) .. ") from here :(")
    mmp.speedWalkPath = {}
    mmp.speedWalkDir = {}
    speedWalkCounter = 0
    raiseEvent("mmapper failed path")
    if mmp.settings.shackle then
      expandAlias("wear shackle")
    end
    -- allow mapper 'addons' to unlink their special exits
    raiseEvent("mmp clear externals")
    return
  end
  doSpeedWalk(dashtype)
  -- allow mapper 'addons' to unlink their special exits
  raiseEvent("mmp clear externals")
end

function mmp.gotoArea(where, number, dashtype, exact)
  mmp.speedWalk.type = "area"
  if not where or type(where) ~= "string" then
    mmp.echo("Where do you want to go to?")
    return
  end
  local where = where:lower()
  number = tonumber(number)
  local tmp = getRoomUserData(1, "gotoMapping")
  if not tmp or tmp == '' then
    tmp = "[]"
  end
  local temp, maptable = yajl.to_value(tmp), {}
  for k, v in pairs(temp) do
    maptable[k:lower()] = v
  end
  local destinationRoom = maptable[where]
  if destinationRoom then
    mmp.gotoRoom(destinationRoom, dashtype)
    return
  end
  local areaid, msg, multiples = mmp.findAreaID(where, exact)
  if areaid then
    mmp.gotoAreaID(areaid)
  elseif not areaid and #multiples &gt; 0 then
    if number and number &lt;= #multiples then
      mmp.gotoArea(multiples[number], nil, dashtype, true)
      return
    end
    mmp.echo("Which area would you like to go to?")
    fg("DimGrey")
    for key, areaname in ipairs(multiples) do
      echo("  ")
      echoLink(
        key .. ") ",
        'mmp.gotoArea("' ..
        areaname ..
        '", nil, ' ..
        (dashtype and '"' .. dashtype .. '"' or "nil") ..
        ', true)',
        "Click to go to " .. areaname,
        true
      )
      setUnderline(true)
      echoLink(
        areaname,
        'mmp.gotoArea("' ..
        areaname ..
        '", nil, ' ..
        (dashtype and '"' .. dashtype .. '"' or "nil") ..
        ', true)',
        "Click to go to " .. areaname,
        true
      )
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
    return
  else
    mmp.echo(string.format("Don't know of any area named '%s'.", where))
    return
  end
end

--- DOES NOT ACCOUNT FOR CHANGING THE MAP YET (within a profile load), because we don't know when it happens
local getpathcache = {}
--setmetatable(getpathcache, {__mode = "kv"}) -- weak keys/values = it'll periodically get cleaned up by gc

function mmp.getPath(from, to)
  assert(tonumber(from) and tonumber(to), "mmp.getPath: both from and to have to be room IDs")
  local key = string.format("%s_%s", from, to)
  local resulttbl = getpathcache[key]
  -- not in cache?
  if not resulttbl then
    mmp.computeGetPath = mmp.computeGetPath or createStopWatch()
    startStopWatch(mmp.computeGetPath)
    local boolean = getPath(from, to)
    if mmp.debug then
      mmp.echo(
        "a new getPath() from " ..
        from ..
        " to " ..
        to ..
        " took " ..
        stopStopWatch(mmp.computeGetPath) ..
        "s."
      )
    end
    -- save it into the cache &amp; send away
    getpathcache[key] = {boolean, speedWalkDir, speedWalkPath}
    return boolean
  end
  -- or if it is, retrieve &amp; send away
  speedWalkDir = resulttbl[2]
  speedWalkPath = resulttbl[3]
  return resulttbl[1]
end

function mmp.clearpathcache()
  if mmp.debug then
    mmp.echo("path cache cleared")
  end
  getpathcache = {}
end

function mmp.showpathcache()
  return getpathcache
end

function mmp.setmovetimer(time)
  if mmp.movetimer then
    killTimer(mmp.movetimer)
  end
  if mmp.settings.slowwalk and not mmp.hasty then
    return
  end
  local laglevel = mmp.settings.laglevel or 1
  time = time or mmp.lagtable[laglevel].time
  mmp.movetimer =
    tempTimer(
      getNetworkLatency() + time,
      function()
        mmp.movetimer = false
        mmp.move()
      end
    )
end

-- moves to the next room we need to.

function mmp.move()
  if mmp.paused or not mmp.autowalking or mmp.movetimer or not mmp.canmove() then
    return
  end
  -- sometimes it's 0 - default to 1
  if speedWalkCounter == 0 then
    speedWalkCounter = 1
  end
  local cmd
  if mmp.settings["caravan"] then
    cmd = "lead caravan " .. mmp.speedWalkDir[speedWalkCounter]
  else
    cmd = mmp.speedWalkDir[speedWalkCounter]
  end
  cmd = cmd or ''
  -- timeout before loadstring, so it can set its own if it would like to.
  mmp.setmovetimer()
  if string.starts(cmd, "script:") then
    cmd = string.gsub(cmd, "script:", "")
    loadstring(cmd)()
    if mmp.settings.showcmds and not mmp.hasty then
      cecho(
        string.format(
          "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;%s&lt;red&gt;)",
          #mmp.speedWalkDir - speedWalkCounter + 1,
          "&lt;script&gt;"
        )
      )
    end
    mmp.hasty = false
  else
    send(cmd, false)
    if mmp.settings.showcmds and not mmp.hasty then
      cecho(
        string.format(
          "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;%s&lt;red&gt;)",
          #mmp.speedWalkDir - speedWalkCounter + 1,
          cmd
        )
      )
    end
    mmp.hasty = false
  end
end

function mmp.swim()
  -- not going anywhere? don't do anything
  if not mmp.speedWalkDir[speedWalkCounter] then
    return
  end
  send(
    "swim " ..
    mmp.speedWalkDir[speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
      "runaway ", ""
    ),
    false
  )
  if mmp.settings.showcmds then
    cecho(
      string.format(
        "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;swim %s&lt;red&gt;)",
        #mmp.speedWalkDir - speedWalkCounter + 1,
        mmp.speedWalkDir[speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
          "runaway ", ""
        )
      )
    )
  end
  mmp.hasty = true
  mmp.setmovetimer(2.5)
end

function mmp.enterGrate()
  -- not going anywhere? don't do anything
  if not mmp.speedWalkDir[speedWalkCounter] then
    return
  end
  send("enter grate " .. mmp.speedWalkDir[speedWalkCounter], false)
  if mmp.settings.showcmds then
    cecho(
      string.format(
        "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;enter grate %s&lt;red&gt;)",
        #mmp.speedWalkDir - speedWalkCounter + 1,
        mmp.speedWalkDir[speedWalkCounter]
      )
    )
  end
  mmp.hasty = true
  mmp.setmovetimer(2.5)
end

function mmp.openDoor()
  -- not going anywhere? don't do anything
  if not mmp.speedWalkDir[speedWalkCounter] then
    return
  end
  send(
    "open door " ..
    mmp.speedWalkDir[speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
      "runaway ", ""
    ),
    false
  )
  if mmp.settings.showcmds then
    cecho(
      string.format(
        "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;open door %s&lt;red&gt;)",
        #mmp.speedWalkDir - speedWalkCounter + 1,
        mmp.speedWalkDir[speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
          "runaway ", ""
        )
      )
    )
  end
  mmp.hasty = true
  mmp.setmovetimer(getNetworkLatency())
end

function mmp.unlockDoor()
  -- not going anywhere? don't do anything
  if not mmp.speedWalkDir[speedWalkCounter] then
    return
  end
  send(
    "unlock door " ..
    mmp.speedWalkDir[speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
      "runaway ", ""
    ),
    false
  )
  if mmp.settings.showcmds then
    cecho(
      string.format(
        "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;unlock door %s&lt;red&gt;)",
        #mmp.speedWalkDir - speedWalkCounter,
        mmp.speedWalkDir[speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
          "runaway ", ""
        )
      )
    )
  end
  mmp.hasty = true
  mmp.setmovetimer(getNetworkLatency())
end

function mmp.customwalkdelay(delay)
  mmp.setmovetimer(getNetworkLatency() + delay)
end

function mmp.stop()
  mmp.speedWalkPath = {}
  mmp.speedWalkDir = {}
  speedWalkCounter = 0
  stopStopWatch(speedWalkWatch)
  --if mmp.movetimer then killTimer( mmp.movetimer ) end
  mmp.autowalking = false
  -- clear all the temps we've got
  for trigger, ID in pairs(mmp.specials) do
    killTrigger(ID)
  end
  mmp.specials = {}
  mmp.echo("Stopped walking.")
  raiseEvent("mmapper stopped")
  if mmp.settings.shackle then
    expandAlias("wear shackle")
  end
end

-- Aetolia and Lusternia support showing balances in GMCP. This is easy to support, so we do!
-- if we can't move, setup a polling timer to prompt walking when we can again.
-- popular systems that expose balance &amp; equilibrium values can be added here as well, perhaps though a similarly-named function.

function mmp.canmove(fromtimer)
  if mapper_can_move and mapper_can_move() then
    if fromtimer then
      mmp.move()
    else
      return true
    end
  elseif mapper_can_move then
    tempTimer(0.2, [[mmp.canmove(true)]])
    return false
  end
  if not gmcp.Char then
    return true
  end
  -- Achaea
  -- Lusternia
  if
    (
      gmcp.Char and
      (not gmcp.Char.Vitals.bal or gmcp.Char.Vitals.bal == "1") and
      (not gmcp.Char.Vitals.eq or gmcp.Char.Vitals.eq == "1") and
      (not gmcp.Char.Vitals.balance or gmcp.Char.Vitals.balance == "1") and
      (not gmcp.Char.Vitals.equilibrium or gmcp.Char.Vitals.equilibrium == "1") and
      (not gmcp.Char.Vitals.right_arm or gmcp.Char.Vitals.right_arm == "1") and
      (not gmcp.Char.Vitals.left_arm or gmcp.Char.Vitals.left_arm == "1") and
      (not gmcp.Char.Vitals.right_leg or gmcp.Char.Vitals.right_leg == "1") and
      (not gmcp.Char.Vitals.left_leg or gmcp.Char.Vitals.left_leg == "1") and
      (not gmcp.Char.Vitals.psisuper or gmcp.Char.Vitals.psisuper ~= "0") and
      (not gmcp.Char.Vitals.psisub or gmcp.Char.Vitals.psisub ~= "0") and
      (not gmcp.Char.Vitals.psiid or gmcp.Char.Vitals.psiid ~= "0") and
      (not gmcp.Char.Balance or gmcp.Char.Balance.List.balance == "1") and
      (not gmcp.Char.Balance or gmcp.Char.Balance.List.equilibrium == "1") and
      (not gmcp.Char.Balance or gmcp.Char.Balance.List.rarm == "1") and
      (not gmcp.Char.Balance or gmcp.Char.Balance.List.larm == "1") and
      (not gmcp.Char.Balance or gmcp.Char.Balance.List.legs == "1") and
      (not gmcp.Char.Vitals.prone or (gmcp.Char.Vitals.prone == "0" or gmcp.Char.Vitals.prone == 0))
    )
  then
    if fromtimer then
      mmp.move()
    else
      return true
    end
  else
    tempTimer(0.2, [[mmp.canmove(true)]])
    return false
  end
end

local oldnum

function speedwalking(event, num)
  local num = tonumber(num) or tonumber(gmcp.Room.Info.num)
  if num ~= mmp.currentroom then
    mmp.previousroom = mmp.currentroom
  end
  mmp.currentroom = num
  mmp.currentroomname = getRoomName(num)
  -- Try to track if we're flying or not, for Imperian wings
  -- This is to avoid being "off path" if we FLY due to wings.
  local madeflight = false
  if gmcp.Room then
    local flying = false
    if string.find(gmcp.Room.Info.name, "^flying above") then
      flying = true
    end
    if mmp.flying and not flying then
      -- We were flying, and now we are not. Gravity!
      mmp.flying = false
    elseif not mmp.flying and flying then
      -- We were not flying and now we are.
      madeflight = true
      mmp.flying = true
    elseif not flying then
      mmp.flying = false
    end
  else
    mmp.flying = false
  end
  -- track if we're inside or outside, if possible
  if gmcp.Room then
    local areaID = getRoomArea(mmp.currentroom)
    if
      mmp.inside and
      not (
        table.contains(gmcp.Room.Info.details, "indoors") or
        table.contains(gmcp.Room.Info.details, "considered indoors")
      ) and
      not mmp.orbed()
    then
      mmp.inside = false
      raiseEvent("mmapper went outside")
    elseif
      not mmp.inside and
      (
        table.contains(gmcp.Room.Info.details, "indoors") or
        table.contains(gmcp.Room.Info.details, "considered indoors") or
        mmp.orbed()
      )
    then
      mmp.inside = true
      raiseEvent("mmapper went inside")
    end
    if
      #table.n_union(
        mmp.getareacontinents(getRoomArea(mmp.previousroom)),
        mmp.getareacontinents(getRoomArea(num))
      ) ~= #mmp.getareacontinents(getRoomArea(num))
    then
      raiseEvent("mmapper changed continent")
    end
    -- the event could cancel speedwalking - in this case quit
    if mmp.ignore_speedwalking then
      mmp.ignore_speedwalking = nil
      return
    end
  end
  if oldnum == num then
    return
  else
    oldnum = num
  end
  if not mmp.autowalking then
    return
  end
  if mmp.movetimer then
    killTimer(mmp.movetimer)
    mmp.movetimer = false
  end
  if num == mmp.speedWalkPath[#mmp.speedWalkPath] then
    local walktime = stopStopWatch(speedWalkWatch)
    mmp.echo(string.format("We've arrived! Took us %.1fs.\n", walktime))
    raiseEvent("mmapper arrived")
    if mmp.settings.shackle then
      expandAlias("wear shackle")
    end
    mmp.speedWalkPath = {}
    mmp.speedWalkDir = {}
    speedWalkCounter = 0
    mmp.autowalking = false
  elseif mmp.speedWalkPath[speedWalkCounter] == num then
    speedWalkCounter = speedWalkCounter + 1
    tempPromptTrigger(mmp.move, 1)
  elseif mmp.game == "imperian" and madeflight then
    mmp.echo("We began flying!")
    tempPromptTrigger(mmp.move, 1)
  elseif
    #mmp.speedWalkPath &gt; 0 and
    not mmp.ferry_rooms[num] and
    not (gmcp.Room.Info.details and table.contains(gmcp.Room.Info.details, "ferry"))
  then
    -- ended up somewhere we didn't want to be, and this isn't a ferry room?
    speedWalkMoved = false
    -- re-calculate path then
    mmp.echo("Ended up off the path, recalculating a new path...")
    local destination = mmp.speedWalkPath[#mmp.speedWalkPath]
    if not mmp.getPath(num, destination) then
      mmp.echo(
        string.format(
          "Don't know how to get to %d (%s) anymore :( Move into a room we know of to continue",
          destination,
          getRoomName(destination)
        )
      )
    else
      mmp.gotoRoom(destination)
    end
  end
end

function doSpeedWalk(dashtype)
  mmp.speedWalkDir = mmp.deepcopy(speedWalkDir)
  mmp.speedWalkPath = mmp.deepcopy(speedWalkPath)
  speedWalkDir, speedWalkPath = {}, {}
  resetStopWatch(speedWalkWatch)
  startStopWatch(speedWalkWatch)
  if
    mmp.settings["gallop"] or
    mmp.settings["dash"] or
    mmp.settings.sprint or
    mmp.settings.runaway or
    dashtype
  then
    mmp.fixPath(
      mmp.currentroom,
      mmp.speedWalkPath[#mmp.speedWalkPath],
      (mmp.settings["gallop"] and "gallop") or
      (mmp.settings["dash"] and "dash") or
      (mmp.settings.sprint and "sprint") or
      (mmp.settings.runaway and "runaway") or
      dashtype
    )
  end
  mmp.fixSpecialExits(mmp.speedWalkDir)
  if #mmp.speedWalkPath == 0 then
    mmp.autowalking = false
    mmp.echo("Couldn't find a path to the destination :(")
    raiseEvent("mmapper failed path")
    if mmp.settings.shackle then
      expandAlias("wear shackle")
    end
    return
  end
  -- this is a fix: convert nums to actual numbers
  for i = 1, #mmp.speedWalkPath do
    mmp.speedWalkPath[i] = tonumber(mmp.speedWalkPath[i])
  end
  mmp.autowalking = true
  raiseEvent("s")
  if mmp.settings.shackle then
    expandAlias("remove shackle")
  end
  if not mmp.paused then
    mmp.echon("Starting speedwalk from " .. (atcp.RoomNum or gmcp.Room.Info.num) .. " to ")
    cechoLink(
      "&lt;" .. mmp.settings.echocolour .. "&gt;" .. mmp.speedWalkPath[#mmp.speedWalkPath],
      'mmp.gotoRoom "' .. mmp.speedWalkPath[#mmp.speedWalkPath] .. '"',
      'Go to ' .. mmp.speedWalkPath[#mmp.speedWalkPath],
      true
    )
    echo(": ")
    speedWalkCounter = 1
    if mmp.canmove() then
      mmp.hasty = true
      mmp.setmovetimer(0.1)
    else
      echo("(when we get balance back / aren't hindered)")
    end
  else
    mmp.echo(
      "Will go to " ..
      mmp.speedWalkPath[#mmp.speedWalkPath] ..
      " as soon as the mapper is unpaused."
    )
  end
end

function mmp.failpath()
  if mmp.movetimer then
    local walktime = stopStopWatch(speedWalkWatch)
    mmp.echo(string.format("Can't continue further! Took us %.1fs to get here.\n", walktime))
  end
  mmp.autowalking = false
  if mmp.settings.shackle then
    expandAlias("wear shackle")
  end
  mmp.speedWalkPath = {}
  mmp.speedWalkDir = {}
  speedWalkCounter = 0
  if mmp.movetimer then
    killTimer(mmp.movetimer)
    mmp.movetimer = nil
  end
  raiseEvent("mmapper failed path")
end

function mmp.changeBoolFunc(name, option)
  local en
  en = option and "will now use" or "will no longer use"
  mmp.echo("&lt;green&gt;Okay, the mapper " .. en .. " &lt;white&gt;" .. name .. "&lt;green&gt;!")
end

function mmp.fixPath(rFrom, rTo, dashtype)
  local currentPath, currentIds = {}, {}
  local dRef = {["n"] = "north", ["e"] = "east", ["s"] = "south", ["w"] = "west"}
  if not getPath(rFrom, rTo) then
    return false
  end
  -- Logic: Look for a direction repeated at least two times.
  -- count the number of times it repeats, then look that many rooms ahead.
  -- if that room also contains the direction we're headed, just travel that many directions.
  -- otherwise, dash.
  local repCount = 1
  local index = 1
  local dashExaust = false
  while mmp.speedWalkDir[index] do
    if not table.contains(getSpecialExits(mmp.speedWalkPath[index]), mmp.speedWalkDir[index]) then
      dashExaust = false
      repCount = 1
      while mmp.speedWalkDir[index + repCount] == mmp.speedWalkDir[index] do
        repCount = repCount + 1
        if repCount == 11 then
          dashExaust = true
          break
        end
      end
      if repCount &gt; 1 then
        -- Found direction repetition. Calculate dash path.
        local exits = getRoomExits(mmp.speedWalkPath[index + (repCount - 1)])
        local pname = ""
        for word in mmp.speedWalkDir[index]:gmatch("%w") do
          pname = pname .. (dRef[word] or word)
        end
        if not exits[pname] or dashExaust then
          -- Final room in this direction does not continue, dash!
          table.insert(currentPath, string.format("%s %s", dashtype, mmp.speedWalkDir[index]))
          currentIds[#currentIds + 1] = mmp.speedWalkPath[index + repCount - 1]
        else
          -- Final room in this direction continues onwards, don't dash unless on achaea
          if mmp.game == "achaea" then
            table.insert(
              currentPath, string.format("%s %s %s", dashtype, mmp.speedWalkDir[index], repCount)
            )
            currentIds[#currentIds + 1] = mmp.speedWalkPath[index + repCount - 1]
          else
            for i = 1, repCount do
              table.insert(currentPath, mmp.speedWalkDir[index])
              currentIds[#currentIds + 1] = mmp.speedWalkPath[index + i - 1]
            end
          end
        end
        index = index + repCount
      else
        -- No repetition, just add the direction.
        table.insert(currentPath, mmp.speedWalkDir[index])
        currentIds[#currentIds + 1] = mmp.speedWalkPath[index]
        index = index + 1
      end
    else
      -- Special exit, skip over this step
      table.insert(currentPath, mmp.speedWalkDir[index])
      currentIds[#currentIds + 1] = mmp.speedWalkPath[index]
      index = index + 1
    end
  end
  mmp.speedWalkDir = currentPath
  mmp.speedWalkPath = currentIds
  return true
end

-- a certain version of the mapper gave us special exits prepended with 0 or 1 in the command
-- depending on if it was locked. Need to remove these before we can use them

function mmp.fixSpecialExits(directions)
  for i = 1, #directions do
    if directions[i]:match("^%d") then
      directions[i] = directions[i]:sub(2)
    end
  end
end

-- cleanup function to remove the temp special exit we made

function mmp.clearspecials(deleterooms)
  local t = getSpecialExits(mmp.currentroom)
  for connectingroom, exits in pairs(t) do
    if table.contains(deleterooms, connectingroom) then
      -- delete the special exits linking to this room
      for command, locked in pairs(exits) do
        removeSpecialExit(mmp.currentroom, command)
      end
    end
  end
end

function mmp.getShortestOfMultipleRooms(possibleRooms)
  local shortestWeight, closestRoom = 10000000, 0
  local checkedsofar, outoftime = 0, false
  local getStopWatchTime, tonumber = getStopWatchTime, tonumber
  
  -- allocate only 500ms to finding the shortest path, or more if we failed to find anything
  mmp.computeShortestWatch = mmp.computeShortestWatch or createStopWatch()
  startStopWatch(mmp.computeShortestWatch)
  raiseEvent("mmp link externals")
  
  -- mmp.echo(string.format("Have %s rooms nodes, %ss taken so far...", table.size(possibleRooms), getStopWatchTime(mmp.computeShortestWatch)))
  for _, id in pairs(possibleRooms) do
    local possible, thisWeight = getPath(mmp.currentroom, tonumber(id))
    if possible and thisWeight &lt; shortestWeight then
      shortestWeight = thisWeight
      closestRoom = tonumber(id)
    end
    checkedsofar = checkedsofar + 1
    if (getStopWatchTime(mmp.computeShortestWatch) &gt;= .5) then
      outoftime = true
      break
    end
	
    -- mmp.echo(string.format("pathed from %s to %s, running time so far: %s", mmp.currentroom, id, getStopWatchTime(mmp.computeShortestWatch)))
  end
  --mmp.echo(string.format("total time took: %s", getStopWatchTime(mmp.computeShortestWatch)))
  stopStopWatch(mmp.computeShortestWatch)
  return closestRoom, outoftime, checkedsofar
end

function mmp.gotoAreaID(areaid, number, dashtype)
  if not areaid or not tonumber(areaid) then
    mmp.echo("To where do you want to go?")
    return
  end
  areaid = tonumber(areaid)
  if not mmp.areatabler[areaid] then
    mmp.echo("Invalid area ID selected")
    return
  end
  local possibleRooms, shortestBorder = {}, 0
  for id,_ in pairs(mmp.getAreaBorders(areaid)) do
    possibleRooms[#possibleRooms+1] = id
  end
  shortestBorder, outoftime, checkedsofar = mmp.getShortestOfMultipleRooms(possibleRooms)
  if shortestBorder == 0 then
    if outoftime then
      mmp.echo(
        string.format(
          "I checked %d of the %d possible exits \"%s\" has, but none of the ways there worked and it was taking too long :( try doing this again?",
          checkedsofar,
          table.size(possibleRooms),
          getRoomAreaName(areaid)
        )
      )
    else
      mmp.echo(
        "Checked " ..
        table.size(possibleRooms) ..
        " exits in that area, and none of them worked :( I Don't know how to get you there."
      )
    end
    mmp.speedWalkPath = {}
    mmp.speedWalkDir = {}
    speedWalkCounter = 0
    raiseEvent("mmapper failed path")
    raiseEvent("mmp clear externals")
    return
  end
  raiseEvent("mmp clear externals")
  mmp.gotoRoom(shortestBorder, dashtype, "area")
end

function mmp.gotoFeature(partialFeatureName, dashtype)
  local mapFeatures = mmp.getMapFeatures()
  local feature
  if mapFeatures[partialFeatureName:lower()] then
    feature = partialFeatureName:lower()
  else
    for key in pairs(mapFeatures) do
      if key:find(partialFeatureName:lower()) then
        feature = key
        break
      end
    end
  end
  if not feature then
    mmp.echo("No feature like " .. partialFeatureName .. " found.")
    return
  end
  local possibleRooms = searchRoomUserData("feature-" .. feature, "true")
  closestFeature, outoftime, checkedsofar = mmp.getShortestOfMultipleRooms(possibleRooms)
  if closestFeature == 0 then
    if outoftime then
      mmp.echo(
        string.format(
          "I checked %d of the %d possible features \"%s\" has, but none of the ways there worked and it was taking too long :( try doing this again?",
          checkedsofar,
          table.size(possibleRooms),
          partialFeatureName
        )
      )
    else
      mmp.echo(
        "Checked " ..
        table.size(possibleRooms) ..
        " rooms with that feature, and none of them worked :( I Don't know how to get you there."
      )
    end
    mmp.speedWalkPath = {}
    mmp.speedWalkDir = {}
    speedWalkCounter = 0
    raiseEvent("mmapper failed path")
    raiseEvent("mmp clear externals")
    return
  end
  raiseEvent("mmp clear externals")
  mmp.gotoRoom(closestFeature, dashtype, "area")
end</script>
						<eventHandlerList>
							<string>RoomNum</string>
							<string>gmcp.Room.Info</string>
						</eventHandlerList>
					</Script>
					<ScriptGroup isActive="yes" isFolder="yes">
						<name>Wings and other fast travel</name>
						<packageName></packageName>
						<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
						<eventHandlerList />
						<Script isActive="yes" isFolder="no">
							<name>Wings functions</name>
							<packageName></packageName>
							<script>local exitsCreated = exitsCreated or {}

function mmp.tempSpecialExit(start, destination, command, weight)
  if type(destination) == "string" then
    -- no start room given, so shift all arguments one to the right
    start, destination, command, weight = mmp.currentroom, start, destination, command
  end
  table.insert(exitsCreated, {room = start, command = command})
  addSpecialExit(start, destination, command)
  if weight then
    setExitWeight(start, command, weight)
  end
end

function mmp.removeWings()
  --remove all special exits that were created by addWings, then resets the table.
  for _, exit in ipairs(exitsCreated) do
    removeSpecialExit(exit.room, exit.command)
  end
  exitsCreated = {}
end

registerAnonymousEventHandler("mmp clear externals", "mmp.removeWings")</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Achaea</name>
							<packageName></packageName>
							<script>registerAnonymousEventHandler("mmp link externals", "mmp.addWingsAchaea")

function mmp.orbed()
	-- orb of confinement - PapaGuacamole
  local areaID = getRoomArea(mmp.currentroom)
  return
		(mmp.game == "achaea" and
  		(
    		(mmp.settings.orbashtan and areaID == 49) or
    		(mmp.settings.orbcyrene and areaID == 57) or
    		(mmp.settings.orbeleusis and areaID == 51) or
    		(mmp.settings.orbhashan and areaID == 55) or
    		(mmp.settings.orbmhaldor and areaID == 44) or
    		(
    			mmp.settings.orbtargossas and
    			((mmp.settings.crowdmap and areaID == 368) or (not mmp.settings.crowdmap and areaID == 271))
    		)
  		)
		)
end

function mmp.addWingsAchaea()
  --Trimmed down version of the original function, meant to only be used for wings. (Where the command varies based on several MCONFIGS)

  local function getcmd(word)
    return
      mmp.settings.removewings and
      string.format(
        [[script:sendAll("wear wings", "say *%s %s", "remove wings", false)]],
        (mmp.settings.winglanguage and mmp.settings.winglanguage or ""),
        word
      ) or
      string.format(
        [[script:send("say *%s %s", false)]],
        (mmp.settings.winglanguage and mmp.settings.winglanguage or ""),
        word
      )
  end
  --creates a special exit from your current room to a destination, and adds it to a table so it can be easily cleared later.
  --Achaea stuff!
  if mmp.game ~= "achaea" then
    return
  end
  --WINGS!
  if
    (mmp.settings.duanathar or mmp.settings.duanatharan or mmp.settings.duantahar) and
    gmcp.Room and
    not table.contains(gmcp.Room.Info.details, "indoors") and
    not mmp.orbed()
  then
    --Sarapis wings.
    if mmp.oncontinent(getRoomArea(mmp.currentroom), "Main") then
      if mmp.settings.duanatharan then
        mmp.tempSpecialExit(4882, getcmd("duanatharan"))
        mmp.tempSpecialExit(3885, getcmd("duanathar"))
      elseif mmp.settings.duantahar then
        mmp.tempSpecialExit(42319, getcmd("duanathar"))
        mmp.tempSpecialExit(4882, getcmd("duanatharan"))
      else
        mmp.tempSpecialExit(3885, getcmd("duanathar"))
      end
      --Meropis Wings
    elseif mmp.oncontinent(getRoomArea(mmp.currentroom), "Meropis") then
      if mmp.settings.duanatharan then
        mmp.tempSpecialExit(51603, getcmd("duanatharan"))
        mmp.tempSpecialExit(51188, getcmd("duanathar"))
      elseif mmp.settings.duantahar then
        mmp.tempSpecialExit(42319, getcmd("duanathar"))
        mmp.tempSpecialExit(51603, getcmd("duanatharan"))
      else
        mmp.tempSpecialExit(51188, getcmd("duanathar"))
      end
    end
    if
      mmp.settings.duanatharic and
      gmcp.Room and
      not table.contains(gmcp.Room.Info.details, "indoors") and
      not mmp.orbed()
    then
      --Island wings.
      if
        mmp.oncontinent(getRoomArea(mmp.currentroom), "Main") or
        mmp.oncontinent(getRoomArea(mmp.currentroom), "Arcadia") or
        mmp.oncontinent(getRoomArea(mmp.currentroom), "Outer") or
        mmp.oncontinent(getRoomArea(mmp.currentroom), "Meropis") or
        mmp.oncontinent(getRoomArea(mmp.currentroom), "Island") or
        mmp.oncontinent(getRoomArea(mmp.currentroom), "North")
      then
        mmp.tempSpecialExit(47571, getcmd("duanatharic"))
      end
    end
  end
  -- Stratospheric Harness support -- PapaGuacamole
  if
    mmp.settings.harness and gmcp.Room and not table.contains(gmcp.Room.Info.details, "indoors")
  then
    -- eastern isles
    if mmp.oncontinent(getRoomArea(mmp.currentroom), "Eastern_Isles") then
      mmp.tempSpecialExit(54231, "Shake Harness")
      -- northern isles
    elseif mmp.oncontinent(getRoomArea(mmp.currentroom), "Northen_Isles") then
      mmp.tempSpecialExit(48719, "Shake Harness")
      -- western isles
    elseif mmp.oncontinent(getRoomArea(mmp.currentroom), "Western_Isles") then
      mmp.tempSpecialExit(54632, "Shake Harness")
    end
  end
  -- Air Elemental Aero Soar
  if
    mmp.settings.soar and
    gmcp.Room and
    not table.contains(gmcp.Room.Info.details, "indoors") and
    not mmp.orbed()
  then
    --Sarapis soar.
    if mmp.oncontinent(getRoomArea(mmp.currentroom), "Main") then
      if
        gmcp.Char.Status.class == "air Elemental Lord" or
        gmcp.Char.Status.class == "air Elemental Lady"
      then
        mmp.tempSpecialExit(4882, "aero soar high", 10)
        -- duanatharan
        mmp.tempSpecialExit(3885, "aero soar low", 10)
        -- duanathar
        mmp.tempSpecialExit(54173, "aero soar stratosphere", 10)
        -- Stratosphere!
      end
      --Meropis soar
    elseif mmp.oncontinent(getRoomArea(mmp.currentroom), "Meropis") then
      if
        gmcp.Char.Status.class == "air Elemental Lord" or
        gmcp.Char.Status.class == "air Elemental Lady"
      then
        mmp.tempSpecialExit(51603, "aero soar high", 10)
        -- duanatharan
        mmp.tempSpecialExit(51188, "aero soar low", 10)
        -- duanathar
        mmp.tempSpecialExit(54173, "aero soar stratosphere", 10)
        -- Stratosphere!
      end
    end
  end
  --universe tarot
  if mmp.settings.universe and mmp.oncontinent(getRoomArea(mmp.currentroom), "Main") then
    local tarotLocations =
      {
        azdun = 1772,
        blackrock = 10573,
        bitterfork = 25093,
        genji = 10091,
        manusha = 8730,
        newthera = 20386,
        caerwitrin = 17678,
        shastaan = 2855,
        mannaseh = 1745,
        manara = 9124,
        brasslantern = 30383,
        mhojave = 39103,
        thraasi = 35703,
        newhope = 25581,
      }
    for village, roomnum in pairs(tarotLocations) do
      mmp.tempSpecialExit(
        roomnum,
        [=[script:
        mmp.customwalkdelay(4.5)
        send("fling universe at ground",false)
        tempTimer(4,[[send("touch ]=] ..
        village ..
        [=[",false)]])
        ]=],
        10
      )
    end
  end
  --gare
  if mmp.settings.gare and gmcp.Char and string.match(gmcp.Char.Status.race, "Dragon") then
    if
      mmp.oncontinent(getRoomArea(mmp.currentroom), "Main") or
      mmp.oncontinent(getRoomArea(mmp.currentroom), "Meropis") or
      mmp.oncontinent(getRoomArea(mmp.currentroom), "Island") or
      mmp.oncontinent(getRoomArea(mmp.currentroom), "North") or
      mmp.oncontinent(getRoomArea(mmp.currentroom), "Arcadia")
    then
      mmp.tempSpecialExit(
        12695,
        [=[script:
        mmp.customwalkdelay(4.5)
        send("pierce the veil",false)
        ]=],
        20
      )
    end
  end
  --clears the path cache so it calculates a new route.
  mmp.clearpathcache()
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Lusternia</name>
							<packageName></packageName>
							<script>registerAnonymousEventHandler("mmp link externals", "mmp.addWingsLusternia")

local function linkBubblix(area, entranceRoom, command)
  -- always add this link to allow pathfinding to the bubble regardless of indoor/outdoor
  mmp.tempSpecialExit(148, entranceRoom, command)
  -- always add this link to allow pathfinding from the bubbe regardless of indoor/outdoor
  mmp.tempSpecialExit(entranceRoom, 6831, command)
  if mmp.usebubblix() then
    if not table.contains(gmcp.Room.Info.details, "an Aetherbubble") then
      -- we are not in an Aetherbubble and could use a bubblix, so allow its use from here
      mmp.tempSpecialExit(entranceRoom, command)
    elseif gmcp.Room.Info.area == area then
      -- we are in an Aetherbubble and it's the one the bubblix belongs to and we could use a bubblix, so allow its use from here
      mmp.tempSpecialExit(6831, command)
    end
  end
end

function mmp.addWingsLusternia()
  if mmp.game ~= "lusternia" then
    return
  end
  --that dorky prism
  if mmp.useprism() then
    if mmp.settings.prism then
      mmp.tempSpecialExit(6182, "touch prism")
    end
  end
  --items that use standard bix rules
  if mmp.usebix() then
    --cubix and things
    if mmp.settings.medallion then
      mmp.tempSpecialExit(13367, "touch medallion")
    end
    if mmp.settings.cubix then
      mmp.tempSpecialExit(6184, "touch cubix")
    end
    if mmp.settings.torus and mmp.usebix() then
      mmp.tempSpecialExit(28548, "touch torus")
    end
    --epic quest items
    if mmp.settings.fingerblade then
      mmp.tempSpecialExit(18777, "touch fingerblade")
    end
    if mmp.settings.blossom then
      mmp.tempSpecialExit(18730, "touch blossom")
    end
    if mmp.settings.mandala then
      mmp.tempSpecialExit(19563, "touch mandala")
    end
    if mmp.settings.belt then
      mmp.tempSpecialExit(19627, "touch enlightened")
    end
    if mmp.settings.mantle then
      mmp.tempSpecialExit(18762, "touch starlight")
    end
    if mmp.settings.key then
      mmp.tempSpecialExit(18732, "touch key")
    end
    --curio collections!
    if mmp.settings.bonecurio then
      mmp.tempSpecialExit(28613, "curio collection activate bone")
    end
    if mmp.settings.flowercurio then
      mmp.tempSpecialExit(28624, "curio collection activate flower")
    end
    if mmp.settings.utensilcurio then
      mmp.tempSpecialExit(28617, "curio collection activate utensil")
    end
    if mmp.settings.fluttercurio then
      mmp.tempSpecialExit(28622, "curio collection activate flutter")
    end
    if mmp.settings.toolcurio then
      mmp.tempSpecialExit(28586, "curio collection activate tool")
    end
    if mmp.settings.facecurio then
      mmp.tempSpecialExit(28433, "curio collection activate face")
    end
    if mmp.settings.toycurio then
      mmp.tempSpecialExit(21548, "curio collection activate toy")
    end
    if mmp.settings.feathercurio then
      mmp.tempSpecialExit(28591, "curio collection activate feather")
    end
    if mmp.settings.figurecurio then
      mmp.tempSpecialExit(28312, "curio collection activate figure")
    end
    if mmp.settings.vernalcurio then
      mmp.tempSpecialExit(29908, "curio collection activate vernal")
    end
    if mmp.settings.soullesscurio then
      mmp.tempSpecialExit(29909, "curio collection activate soulless")
    end
  end
  --all the bubblixes!
  if mmp.settings.screwdriver then
    linkBubblix("the Facility", 10185, "touch screwdriver")
  end
  if mmp.settings.wheel then
    linkBubblix("the Dramube Triangle", 10509, "touch wheel")
  end
  if mmp.settings.mud then
    linkBubblix("Mucklemarsh", 9985, "touch mud")
  end
  if mmp.settings.snowglobe then
    linkBubblix("the Great Spirit Tree", 10992, "shake snowglobe")
  end
  if mmp.settings.cookie then
    linkBubblix("Crumkindivia", 9888, "touch cookie")
  end
  if mmp.settings.head then
    linkBubblix("the Bubble of Bottledowns", 11811, "touch doll")
  end
  if mmp.settings.icicle then
    linkBubblix("Frosticia", 10457, "touch icicle")
  end
  if mmp.settings.tibia then
    linkBubblix("the Cankermore Battlegrounds", 11600, "touch tibia")
  end
  mmp.clearpathcache()
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Imperian</name>
							<packageName></packageName>
							<script>registerAnonymousEventHandler("mmp link externals", "mmp.addWingsImperian")
mmp.imperian = mmp.imperian or {}

function mmp.addWingsImperian()
  local function getcmd(word)
    return
      mmp.settings.removewings and
      [[script:if mmp.flying then sendAll("queue eqbal wear wings","queue eqbal say ]] ..
      word ..
      [[","queue eqbal remove wings",false) else sendAll("wear wings","fly",false) end]] or
      [[script:if mmp.flying then sendAll("queue eqbal say ]] ..
      word ..
      [[",false) else sendAll("fly",false) end]]
  end

  if
    (mmp.settings.shekinah or mmp.settings.suriel) and
    gmcp.Room and
    not table.contains(gmcp.Room.Info.details, "indoors") and
    not table.contains(gmcp.Room.Info.details, "considered indoors") and
    table.contains(mmp.imperian.wingAbleAreas, getRoomArea(mmp.currentroom))
  then
    if mmp.settings.shekinah then
      -- Seraphim wings - "Say shekinah"
      local weight = 15
      if mmp.flying then
        weight = 1
      end
      mmp.tempSpecialExit(4882, getcmd("shekinah"), weight)
    elseif mmp.settings.suriel then
      -- Using Orphanim wings, SURIEL works, takes you to 3885
      local weight = 15
      if mmp.flying == "1" then
        weight = 1
      end
      mmp.tempSpecialExit(3885, getcmd("suriel"), weight)
      -- clear cache so mmp.getPath accounts for the new way
    end
  end
  mmp.clearpathcache()
end

mmp.imperian.wingAbleAreas =
  {
    45,
    35,
    15,
    56,
    101,
    123,
    36,
    110,
    18,
    75,
    172,
    9,
    66,
    148,
    113,
    175,
    188,
    244,
    88,
    171,
    118,
    295,
    167,
    25,
    139,
    70,
    132,
    28,
    135,
    174,
    8,
    275,
    107,
    53,
    112,
    185,
    158,
    164,
    299,
    74,
    351,
    16,
    63,
    269,
    77,
    85,
    142,
    328,
    318,
    46,
    95,
    17,
    329,
    33,
    96,
    82,
    47,
    144,
    121,
    3,
    68,
    51,
    134,
    1,
    319,
    11,
    19,
    129,
    146,
    65,
    324,
    325,
    125,
    191,
    163,
    30,
    54,
    292,
    290,
    7,
    136,
    267,
    335,
    102,
    43,
    89,
    20,
    169,
    49,
    147,
    196,
    301,
    252,
    99,
    145,
    195,
    130,
    42,
    270,
    166,
    128,
    168,
    34,
    223,
    170,
    22,
    27,
    138,
    115,
    337,
    44,
    6,
    161,
    32,
    92,
    83,
    294,
    104,
    69,
    23,
    155,
    350,
    48,
    57,
    150,
    97,
    341,
    105,
    340,
    5,
    194,
    338,
    327,
    271,
    323,
    322,
    79,
    122,
    62,
    131,
    176,
    133,
    310,
    307,
    120,
    137,
    13,
    76,
    160,
    60,
    304,
    94,
    306,
    303,
    81,
    291,
    276,
    302,
    149,
    297,
    179,
    272,
    41,
    293,
    289,
    91,
    159,
    71,
    157,
    298,
    266,
    208,
    109,
    80,
    14,
    2,
    186,
    12,
    178,
    52,
    124,
    274,
    141,
    343,
    177,
    67,
    103,
    111,
    72,
    268,
    87,
    117,
    21,
    353,
    253,
    93,
    308,
    40,
    248,
    243,
    4,
    153,
    212,
    116,
    84,
    197,
    61,
    78,
    184,
    173,
    31,
    98,
    114,
    162,
    50,
    37,
    140,
    73,
    127,
    156,
    90,
    100,
    143,
    309,
    126,
  }</script>
							<eventHandlerList />
						</Script>
					</ScriptGroup>
					<Script isActive="yes" isFolder="no">
						<name>Utilities</name>
						<packageName></packageName>
						<script>-- functions internal to the mapper

function mmp.highlight_unfinished_rooms()
	if not mmp.areatable then return end
	for a,b in pairs (mmp.areatable) do
		local roomList = getAreaRooms(b) or {}
		for c,d in pairs (roomList) do
			if (getRoomName(d) == "") then
				local fgr,fgg,fgb = unpack(color_table.red)
				local bgr,bgg,bgb = unpack(color_table.blue)
				highlightRoom(d, fgr,fgg,fgb,bgr,bgg,bgb, 1, 100, 100)
			end
		end
	end
end

function mmp.usebix()
	if mmp.game ~= "lusternia" then return end

	if (table.contains(gmcp.Room.Info.details, "the Prime Material Plane") or
		table.contains(gmcp.Room.Info.details, "the Ethereal Plane") or
		table.contains(gmcp.Room.Info.details, "the Water Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Air Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Fire Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Earth Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "Celestia, Plane of Light") or
		table.contains(gmcp.Room.Info.details, "the Tainted Plane of Nil") or
		table.contains(gmcp.Room.Info.details, "the Cosmic Plane of Continuum") or
		table.contains(gmcp.Room.Info.details, "the Cosmic Plane of Vortex") or
		table.contains(gmcp.Room.Info.details, "the Astral Plane")) and
        gmcp.Room.Info.area ~= "the City of Climanti" and
		table.contains(gmcp.Room.Info.details, "outdoors") then
		return true
	end
	return false
end

function mmp.useprism()
	if mmp.game ~= "lusternia" then return end
	if (table.contains(gmcp.Room.Info.details, "the Prime Material Plane") or
	table.contains(gmcp.Room.Info.details, "the Ethereal Plane") or
	table.contains(gmcp.Room.Info.details, "the Water Elemental Plane") or
	table.contains(gmcp.Room.Info.details, "the Air Elemental Plane") or
	table.contains(gmcp.Room.Info.details, "the Fire Elemental Plane") or
	table.contains(gmcp.Room.Info.details, "the Earth Elemental Plane")) and
    gmcp.Room.Info.area ~= "the City of Climanti" and
	table.contains(gmcp.Room.Info.details, "outdoors") then
		return true
	end
	return false
end
function mmp.usebubblix()
	if mmp.game ~= "lusternia" then return end

	if ((table.contains(gmcp.Room.Info.details, "the Prime Material Plane") or
		table.contains(gmcp.Room.Info.details, "the Ethereal Plane") or
		table.contains(gmcp.Room.Info.details, "the Water Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Air Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Fire Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Earth Elemental Plane")) and
        gmcp.Room.Info.area ~= "the City of Climanti" and
		table.contains(gmcp.Room.Info.details, "outdoors")) or
		table.contains(gmcp.Room.Info.details, "an Aetherbubble") then
		return true
	end
	return false
end</script>
						<eventHandlerList />
						<Script isActive="yes" isFolder="no">
							<name>Locating &amp; echoing functions</name>
							<packageName></packageName>
							<script>function mmp.filterRooms(rooms, area)
  local unassignedRooms = {}
  local areaRooms = {}
  for roomnum, roomname in pairs(rooms) do
    local roomarea = getRoomUserData(roomnum, "Game Area")
    if roomarea == "" then
      unassignedRooms[roomnum] = roomname
    elseif roomarea == area then
      areaRooms[roomnum] = roomname
    end
  end
  return next(areaRooms) and areaRooms or unassignedRooms
end

-- for a given room name, we'll echo all the vnums

function mmp.echonums(roomname, area)
  local t = mmp.searchRoomExact(roomname)
  if area then
    t = mmp.filterRooms(t, area)
  end
  if not next(t) then
    echo("?")
    return nil
  end
  -- transform the kv table into a table of tables for cleaner code.
  -- + perhaps Mudlet in future will give this us anyway, sorted by relevancy
  local dt = {}
  for roomid, room in pairs(t) do
    dt[#dt + 1] = {name = room, id = roomid}
  end
  -- we can have nothing if we asked for exact match
  if not dt[1] then
    echo("?---")
    return
  end
  -- display first three ids. Can't really nicely table.concat them.
  cechoLink(
    "&lt;" .. mmp.settings.echocolour .. "&gt;" .. dt[1].id,
    'mmp.gotoRoom(' .. dt[1].id .. ')',
    string.format("Go to %s (%s)", dt[1].id, dt[1].name),
    true
  )
  if not dt[2] then
    return
  end
  echo(", ")
  cechoLink(
    "&lt;" .. mmp.settings.echocolour .. "&gt;" .. dt[2].id,
    'mmp.gotoRoom(' .. dt[2].id .. ')',
    string.format("Go to %s (%s)", dt[2].id, dt[2].name),
    true
  )
  if not dt[3] then
    return
  end
  echo(", ")
  cechoLink(
    "&lt;" .. mmp.settings.echocolour .. "&gt;" .. dt[3].id,
    'mmp.gotoRoom(' .. dt[3].id .. ')',
    string.format("Go to %s (%s)", dt[3].id, dt[3].name),
    true
  )
  if not dt[4] then
    return
  end
  echo(", ...")
end

function mmp.roomEcho(query)
  local result = mmp.searchRoom(query)
  if not tonumber(select(2, next(result))) then
    for roomid, roomname in pairs(result) do
      roomid = tonumber(roomid)
      cecho("&lt;DarkSlateGrey&gt; (")
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho("&lt;DarkSlateGrey&gt;)")
    end
  else
    for roomname, roomid in pairs(result) do
      roomid = tonumber(roomid)
      cecho("&lt;DarkSlateGrey&gt; (")
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho("&lt;DarkSlateGrey&gt;)")
    end
  end
end

function mmp.locateAndEcho(room, person, area)
  local t = mmp.searchRoomExact(room)
  if area then
    t = mmp.filterRooms(t, area)
  end
  echo("  (")
  mmp.echonums(room, area)
  echo(")")
  -- lowercase results
  for k, v in pairs(t) do
    if tonumber(k) then
      t[k] = v:lower()
    else
      t[k:lower()] = v
    end
  end
  if not (t[room:lower()] or table.contains(t, room:lower())) then
    return
  end
  echo("\n")
  if table.size(t) == 1 then
    local k, v = next(t)
    cecho(
      "&lt;red&gt;From your knowledge, that room is in &lt;orange_red&gt;" ..
      mmp.cleanAreaName(mmp.areatabler[getRoomArea(type(k) == "number" and k or v)] or "?") ..
      "&lt;red&gt;."
    )
  else
    local k, v = next(t)
    local areas = {}
    if type(k) == "number" then
      for k, _ in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    else
      for _, k in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    end
    local flattened_areas = {}
    for k, _ in pairs(areas) do
      if k ~= "" then
        flattened_areas[#flattened_areas + 1] = mmp.cleanAreaName(k)
      end
    end
    cecho(
      "&lt;red&gt;From your knowledge, that room might be in &lt;orange_red&gt;" ..
      table.concat(flattened_areas, ", or ") ..
      "&lt;red&gt;."
    )
  end
  if person then
    mmp.pdb[person] = room
    mmp.pdb_lastupdate[person] = true
    raiseEvent("mmapper updated pdb")
  end
end

function mmp.locateAndEchoSide(room, person)
  local t = mmp.searchRoomExact(room)
  echo("  (")
  mmp.echonums(room)
  echo(")")
  -- lowercase results
  for k, v in pairs(t) do
    if tonumber(k) then
      t[k] = v:lower()
    else
      t[k:lower()] = v
    end
  end
  if not (t[room:lower()] or table.contains(t, room:lower())) then
    return
  end
  --echo"\n"
  if table.size(t) == 1 then
    local k, v = next(t)
    cecho(
      "&lt;red&gt;  (" ..
      mmp.cleanAreaName(mmp.areatabler[getRoomArea(type(k) == "number" and k or v)] or "?") ..
      ")"
    )
  else
    local k, v = next(t)
    local areas = {}
    if type(k) == "number" then
      for k, _ in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    else
      for _, k in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    end
    local flattened_areas = {}
    for k, _ in pairs(areas) do
      if k ~= "" then
        flattened_areas[#flattened_areas + 1] = mmp.cleanAreaName(k)
      end
    end
    cecho("&lt;red&gt; (" .. table.concat(flattened_areas, ", ") .. ")")
  end
  if person then
    mmp.pdb[person] = room
    mmp.pdb_lastupdate[person] = true
    raiseEvent("mmapper updated pdb")
  end
end

function mmp.locateAndEchoInternal(room, person)
  local t = mmp.searchRoomExact(room)
  -- lowercase results
  for k, v in pairs(t) do
    if tonumber(k) then
      t[k] = v:lower()
    else
      t[k:lower()] = v
    end
  end
  if not (t[room:lower()] or table.contains(t, room:lower())) then
    return
  end
  --echo"\n"
  if table.size(t) == 1 then
    local k, v = next(t)
    cecho(
      "&lt;red&gt; in " ..
      mmp.cleanAreaName(mmp.areatabler[getRoomArea(type(k) == "number" and k or v)] or "?") ..
      "."
    )
  else
    local k, v = next(t)
    local areas = {}
    if type(k) == "number" then
      for k, _ in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    else
      for _, k in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    end
    local flattened_areas = {}
    for k, _ in pairs(areas) do
      if k ~= "" then
        flattened_areas[#flattened_areas + 1] = mmp.cleanAreaName(k)
      end
    end
    cecho("&lt;red&gt; in " .. table.concat(flattened_areas, ", ") .. ".")
  end
  echo("  (")
  mmp.echonums(room, true)
  echo(")")
  if person then
    mmp.pdb[person] = room
    mmp.pdb_lastupdate[person] = true
    raiseEvent("mmapper updated pdb")
  end
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Aliases</name>
							<packageName></packageName>
							<script>function mmp.roomWhoFind(query)
  if query:ends('.') then
    query = query:sub(1, -2)
  end
  local result = mmp.searchRoomExact(query)
  if type(result) == "string" or not next(result) then
    cecho("&lt;CadetBlue&gt;  You have no recollection of any room with that name.")
    return
  end
  if not tonumber(select(2, next(result))) then
    -- old style
    for roomid, roomname in pairs(result) do
      roomid = tonumber(roomid)
      cecho(string.format("  &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt; (", tostring(roomname)))
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho(
        string.format(
          "&lt;DarkSlateGrey&gt;) &lt;white&gt;%s&lt;DarkSlateGrey&gt;.\n",
          tostring(mmp.areatabler[getRoomArea(roomid)])
        )
      )
    end
  else
    -- new style
    for roomname, roomid in pairs(result) do
      roomid = tonumber(roomid)
      cecho(string.format("  &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt; (", tostring(roomname)))
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho(
        string.format(
          "&lt;DarkSlateGrey&gt;) &lt;white&gt;%s&lt;DarkSlateGrey&gt;.\n",
          tostring(mmp.areatabler[getRoomArea(roomid)])
        )
      )
    end
  end
end

function mmp.roomFind(query)
  if query:ends('.') then
    query = query:sub(1, -2)
  end
  local result = mmp.searchRoom(query)
  if type(result) == "string" or not next(result) then
    cecho("&lt;grey&gt;You have no recollection of any room with that name.")
    return
  end
  cecho("&lt;DarkSlateGrey&gt;You know the following relevant rooms:\n")

  local function showmeropis(roomid)
    if mmp.game ~= "achaea" then
      return ''
    end
    return mmp.oncontinent(getRoomArea(roomid), "Main") and '' or ' (Meropis)'
  end

  if not tonumber(select(2, next(result))) then
    -- old style
    for roomid, roomname in pairs(result) do
      roomid = tonumber(roomid)
      cecho(string.format("  &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt; (", tostring(roomname)))
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho(
        string.format(
          "&lt;DarkSlateGrey&gt;) in &lt;LightSlateGray&gt;%s%s&lt;DarkSlateGrey&gt;.",
          mmp.cleanAreaName(tostring(mmp.areatabler[getRoomArea(roomid)])),
          showmeropis(roomid)
        )
      )
      fg("DarkSlateGrey")
      echoLink(
        " &gt; Show path\n",
        [[mmp.echoPath(mmp.currentroom, ]] .. roomid .. [[)]],
        "Display directions from here to " .. roomname,
        true
      )
      resetFormat()
    end
  else
    -- new style
    for roomname, roomid in pairs(result) do
      roomid = tonumber(roomid)
      cecho(string.format("  &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt; (", tostring(roomname)))
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho(
        string.format(
          "&lt;DarkSlateGrey&gt;) in &lt;LightSlateGray&gt;%s%s&lt;DarkSlateGrey&gt;.",
          mmp.cleanAreaName(tostring(mmp.areatabler[getRoomArea(roomid)])),
          showmeropis(roomid)
        )
      )
      fg("DarkSlateGrey")
      echoLink(
        " &gt; Show path\n",
        [[mmp.echoPath(mmp.currentroom, ]] .. roomid .. [[)]],
        "Display directions from here to " .. roomname,
        true
      )
      resetFormat()
    end
  end
  cecho(string.format("  &lt;DarkSlateGrey&gt;%d rooms found.\n", table.size(result)))
end

function mmp.echoRoomList(areaname, exact)
  local areaid, msg, multiples = mmp.findAreaID(areaname, exact)
  if areaid then
    local roomlist, endresult = getAreaRooms(areaid) or {}, {}
    -- obtain a room list for each of the room IDs we got
    local getRoomName = getRoomName
    for _, id in pairs(roomlist) do
      endresult[id] = getRoomName(id)
    end
    -- sort room IDs so we can display them in order
    table.sort(roomlist)
    -- now display something half-decent looking
    cecho(
      string.format(
        "&lt;DarkSlateGrey&gt;List of all rooms in &lt;grey&gt;%s&lt;DarkSlateGrey&gt; (areaid &lt;grey&gt;%s&lt;DarkSlateGrey&gt; - &lt;grey&gt;%d&lt;DarkSlateGrey&gt; rooms):\n",
        msg,
        areaid,
        table.size(endresult)
      )
    )
    local echoLink, sformat, fg, echo = echoLink, string.format, fg, cecho
    -- use pairs, as we can have gaps between room IDs
    for _, roomid in pairs(roomlist) do
      local roomname = endresult[roomid]
      fg("blue")
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. sformat("%6s", roomid),
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho(string.format("&lt;DarkSlateGrey&gt;: &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt;.\n", roomname))
    end
  elseif not id and #multiples &gt; 0 then
    mmp.echo("For which area would you want to list rooms for?")
    fg("DimGrey")
    for _, areaname in ipairs(multiples) do
      echo("  ");
      setUnderline(true)
      echoLink(
        areaname,
        'mmp.echoRoomList("' .. areaname .. '", true)',
        "Click to view the room list for " .. areaname,
        true
      )
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
  else
    mmp.echo(string.format("Don't know of any area named '%s'.", areaname))
  end
end

function mmp.echoAreaList()
  local list = getAreaTable()
  local ids, rlist = {}, {}
  local totalroomcount = 0
  for area, id in pairs(list) do
    if id ~= 0 then
      ids[#ids + 1] = id;
      rlist[id] = area
    end
  end
  table.sort(ids)
  -- count the amount of rooms in an area, taking care to count the room in the 0th
  -- index as well if there is one
  -- saves the total room count on the side as well

  local function countrooms(areaid)
    local allrooms = getAreaRooms(areaid) or {}
    local areac = (#allrooms or 0) + (allrooms[0] and 1 or 0)
    totalroomcount = totalroomcount + areac
    return areac
  end

  cecho(string.format("&lt;DarkSlateGrey&gt;List of all areas we know of (click to view room list):\n"))
  local getAreaRooms, cecho, fg, echoLink, format, rep =
    getAreaRooms, cecho, fg, echoLink, string.format, string.rep
  for _, id in pairs(ids) do
    cecho(format("&lt;" .. mmp.settings.echocolour .. "&gt;%s%d ", rep(" ", (7 - #tostring(id))), id))
    -- +1 because getAreaRooms starts counting at 0
    fg("DarkSlateGrey")
    echoLink(
      rlist[id] .. (" "):rep(40 - #rlist[id]) .. "(" .. mmp.comma_value(countrooms(id)) .. " rooms)",
      'mmp.echoRoomList("' .. rlist[id] .. '", true)',
      "View the room list for " .. rlist[id],
      true
    )
    echo("\n")
  end
  cecho(
    string.format(
      "&lt;DarkSlateGrey&gt;Total amount of rooms in this map: %s\n", mmp.comma_value(totalroomcount)
    )
  )
end

function mmp.clearLabels(areaid)
  local function clearlabels(areaid)
    local t = getMapLabels(areaid)
    if type(t) ~= "table" then
      return
    end
    for labelid, _ in pairs(t) do
      deleteMapLabel(areaid, labelid)
    end
  end

  if areaid == "map" then
    for areaid in pairs(mmp.areatabler) do
      clearlabels(areaid)
    end
    mmp.echo("Cleared labels in all of the map.")
    return
  end
  clearlabels(areaid)
  mmp.echo(string.format("Cleared all labels in '%s'.", mmp.areatabler[areaid]))
end

function mmp.deleteArea(name, exact)
  local id, fname, ma = mmp.findAreaID(name, exact)
  if id then
    mmp.doareadelete(id)
  elseif next(ma) then
    mmp.echo("Which one of these specifically would you like to delete?")
    fg("DimGrey")
    for _, name in ipairs(ma) do
      echo("  ")
      setUnderline(true)
      echoLink(name, [[mmp.deleteArea("]] .. name .. [[", true)]], "Delete " .. name, true)
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
  else
    mmp.echo("Don't know of that area.")
  end
  raiseEvent("mmp areas changed")
end

-- the function actually doing area deletion

function mmp.doareadelete(areaid)
  mmp.deletingarea = {}
  local t = mmp.deletingarea
  local rooms = getAreaRooms(areaid)
  t.roomcount = table.size(rooms)
  t.roombatches = {}
  t.currentbatch = 1
  t.areaid = areaid
  t.areaname = getAreaTableSwap()[areaid]
  -- delete the area right away if there's nothing in it
  if t.roomcount == 0 then
    deleteArea(t.areaid)
    mmp.echo("All done! The area was already gone/empty.")
  end
  local rooms_per_batch = 100
  -- split up rooms into tables of tables, to be deleted in batches so
  -- that our print statements in between get a chance to be processed
  for batch = 1, t.roomcount, 100 do
    t.roombatches[#t.roombatches + 1] = {}
    local onebatch = t.roombatches[#t.roombatches]
    for inbatch = 1, 100 do
      onebatch[#onebatch + 1] = rooms[batch + inbatch]
    end
  end

  function mmp.deletenextbatch()
    local t = mmp.deletingarea
    if not t then
      return
    end
    local currentbatch = t.roombatches[t.currentbatchi]
    if currentbatch == nil then
      deleteArea(t.areaid)
      mmp.echo("All done! Deleted the '" .. t.areaname .. "' area.")
      mmp.deletingarea = nil
      centerview(mmp.currentroom)
      return
    end
    local deleteRoom = deleteRoom
    for i = 1, #currentbatch do
      deleteRoom(currentbatch[i])
    end
    mmp.echo(
      string.format(
        "Deleted %d batch%s so far, %d left to go - %.2f%% done out of %d needed",
        t.currentbatchi,
        (t.currentbatchi == 1 and '' or 'es'),
        #t.roombatches - t.currentbatchi,
        (100 / #t.roombatches) * t.currentbatchi,
        #t.roombatches
      )
    )
    t.currentbatchi = t.currentbatchi + 1
    tempTimer(0.010, mmp.deletenextbatch)
  end

  t.currentbatchi = 1
  mmp.echo("Prepped room batches, starting deletion...")
  tempTimer(0.010, mmp.deletenextbatch)
end

function mmp.renameArea(name, exact)
  if not (mmp.currentroom or getRoomArea(mmp.currentroom)) then
    mmp.echo("Don't know what area are we in at the moment, to rename it.")
  else
    setAreaName(getRoomArea(mmp.currentroom), name)
    mmp.echo(
      string.format(
        "Renamed %s to %s (%d).",
        mmp.areatabler[getRoomArea(mmp.currentroom)],
        name,
        getRoomArea(mmp.currentroom)
      )
    )
    centerview(mmp.currentroom)
  end
  raiseEvent("mmp areas changed")
end

function mmp.roomArea(otherroom, name, exact)
  local id, fname, ma
  if tonumber(name) then
    id = tonumber(name);
    fname = mmp.areatabler[id]
  else
    id, fname, ma = mmp.findAreaID(name, exact)
  end
  if otherroom ~= "" and not mmp.roomexists(otherroom) then
    mmp.echo("Room id " .. otherroom .. " doesn't seem to exist.")
    return
  elseif otherroom == "" and not mmp.roomexists(mmp.currentroom) then
    mmp.echo("Don't know where we are at the moment.")
    return
  end
  otherroom = otherroom ~= "" and otherroom or mmp.currentroom
  if id then
    setRoomArea(otherroom, id)
    mmp.echo(
      string.format(
        "Moved %s to %s (%d).",
        (getRoomName(otherroom) ~= "" and getRoomName(otherroom) or "''"),
        fname,
        id
      )
    )
    centerview(otherroom)
  elseif next(ma) then
    mmp.echo("Into which area exactly would you like to move the room?")
    fg("DimGrey")
    for _, name in ipairs(ma) do
      echo("  ")
      setUnderline(true)
      echoLink(
        name, [[mmp.roomArea('', "]] .. name .. [[", true)]], "Move the room to " .. name, true
      )
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
  else
    mmp.echo("Don't know of that area.")
  end
end

function mmp.getAreaBorders(areaid)
  if mmp.debug then
    mmp.getAreaBordersTimer = mmp.getAreaBordersTimer or createStopWatch()
    startStopWatch(mmp.getAreaBordersTimer)
  end
  -- make sure we have all exits into the area.
  raiseEvent("mmp link externals")
  local roomlist, endresult = getAreaRooms(areaid), {}
  -- sometimes getAreaRooms can give us no result :(
  if not roomlist then
    mmp.echo(
      "Sorry, seems we can't go there - getAreaRooms(" ..
      areaid ..
      ") didn't give us any results (Mudlet problem - redownloading the map might help fix it)"
    )
    return
  end
  if table.is_empty(roomlist) then
    mmp.echo(
      "Sorry, seems we can't go there - " .. getRoomAreaName(areaid) .. " has no rooms in it."
    )
    return
  end
  -- make a key-value list of room IDs
  local reverselist = {}
  for i = 0, #roomlist do
    reverselist[roomlist[i]] = true
  end
  local getRoomName, contains, pairs = getRoomName, table.contains, pairs
  if getAllRoomEntrances then
    for i = 0, #roomlist do
      local id = roomlist[i]
      local entrancesFrom = getAllRoomEntrances(id)
      for remoteRoomIndex = 1, #entrancesFrom do
        if not reverselist[entrancesFrom[remoteRoomIndex]] then
          endresult[id] = getRoomName(id)
        end
      end
    end
  else
    local getRoomExits, getSpecialExitsSwap = getRoomExits, getSpecialExitsSwap
    -- obtain a room list for each of the room IDs we got
    --for _, id in pairs(roomlist) do
    for i = 0, #roomlist do
      local id = roomlist[i]
      local exits = getRoomExits(id)
      for _, to in pairs(exits) do
        if not reverselist[to] then
          endresult[id] = getRoomName(id)
        end
      end
      local specialexits = getSpecialExitsSwap(id)
      for _, to in pairs(specialexits) do
        if not reverselist[to] then
          endresult[id] = getRoomName(id)
        end
      end
    end
  end
  if mmp.debug then
    mmp.echo(
      "mmp.getAreaBordersTimer() on areaid " ..
      areaid ..
      " took " ..
      stopStopWatch(mmp.getAreaBordersTimer) ..
      "s to run. Returned " ..
      table.size(endresult) ..
      " results."
    )
  end
  -- clean up external exits
  raiseEvent("mmp clear externals")
  return endresult
end

function mmp.viewArea(where, exact)
  if not where or not type(where) == "string" then
    mmp.echo("Which area would you like to view?")
    return
  end
  local areaid, msg, multiples = mmp.findAreaID(where, exact)
  if areaid then
    -- center on the first room ID, which typically is the start of an area
    local rooms = getAreaRooms(areaid) or {}
    if not rooms[1] then
      mmp.echo("The area has no rooms in it.")
    else
      centerview(rooms[1])
    end
  elseif not areaid and #multiples &gt; 0 then
    mmp.echo("Which area would you like to view exactly?")
    fg("DimGrey")
    for _, areaname in ipairs(multiples) do
      echo("  ");
      setUnderline(true)
      echoLink(
        areaname, 'mmp.viewArea("' .. areaname .. '", true)', "Click to view " .. areaname, true
      )
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
    return
  else
    mmp.echo(string.format("Don't know of any area named '%s'.", where))
    return
  end
end

-- room label the room I'm in
-- room label 342 this is a label in room 342
-- room label green this is a green label where I'm at
-- room label green black this is a green to black label where I'm at
-- room label 34 green black this is a green to black label at room 34
-- how it works: split input string into tokens by space, then determine
-- what to do by checking first few tokens, and finally call the local
-- function with the proper arguments

function mmp.roomLabel(input)
  if not createMapLabel then
    mmp.echo(
      "Your Mudlet doesn't support createMapLabel() yet - please update to 2.0-test3 or better."
    )
    return
  end
  local tk = input:split(" ")
  local room, fg, bg, message = mmp.currentroom, "yellow", "red", "Some room label"
  -- input always have to be something, so tk[1] at least always exists
  if tonumber(tk[1]) then
    room = tonumber(table.remove(tk, 1))
    -- remove the number, so we're left with the colors or msg
  end
  -- next: is this a foreground color?
  if tk[1] and color_table[tk[1]] then
    fg = table.remove(tk, 1)
  end
  -- next: is this a background color?
  if tk[1] and color_table[tk[1]] then
    bg = table.remove(tk, 1)
  end
  -- the rest would be our message
  if tk[1] then
    message = table.concat(tk, " ")
  end
  -- if we haven't provided a room ID and we don't know where we are yet, we can't make a label
  if not room then
    mmp.echo("We don't know where we are to make a label here.")
    return
  end
  local x, y = getRoomCoordinates(room)
  local f1, f2, f3 = unpack(color_table[fg])
  local b1, b2, b3 = unpack(color_table[bg])
  -- finally: do it :)
  local lid = createMapLabel(getRoomArea(room), message, x, y, f1, f2, f3, b1, b2, b3)
  mmp.echo(
    string.format(
      "Created new label #%d '%s' in %s.", lid, message, getRoomAreaName(getRoomArea(room))
    )
  )
end

function mmp.areaLabels(where, exact)
  if not getMapLabels then
    mmp.echo(
      "Your Mudlet doesn't support getMapLabels() yet - please update to 2.0-test3 or better."
    )
    return
  end
  if (not where or not type(where) == "string") and not mmp.currentroom then
    mmp.echo("For which area would you like to view labels?")
    return
  end
  if not where then
    exact = true
    where = getRoomAreaName(getRoomArea(mmp.currentroom))
  end
  local areaid, msg, multiples = mmp.findAreaID(where, exact)
  if areaid then
    local t = getMapLabels(areaid)
    if type(t) ~= "table" or not next(t) then
      mmp.echo(string.format("'%s' doesn't seem to have any labels.", getRoomAreaName(areaid)))
      return
    end
    mmp.echo(string.format("Area labels for '%s'", getRoomAreaName(areaid)))
    for labelid, labeltext in pairs(t) do
      fg("DimGrey")
      echo(string.format("  %d) %s (", labelid, labeltext))
      fg("orange_red")
      setUnderline(true)
      echoLink(
        'delete',
        string.format(
          'deleteMapLabel(%d, %d); mmp.echo("Deleted label #' .. labelid .. '")', areaid, labelid
        ),
        "Delete label #" .. labelid .. " from " .. getRoomAreaName(areaid)
      )
      setUnderline(false)
      echo(")\n")
    end
    resetFormat()
  elseif not areaid and #multiples &gt; 0 then
    mmp.echo("Which area would you like to view exactly?")
    fg("DimGrey")
    for _, areaname in ipairs(multiples) do
      echo("  ");
      setUnderline(true)
      echoLink(
        areaname,
        'mmp.areaLabels("' .. areaname .. '", true)',
        "Click to view labels in " .. areaname,
        true
      )
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
    return
  else
    mmp.echo(string.format("Don't know of any area named '%s'.", where))
    return
  end
end

function mmp.echoPath(from, to)
  assert(tonumber(from) and tonumber(to), "mmp.getPath: both from and to have to be room IDs")
  if mmp.getPath(from, to) then
    mmp.echo(
      "&lt;white&gt;Directions from &lt;yellow&gt;" ..
      string.upper(searchRoom(from)) ..
      " &lt;white&gt;to &lt;yellow&gt;" ..
      string.upper(searchRoom(to)) ..
      "&lt;white&gt;:"
    )
    mmp.echo(table.concat(speedWalkDir, ", "))
    return mmp.speedWalkDir
  else
    mmp.echo(
      "&lt;white&gt;I can't find a way from &lt;yellow&gt;" ..
      string.upper(searchRoom(from)) ..
      " &lt;white&gt;to &lt;yellow&gt;" ..
      string.upper(searchRoom(to)) ..
      "&lt;white&gt;"
    )
  end
end

function mmp.listSpecialExits(filter)
  local c = 0
  mmp.echo("Listing special exits...")
  for area, areaname in pairs(mmp.areatabler) do
    local rooms = getAreaRooms(area) or {}
    for i = 0, #rooms do
      local exits = getSpecialExits(rooms[i] or 0)
      if exits and next(exits) then
        for exit, cmd in pairs(exits) do
          if type(cmd) == "table" then
            cmd = next(cmd)
          end
          if cmd:match("^%d") then
            cmd = cmd:sub(2)
          end
          if not filter or cmd:lower():find(filter, 1, true) then
            if getRoomArea(exit) ~= area then
              cecho(
                string.format(
                  "&lt;dark_slate_grey&gt;%s &lt;LightSlateGray&gt;(%d, in %s)&lt;dark_slate_grey&gt; &lt;MediumSlateBlue&gt;-&gt; &lt;coral&gt;%s -&lt;MediumSlateBlue&gt;&gt;&lt;dark_slate_grey&gt; %s &lt;LightSlateGray&gt;(%d, in %s)\n",
                  getRoomName(rooms[i]),
                  rooms[i],
                  areaname,
                  cmd,
                  getRoomName(exit),
                  exit,
                  mmp.areatabler[getRoomArea(exit)] or '?'
                )
              )
            else
              cecho(
                string.format(
                  "&lt;dark_slate_grey&gt;%s &lt;LightSlateGray&gt;(%d)&lt;dark_slate_grey&gt; &lt;MediumSlateBlue&gt;-&gt; &lt;coral&gt;%s &lt;MediumSlateBlue&gt;-&gt;&lt;dark_slate_grey&gt; %s &lt;LightSlateGray&gt;(%d)&lt;dark_slate_grey&gt; in %s\n",
                  getRoomName(rooms[i]),
                  rooms[i],
                  cmd,
                  getRoomName(exit),
                  exit,
                  areaname
                )
              )
            end
            c = c + 1
          end
        end
      end
    end
  end
  mmp.echo(
    string.format(
      "%d exits listed%s.", c, (not filter and '' or ", with for the filter '" .. filter .. "'")
    )
  )
end

function mmp.delSpecialExits(filter)
  local c = 0
  for area, areaname in pairs(mmp.areatabler) do
    local rooms = getAreaRooms(area) or {}
    for i = 0, #rooms do
      local exits = getSpecialExits(rooms[i] or 0)
      if exits and next(exits) then
        for exit, cmd in pairs(exits) do
          if type(cmd) == "table" then
            cmd = next(cmd)
          end
          if cmd:match("^%d") then
            cmd = cmd:sub(2)
          end
          if not filter or cmd:lower():find(filter, 1, true) then
            local rid, action
            local originalExits = {}
            local e = getSpecialExits(rooms[i])
            for t, n in pairs(e) do
              rid = tonumber(t)
              for a, l in pairs(n) do
                action = tostring(a)
              end
              if not action:find(filter, 1, true) then
                originalExits[rid] = action
              end
            end
            clearSpecialExits(rooms[i])
            for rid, act in pairs(originalExits) do
              addSpecialExit(rooms[i], tonumber(rid), tostring(act))
            end
            c = c + 1
          end
        end
      end
    end
  end
  mmp.echo(
    string.format(
      "%d exits deleted%s.", c, (not filter and '' or ", with for the filter '" .. filter .. "'")
    )
  )
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Directions-translating functions</name>
							<packageName></packageName>
							<script>-- translates n to north and so forth
local temp = {
    n = "north",
    e = "east",
    s = "south",
    w = "west",
    ne = "northeast",
    se = "southeast",
    sw = "southwest",
    nw = "northwest",
    u = "up",
    d = "down",
    i = "in",
    o = "out",
    ["in"] = "in"
}
local anytolongmap = {}
for s, l in pairs(temp) do anytolongmap[l] = l; anytolongmap[s] = l end
function mmp.anytolong(exit)

  return anytolongmap[exit]
end

function mmp.anytoshort(exit)
  local t = {
    n = "north",
    e = "east",
    s = "south",
    w = "west",
    ne = "northeast",
    se = "southeast",
    sw = "southwest",
    nw = "northwest",
    u = "up",
    d = "down",
    ["in"] = "in",
    out = "out"
  }
  local rt = {}
  for s,l in pairs(t) do
    rt[l] = s; rt[s] = s
  end

  return rt[exit]
end


function mmp.ranytolong(exit)
  local t = {
    n = "south",
    north = "south",
    e = "west",
    east = "west",
    s = "north",
    south = "north",
    w = "east",
    west = "east",
    ne = "southwest",
    northeast = "southwest",
    se = "northwest",
    southeast = "northwest",
    sw = "northeast",
    southwest = "northeast",
    nw = "southeast",
    northwest = "southeast",
    u = "down",
    up = "down",
    d = "up",
    down = "up",
    i = "out",
    ["in"] = "out",
    o = "in",
    out = "in"
  }

  return t[exit]
end

-- returns nil or the room number relative to this one
function mmp.relativeroom(from, dir)
  if not mmp.roomexists(from) then return end

  local exits = getRoomExits(tonumber(from))
  return exits[mmp.anytolong(dir)]
end
</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>mconfig settings functions</name>
							<packageName></packageName>
							<script>function mmp.doLock(what, lock, filter)
  if what then mmp.echo(string.format("%s all %s...", (lock and "Locking" or "Unlocking"), what)) end
  local c = 0

  local getAreaRooms, getSpecialExits, lockSpecialExit, next = getAreaRooms, getSpecialExits, lockSpecialExit, next
  for _, area in pairs(getAreaTable()) do
    local rooms = getAreaRooms(area) or {}
    for i = 0, #rooms do
      local exits = getSpecialExits(rooms[i] or 0)

       if exits and next(exits) then
         for exit, cmd in pairs(exits) do
           if type(cmd) == "table" then cmd = next(cmd) end

           if (not filter and not (cmd:lower():find("pathfind", 1, true) or cmd:lower():find("worm warp", 1, true) or cmd:lower():find("enter grate", 1, true))) or (filter and cmd:lower():find(filter, 1, true)) then
             lockSpecialExit(rooms[i], exit, cmd, lock)
             c = c + 1
           end
         end
       end
    end
  end

  if what then mmp.echo(string.format("%s %s known %s.", (lock and "Locked" or "Unlocked"), c, what)) end
  return c
end

function mmp.changeEchoColour()
    mmp.echo("Now displaying echos in &lt;"..mmp.settings.echocolour.."&gt;"..mmp.settings.echocolour )
end

function mmp.changeLaglevel()
    local laglevel = mmp.settings.laglevel
    local laginfo = mmp.lagtable[laglevel]
    mmp.echo(string.format("Lag level set to [%d]: %s (%ss timer)", laglevel, laginfo.description, tostring(laginfo.time)))
end

function mmp.verifyLaglevel(value)
  if mmp.lagtable[value] then return true end
  return false
end

function mmp.lockPathways()
  local lock = mmp.settings.lockpathways and true or false
  mmp.doLock("pathways", lock, "pathfind")
end

function mmp.lockSewers()
  local lock = mmp.settings.locksewers and true or false
  return mmp.doLock("sewer grates", lock, "enter grate")
end

function mmp.lockWormholes()
  local lock = mmp.settings.lockwormholes and true or false
  return mmp.doLock("wormholes", lock, "worm warp")
end
tempTimer(0, function() if mmp.firstRun then mmp.lockWormholes() end end)

function mmp.lockPebble()
  local disabled = (not mmp.settings.pebble) and true or false
  mmp.doLock(nil, disabled, "touch 116998")
  mmp.doLock(nil, disabled, "touch 277930")

  mmp.echo(string.format("Use of pebble %s.", disabled and "disabled" or "enabled"))
end

function mmp.lockSpecials()
  local lock = mmp.settings.lockspecials and true or false
  mmp.doLock("special exits", lock)
end

function mmp.setDuanathar()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.duanathar then mmp.echo("Okay, will see about using Eagle wings when you goto somewhere while outside!")
  else mmp.echo("Won't use Eagle wings anymore.") end
end

function mmp.setDuanatharan()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.duanatharan then mmp.echo("Okay, will see about using Atavian wings (both duanathar and duanatharan) when you goto somewhere while outside!")
  else mmp.echo("Won't use Atavian wings anymore.") end
end

function mmp.setDuanatharic()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.duanatharic then mmp.echo("Okay, will see about using Island wings when you goto somewhere while outside!")
  else mmp.echo("Won't use Island wings anymore.") end
end

function mmp.setDuantahar()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.duantahar then mmp.echo("Okay, will see about using Chenubian wings (duanathar, duanatharan, and duantahar) when you goto somewhere while outside!")
  else mmp.echo("Won't use Chenubian wings anymore.") end
end

function mmp.setSoar()
  mmp.clearpathcache() -- clear the cache so it'll use soar or will stop using soar

  if mmp.settings.soar then mmp.echo("Okay, will see about using Aero Soar when you goto somewhere while outside!")
  else mmp.echo("Won't use Aero Soar anymore.") end
end

function mmp.setUniverse()
  mmp.clearpathcache()
	
	if mmp.settings.universe then mmp.echo("Okay, will see about using the Universe tarot whenever it's faster.")
	else mmp.echo("Won't use Universe tarot anymore.") end

end

function mmp.setGare()
  mmp.clearpathcache() -- clear the cache so it'll use gare or stop using gare

  if mmp.settings.gare then mmp.echo("Okay, will see about using Gare when in Dragon form!")
  else mmp.echo("Won't use Gare anymore.") end
end

function mmp.changeMapSource()
  local use = mmp.settings.crowdmap and true or false
  if use and not (mmp.game == "achaea" or mmp.game == "starmourn" or mmp.game == "lusternia" or mmp.game == "stickmud") then
    mmp.echo("Sorry - the crowdsourced map is only available for use in Achaea, Starmourn, Lusternia and StickMUD. If you'd like to help start one for your game, please post at http://forums.mudlet.org/viewtopic.php?f=13&amp;t=1696. If you are playing one of the games, then it is likely that you just downloaded the script - and it doesn't know what you are playing. Reconnect and it'll know.")
    mmp.settings.crowdmap = false
  elseif use and not loadMap then
   mmp.echo("Sorry - your Mudlet is too old and can't load maps. Please update: http://forums.mudlet.org/viewtopic.php?f=5&amp;t=1874")
   mmp.settings.crowdmap = false
  elseif use then
    mmp.echo("Will use the crowdsourced map for updates instead!")
    mmp.checkforupdate()
  else
    mmp.echo("Will use the default game map for updates.")
  end
end

function mmp.setWingsLanguage()
  mmp.echo("Alright, will say Duanathar and Duanathar in "..mmp.settings.winglanguage:title()..".")
end

function mmp.setWingsRemoval()
  mmp.echo("Okay - "..(mmp.settings.removewings and "will" or "won't").." remove wings after using them.")
end

function mmp.setSlowWalk()
  if mmp.settings.slowwalk then
    mmp.echo("Will walk 'slowly' - that is, only try to move in a direction once per room, and move again once we've arrived. This will make us better walkers when it's very laggy, as we won't spam directions unnecessarily and miss certain turns - but it does mean that if we fail to move for some reason, we won't retry again either at all.")
  else
    mmp.echo("Will walk as quick as we can!")
  end
end

function mmp.disableWaterWalk()
  local c = 0
  local getRoomEnv, setRoomWeight = getRoomEnv, setRoomWeight
  for roomid, roomname in pairs(getRooms()) do
    if mmp.waterenvs[getRoomEnv(roomid)] then
      setRoomWeight(roomid, 3)
      c = c + 1
    end
  end

  return c
end

function mmp.enableWaterWalk()
  local c = 0
  local getRoomEnv, setRoomWeight = getRoomEnv, setRoomWeight
  for roomid, roomname in pairs(getRooms()) do
    if mmp.waterenvs[getRoomEnv(roomid)] then
      setRoomWeight(roomid, 1)
      c = c + 1
    end
  end

  return c
end

function mmp.setWaterWalk()
  if mmp.settings.waterwalk then
    mmp.echo("Enabled waterwalk for "..mmp.enableWaterWalk().." rooms - so we'll be treating land and water rooms the same now in terms of traverse speed over them.")
  else
    mmp.echo("Disabled waterwalk for "..mmp.disableWaterWalk().." rooms - so we'll be preferring land rooms over water ones wherever it's quicker.")
  end
end

function mmp.setMedallion()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.medallion then mmp.echo("Okay, will see about using Medallion whenever it's quicker")
  else mmp.echo("Won't use Medallion anymore.") end
end

function mmp.setFingerblade()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.fingerblade then mmp.echo("Okay, will see about using Fingerblade whenever it's quicker")
  else mmp.echo("Won't use Fingerblade anymore.") end
end

function mmp.setBlossom()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.blossom then mmp.echo("Okay, will see about using the Flame whenever it's quicker")
  else mmp.echo("Won't use the Flame anymore.") end
end

function mmp.setMandala()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.mandala then mmp.echo("Okay, will see about using Mandala whenever it's quicker")
  else mmp.echo("Won't use Mandala anymore.") end
end

function mmp.setBelt()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.belt then mmp.echo("Okay, will see about using Belt whenever it's quicker")
  else mmp.echo("Won't use Belt anymore.") end
end

function mmp.setCubix()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.cubix then mmp.echo("Okay, will see about using Cubix whenever it's quicker")
  else mmp.echo("Won't use Cubix anymore.") end
end

function mmp.setPrism()
	mmp.clearpathcache()
	if mmp.settings.prism then mmp.echo("Okay, will see about using Prism whenever it's quicker")
	else mmp.echo("Won't use Prism anymore.") end
end

function mmp.setScrewdriver()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.screwdriver then mmp.echo("Okay, will see about using Screwdriver whenever it's quicker")
  else mmp.echo("Won't use Screwdriver anymore.") end
end

function mmp.setWheel()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.wheel then mmp.echo("Okay, will see about using Wheel whenever it's quicker")
  else mmp.echo("Won't use Wheel anymore.") end
end

function mmp.setMud()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.mud then mmp.echo("Okay, will see about using Mud whenever it's quicker")
  else mmp.echo("Won't use Mud anymore.") end
end
function mmp.setSnowglobe()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.snowglobe then mmp.echo("Okay, will see about using Snowglobe whenever it's quicker")
  else mmp.echo("Won't use Snowglobe anymore.") end
end

function mmp.setCookie()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.cookie then mmp.echo("Okay, will see about using Cookie whenever it's quicker")
  else mmp.echo("Won't use Cookie anymore.") end
end

function mmp.setHead()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.head then mmp.echo("Okay, will see about using Doll's Head whenever it's quicker")
  else mmp.echo("Won't use Doll's Head anymore.") end
end

function mmp.setIcicle()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.icicle then mmp.echo("Okay, will see about using Icicle whenever it's quicker")
  else mmp.echo("Won't use Icicle anymore.") end
end

function mmp.setTibia()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.tibia then mmp.echo("Okay, will see about using Tibia whenever it's quicker")
  else mmp.echo("Won't use Tibia anymore.") end
end

function mmp.setBonecurio()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.bonecurio then mmp.echo("Okay, will see about using Bone Curio collection whenever it's quicker")
  else mmp.echo("Won't use Bone Curio collection anymore.") end
end

function mmp.setFlowercurio()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.flowercurio then mmp.echo("Okay, will see about using Flower Curio collection whenever it's quicker")
  else mmp.echo("Won't use Flower Curio collection anymore.") end
end

function mmp.setTorus()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.torus then mmp.echo("Okay, will see about using your Torus whenever it's quicker")
  else mmp.echo("Won't use your Torus anymore.") end
end

function mmp.setUtensilcurio()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.utensilcurio then mmp.echo("Okay, will see about using Utensil Curio collection whenever it's quicker")
  else mmp.echo("Won't use Utensil Curio collection anymore.") end
end

function mmp.setFluttercurio()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.fluttercurio then mmp.echo("Okay, will see about using Flutter Curio collection whenever it's quicker")
  else mmp.echo("Won't use Flutter Curio collection anymore.") end
end

function mmp.setToolcurio()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.toolcurio then mmp.echo("Okay, will see about using Tool Curio collection whenever it's quicker")
  else mmp.echo("Won't use Tool Curio collection anymore.") end
end

function mmp.setFacecurio()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.facecurio then mmp.echo("Okay, will see about using Face Curio collection whenever it's quicker")
  else mmp.echo("Won't use Face Curio collection anymore.") end
end

function mmp.setToycurio()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.toycurio then mmp.echo("Okay, will see about using Toy Curio collection whenever it's quicker")
  else mmp.echo("Won't use Toy Curio collection anymore.") end
end

function mmp.setFeathercurio()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.feathercurio then mmp.echo("Okay, will see about using Feather Curio collection whenever it's quicker")
  else mmp.echo("Won't use Feather Curio collection anymore.") end
end

function mmp.setFigurecurio()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.figurecurio then mmp.echo("Okay, will see about using Figure Curio collection whenever it's quicker")
  else mmp.echo("Won't use Figure Curio collection anymore.") end
end

function mmp.setVernalcurio()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.vernalcurio then mmp.echo("Okay, will see about using Vernal Curio collection whenever it's quicker")
  else mmp.echo("Won't use Vernal Curio collection anymore.") end
end
function mmp.setSoullesscurio()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.soullesscurio then mmp.echo("Okay, will see about using Soulless Curio collection whenever it's quicker")
  else mmp.echo("Won't use Soulless Curio collection anymore.") end
end

function mmp.setHarness() --PapaGuacamole
  mmp.clearpathcache() -- clear the cache so it'll use harness or will stop using harness

  if mmp.settings.harness then mmp.echo("Okay, will use Stratospheric Harness when on appropriate islands")
  else mmp.echo("Won't use Stratospheric Harness anymore.") end
end

function mmp.setMantle()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.mantle then mmp.echo("Okay, will see about using Mantle of Starlight whenever it's quicker")
  else mmp.echo("Won't use Mantle of Starlight anymore.") end
end

function mmp.setKey()
  mmp.clearpathcache() -- clear the cache so it'll use wings or will stop using wings

  if mmp.settings.key then mmp.echo("Okay, will see about using your Infernal Key whenever it's quicker")
  else mmp.echo("Won't use the Infernal Key anymore.") end
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>API</name>
							<packageName></packageName>
							<script>-------------------------------------------------
-- This script lists some of the API functions available from the IRE mudlet-mapper
-- not all functions that are available are included here, however.

function mmp.echo(what)
  what = what or ""
  moveCursorEnd("main") if getCurrentLine() ~= "" then echo"\n" end
  decho("&lt;112,229,0&gt;(&lt;73,149,0&gt;mapper&lt;112,229,0&gt;): &lt;255,255,255&gt;")
  cecho(tostring(what))
  echo("\n")
end

function mmp.echon(what)
  moveCursorEnd("main") if getCurrentLine() ~= "" then echo"\n" end
  decho("&lt;112,229,0&gt;(&lt;73,149,0&gt;mapper&lt;112,229,0&gt;): &lt;255,255,255&gt;")
  cecho(tostring(what))
end

function mmp.deleteLineP()
  deleteLine()
  tempLineTrigger(1,1,[[
    if isPrompt() then deleteLine() end
  ]])
end

function mmp.pause(what)
  assert(what == nil or what == "on" or what == "off", "mmp.pause wants 'on', 'off' or nothing as an argument")

  if what == "on" or (what == nil and not mmp.paused) then
    mmp.paused = true
  elseif  what == "off" or (what == nil and mmp.paused) then
    mmp.paused = false
  end

  mmp.echo("Speedwalking " .. (mmp.paused and "paused" or "unpaused") .. ".")
  if not mmp.paused then mmp.move() end
end

function mmp.mapLook(roomid, delay)
  centerview(roomid)
  if mmp.maplooktimer then killTimer(mmp.maplooktimer) end
  mmp.maplooktimer = tempTimer(tonumber(delay) or 4, [[centerview(mmp.currentroom); mmp.maplooktimer = nil]])
end

function mmp.getnums(roomname, exact)
  if tonumber(roomname) then return {roomname} end

  local t = (not exact and mmp.searchRoom or mmp.searchRoomExact)(roomname)

  if not t or not next(t) then
    return nil end

  local result = {}

  if not tonumber(select(2, next(t))) then
    for roomid,_ in pairs(t) do
      if roomid ~= 0 then result[#result+1] = tonumber(roomid) end
    end
  else
    for _,roomid in pairs(t) do
      if roomid ~= 0 then result[#result+1] = tonumber(roomid) end
    end
  end

  return result
end

-- searchRoom with a cache!
local cache = {}
setmetatable(cache, {__mode = "kv"}) -- weak keys/values = it'll periodically get cleaned up by gc

function mmp.searchRoom(what)
  local result = cache[what]
  if not result then
    result = searchRoom(what)
    local realResult = {}
    for key, value in pairs(type(result) == "table" and result or {}) do
        -- both ways, because searchRoom can return either id-room name or the reverse
        if type(key) == "string" then
          realResult[key:ends(" (road)") and key:sub(1, -8) or key] = value
        else
          realResult[key] = value:ends(" (road)") and value:sub(1, -8) or value
        end
    end
    cache[what] = realResult
    result = realResult
  end
  return result
end

local function endswith(s, suffix)
    return s:sub(#s - #suffix + 1) == suffix
end

function mmp.searchRoomExact(what)
  if type(what) ~= 'string' then return end

  local roomTable = mmp.searchRoom(what)
  local realResult = {}
  what = what:lower()
  for key, value in pairs (roomTable) do
    if type(key) == "string" and (key:lower() == what or (endswith(key, '.') and key:sub(1, -2) == what)) then
        realResult[key:ends(" (road)") and key:sub(1, -8) or key] = value
    elseif type(value) == "string" and (value:lower() == what or (endswith(value, '.') and value:sub(1, -2) == what)) then
        realResult[key] = value:ends(" (road)") and value:sub(1, -8) or value
    end
  end
  if (table.is_empty(realResult)) then
    return roomTable
  else
    return realResult
  end
end

function mmp.findAreaID(areaname, exact)
  local areaname = areaname:lower()
  local list = getAreaTable()

  -- iterate over the list of areas, matching them with substring match.
  -- if we get match a single area, then return it's ID, otherwise return
  -- 'false' and a message that there are than one are matches
  local returnid, fullareaname, multipleareas = nil, nil, {}
  for area, id in pairs(list) do
    if (not exact and area:lower():find(areaname, 1, true)) or (exact and areaname == area:lower()) then
      returnid = id; fullareaname = area; multipleareas[#multipleareas+1] = area
    end
  end

  if #multipleareas == 1 then
    return returnid, fullareaname
  else
    return nil, nil, multipleareas
  end
end

function mmp.roomexists(num)
  if not num then return false end
  if roomExists then return roomExists(num) end

  local s,m = pcall(getRoomArea, tonumber(num))
  return (s and true or false)
end

function mmp.getcontinents()
  local tmp = getRoomUserData(1, "areaContinents")
  if tmp == "" then return {} end

  return yajl.to_value(tmp)
end

-- patches welcome to finish this function.
function mmp.removecontinent(area, continent)
  local continents = mmp.getcontinents()

  if not next(continents) then return nil, "no continents are known" end
  if not continents[continent] then return nil, "no such continent is recorded" end

  local index = mmp.indexof_valueonly(continents[continent], area)
  if not index then return nil, "this area is not on that continent" end
  table.remove(continents[continent], index)
  local tmp = yajl.to_string(continents)
  setRoomUserData(1, "areaContinents", tmp)
  return true
end

function mmp.addcontinent(areaid, continent)
  local continents = mmp.getcontinents()

  if not next(continents) then return nil, "no continents are known" end
  if not continents[continent] then continents[continent] = {} end

  local index = mmp.indexof_valueonly(continents[continent], areaid)
  if index then return nil, "this area is already on that continent" end
  continents[continent][#continents[continent] + 1] = areaid
  local tmp = yajl.to_string(continents)
  setRoomUserData(1, "areaContinents", tmp)
  return true
end

function mmp.indexof_valueonly(data, value)
  for i = 1, #data do
    if data[i] == value then return i end
  end

  return false
end

-- checks if given area ID is on the given continent. Returns true only if certainly knows
function mmp.oncontinent(areaid, continent)
  local continents = mmp.getcontinents()
  if not continents[continent] then return nil, "no such continent is recorded" end

  return mmp.indexof_valueonly(continents[continent], areaid)
end

function mmp.getareacontinents(areaid)
  local areaContinents = {}
  for continentName, areas in pairs(mmp.getcontinents()) do
    if mmp.indexof_valueonly(areas, areaid) then
      areaContinents[#areaContinents + 1] = continentName
    end
  end
  return areaContinents
end

-- accepts areaname or ID
function mmp.cleanAreaName(area)
  local areaname = type(area) == "number" and mmp.areatabler[area] or area
  if not areaname then return area end

  -- strip , the
  areaname = areaname:gsub(", the$", '')

  -- strip , the Type of
  areaname = areaname:gsub(", the %w+ of$", '')

  -- strip , the Type of (important)
  areaname = areaname:gsub(", the %w+ of %((.+)%)$", " (%1)")

  -- strip , the (important)
  areaname = areaname:gsub(", the %((.+)%)$", " (%1)")

  return areaname
end

-- if this room is in a unique area, report it. Otherwise gives nil
function mmp.getexactarea(roomname)
  local rooms = mmp.searchRoomExact(roomname)

  if not rooms or not next(rooms) then return nil end

  local areaid
  for roomid, roomname in pairs(rooms) do

    local caid = getRoomArea(roomid)
    if areaid and areaid ~= caid then return nil end
    areaid = caid
  end

  if areaid then return mmp.areatabler[areaid] end
end

-- returns the area name of a room or ?
function mmp.getAreaName(roomid)
   return mmp.areatabler[getRoomArea(roomid)] or '?'
end

-- removes extra prefixes and suffixes that are not part of the actual room name
function mmp.cleanroomname(roomname)
  local starts, ends = string.starts, string.ends

  if starts(roomname, "Flying above ") then
    roomname = string.sub(roomname, -(#roomname-13))
  end
  if starts(roomname, "In the trees above ") then
    roomname = string.sub(roomname, -(#roomname-19))
  end
  if starts(roomname, "The ruins of ") then
    roomname = string.sub(roomname, -(#roomname-13))
  end
  if ends(roomname, ".") then
    roomname = string.sub(roomname, 1, (#roomname-1))
  end
  if ends(roomname, " (road)") then
    roomname = string.sub(roomname, 1, (#roomname-7))
  end
  if ends(roomname, " (indoors)") then
    roomname = string.sub(roomname, 1, (#roomname-10))
  end
  if ends(roomname, " (indoor road)") then
    roomname = string.sub(roomname, 1, (#roomname-14))
  end

  return roomname
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>mmp.roomLook</name>
							<packageName></packageName>
							<script>function mmp.roomLook(input)
  -- we can do a report with a number

  local function handle_number(num)
    -- compile all available data
    if not mmp.roomexists(num) then
      mmp.echo(num .. " doesn't seem to exist.")
      return
    end
    local s, areanum = pcall(getRoomArea, num)
    if not s then
      mmp.echo(areanum);
      return ;
    end
    local exits = getRoomExits(num)
    local name = getRoomName(num)
    local islocked = roomLocked(num)
    local weight = (getRoomWeight(num) and getRoomWeight(num) or "?")
    -- getRoomWeight is buggy in one of the versions, is actually linked to setRoomWeight and thus returns nil
    local exitweights = (getExitWeights and getExitWeights(num) or {})
    local coords = {getRoomCoordinates(num)}
    local specexits = getSpecialExits(num)
    local env = getRoomEnv(num)
    local envname = (mmp.envidsr and mmp.envidsr[env]) or "?"
    -- generate a report
    mmp.echo(
      string.format(
        "Room: %s #: %d area: %s (%d)", name, num, tostring(mmp.areatabler[areanum]), areanum
      )
    )
    mmp.echo(
      string.format(
        "Coordinates: x:%d, y:%d, z:%d, locked: %s, weight: %s",
        coords[1],
        coords[2],
        coords[3],
        (islocked and "yep" or "nope"),
        tostring(weight)
      )
    )
    mmp.echo(
      string.format(
        "Environment: %s (%d)%s",
        tostring(envname),
        env,
        (getRoomUserData(num, "indoors") ~= '' and ", indoors" or '')
      )
    )
    mmp.echo(string.format("Exits (%d):", table.size(exits)))
    for exit, leadsto in pairs(exits) do
      echo(
        string.format(
          "  %s -&gt; %s (%d)%s%s\n",
          exit,
          getRoomName(leadsto),
          leadsto,
          (
            (getRoomArea(leadsto) or "?") == areanum and
            "" or
            " (in " ..
            (mmp.areatabler[getRoomArea(leadsto)] or "?") ..
            ")"
          ),
          (
            (not exitweights[mmp.anytoshort(exit)] or exitweights[mmp.anytoshort(exit)] == 0) and
            "" or
            " (weight: " ..
            exitweights[mmp.anytoshort(exit)] ..
            ")"
          )
        )
      )
    end
    -- display special exits if we got any
    if next(specexits) then
      mmp.echo(string.format("Special exits (%d):", table.size(specexits)))
      for leadsto, command in pairs(specexits) do
        if type(command) == "string" then
          echo(string.format("  %s -&gt; %s (%d)\n", command, getRoomName(leadsto), leadsto))
        else
          -- new format - exit name, command
          for cmd, locked in pairs(command) do
            if locked == '1' then
              cecho(
                string.format(
                  "&lt;DarkSlateGrey&gt;  %s -&gt; %s (%d) (locked)\n", cmd, getRoomName(leadsto), leadsto
                )
              )
            else
              echo(string.format("  %s -&gt; %s (%d)\n", cmd, getRoomName(leadsto), leadsto))
            end
          end
        end
      end
    end
    local message = "This room has the feature '%s'."
    for _, mapFeature in pairs(mmp.getRoomMapFeatures(num)) do
      mmp.echo(string.format(message, mapFeature))
    end
    -- actions we can do. This will be a short menu of sorts for actions
    mmp.echo("Stuff you can do:")
    echo("  ")
    echo("Clear all labels ")
    setUnderline(true)
    echoLink("(in area)", 'mmp.clearLabels(' .. areanum .. ')', '', true)
    setUnderline(false)
    echo(" ")
    setUnderline(true)
    echoLink(
      "(whole map)",
      [[
    if not mmp.clearinglabels then
      mmp.echo("Are you sure you want to clear all of your labels on this map? If yes, click the link again.")
      mmp.clearinglabels = true
    else
      mmp.clearLabels("map")
      mmp.clearinglabels = nil
    end
    ]],
      '',
      true
    )
    setUnderline(false)
    echo("\n")
    echo("  ")
    setUnderline(true)
    echoLink(
      "Check for mapper &amp; map updates", 'mmp.echo("Checking...") mmp.checkforupdate()', '', true
    )
    setUnderline(false)
    echo(" ")
    setUnderline(true)
    echoLink(
      "(force map)",
      [[
      if io.exists(getMudletHomeDir().."/map downloads/current") then
        local s,m = os.remove(getMudletHomeDir().."/map downloads/current")
        if not s then mmp.echo("Couldn't delete '"..getMudletHomeDir().."/map downloads/current' file: "..tostring(m)..".") end
      end
      mmp.echo("Re-downloading the latest crowdmap...")
      mmp.checkforupdate()
    ]],
      "Re-download the map regardless if you have latest",
      true
    )
    setUnderline(false)
    echo("\n")
  end

  -- see if we can do anything with the name

  local function handle_name(name)
    local result = mmp.searchRoom(name)
    if type(result) == "string" then
      cecho("&lt;grey&gt;You have no recollection of any room with that name.")
      return
    end
    -- if we got one result, then act on it
    if table.size(result) == 1 then
      if type(next(result)) == "number" then
        handle_number(next(result))
      else
        handle_number(select(2, next(result)))
      end
      return
    end
    -- if not, then ask the user to clarify which one would they want
    mmp.echo("Which room specifically would you like to look up?")
    if not select(2, next(result)) or not tonumber(select(2, next(result))) then
      for roomid, roomname in pairs(result) do
        roomid = tonumber(roomid)
        cecho(string.format("  &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt; (", tostring(roomname)))
        cechoLink(
          "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
          'mmp.roomLook(' .. roomid .. ')',
          string.format("View room details for %s (%s)", roomid, tostring(roomname)),
          true
        )
        cecho(
          string.format(
            "&lt;DarkSlateGrey&gt;) in the &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt;.\n",
            tostring(mmp.areatabler[getRoomArea(roomid)])
          )
        )
      end
    else
      for roomname, roomid in pairs(result) do
        roomid = tonumber(roomid)
        cecho(string.format("  &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt; (", tostring(roomname)))
        cechoLink(
          "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
          'mmp.roomLook(' .. roomid .. ')',
          string.format("View room details for %s (%s)", roomid, tostring(roomname)),
          true
        )
        cecho(
          string.format(
            "&lt;DarkSlateGrey&gt;) in the &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt;.\n",
            tostring(mmp.areatabler[getRoomArea(roomid)])
          )
        )
      end
    end
  end

  if not input then
    if not mmp.roomexists(mmp.currentroom) then
      mmp.echo(mmp.currentroom .. " doesn't seem to be mapped yet.")
      mmp.echo("Stuff you can do:")
      echo("  ")
      echoLink("Check for all updates", 'mmp.echo("Checking...") mmp.checkforupdate()', '')
      echo(" ")
      echoLink(
        "(force map)",
        [[
      local s,m = os.remove(getMudletHomeDir().."/map downloads/current")
        if io.exists(getMudletHomeDir().."/map downloads/current") then
          local s,m = os.remove(getMudletHomeDir().."/map downloads/current")
          if not s then mmp.echo("Couldn't delete '"..getMudletHomeDir().."/map downloads/current' file: "..tostring(m)..".") end
        end
        mmp.echo("Re-downloading the latest map...")
        mmp.checkforupdate()
      ]],
        "Re-download the map regardless if you have latest"
      )
      echo("\n")
      mmp.echo(string.format("version %s.", tostring(mmp.version)))
      return
    else
      input = mmp.currentroom
    end
  end
  if tonumber(input) then
    handle_number(tonumber(input))
  else
    handle_name(input)
  end
  mmp.echo(string.format("version %s.", tostring(mmp.version)))
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>mmp.ferriesfix</name>
							<packageName></packageName>
							<script>function mmp.ferriesfix()
  if table.is_empty(mmp.ferry_rooms) then
    local tmp = getRoomUserData(1, "ferry rooms")
    if tmp ~= "" then
      for _, i in ipairs(yajl.to_value(tmp)) do
        mmp.ferry_rooms[i] = true
      end
    end
  end
end</script>
							<eventHandlerList>
								<string>mmapper updated map</string>
								<string>sysConnectionEvent</string>
							</eventHandlerList>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>mmp.wormholesfix</name>
							<packageName></packageName>
							<script>function mmp.wormholesfix()
  local c = 0
  local weight = 10
  for _, area in pairs(getAreaTable()) do
    local rooms = getAreaRooms(area) or {}
    for i = 0, #rooms do
      local exits = getSpecialExits(rooms[i] or 0)

       if exits and next(exits) then
         for exit, cmd in pairs(exits) do
           if type(cmd) == "table" then cmd = next(cmd) end

           if (cmd:lower():find("worm warp", 1, true)) then
				setExitWeight(rooms[i], cmd, weight)
             c = c + 1
           end
         end
       end
    end
  end

  if c &gt; 0 then mmp.echo(string.format("%s wormholes weighted to %s (so we don't take them over too short distances).", c, weight)) end
end</script>
							<eventHandlerList>
								<string>mmapper updated map</string>
								<string>sysMapDownloadEvent</string>
							</eventHandlerList>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>mmp.clearlastupdate</name>
							<packageName></packageName>
							<script>function mmp.clearlastupdate()
  -- reset mmp.pdb_lastupdate on the prompt
  enableTrigger"Mudlet Mapper prompt trigger"
end</script>
							<eventHandlerList>
								<string>mmapper updated pdb</string>
							</eventHandlerList>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Third-party functions</name>
							<packageName></packageName>
							<script>-- from: http://lua-users.org/wiki/CopyTable
local function deepcopy(orig)
    local orig_type = type(orig)
    local copy
    if orig_type == 'table' then
        copy = {}
        for orig_key, orig_value in next, orig, nil do
            copy[deepcopy(orig_key)] = deepcopy(orig_value)
        end
        setmetatable(copy, deepcopy(getmetatable(orig)))
    else -- number, string, boolean, etc
        copy = orig
    end
    return copy
end

mmp.deepcopy = deepcopy</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>mmp_regenerate_areas</name>
							<packageName></packageName>
							<script>function mmp_regenerate_areas()
  -- cached data
  mmp.areatable = getAreaTable() -- this translates an area name to an ID
  mmp.areatabler = {} -- this translates an ID to an area name

  local t = getAreaTable()
  for k,v in pairs(t) do
    mmp.areatabler[tonumber(v)] = k
  end

  mmp.clearpathcache()
end</script>
							<eventHandlerList>
								<string>mmp areas changed</string>
								<string>mmapper map reloaded</string>
							</eventHandlerList>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>mmp_relock_areas</name>
							<packageName></packageName>
							<script>function mmp_relock_areas()
	local getAreaRooms, lockRoom, lockedareas = getAreaRooms, lockRoom, mmp.locked

	for areaid, areaname in pairs(getAreaTableSwap()) do
		if lockedareas[areaid] then
			local rooms = getAreaRooms(areaid) or {}
			for _, roomid in pairs(rooms) do
				lockRoom(roomid, true)
			end
		else
			local rooms = getAreaRooms(areaid) or {}
			for _, roomid in pairs(rooms) do
				lockRoom(roomid, false)
			end
		end
	end

	-- make sure area with ID 0 is locked - this was causing crashing issues
	local rooms = getAreaRooms(0) or {}
	for _, roomid in pairs(rooms) do
		lockRoom(roomid, true)
	end
end</script>
							<eventHandlerList>
								<string>mmapper map reloaded</string>
							</eventHandlerList>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Fix setExit</name>
							<packageName></packageName>
							<script>do
local oldsetExit = setExit

local exitmap = {
  n = 1,
  north = 1,
  ne = 2,
  northeast = 2,
  nw = 3,
  northwest = 3,
  e = 4,
  east = 4,
  w = 5,
  west = 5,
  s = 6,
  south = 6,
  se = 7,
  southeast = 7,
  sw = 8,
  southwest = 8,
  u = 9,
  up = 9,
  d = 10,
  down = 10,
  ["in"] = 11,
  out = 12
}

function setExit(from, to, direction)
  if type(direction) == "string" and not exitmap[direction] then return false end

  return oldsetExit(from, to, type(direction) == "string" and exitmap[direction] or direction)
end
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Fix exit locking funcs</name>
							<packageName></packageName>
							<script>do
local oldlockExit = lockExit
local oldhasExitLock = hasExitLock

local exitmap = {
  n = 1,
  north = 1,
  ne = 2,
  northeast = 2,
  nw = 3,
  northwest = 3,
  e = 4,
  east = 4,
  w = 5,
  west = 5,
  s = 6,
  south = 6,
  se = 7,
  southeast = 7,
  sw = 8,
  southwest = 8,
  u = 9,
  up = 9,
  d = 10,
  down = 10,
  ["in"] = 11,
  out = 12
}

function lockExit(from, direction, status)
  if type(direction) == "string" and not exitmap[direction] then return false end

  return oldlockExit(from, type(direction) == "string" and exitmap[direction] or direction, status)
end

function hasExitLock(from, direction)
  if type(direction) == "string" and not exitmap[direction] then return false end

  return oldhasExitLock(from, type(direction) == "string" and exitmap[direction] or direction)
end
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Assorted small utilities</name>
							<packageName></packageName>
							<script>function mmp.comma_value(n) -- credit http://richard.warburton.it
	local left,num,right = string.match(n,'^([^%d]*%d)(%d*)(.-)$')
	return left..(num:reverse():gsub('(%d%d%d)','%1,'):reverse())..right
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Defense tracking</name>
							<packageName></packageName>
							<script>mmp.defs = {current = {}}
mmp.defs.add =
  function()
    local def = gmcp.Char.Defences.Add.name
    if not mmp.defs.current[def] then
      mmp.defs.current[def] = true
      raiseEvent("mmp got def", def)
    end
  end
mmp.defs.remove =
  function()
    for _, def in ipairs(gmcp.Char.Defences.Remove) do
      mmp.defs.current[def] = nil
      raiseEvent("mmp lost def", def)
    end
  end
mmp.defs.list =
  function()
    local newDefs = {}
    local addedDefs, lostDefs = {}, {}
    for _, v in ipairs(gmcp.Char.Defences.List) do
      newDefs[v.name] = true
      if not mmp.defs.current[v.name] then
        addedDefs[#addedDefs + 1] = v.name
      end
    end
    for def in pairs(mmp.defs.current) do
      if not newDefs[def] then
        lostDefs[#lostDefs + 1] = def
      end
    end
    mmp.defs.current = newDefs
    for _, def in pairs(lostDefs) do
      raiseEvent("mmp lost def", def)
    end
    for _, def in ipairs(addedDefs) do
      raiseEvent("mmp got def", def)
    end
  end
-- EVENT HANDLERS
registerAnonymousEventHandler("gmcp.Char.Defences.Add", "mmp.defs.add")
registerAnonymousEventHandler("gmcp.Char.Defences.Remove", "mmp.defs.remove")
registerAnonymousEventHandler("gmcp.Char.Defences.List", "mmp.defs.list")</script>
							<eventHandlerList />
						</Script>
					</Script>
					<Script isActive="yes" isFolder="no">
						<name>Person tracking</name>
						<packageName></packageName>
						<script>--[[
mmp will have 2 person tracking databases:
- mmp.pdb  =  used to store the last known location of a person
- mmp.pdb_lastupdate  =  used to store the output of the last locating command

Both databases work with the person's name as key and the location name as value.

]]
mmp.pdb = mmp.pdb or {}
mmp.pdb_lastupdate = mmp.pdb_lastupdate or {}

function mmp.is_here(who)
  return (mmp.pdb[who] and mmp.pdb[who] == mmp.currentroomname) and true or false
end</script>
						<eventHandlerList />
					</Script>
					<Script isActive="yes" isFolder="no">
						<name>Lock Area</name>
						<packageName></packageName>
						<script>-- Lock Area

mmp.locked = mmp.locked or {}
mmp.lastLockSearch = mmp.lastLockSearch or nil

function mmp.doLockArea(search)
	local areaList
	if search ~= nil then
		local r = rex.new(string.lower(search))
		mmp.lastLockSearch = search
		for name, id in pairs(getAreaTable()) do
			if r:match(string.lower(name)) then
				areaList = areaList or {}
				areaList[name] = id
			end
		end
		if areaList == nil then
			mmp.echo("'" .. search .. "' did not match any known areas!")
			return
		end
	else
		mmp.lastLockSearch = nil
		areaList = getAreaTable()
	end

	for name, id in pairs(areaList) do
		mmp.echon(name .. string.rep(" ", 40 - string.len(name)))
		if not mmp.locked[id] then
			setFgColor(0, 200, 0)
			setUnderline(true)
			echoLink("Lock!", [[mmp.lockArea( ']] .. name:gsub("'", [[\']]) .. [[', true )]], "Click to lock area '" .. name .. "'", true)
		else
			setFgColor(200, 0, 0)
			setUnderline(true)
			echoLink("Unlock!", [[mmp.lockArea( ']] .. name:gsub("'", [[\']]) .. [[', false )]], "Click to unlock area '" .. name .. "'", true)
		end
	end

	if not search then
		echo"\n\n" mmp.echo("Use &lt;green&gt;arealock &lt;area&gt;&lt;white&gt; to filter areas.")
	end
end

function mmp.lockArea(name, lock, dontreshow)
	local areas = getAreaTable()
	local rooms = getAreaRooms(areas[name]) or {}
    local lockRoom = lockRoom
    local count = 0
	for _, room in pairs(rooms) do
		lockRoom(room, lock)
        count = count + 1
	end

	mmp.locked[areas[name]] = lock and true or nil
	mmp.echo(string.format("Area '%s' %slocked! All %s room%s within it.", name, (lock and '' or 'un'), count, (count == 1 and '' or 's')))

	if not dontreshow then mmp.doLockArea(mmp.lastLockSearch) end
end


</script>
						<eventHandlerList />
					</Script>
					<Script isActive="yes" isFolder="no">
						<name>Center view via GMCP</name>
						<packageName></packageName>
						<script></script>
						<eventHandlerList />
						<Script isActive="yes" isFolder="no">
							<name>mmp_center_roominfo</name>
							<packageName></packageName>
							<script>function mmp_center_roominfo()
  -- lusternia has gmcp.Room.Players before gmcp.Room.Info is created
  if gmcp.Room.Info then centerview(gmcp.Room.Info.num) end
end</script>
							<eventHandlerList>
								<string>gmcp.Room</string>
							</eventHandlerList>
						</Script>
					</Script>
					<ScriptGroup isActive="yes" isFolder="yes">
						<name>mm Mapping</name>
						<packageName></packageName>
						<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
						<eventHandlerList />
						<Script isActive="yes" isFolder="no">
							<name>mmp_mapping_newroom</name>
							<packageName></packageName>
							<script>--mmp_mapping_newroom

local function makeroom(oldid, newid, x, y, z)
  assert(x and y and z, "makeroom: need all 3 coordinates")
  addRoom(newid)
  setRoomCoordinates(newid, x, y, z)
  setRoomArea(newid, getRoomArea(oldid))
  local fgr, fgg, fgb = unpack(color_table.red)
  local bgr, bgg, bgb = unpack(color_table.blue)
  highlightRoom(newid, fgr, fgg, fgb, bgr, bgg, bgb, 1, 100, 100)
  if mmp.envids[gmcp.Room.Info.environment] then
    setRoomEnv(newid, mmp.envids[gmcp.Room.Info.environment])
  else
    setRoomEnv(newid, getRoomEnv(oldid))
  end
  return string.format("Created new room %d at %dx,%dy,%dz.", newid, x, y, z)
end

-- gives the reverse shifted coordinates, ie asking for the sw exit + coords will give the coords at ne

local function getshiftedcoords(original, ox, oy, oz)
  local x, y, z
  local has = table.contains
  -- reverse the exit
  w = mmp.ranytolong(original)
  if has({"west", "left", "w", "l"}, w) then
    x = (x or ox) - 1
    y = (y or oy)
    z = (z or oz)
  elseif has({"east", "right", "e", "r"}, w) then
    x = (x or ox) + 1
    y = (y or oy)
    z = (z or oz)
  elseif has({"north", "top", "n", "t"}, w) then
    x = (x or ox)
    y = (y or oy) + 1
    z = (z or oz)
  elseif has({"south", "bottom", "s", "b"}, w) then
    x = (x or ox)
    y = (y or oy) - 1
    z = (z or oz)
  elseif has({"northwest", "topleft", "nw", "tl"}, w) then
    x = (x or ox) - 1
    y = (y or oy) + 1
    z = (z or oz)
  elseif has({"northeast", "topright", "ne", "tr"}, w) then
    x = (x or ox) + 1
    y = (y or oy) + 1
    z = (z or oz)
  elseif has({"southeast", "bottomright", "se", "br"}, w) then
    x = (x or ox) + 1
    y = (y or oy) - 1
    z = (z or oz)
  elseif has({"southwest", "bottomleft", "sw", "bl"}, w) then
    x = (x or ox) - 1
    y = (y or oy) - 1
    z = (z or oz)
  elseif has({"up", "u"}, w) then
    x = (x or ox)
    y = (y or oy)
    z = (z or oz) + 1
  elseif has({"down", "d"}, w) then
    x = (x or ox)
    y = (y or oy)
    z = (z or oz) - 1
  elseif has({"in", "i"}, w) then
    x = (x or ox)
    y = (y or oy)
    z = (z or oz) - 1
  elseif has({"out", "o"}, w) then
    x = (x or ox)
    y = (y or oy)
    z = (z or oz) + 1
  else
    mmp.echo(
      "Don't know where to shift the coordinates for a " ..
      tostring(w) ..
      " (" ..
      tostring(original) ..
      ") exit."
    )
  end
  return x, y, z
end

function mmp_mapping_newroom(_, num)
  local s, m =
    xpcall(
      function()
        if not mmp.editing then
          return
        end
        if not gmcp.Room then
          mmp.echo(
            "You need to have GMCP turned on (see preferences on a recent Mudlet) for mapping stuff."
          )
          return
        end
        -- wilderness mapping right now is UNFINISHED! It does not handle the grid breakup. So, please don't try it, and please won't whine about it.

        local function inwilderness()
          return (gmcp.Room.Info.coords == "" and gmcp.Room.Info.area == "")
        end

        local getRoomName, getRoomCoordinates, getRoomsByPosition =
          getRoomName, getRoomCoordinates, getRoomsByPosition
        local num = tonumber(num) or tonumber(gmcp.Room.Info.num)
        local currentexits = gmcp.Room.Info.exits
        local s = ""
        if not mmp.roomexists(num) then
          -- see if we can create and link this room with an existing one
          -- wilderness and non-wilderness rooms require different methods of calculating relative coordinates
          if not inwilderness() then
            for exit, id in pairs(currentexits) do
              if mmp.roomexists(id) then
                s = makeroom(id, num, getshiftedcoords(exit, getRoomCoordinates(id)))
              end
            end
          else
            local x, y = tostring(num):match(".-(%d%d%d)(%d%d%d)$")
            -- Achaea's coordinates seem to be in the 4th quadrant, while Mudlets 0,0 is in the middle of the map. Invert y so going north-south looks alright
            s = makeroom(mmp.previousroom, num, x, y * -1, 0)
          end
        end
        -- if we created it, and some data could be filled in
        if mmp.roomexists(num) then
          -- cleanup the room name
          local rootroomname = mmp.cleanroomname(gmcp.Room.Info.name)
          -- match exact case, so mappers alertness' works properly
          if getRoomName(num) ~= rootroomname then
            setRoomName(num, rootroomname)
            unHighlightRoom(num)
            s = s .. (#s &gt; 0 and " " or "") .. "Updated room name to '" .. rootroomname .. "'."
          end
          -- autolink exits
          if not inwilderness() then
            local x = getRoomExits(num) or {}
            -- check for missing exits
            for exit, id in pairs(currentexits) do
              if id == 0 then
                s =
                  s ..
                  (#s &gt; 0 and " " or "") ..
                  "Can't link to the " ..
                  exit ..
                  ", it leads to a room with ID 0 (and that's not supported yet)."
              else
                if not x[mmp.anytolong(exit)] then
                  if not mmp.roomexists(id) then
                    s =
                      makeroom(
                        num, id, getshiftedcoords(mmp.ranytolong(exit), getRoomCoordinates(num))
                      )
                  end
                  if setExit(num, id, exit) then
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      "Added missing exit " ..
                      exit ..
                      " to " ..
                      (getRoomName(id) ~= "" and getRoomName(id) or "''") ..
                      " (" ..
                      id ..
                      ")."
                  else
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      string.format(
                        "Failed to link %d with %d via %s exit for some reason :/", num, id, exit
                      )
                  end
                end
              end
            end
          else
            local function getshiftedcoords(direction, ox, oy, oz)
              if direction == 'n' then
                return ox, oy + 1, oz
              elseif direction == 'e' then
                return ox + 1, oy, oz
              elseif direction == 's' then
                return ox, oy - 1, oz
              elseif direction == 'w' then
                return ox - 1, oy, oz
              elseif direction == 'ne' then
                return ox + 1, oy + 1, oz
              elseif direction == 'se' then
                return ox + 1, oy - 1, oz
              elseif direction == 'sw' then
                return ox - 1, oy - 1, oz
              elseif direction == 'nw' then
                return ox - 1, oy + 1, oz
              else
                error("getshiftedcoords: direction " .. direction .. " isn't supported yet.")
              end
            end

            local x, y, z = getRoomCoordinates(num)
            local currentexits = getRoomExits(num) or {}
            for _, exit in ipairs({'n', 'e', 's', 'w', 'ne', 'se', 'sw', 'nw'}) do
              local roomatdir =
                getRoomsByPosition(getRoomArea(num), getshiftedcoords(exit, x, y, z))
              if roomatdir[0] then
                local id = roomatdir[0]
                if not currentexits[mmp.anytolong(exit)] then
                  if setExit(num, id, exit) then
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      "Added missing exit " ..
                      exit ..
                      " to " ..
                      (getRoomName(id) ~= "" and getRoomName(id) or "''") ..
                      " (" ..
                      id ..
                      ")."
                  else
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      string.format(
                        "Failed to link %d with %d via %s exit for some reason :/", num, id, exit
                      )
                  end
                  local exit = mmp.anytoshort(mmp.ranytolong(exit))
                  if setExit(id, num, exit) then
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      "Added missing exit " ..
                      exit ..
                      " to " ..
                      (getRoomName(id) ~= "" and getRoomName(id) or "''") ..
                      " (" ..
                      id ..
                      ")."
                  else
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      string.format(
                        "Failed to link %d with %d via %s exit for some reason :/", num, id, exit
                      )
                  end
                end
              end
            end
          end
          -- check for unexisting exits
          if mmp.settings["autoclear"] then
            for exit, id in pairs(getRoomExits(num)) do
              if not currentexits[mmp.anytoshort(exit)] then
                setExit(num, -1, exit)
                s =
                  s ..
                  (#s &gt; 0 and " " or "") ..
                  exit ..
                  " exit to " ..
                  id ..
                  " doesn't actually exist, removed it."
              end
            end
          end
          -- check for environment update, if we have environments mapped out
          if
            mmp.envids[gmcp.Room.Info.environment] and
            mmp.envids[gmcp.Room.Info.environment] ~= getRoomEnv(num)
          then
            setRoomEnv(num, mmp.envids[gmcp.Room.Info.environment])
            s =
              s ..
              (#s &gt; 0 and " " or "") ..
              "Updated environment name to " ..
              gmcp.Room.Info.environment ..
              "."
          end
          -- check indoors status
          local indoors = table.contains(gmcp.Room.Info.details, "indoors")
          if indoors and getRoomUserData(num, "indoors") == '' then
            setRoomUserData(num, "indoors", "y")
            s = s .. (#s &gt; 0 and " " or "") .. "Updated room to be indoors."
          elseif not indoors and getRoomUserData(num, "indoors") ~= '' then
            setRoomUserData(num, "indoors", "")
            s = s .. (#s &gt; 0 and " " or "") .. "Updated room to be outdoors."
          end
          -- check server area name (Achaea only for now)
          if mmp.game == "achaea" then
            local serverArea = gmcp.Room.Info.area
            if serverArea ~= getRoomUserData(num, "Game Area") then
              setRoomUserData(num, "Game Area", serverArea)
              s = s .. (#s &gt; 0 and " " or "") .. "Updated game area to " .. serverArea .. "."
            end
          end
          -- check for wilderness exits
          if getRoomChar(num) ~= "W" and table.contains(gmcp.Room.Info.details, "wilderness") then
            setRoomChar(num, "W")
            s = s .. (#s &gt; 0 and " " or "") .. "Added the wilderness mark."
          end
        end
        if #s &gt; 0 then
          mmp.echo(s)
          centerview(mmp.currentroom)
        end
      end,
      function(error)
        mmp.echo("Oops! Has a small problem (" .. error .. ").")
        echo("  ")
        echoLink(
          "view steps",
          'echo[[' .. debug.traceback() .. ']]',
          "View steps of code that led up to it"
        )
      end
    )
  if not s then
    mmp.echo(m)
  end
end</script>
							<eventHandlerList>
								<string>gmcp.Room.Info</string>
								<string>RoomNum</string>
							</eventHandlerList>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>mmp_save_options</name>
							<packageName></packageName>
							<script>function mmp_save_options()
	local saveTable = {
		locked_areas = mmp.locked,
		options = mmp.settings:getAllOptions()
	}

	if string.char(getMudletHomeDir():byte()) == "/" then _sep = "/" else  _sep = "\\" end
	local saveFile = getMudletHomeDir() ..  _sep .. "mapper.options.lua"

	table.save(saveFile, saveTable)
end</script>
							<eventHandlerList>
								<string>sysExitEvent</string>
							</eventHandlerList>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>mmp_load_options</name>
							<packageName></packageName>
							<script>function mmp_load_options()
	local loadTable = mmp_load_locks()

	if loadTable.options then
		for k, v in pairs(loadTable.options) do
			mmp.settings:setOption(k, v, true)
		end
	end
end

function mmp_load_locks()
	local loadTable = {}

	if string.char(getMudletHomeDir():byte()) == "/" then _sep = "/" else  _sep = "\\" end
	local loadFile = getMudletHomeDir() ..  _sep .. "mapper.options.lua"

    if io.exists(loadFile) then table.load(loadFile, loadTable) end

	if loadTable.locked_areas then
		mmp.locked = loadTable.locked_areas
	end

    local lockRoom, getAreaRooms = lockRoom, getAreaRooms
	for area in pairs(mmp.locked) do
		local rooms = getAreaRooms(area)
		for _, roomid in pairs(rooms or {}) do
			lockRoom(roomid, true)
		end
	end

	return loadTable
end</script>
							<eventHandlerList>
								<string>sysLoadEvent</string>
							</eventHandlerList>
						</Script>
					</ScriptGroup>
					<ScriptGroup isActive="yes" isFolder="yes">
						<name>Game-specific</name>
						<packageName></packageName>
						<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
						<eventHandlerList />
						<Script isActive="yes" isFolder="no">
							<name>Achaea</name>
							<packageName></packageName>
							<script></script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>register_achaeas_envdata</name>
								<packageName></packageName>
								<script>function register_achaeas_envdata(_, game)
  if game ~= "Achaea" then
    return
  end
  mmp.envids =
    {
      ["Constructed underground"] = 2,
      ["Crimson Sea"] = 45,
      ["Deep Ocean"] = 24,
      ["Deep Ocean floor"] = 30,
      ["Dwarven city"] = 18,
      ["Lava Fields"] = 39,
      ["Magma Caves"] = 31,
      ["Natural underground"] = 3,
      ["Ocean floor"] = 34,
      ["Planar Highway"] = 42,
      ["Sanguine River"] = 44,
      ["Tsol'aa city"] = 19,
      ["Vast Ocean"] = 40,
      Abstract = 37,
      Agrarian = 48,
      Ausafoss = 47,
      Beach = 5,
      Blighted = 29,
      Catacombs = 14,
      Chaos = 38,
      Desert = 6,
      Earthen = 43,
      Flames = 49,
      Forest = 4,
      Freshwater = 22,
      Garden = 21,
      Grasslands = 7,
      Hills = 9,
      Jungle = 17,
      Mountains = 14,
      Nothing = 0,
      Ocean = 20,
      Path = 11,
      Polar = 27,
      Reef = 25,
      River = 10,
      Road = 12,
      Ruins = 32,
      Sewer = 23,
      Skies = 10,
      Storm = 50,
      Swamp = 15,
      Trees = 28,
      Tundra = 16,
      Urban = 8,
      Valley = 13,
      Vessel = 36,
      Viscera = 46,
      Wastelands = 41,
      Water = 30,
    }
  mmp.waterenvs = {}
  local waterids =
    {"Freshwater", "Ocean", "River", "Deep Ocean", "Water", "Reef", "Ocean floor", "Vast Ocean"}
  for i = 1, #waterids do
    mmp.waterenvs[mmp.envids[waterids[i]]] = true
  end
  mmp.envidsr = {}
  for name, id in pairs(mmp.envids) do
    mmp.envidsr[id] = name
  end
end</script>
								<eventHandlerList>
									<string>mmp logged in</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmapper_achaea_went_outside</name>
								<packageName></packageName>
								<script>-- track whenever we need to use wings or aero soar when we get outside!
function mmapper_achaea_went_outside()
  if not mmp.autowalking or not (mmp.settings.duanathar or mmp.settings.duanatharan or mmp.settings.duantahar or mmp.settings.duanatharic or mmp.settings.soar) or mmp.game ~= "achaea" or
    (mmp.currentroom == mmp.speedWalkPath[#mmp.speedWalkPath]) or
    table.contains(gmcp.Room.Info.details, "indoors")
  then return end

  -- repath, maybe that'll allow us to use wings now.
  raiseEvent("mmp link externals")
	local previousDirection = mmp.speedWalkDir[speedWalkCounter]
	if mmp.speedWalk.type == "room" then
	  mmp.getPath(mmp.currentroom, mmp.speedWalkPath[#mmp.speedWalkPath]) -- don't need to check return value since that fact shouldnt've changed
	else
		mmp.gotoAreaID(getRoomArea(mmp.speedWalkPath[#mmp.speedWalkPath]))
	end

  -- if our path didn't change, re-instate it as it was (since the new path starts from this room that we checked at)
  if speedWalkDir[1]~=previousDirection then
    speedWalkCounter = 0
    mmp.echo("We got outside - going to shortcut with wings.")
		if mmp.speedWalk.type == "room" then
			mmp.gotoRoom(mmp.speedWalkPath[#mmp.speedWalkPath])
		else
			mmp.gotoAreaID(getRoomArea(mmp.speedWalkPath[#mmp.speedWalkPath]))
		end
    mmp.ignore_speedwalking = true
  end
	raiseEvent("mmp clear externals")
end</script>
								<eventHandlerList>
									<string>mmapper went outside</string>
									<string>mmapper changed continent</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>achaea_gaia_whirlpool_reset</name>
								<packageName></packageName>
								<script>function achaea_gaia_whirlpool_reset(event, game)
	if game == "Achaea" then
		mmp.whirlString = 'script: send("enter whirlpool") if tempWhirlTrigger then killTrigger(tempWhirlTrigger) tempWhirlTrigger = nil end if tempWhirlTimer then killTimer(killWhirlTimer) tempWhirlTimer = nil end tempWhirlTrigger = tempTrigger("What do you wish to enter?", [[if tempWhirlTimer then killTimer(tempWhirlTimer) tempWhirlTimer = nil end mmp.echo("Whirlpool not found here. Trying another room.") local x = {45817, 45780, 45903, 45868, 46254, 45866} if tempWhirlTrigger then killTrigger(tempWhirlTrigger) tempWhirlTrigger = nil end clearSpecialExits(]]..mmp.currentroom..[[) local y = table.index_of(x, ]]..mmp.currentroom..[[) + 1 if y &gt; #x then y = 1 end addSpecialExit(x[y], 793, mmp.whirlString) mmp.clearpathcache() mmp.gotoRoom(mmp.speedWalkPath[#mmp.speedWalkPath]) mmp.echo("Moved whirlpool to "..x[y]..".")]]) tempWhirlTimer = tempTimer(1, [[if tempWhirlTrigger then killTrigger(tempWhirlTrigger) tempWhirlTrigger = nil end if tempWhirlTimer then killTimer(tempWhirlTimer) tempWhirlTimer = nil end]])'
		local x = {45817, 45780, 45903, 45868, 46254, 45866}
		for i, v in ipairs(x) do clearSpecialExits(v) end
		addSpecialExit(45868, 793, mmp.whirlString)
	end
end</script>
								<eventHandlerList>
									<string>mmp logged in</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmapper_achaea_went_outside_harness</name>
								<packageName></packageName>
								<script>-- use Stratospheric Harness in Achaea -- PapaGuacamole
	
function mmapper_achaea_went_outside_harness()

	local area = mmp.getAreaName(mmp.currentroom)
	local areaid = getRoomArea(mmp.currentroom)
  if not mmp.autowalking or not mmp.settings.harness or not (mmp.game == "achaea") or
    (mmp.currentroom == mmp.speedWalkPath[#mmp.speedWalkPath]) or
    table.contains(gmcp.Room.Info.details, "indoors") or
    (not mmp.oncontinent(areaid, "Eastern_Isles") and not mmp.oncontinent(areaid, "Northern_Isles") and not mmp.oncontinent(areaid, "Western_Isles"))
		then return end

	local madeEast, madeNorth, madeWest

 	-- eastern isles
 	if mmp.oncontinent(areaid, "Eastern_Isles") then
 		addSpecialExit(mmp.currentroom, 54231, [[script:send("shake harness")]])
 		mmp.clearpathcache() -- clear cache so mmp.getPath accounts for the new way
 		madeEast = true
 	-- northern isles
 	elseif mmp.oncontinent(areaid, "Northern_Isles") then
 		addSpecialExit(mmp.currentroom, 48719, [[script:send("shake harness")]])
 		mmp.clearpathcache() -- clear cache so mmp.getPath accounts for the new way
 		madeNorth = true
 	-- western isles
 	elseif mmp.oncontinent(areaid, "Western_Isles") then
 		addSpecialExit(mmp.currentroom, 54632, [[script:send("shake harness")]])
 		mmp.clearpathcache() -- clear cache so mmp.getPath accounts for the new way
 		madeWest = true
 	end

	mmp.getPath(mmp.currentroom, mmp.speedWalkPath[#mmp.speedWalkPath]) -- don't need to check return value since that fact shouldnt've changed
	-- if our path didn't change, re-instate it as it was (since the new path starts from this room that we checked at)
	if speedWalkDir[1]:find("harness", 1, true) then
	speedWalkCounter = 0
		mmp.echo("We got outside - going to shortcut with harness.")
		if mmp.speedWalk.type == "room" then
			mmp.gotoRoom(mmp.speedWalkPath[#mmp.speedWalkPath])
		else
			mmp.gotoAreaID(getRoomArea(mmp.speedWalkPath[#mmp.speedWalkPath]))
		end
		mmp.ignore_speedwalking = true
 	end
	
  if madeEast then mmp.clearspecials{54231}
  elseif madeNorth then mmp.clearspecials{48719}
  elseif madeWest then mmp.clearspecials{54632} end

end</script>
								<eventHandlerList>
									<string>mmapper went outside</string>
									<string>mmapper changed continent</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Shackle handling</name>
								<packageName></packageName>
								<script>local density = false
--Wear shackle function

function mmp.WearShackle()
  if mmp.settings.shackle and density then
    send("wear shackle")
  end
end

function mmp.UnwearShackle()
  if mmp.settings.shackle and mmp.defs.current.density then
    density = true
    send("remove shackle")
  elseif not mmp.defs.current.density then
    density = false
  end
end

--Event Handlers
registerAnonymousEventHandler("mmapper failed path", "mmp.WearShackle")
registerAnonymousEventHandler("mmapper stopped", "mmp.WearShackle")
registerAnonymousEventHandler("mmapper arrived", "mmp.WearShackle")
registerAnonymousEventHandler("started speedwalk", "mmp.UnwearShackle")</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmapper_achaea_orb_of_confinement</name>
								<packageName></packageName>
								<script>function mmp.setOrb(city)
  mmp.clearpathcache()
  if mmp.settings["orb"..city:lower()] then
    mmp.echo("Orb of Confinement set as &lt;green&gt;ACTIVE&lt;reset&gt; for " .. city:title())
  else
    mmp.echo("Orb of Confinement set as &lt;red&gt;INACTIVE&lt;reset&gt; for " .. city:title())
  end
end

function mmapper_achaea_orb_of_confinement()

  if
    not mmp.autowalking or
    not (
      mmp.settings.duanathar or
      mmp.settings.duanatharan or
      mmp.settings.duantahar or
      mmp.settings.duanatharic or
      mmp.settings.soar
    ) or
    not (mmp.game == "achaea") or
    (mmp.currentroom == mmp.speedWalkPath[#mmp.speedWalkPath]) or
    table.contains(gmcp.Room.Info.details, "indoors") or
    not mmp.orbed()
  then
    return
  end
  -- repath, just in case we were going to use wings here
  raiseEvent("mmp link externals")
  local previousDirection = mmp.speedWalkDir[speedWalkCounter+1]
  if mmp.speedWalk.type == "room" then
    mmp.getPath(mmp.currentroom, mmp.speedWalkPath[#mmp.speedWalkPath])
    -- don't need to check return value since that fact shouldnt've changed
  else
    mmp.gotoAreaID(getRoomArea(mmp.speedWalkPath[#mmp.speedWalkPath]))
  end
  -- if our path didn't change, re-instate it as it was (since the new path starts from this room that we checked at)
  if speedWalkDir[1] ~= previousDirection then
    speedWalkCounter = 0
    mmp.echo("We're inside, remapping path to not use wings here.")
    if mmp.speedWalk.type == "room" then
      mmp.gotoRoom(mmp.speedWalkPath[#mmp.speedWalkPath])
    else
      mmp.gotoAreaID(getRoomArea(mmp.speedWalkPath[#mmp.speedWalkPath]))
    end
    mmp.ignore_speedwalking = true
  end
  raiseEvent("mmp clear externals")
end</script>
								<eventHandlerList>
									<string>mmapper went inside</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmapper_achaea_harness_add_exits</name>
								<packageName></packageName>
								<script>function mmapper_achaea_harness_add_exits()
  if not (mmp.game == "achaea" and mmp.settings.harness) then
    return
  end
	local cmd = [[script:send("shake harness",false)]]
  local areaID = getRoomArea(mmp.currentroom) or 0
  if mmp.oncontinent(areaID, "Eastern_Isles") then
    if not mmp.inside then
      -- make it here
      addSpecialExit(mmp.currentroom, 54231, cmd)
    elseif areaID == 192 then
      -- Zanzibaar
      addSpecialExit(31215, 54231, cmd)
    elseif areaID == 191 then
      -- Clockwork Isle
      addSpecialExit(23351, 54231, cmd)
    elseif areaID == 180 then
      -- Colchis, the Isle of
      addSpecialExit(19786, 54231, cmd)
    else
      --if areaID == 181 then -- Umbrin, the Port of
      addSpecialExit(18443, 54231, cmd)
    end
    --madeEast = true
  elseif mmp.oncontinent(areaID, "Northern_Isles") then
    if not mmp.inside then
      -- make it here
      addSpecialExit(mmp.currentroom, 48719, cmd)
    elseif areaID == 194 then
      -- Ilyrean
      addSpecialExit(13373, 48719, cmd)
    elseif areaID == 351 then
      -- Karbaz
      addSpecialExit(19740, 48719, cmd)
    else
      --if areaID == 206 or getRoomArea(mmp.currentroom) = 294 then -- Suliel Island / Suliel Island (Barricades)
      addSpecialExit(17768, 48719, cmd)
    end
  elseif mmp.oncontinent(areaID, "Western_Isles") then
    if not mmp.inside then
      -- make it here
      addSpecialExit(mmp.currentroom, 54632, cmd)
    elseif areaID == 162 then
      --Tapoa
      addSpecialExit(21184, 54632, cmd)
    elseif areaID == 207 then
      --Tuar
      addSpecialExit(19219, 54632, cmd)
    else
      --if areaID == 209 then --Ageiro
      addSpecialExit(30222, 54632, cmd)
    end
  end
end</script>
								<eventHandlerList>
									<string>mmp link externals</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmapper_achaea_harness_remove_exits</name>
								<packageName></packageName>
								<script>function mmapper_achaea_harness_remove_exits()
  local areaID = getRoomArea(mmp.currentroom) or 0
  if not (mmp.game == "achaea" and mmp.settings.harness) then
    return
  end
  if mmp.oncontinent(areaID, "Eastern_Isles") then
    mmp.clearspecials({54231})
  elseif mmp.oncontinent(areaID, "Northern_Isles") then
    mmp.clearspecials({48719})
  elseif mmp.oncontinent(areaID, "Western_Isles") then
    mmp.clearspecials({54632})
  end
end</script>
								<eventHandlerList>
									<string>mmp clear externals</string>
								</eventHandlerList>
							</Script>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Aetolia</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>register_aetolias_envdata</name>
								<packageName></packageName>
								<script>function register_aetolias_envdata(_, game)
  if game ~= "Aetolia" then return end

  mmp.envids =
  {
    ["a bridge"]                = 55,
    ["Airship wreckage"]        = 62,
    ["camp site"]               = 57,
    ["Constructed underground"] = 2,
    ["Deep ocean"]              = 24,
    ["lifeless sands"]          = 54,
    ["logged forest"]           = 56,
    ["Natural underground"]     = 3,
    ["Tsol'aa city"]            = 19,
    ["Underwater city"]         = 28,
    ["within a tree"]           = 36,
    Beach                       = 5,
    Canyon                      = 34,
    Castle                      = 61,
    Cavern                      = 69,
    Chaos                       = 1,
    Crater                      = 37,
    Desert                      = 6,
    Ethereal                    = 67,
    Forest                      = 4,
    Freshwater                  = 22,
    Garden                      = 21,
    Grasslands                  = 7,
    Graveyard                   = 31,
    grotto                      = 70,
    Hills                       = 9,
    Ice                         = 30,
    Jungle                      = 17,
    lava                        = 39,
    Mines                       = 32,
    Mountains                   = 14,
    Ocean                       = 20,
    Onboard                     = 33,
    Path                        = 11,
    Reef                        = 25,
    River                       = 10,
    Road                        = 12,
    Ruins                       = 26,
    Sewer                       = 23,
    Shadows                     = 58,
    Swamp                       = 15,
    Temple                      = 29,
    Tundra                      = 16,
    Urban                       = 8,
    Valley                      = 13,
    Village                     = 27,
  }

  mmp.waterenvs = {}
  local waterids = { "River", "Freshwater", "Deep ocean", "Reef", "Underwater city" }
  for i = 1, #waterids do mmp.waterenvs[mmp.envids[waterids[i]]] = true end

  mmp.envidsr = {};
  for name, id in pairs(mmp.envids) do mmp.envidsr[id] = name end
end</script>
								<eventHandlerList>
									<string>mmp logged in</string>
								</eventHandlerList>
							</Script>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Lusternia</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>register_lusternias_envdata</name>
								<packageName></packageName>
								<script>function register_lusternias_envdata(_, game)
  if game ~= "Lusternia" then return end

  mmp.envids =
  {
    ["constructed underground"] = 2,
    ["deep ocean"]              = 24,
    ["natural underground"]     = 3,
    aether                      = 36,
    astral                      = 35,
    beach                       = 5,
    chaos                       = 39,
    clouds                      = 37,
    concordance                 = 38,
    darkness                    = 1,
    desert                      = 6,
    divine                      = 33,
    farmlands                   = 30,
    flesh                       = 18,
    forest                      = 4,
    freshwater                  = 22,
    garden                      = 21,
    grasslands                  = 7,
    hills                       = 9,
    jungle                      = 17,
    mountains                   = 14,
    netherworld                 = 34,
    ocean                       = 20,
    path                        = 11,
    polar                       = 27,
    reef                        = 25,
    river                       = 10,
    road                        = 12,
    ruins                       = 19,
    sewer                       = 23,
    swamp                       = 15,
    trees                       = 28,
    tundra                      = 16,
    urban                       = 8,
    valley                      = 13,
    volcanic                    = 32,
    wasteland                   = 29,
  }

  mmp.waterenvs = {}
  local waterids = { "river", "ocean", "freshwater", "deep ocean" }
  for i = 1, #waterids do mmp.waterenvs[mmp.envids[waterids[i]]] = true end

  mmp.envidsr = {};
  for name, id in pairs(mmp.envids) do mmp.envidsr[id] = name end
end</script>
								<eventHandlerList>
									<string>mmp logged in</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmapper_lusternia_went_outside</name>
								<packageName></packageName>
								<script>function mmapper_lusternia_went_outside()
  -- track whenever we need to use items when we get outside!
  if
    not mmp.autowalking or
    mmp.game ~= "lusternia" or
    (mmp.currentroom == mmp.speedWalkPath[#mmp.speedWalkPath])
  then
    return
  end
  -- repath, maybe that'll allow us to use wings now.
  raiseEvent("mmp link externals")
	local previousDirection = mmp.speedWalkDir[speedWalkCounter]
  mmp.getPath(mmp.currentroom, mmp.speedWalkPath[#mmp.speedWalkPath])
  -- don't need to check return value since that fact shouldnt've changed
  -- if our path didn't change, re-instate it as it was (since the new path starts from this room that we checked at)
  if
    speedWalkDir[1]~=previousDirection
  then
    speedWalkCounter = 0
    mmp.echo("We got outside - going to shortcut with 'bix device.")
		if mmp.speedWalk.type == "room" then
			mmp.gotoRoom(mmp.speedWalkPath[#mmp.speedWalkPath])
		else
			mmp.gotoAreaID(getRoomArea(mmp.speedWalkPath[#mmp.speedWalkPath]))
		end
    mmp.ignore_speedwalking = true
  end
  raiseEvent("mmp clear externals")
end</script>
								<eventHandlerList>
									<string>mmapper went outside</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Astral utilities</name>
								<packageName></packageName>
								<script>local astralExits = {
	{5079,5175,"n"},
	{4072,5065,"w"},
	{5088, 5132, "e"},
	{5145, 5176, "s"},
	{5138, 5146, "e"},
	{5158, 5192, "s"},
	{5152, 5041, "e"},
	{5031, 5042, "e"},
	{5022, 5131, "n"},
	{5116, 5198, "w"},
	{5130, 5096, "e"},
	{5089, 5058, "n"},
	{5102, 5115, "e"},
	{5111, 5159, "e"},	
	{5103, 5071, "n"},
	{5059, 5053, "w"},
	{5187, 5169, "w"},
	{5190, 5204, "e"},
	{5065,5072,"e"},
}
local mirrorExits = {
	n="s",
	ne="sw",
	e="w",
	se="nw",
	s="n",
	sw="ne",
	w="e",
	nw="se",
	u="d",
	d="u",
	out="in",
	["in"]="out",
}
function mmp.astroboots(create)
	if mmp.game ~= "lusternia" then return end
	for k, v in pairs(astralExits) do
		if create then
			addSpecialExit(v[1],v[2],"astrojump")
			setExitWeight(v[1],"astrojump",5)
			addSpecialExit(v[2],v[1],"astrojump")
			setExitWeight(v[2],"astrojump",5)
		else
			removeSpecialExit(v[1],"astrojump")
			removeSpecialExit(v[2],"astrojump")
		end
	end
end

function mmp.wildnodes(create)
	if mmp.game ~= "lusternia" then return end
	for k, v in pairs(astralExits) do
		if create then
			setExit(v[1],v[2],v[3])
			setExit(v[2],v[1],mirrorExits[v[3]])
		else
			setExit(v[1],-1,v[3])
			setExit(v[2],-1,mirrorExits[v[3]])
		end
	end
end</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Transverse and pathfind</name>
								<packageName></packageName>
								<script>local planes =
  {
    ["the Prime Material Plane"] = "prime",
    ["the Ethereal Plane"] = "ethereal",
    ["the Water Elemental Plane"] = "elemental",
    ["the Earth Elemental Plane"] = "elemental",
    ["the Air Elemental Plane"] = "elemental",
    ["the Fire Elemental Plane"] = "elemental",
    ["Celestia, Plane of Light"] = "cosmic",
    ["the Cosmic Plane of Vortex"] = "cosmic",
    ["the Cosmic Plane of Continuum"] = "cosmic",
    ["the Tainted Plane of Nil"] = "cosmic",
    ["the Astral Plane"] = "astral",
  }

function mmp.transverse(_, command)
  command = command:lower()
  if command:sub(0, 11) == "transverse " or command == "pathfind" then
    transverseCMD = command
    transversedFrom = gmcp.Room.Info.num
    lastPlane = planes[gmcp.Room.Info.details[1]]
    validTransverse = true
  end
end

registerAnonymousEventHandler("sysDataSendRequest", "mmp.transverse")

function mmp.registerTransverseExit()
  if transversedFrom ~= gmcp.Room.Info.num then
    addSpecialExit(transversedFrom, gmcp.Room.Info.num, transverseCMD)
    setExitWeight(transversedFrom, transverseCMD, 20)
    if lastPlane then
      addSpecialExit(gmcp.Room.Info.num, transversedFrom, "transverse " .. lastPlane)
      setExitWeight(gmcp.Room.Info.num, "transverse " .. lastPlane, 20)
    end
    validTransverse = false
  end
end

function mmp.clearTransverse()
  local otherSide = 0
  for room, command in pairs(getSpecialExits(gmcp.Room.Info.num)) do
    if next(command) == transverseCMD then
      otherSide = room
    end
  end
  for room, command in pairs(getSpecialExits(otherSide) or {}) do
    if room == gmcp.Room.Info.num and string.sub(next(command), 0, 11) == "transverse " then
      removeSpecialExit(otherSide, next(command))
    end
  end
  removeSpecialExit(gmcp.Room.Info.num, transverseCMD)
  if mmp.autowalking then
    mmp.autowalking = false
    mmp.gotoRoom(string.split(next(mmp.showpathcache()), "_")[2])
  end
end

function mmp.registerPathfind()
  addSpecialExit(transversedFrom, gmcp.Room.Info.num, "pathfind")
  setExitWeight(transversedFrom, "pathfind", 15)
  addSpecialExit(gmcp.Room.Info.num, transversedFrom, "pathfind")
  setExitWeight(gmcp.Room.Info.num, "pathfind", 15)
  validTransverse = false
end

function mmp.clearPathfind()
  local otherSide = 0
  for room, command in pairs(getSpecialExits(gmcp.Room.Info.num)) do
    if next(command) == "pathfind" then
      otherSide = room
    end
  end
  for room, command in pairs(getSpecialExits(otherSide) or {}) do
    if room == gmcp.Room.Info.num and next(command) == "pathfind" then
      removeSpecialExit(otherSide, next(command))
    end
  end
  removeSpecialExit(gmcp.Room.Info.num, "pathfind")
  if mmp.autowalking then
    mmp.autowalking = false
    mmp.gotoRoom(string.split(next(mmp.showpathcache()), "_")[2])
  end
end

function mmp.lockpaths(lock)
  local count = 0
  for area, areaname in pairs(mmp.areatabler) do
    local rooms = getAreaRooms(area) or {}
    for i = 0, #rooms do
      local exits = getSpecialExits(rooms[i] or 0)
      for room, command in pairs(exits or {}) do
        if next(command) == "pathfind" then
          count = count + 1
          lockSpecialExit(rooms[i], room, "pathfind", lock)
        end
      end
    end
  end
  mmp.echo((lock and "Locked " or "Unlocked ") .. count .. " pathfinding exits.")
end</script>
								<eventHandlerList />
							</Script>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Imperian</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>register_imperians_envdata</name>
								<packageName></packageName>
								<script>function register_imperians_envdata(_, game)
  if game ~= "Imperian" then return end
  mmp.envids =
  {
    ["a sheltered dell"]        = 68,
    ["Arcane Temple"]           = 66,
    ["Blackened Lands"]         = 58,
    ["Blackstone Dungeon"]      = 65,
    ["Blackstone Keep"]         = 62,
    ["Constructed underground"] = 2,
    ["Dark Forest"]             = 1,
    ["Deep Ocean"]              = 24,
    ["Desert Ruins"]            = 38,
    ["Dwarven city"]            = 18,
    ["Forestal Council"]        = 44,
    ["Frozen Bog"]              = 76,
    ["Lake of Fire"]            = 56,
    ["Natural underground"]     = 3,
    ["Noble Bar"]               = 53,
    ["Noble Chambers"]          = 51,
    ["Rocky Shore"]             = 77,
    ["Sylayan city"]            = 19,
    ["Tainted Underground"]     = 35,
    ["Tainted Water"]           = 39,
    ["Underground Lake"]        = 36,
    ["Vast Ocean"]              = 26,
    ["Wetlands Village"]        = 64,
    ["within a tent"]           = 69,
    Academia                    = 42,
    Acropolis                   = 33,
    Beach                       = 5,
    Blighted                    = 74,
    bog                         = 73,
    Catacombs                   = 63,
    Church                      = 54,
    Cliffs                      = 67,
    Crags                       = 32,
    Desert                      = 6,
    Docks                       = 30,
    Farmland                    = 41,
    Forest                      = 4,
    Freshwater                  = 22,
    Garden                      = 21,
    garrison                    = 71,
    Grasslands                  = 7,
    Graveyard                   = 46,
    Hills                       = 9,
    Jungle                      = 17,
    Mountains                   = 14,
    Nobility                    = 50,
    Ocean                       = 20,
    Path                        = 11,
    Polar                       = 27,
    Pond                        = 49,
    pyramid                     = 72,
    quarry                      = 70,
    River                       = 10,
    Road                        = 12,
    Ruins                       = 37,
    Scrublands                  = 78,
    Sewer                       = 23,
    Swamp                       = 15,
    Temple                      = 57,
    Tower                       = 79,
    transportation              = 48,
    Tundra                      = 16,
    Underworld                  = 28,
    Urban                       = 8,
    Valley                      = 13,
    Villa                       = 75,
    Village                     = 47,
    Village                     = 55,
    Volcano                     = 59,
    Warrens                     = 31,
  }

  mmp.waterenvs = {}
  local waterids = { "River", "Ocean", "Deep Ocean", "Vast Ocean", "Underground Lake", "Tainted Water", "Lake of Fire" }
  for i = 1, #waterids do mmp.waterenvs[mmp.envids[waterids[i]]] = true end

  mmp.envidsr = {};
  for name, id in pairs(mmp.envids) do mmp.envidsr[id] = name end
end</script>
								<eventHandlerList>
									<string>mmp logged in</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmapper_imperian_went_outside</name>
								<packageName></packageName>
								<script>function mmapper_imperian_went_outside()
  if
    not mmp.autowalking or
    not (mmp.settings.shekinah or mmp.settings.suriel) or
    mmp.game ~= "imperian" or
    (mmp.currentroom == mmp.speedWalkPath[#mmp.speedWalkPath]) or
    table.contains(gmcp.Room.Info.details, "indoors") or
    table.contains(gmcp.Room.Info.details, "considered indoors") or
    not table.contains(mmp.imperian.wingAbleAreas, getRoomArea(mmp.currentroom))
  then
    return
  end
  -- repath, maybe that'll allow us to use wings now.
  raiseEvent("mmp link externals")
  local previousDirection = mmp.speedWalkDir[speedWalkCounter]
  mmp.getPath(mmp.currentroom, mmp.speedWalkPath[#mmp.speedWalkPath])
  -- don't need to check return value since that fact shouldnt've changed
  -- if our path didn't change, re-instate it as it was (since the new path starts from this room that we checked at)
  if speedWalkDir[1] ~= previousDirection then
    speedWalkCounter = 0
    mmp.echo("We got outside - going to shortcut with wings.")
    mmp.gotoRoom(mmp.speedWalkPath[#mmp.speedWalkPath])
    mmp.ignore_speedwalking = true
  end
  raiseEvent("mmp clear externals")
end</script>
								<eventHandlerList>
									<string>mmapper went outside</string>
									<string>mmapper changed continent</string>
								</eventHandlerList>
							</Script>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Starmourn</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>Lifts</name>
								<packageName></packageName>
								<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function mmp.liftFloor(roomname,floornum,currentfloor) --string,int,bool
	if not mmp.autowalking then
		return
	end

	--get room name of next in speedwalkpath
	if not speedWalkCounter then
    speedWalkCounter = 1
  end
	local destRoomName = getRoomName(mmp.speedWalkPath[speedWalkCounter])
	if roomname == nil then roomname = destRoomName end

	if roomname == destRoomName then
		if currentfloor then
			send("EXIT LIFT",false) --Lift is on correct floor, can EXIT LIFT
			if mmp.liftTimer then killTimer(mmp.liftTimer) end
		else
			mmp.customwalkdelay(2) --Lift is on incorrect floor arbitrary wait for next trigger line
			if mmp.liftTimer then killTimer(mmp.liftTimer) end
			mmp.liftTimer = tempTimer(1, function() send("KEY LIFT ".. floornum,false) end )	--wait one second before requesting the correct floor (allows other users to enter/exit)
		end
	end
end</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>register_starmourn_envdata</name>
								<packageName></packageName>
								<script>function register_starmourn_envdata(_, game)
  if game ~= "Starmourn" then
    return
  end
  mmp.envids =
    {
      ["airlock"] = 55,
      ["alleyway"] = 47,
      ["armory"] = 82,
      ["badlands"] = 45,
      ["barracks"] = 77,
      ["bathroom"] = 71,
      ["beach"] = 51,
      ["bedroom"] = 66,
      ["bridge"] = 18,
      ["building"] = 5,
      ["campsite"] = 65,
      ["canal"] = 85,
      ["cantina"] = 62,
      ["canyon"] = 31,
      ["cargo bay"] = 13,
      ["catwalk"] = 23,
      ["cave"] = 37,
      ["commandpost"] = 80,
      ["corral"] = 34,
      ["deep space"] = 11,
      ["desert"] = 7,
      ["duct"] = 22,
      ["engine room"] = 44,
      ["factory"] = 32,
      ["farmland"] = 28,
      ["firingrange"] = 83,
      ["forest"] = 8,
      ["garden"] = 12,
      ["gym"] = 60,
      ["hallway"] = 58,
      ["hangar"] = 26,
      ["hangar"] = 79,
      ["hydroponics"] = 61,
      ["icyforest"] = 52,
      ["jungle"] = 19,
      ["junkyard"] = 48,
      ["lake"] = 49,
      ["lava fields"] = 56,
      ["lava"] = 57,
      ["meadow"] = 30,
      ["medical facility"] = 17,
      ["medical facility"] = 27,
      ["messhall"] = 78,
      ["militarybase"] = 76,
      ["militaryroad"] = 81,
      ["mine"] = 3,
      ["mountain"] = 1,
      ["obstaclecourse"] = 84,
      ["ocean"] = 6,
      ["office"] = 15,
      ["pier/dock"] = 38,
      ["pond"] = 64,
      ["pool"] = 14,
      ["prison"] = 59,
      ["residence"] = 63,
      ["river"] = 50,
      ["road"] = 29,
      ["ruin"] = 42,
      ["sewer"] = 40,
      ["shop"] = 67,
      ["slum"] = 69,
      ["slumbuilding"] = 73,
      ["slumstreet"] = 70,
      ["slumtoilet"] = 72,
      ["spacecraft"] = 9,
      ["spaceport"] = 39,
      ["stateroom"] = 43,
      ["stream"] = 35,
      ["street"] = 2,
      ["swamp"] = 20,
      ["temple"] = 54,
      ["transport"] = 16,
      ["treehouse"] = 36,
      ["treetops"] = 53,
      ["tundra"] = 10,
      ["underground"] = 86,
      ["underwater"] = 87,
      ["urban"] = 4,
      ["urbanunderground"] = 46,
      ["ventilation shaft"] = 21,
      ["verdantcliffs"] = 75,
    }
  mmp.waterenvs = {}
  mmp.envidsr = {}
  for name, id in pairs(mmp.envids) do
    mmp.envidsr[id] = name
  end
end</script>
								<eventHandlerList>
									<string>mmp logged in</string>
								</eventHandlerList>
							</Script>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Lithmeria</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>register_lithmerias_envdata</name>
								<packageName></packageName>
								<script>function register_lithmerias_envdata(_, game)
  if game ~= "Lithmeria" then return end

  mmp.envids =
  {
    ["deep water"] = 4,
    beach          = 11,
    bridge         = 6,
    building       = 13,
    cliffs         = 1,
    desert         = 11,
    forest         = 2,
    highway        = 6,
    jungle         = 10,
    mountain       = 1,
    ocean          = 4,
    path           = 6,
    plains         = 3,
    river          = 4,
    road           = 6,
    shallowwater   = 4,
    swamp          = 2,
    tundra         = 7,
    underground    = 8,
    urban          = 8,
    water          = 4,
  }

  for name, number in pairs(mmp.envids) do
    mmp.envids[name] = number+256 -- adjust for in-built colors
  end

  mmp.waterenvs = {}
  local waterids = { "shallowwater", "river", "water", "deep water", "ocean" }
  for i = 1, #waterids do mmp.waterenvs[mmp.envids[waterids[i]]] = true end

  mmp.envidsr = {};
  for name, id in pairs(mmp.envids) do mmp.envidsr[id] = name end
end</script>
								<eventHandlerList>
									<string>mmp logged in</string>
								</eventHandlerList>
							</Script>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>StickMUD</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external scripts --
-------------------------------------------------
</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>stickmud_stop_speedwalk_for_wrong_dir</name>
								<packageName></packageName>
								<script>function stickmud_stop_speedwalk_for_wrong_dir()
  if mmp.game and mmp.game ~= "StickMUD" then
    return
  end
  if #mmp.speedWalkPath &gt; 0 then
    echo("The way \"" .. gmcp.Room.WrongDir .. "\" is blocked. Stopping speedwalk.")
    mmp.stop()
  end
end</script>
								<eventHandlerList>
									<string>gmcp.Room.WrongDir</string>
								</eventHandlerList>
							</Script>
						</Script>
					</ScriptGroup>
					<ScriptGroup isActive="yes" isFolder="yes">
						<name>Test / one-time things</name>
						<packageName></packageName>
						<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
						<eventHandlerList />
						<Script isActive="no" isFolder="no">
							<name>mmp_grabenvid</name>
							<packageName></packageName>
							<script>function mmp_grabenvid()
  if not mmp.envids[gmcp.Room.Info.environment] then
    mmp.envids[gmcp.Room.Info.environment] = getRoomEnv(mmp.currentroom)
    mmp.echo(string.format("Remembered environment %s as %d", gmcp.Room.Info.environment, mmp.envids[gmcp.Room.Info.environment]))
  end
end

function mmp.getMaxID()
  local roomIDs = {}
  for area, _ in pairs(mmp.areatabler) do
    local ok, t = pcall(getAreaRooms, area)
    if ok then
      for _, id in pairs(t or {}) do
        roomIDs[id] = true
      end
    end
  end

  return table.maxn(roomIDs)
end

function mmp.getUnknownEnvs()
  local maxid, missing = mmp.getMaxID(), {}

  for i = 1, maxid do
    if mmp.roomexists(i) then
      if not table.contains(mmp.envids, getRoomEnv(i)) and not table.contains(missing, getRoomEnv(i)) then
        mmp.echo(string.format("Missing env %d from room %d ('%s' in '%s')",
          tostring(getRoomEnv(i)), i, tostring(getRoomName(i)), tostring(mmp.areatabler[getRoomArea(i)])))
        missing[i] = getRoomEnv(i)
      end
    end
  end
end</script>
							<eventHandlerList>
								<string>gmcp.Room.Info</string>
							</eventHandlerList>
						</Script>
					</ScriptGroup>
					<ScriptGroup isActive="yes" isFolder="yes">
						<name>Check for map updates</name>
						<packageName></packageName>
						<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
						<eventHandlerList />
						<Script isActive="yes" isFolder="no">
							<name>mmp_downloaded_file</name>
							<packageName></packageName>
							<script>function mmp_downloaded_file(_, filename)
  if not io.exists(filename) then return end

  -- workaround for https://bugs.launchpad.net/mudlet/+bug/1092769
--  if mmp["downloaded_file_block_"..filename] then return end
--  mmp["downloaded_file_block_"..filename] = tempTimer(5, [[mmp["downloaded_file_block_]]..filename..[["] = nil]])

  if filename == tostring(mmp.mapperfile) then   -- mapper script version
	mmp.checkingupdates = false

    local f, s = io.open(filename)
    if f then s = f:read("*l"):trim(); io.close(f) end

    if s ~= tostring(mmp.version) then
      mmp.newmapperversion = s
      mmp.retrievechangelog()
    end

  elseif filename == tostring(mmp.changelogfile) then   -- changelog for the mapper script
	mmp.checkingupdates = false

    local f, s, changelog = io.open(filename)
    if f then changelog = f:read("*a"); io.close(f) end

    mmp.echon("")
    echoLink("The mapper script was updated! Would you like to download the update? Click here if so.", "mmp.downloadmapperscript()", "Changelog for the latest ("..tostring(mmp.version).." -&gt; "..tostring(mmp.newmapperversion)..") update:\n"..changelog, true)

  elseif filename == mmp.crowdchangelogfile then   -- changelog for the crowdmap
    local f, s = io.open(filename)
    if f then s = f:read("*a"); io.close(f) end

    -- make environment
    local env = {} -- add functions you know are safe here

    -- run code under environment [Lua 5.1]
    local function run(untrusted_code)
      if untrusted_code:byte(1) == 27 then return nil, "binary bytecode prohibited" end
      local untrusted_function, message = loadstring(untrusted_code)
      if not untrusted_function then return nil, message end
      setfenv(untrusted_function, env)
      return pcall(untrusted_function)
    end

    run(s)

	mmp.crowdchangelog = env.changelog

    mmp.echon("The crowdmap map was ")
    setUnderline(true)
    echoLink("updated", '', "New version: "..tostring(mmp.newversion)..", previous version: "..(mmp.oldversion or "(none)"), true)
    setUnderline(false)
    echo(" (")
    setUnderline(true)
    echoLink("see full changelog", "mmp.showcrowdchangelog()", 'View the full changelog for mappers', true)
    setUnderline(false)
    echo("). Latest improvement is: "..tostring(mmp.crowdchangelog and mmp.crowdchangelog[#mmp.crowdchangelog] or '?')..".\n")

    mmp.downloadcrowdmap(mmp.newversion)

  elseif filename == mmp.crowdmapfile then    -- crowdmap map
    mmp.echo("Map downloaded, loading it in...")

    local tmp = getRoomUserData(1, "gotoMapping")
    local oldmaptable = {}

    if tmp ~= "" then
      oldmaptable = yajl.to_value(tmp)
    end

    local ok = loadMap(filename)

    if ok then
      if mmp.game ~= "starmourn" then
        local wc = mmp.lockWormholes()
  	local ws = mmp.lockSewers()
        mmp.lockPebble()
        if mmp.game == "achaea" and wc == 0 and ws == 0 then -- in achaea, using crowdmap, if we didn't get any special exits - it means Mudlet needs to be updated
          mmp.echo("Sorry, it seems your Mudlet isn't compatible with the new crowdmap format - and the map cannot be loaded fully. Please update your Mudlet:\n  http://www.mudlet.org/download/")
          return
        end
      end

      if mmp.settings.waterwalk then mmp.enableWaterWalk() else mmp.disableWaterWalk() end

      mmp.echo("Map loaded fine - enjoy!")

      tmp = getRoomUserData(1, "gotoMapping")
      local newmaptable = {}

      if tmp ~= "" then
        newmaptable = yajl.to_value(tmp)
      end

      for k,v in pairs(oldmaptable) do newmaptable[k] = v end
      setRoomUserData(1, "gotoMapping", yajl.to_string(newmaptable))
      mmp.echo("Marks from the old map migrated successfully.")

      raiseEvent("mmapper updated map")
    else
      mmp.echon("Map failed to load - you need to have the mapper open. Please open it, and then ")
      echoLink("click here", [[
        local tmp = getRoomUserData(1, "gotoMapping")
        local oldmaptable = {}
        if tmp ~= "" then
          oldmaptable = yajl.to_value(tmp)
        end

        local ok = loadMap(']]..filename..[[')
        if ok then
        local wc = mmp.lockWormholes()
	    local ws = mmp.lockSewers()
        mmp.lockPebble()
        if mmp.game == "achaea" and wc == 0 and ws == 0 then -- in achaea, using crowdmap, if we didn't get any special exits - it means Mudlet needs to be updated
          mmp.echo("Sorry, it seems your Mudlet isn't compatible with the new crowdmap format - and the map cannot be loaded fully. Please update your Mudlet:\n  http://www.mudlet.org/download/")
          return
        end

        if mmp.settings.waterwalk then mmp.enableWaterWalk() else mmp.disableWaterWalk() end

        mmp.echo("Map loaded successfully!")

          tmp = getRoomUserData(1, "gotoMapping")
          local newmaptable = {}
          if tmp ~= "" then
            newmaptable = yajl.to_value(tmp)
          end
          for k,v in pairs(oldmaptable) do newmaptable[k] = v end
          setRoomUserData(1, "gotoMapping", yajl.to_string(newmaptable))
          mmp.echo("Marks from the old map migrated successfully.")
          raiseEvent("mmapper updated map")
        else mmp.echo("Nope, didn't work. Open the map and try again?") end
      ]],
      "Click here to try loading the map again")
      echo(" to try loading it in again.\n")
    end

  elseif filename == tostring(mmp.downloadedscript) then   -- new mapper script xml downloaded
	mmp.checkingupdates = false

    mmp.echo("Your mapper script was downloaded to '"..filename.."' - uninstall the current copy and install the new one now!")

  elseif filename == tostring(mmp.mapfile) then   -- map version #, either IRE's or crowd
	mmp.checkingupdates = false

    local function needupdate(currentmd5, oldmd5)
      if not mmp.settings.crowdmap then
        mmp.echon("The games map was ")
        echoLink("updated", '', "New MD5: "..tostring(currentmd5)..", previous MD5: "..(oldmd5 or "(none)"), true)
        echo(" - you should update yours! Go to Settings -&gt; Mapper tab and click on the button there. Once you've updated, ")
        echoLink("click here", "mmp.updatedmap('"..currentmd5.."')", "Click here to quiet the update reminder")
        echo(" to remove the reminder.")
      else
        mmp.newversion, mmp.oldversion = currentmd5, oldmd5
        mmp.retrievecrowdchangelog()
      end
    end

    local f, s = io.open(filename)
    if f then s = f:read("*a"); io.close(f) end
    local currentmd5 = string.match(s, "([a-z0-9]+)  map%.xml")

    -- using crowdsourced map
    if not currentmd5 then
      currentmd5 = s:trim()
    end

	os.remove(filename)

    -- never checked yet?
    if not io.exists(getMudletHomeDir().."/map downloads/current") then needupdate(currentmd5) return end

    -- otherwise read old file and check
    local f, s = io.open(getMudletHomeDir().."/map downloads/current")
    if f then s = f:read("*a"); io.close(f) end

    if s ~= currentmd5 then needupdate(currentmd5, s) end
  end
end</script>
							<eventHandlerList>
								<string>sysDownloadDone</string>
							</eventHandlerList>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Check for updates</name>
							<packageName></packageName>
							<script>local downloadfolder = getMudletHomeDir() .. "/map downloads/"
local whereisit
-- this should get called at start and every hour after that

function mmp.checkforupdate()
  if not mmp.game or mmp.checkingupdates then
    return
  end
  local game = mmp.game
  mmp.mapfile = downloadfolder .. "MD5"
  mmp.mapperfile = downloadfolder .. "mapper"
  if not downloadFile then
    mmp.echo("Your version of Mudlet doesn't support downloading files - please upgrade to 2.0+")
  else
    if not lfs.attributes(downloadfolder) then
      if lfs and lfs.mkdir then
        local t, s = lfs.mkdir(downloadfolder)
        if not t and s ~= "File exists" then
          mmp.echo("Couldn't make the '" .. downloadfolder .. "' folder; " .. s)
          return
        end
      else
        mmp.echo(
          "Sorry, but you need LuaFileSystem (lfs) installed, or have the '" ..
          downloadfolder ..
          "' folder exist."
        )
        return
      end
    end
    if mmp.settings.crowdmap then
      if game == "achaea" then
        downloadFile(
          mmp.mapfile, "http://ire-mudlet-mapping.github.io/AchaeaCrowdmap/Map/version.txt"
        )
      elseif game == "starmourn" then
        downloadFile(
          mmp.mapfile, "http://ire-mudlet-mapping.github.io/StarmournCrowdmap/Map/version.txt"
        )
      elseif game == "lusternia" then
        downloadFile(
          mmp.mapfile, "http://ire-mudlet-mapping.github.io/LusterniaCrowdmap/Map/version.txt"
        )
      elseif game == "stickmud" then
        downloadFile(
          mmp.mapfile, "http://stickmud.github.io/StickMUDCrowdmap/Map/version.txt"
        )
      end
    elseif mmp.settings.updatemap then
      downloadFile(mmp.mapfile, "http://www." .. game .. ".com/maps/MD5SUM")
    end
    downloadFile(
      mmp.mapperfile, "http://ire-mudlet-mapping.github.io/ire-mapping-script/downloads/version"
    )
    mmp.checkingupdates = true
  end
end

-- called by the user when the map is updated to register the fact that it was

function mmp.updatedmap(currentmd5)
  assert(currentmd5, "need md5 sum to write to file")
  local f, err = io.open(downloadfolder .. "current", "w")
  if not f then
    return mmp.echo("Couldn't write to the update file, because: " .. err)
  end
  f:write(currentmd5)
  f:close()
  local t = {"Go you for updating!", "Thanks for updating the map!", "Alright, map updated!"}
  mmp.echo(t[math.random(1, #t)])
end

-- downloads the latest changelog for the mapper if it was updated

function mmp.retrievechangelog()
  mmp.changelogfile = downloadfolder .. "changelog"
  downloadFile(
    mmp.changelogfile, "http://ire-mudlet-mapping.github.io/ire-mapping-script/downloads/changelog"
  )
end

function mmp.retrievecrowdchangelog()
  mmp.crowdchangelogfile = downloadfolder .. "crowdchangelogfile"
  if mmp.game == "achaea" then
    downloadFile(
      mmp.crowdchangelogfile, "http://ire-mudlet-mapping.github.io/AchaeaCrowdmap/Map/changelog.txt"
    )
  elseif mmp.game == "starmourn" then
    downloadFile(
      mmp.crowdchangelogfile,
      "http://ire-mudlet-mapping.github.io/StarmournCrowdmap/Map/changelog.txt"
    )
  elseif mmp.game == "lusternia" then
    downloadFile(
      mmp.crowdchangelogfile,
      "http://ire-mudlet-mapping.github.io/LusterniaCrowdmap/Map/changelog.txt"
    )
  elseif mmp.game == "stickmud" then
    downloadFile(
      mmp.crowdchangelogfile,
      "http://stickmud.github.io/StickMUDCrowdmap/Map/changelog.txt"
    )
  end
end

-- downloads the public crowdsources map!

function mmp.downloadmapperscript()
  local downloadlocationfile = downloadfolder .. "savepath"
  local downloadlocation
  local exists = lfs.attributes
  -- somewhat complicated thing to nicely deal with all scenarios.
  if not exists(downloadlocationfile) then
    downloadlocation = whereisit()
    if not downloadlocation then
      return
    end
  end
  if not downloadlocation then
    local f, s = io.open(downloadlocationfile)
    if f then
      downloadlocation = f:read("*a");
      io.close(f)
    end
    if not exists(downloadlocation) then
      downloadlocation = whereisit()
      if not downloadlocation or not exists(downloadlocation) then
        return
      end
    end
  end
  mmp.downloadedscript = downloadlocation .. "/mudlet-mapper.xml"
  downloadFile(
    mmp.downloadedscript,
    "http://ire-mudlet-mapping.github.io/ire-mapping-script/downloads/mudlet-mapper.xml"
  )
  local f, err = io.open(downloadlocationfile, "w")
  if not f then
    return mmp.echo("Couldn't write to the location file, because: " .. err)
  end
  f:write(downloadlocation)
  f:close()
  mmp.echo("Okay, downloading the mapper script...")
end

function mmp.downloadcrowdmap(newversion)
  mmp.crowdmapfile = downloadfolder .. "crowdmap"
  local f, err = io.open(downloadfolder .. "current", "w")
  if not f then
    return mmp.echo("Couldn't write to the update file, because: " .. err)
  end
  f:write(newversion)
  f:close()
  if mmp.game == "achaea" then
    downloadFile(mmp.crowdmapfile, "http://ire-mudlet-mapping.github.io/AchaeaCrowdmap/Map/map")
  elseif mmp.game == "starmourn" then
    downloadFile(mmp.crowdmapfile, "http://ire-mudlet-mapping.github.io/StarmournCrowdmap/Map/map")
  elseif mmp.game == "lusternia" then
    downloadFile(mmp.crowdmapfile, "http://ire-mudlet-mapping.github.io/LusterniaCrowdmap/Map/map")
  elseif mmp.game == "stickmud" then
    downloadFile(mmp.crowdmapfile, "http://stickmud.github.io/StickMUDCrowdmap/Map/map")
  end
  mmp.echo("Downloading the latest crowdmap...")
end

function mmp.showcrowdchangelog()
  mmp.echo("Public map changelog:")
  if not mmp.crowdchangelog then
    mmp.echo("(none yet)")
    return
  end
  for k, v in ipairs(mmp.crowdchangelog) do
    cecho(string.format("  %s) %s\n", k, v:gsub("\t", "     ")))
  end
end

whereisit =
  function()
    local path =
      invokeFileDialog(false, "Where should we save the file? Select a folder and click Open")
    if path == "" then
      return nil
    else
      return path
    end
  end</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>mmp_checkupdatestart</name>
								<packageName></packageName>
								<script>function mmp_checkupdatestart(...)
  if mmp.checkforupdatetimer then killTimer(mmp.checkforupdatetimer) end
  mmp.checkforupdatetimer = tempTimer(math.random(3, 10), mmp.checkforupdate)
end

function mmp.changeUpdateMap()
  if mmp.settings.updatemap then
    mmp.echo("Will check for new map updates from your MUD.")
    enableTimer"Check for updates periodically"
    mmp_checkupdatestart()
  else
    mmp.echo("Won't check for new map updates from your MUD.")
    disableTimer"Check for updates periodically"
	if mmp.checkforupdatetimer then killTimer("mmp.checkforupdatetimer") end
  end
end</script>
								<eventHandlerList>
									<string>mmp logged in</string>
								</eventHandlerList>
							</Script>
						</Script>
						<Script isActive="no" isFolder="no">
							<name>mmp_see_dl_errors</name>
							<packageName></packageName>
							<script>-- this should be off by default
function mmp_see_dl_errors(...)
  display{...}
end</script>
							<eventHandlerList>
								<string>sysDownloadError</string>
							</eventHandlerList>
						</Script>
					</ScriptGroup>
					<Script isActive="yes" isFolder="no">
						<name>Initialize</name>
						<packageName></packageName>
						<script>mmp.startup()</script>
						<eventHandlerList />
						<Script isActive="yes" isFolder="no">
							<name>mmp.mapdata_changed</name>
							<packageName></packageName>
							<script>-- aggregates map load and such events into one
function mmp.mapdata_changed()
  raiseEvent("mmapper map reloaded")
end
					</script>
							<eventHandlerList>
								<string>sysMapLoad</string>
								<string>sys2DMapLoad</string>
								<string>sys3DMapLoad</string>
								<string>sysMapDownloadEvent</string>
								<string>mapOpenEvent</string>
							</eventHandlerList>
						</Script>
					</Script>
					<Script isActive="yes" isFolder="no">
						<name>map features</name>
						<packageName></packageName>
						<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

local function loadMapFeatures()
  local mapFeaturesString = getMapUserData("mapFeatures")
  local mapFeatures
  if mapFeaturesString and mapFeaturesString ~= "" then
    mapFeatures = yajl.to_value(mapFeaturesString)
  else
    mapFeatures = {}
  end
  return mapFeatures
end

local function saveMapFeatures(mapFeaturesToSave)
  local mapFeaturesString = yajl.to_string(mapFeaturesToSave)
  setMapUserData("mapFeatures", mapFeaturesString)
end

function mmp.createMapFeature(featureName, roomCharacter)
  if not featureName or featureName == "" then
    mmp.echo("Can't create an empty map feature.")
    return
  end
  if featureName:find("%d") then
    mmp.echo("Map feature names must not contain numbers.")
    return
  end
  roomCharacter = roomCharacter or ""
  if type(roomCharacter) ~= "string" then
    mmp.echo(
      "The new room character must be either a string or nil. " ..
      type(roomCharacter) ..
      " is not allowed."
    )
    return
  end
  local lowerFeatureName = featureName:lower()
  local mapFeatures = loadMapFeatures()
  if not mapFeatures[lowerFeatureName] then
    mapFeatures[lowerFeatureName] = roomCharacter
    saveMapFeatures(mapFeatures)
    mmp.echo(
      "Created map feature '" ..
      featureName ..
      "' with the room character '" ..
      roomCharacter ..
      "'."
    )
  else
    mmp.echo("A map feature with the name '" .. featureName .. "' already exists.")
    return
  end
  return true
end

function mmp.listMapFeatures()
  local mapFeatures = loadMapFeatures()
  mmp.echo("This map has the following features:")
  echo(string.format("    %-25s | %s\n", "feature name", "room character"))
  echo(string.format("    %s\n", string.rep("-", 45)))
  for featureName, roomCharacter in pairs(mapFeatures) do
    echo(string.format("    %-25s | %s\n", featureName, roomCharacter))
  end
  return true
end

function mmp.roomCreateMapFeature(featureName, roomId)
  -- checks for the feature name
  if not featureName then
    mmp.echo("Which feature would you like to create?")
    return
  end
  local lowerFeatureName = featureName:lower()
  local mapFeatures = loadMapFeatures()
  if not mapFeatures[lowerFeatureName] then
    mmp.echo(
      "A feature with name '" ..
      featureName ..
      "' does not exist. You need to use 'feature create' first."
    )
    return
  end
  -- checks for the room ID
  if not roomId then
    if not mmp.currentroom then
      mmp.echo("Don't know where we are at the moment.")
      return
    end
    roomId = mmp.currentroom
  else
    if type(roomId) ~= "number" then
      mmp.echo("Need a room ID as number for creating a map feature on a room.")
      return
    end
  end
  if not getRoomName(roomId) then
    mmp.echo("Room number '" .. roomId .. "' does not exist.")
    return
  end
  -- check if feature already exists
  if table.contains(mmp.getRoomMapFeatures(roomId), lowerFeatureName) then
    mmp.echo("Room '" .. roomId .. "' has already map feature '" .. featureName .. "'.")
    return
  end
  -- create map feature in room
  setRoomUserData(roomId, "feature-" .. lowerFeatureName, "true")
  mmp.echo(string.format("Map feature '%s' created in room number '%d'.", featureName, roomId))
  local featureRoomChar = mapFeatures[lowerFeatureName]
  if featureRoomChar ~= "" then
    setRoomChar(roomId, featureRoomChar)
    mmp.echo("The room now carries the room char '" .. featureRoomChar .. "'.")
  end
  return true
end

function mmp.roomDeleteMapFeature(featureName, roomId)
  -- checks for the feature name
  if not featureName then
    mmp.echo("Which feature would you like to delete?")
    return
  end
  local lowerFeatureName = featureName:lower()
  -- checks for the room ID
  if not roomId then
    if not mmp.currentroom then
      mmp.echo("Don't know where we are at the moment.")
      return
    end
    roomId = mmp.currentroom
  else
    if type(roomId) ~= "number" then
      mmp.echo("Need a room ID as number for deleting a map feature from a room.")
      return
    end
  end
  if not getRoomName(roomId) then
    mmp.echo("Room number '" .. roomId .. "' does not exist.")
    return
  end
  -- check if feature exists
  local roomMapFeatures = mmp.getRoomMapFeatures(roomId)
  if not table.contains(roomMapFeatures, lowerFeatureName) then
    mmp.echo("Room '" .. roomId .. "' doesn't have map feature '" .. featureName .. "'.")
    return
  end
  -- delete map feature from room
  setRoomUserData(roomId, "feature-" .. lowerFeatureName, "")
  mmp.echo(string.format("Map feature '%s' deleted from room number '%d'.", featureName, roomId))
  -- now update room char if needed.
  -- first update current map features of this room
  roomMapFeatures = mmp.getRoomMapFeatures(roomId)
  local mapFeatures = loadMapFeatures()
  -- find out if we need to set a new room character
  if getRoomChar(roomId) == mapFeatures[lowerFeatureName] and getRoomChar(roomId) ~= "" then
    local index, otherRoomMapFeature
    -- find another usable room character
    repeat
      index, otherRoomMapFeature = next(roomMapFeatures, index)
    until not otherRoomMapFeature or mapFeatures[otherRoomMapFeature] ~= ""
    if otherRoomMapFeature then
      -- we found a usable room character, now set it
      local newRoomChar = mapFeatures[otherRoomMapFeature]
      setRoomChar(roomId, newRoomChar)
      mmp.echo("Using '" .. newRoomChar .. "' as new room character.")
    else
      -- we didn't find a usable room character, delete it.
      setRoomChar(roomId, "")
      mmp.echo("Deleted the current room character.")
    end
  end
  return true
end

function mmp.getRoomMapFeatures(roomId)
  -- checks for the room ID
  if not roomId then
    if not mmp.currentroom then
      mmp.echo("Don't know where we are at the moment.")
      return
    end
    roomId = mmp.currentroom
  else
    if type(roomId) ~= "number" then
      mmp.echo("Need a room ID as number for getting all map features of a room.")
      return
    end
  end
  if not getRoomName(roomId) then
    mmp.echo("Room number '" .. roomId .. "' does not exist.")
    return
  end
  local result = {}
  local mapFeatures = loadMapFeatures()
  for mapFeature in pairs(mapFeatures) do
    if getRoomUserData(roomId, "feature-" .. mapFeature) == "true" then
      result[#result + 1] = mapFeature
    end
  end
  return result
end

function mmp.deleteMapFeature(featureName)
  if not featureName or featureName == "" then
    mmp.echo("Which map feature would you like to delete?")
    return
  end
  local lowerFeatureName = featureName:lower()
  local mapFeatures = loadMapFeatures()
  if not mapFeatures[lowerFeatureName] then
    mmp.echo("Map feature '" .. featureName .. "' does not exist.")
    return
  end
  local roomsWithFeature = searchRoomUserData("feature-" .. lowerFeatureName, "true")
  for _, roomId in pairs(roomsWithFeature) do
    local deletionResult = mmp.roomDeleteMapFeature(lowerFeatureName, roomId)
    if not deletionResult then
      mmp.echo(
        "Something went wrong deleting the map feature '" ..
        featureName ..
        "' from all rooms. Deletion incomplete."
      )
      return
    end
  end
  mapFeatures[lowerFeatureName] = nil
  saveMapFeatures(mapFeatures)
  mmp.echo("Deleted map feature '" .. featureName .. "' from map.")
  return true
end

function mmp.getMapFeatures()
  return loadMapFeatures()
end</script>
						<eventHandlerList />
					</Script>
				</ScriptGroup>
			</ScriptGroup>
			<ScriptGroup isActive="yes" isFolder="yes">
				<name>deleteOldProfiles</name>
				<packageName>deleteOldProfiles</packageName>
				<script></script>
				<eventHandlerList />
				<Script isActive="yes" isFolder="no">
					<name>deleteOldProfiles script</name>
					<packageName></packageName>
					<script>function deleteOldProfiles(keepdays_arg, delete_folder)
  --[[
  Deletes old profiles/maps/modules in the "current"/"map"/"moduleBackups" folders of the Mudlet home directory.
  The following files are NOT deleted:
  - Files newer than the amount of days specified as an argument to deleteOldProfiles(), or 31 days if not specified.
  - One file for every month before that. Specifically: The first available file of every month prior to this.
  Setting the second argument to true will delete maps instead of profiles. (e.g. deleteOldProfiles(10, true))
  --]]

  -- Ensure correct value is passed for second argument
  assert(type(delete_folder) == "string", "Wrong type for delete_folder; expected string, got " .. type(delete_folder))
  assert(table.contains({"profiles", "maps", "modules"}, delete_folder), "delete_folder must be profiles, maps or modules")

  local keepdays = tonumber(keepdays_arg) or 31
  local profile_table = {}
  local used_last_mod_months = {}
  local slash = (string.char(getMudletHomeDir():byte()) == "/") and "/" or "\\"
  local delnum = 0

  local to_folder = {
    profiles = "current",
    maps = "map",
  }

  local dirpath = delete_folder == "modules"
    and getMudletHomeDir()..slash..".."..slash..".."..slash.."moduleBackups"
    or getMudletHomeDir()..slash..to_folder[delete_folder]

  -- Traverse the profiles folder and create a table of files:
  for filename in lfs.dir(dirpath) do
    if filename~="." and filename~=".." then
      profile_table[#profile_table+1] = {
        name = filename,
        last_mod = lfs.attributes(dirpath..slash..filename, "modification")
      }
    end
  end

  -- Sort the table according to last modification date from old to new:
  table.sort(profile_table, function (a,b) return a.last_mod &lt; b.last_mod end)

  echo(string.format(
    "\nDeleting old %s. Files newer than %d days and one for every month before that will be kept.",
    delete_folder,
    keepdays
  ))

  for i, v in ipairs(profile_table) do
    local days = math.floor(os.difftime(os.time(), v.last_mod) / 86400)
    local last_mod_month = os.date("%Y/%m", v.last_mod)
    if days &gt; keepdays then
      -- For profiles older than X days, check if we already kept a table for this month:
      if not table.contains(used_last_mod_months, last_mod_month) then
        -- If not, do nothing and mark this month as "kept".
        used_last_mod_months[#used_last_mod_months+1] = last_mod_month
      else
        -- Otherwise remove the file:
        local success, errorstring = os.remove(dirpath..slash..v.name)
        if success then
          delnum = delnum + 1
        else
          cecho("\n&lt;red&gt;ERROR: "..errorstring)
        end
      end
    end
  end

  echo(string.format("\nDeletion complete. %d/%d files were removed successfully.", delnum, #profile_table))
end
</script>
					<eventHandlerList />
				</Script>
			</ScriptGroup>
			<ScriptGroup isActive="yes" isFolder="yes">
				<name>Levi_062424</name>
				<packageName>Levi_062424</packageName>
				<script></script>
				<eventHandlerList />
				<ScriptGroup isActive="yes" isFolder="yes">
					<name>deleteOldProfiles</name>
					<packageName>deleteOldProfiles</packageName>
					<script></script>
					<eventHandlerList />
					<Script isActive="yes" isFolder="no">
						<name>deleteOldProfiles script</name>
						<packageName></packageName>
						<script>function deleteOldProfiles(keepdays_arg, delete_folder)
  --[[
  Deletes old profiles/maps/modules in the "current"/"map"/"moduleBackups" folders of the Mudlet home directory.
  The following files are NOT deleted:
  - Files newer than the amount of days specified as an argument to deleteOldProfiles(), or 31 days if not specified.
  - One file for every month before that. Specifically: The first available file of every month prior to this.
  Setting the second argument to true will delete maps instead of profiles. (e.g. deleteOldProfiles(10, true))
  --]]

  -- Ensure correct value is passed for second argument
  assert(type(delete_folder) == "string", "Wrong type for delete_folder; expected string, got " .. type(delete_folder))
  assert(table.contains({"profiles", "maps", "modules"}, delete_folder), "delete_folder must be profiles, maps or modules")

  local keepdays = tonumber(keepdays_arg) or 31
  local profile_table = {}
  local used_last_mod_months = {}
  local slash = (string.char(getMudletHomeDir():byte()) == "/") and "/" or "\\"
  local delnum = 0

  local to_folder = {
    profiles = "current",
    maps = "map",
  }

  local dirpath = delete_folder == "modules"
    and getMudletHomeDir()..slash..".."..slash..".."..slash.."moduleBackups"
    or getMudletHomeDir()..slash..to_folder[delete_folder]

  -- Traverse the profiles folder and create a table of files:
  for filename in lfs.dir(dirpath) do
    if filename~="." and filename~=".." then
      profile_table[#profile_table+1] = {
        name = filename,
        last_mod = lfs.attributes(dirpath..slash..filename, "modification")
      }
    end
  end

  -- Sort the table according to last modification date from old to new:
  table.sort(profile_table, function (a,b) return a.last_mod &lt; b.last_mod end)

  echo(string.format(
    "\nDeleting old %s. Files newer than %d days and one for every month before that will be kept.",
    delete_folder,
    keepdays
  ))

  for i, v in ipairs(profile_table) do
    local days = math.floor(os.difftime(os.time(), v.last_mod) / 86400)
    local last_mod_month = os.date("%Y/%m", v.last_mod)
    if days &gt; keepdays then
      -- For profiles older than X days, check if we already kept a table for this month:
      if not table.contains(used_last_mod_months, last_mod_month) then
        -- If not, do nothing and mark this month as "kept".
        used_last_mod_months[#used_last_mod_months+1] = last_mod_month
      else
        -- Otherwise remove the file:
        local success, errorstring = os.remove(dirpath..slash..v.name)
        if success then
          delnum = delnum + 1
        else
          cecho("\n&lt;red&gt;ERROR: "..errorstring)
        end
      end
    end
  end

  echo(string.format("\nDeletion complete. %d/%d files were removed successfully.", delnum, #profile_table))
end
</script>
						<eventHandlerList />
					</Script>
				</ScriptGroup>
				<ScriptGroup isActive="yes" isFolder="yes">
					<name>leviticus</name>
					<packageName>leviticus</packageName>
					<script></script>
					<eventHandlerList />
					<ScriptGroup isActive="yes" isFolder="yes">
						<name>LeviAtaxia</name>
						<packageName>DomTax</packageName>
						<script></script>
						<eventHandlerList />
						<ScriptGroup isActive="yes" isFolder="yes">
							<name>Ataxia-DownloadThis</name>
							<packageName>Ataxia-DownloadThis</packageName>
							<script></script>
							<eventHandlerList />
							<ScriptGroup isActive="yes" isFolder="yes">
								<name>Ataxia</name>
								<packageName></packageName>
								<script>ataxia = ataxia or {}
ataxiaTables = ataxiaTables or {}
ataxiaTemp = ataxiaTemp or {}
ataxiaTemp.addedHerbID = 1
ataxiaTemp.removedHerbID = 2
ataxiagui = ataxiagui or {}
ataxiaVersion = "4.1"						--last was 4.1
muteList = muteList or {}

ataxiaTables.limbTimers = ataxiaTables.limbTimers or {}
ataxiaTables.fractureTimers = ataxiaTables.fractureTimers or {}

ataxia.bals = ataxia.bals or {}
ataxia.bals.get = {"bal", "eq"}
ataxia.bals.used = ataxia.bals.used or {}
ataxia.bals.timestamps = ataxia.bals.timestamps or {}


function ataxia_Echo(text)
	cecho("\n&lt;a_darkcyan&gt;(&lt;a_darkmagenta&gt;LEVI&lt;a_darkcyan&gt;): &lt;NavajoWhite&gt;"..text)
end

function ataxiaEcho(text)
	cecho("\n&lt;a_darkcyan&gt;(&lt;a_darkmagenta&gt;LEVI&lt;a_darkcyan&gt;): &lt;NavajoWhite&gt;"..text)
end


</script>
								<eventHandlerList />
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Gui Stuff</name>
									<packageName></packageName>
									<script>function Geyser.MiniConsole:clear()
	clearWindow(self.name)
end

function Geyser.MiniConsole:append()
	appendBuffer(self.name)
end</script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Creation/Layout</name>
										<packageName></packageName>
										<script>function ataxiagui_Create()
	winWid, winHei = getMainWindowSize()
	winHeiP = (winHei/100)
  setConsoleBufferSize("main", 2000000, 2000)
  
  if ataxia.usegui == true or ataxia.usegui == nil then
  
    ataxiagui_sep = string.char(getMudletHomeDir():byte()) == "/" and "/" or "\\"		
    ataxiagui_dir = (getMudletHomeDir()..ataxiagui_sep.."Pictures"..ataxiagui_sep):gsub("\\","/")
    ataxiagui_smallUI = false

    if winWid &lt; 1500 then
      ataxiagui_smallUI = true
		  aBorders = {l = 200, t = 30, b = 70, r = 450}
    else
      aBorders = {l = 215, t = 30, b = 70, r = 600}
    end
    setBorderLeft(aBorders.l)
    setBorderTop(aBorders.t)
    setBorderBottom(aBorders.b)
    setBorderRight(aBorders.r)
	
	

    ataxiagui_containers()
    ataxiagui_boxes()
    ataxiagui_consoles()
    ataxiagui_createMap()
    ataxiagui_createChat()
    ataxiagui_vitalsElements()
  end
end

function ataxiagui_containers()
	--Initialise containers to hold the various elements of the GUI.
	--The labels beneath each will house the backgrounds.
	ataxiagui.leftContainer = Geyser.Container:new({
		x = 0, y = 0,
		width = aBorders.l, height = winHei,
	})
	ataxiagui.leftBG = Geyser.Label:new({
		x = 0, y = 0,
		width = "100%", height = "100%",
	}, ataxiagui.leftContainer)
	ataxiagui.leftBG:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[leftBorder.png")]])

	ataxiagui.rightContainer = Geyser.Container:new({
		x = winWid - aBorders.r, y = 0,
		width = aBorders.r, height = winHei,
	})
	ataxiagui.rightBG = Geyser.Label:new({
		x = 0, y = 0,
		width = "100%", height = "100%",
	}, ataxiagui.rightContainer)
	ataxiagui.rightBG:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[rightBorder.png")]])

	ataxiagui.topContainer = Geyser.Container:new({
		x = aBorders.l, y = 0,
		width = winWid - (aBorders.r + aBorders.l), height = aBorders.t,
	})
	ataxiagui.topBG = Geyser.Label:new({
		x = 0, y = 0,
		width = "100%", height = "100%",
	}, ataxiagui.topContainer)
	ataxiagui.topBG:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[topBorder.png")]])

	ataxiagui.bottomContainer = Geyser.Container:new({
		x = aBorders.l, y = winHei - aBorders.b,
		width = winWid - (aBorders.r + aBorders.l), height = aBorders.b,
	})
	ataxiagui.bottomBG = Geyser.Label:new({
		x = 0, y = 0,
		width = "100%", height = "100%",
	}, ataxiagui.bottomContainer)
	ataxiagui.bottomBG:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[bottomBorder.png")]])
end

function ataxiagui_boxes()
	setAppStyleSheet([[
		QScrollBar:vertical {background: #000;}
		QScrollBar::handle:vertical {background-color: #07f; min-height: 50px;}
		QScrollBar::add-line:vertical, QScrollBar::sub-line:vertical {background: none; height: 0px;}
		QScrollBar::add-page:vertical, QScrollBar::sub-page:vertical {background: none;}
		QMenuBar {background-color: #000; color: #07f;}
		QMenuBar::item:selected {background-color: #000; color: #0ff}
	]])

	ataxiagui.playersBG = Geyser.Label:new({
		x = 0, y = "6%",
		width = "100%", height = "25%",
	}, ataxiagui.leftContainer)
	ataxiagui.playersBG:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[ataxiaBorder.png")]])

	ataxiagui.roomBG = Geyser.Label:new({
		x = 0, y = "35%",
		width = "100%", height = "25%",
	}, ataxiagui.leftContainer)
	ataxiagui.roomBG:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[ataxiaBorder.png")]])

	ataxiagui.bashBG = Geyser.Label:new({
		x = 0, y = "65%",
		width = "100%", height = "30%",
	}, ataxiagui.leftContainer)
	ataxiagui.bashBG:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[ataxiaBorder.png")]])
end

function ataxiagui_consoles()
	ataxiagui.playersConsole = Geyser.MiniConsole:new({
		x = "7%", y = (winHeiP*7)+5,
		width = "86%", height = "22%",
		color = "black",
	}, ataxiagui.leftContainer)

	ataxiagui.roomConsole = Geyser.MiniConsole:new({
		x = "7%", y = (winHeiP*36)+5,
		width = "86%", height = "22%",
		color = "black",
	}, ataxiagui.leftContainer)

	ataxiagui.bashConsole = Geyser.MiniConsole:new({
		x = "7%", y = (winHeiP*66)+5,
		width = "86%", height = "26%",
		color = "black",
	}, ataxiagui.leftContainer)
end

registerAnonymousEventHandler("ataxia system loaded", "ataxiagui_Create")</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Map and Chat</name>
										<packageName></packageName>
										<script>function ataxiagui_createMap()
	if ataxiagui_smallUI then
		ataxiagui_createSmallMap()
		return
	end

	ataxiagui.mapBG = Geyser.Label:new({
		x = 120, y = "5%",
		width = 360, height = "32%",
	}, ataxiagui.rightContainer)
	ataxiagui.mapBG:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[ataxiaBorder.png")]])

	ataxiagui.mapper = Geyser.Mapper:new({
		x = 145, y = "7%",
		width = 310, height = "28%",
	}, ataxiagui.rightContainer)

	ataxiagui.mapRoom = Geyser.Label:new({
		x = 110, y = "1%",
		width = 380, height = "3%",
	}, ataxiagui.rightContainer)
	ataxiagui.mapRoom:setStyleSheet([[
		background-color: transparent;
    		border-width: 2px;
    		border-color: transparent;
    		border-style: solid;
    		border-radius: 14;
    		padding: 3px;
	]])
	ataxiagui.mapRoom:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="NavajoWhite"&gt;&lt;font face="Merienda"&gt;]].."Room Area"..[[&lt;/font&gt;&lt;/p&gt;]] )

	ataxiagui.mapExits = Geyser.Label:new({
		x = 110, y = "4%",
		width = 380, height = "3%",
	}, ataxiagui.rightContainer)
	ataxiagui.mapExits:setStyleSheet([[
		background-color: transparent;
    		border-width: 2px;
    		border-color: transparent;
    		border-style: solid;
    		border-radius: 14;
    		padding: 3px;
	]])
	ataxiagui.mapExits:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="NavajoWhite"&gt;&lt;font face="Merienda"&gt;]].."Room Exits"..[[&lt;/font&gt;&lt;/p&gt;]] )
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
	ataxiagui.basherBar = Geyser.Gauge:new({
		name = "ataxiagui.basherBar",
		x = 150, y = "38%",
		width = 300, height = "2%",
		fontSize = 12,
	}, ataxiagui.rightContainer)

	ataxiagui.basherBar.front:setStyleSheet([[
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #f1f34e, stop: 0.1 #eef022, stop: 0.49 #a5db67, stop: 0.5 #a5db67, stop: 1 #5e5e19);
		border-top: 2px black solid;
		border-left: 1px black solid;
		border-bottom: 1px black solid;
		border-radius: 10;
		padding: 3px;]])
	ataxiagui.basherBar.back:setStyleSheet([[
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #f8f9a6, stop: 0.1 #bec01b, stop: 0.49 #777811, stop: 0.5 #777811, stop: 1 #2f3006);
		border-width: 2px;
		border-color: black;
		border-style: solid;
		border-radius: 12;
		padding: 3px;]]) 
	ataxiagui.basherBar:setValue(40, 100)
	ataxiagui.basherBar:hide()
	
	ataxiagui.basherBarClear = Geyser.Gauge:new({
		name = "ataxiagui.basherBarClear",
		x = 150, y = "38%",
		width = 300, height = "2%",
		fontSize = 12,
	}, ataxiagui.rightContainer)

	ataxiagui.basherBarClear.front:setStyleSheet([[ 
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 1, y2: 0, stop: 0 rgba(2,2,2,255), stop: .02 rgba(29,29,29,255),stop: .19 rgba(255,255,255,166), stop: .37 rgba(2,2,2,69), stop: .50 rgba(2,2,2,0), stop: .78 rgba(2,2,2,107), stop: .89 rgba(2,2,2,77), stop: .94 rgba(80,113,117,61), stop: .99 rgba(158,224,232,255), stop: 1 rgba(173,246,255,255));
    border: 1px solid rgba(208,208,208,100);    
		border-top: 2px black solid;
		border-left: 1px black solid;
		border-bottom: 1px black solid;
		border-radius: 10;
    padding: 3px;
	]])
	ataxiagui.basherBarClear.back:setStyleSheet([[
		background-color: transparent;
		border-width: 2px;
		border-color: black;
		border-style: solid;
		border-radius: 12;
    padding: 3px;
	]])
	ataxiagui.basherBarClear:setValue(100,100,"&lt;B&gt;&lt;left&gt;&lt;font face = 'Merienda' color = 'white' size = '2'&gt;".."Rooms".."&lt;/font&gt;&lt;/left&gt;")
	ataxiagui.basherBarClear:hide()
end

function ataxiagui_chatSelect(tab)
	local current = ataxiagui.Chat.current
	ataxiagui.Chat[current]:hide()
	ataxiagui.Chat[current.."tab"]:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="red"&gt;&lt;font face="Merienda"&gt;]]..current..[[&lt;/font&gt;&lt;/p&gt;]] )

	ataxiagui.Chat.current = tab
	current = ataxiagui.Chat.current
	ataxiagui.Chat[current]:show()
	ataxiagui.Chat[current.."tab"]:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="green"&gt;&lt;font face="Merienda"&gt;]]..current..[[&lt;/font&gt;&lt;/p&gt;]] )

end

function ataxiagui_createChat()
	if ataxiagui_smallUI then
		ataxiagui_createSmallChat()
		return
	end

	ataxiagui.Chat = {}
	ataxiagui.chatBG = Geyser.Label:new({
		x = 65, y = "42%",
		width = 470, height = "57%",
	}, ataxiagui.rightContainer)
	ataxiagui.chatBG:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[ataxiaBorder.png")]])

	ataxiagui.Chat = {
		tabs = {"All", "City", "Clans" ,"Misc", "Order", "Party", "Tells"},
		colour1 = "DarkGreen",
		colour2 = "black",
		current = "",
		wrapWidth = math.floor(411/7)
	}

	ataxiagui.Chat.container = Geyser.Container:new({
		x = 93, y = "45%",
		width = 411, height = "51%",
	}, ataxiagui.rightContainer)

	ataxiagui.Chat.header = Geyser.HBox:new({
		name = "ataxiagui.Chat.header",
		x = 0, y = 0,
		width = "100%", height = "4%"
	}, ataxiagui.Chat.container)

	ataxiagui.Chat.footer = Geyser.Label:new({
		name = "ataxiagui.Chat.footer",
		x = 0, y = "4%",
		width = "100%", height = "96%"
	}, ataxiagui.Chat.container)
	ataxiagui.Chat.footer:setStyleSheet([[
		background-color: black;
		border-color: black;
		border-bottom-left-radius: 8px;
		border-bottom-right-radius: 8px;
	]])

	ataxiagui.Chat.center = Geyser.Label:new({
		name = "ataxiagui.Chat.center",
		x = 0, y = 0,
		width = "100%", height = "100%",
	}, ataxiagui.Chat.footer)
	ataxiagui.Chat.center:setStyleSheet([[
		background-color: black;
		border-color: black;
		border-radius: 8px;
		margin: 5px;]])

	for _, sec in pairs(ataxiagui.Chat.tabs) do
		--The individual tabs
		ataxiagui.Chat[sec.."tab"] = Geyser.Label:new({
			name = "ataxiagui.Chat."..sec.."tab"
		}, ataxiagui.Chat.header)
		ataxiagui.Chat[sec.."tab"]:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[chatTab.png")]])
		ataxiagui.Chat[sec.."tab"]:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="red"&gt;&lt;font face="Merienda"&gt;]]..sec..[[&lt;/font&gt;&lt;/p&gt;]] )
		ataxiagui.Chat[sec.."tab"]:setClickCallback("ataxiagui_chatSelect", sec)

		--Windows where the consoles are placed
		ataxiagui.Chat[sec] = Geyser.Label:new({
			name = "ataxiagui.Chat."..sec,
			x = 0, y = 0,
			width = "100%", height = "100%"
		}, ataxiagui.Chat.footer)
		ataxiagui.Chat[sec]:setStyleSheet([[
			background-color: black;
			border-bottom-left-radius: 5px;
			border-bottom-right-radius: 5px
		]])
	
		--Consoles where the text is placed
		ataxiagui.Chat[sec.."center"] = Geyser.MiniConsole:new({
			name = "ataxiagui.Chat."..sec.."center",
			x = "1%", y = "1%",
			width = "98%", height = "98%",
			color = "black",
      autoWrap = true,
		}, ataxiagui.Chat[sec])
		ataxiagui.Chat[sec.."center"]:setFontSize(8)
		--ataxiagui.Chat[sec.."center"]:setWrap(ataxiagui.Chat.wrapWidth)
		ataxiagui.Chat[sec]:hide()
	end
	ataxiagui.Chat.current = "All"
	ataxiagui.Chat.All:show()
	ataxiagui.Chat.Alltab:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="green"&gt;&lt;font face="Merienda"&gt;]].."All"..[[&lt;/font&gt;&lt;/p&gt;]] )
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Chat Capture Things</name>
										<packageName></packageName>
										<script>function ataxiagui_populateChannels()
  if ataxia.usegui == true or ataxia.usegui == nil then
    ataxiagui.Chat.Channels = ataxiagui.Chat.Channels or {}
    ataxiagui.Chat.Channels.last = ataxiagui.Chat.Channels.last or ""
    ataxiagui.Chat.Channels.types = {
      ["newbie"] = "Misc",
      ["market"] = "Misc", 
      ["ct"] = "City",
      ["ht"] = "Tells",
      ["hts"] = "Tells",
      ["hnt"] = "Tells",
      ["clt"] = "Clans",
      ["party"] = "Party",
      ["tell"] = "Tells",
      ["says"] = "Misc",
      ["ot"] = "Order",
    }
    cecho("\n&lt;green&gt;Chat channels updated!")
  end
end

function ataxiagui_processChat(channel)
  if ataxia.usegui ~= nil and ataxia.usegui == false then return end

	local ofr, ofg, ofb = getFgColor()
	local obr, obg, obb = getBgColor()
	local text = ansi2decho(gmcp.Comm.Channel.Text.text)
	local person = gmcp.Comm.Channel.Text.talker:title()
	if person == "The guardian spirit of the totem" then 
		only_to_misc = false
		return
	end
  local report = false
  if ataxiaNDB_Exists(person) or table.contains(ataxiaNDB.divine, person) or gmcp.Comm.Channel.Start == "shout" or person == "You" then
    report = true
  end
  
  
  if person == gmcp.Char.Status.name or person == "You" then
		ataxiagui.Chat[channel.."center"]:decho(text.."\n")
		ataxiagui.Chat.Allcenter:decho(text.."\n")	
	elseif report then
    
		if gmcp.Comm.Channel.Start == "shout" then
			ataxiagui.Chat[channel.."center"]:cecho("&lt;cyan&gt; "..gmcp.Comm.Channel.Text.talker.."&lt;red&gt;: ")
		end	
		ataxiagui.Chat[channel.."center"]:decho(text.."\n")
	
		if not only_to_misc then
			if gmcp.Comm.Channel.Start == "shout" then
				ataxiagui.Chat.Allcenter:cecho("&lt;cyan&gt; "..gmcp.Comm.Channel.Text.talker.."&lt;red&gt;: ")
			end			
			ataxiagui.Chat.Allcenter:decho(text.."\n")
		end

    if string.find(gmcp.Comm.Channel.Start:lower(), "tell") and not string.find(gmcp.Comm.Channel.Start:lower(), "army") and not muteList[person] and person ~= "You" then 
        ataxiaBasher_alert("Normal") 
    end    

	end
	only_to_misc = false	
	
end

function ataxiagui_captureChat()
  if ataxia.usegui ~= nil and ataxia.usegui == false then return end
	local ch = gmcp.Comm.Channel.Start

	if not ataxiagui.Chat.Channels then
		ataxiagui_populateChannels()
	end
	ataxiagui.Chat.Channels.talker = gmcp.Comm.Channel.Text.talker:title()
	ataxiagui.Chat.Channels.last = "Misc"

	for c, t in pairs(ataxiagui.Chat.Channels.types) do
		if ch:find(c) then
			ataxiagui.Chat.Channels.last = t
			break
		end
	end
  
	if t == "Tells" and not muteList[ataxiagui.Chat.Channels.talker] and ataxiagui.Chat.Channels.talker ~= "You" then 
    ataxiaBasher_alert("Normal") 
  end

	enableTrigger("Ataxia Chat Capture")

	
	--Check if it was over Party, and if it was a target call.
--	if ch == "web" and helixTemp.webListen and helixTemp.webListen[helixgui.Chat.Channels.talker] then
--		local spoken = gmcp.Comm.Channel.Text.text
--		if spoken:find("Target") then
--			local tc = string.match(spoken, "Target: (%w+)%.")
--			--If it was matched correctly, then change target!
--			switchTarget(tc)
--		end
--	end
	
	ataxiagui_processChat(ataxiagui.Chat.Channels.last)



end

registerAnonymousEventHandler("gmcp.Comm.Channel.Start", "ataxiagui_captureChat")</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Vitals Related</name>
										<packageName></packageName>
										<script>function ataxiagui_vitalsElements()
	ataxiagui.balIdentifier = Geyser.Label:new({
		x = "2%", y = 5,
		width = 30, height = 30,
	}, ataxiagui.bottomContainer)
	ataxiagui.balIdentifier:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[onBal.png")]])

	ataxiagui.eqIdentifier = Geyser.Label:new({
		x = "2%", y = 35,
		width = 30, height = 30.
	}, ataxiagui.bottomContainer)
	ataxiagui.eqIdentifier:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[onBal.png")]])
--------------------------------------------------------------------------------------------------------------
	ataxiagui.healthGauge = Geyser.Gauge:new({
		name = "ataxiagui.healthGauge",
		x = "6%", y = 12,
		width = "50%", height = 16,
		fontSize = 12,
	}, ataxiagui.bottomContainer)

	ataxiagui.healthGauge.front:setStyleSheet([[
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #4a0003, stop: 0.1 #fdccce, stop: 0.49 #f7000b, stop: 0.5 #f7000b, stop: 1 #620004);
		border-top: 2px black solid;
		border-left: 1px black solid;
		border-bottom: 1px black solid;
		border-radius: 10;
		padding: 3px;]])
	ataxiagui.healthGauge.back:setStyleSheet([[
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 0, y2: 1,  stop: 0 #8a2f2f, stop: .25 #581111, stop: .53 #250707, stop: .84 #7e1919, stop: 1 #b17575,);
		border-width: 2px;
		border-color: black;
		border-style: solid;
		border-radius: 12;
		padding: 3px;]]) 
	ataxiagui.healthGauge:setValue(40, 100)

	ataxiagui.healthGaugeClear = Geyser.Gauge:new({
		name = "ataxiagui.healthGaugeClear",
		x = "6%", y = 12,
		width = "50%", height = 16,
		fontSize = 12,
	}, ataxiagui.bottomContainer)

	ataxiagui.healthGaugeClear.front:setStyleSheet([[ 
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 1, y2: 0, stop: 0 rgba(2,2,2,255), stop: .02 rgba(29,29,29,255),stop: .19 rgba(255,255,255,166), stop: .37 rgba(2,2,2,69), stop: .50 rgba(2,2,2,0), stop: .78 rgba(2,2,2,107), stop: .89 rgba(2,2,2,77), stop: .94 rgba(80,113,117,61), stop: .99 rgba(158,224,232,255), stop: 1 rgba(173,246,255,255));
    border: 1px solid rgba(208,208,208,100);    
		border-top: 2px black solid;
		border-left: 1px black solid;
		border-bottom: 1px black solid;
		border-radius: 10;
    padding: 3px;
	]])
	ataxiagui.healthGaugeClear.back:setStyleSheet([[
		background-color: transparent;
		border-width: 2px;
		border-color: black;
		border-style: solid;
		border-radius: 12;
    padding: 3px;
	]])
	ataxiagui.healthGaugeClear:setValue(100,100,"&lt;B&gt;&lt;left&gt;&lt;font face = 'Merienda' color = 'white' size = '2'&gt;".."Health: 15%".."&lt;/font&gt;&lt;/left&gt;")

--------------------------------------------------------------------------------------------------------------
	ataxiagui.manaGauge = Geyser.Gauge:new({
		name = "ataxiagui.manaGauge",
		x = "6%", y = 42,
		width = "50%", height = 16,
		fontSize = 12,
	}, ataxiagui.bottomContainer)

	ataxiagui.manaGauge.front:setStyleSheet([[
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #12655d, stop: 0.1 #b9d8d5, stop: 0.49 #177f75, stop: 0.5 #177f75, stop: 1 #09322e);
		border-top: 0px black solid;
		border-left: 2px black solid;
		border-bottom: 1px black solid;
		border-radius: 9;
		padding: 3px;]])
	ataxiagui.manaGauge.back:setStyleSheet([[
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #7f7f7f, stop: 0.1 #000000, stop: 0.49 #000000, stop: 0.5 #191919, stop: 1 #02545f);
		border-width: 2px;
		border-color: black;
		border-style: solid;
		border-radius: 9;
		padding: 3px;
		border-top: 2px #cccccc solid;]])
	ataxiagui.manaGauge:setValue(40, 100)


	ataxiagui.manaGaugeClear = Geyser.Gauge:new({
		name = "ataxiagui.manaGaugeClear",
		x = "6%", y = 42,
		width = "50%", height = 16,
		fontSize = 12,
	}, ataxiagui.bottomContainer)
	ataxiagui.manaGaugeClear.front:setStyleSheet([[ 
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 1, y2: 0, stop: 0 rgba(2,2,2,255), stop: .02 rgba(29,29,29,255),stop: .19 rgba(255,255,255,166), stop: .37 rgba(2,2,2,69), stop: .50 rgba(2,2,2,0), stop: .78 rgba(2,2,2,107), stop: .89 rgba(2,2,2,77), stop: .94 rgba(80,113,117,61), stop: .99 rgba(158,224,232,255), stop: 1 rgba(173,246,255,255));
    border: 1px solid rgba(208,208,208,100);    
		border-top: 2px black solid;
		border-left: 1px black solid;
		border-bottom: 1px black solid;
		border-radius: 10;
    padding: 3px;
	]])
	ataxiagui.manaGaugeClear.back:setStyleSheet([[
		background-color: transparent;
		border-width: 2px;
		border-color: black;
		border-style: solid;
		border-radius: 12;
    padding: 3px;
	]])
	ataxiagui.manaGaugeClear:setValue(100,100,"&lt;B&gt;&lt;left&gt;&lt;font face = 'Merienda' color = 'white' size = '2'&gt;".."Mana: 15%".."&lt;/font&gt;&lt;/left&gt;")

--------------------------------------------------------------------------------------------------------------
	ataxiagui.xpGauge = Geyser.Gauge:new({
		name = "ataxiagui.xpGauge",
		x = "3%", y = "22%",
		width = "94%", height = "56%",
		fontSize = 12,
	}, ataxiagui.topContainer)

	ataxiagui.xpGauge.front:setStyleSheet([[
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 rgba(170,0,255,255), stop: .05 rgba(179,27,255,255), stop: .23 rgba(255,255,255,166), stop: .39 rgba(170,0,255,69), stop: .51 rgba(170,0,255,0), stop: .76 rgba(170,0,255,107), stop: .96 rgba(170,0,255,255), stop: 1 rgba(170,0,255,255));
		border-top: 2px black solid;
		border-left: 1px black solid;
		border-bottom: 1px black solid;
		border-radius: 10;
		padding: 3px;]])
	ataxiagui.xpGauge.back:setStyleSheet([[
		background-color: background-color: QLinearGradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 rgba(145,106,183,255), stop:.7 rgba(149,125,177,255), stop:.40 rgba(126,89,163,255),stop:.65 rgba(128,2,255,255), stop:.86 rgba(140,11,226,255), stop: 1 rgba(172,26,191,255));
		border-width: 2px;
		border-color: black;
		border-style: solid;
		border-radius: 12;
		padding: 3px;]])
	ataxiagui.xpGauge:setValue(40, 100)


	ataxiagui.xpGaugeClear = Geyser.Gauge:new({
		name = "ataxiagui.xpGaugeClear",
		x = "3%", y = "22%",
		width = "94%", height = "56%",
		fontSize = 12,
	}, ataxiagui.topContainer)
	ataxiagui.xpGaugeClear.front:setStyleSheet([[ 
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 1, y2: 0, stop: 0 rgba(2,2,2,255), stop: .03 rgba(29,29,29,255),stop: .11 rgba(255,255,255,166), stop: .36 rgba(2,2,2,69), stop: .47 rgba(2,2,2,0), stop: .76 rgba(2,2,2,107), stop: .84 rgba(2,2,2,77), stop: .94 rgba(80,113,117,61), stop: .99 rgba(158,224,232,255), stop: 1 rgba(173,246,255,255));
		border-top: 2px black solid;
		border-left: 1px black solid;
		border-bottom: 1px black solid;
		border-radius: 10;
    padding: 3px;
	]])
	ataxiagui.xpGaugeClear.back:setStyleSheet([[
		background-color: transparent;
		border-width: 2px;
		border-color: black;
		border-style: solid;
		border-radius: 12;
    padding: 3px;
	]])
	ataxiagui.xpGaugeClear:setValue(100,100,"&lt;B&gt;&lt;left&gt;&lt;font face = 'Merienda' color = 'white' size = '2'&gt;".."To next level: 15%".."&lt;/font&gt;&lt;/left&gt;")

--------------------------------------------------------------------------------------------------------------
end

function ataxiagui_updateVitals()
  if ataxia.usegui == nil or ataxia.usegui == true then
  
    if ataxia.vitals.bal then
      ataxiagui.balIdentifier:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[onBal.png")]])
    else
      ataxiagui.balIdentifier:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[offBal.png")]])
    end

    if ataxia.vitals.eq then
      ataxiagui.eqIdentifier:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[onBal.png")]])
    else
      ataxiagui.eqIdentifier:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[offBal.png")]])
    end

    ataxiagui.healthGaugeClear:setValue(100,100,"&lt;left&gt;&lt;font face = 'Lucida Console' color = 'black' size = '3'&gt;".." Health: "..ataxia.vitals.hp.."/"..ataxia.vitals.maxhp.."&lt;/font&gt;&lt;/left&gt;")
    ataxiagui.healthGauge:setValue(ataxia.vitals.hpp, 100)

    ataxiagui.manaGaugeClear:setValue(100,100,"&lt;left&gt;&lt;font face = 'Lucida Console' color = 'black' size = '3'&gt;".." Mana: "..ataxia.vitals.mp.."/"..ataxia.vitals.maxmp.."&lt;/font&gt;&lt;/left&gt;")
    ataxiagui.manaGauge:setValue(ataxia.vitals.mpp, 100)
	
    ataxiagui.xpGaugeClear:setValue(100,100,"&lt;left&gt;&lt;font face = 'Lucida Console' color = 'black' size = '3'&gt;".." &gt;&gt;&gt; To next level: "..ataxia.vitals.xp.."% &lt;/font&gt;&lt;/left&gt;")
    ataxiagui.xpGauge:setValue(ataxia.vitals.xp, 100)
	
    if ataxiaTemp.basherRooms then
      ataxiaTemp.basherBarHidden = false
      ataxiagui.basherBarClear:setValue(100,100, "&lt;left&gt;&lt;font face = 'Lucida Console' color = 'black' size = '3'&gt;".." Rooms Left: "..#ataxiaBasher_path.."/"..ataxiaTemp.basherRooms.." &lt;/font&gt;&lt;/left&gt;")
      ataxiagui.basherBar:setValue(#ataxiaBasher_path, ataxiaTemp.basherRooms)
    elseif not ataxiaTemp.basherBarHidden then
      ataxiagui.basherBar:hide()
      ataxiagui.basherBarClear:hide()
      ataxiaTemp.basherBarHidden = true
    end
 end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Small Map / Small Chat</name>
										<packageName></packageName>
										<script>function ataxiagui_createSmallMap()
	ataxiagui.mapBG = Geyser.Label:new({
		x = "10%", y = "5%",
		width = "80%", height = "32%",
	}, ataxiagui.rightContainer)
	ataxiagui.mapBG:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[ataxiaBorder.png")]])

	ataxiagui.mapper = Geyser.Mapper:new({
		x = "12%", y = "7%",
		width = "76%", height = "28%",
	}, ataxiagui.rightContainer)

	ataxiagui.mapRoom = Geyser.Label:new({
		x = "10%", y = "1%",
		width = "80%", height = "3%",
	}, ataxiagui.rightContainer)
	ataxiagui.mapRoom:setStyleSheet([[
		background-color: transparent;
    		border-width: 2px;
    		border-color: transparent;
    		border-style: solid;
    		border-radius: 14;
    		padding: 3px;
	]])
	ataxiagui.mapRoom:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="NavajoWhite"&gt;&lt;font face="Merienda"&gt;]].."Room Area"..[[&lt;/font&gt;&lt;/p&gt;]] )

	ataxiagui.mapExits = Geyser.Label:new({
		x = "10%", y = "4%",
		width = "80%", height = "3%",
	}, ataxiagui.rightContainer)
	ataxiagui.mapExits:setStyleSheet([[
		background-color: transparent;
    		border-width: 2px;
    		border-color: transparent;
    		border-style: solid;
    		border-radius: 14;
    		padding: 3px;
	]])
	ataxiagui.mapExits:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="NavajoWhite"&gt;&lt;font face="Merienda"&gt;]].."Room Exits"..[[&lt;/font&gt;&lt;/p&gt;]] )
-------------------------------------------------------------------------------------------------------------------------------------------------------------------
	ataxiagui.basherBar = Geyser.Gauge:new({
		name = "ataxiagui.basherBar",
		x = "10%", y = "38%",
		width = "80%", height = "2%",
		fontSize = 12,
	}, ataxiagui.rightContainer)

	ataxiagui.basherBar.front:setStyleSheet([[
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #f1f34e, stop: 0.1 #eef022, stop: 0.49 #a5db67, stop: 0.5 #a5db67, stop: 1 #5e5e19);
		border-top: 2px black solid;
		border-left: 1px black solid;
		border-bottom: 1px black solid;
		border-radius: 10;
		padding: 3px;]])
	ataxiagui.basherBar.back:setStyleSheet([[
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #f8f9a6, stop: 0.1 #bec01b, stop: 0.49 #777811, stop: 0.5 #777811, stop: 1 #2f3006);
		border-width: 2px;
		border-color: black;
		border-style: solid;
		border-radius: 12;
		padding: 3px;]]) 
	ataxiagui.basherBar:setValue(40, 100)
	ataxiagui.basherBar:hide()
	
	ataxiagui.basherBarClear = Geyser.Gauge:new({
		name = "ataxiagui.basherBarClear",
		x = "10%", y = "38%",
		width = "80%", height = "2%",
		fontSize = 12,
	}, ataxiagui.rightContainer)

	ataxiagui.basherBarClear.front:setStyleSheet([[ 
		background-color: QLinearGradient(x1: 0, y1: 0, x2: 1, y2: 0, stop: 0 rgba(2,2,2,255), stop: .02 rgba(29,29,29,255),stop: .19 rgba(255,255,255,166), stop: .37 rgba(2,2,2,69), stop: .50 rgba(2,2,2,0), stop: .78 rgba(2,2,2,107), stop: .89 rgba(2,2,2,77), stop: .94 rgba(80,113,117,61), stop: .99 rgba(158,224,232,255), stop: 1 rgba(173,246,255,255));
    border: 1px solid rgba(208,208,208,100);    
		border-top: 2px black solid;
		border-left: 1px black solid;
		border-bottom: 1px black solid;
		border-radius: 10;
    padding: 3px;
	]])
	ataxiagui.basherBarClear.back:setStyleSheet([[
		background-color: transparent;
		border-width: 2px;
		border-color: black;
		border-style: solid;
		border-radius: 12;
    padding: 3px;
	]])
	ataxiagui.basherBarClear:setValue(100,100,"&lt;B&gt;&lt;left&gt;&lt;font face = 'Merienda' color = 'white' size = '2'&gt;".."Rooms".."&lt;/font&gt;&lt;/left&gt;")
	ataxiagui.basherBarClear:hide()
end

function ataxiagui_createSmallChat()
	ataxiagui.Chat = {}
	ataxiagui.chatBG = Geyser.Label:new({
		x = 0, y = "42%",
		width = 450, height = "57%",
	}, ataxiagui.rightContainer)
	ataxiagui.chatBG:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[ataxiaBorder.png")]])

	ataxiagui.Chat = {
		tabs = {"All", "City", "Clans" ,"Misc", "Order", "Party", "Tells"},
		colour1 = "DarkGreen",
		colour2 = "black",
		current = "",
		wrapWidth = math.floor(410/7)
	}

	ataxiagui.Chat.container = Geyser.Container:new({
		x = 10, y = "45%",
		width = 430, height = "51%",
	}, ataxiagui.rightContainer)

	ataxiagui.Chat.header = Geyser.HBox:new({
		name = "ataxiagui.Chat.header",
		x = 0, y = 0,
		width = "100%", height = "4%"
	}, ataxiagui.Chat.container)

	ataxiagui.Chat.footer = Geyser.Label:new({
		name = "ataxiagui.Chat.footer",
		x = 0, y = "4%",
		width = "100%", height = "96%"
	}, ataxiagui.Chat.container)
	ataxiagui.Chat.footer:setStyleSheet([[
		background-color: black;
		border-color: black;
		border-bottom-left-radius: 8px;
		border-bottom-right-radius: 8px;
	]])

	ataxiagui.Chat.center = Geyser.Label:new({
		name = "ataxiagui.Chat.center",
		x = 0, y = 0,
		width = "100%", height = "100%",
	}, ataxiagui.Chat.footer)
	ataxiagui.Chat.center:setStyleSheet([[
		background-color: black;
		border-color: black;
		border-radius: 8px;
		margin: 5px;]])

	for _, sec in pairs(ataxiagui.Chat.tabs) do
		--The individual tabs
		ataxiagui.Chat[sec.."tab"] = Geyser.Label:new({
			name = "ataxiagui.Chat."..sec.."tab"
		}, ataxiagui.Chat.header)
		ataxiagui.Chat[sec.."tab"]:setStyleSheet([[border-image: url("]]..ataxiagui_dir..[[chatTab.png")]])
		ataxiagui.Chat[sec.."tab"]:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="red"&gt;&lt;font face="Merienda"&gt;]]..sec..[[&lt;/font&gt;&lt;/p&gt;]] )
		ataxiagui.Chat[sec.."tab"]:setClickCallback("ataxiagui_chatSelect", sec)

		--Windows where the consoles are placed
		ataxiagui.Chat[sec] = Geyser.Label:new({
			name = "ataxiagui.Chat."..sec,
			x = 0, y = 0,
			width = "100%", height = "100%"
		}, ataxiagui.Chat.footer)
		ataxiagui.Chat[sec]:setStyleSheet([[
			background-color: black;
			border-bottom-left-radius: 5px;
			border-bottom-right-radius: 5px
		]])
	
		--Consoles where the text is placed
		ataxiagui.Chat[sec.."center"] = Geyser.MiniConsole:new({
			name = "ataxiagui.Chat."..sec.."center",
			x = "1%", y = "1%",
			width = "98%", height = "98%",
			color = "black"
		}, ataxiagui.Chat[sec])
		ataxiagui.Chat[sec.."center"]:setFontSize(8)
		ataxiagui.Chat[sec.."center"]:setWrap(ataxiagui.Chat.wrapWidth)
		ataxiagui.Chat[sec]:hide()
	end
	ataxiagui.Chat.current = "All"
	ataxiagui.Chat.All:show()
	ataxiagui.Chat.Alltab:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="green"&gt;&lt;font face="Merienda"&gt;]].."All"..[[&lt;/font&gt;&lt;/p&gt;]] )
end</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Gmcp Related</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Update Stuff</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>ataxia_Players_Update</name>
											<packageName></packageName>
											<script>function ataxia_Players_Update(event)
	--Create the table if it's not already there.
	ataxia.playersHere = ataxia.playersHere or {}
	ataxiaBasher.ignore = ataxiaBasher.ignore or {}
   ataxiaBasher_stormhammer()  
	--For QL/Entering a room.
	if event == "gmcp.Room.Players" then
		--Reset the table, then parse the gmcp one to add people that aren't you.
		ataxia.playersHere = {}
		local me = gmcp.Char.Status.name:title()
		for _, tab in pairs(gmcp.Room.Players) do
			if tab.name ~= me then
				table.insert(ataxia.playersHere, tab.name)
				if type(target) == "string" and isTargeted(tab.name) then
					disableTimer("TargetOutOfRoom")
					targetIshere = true
				end
			end
		end
		if type(target) == "string" and not table.contains(ataxia.playersHere, target) then
			enableTimer("TargetOutOfRoom")
			targetIshere = false
		end

		if ataxiaTemp.autoFollow then
			if not table.contains(ataxia.playersHere, ataxiaTemp.autoFollow) then
				ataxiaTemp.following = false
				ataxiaEcho("We've been lost! Checking diag then going back!")
				sendAll("diagnose", "queue addclear freestand walkto "..ataxiaTemp.autoFollow)
			elseif table.contains(ataxia.playersHere, ataxiaTemp.autoFollow) and not ataxiaTemp.following then
				send("follow "..ataxiaTemp.autoFollow)
			end
		end


	--For when someone enters your room.
	elseif event == "gmcp.Room.AddPlayer" then
		local person = gmcp.Room.AddPlayer
		--If the person isn't already in the list, then add them.
		if not table.contains(ataxia.playersHere, person.name) then
			table.insert(ataxia.playersHere, person.name)
			if not table.contains(ataxiaBasher.ignore, person.name) and ataxiaBasher.enabled then
				ataxiaEcho("Someone is here! --- "..person.name)
				ataxiaBasher_alert("Normal")
			end
		end
		if type(target) == "string" and isTargeted(person.name) then
			disableTimer("TargetOutOfRoom")
			targetIshere = true
		end
	--For when someone leaves your room.
	else
		local person = gmcp.Room.RemovePlayer
		table.remove(ataxia.playersHere, table.index_of(ataxia.playersHere, person))

		if type(target) == "string" and isTargeted(person) then
			enableTimer("TargetOutOfRoom")
			targetIshere = false
		end

	end

	--Update the gui with new information.
	ataxia_Update_Players()
end

function ataxia_Update_Players()

  if ataxia.usegui or ataxia.usegui == nil then
    ataxiagui.playersConsole:clear()
    ataxiagui.playersConsole:setFontSize(8)
    ataxiagui.playersConsole:setWrap(25)
  elseif zgui then
    clearUserWindow("roomPlayersDisplay")
  end
  
	if #ataxia.playersHere &gt; 0 then
    if zgui then
		  cecho("roomPlayersDisplay","&lt;orange&gt;"..#ataxia.playersHere.." &lt;NavajoWhite&gt;"..(#ataxia.playersHere == 1 and "other" or "others").." here:")
		  cecho("roomPlayersDisplay","\n&lt;green&gt; "..table.concat(ataxia.playersHere, ", ")..".")    
    else
		  ataxiagui.playersConsole:cecho("&lt;orange&gt;"..#ataxia.playersHere.." &lt;NavajoWhite&gt;"..(#ataxia.playersHere == 1 and "other" or "others").." here:")
		  ataxiagui.playersConsole:cecho("\n&lt;green&gt; "..table.concat(ataxia.playersHere, ", ")..".")
    end
	else
    if zgui then
      cecho("roomPlayersDisplay","\n\n &lt;NavajoWhite&gt;No one but you is standing here... \n\n\n    ...We think...")
    else
		  ataxiagui.playersConsole:cecho("\n\n &lt;NavajoWhite&gt;No one but you is standing here... \n\n\n    ...We think...")
    end
	end
end</script>
											<eventHandlerList>
												<string>gmcp.Room.Players</string>
												<string>gmcp.Room.AddPlayer</string>
												<string>gmcp.Room.RemovePlayer</string>
											</eventHandlerList>
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>ataxia_Room_Update</name>
											<packageName></packageName>
											<script>function ataxia_Room_Update()
 ataxiaBasher_stormhammer()  
	if not gmcp.Room.Info then return end
	if ataxiaBasher.enabled and ataxia.settings.roomshorten then enableTrigger("Room Info Shortener") end
	
  if ataxiaBasher.enabled then need_roomCheck = true end
  
	setMapZoom(8)
	centerview(gmcp.Room.Info.num)
	
	gPreviousRoom = gPreviousRoom or 0	
	gCurrentRoom = tonumber(gmcp.Room.Info.num)
	
	if not env_to_get then get_herbHarvestTable() end

	if ataxiaBasher.enabled and not ataxiaBasher.manual then
		for i, n in pairs(ataxiaBasher_path) do
			if tonumber(gmcp.Room.Info.num) == n then
				table.remove(ataxiaBasher_path, i)
				break
			end
		end
		if autoHarvesting and not harvested_in_room_stuff() and table.contains(env_to_get, gmcp.Room.Info.environment) then
			mmp.pause("on")
		end
	end

	if mapping_path ~= nil and not table.contains(mapping_path, gmcp.Room.Info.num) and mapping_bpath == true then
		table.insert(mapping_path, gmcp.Room.Info.num)
		ataxiaEcho(gmcp.Room.Info.num.." added.")
	end

	room_exits = {}
	for i,v in pairs(gmcp.Room.Info.exits) do
		table.insert(room_exits, i:upper())
	end
	room_exitstr = table.concat(room_exits, ", ")

	if ataxiaBasher.targetList then
		if not ataxiaBasher.targetList[gmcp.Room.Info.area] then
			ataxiaBasher.targetList[gmcp.Room.Info.area] = {}
			ataxiaEcho("Added "..gmcp.Room.Info.area.." to areas.")
		end
	end

	local roomInfo = "(v"..gmcp.Room.Info.num..") - "..gmcp.Room.Info.area.." - "..gmcp.Room.Info.name

  if ataxia.usegui == nil or ataxia.usegui == true then
    ataxiagui.mapRoom:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="NavajoWhite"&gt;&lt;font face="Merienda"&gt;]]..roomInfo..[[&lt;/font&gt;&lt;/p&gt;]] )
    ataxiagui.mapExits:echo([[&lt;p style="font-size:12px"&gt;&lt;center&gt;&lt;font color="NavajoWhite"&gt;&lt;font face="Merienda"&gt;]].."[ "..room_exitstr.." ]"..[[&lt;/font&gt;&lt;/p&gt;]] )
  elseif zgui then
    zgui.showRoomInfo()
  end
	
	if ataxia_isClass("Bard") then
		ataxiaTemp.harmsRoom = ataxiaTemp.harmsRoom or 0
		if gCurrentRoom ~= gPreviousRoom and gCurrentRoom ~= ataxiaTemp.harmsRoom then
			bardHarmsInRoom = false
		end
	end

	if ataxiaTemp.bashFlee then
		if not table.contains(ataxiaBasher_path, gPreviousRoom) then
			table.insert(ataxiaBasher_path, 1, gPreviousRoom)
		end
	end
	
  local bubbleEnv = {"Freshwater", "Ocean", "River",}
  local wDefs = ataxia.settings.defences
  if wDefs.current ~= "" and wDefs.current ~= nil and wDefs.current ~= "empty" then
    if (wDefs.defup[wDefs.current].grookbubble or wDefs.keepup[wDefs.current].grookbubble) and not ataxia.defences.grookbubble then
      if table.contains(gmcp.Room.Info.details, "underwater") or table.contains(bubbleEnv, gmcp.Room.Info.environment) then
        if not triedBubble then
          send("form bubble",false)
          triedBubble = tempTimer(3, [[ triedBubble = nil ]])
        end
      end
    end
  end
  
  if gCurrentRoom ~= gPreviousRoom then vibes_inRoom = {} end
	gPreviousRoom = tonumber(gmcp.Room.Info.num)
end
</script>
											<eventHandlerList>
												<string>gmcp.Room</string>
											</eventHandlerList>
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>ataxia_RoomContents_Update</name>
											<packageName></packageName>
											<script>function ataxia_RoomContents_Update(event)
	--Create the table if it's not already there.
   ataxiaBasher_stormhammer()  
	ataxia.denizensHere = ataxia.denizensHere or {}
	atempDenizens = atempDenizens or {}
	waterGuards = waterGuards or {}
  if gmcp.Char.Items.List.location ~= "inv" then
    ataxia.lightwall = false
    ataxiaTemp.monolith = false
  end
	ataxiaBasher_skipRoom = false

	--For QL/Entering a room.
	if event == "gmcp.Char.Items.List" and gmcp.Char.Items.List.location ~= "inv" then
		ataxia.denizensHere = {}
		atempDenizens = {}
		ataxiaTemp.goldInRoom = false
		local ignoreCount = 0
		for i,v in pairs(gmcp.Char.Items.List.items) do
      if v.name:find("lightwall") then
        ataxia.lightwall = true 
      elseif v.name:find("monolith") then
        ataxiaTemp.monolith = true
			elseif v.attrib and v.attrib ~= "t" and v.attrib ~= "mdt" and v.icon ~= "guard" then
				ataxia.denizensHere[tonumber(v.id)] = v.name
				
				if (v.name == "a guarded firewall" or v.name == "an audacious guardsman" or v.name == "a Vault guardian") and not table.contains(waterGuards, v.id) and #waterGuards &lt; 10 and beckonGuards then
					send("beckon "..v.id)
					table.insert(waterGuards, v.id)
				elseif v.name == "an audacious guardsman" and not table.contains(waterguards, v.id) and #waterGuards &lt; 10 and saluteGuards then
					send("wsalute "..v.id)
					table.insert(waterGuards, v.id)
				elseif v.name == "a Coterie councillor" and not table.contains(waterguards, v.id) and #waterGuards &lt; 15 and saluteGuards then
					sendAll("grab "..v.id,false)
					table.insert(waterGuards, v.id)
				elseif v.name == "a Coterie councillor" and not table.contains(waterGuards, v.id) and #waterGuards &lt; 10 and beckonGuards then
					sendAll("give document to "..v.id, "g document")
					table.insert(waterGuards, v.id)
				end
				
				atempDenizens[tonumber(v.id)] = v.name
				
			elseif v.icon == "coin" then
				ataxiaTemp.goldInRoom = true
      elseif table.contains(item_Pickup, v.name) then
        send("get "..v.id,false)
			end
  if ataxiaBasher.enabled then ataxiaBasher_stormhammer() end
		end
	
	--Remove (either by leaving, or dying)
	elseif event == "gmcp.Char.Items.Remove" then
  
		for i,v in pairs(ataxia.denizensHere) do
      
			if tonumber(i) == tonumber(gmcp.Char.Items.Remove.item.id) then
        table.remove(stormhammerTargets,gmcp.Char.Items.Remove.item.id)
				ataxia.denizensHere[i] = nil
      if ataxiaBasher.enabled then ataxiaBasher_stormhammer() end
			end
    
      
      if ataxiaTemp.retarget and tonumber(i) == ataxiaTemp.retarget then
        ataxiaTemp.retarget = nil
        ataxiaTemp.retargetsecond = nil
        if ataxiaTemp.mobshieldtimer then killTimer(ataxiaTemp.mobshieldtimer); ataxiaTemp.mobshieldtimer = nil end
      end
		end
		if gmcp.Char.Items.Remove.item.icon == "coin" then
			ataxiaTemp.goldInRoom = false
    elseif gmcp.Char.Items.Add.location == "room" and gmcp.Char.Items.Remove.item.name == "a monolith sigil" then
      ataxiaTemp.monolith = false
		end		
		
	--Add the denizen.
	else
		if gmcp.Char.Items.Add.location == "room" and gmcp.Char.Items.Add.item.attrib ~= "t" and gmcp.Char.Items.Add.item.icon ~= "guard" then
			ataxia.denizensHere[gmcp.Char.Items.Add.item.id] = gmcp.Char.Items.Add.item.name
			atempDenizens[gmcp.Char.Items.Add.item.id] = gmcp.Char.Items.Add.item.name
		end
		if gmcp.Char.Items.Add.item.icon == "coin" then
			if ataxiaBasher.enabled then
				ataxiaTemp.goldInRoom = true
			end
		end
		if gmcp.Char.Items.Add.item.name == "a lightwall" then
			ataxia.lightwall = true
    elseif gmcp.Char.Items.Add.location == "room" and gmcp.Char.Items.Add.item.name == "a monolith sigil" then
      ataxiaTemp.monolith = true
		end
    
	end

	--Trigger the update of the list.
	raiseEvent("targets updated")

	--Update the gui.
	ataxia_Update_RoomContents()

end

function ataxia_Update_RoomContents() 
  if ataxia.usegui == nil or ataxia.usegui == true then
    ataxiagui.roomConsole:clear()
    ataxiagui.roomConsole:setFontSize(7)
  elseif zgui then
    clearUserWindow("roomDenizensDisplay")
    zgui.showRoomInfo()
  end

	for id, denizen in pairs(ataxia.denizensHere) do
    if ataxia.usegui == nil or ataxia.usegui == true then
		  ataxiagui.roomConsole:cecho("\n&lt;a_darkcyan&gt;[&lt;DodgerBlue&gt;"..string.rep(" ", 6-string.len(id))..id.."&lt;a_darkcyan&gt;] &lt;NavajoWhite&gt;"..denizen:title())
    else
      cecho("roomDenizensDisplay", "\n&lt;a_darkcyan&gt;[&lt;DodgerBlue&gt;"..string.rep(" ", 6-string.len(id))..id.."&lt;a_darkcyan&gt;] &lt;NavajoWhite&gt;"..denizen:title())
    end
	end
end

function mob_isHere(what)
	local found = false
	for id, name in pairs(ataxia.denizensHere) do
		if id == what or name:title() == what:title() then
			found = true
			return true
		end
	end
	if not found then return false end
end</script>
											<eventHandlerList>
												<string>gmcp.Char.Items.List</string>
												<string>gmcp.Char.Items.Remove</string>
												<string>gmcp.Char.Items.Add</string>
											</eventHandlerList>
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>ataxia_Vitals_Update</name>
											<packageName></packageName>
											<script>function ataxia_Vitals_Update()
	local stats = gmcp.Char.Vitals.charstats
	local stance = ""
	ataxiaTemp.class = ataxiaTemp.class or gmcp.Char.Status.class	
	if not gmcp.Char.Vitals.hp then return end 
	 ataxiaBasher_stormhammer()  
	if not ataxia.vitals or not ataxia.vitals.hp then
		ataxia.vitals = {
			hp = tonumber(gmcp.Char.Vitals.hp),
			maxhp = tonumber(gmcp.Char.Vitals.maxhp),
			mp = tonumber(gmcp.Char.Vitals.mp),
			maxmp = tonumber(gmcp.Char.Vitals.maxmp),
			ep = tonumber(gmcp.Char.Vitals.ep),
			maxep = tonumber(gmcp.Char.Vitals.maxep),
			wp = tonumber(gmcp.Char.Vitals.wp),
			maxwp = tonumber(gmcp.Char.Vitals.maxwp),
			xp = tonumber(gmcp.Char.Vitals.nl),
		}
	end
	ataxia.vitals.hpp = math.floor((ataxia.vitals.hp/ataxia.vitals.maxhp)*100)
	ataxia.vitals.mpp = math.floor((ataxia.vitals.mp/ataxia.vitals.maxmp)*100)
	ataxia.vitals.stance = false
	ataxia.vitals.class = 0
	
	for _,str in ipairs(stats) do
		local sep = str:find(": ")
		if sep then
			local key = str:sub(1, sep - 1)
			local val = str:sub(sep + 2)
			if key == "Form" then
				stance = val
				if not ataxia.vitals.form then
					ataxia.vitals.form = val
					ataxia.vitals.oldform = val
          shikudo_checkForms()
				else
					if stance ~= ataxia.vitals.form then
						ataxia.vitals.oldform = ataxia.vitals.form
						ataxia.vitals.form = stance
            shikudo_checkForms()
					end
				end
      elseif key == "Spec" then
        ataxia.vitals.knight = val
			elseif key == "Ferocity" or key == "Momentum" or key == "Spark" then
				ataxia.vitals.class = tonumber(val)
      elseif key == "Anathema" then
        ataxia.vitals.anathema = (val == "Yes")
      elseif key == "Kata" then
        ataxia.vitals.kata = tonumber(val)
			elseif key == "Stance" then
				ataxia.vitals.stance = val
      elseif key == "Voice" then
        ataxia.vitals.voice = val
			elseif key == "Morph" then
				ataxia.vitals.morph = val
      elseif key:lower() == "epitaph_length" then
        ataxia.vitals.epitaph = tonumber(val)
			elseif key == "Rage" then
				ataxia.vitals.rage = tonumber(val)
			elseif key == "Kai" or key == "Shin" then
				ataxia.vitals.class = tonumber( string.match(val, "%d+") )
			elseif key == "Wellspring" then
				ataxia.vitals.class = tonumber(string.match(val, "%d+"))
			end
		end
	end

	if ataxiaTemp.class ~= gmcp.Char.Status.class then
		systemDefup("none")
		ataxiaTemp.class = gmcp.Char.Status.class
		if ataxia_isClass("depthswalker") then
			ataxia_depthswalkerReset()
		end
    
    if ataxiaTemp.class:find("Dragon") or ataxiaTemp.class:find("Elemental") then
      mmp.settings:setOption("gallop", false)
    end
    
		load_Combat_Tables()
	end

	ataxia.vitals.oldhealth = ataxia.vitals.hp
	ataxia.vitals.hp = tonumber(gmcp.Char.Vitals.hp)
		if ataxia.vitals.hp &lt; ataxia.vitals.oldhealth and ataxiaBasher.enabled and not denizenAttack then
			enableTrigger("Denizen Attack Find")
		end

	ataxia.vitals.bleed = tonumber(string.match(stats[1], "Bleed: (%d+)"))
	ataxia.vitals.maxhp = tonumber(gmcp.Char.Vitals.maxhp)
	ataxia.vitals.mp = tonumber(gmcp.Char.Vitals.mp)
	ataxia.vitals.maxmp = tonumber(gmcp.Char.Vitals.maxmp)
	ataxia.vitals.hpp = math.floor((ataxia.vitals.hp/ataxia.vitals.maxhp)*100)
		if ataxia.vitals.hpp &gt; 100 then ataxia.vitals.hpp = 100 end
	ataxia.vitals.mpp = math.floor((ataxia.vitals.mp/ataxia.vitals.maxmp)*100)
		if ataxia.vitals.mpp &gt; 100 then ataxia.vitals.mpp = 100 end
	ataxia.vitals.ep = tonumber(gmcp.Char.Vitals.ep)
	ataxia.vitals.maxep = tonumber(gmcp.Char.Vitals.maxep)
	ataxia.vitals.epp = math.floor((ataxia.vitals.ep/ataxia.vitals.maxep)*100)
	ataxia.vitals.wp = tonumber(gmcp.Char.Vitals.wp)
	ataxia.vitals.maxwp = tonumber(gmcp.Char.Vitals.maxwp)
	ataxia.vitals.wpp = math.floor((ataxia.vitals.wp/ataxia.vitals.maxwp)*100)	
	ataxia.vitals.bal = (gmcp.Char.Vitals.bal == "1" and true or false)
	ataxia.vitals.eq = (gmcp.Char.Vitals.eq == "1" and true or false)
	ataxia.vitals.xp = tonumber(gmcp.Char.Vitals.nl)

  if not ataxia.lowhpalert then ataxia.lowhpalert = 35 end
	if ataxia.vitals.hpp &lt; ataxia.lowhpalert and ataxia.vitals.hpp ~= 0 then
		ataxiaBasher_alert("LowHealth")
	elseif ataxia.vitals.hp == 0 then
		if not ataxia_paused() then
			ataxiaToggle("off")
		end
	end


ataxiagui_updateVitals()
end
</script>
											<eventHandlerList>
												<string>gmcp.Char.Vitals</string>
											</eventHandlerList>
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Balance Tracking</name>
											<packageName></packageName>
											<script>function ataxia_gotbal(which)
 ataxiaBasher_stormhammer()  
  if ataxia.settings.highlighting.bals then
    if not ataxiaBasher.enabled or ataxiaBasher.manual then
      if not autoHarvesting and not autoExtracting then
        if ataxia.fishing and not ataxia.fishing.enabled then
          cecho(" &lt;green&gt;(&lt;DarkSlateBlue&gt;"..( math.floor((os.clock() - ataxia.bals.timestamps[which]) * 100) / 100).."s&lt;green&gt;)")
        end
      end
    end
  end

  ataxia.bals.timestamps[which] = os.clock()
end

function ataxia_checkBalances()
 ataxiaBasher_stormhammer()  
  for _, balType in pairs(ataxia.bals.get) do
    local bool = gmcp.Char.Vitals[balType] == "1"
    if ataxia.bals.used[balType] and not bool then
      ataxia.bals.timestamps[balType] = os.clock()
    end
    ataxia.bals.used[balType] = bool
  end
  
  if ataxia_isClass("bard") then
    local haveVoice = ataxia.vitals.voice == "Yes"
    if ataxia.bals.used.voice and not haveVoice then
      ataxia.bals.timestamps.voice = os.clock()
    end
    ataxia.bals.used.voice = haveVoice
  end
end

if ataxia.bals.handler then
  killAnonymousEventHandler(ataxia.bals.handler)
end
ataxia.bals.handler = registerAnonymousEventHandler("gmcp.Char.Vitals", "ataxia_checkBalances")</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Rift</name>
										<packageName></packageName>
										<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>Rift functions</name>
											<packageName></packageName>
											<script>function ataxia_riftContents()
	ataxiaTemp.riftContents = {}
	
	for _, tab in pairs(gmcp.IRE.Rift.List) do
		ataxiaTemp.riftContents[tab.name] = tonumber(tab.amount)
	end
end

function ataxia_riftUpdate()
	if not ataxiaTemp.riftContents then
		return
	end
	
	local item = gmcp.IRE.Rift.Change
	ataxiaTemp.riftContents[item.name] = tonumber(item.amount)
end

registerAnonymousEventHandler("gmcp.IRE.Rift.List", "ataxia_riftContents")
registerAnonymousEventHandler("gmcp.IRE.Rift.Change", "ataxia_riftUpdate")</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Precaching functions</name>
											<packageName></packageName>
											<script>local minerals = {"antimony", "argentum", "arsenic", "aurum", "azurite", "bisemutum", "calamine", "calcite", "cinnabar", "cuprum", "dolomite", "ferrum", "gypsum", "magnesium", "malachite", "plumbum", "potash", "quartz", "quicksilver", "realgar", "stannum"}
local herbs = {"ash", "bayberry", "bellwort", "bloodroot", "cohosh", "elm", "ginger", "ginseng", "goldenseal", "hawthorn", "kelp", "kola", "lobelia", "skullcap", "valerian", "sileris", "irid", "pear"}

ataxiaTemp.keepout = ataxiaTemp.keepout or {}

function populate_keepOut()
	ataxia.settings.precache = ataxia.settings.precache or {}
	ataxiaTemp.keepout = {}
	
	for i,v in pairs(ataxia.settings.precache) do
		ataxiaTemp.keepout[i] = v
	end
end

function ataxia_precacheSet(item, amount)
	local num = tonumber(amount)
	if table.contains(minerals, item) or table.contains(herbs, item) then
		if num &gt; 0 then
			ataxia.settings.precache[item] = num
			ataxia_precacheShow()
			populate_keepOut()
			ataxia_precacheQueue()
			ataxia_saveSettings(false)
		elseif num == 0 then
			ataxia.settings.precache[item] = nil
			ataxia_precacheShow()
			populate_keepOut()
			ataxia_precacheQueue()
			ataxia_saveSettings(false)			
		else
			ataxiaEcho("Number for precache must be 0 or higher.")
		end
	else
		ataxiaEcho("That is not a valid herb or mineral.")
	end
end

function ataxia_precacheShow()
	ataxiaEcho("System precache settings.")
	local outriftables = {"antimony", "argentum", "arsenic", "aurum", "azurite", "bisemutum", "calamine", "calcite", "cinnabar", "cuprum", 
		"dolomite", "ferrum", "gypsum", "magnesium", "malachite", "plumbum", "potash", "quartz", "quicksilver", "realgar", "stannum",
  	"ash", "bayberry", "bellwort", "bloodroot", "cohosh", "elm", "ginger", "ginseng", "goldenseal", "hawthorn", "kelp", "kola", "lobelia", 
		"skullcap", "valerian", "sileris", "irid", "pear"}
	table.sort(outriftables)
	local x = 0
	for n, item in spairs(outriftables) do
		x = x + 1
		local num = 0
		if ataxia.settings.precache[item] then
			num = ataxia.settings.precache[item]
		end		
		local d = "&lt;a_cyan&gt;[&lt;NavajoWhite&gt;"..num.."&lt;a_cyan&gt;] &lt;DimGrey&gt;"
		if (x-1)%3 == 0 then
			echo("\n")
		end
		cecho(d)
		local nWithSpace = item
		local length = nWithSpace:len() + math.floor(math.log10(math.max(1,num)))
		if length &lt; 25 and (x-1)%3 ~= 2 then
			local pad = 25 - length
			nWithSpace = string.rep(" ", pad)
		else
			nWithSpace = ""
		end
		cecho("&lt;DimGrey&gt;"..item:title())
		echo(" ")

		local increase = "pconfig "..item.." "..num + 1
		local decrease = "pconfig "..item.." "..num - 1
		echoLink("(+)", [[expandAlias("]]..increase..[[")]], "Increase outrift of "..item.." by 1.", true)
		echo(" ")
		echoLink("(-)", [[expandAlias("]]..decrease..[[")]], "Decrease outrift of "..item.." by 1.", true)
		cecho("&lt;DimGrey&gt;"..nWithSpace)
	end
	send(" ")		
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Outrifting Functions</name>
											<packageName></packageName>
											<script>--Set the Outrifted table.
ataxiaTemp.outrifted = {
	antimony = 0,
	argentum = 0,
	arsenic = 0,
	ash = 0,
	aurum = 0,
	azurite = 0,
	bayberry = 0,
	bellwort = 0,
	bisemutum = 0,
	bloodroot = 0,
	calamine = 0,
	calcite = 0,
	cinnabar = 0,
	cohosh = 0,
	cuprum = 0,
	dolomite = 0,
	echinacea = 0,
	elm = 0,
	ferrum = 0,
	ginger = 0,
	ginseng = 0,
	goldenseal = 0,
	gypsum = 0,
	hawthorn = 0,
	irid = 0,
	kelp = 0,
	kola = 0,
	lobelia = 0,
	magnesium = 0,
	malachite = 0,
	myrrh = 0,
	pear = 0,
	plumbum = 0,
	potash = 0,
	quartz = 0,
	quicksilver = 0,
	realgar = 0,
	sileris = 0,
	skullcap = 0,
	stannum = 0,
	valerian = 0,
}

--parsing function for extracting herb names
function returnHerbName(s)
	local found = false
	if s:find("potash") then
		found = "potash"
	else
  	for herb, num in pairs(ataxiaTemp.outrifted) do
			if s:find(herb) then
				found = herb
				break
			end
		end
	end
  return found
end

--get a number from a string
function extractNumberFromString(s)
	return tonumber(string.match(s, "(%d+)"))
end

function ataxia_precacheQueue()		
	if canOutrift() and not ataxiaTemp.outriftTimer then
		if ataxiaTemp.outriftTimer then killTimer(ataxiaTemp.outriftTimer) end
		ataxiaTemp.outriftTimer = tempTimer(2, [[ataxiaTemp.outriftTimer = nil]])
		for h, n in pairs(ataxiaTemp.outrifted) do
			if ataxiaTemp.keepout[h] and n &lt; ataxiaTemp.keepout[h] then
				sendToOutrift(h, ataxiaTemp.keepout[h] - n)
			end
		end
	end
end

function sendToOutrift(herb, num)
	if not ataxia.afflictions.aeon then
		send("outr "..num.." "..herb)
	end
end

--Outrift failsafe.
function outrifted(herb, num)
	local what = returnHerbName(herb)
  local amount = tonumber(num)

  if what then
    ataxiaTemp.outrifted[what] = ataxiaTemp.outrifted[what] + amount
  end
end


function inrifted()
  ataxia_resetOutrifted()
	if ataxiaTemp.inraTimer then killTimer(ataxiaTemp.inraTimer) end
	ataxiaTemp.inraTimer = tempTimer(3, [[ataxiaTemp.inraTimer = nil; ataxia_precacheQueue()]])
end

function ataxia_resetOutrifted()
	ataxiaTemp.outrifted = {
		antimony = 0,
		argentum = 0,
		arsenic = 0,
		ash = 0,
		aurum = 0,
		azurite = 0,
		bayberry = 0,
		bellwort = 0,
		bisemutum = 0,
		bloodroot = 0,
		calamine = 0,
		calcite = 0,
		cinnabar = 0,
		cohosh = 0,
		cuprum = 0,
		dolomite = 0,
		echinacea = 0,
		elm = 0,
		ferrum = 0,
		ginger = 0,
		ginseng = 0,
		goldenseal = 0,
		gypsum = 0,
		hawthorn = 0,
		irid = 0,
		kelp = 0,
		kola = 0,
		lobelia = 0,
		magnesium = 0,
		malachite = 0,
		myrrh = 0,
		pear = 0,
		plumbum = 0,
		potash = 0,
		quartz = 0,
		quicksilver = 0,
		realgar = 0,
		sileris = 0,
		skullcap = 0,
		stannum = 0,
		valerian = 0,
	}
end
</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Gmcp Rift Events</name>
											<packageName></packageName>
											<script>function outRift_addedItem()
  if gmcp.Char.Items.Add.location == "inv" then
		ataxiaTemp.ignoreOutrift = tempTimer(2, [[ataxiaTemp.ignoreOutrift = nil]])
    local herbName = returnHerbName(gmcp.Char.Items.Add.item.name)
		
    if herbName then
      local herbAmount = extractNumberFromString(gmcp.Char.Items.Add.item.name) or 1

      ataxiaTemp.outrifted[herbName] = ataxiaTemp.outrifted[herbName] + herbAmount
      ataxiaTemp.addedHerbID = tonumber(gmcp.Char.Items.Add.item.id)
      
      if ataxiaTemp.outriftTimer then killTimer(ataxiaTemp.outriftTimer) end
      ataxiaTemp.outriftTimer = tempTimer(2, [[ataxiaTemp.outriftTimer = nil]])
    end
  end
end
registerAnonymousEventHandler("gmcp.Char.Items.Add", "outRift_addedItem")

function outRift_removedItem()
  if gmcp.Char.Items.Remove.location == "inv" then
		ataxiaTemp.ignoreOutrift = tempTimer(2, [[ataxiaTemp.ignoreOutrift = nil]])
    local herbName = returnHerbName(gmcp.Char.Items.Remove.item.name)
    
    if herbName then
      local herbAmount = extractNumberFromString(gmcp.Char.Items.Remove.item.name) or 1
      ataxiaTemp.outrifted[herbName] = ataxiaTemp.outrifted[herbName] - herbAmount
      ataxiaTemp.removedHerbID = tonumber(gmcp.Char.Items.Remove.item.id)

      if ataxiaTemp.removedHerbID == ataxiaTemp.addedHerbID then
        ataxiaTemp.outrifted[herbName] = ataxiaTemp.outrifted[herbName] - 1
        ataxiaTemp.addedHerbID = 1
      end
			
      if ataxiaTemp.outrifted[herbName] &lt; 0 then
       ataxiaTemp.outrifted[herbName] = 0
      end
      if not ataxiaTemp.outriftTimer then ataxia_precacheQueue() end
    end
  end
end

registerAnonymousEventHandler("gmcp.Char.Items.Remove", "outRift_removedItem")</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>System-related</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Save/Load Settings</name>
										<packageName></packageName>
										<script>function ataxia_saveSettings(disp)
	if not ataxia.settings then
		ataxia_Echo("System settings not found; won't save anything.") 
		return false 
	end

	local separator = string.char(getMudletHomeDir():byte()) == "/" and "/" or "\\"
	local file_loc = getMudletHomeDir() .. separator .. "ataxia"
	local bash_loc = getMudletHomeDir() .. separator .. "basher"
	local paths_loc = getMudletHomeDir()..separator.."basherpaths"
	local ndb_loc = getMudletHomeDir()..separator.."andb"
  local ext_loc = getMudletHomeDir()..separator.."extractLocations"

	table.save(file_loc, ataxia)

	if ataxiaBasher then
		table.save(bash_loc, ataxiaBasher)
		if ataxiaBasherPaths then table.save(paths_loc, ataxiaBasherPaths) end
	end

	if ataxiaNDB then
		table.save(ndb_loc, ataxiaNDB)
	end
  
  if ataxiaExtraction then
    table.save(ext_loc, ataxiaExtraction)
  end

	if disp then
		ataxia_Echo("Nap time. Don't come back soon, "..(gmcp and gmcp.Char.Name.name or "thanks")..".")
	end
end

function ataxia_loadSettings()
	if ataxia.loaded then
		ataxia_Echo("Systems have already been initiliased.") 
		return 
	end

	local separator = string.char(getMudletHomeDir():byte()) == "/" and "/" or "\\"
	local file_loc = getMudletHomeDir() .. separator .. "ataxia"
	local bash_loc = getMudletHomeDir() .. separator .. "basher"
	local paths_loc = getMudletHomeDir()..separator.."basherpaths"
	local ndb_loc = getMudletHomeDir()..separator.."andb"
  local ext_loc = getMudletHomeDir()..separator.."extractLocations"

	if not io.exists(file_loc) then 
		ataxia_Echo("I don't believe I recognise you. If you want my abilities, fix that.")
		return
	end

	table.load(file_loc, ataxia)
	ataxia_Echo("I suppose I can lend you my aid. Go and annihilate our foes.")
	ataxia.loaded = true

	if not io.exists(bash_loc) then
		ataxia_Echo("Bashing systems not yet enabled.") 
	else
		ataxiaBasher = {}
		table.load(bash_loc, ataxiaBasher)
		ataxia_Echo("Bashing systems enabled, go and lay waste.")
		if not io.exists(paths_loc) then
			ataxiaBasherPaths = {}
			ataxia_Echo("Area paths not yet enabled. Will have to start those from scratch, I'm afraid.")
		else
			ataxia_Echo("Paths have been acquired for bashing.")
			ataxiaBasherPaths = {}
			table.load(paths_loc, ataxiaBasherPaths)
		end
	end

  if io.exists(ext_loc) then
    ataxiaExtraction = {}
    table.load(ext_loc, ataxiaExtraction)
    ataxiaEcho("Loaded extraction database.")
  end

	if not io.exists(ndb_loc) then
		ataxiaEcho("Name database not initialised. Loading default settings.")
		ataxiaNDB_Install()
	else
		ataxiaNDB = {}
		table.load(ndb_loc, ataxiaNDB)
		ataxiaEcho("Name database loaded in.")
	end

  raiseEvent("ataxia system loaded")
	ataxia_saveSettings(false)
end

function ataxia_defaultSettings()
	ataxia.settings = {
		--Defence related.
		defences = {
			current = "",
			defup = {
			},
			keepup = {
			},
		},
		--Specific skills.
		have = {
			breathing = true,
			clot = true,
			deathsight = true,
			focus = true,
			insomnia = false,
			parry = true,
			rage = true,
			transmute = false,
		},
		--Use said skills.
		use = {
			breathing = true,
			clot = true,
			deathsight = true,
			focus = true,
			insomnia = false,
			parry = false,
			rage = false,
			transmute = false,
		},
		--For vitals-related things.
		sipping = {
			aeonmana = 40,
			aeonhealth = 40,
			manause = 30,
			mosshealth = 70,
			mossmana = 60,
			siphealth = 80,
			sipmana = 70,
			transmuteto = 70,
			usemoss = true,
		},
		--Precaching herbs.
		precache = {
		},
		--Other stuff that doesn't fall into above categories.
		aeoncommandblock = true,
		gagclot = true,
    highlighting = {},
		class = "Unknown",
		looting = true,
		paused = false,
		prompt = {timestamp = true, afflictions = true},
		separator = ";",
		resetonlogin = false,
		customprompt = "",
		roomshorten = "normal",
		autogallop = false,
    raid = {enabled = false},
    fishing = {
      bait = "shrimp",
      type = "normal",
      direction = "n",
      enabled = false,
      count = 0,
    }
	}
	ataxia.curingprio = {}
	ataxia.bardStuff = {symphony = false, harmsList = {}, ariaBash = false, bashHarms = false, instrument = "lyre"}
	ataxia.sylvanStuff = {propagateList = {arms = false, legs = false, head = false, body = false}}
	--ataxia_resetPrios()
	ataxia_Echo("Default systems have been enabled. Enjoy.")
	ataxia_saveSettings(false)
end


registerAnonymousEventHandler("sysDisconnectionEvent", "ataxia_saveSettings", true)
registerAnonymousEventHandler("sysLoadEvent", "ataxia_loadSettings")</script>
										<eventHandlerList />
									</Script>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Lua Matrix package</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>complex</name>
											<packageName></packageName>
											<script>--[[
 
LUA MODULE
 
   complex v$(_VERSION) - complex numbers implemented as Lua tables
 
SYNOPSIS

  local complex = require 'complex'
  local cx1 = complex "2+3i" -- or complex.new(2, 3) 
  local cx2 = complex "3+2i"
  assert( complex.add(cx1,cx2) == complex "5+5i" )
  assert( tostring(cx1) == "2+3i" )
 
DESCRIPTION
 
  'complex' provides common tasks with complex numbers

   function complex.to( arg ); complex( arg )
   returns a complex number on success, nil on failure
   arg := number or { number,number } or ( "(-)&lt;number&gt;" and/or "(+/-)&lt;number&gt;i" )
      e.g. 5; {2,3}; "2", "2+i", "-2i", "2^2*3+1/3i"
      note: 'i' is always in the numerator, spaces are not allowed

  A complex number is defined as Cartesian complex number
  complex number := { real_part, imaginary_part } .
  This gives fast access to both parts of the number for calculation.
  The access is faster than in a hash table
  The metatable is just an add on.  When it comes to speed, one is faster using a direct function call.

API

  See code and test_complex.lua.

DEPENDENCIES

  None (other than Lua 5.1 or 5.2).
  
HOME PAGE
  
  http://luamatrix.luaforge.net
  http://lua-users.org/wiki/LuaMatrix

DOWNLOAD/INSTALL

  ./util.mk
  cd tmp/*
  luarocks make
  
 Licensed under the same terms as Lua itself.
 
  Developers:
    Michael Lutz (chillcode)
    David Manura http://lua-users.org/wiki/DavidManura (maintainer)
--]]

--/////////////--
--// complex //--
--/////////////--

-- link to complex table
local complex = {_TYPE='module', _NAME='complex', _VERSION='0.3.3.20111212'}

-- link to complex metatable
local complex_meta = {}

-- helper functions for parsing complex number strings.
local function parse_scalar(s, pos0)
	local x, n, pos = s:match('^([+-]?[%d%.]+)(.?)()', pos0)
	if not x then return end
	if n == 'e' or n == 'E' then
		local x2, n2, pos2 = s:match('^([+-]?%d+)(.?)()', pos)
		if not x2 then error 'number format error' end
		x = tonumber(x..n..x2)
		if not x then error 'number format error' end
		return x, n2, pos2
	else
		x = tonumber(x)
		if not x then error 'number format error' end
		return x, n, pos
	end
end
local function parse_component(s, pos0)
	local x, n, pos = parse_scalar(s, pos0)
	if not x then
		local x2, n2, pos2 = s:match('^([+-]?)(i)()$', pos0)
		if not x2 then error 'number format error' end
		return (x2=='-' and -1 or 1), n2, pos2
	end
	if n == '/' then
		local x2, n2, pos2 = parse_scalar(s, pos)
		x = x / x2
		return x, n2, pos2
	end
	return x, n, pos
end
local function parse_complex(s)
	local x, n, pos = parse_component(s, 1)
	if n == '+' or n == '-' then
		local x2, n2, pos2 = parse_component(s, pos)
		if n2 ~= 'i' or pos2 ~= #s+1 then error 'number format error' end
		if n == '-' then x2 = - x2 end
		return x, x2
	elseif n == '' then
		return x, 0
	elseif n == 'i' then
		if pos ~= #s+1 then error 'number format error' end
		return 0, x
	else
		error 'number format error'
	end
end

-- complex.to( arg )
-- return a complex number on success
-- return nil on failure
function complex.to( num )
	-- check for table type
	if type( num ) == "table" then
		-- check for a complex number
		if getmetatable( num ) == complex_meta then
			return num
		end
		local real,imag = tonumber( num[1] ),tonumber( num[2] )
		if real and imag then
			return setmetatable( { real,imag }, complex_meta )
		end
		return
	end
	-- check for number
	local isnum = tonumber( num )
	if isnum then
		return setmetatable( { isnum,0 }, complex_meta )
	end
	if type( num ) == "string" then
		local real, imag = parse_complex(num)
		return setmetatable( { real, imag }, complex_meta )
	end
end

-- complex( arg )
-- same as complex.to( arg )
-- set __call behaviour of complex
setmetatable( complex, { __call = function( _,num ) return complex.to( num ) end } )

-- complex.new( real, complex )
-- fast function to get a complex number, not invoking any checks
function complex.new( ... )
	return setmetatable( { ... }, complex_meta )
end

-- complex.type( arg )
-- is argument of type complex
function complex.type( arg )
	if getmetatable( arg ) == complex_meta then
		return "complex"
	end
end

-- complex.convpolar( r, phi )
-- convert polar coordinates ( r*e^(i*phi) ) to carthesic complex number
-- r (radius) is a number
-- phi (angle) must be in radians; e.g. [0 - 2pi]
function complex.convpolar( radius, phi )
	return setmetatable( { radius * math.cos( phi ), radius * math.sin( phi ) }, complex_meta )
end

-- complex.convpolardeg( r, phi )
-- convert polar coordinates ( r*e^(i*phi) ) to carthesic complex number
-- r (radius) is a number
-- phi must be in degrees; e.g. [0 - 360 deg]
function complex.convpolardeg( radius, phi )
	phi = phi/180 * math.pi
	return setmetatable( { radius * math.cos( phi ), radius * math.sin( phi ) }, complex_meta )
end

--// complex number functions only

-- complex.tostring( cx [, formatstr] )
-- to string or real number
-- takes a complex number and returns its string value or real number value
function complex.tostring( cx,formatstr )
	local real,imag = cx[1],cx[2]
	if formatstr then
		if imag == 0 then
			return string.format( formatstr, real )
		elseif real == 0 then
			return string.format( formatstr, imag ).."i"
		elseif imag &gt; 0 then
			return string.format( formatstr, real ).."+"..string.format( formatstr, imag ).."i"
		end
		return string.format( formatstr, real )..string.format( formatstr, imag ).."i"
	end
	if imag == 0 then
		return real
	elseif real == 0 then
		return ((imag==1 and "") or (imag==-1 and "-") or imag).."i"
	elseif imag &gt; 0 then
		return real.."+"..(imag==1 and "" or imag).."i"
	end
	return real..(imag==-1 and "-" or imag).."i"
end

-- complex.print( cx [, formatstr] )
-- print a complex number
function complex.print( ... )
	print( complex.tostring( ... ) )
end

-- complex.polar( cx )
-- from complex number to polar coordinates
-- output in radians; [-pi,+pi]
-- returns r (radius), phi (angle)
function complex.polar( cx )
	return math.sqrt( cx[1]^2 + cx[2]^2 ), math.atan2( cx[2], cx[1] )
end

-- complex.polardeg( cx )
-- from complex number to polar coordinates
-- output in degrees; [-180, 180 deg]
-- returns r (radius), phi (angle)
function complex.polardeg( cx )
	return math.sqrt( cx[1]^2 + cx[2]^2 ), math.atan2( cx[2], cx[1] ) / math.pi * 180
end

-- complex.norm2( cx )
-- multiply with conjugate, function returning a scalar number
-- norm2(x + i*y) returns x^2 + y^2
function complex.norm2( cx )
	return cx[1]^2 + cx[2]^2
end

-- complex.abs( cx )
-- get the absolute value of a complex number
function complex.abs( cx )
	return math.sqrt( cx[1]^2 + cx[2]^2 )
end

-- complex.get( cx )
-- returns real_part, imaginary_part
function complex.get( cx )
	return cx[1],cx[2]
end

-- complex.set( cx, real, imag )
-- sets real_part = real and imaginary_part = imag
function complex.set( cx,real,imag )
	cx[1],cx[2] = real,imag
end

-- complex.is( cx, real, imag )
-- returns true if, real_part = real and imaginary_part = imag
-- else returns false
function complex.is( cx,real,imag )
	if cx[1] == real and cx[2] == imag then
		return true
	end
	return false
end

--// functions returning a new complex number

-- complex.copy( cx )
-- copy complex number
function complex.copy( cx )
	return setmetatable( { cx[1],cx[2] }, complex_meta )
end

-- complex.add( cx1, cx2 )
-- add two numbers; cx1 + cx2
function complex.add( cx1,cx2 )
	return setmetatable( { cx1[1]+cx2[1], cx1[2]+cx2[2] }, complex_meta )
end

-- complex.sub( cx1, cx2 )
-- subtract two numbers; cx1 - cx2
function complex.sub( cx1,cx2 )
	return setmetatable( { cx1[1]-cx2[1], cx1[2]-cx2[2] }, complex_meta )
end

-- complex.mul( cx1, cx2 )
-- multiply two numbers; cx1 * cx2
function complex.mul( cx1,cx2 )
	return setmetatable( { cx1[1]*cx2[1] - cx1[2]*cx2[2],cx1[1]*cx2[2] + cx1[2]*cx2[1] }, complex_meta )
end

-- complex.mulnum( cx, num )
-- multiply complex with number; cx1 * num
function complex.mulnum( cx,num )
	return setmetatable( { cx[1]*num,cx[2]*num }, complex_meta )
end

-- complex.div( cx1, cx2 )
-- divide 2 numbers; cx1 / cx2
function complex.div( cx1,cx2 )
	-- get complex value
	local val = cx2[1]^2 + cx2[2]^2
	-- multiply cx1 with conjugate complex of cx2 and divide through val
	return setmetatable( { (cx1[1]*cx2[1]+cx1[2]*cx2[2])/val,(cx1[2]*cx2[1]-cx1[1]*cx2[2])/val }, complex_meta )
end

-- complex.divnum( cx, num )
-- divide through a number
function complex.divnum( cx,num )
	return setmetatable( { cx[1]/num,cx[2]/num }, complex_meta )
end

-- complex.pow( cx, num )
-- get the power of a complex number
function complex.pow( cx,num )
	if math.floor( num ) == num then
		if num &lt; 0 then
			local val = cx[1]^2 + cx[2]^2
			cx = { cx[1]/val,-cx[2]/val }
			num = -num
		end
		local real,imag = cx[1],cx[2]
		for i = 2,num do
			real,imag = real*cx[1] - imag*cx[2],real*cx[2] + imag*cx[1]
		end
		return setmetatable( { real,imag }, complex_meta )
	end
	-- we calculate the polar complex number now
	-- since then we have the versatility to calc any potenz of the complex number
	-- then we convert it back to a carthesic complex number, we loose precision here
	local length,phi = math.sqrt( cx[1]^2 + cx[2]^2 )^num, math.atan2( cx[2], cx[1] )*num
	return setmetatable( { length * math.cos( phi ), length * math.sin( phi ) }, complex_meta )
end

-- complex.sqrt( cx )
-- get the first squareroot of a complex number, more accurate than cx^.5
function complex.sqrt( cx )
	local len = math.sqrt( cx[1]^2+cx[2]^2 )
	local sign = (cx[2]&lt;0 and -1) or 1
	return setmetatable( { math.sqrt((cx[1]+len)/2), sign*math.sqrt((len-cx[1])/2) }, complex_meta )
end

-- complex.ln( cx )
-- natural logarithm of cx
function complex.ln( cx )
	return setmetatable( { math.log(math.sqrt( cx[1]^2 + cx[2]^2 )),
		math.atan2( cx[2], cx[1] ) }, complex_meta )
end

-- complex.exp( cx )
-- exponent of cx (e^cx)
function complex.exp( cx )
	local expreal = math.exp(cx[1])
	return setmetatable( { expreal*math.cos(cx[2]), expreal*math.sin(cx[2]) }, complex_meta )
end

-- complex.conjugate( cx )
-- get conjugate complex of number
function complex.conjugate( cx )
	return setmetatable( { cx[1], -cx[2] }, complex_meta )
end

-- complex.round( cx [,idp] )
-- round complex numbers, by default to 0 decimal points
function complex.round( cx,idp )
	local mult = 10^( idp or 0 )
	return setmetatable( { math.floor( cx[1] * mult + 0.5 ) / mult,
		math.floor( cx[2] * mult + 0.5 ) / mult }, complex_meta )
end

--// variables
complex.zero = complex.new(0, 0)
complex.one  = complex.new(1, 0)

--// metatable functions

complex_meta.__add = function( cx1,cx2 )
	local cx1,cx2 = complex.to( cx1 ),complex.to( cx2 )
	return complex.add( cx1,cx2 )
end
complex_meta.__sub = function( cx1,cx2 )
	local cx1,cx2 = complex.to( cx1 ),complex.to( cx2 )
	return complex.sub( cx1,cx2 )
end
complex_meta.__mul = function( cx1,cx2 )
	local cx1,cx2 = complex.to( cx1 ),complex.to( cx2 )
	return complex.mul( cx1,cx2 )
end
complex_meta.__div = function( cx1,cx2 )
	local cx1,cx2 = complex.to( cx1 ),complex.to( cx2 )
	return complex.div( cx1,cx2 )
end
complex_meta.__pow = function( cx,num )
	if num == "*" then
		return complex.conjugate( cx )
	end
	return complex.pow( cx,num )
end
complex_meta.__unm = function( cx )
	return setmetatable( { -cx[1], -cx[2] }, complex_meta )
end
complex_meta.__eq = function( cx1,cx2 )
	if cx1[1] == cx2[1] and cx1[2] == cx2[2] then
		return true
	end
	return false
end
complex_meta.__tostring = function( cx )
	return tostring( complex.tostring( cx ) )
end
complex_meta.__concat = function( cx,cx2 )
	return tostring(cx)..tostring(cx2)
end
-- cx( cx, formatstr )
complex_meta.__call = function( ... )
	print( complex.tostring( ... ) )
end
complex_meta.__index = {}
for k,v in pairs( complex ) do
	complex_meta.__index[k] = v
end

--///////////////--
--// chillcode //--
--///////////////--</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>matrix</name>
											<packageName></packageName>
											<script>--[[

LUA MODULE

  matrix v$(_VERSION) - matrix functions implemented with Lua tables
	
SYNOPSIS

  local matrix = require 'matrix'
  m1 = matrix{{8,4,1},{6,8,3}}
  m2 = matrix{{-8,1,3},{5,2,1}}
  assert(m1 + m2 == matrix{{0,5,4},{11,10,4}})
  
DESCRIPTION

  With simple matrices this script is quite useful, though for more
  exact calculations, one would probably use a program like Matlab instead.
  Matrices of size 100x100 can still be handled very well.
  The error for the determinant and the inverted matrix is around 10^-9
  with a 100x100 matrix and an element range from -100 to 100.
 	
   Characteristics:
	
	- functions called via matrix.&lt;function&gt; should be able to handle
	  any table matrix of structure t[i][j] = value
	- can handle a type of complex matrix
	- can handle symbolic matrices. (Symbolic matrices cannot be
	  used with complex matrices.)
	- arithmetic functions do not change the matrix itself
	  but build and return a new matrix
	- functions are intended to be light on checks
	  since one gets a Lua error on incorrect use anyways
	- uses mainly Gauss-Jordan elimination
	- for Lua tables optimised determinant calculation (fast)
	  but not invoking any checks for special types of matrices
	- vectors can be set up via vec1 = matrix{{ 1,2,3 }}^'T' or matrix{1,2,3}
	- vectors can be multiplied to a scalar via num = vec1^'T' * vec2
	  where num will be a matrix with the result in mtx[1][1],
	  or use num = vec1:scalar( vec2 ), where num is a number

API
	
	matrix function list:

	matrix.add
	matrix.columns
	matrix.concath
	matrix.concatv
	matrix.copy
	matrix.cross
	matrix.det
	matrix.div
	matrix.divnum
	matrix.dogauss
	matrix.elementstostring
	matrix.getelement
	matrix.gsub
	matrix.invert
	matrix.ipairs
	matrix.latex
	matrix.len
	matrix.mul
	matrix.mulnum
	matrix:new
	matrix.normf
	matrix.normmax
	matrix.pow
	matrix.print
	matrix.random
	matrix.replace
	matrix.root
	matrix.rotl
	matrix.rotr
	matrix.round
	matrix.rows
	matrix.scalar
	matrix.setelement
	matrix.size
	matrix.solve
	matrix.sqrt
	matrix.sub
	matrix.subm
	matrix.tostring
	matrix.transpose
	matrix.type
	
	See code and test_matrix.lua.

DEPENDENCIES

  None (other than Lua 5.1 or 5.2).  May be used with complex.lua.

HOME PAGE

  http://luamatrix.luaforge.net
  http://lua-users.org/wiki/LuaMatrix

DOWNLOAD/INSTALL

  ./util.mk
  cd tmp/*
  luarocks make
  
LICENSE
  
  Licensed under the same terms as Lua itself.
	
  Developers:
    Michael Lutz (chillcode) - original author
    David Manura http://lua-users.org/wiki/DavidManura
--]]

--////////////
--// matrix //
--////////////

matrix = {_TYPE='module', _NAME='matrix', _VERSION='0.2.11.20120416'}

-- access to the metatable we set at the end of the file
local matrix_meta = {}

--/////////////////////////////
--// Get 'new' matrix object //
--/////////////////////////////

--// matrix:new ( rows [, columns [, value]] )
-- if rows is a table then sets rows as matrix
-- if rows is a table of structure {1,2,3} then it sets it as a vector matrix
-- if rows and columns are given and are numbers, returns a matrix with size rowsxcolumns
-- if num is given then returns a matrix with given size and all values set to num
-- if rows is given as number and columns is "I", will return an identity matrix of size rowsxrows
function matrix:new( rows, columns, value )
	-- check for given matrix
	if type( rows ) == "table" then
		-- check for vector
		if type(rows[1]) ~= "table" then -- expect a vector
			return setmetatable( {{rows[1]},{rows[2]},{rows[3]}},matrix_meta )
		end
		return setmetatable( rows,matrix_meta )
	end
	-- get matrix table
	local mtx = {}
	local value = value or 0
	-- build identity matrix of given rows
	if columns == "I" then
		for i = 1,rows do
			mtx[i] = {}
			for j = 1,rows do
				if i == j then
					mtx[i][j] = 1
				else
					mtx[i][j] = 0
				end
			end
		end
	-- build new matrix
	else
		for i = 1,rows do
			mtx[i] = {}
			for j = 1,columns do
				mtx[i][j] = value
			end
		end
	end
	-- return matrix with shared metatable
	return setmetatable( mtx,matrix_meta )
end

--// matrix ( rows [, comlumns [, value]] )
-- set __call behaviour of matrix
-- for matrix( ... ) as matrix.new( ... )
setmetatable( matrix, { __call = function( ... ) return matrix.new( ... ) end } )


-- functions are designed to be light on checks
-- so we get Lua errors instead on wrong input
-- matrix.&lt;functions&gt; should handle any table of structure t[i][j] = value
-- we always return a matrix with scripts metatable
-- cause its faster than setmetatable( mtx, getmetatable( input matrix ) )

--///////////////////////////////
--// matrix 'matrix' functions //
--///////////////////////////////

--// for real, complex and symbolic matrices //--

-- note: real and complex matrices may be added, subtracted, etc.
--		real and symbolic matrices may also be added, subtracted, etc.
--		but one should avoid using symbolic matrices with complex ones
--		since it is not clear which metatable then is used

--// matrix.add ( m1, m2 )
-- Add two matrices; m2 may be of bigger size than m1
function matrix.add( m1, m2 )
	local mtx = {}
	for i = 1,#m1 do
		local m3i = {}
		mtx[i] = m3i
		for j = 1,#m1[1] do
			m3i[j] = m1[i][j] + m2[i][j]
		end
	end
	return setmetatable( mtx, matrix_meta )
end

--// matrix.sub ( m1 ,m2 )
-- Subtract two matrices; m2 may be of bigger size than m1
function matrix.sub( m1, m2 )
	local mtx = {}
	for i = 1,#m1 do
		local m3i = {}
		mtx[i] = m3i
		for j = 1,#m1[1] do
			m3i[j] = m1[i][j] - m2[i][j]
		end
	end
	return setmetatable( mtx, matrix_meta )
end

--// matrix.mul ( m1, m2 )
-- Multiply two matrices; m1 columns must be equal to m2 rows
-- e.g. #m1[1] == #m2
function matrix.mul( m1, m2 )
	-- multiply rows with columns
	local mtx = {}
	for i = 1,#m1 do
		mtx[i] = {}
		for j = 1,#m2[1] do
			local num = m1[i][1] * m2[1][j]
			for n = 2,#m1[1] do
				num = num + m1[i][n] * m2[n][j]
			end
			mtx[i][j] = num
		end
	end
	return setmetatable( mtx, matrix_meta )
end

--//  matrix.div ( m1, m2 )
-- Divide two matrices; m1 columns must be equal to m2 rows
-- m2 must be square, to be inverted,
-- if that fails returns the rank of m2 as second argument
-- e.g. #m1[1] == #m2; #m2 == #m2[1]
function matrix.div( m1, m2 )
	local rank; m2,rank = matrix.invert( m2 )
	if not m2 then return m2, rank end -- singular
	return matrix.mul( m1, m2 )
end

--// matrix.mulnum ( m1, num )
-- Multiply matrix with a number
-- num may be of type 'number' or 'complex number'
-- strings get converted to complex number, if that fails then to symbol
function matrix.mulnum( m1, num )
	local mtx = {}
	-- multiply elements with number
	for i = 1,#m1 do
		mtx[i] = {}
		for j = 1,#m1[1] do
			mtx[i][j] = m1[i][j] * num
		end
	end
	return setmetatable( mtx, matrix_meta )
end

--// matrix.divnum ( m1, num )
-- Divide matrix by a number
-- num may be of type 'number' or 'complex number'
-- strings get converted to complex number, if that fails then to symbol
function matrix.divnum( m1, num )
	local mtx = {}
	-- divide elements by number
	for i = 1,#m1 do
		local mtxi = {}
		mtx[i] = mtxi
		for j = 1,#m1[1] do
			mtxi[j] = m1[i][j] / num
		end
	end
	return setmetatable( mtx, matrix_meta )
end


--// for real and complex matrices only //--

--// matrix.pow ( m1, num )
-- Power of matrix; mtx^(num)
-- num is an integer and may be negative
-- m1 has to be square
-- if num is negative and inverting m1 fails
-- returns the rank of matrix m1 as second argument
function matrix.pow( m1, num )
	assert(num == math.floor(num), "exponent not an integer")
	if num == 0 then
		return matrix:new( #m1,"I" )
	end
	if num &lt; 0 then
		local rank; m1,rank = matrix.invert( m1 )
      if not m1 then return m1, rank end -- singular
		num = -num
	end
	local mtx = matrix.copy( m1 )
	for i = 2,num	do
		mtx = matrix.mul( mtx,m1 )
	end
	return mtx
end

local function number_norm2(x)
  return x * x
end

--// matrix.det ( m1 )
-- Calculate the determinant of a matrix
-- m1 needs to be square
-- Can calc the det for symbolic matrices up to 3x3 too
-- The function to calculate matrices bigger 3x3
-- is quite fast and for matrices of medium size ~(100x100)
-- and average values quite accurate
-- here we try to get the nearest element to |1|, (smallest pivot element)
-- os that usually we have |mtx[i][j]/subdet| &gt; 1 or mtx[i][j];
-- with complex matrices we use the complex.abs function to check if it is bigger or smaller
function matrix.det( m1 )

	-- check if matrix is quadratic
	assert(#m1 == #m1[1], "matrix not square")
	
	local size = #m1
	
	if size == 1 then
		return m1[1][1]
	end
	
	if size == 2 then
		return m1[1][1]*m1[2][2] - m1[2][1]*m1[1][2]
	end
	
	if size == 3 then
		return ( m1[1][1]*m1[2][2]*m1[3][3] + m1[1][2]*m1[2][3]*m1[3][1] + m1[1][3]*m1[2][1]*m1[3][2]
			- m1[1][3]*m1[2][2]*m1[3][1] - m1[1][1]*m1[2][3]*m1[3][2] - m1[1][2]*m1[2][1]*m1[3][3] )
	end
	
	--// no symbolic matrix supported below here
	local e = m1[1][1]
	local zero  = type(e) == "table" and e.zero or 0
	local norm2 = type(e) == "table" and e.norm2 or number_norm2

	--// matrix is bigger than 3x3
	-- get determinant
	-- using Gauss elimination and Laplace
	-- start eliminating from below better for removals
	-- get copy of matrix, set initial determinant
	local mtx = matrix.copy( m1 )
	local det = 1
	-- get det up to the last element
	for j = 1,#mtx[1] do
		-- get smallest element so that |factor| &gt; 1
		-- and set it as last element
		local rows = #mtx
		local subdet,xrow
		for i = 1,rows do
			-- get element
			local e = mtx[i][j]
			-- if no subdet has been found
			if not subdet then
				-- check if element it is not zero
				if e ~= zero then
					-- use element as new subdet
					subdet,xrow = e,i
				end
			-- check for elements nearest to 1 or -1
			elseif e ~= zero and math.abs(norm2(e)-1) &lt; math.abs(norm2(subdet)-1) then
				subdet,xrow = e,i
			end
		end
		-- only cary on if subdet is found
		if subdet then
			-- check if xrow is the last row,
			-- else switch lines and multiply det by -1
			if xrow ~= rows then
				mtx[rows],mtx[xrow] = mtx[xrow],mtx[rows]
				det = -det
			end
			-- traverse all fields setting element to zero
			-- we don't set to zero cause we don't use that column anymore then anyways
			for i = 1,rows-1 do
				-- factor is the dividor of the first element
				-- if element is not already zero
				if mtx[i][j] ~= zero then
					local factor = mtx[i][j]/subdet
					-- update all remaining fields of the matrix, with value from xrow
					for n = j+1,#mtx[1] do
						mtx[i][n] = mtx[i][n] - factor * mtx[rows][n]
					end
				end
			end
			-- update determinant and remove row
			if math.fmod( rows,2 ) == 0 then
				det = -det
			end
			det = det * subdet
			table.remove( mtx )
		else
			-- break here table det is 0
			return det * 0
		end
	end
	-- det ready to return
	return det
end

--// matrix.dogauss ( mtx )
-- Gauss elimination, Gauss-Jordan Method
-- this function changes the matrix itself
-- returns on success: true,
-- returns on failure: false,'rank of matrix'

-- locals
-- checking here for the element nearest but not equal to zero (smallest pivot element).
-- This way the `factor` in `dogauss` will be &gt;= 1, which
-- can give better results.
local pivotOk = function( mtx,i,j,norm2 )
	-- find min value
	local iMin
	local normMin = math.huge
	for _i = i,#mtx do
		local e = mtx[_i][j]
		local norm = math.abs(norm2(e))
		if norm &gt; 0 and norm &lt; normMin then
			iMin = _i
			normMin = norm
			end
		end
	if iMin then
		-- switch lines if not in position.
		if iMin ~= i then
			mtx[i],mtx[iMin] = mtx[iMin],mtx[i]
		end
		return true
		end
	return false
end

local function copy(x)
	return type(x) == "table" and x.copy(x) or x
end

-- note: in --// ... //-- we have a way that does no divison,
-- however with big number and matrices we get problems since we do no reducing
function matrix.dogauss( mtx )
	local e = mtx[1][1]
	local zero = type(e) == "table" and e.zero or 0
	local one  = type(e) == "table" and e.one  or 1
	local norm2 = type(e) == "table" and e.norm2 or number_norm2

	local rows,columns = #mtx,#mtx[1]
	-- stairs left -&gt; right
	for j = 1,rows do
		-- check if element can be setted to one
		if pivotOk( mtx,j,j,norm2 ) then
			-- start parsing rows
			for i = j+1,rows do
				-- check if element is not already zero
				if mtx[i][j] ~= zero then
					-- we may add x*otherline row, to set element to zero
					-- tozero - x*mtx[j][j] = 0; x = tozero/mtx[j][j]
					local factor = mtx[i][j]/mtx[j][j]
					--// this should not be used although it does no division,
					-- yet with big matrices (since we do no reducing and other things)
					-- we get too big numbers
					--local factor1,factor2 = mtx[i][j],mtx[j][j] //--
					mtx[i][j] = copy(zero)
					for _j = j+1,columns do
						--// mtx[i][_j] = mtx[i][_j] * factor2 - factor1 * mtx[j][_j] //--
						mtx[i][_j] = mtx[i][_j] - factor * mtx[j][_j]
					end
				end
			end
		else
			-- return false and the rank of the matrix
			return false,j-1
		end
	end
	-- stairs right &lt;- left
	for j = rows,1,-1 do
		-- set element to one
		-- do division here
		local div = mtx[j][j]
		for _j = j+1,columns do
			mtx[j][_j] = mtx[j][_j] / div
		end
		-- start parsing rows
		for i = j-1,1,-1 do
			-- check if element is not already zero			
			if mtx[i][j] ~= zero then
				local factor = mtx[i][j]
				for _j = j+1,columns do
					mtx[i][_j] = mtx[i][_j] - factor * mtx[j][_j]
				end
				mtx[i][j] = copy(zero)
			end
		end
		mtx[j][j] = copy(one)
	end
	return true
end

--// matrix.invert ( m1 )
-- Get the inverted matrix or m1
-- matrix must be square and not singular
-- on success: returns inverted matrix
-- on failure: returns nil,'rank of matrix'
function matrix.invert( m1 )
	assert(#m1 == #m1[1], "matrix not square")
	local mtx = matrix.copy( m1 )
	local ident = setmetatable( {},matrix_meta )
	local e = m1[1][1]
    local zero = type(e) == "table" and e.zero or 0
    local one  = type(e) == "table" and e.one  or 1
	for i = 1,#m1 do
		local identi = {}
		ident[i] = identi
		for j = 1,#m1 do
			identi[j] = copy((i == j) and one or zero)
		end
	end
	mtx = matrix.concath( mtx,ident )
	local done,rank = matrix.dogauss( mtx )
	if done then
		return matrix.subm( mtx, 1,(#mtx[1]/2)+1,#mtx,#mtx[1] )
	else
		return nil,rank
	end
end

--// matrix.sqrt ( m1 [,iters] )
-- calculate the square root of a matrix using "Denman Beavers square root iteration"
-- condition: matrix rows == matrix columns; must have a invers matrix and a square root
-- if called without additional arguments, the function finds the first nearest square root to
-- input matrix, there are others but the error between them is very small
-- if called with agument iters, the function will return the matrix by number of iterations
-- the script returns:
--		as first argument, matrix^.5
--		as second argument, matrix^-.5
--		as third argument, the average error between (matrix^.5)^2-inputmatrix
-- you have to determin for yourself if the result is sufficent enough for you
-- local average error
local function get_abs_avg( m1, m2 )
	local dist = 0
	local e = m1[1][1]
	local abs = type(e) == "table" and e.abs or math.abs
	for i=1,#m1 do
		for j=1,#m1[1] do
			dist = dist + abs(m1[i][j]-m2[i][j])
		end
	end
	-- norm by numbers of entries
	return dist/(#m1*2)
end
-- square root function
function matrix.sqrt( m1, iters )
	assert(#m1 == #m1[1], "matrix not square")
	local iters = iters or math.huge
	local y = matrix.copy( m1 )
	local z = matrix(#y, 'I')
	local dist = math.huge
	-- iterate, and get the average error
	for n=1,iters do
		local lasty,lastz = y,z
		-- calc square root
		-- y, z = (1/2)*(y + z^-1), (1/2)*(z + y^-1)
		y, z = matrix.divnum((matrix.add(y,matrix.invert(z))),2),
				matrix.divnum((matrix.add(z,matrix.invert(y))),2)
		local dist1 = get_abs_avg(y,lasty)
		if iters == math.huge then
			if dist1 &gt;= dist then
				return lasty,lastz,get_abs_avg(matrix.mul(lasty,lasty),m1)
			end
		end
		dist = dist1
	end
	return y,z,get_abs_avg(matrix.mul(y,y),m1)
end

--// matrix.root ( m1, root [,iters] )
-- calculate any root of a matrix
-- source: http://www.dm.unipi.it/~cortona04/slides/bruno.pdf
-- m1 and root have to be given;(m1 = matrix, root = number)
-- conditions same as matrix.sqrt
-- returns same values as matrix.sqrt
function matrix.root( m1, root, iters )
	assert(#m1 == #m1[1], "matrix not square")
	local iters = iters or math.huge
	local mx = matrix.copy( m1 )
	local my = matrix.mul(mx:invert(),mx:pow(root-1))
	local dist = math.huge
	-- iterate, and get the average error
	for n=1,iters do
		local lastx,lasty = mx,my
		-- calc root of matrix
		--mx,my = ((p-1)*mx + my^-1)/p,
		--	((((p-1)*my + mx^-1)/p)*my^-1)^(p-2) *
		--	((p-1)*my + mx^-1)/p
		mx,my = mx:mulnum(root-1):add(my:invert()):divnum(root),
			my:mulnum(root-1):add(mx:invert()):divnum(root)
				:mul(my:invert():pow(root-2)):mul(my:mulnum(root-1)
				:add(mx:invert())):divnum(root)
		local dist1 = get_abs_avg(mx,lastx)
		if iters == math.huge then
			if dist1 &gt;= dist then
				return lastx,lasty,get_abs_avg(matrix.pow(lastx,root),m1)
			end
		end
		dist = dist1
	end
	return mx,my,get_abs_avg(matrix.pow(mx,root),m1)
end


--// Norm functions //--

--// matrix.normf ( mtx )
-- calculates the Frobenius norm of the matrix.
--   ||mtx||_F = sqrt(SUM_{i,j} |a_{i,j}|^2)
-- http://en.wikipedia.org/wiki/Frobenius_norm#Frobenius_norm
function matrix.normf(mtx)
	local mtype = matrix.type(mtx)
	local result = 0
	for i = 1,#mtx do
	for j = 1,#mtx[1] do
		local e = mtx[i][j]
		if mtype ~= "number" then e = e:abs() end
		result = result + e^2
	end
	end
	local sqrt = (type(result) == "number") and math.sqrt or result.sqrt
	return sqrt(result)
end

--// matrix.normmax ( mtx )
-- calculates the max norm of the matrix.
--   ||mtx||_{max} = max{|a_{i,j}|}
-- Does not work with symbolic matrices
-- http://en.wikipedia.org/wiki/Frobenius_norm#Max_norm
function matrix.normmax(mtx)
	local abs = (matrix.type(mtx) == "number") and math.abs or mtx[1][1].abs
	local result = 0
	for i = 1,#mtx do
	for j = 1,#mtx[1] do
		local e = abs(mtx[i][j])
		if e &gt; result then result = e end
	end
	end
	return result
end


--// only for number and complex type //--
-- Functions changing the matrix itself

--// matrix.round ( mtx [, idp] )
-- perform round on elements
local numround = function( num,mult )
	return math.floor( num * mult + 0.5 ) / mult
end
local tround = function( t,mult )
	for i,v in ipairs(t) do
		t[i] = math.floor( v * mult + 0.5 ) / mult
	end
	return t
end
function matrix.round( mtx, idp )
	local mult = 10^( idp or 0 )
	local fround = matrix.type( mtx ) == "number" and numround or tround
	for i = 1,#mtx do
		for j = 1,#mtx[1] do
			mtx[i][j] = fround(mtx[i][j],mult)
		end
	end
	return mtx
end

--// matrix.random( mtx [,start] [, stop] [, idip] )
-- fillmatrix with random values
local numfill = function( _,start,stop,idp )
	return math.random( start,stop ) / idp
end
local tfill = function( t,start,stop,idp )
	for i in ipairs(t) do
		t[i] = math.random( start,stop ) / idp
	end
	return t
end
function matrix.random( mtx,start,stop,idp )
	local start,stop,idp = start or -10,stop or 10,idp or 1
	local ffill = matrix.type( mtx ) == "number" and numfill or tfill
	for i = 1,#mtx do
		for j = 1,#mtx[1] do
			mtx[i][j] = ffill( mtx[i][j], start, stop, idp )
		end
	end
	return mtx
end


--//////////////////////////////
--// Object Utility Functions //
--//////////////////////////////

--// for all types and matrices //--

--// matrix.type ( mtx )
-- get type of matrix, normal/complex/symbol or tensor
function matrix.type( mtx )
	local e = mtx[1][1]
	if type(e) == "table" then
		if e.type then
			return e:type()
		end
		return "tensor"
	end
	return "number"
end
	
-- local functions to copy matrix values
local num_copy = function( num )
	return num
end
local t_copy = function( t )
	local newt = setmetatable( {}, getmetatable( t ) )
	for i,v in ipairs( t ) do
		newt[i] = v
	end
	return newt
end

--// matrix.copy ( m1 )
-- Copy a matrix
-- simple copy, one can write other functions oneself
function matrix.copy( m1 )
	local docopy = matrix.type( m1 ) == "number" and num_copy or t_copy
	local mtx = {}
	for i = 1,#m1[1] do
		mtx[i] = {}
		for j = 1,#m1 do
			mtx[i][j] = docopy( m1[i][j] )
		end
	end
	return setmetatable( mtx, matrix_meta )
end

--// matrix.transpose ( m1 )
-- Transpose a matrix
-- switch rows and columns
function matrix.transpose( m1 )
	local docopy = matrix.type( m1 ) == "number" and num_copy or t_copy
	local mtx = {}
	for i = 1,#m1[1] do
		mtx[i] = {}
		for j = 1,#m1 do
			mtx[i][j] = docopy( m1[j][i] )
		end
	end
	return setmetatable( mtx, matrix_meta )
end

--// matrix.subm ( m1, i1, j1, i2, j2 )
-- Submatrix out of a matrix
-- input: i1,j1,i2,j2
-- i1,j1 are the start element
-- i2,j2 are the end element
-- condition: i1,j1,i2,j2 are elements of the matrix
function matrix.subm( m1,i1,j1,i2,j2 )
	local docopy = matrix.type( m1 ) == "number" and num_copy or t_copy
	local mtx = {}
	for i = i1,i2 do
		local _i = i-i1+1
		mtx[_i] = {}
		for j = j1,j2 do
			local _j = j-j1+1
			mtx[_i][_j] = docopy( m1[i][j] )
		end
	end
	return setmetatable( mtx, matrix_meta )
end

--// matrix.concath( m1, m2 )
-- Concatenate two matrices, horizontal
-- will return m1m2; rows have to be the same
-- e.g.: #m1 == #m2
function matrix.concath( m1,m2 )
	assert(#m1 == #m2, "matrix size mismatch")
	local docopy = matrix.type( m1 ) == "number" and num_copy or t_copy
	local mtx = {}
	local offset = #m1[1]
	for i = 1,#m1 do
		mtx[i] = {}
		for j = 1,offset do
			mtx[i][j] = docopy( m1[i][j] )
		end
		for j = 1,#m2[1] do
			mtx[i][j+offset] = docopy( m2[i][j] )
		end
	end
	return setmetatable( mtx, matrix_meta )
end

--// matrix.concatv ( m1, m2 )
-- Concatenate two matrices, vertical
-- will return	m1
--					m2
-- columns have to be the same; e.g.: #m1[1] == #m2[1]
function matrix.concatv( m1,m2 )
	assert(#m1[1] == #m2[1], "matrix size mismatch")
	local docopy = matrix.type( m1 ) == "number" and num_copy or t_copy
	local mtx = {}
	for i = 1,#m1 do
		mtx[i] = {}
		for j = 1,#m1[1] do
			mtx[i][j] = docopy( m1[i][j] )
		end
	end
	local offset = #mtx
	for i = 1,#m2 do
		local _i = i + offset
		mtx[_i] = {}
		for j = 1,#m2[1] do
			mtx[_i][j] = docopy( m2[i][j] )
		end
	end
	return setmetatable( mtx, matrix_meta )
end

--// matrix.rotl ( m1 )
-- Rotate Left, 90 degrees
function matrix.rotl( m1 )
	local mtx = matrix:new( #m1[1],#m1 )
	local docopy = matrix.type( m1 ) == "number" and num_copy or t_copy
	for i = 1,#m1 do
		for j = 1,#m1[1] do
			mtx[#m1[1]-j+1][i] = docopy( m1[i][j] )
		end
	end
	return mtx
end

--// matrix.rotr ( m1 )
-- Rotate Right, 90 degrees
function matrix.rotr( m1 )
	local mtx = matrix:new( #m1[1],#m1 )
	local docopy = matrix.type( m1 ) == "number" and num_copy or t_copy
	for i = 1,#m1 do
		for j = 1,#m1[1] do
			mtx[j][#m1-i+1] = docopy( m1[i][j] )
		end
	end
	return mtx
end

local function tensor_tostring( t,fstr )
	if not fstr then return "["..table.concat(t,",").."]" end
	local tval = {}
	for i,v in ipairs( t ) do
		tval[i] = string.format( fstr,v )
	end
	return "["..table.concat(tval,",").."]"
end
local function number_tostring( e,fstr )
	return fstr and string.format( fstr,e ) or e
end

--// matrix.tostring ( mtx, formatstr )
-- tostring function
function matrix.tostring( mtx, formatstr )
	local ts = {}
	local mtype = matrix.type( mtx )
	local e = mtx[1][1]
	local tostring = mtype == "tensor" and tensor_tostring or
	      type(e) == "table" and e.tostring or number_tostring
	for i = 1,#mtx do
		local tstr = {}
		for j = 1,#mtx[1] do
			tstr[j] = tostring(mtx[i][j],formatstr)
		end
		ts[i] = table.concat(tstr, "\t")
	end
	return table.concat(ts, "\n")
end

--// matrix.print ( mtx [, formatstr] )
-- print out the matrix, just calls tostring
function matrix.print( ... )
	print( matrix.tostring( ... ) )
end

--// matrix.latex ( mtx [, align] )
-- LaTeX output
function matrix.latex( mtx, align )
	-- align : option to align the elements
	--		c = center; l = left; r = right
	--		\usepackage{dcolumn}; D{.}{,}{-1}; aligns number by . replaces it with ,
	local align = align or "c"
	local str = "$\\left( \\begin{array}{"..string.rep( align, #mtx[1] ).."}\n"
	local getstr = matrix.type( mtx ) == "tensor" and tensor_tostring or number_tostring
	for i = 1,#mtx do
		str = str.."\t"..getstr(mtx[i][1])
		for j = 2,#mtx[1] do
			str = str.." &amp; "..getstr(mtx[i][j])
		end
		-- close line
		if i == #mtx then
			str = str.."\n"
		else
			str = str.." \\\\\n"
		end
	end
	return str.."\\end{array} \\right)$"
end


--// Functions not changing the matrix

--// matrix.rows ( mtx )
-- return number of rows
function matrix.rows( mtx )
	return #mtx
end

--// matrix.columns ( mtx )
-- return number of columns
function matrix.columns( mtx )
	return #mtx[1]
end

--//  matrix.size ( mtx )
-- get matrix size as string rows,columns
function matrix.size( mtx )
	if matrix.type( mtx ) == "tensor" then
		return #mtx,#mtx[1],#mtx[1][1]
	end
	return #mtx,#mtx[1]
end

--// matrix.getelement ( mtx, i, j )
-- return specific element ( row,column )
-- returns element on success and nil on failure
function matrix.getelement( mtx,i,j )
	if mtx[i] and mtx[i][j] then
		return mtx[i][j]
	end
end

--// matrix.setelement( mtx, i, j, value )
-- set an element ( i, j, value )
-- returns 1 on success and nil on failure
function matrix.setelement( mtx,i,j,value )
	if matrix.getelement( mtx,i,j ) then
		-- check if value type is number
		mtx[i][j] = value
		return 1
	end
end

--// matrix.ipairs ( mtx )
-- iteration, same for complex
function matrix.ipairs( mtx )
	local i,j,rows,columns = 1,0,#mtx,#mtx[1]
	local function iter()
		j = j + 1
		if j &gt; columns then -- return first element from next row
			i,j = i + 1,1
		end
		if i &lt;= rows then
			return i,j
		end
	end
	return iter
end

--///////////////////////////////
--// matrix 'vector' functions //
--///////////////////////////////

-- a vector is defined as a 3x1 matrix
-- get a vector; vec = matrix{{ 1,2,3 }}^'T'

--// matrix.scalar ( m1, m2 )
-- returns the Scalar Product of two 3x1 matrices (vectors)
function matrix.scalar( m1, m2 )
	return m1[1][1]*m2[1][1] + m1[2][1]*m2[2][1] +  m1[3][1]*m2[3][1]
end

--// matrix.cross ( m1, m2 )
-- returns the Cross Product of two 3x1 matrices (vectors)
function matrix.cross( m1, m2 )
	local mtx = {}
	mtx[1] = { m1[2][1]*m2[3][1] - m1[3][1]*m2[2][1] }
	mtx[2] = { m1[3][1]*m2[1][1] - m1[1][1]*m2[3][1] }
	mtx[3] = { m1[1][1]*m2[2][1] - m1[2][1]*m2[1][1] }
	return setmetatable( mtx, matrix_meta )
end

--// matrix.len ( m1 )
-- returns the Length of a 3x1 matrix (vector)
function matrix.len( m1 )
	return math.sqrt( m1[1][1]^2 + m1[2][1]^2 + m1[3][1]^2 )
end


--// matrix.replace (mtx, func, ...)
-- for each element e in the matrix mtx, replace it with func(mtx, ...).
function matrix.replace( m1, func, ... )
	local mtx = {}
	for i = 1,#m1 do
		local m1i = m1[i]
		local mtxi = {}
		for j = 1,#m1i do
			mtxi[j] = func( m1i[j], ... )
		end
		mtx[i] = mtxi
	end
	return setmetatable( mtx, matrix_meta )
end

--// matrix.remcomplex ( mtx )
-- set the matrix elements to strings
-- IMPROVE: tostring v.s. tostringelements confusing
function matrix.elementstostrings( mtx )
	local e = mtx[1][1]
	local tostring = type(e) == "table" and e.tostring or tostring
	return matrix.replace(mtx, tostring)
end

--// matrix.solve ( m1 )
-- solve; tries to solve a symbolic matrix to a number
function matrix.solve( m1 )
	assert( matrix.type( m1 ) == "symbol", "matrix not of type 'symbol'" )
	local mtx = {}
	for i = 1,#m1 do
		mtx[i] = {}
		for j = 1,#m1[1] do
			mtx[i][j] = tonumber( loadstring( "return "..m1[i][j][1] )() )
		end
	end
	return setmetatable( mtx, matrix_meta )
end

--////////////////////////--
--// METATABLE HANDLING //--
--////////////////////////--

--// MetaTable
-- as we declaired on top of the page
-- local/shared metatable
-- matrix_meta

-- note '...' is always faster than 'arg1,arg2,...' if it can be used

-- Set add "+" behaviour
matrix_meta.__add = function( ... )
	return matrix.add( ... )
end

-- Set subtract "-" behaviour
matrix_meta.__sub = function( ... )
	return matrix.sub( ... )
end

-- Set multiply "*" behaviour
matrix_meta.__mul = function( m1,m2 )
	if getmetatable( m1 ) ~= matrix_meta then
		return matrix.mulnum( m2,m1 )
	elseif getmetatable( m2 ) ~= matrix_meta then
		return matrix.mulnum( m1,m2 )
	end
	return matrix.mul( m1,m2 )
end

-- Set division "/" behaviour
matrix_meta.__div = function( m1,m2 )
	if getmetatable( m1 ) ~= matrix_meta then
		return matrix.mulnum( matrix.invert(m2),m1 )
	elseif getmetatable( m2 ) ~= matrix_meta then
		return matrix.divnum( m1,m2 )
	end
	return matrix.div( m1,m2 )
end

-- Set unary minus "-" behavior
matrix_meta.__unm = function( mtx )
	return matrix.mulnum( mtx,-1 )
end

-- Set power "^" behaviour
-- if opt is any integer number will do mtx^opt
--   (returning nil if answer doesn't exist)
-- if opt is 'T' then it will return the transpose matrix
-- only for complex:
--    if opt is '*' then it returns the complex conjugate matrix
	local option = {
		-- only for complex
		["*"] = function( m1 ) return matrix.conjugate( m1 ) end,
		-- for both
		["T"] = function( m1 ) return matrix.transpose( m1 ) end,
	}
matrix_meta.__pow = function( m1, opt )
	return option[opt] and option[opt]( m1 ) or matrix.pow( m1,opt )
end

-- Set equal "==" behaviour
matrix_meta.__eq = function( m1, m2 )
	-- check same type
	if matrix.type( m1 ) ~= matrix.type( m2 ) then
		return false
	end
	-- check same size
	if #m1 ~= #m2 or #m1[1] ~= #m2[1] then
		return false
	end
	-- check elements equal
	for i = 1,#m1 do
		for j = 1,#m1[1] do
			if m1[i][j] ~= m2[i][j] then
				return false
			end
		end
	end
	return true
end

-- Set tostring "tostring( mtx )" behaviour
matrix_meta.__tostring = function( ... )
	return matrix.tostring( ... )
end

-- set __call "mtx( [formatstr] )" behaviour, mtx [, formatstr]
matrix_meta.__call = function( ... )
	matrix.print( ... )
end

--// __index handling
matrix_meta.__index = {}
for k,v in pairs( matrix ) do
	matrix_meta.__index[k] = v
end


--/////////////////////////////////
--// symbol class implementation
--/////////////////////////////////

-- access to the symbolic metatable
local symbol_meta = {}; symbol_meta.__index = symbol_meta
local symbol = symbol_meta

function symbol_meta.new(o)
	return setmetatable({tostring(o)}, symbol_meta)
end
symbol_meta.to = symbol_meta.new

-- symbol( arg )
-- same as symbol.to( arg )
-- set __call behaviour of symbol
setmetatable( symbol_meta, { __call = function( _,s ) return symbol_meta.to( s ) end } )


-- Converts object to string, optionally with formatting.
function symbol_meta.tostring( e,fstr )
	return string.format( fstr,e[1] )
end

-- Returns "symbol" if object is a symbol type, else nothing.
function symbol_meta:type()
	if getmetatable(self) == symbol_meta then
		return "symbol"
	end
end

-- Performs string.gsub on symbol.
-- for use in matrix.replace
function symbol_meta:gsub(from, to)
	return symbol.to( string.gsub( self[1],from,to ) )
end

-- creates function that replaces one letter by something else
-- makereplacer( "a",4,"b",7, ... )(x)
-- will replace a with 4 and b with 7 in symbol x.
-- for use in matrix.replace
function symbol_meta.makereplacer( ... )
	local tosub = {}
	local args = {...}
	for i = 1,#args,2 do
		tosub[args[i]] = args[i+1]
    end
	local function func( a ) return tosub[a] or a end
	return function(sym)
		return symbol.to( string.gsub( sym[1], "%a", func ) )
	end
end

-- applies abs function to symbol
function symbol_meta.abs(a)
	return symbol.to("(" .. a[1] .. "):abs()")
end

-- applies sqrt function to symbol
function symbol_meta.sqrt(a)
	return symbol.to("(" .. a[1] .. "):sqrt()")
end

function symbol_meta.__add(a,b)
	return symbol.to(a .. "+" .. b)
end

function symbol_meta.__sub(a,b)
	return symbol.to(a .. "-" .. b)
end

function symbol_meta.__mul(a,b)
	return symbol.to("(" .. a .. ")*(" .. b .. ")")
end

function symbol_meta.__div(a,b)
	return symbol.to("(" .. a .. ")/(" .. b .. ")")
end

function symbol_meta.__pow(a,b)
	return symbol.to("(" .. a .. ")^(" .. b .. ")")
end

function symbol_meta.__eq(a,b)
	return a[1] == b[1]
end

function symbol_meta.__tostring(a)
	return a[1]
end

function symbol_meta.__concat(a,b)
	return tostring(a) .. tostring(b)
end

matrix.symbol = symbol


--///////////////--
--// chillcode //--
--///////////////--</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>linear regression</name>
											<packageName></packageName>
											<script>--///////////////////--
--// Curve Fitting //--
--///////////////////--

-- v 0.2

-- Lua 5.1 compatible

-- little add-on to the matrix module, to show some curve fitting

-- http://luaforge.net/projects/LuaMatrix
-- http://lua-users.org/wiki/SimpleFit

-- Licensed under the same terms as Lua itself.

-- requires matrix module
--local matrix = require "matrix"

-- The Fit Table
fit = {}

-- Note all these Algos use the Gauss-Jordan Method to caculate equation systems

-- function to get the results
function getresults( mtx )
   assert( #mtx+1 == #mtx[1], "Cannot calculate Results" )
   mtx:dogauss()
   -- tresults
   local cols = #mtx[1]
   local tres = {}
   for i = 1,#mtx do
      tres[i] = mtx[i][cols]
   end
   return unpack( tres )
end

-- fit.linear ( x_values, y_values )
-- fit a straight line
-- model (  y = a + b * x  )
-- returns a, b
function fit.linear( x_values,y_values )
   -- x_values = { x1,x2,x3,...,xn }
   -- y_values = { y1,y2,y3,...,yn }
   
   -- values for A matrix
   local a_vals = {}
   -- values for Y vector
   local y_vals = {}

   for i,v in ipairs( x_values ) do
      a_vals[i] = { 1, v }
      y_vals[i] = { y_values[i] }
   end

   -- create both Matrixes
   local A = matrix:new( a_vals )
   local Y = matrix:new( y_vals )

   local ATA = matrix.mul( matrix.transpose(A), A )
   local ATY = matrix.mul( matrix.transpose(A), Y )

   local ATAATY = matrix.concath(ATA,ATY)

   return getresults( ATAATY )
end

-- fit.parabola ( x_values, y_values )
-- Fit a parabola
-- model (  y = a + b * x + c * x )
-- returns a, b, c
function fit.parabola( x_values,y_values )
   -- x_values = { x1,x2,x3,...,xn }
   -- y_values = { y1,y2,y3,...,yn }

   -- values for A matrix
   local a_vals = {}
   -- values for Y vector
   local y_vals = {}

   for i,v in ipairs( x_values ) do
      a_vals[i] = { 1, v, v*v }
      y_vals[i] = { y_values[i] }
   end

   -- create both Matrixes
   local A = matrix:new( a_vals )
   local Y = matrix:new( y_vals )

   local ATA = matrix.mul( matrix.transpose(A), A )
   local ATY = matrix.mul( matrix.transpose(A), Y )

   local ATAATY = matrix.concath(ATA,ATY)

   return getresults( ATAATY )
end

-- fit.exponential ( x_values, y_values )
-- Fit exponential
-- model (  y = a * x^b )
-- returns a, b
function fit.exponential( x_values,y_values )
   -- convert to linear problem
   -- ln(y) = ln(a) + b * ln(x)
   for i,v in ipairs( x_values ) do
      x_values[i] = math.log( v )
      y_values[i] = math.log( y_values[i] )
   end

   local a,b = fit.linear( x_values,y_values )

   return math.exp(a), b
end

--///////////////--
--// chillcode //--
--///////////////--</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<Script isActive="yes" isFolder="no">
										<name>Check For Any Missing Variables</name>
										<packageName></packageName>
										<script>function ataxiaCheckForMissing()
	checkedMissingVariables = true
  local sp
	if ataxia then
    ataxia.settings.separator = ";"
    sp = ataxia.settings.separator
  end
  
  if ataxia.settings.highlighting == nil then
    ataxia.settings.highlighting = {}
    ataxiaEcho("Highlight settings not found. Changed to default.")
    ataxiaEcho("See 'item highlighting' alias for more info.")
  end
  
  if ataxia.usegui == nil then
    ataxia.usegui = true
    ataxiaEcho("Using default GUI for the system.")
  end
  
  if ataxia.settings.goldcommand == nil then
    ataxia.settings.goldcommand = "get gold"..sp.."put gold in pack"
    ataxiaEcho("Gold grabbing command defaulted to: &lt;green&gt;"..ataxia.settings.goldcommand)
    ataxiaEcho("&lt;green&gt;aconfig goldgrab (command)&lt;NavajoWhite&gt; to set it.")
  end
  
	if ataxia.settings.lustlist == nil then
		ataxia.settings.lustlist = {}
		ataxiaEcho("Lust settings not found. Changed to default.")
		ataxiaEcho("&lt;green&gt;lustallow &lt;name&gt;&lt;NavajoWhite&gt; to use.")
		ataxiaEcho("Will also remove if they're already on the list.")
		ataxiaEcho("For queueing purposes you can also call ataxia_needReject() to check if you need to reject.")
		ataxiaEcho("If it returns true, ataxiaTemp.reject will be set to the person.")
		ataxiaEcho("&lt;green&gt;lustallow list&lt;NavajoWhite&gt; will show everyone on the list.")
	end
	
	if ataxia.settings.relayingto == nil then
		ataxia.settings.relayingto = false
		ataxiaEcho("Channel relay setting not found, adding it in. Default is faulse.")
		ataxiaEcho("&lt;green&gt;aconfig relay &lt;channel&gt; &lt;NavajoWhite&gt;to change.")
		ataxiaEcho("&lt;green&gt;aconfig relay clt2 &lt;NavajoWhite&gt;for example.")
		ataxiaEcho("'false' or 'off' will disable callouts again.")
	end
	
	if ataxiaBasher.rageraze == nil then
		ataxiaBasher.rageraze = false
		ataxiaEcho("Battlerage razing option not found; defaulting to false.")
		ataxiaEcho("&lt;green&gt;bash rageraze on/off &lt;NavajoWhite&gt;to change.")
	end
	
	if ataxia.prioritySwaps and ataxia.prioritySwaps.ravaged == nil then
		ataxia.prioritySwaps.ravaged = {active = false, desc = "Automatically prio mana sipping while ravagedmind is active."}
		ataxiaEcho("Ravagedmind priority swap not found. Added it to swaps; default is off.")
	end
	
  if ataxia.prioritySwaps and ataxia.prioritySwaps.psionBleed == nil then
		ataxia.prioritySwaps.psionBleed = {active = false, desc = "Automatic prio on haemophilia once bleed is stacked."}
		ataxiaEcho("Psionbleed priority swap not found. Added it to swaps; default is off.")  
  end
  
  if ataxia.prioritySwaps and ataxia.prioritySwaps.parshield == nil then
    ataxia.prioritySwaps.parshield = {active = false, desc = "Temporarily ignore paralysis on shielding."}
    ataxiaEcho("Parshield priority swap not found. Added it to swaps; default is off.")
  end
  
	if ataxia.prioritySwaps and ataxia.prioritySwaps.magi == nil then
		ataxia.prioritySwaps.magi = {active = false, desc = "Automatic handling for burns and frozen status."}
		ataxiaEcho("Magi priority swap not found. Added it to swaps; default is off.")
	end
	
	if not ataxia.settings.roomshorten then
		ataxiaEcho("Room condense setting not found. Defaulting to normal; see changelog for information.")
		ataxia.settings.roomshorten = "normal"
	end
	
	if ataxiaBasher.treeblackout == nil then
		ataxiaBasher.treeblackout = false
		ataxiaEcho("Bashing Tree Setting not found: Reverting to default; won't use tree when blacked out while bashing.")
		cecho("\n     &lt;NavajoWhite&gt;aconfig treeblackout &lt;NavajoWhite&gt; to toggle.")
	end
	
	if ataxia.settings.autogallop == nil then
		ataxia.settings.autogallop = false
		ataxiaEcho("Auto Gallop Setting not found: Reverting to default; won't toggle gallop when mounted.")
		cecho("\n     &lt;NavajoWhite&gt;aconfig gallop &lt;on/off&gt; to toggle.")
	end
	
	if not ataxia.sylvanStuff then
		ataxia.sylvanStuff = {propagateList = {arms = false, legs = false, head = false, body = false}}
		ataxiaEcho("Sylvan stuff defaulted to normal values. Check &lt;red&gt;aconfig sylvan help&lt;Navajowhite&gt; for info.")
		ataxiaEcho("If you're not a Sylvan then ignore this.")
	end
	end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Install System</name>
										<packageName></packageName>
										<script>function ataxia_installSystem()
	send("config prompt all")
  send("config screenwidth 0")
	send("curing on")
	send("curing afflictions on")
	send("curing defences on")
	send("config advancedcuring on")
  send("config showqueuealerts on")
  send("config wrapwidth 0")
	send("curing batch on")
	send("curing priority health")
	send("curing reporting on")
	send("curing siphealth 80")
	send("curing sipmana 80")
	send("curing mosshealth 70")
	send("curing mossmana 70")
	send("curing clotat 30")
	send("config ragemsg off")
  send("curing fallback on")

	ataxia_defaultSettings()
  
end

function ataxia_updateApplied(_, name)
	if name:find("Ataxia") or name:find("ataxia") then
		ataxiaEcho("System package has been successfully installed.")
		checkedMissingVariables = false
		ataxiaCheckForMissing()
		system_packageName = name
		
		ataxia_changeLog()
	end
end
registerAnonymousEventHandler("sysInstallPackage", "ataxia_updateApplied")

</script>
										<eventHandlerList />
									</Script>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Deffing</name>
										<packageName></packageName>
										<script>function buildDefsTable()
	ataxiaTables.defences = {}

	ataxiaTables.defences = {
		--Curatives
		airpocket = "airpocket",
		blindness = "blindness",
		caloric = "insulation",
		deafness = "deafness",
		deathsight = "deathsight",
		fangbarrier = "fangbarrier",
		frost = "temperance",
		insomnia = "insomnia",
		kola = "kola",
		levitation = "levitating",
		mass = "density",
		parrying = "parrying",
		rebounding = "rebounding",
		speed = "speed",
		shield = "shield",
		thirdeye = "thirdeye",
		venom = "poisonresist",

		--Alchemist
		astronomy = "astronomy",
    compoundmask = "compoundmask",
		mercury = "mercury",
		sulphur = "sulphur",
		tin = "tin",

		--Blademaster
		consciousness = "consciousness",
		shinclarity = "shinclarity",
		shinbinding = "shinbinding",
		shintrance = "shintrance",
		retaliation = "retaliation",
    mindnet = "mindnet",
    weathering = "weathering",


		--Apostate
		demonarmour = "demonarmour",
		truestare = "truestare",
		
		--Bard
		aria = "aria",
		lay = "lay",
		songbird = "songbird",
		tune = "blade tune",
		heartsfury = "heartsfury",
    acrobatics = "acrobatics on",
    harrying = "dance harrying",

		--Depthswalker
		blur = "blur",
		bodyaugment = "bodyaugment",
		disperse = "disperse",
		durability = "durability",
		precision = "precision",
		shadowveil = "shadowveil",
    antiforce = "antiforce",
		
		--Dragon/Elemental Lord
		cohesion = "cohesion",
		dragonbreath = "dragonbreath",
		dragonarmour = "dragonarmour",
		tempest = "tempest",
		susurrating = "susurrating",
    fireshroud = "fireshroud",
    extrusion = "extrusion",
    strata = "strata",
		
		--Jester
		slippery = "slippery",
		balancing = "balancing",
		acrobatics = "acrobatics",
    
    -- Knight
    deflect = "deflect",
    blademastery = "blademastery",
		
    --Magi
		chargeshield = "chargeshield",
		diamondskin = "diamondskin",
		stoneskin = "stoneskin",
    simultaneity = "simultaneity",

		--Monk
		boostedregeneration = "boosting",
		kaitrance = "kaitrance",
		hyperfocus = "hyperfocus",
		regeneration = "regeneration",
		shikudoform = "shikudoform",
		splitmind = "splitmind",
		mindnet = "mindnet",
    bodyblock = "bodyblock",
    evadeblock = "evadeblock",
    pinchblock = "pinchblock",
    hypersense = "hypersense",
    kaiboost = "kaiboost",
    mindcloak = "mindcloak", 
    
    --pariah
    shieldlogograph = "shieldlogograph",
    accursedresolve = "accursedresolve",
    leechlogograph = "leechlogograph",       

		--Necromancy
		deathaura = "deathaura",
		lifevision = "lifevision",
		soulcage = "soulcage",
		vengeance = "vengeance",

		--Occultist
		arctar = "arctar",
		devilmark = "devilmark",
		distortedaura = "distortedaura",
		tentacles = "tentacles",

		--Priest
		willpowerblessing = "willpowerblessing",
		enduranceblessing = "enduranceblessing",
		thermalshield = "thermalshield",
		frostshield = "frostshield",
		earthshield = "earthshield",

		--Psion
		guidedstrike = "guidedstrike",
		psitranscend = "psitranscend",
		secondskin = "secondskin",
		rupturesight = "rupturesight",
    psicomprehend = "psicomprehend",
    psibreakthrough = "psibreakthrough",

		--Sentinel
		affinity = "affinity",
		barkskin = "barkskin",
		firstaid = "firstaid",
		stealth = "stealth",
    scouting = "scouting",
    fleetness = "fleetness",
    

		--Serpent
     ghost = "ghost",
     lipreading = "lipreading",
     pacing = "pacing",
     scales = "scales",
     weaving = "weaving",

		--Shaman
		swiftcurse = "swiftcurse",
    
    --Sylvan
    spinningstaff = "spinningstaff",
    viridian = "viridian",
    
    --Unnamable
    bulk = "bulk",
    mouths = "mouths",
    joints = "joints",
    eyes = "eyes",
    unnamablepresence = "unnamablepresence",

		--Shared
    grookbubble = "grookbubble",
		constitution = "constitution",
    consciousness = "consciousness",
		curseward = "curseward",
		gripping = "gripping",
		lifevision = "lifevision",
		nicatorlegend = "nicatorlegend",
		nightsight = "nightsight",
		resistance = "resistance",
		toughness = "toughness",
    shroud = "shroud",
		weathering = "weathering",
		vitality = "vitality",
		blocking = "blocking",
		coldresist = "coldresist",
		electricresist = "electricresist",
		fireresist = "fireresist",
		magicresist = "magicresist",
		hypersight = "hypersight",
		alertness = "alertness",
		vigilance = "vigilance",
		skywatch = "skywatch",
		treewatch = "treewatch",
		groundwatch = "groundwatch",
    selfishness = "selfishness",
    heldbreath = "heldbreath",

		--Tattoos
		boartattoo = "boartattoo",
		cloak = "cloak",
		megalithtattoo = "megalithtattoo",
		mindseye = "mindseye",
		moontattoo = "moontattoo",
		mosstattoo = "mosstattoo",

	}
end

function find_defence(d)
	local def = d
	buildDefsTable()



	for defence, actual in pairs(ataxiaTables.defences) do
		if defence == def or actual == def then
			return defence
		end
	end
end

function trueDef(def)
	local def = def:lower()
	buildDefsTable()

	if def:find("parrying") then
		return "parrying"
	else
		for defence, actual in pairs(ataxiaTables.defences) do
			if defence == def or actual == def then
				return defence
			end
		end
	end
  return def
end</script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>Defence API</name>
											<packageName></packageName>
											<script>function haveDef(def)
	if ataxia.defences[def] then
		return true
	else
		return false
	end
end

function supportedDefence(def)
	buildDefsTable()
	local support = false
	for csd, ssd in pairs(ataxiaTables.defences, def) do
		if (csd == def) or (ssd == def) then
			support = true
			break
		end
	end
	return support
end

function addToDefup(defence)
	local cur = ataxia.settings.defences.current
	if cur == "" then
		ataxiaEcho("Not currently in a defup profile. Please fix it.")
		return
	end

	if not ataxia.settings.defences.defup[cur][defence] then
		ataxia.settings.defences.defup[cur][defence] = true
		ataxiaEcho(defence.." has been added to the "..cur.." defup profile.")
	else
		ataxiaEcho(defence.." is already in the "..cur.." defup profile.")
	end
end

function addToKeepup(defence)
	local cur = ataxia.settings.defences.current
	if cur == "" then
		ataxiaEcho("Not currently in a defup profile. Please fix it.")
		return
	end

	if not ataxia.settings.defences.keepup[cur][defence] then
		ataxia.settings.defences.defup[cur][defence] = true
		ataxia.settings.defences.keepup[cur][defence] = true
		ataxiaEcho(defence.." has been added to the "..cur.." keepup profile.")
		send("curing priority defence "..defence.." 25")
	else
		ataxiaEcho(defence.." is already in the "..cur.." keepup profile.")
	end
end

function toggleKeepup(defence, option)
	local cur = ataxia.settings.defences.current
	if cur == "" then
		ataxiaEcho("Not currently in a defup profile. Please fix it.")
		return
	end

	if option == nil then
		if not ataxia.settings.defences.keepup[cur][defence] then
			ataxia.settings.defences.keepup[cur][defence] = true
			ataxiaEcho(defence.." has been added to the "..cur.." keepup profile.")
		else
			ataxia.settings.defences.keepup[cur][defence] = nil
			ataxiaEcho(defence.." has been removed to the "..cur.." keepup profile.")
		end
	elseif type(option) == "boolean" then
		ataxia.settings.defences.keepup[cur][defence] = (option == true and true or nil)
		ataxiaEcho((option == true and "Added" or "Removed").." "..defence.." "..(option == true and "to" or "from").." the "..cur.." keepup profile.")
	else
		ataxiaEcho("Toggling must be either true, or false, for defences.")
	end
end

function gotDef()
	local def = trueDef(gmcp.Char.Defences.Add.name)
	local cur = ataxia.settings.defences.current

	if not def:find("parrying") and not ataxiaBasher.enabled then
		cecho("\n&lt;green&gt;+ ( def &lt;NavajoWhite&gt;"..def:lower().."&lt;green&gt; ) +")
	end
	ataxia.defences[def:lower()] = true

	if cur ~= "" and not def:find("parrying") and not def:find("blocking") then
		if not ataxia.settings.defences.keepup[cur][def] and not ataxiaBasher.enabled then
			send("curing priority defence "..def:lower().." reset",false)
		end
    
    if def:lower() == "shield" or def:lower() == "curseward" then
      if ataxia.prioritySwaps and ataxia.prioritySwaps.parshield and ataxia.prioritySwaps.parshield.active then
        sendAll("curing priority slickness 25;curing priority paralysis 25",false)
        tempTimer(1.4, [[ ataxia_restorePrio("paralysis");ataxia_restorePrio("slickness") ]])
      end
    elseif def == "alertness" then
      enableTrigger("Alertness Tracking")
    end
	end
end

function lostDef()
	local def = gmcp.Char.Defences.Remove
	if def[1] == "hyperfocus" then
		ataxiaEcho("No longer hyperfocusing a limb.")
  elseif def[1] == "alertness" then
    disableTrigger("Alertness Tracking")
  elseif def[1] == "prismatic" and ataxiaTemp.lyreMode then
    send("curing on",false)
    local sp = ataxia.settings.separator 
    send("queue addclear free stand"..sp.."curing off"..sp.."strum lyre",false)
	elseif not ataxiaBasher.enabled then
		cecho("\n&lt;red&gt;- ( def &lt;NavajoWhite&gt;"..def[1]:lower().."&lt;red&gt; ) -")
		if def[1]:lower() == "speed" then
			ataxia_boxEcho("BEWARE OF AEON - SPEED HAS BEEN STRIPPED", "NavajoWhite:a_darkmagenta")
		end
	end
	ataxia.defences[def[1]:lower()] = nil
	ataxiaTemp.lokiCheck = true

end

function defenceList()
	local defs = gmcp.Char.Defences.List
	ataxia.defences = {}

	for _, def in pairs(defs) do
		ataxia.defences[def.name:lower()] = true
	end
end

registerAnonymousEventHandler("gmcp.Char.Defences.List", "defenceList")
registerAnonymousEventHandler("gmcp.Char.Defences.Add", "gotDef")
registerAnonymousEventHandler("gmcp.Char.Defences.Remove", "lostDef")</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Deffing Up</name>
											<packageName></packageName>
											<script>function systemDefup(profile)
	local cur = ataxia.settings.defences.current
	local command = ""
	if profile == "none" then
		ataxia.settings.defences.current = ""
		if cur ~= "" then
			sendAll("curing priority defence list reset",false)
		end
		ataxiaEcho("Switching to empty defence profile.")
	else
		if ataxia.settings.defences.defup[profile] then
			ataxia.settings.defences.current = profile
			cur = ataxia.settings.defences.current
			ataxiaEcho("Deffing up in the "..profile.." profile.")
      command = "curing priority defence "
			for def, val in pairs(ataxia.settings.defences.defup[cur]) do
				command = command..def.." 25 "
			end

			send(command,false)
	
			if deffingFailsafe then killTimer(deffingFailsafe) end
			deffingFailsafe = tempTimer(60, [[defupFailsafe(); deffingFailsafe = nil]])
			
			checkSSCErrors()
			
		else
			ataxiaEcho("That is not a valid defup profile!")
		end
	end
end

function defupFailsafe()
	local cur = ataxia.settings.defences.current
	local command = "curing priority defence "

	if deffingFailsafe then killTimer(deffingFailsafe) end

	for def, val in pairs(ataxia.settings.defences.defup[cur]) do
		if not ataxia.settings.defences.keepup[cur][def] then
			command = command..def.." reset "
		end
	end
	send(command,false)
end

function checkSSCErrors()
	local cur = ataxia.settings.defences.current
	local defl = ataxia.settings.defences.defup[cur]

	if defl.deathsight and not ataxia.settings.have.deathsight and not ataxia.defences.deathsight then
		if defl.lifevision and ataxia_isClass("occultist") then
			send("astralvision",false)
		else
			send("deathsight;lifevision",false)
		end
	end
	
	if ataxia_isClass("magi") or ataxia_isClass("sylvan") then
		send("simultaneity",false)     
	elseif ataxia_isClass("Apostate") and defl.demonarmour then
		sendAll("summon baalzadeen", "queue addclear free mask; queue add free demon syphon",false)
  elseif ataxia_isClass("Alchemist") then
    send("secure mask",false)
	elseif ataxia_isClass("priest") then
		sendAll("recite benediction me", "perform bliss me",false)
  elseif ataxia_isClass("pariah") then
    send("crux let me",false)
  elseif ataxia_isClass("druid") and not isMorphed("hydra") then
    send("morph hydra",false)
  elseif ataxia_isClass("sentinel") and not isMorphed("jaguar") then
    send("morph jaguar",false)
  else
  send("queue add free shroud;queue add free lifevision")
	end

	if defl.regeneration and not ataxia.defences.regeneration and defl.boostedregeneration then
		send("regeneration on",false)
	end
end

function ataxia_nextPropagation()
	if not ataxiaTemp.propagating then return end
	if not ataxia.defences.viridian then
		ataxiaEcho("Need to be in viridian to be able to propagate!")
		ataxiaTemp.propagating = false
	end
	
	local found = false
	for limb, herb in pairs(ataxia.sylvanStuff.propagateList) do
		if not ataxiaTemp.currentProps[limb] and herb ~= false then
			found = true
			send("queue addclear class propagate "..limb.." with "..herb,false)
			break
		end
	end
	if not found then
		ataxiaTemp.propagating = false
		ataxiaEcho("Propagations are now all set!")
	end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Defence Reporting</name>
											<packageName></packageName>
											<script>function ataxia_reportDefences()
	local x = ""
	local cur = ataxia.settings.defences.current
	local defs = gmcp.Char.Defences.List
	local defLine, ddx, total = 0, "", 0
	local defenceList = {
		system = {},
		other = {},
	}

	for _, def in pairs(defs) do
		x = find_defence(def.name)
		if ataxia.settings.defences.defup[cur][x] then
			table.insert(defenceList.system, x)
		else
			table.insert(defenceList.other, def.name)
		end
	end
	total = #defenceList.other
	table.sort(defenceList.system)

	echo("\n")
	ataxiaEcho(cur:title().." defences:")
	echo("\n")

	for _, def in pairs(defenceList.system) do
		defLine = defLine + 1
		ddx = "&lt;a_darkcyan&gt;[&lt;green&gt;x&lt;a_darkcyan&gt;] "
		total = total + 1
		if (defLine-1)%3 == 0 then
			echo("\n")
		end
		cecho(ddx)
		
		local dspace = def:title()
		if dspace:len() &lt; 25 and (defLine-1)%3 ~= 2 then
			local padding = 25 - dspace:len()
			dspace = dspace..string.rep(" ", padding)
		elseif dspace:len() &gt; 25 then
			dspace:cut(25)
		end
		
		cecho("&lt;DarkSlateBlue&gt;"..dspace)
	end

	for i,v in pairs(ataxia.settings.defences.defup[cur]) do
		if not table.contains(defenceList.system, i) then
			defLine = defLine + 1
			ddx = "&lt;a_darkcyan&gt;[&lt;a_red&gt;-&lt;a_darkcyan&gt;] "
			if (defLine-1)%3 == 0 then
				echo("\n")
			end
			cecho(ddx)

			local dspace = i:title()
			if dspace:len() &lt; 25 and (defLine-1)%3 ~= 2 then
				local padding = 25 - dspace:len()
				dspace = dspace..string.rep(" ", padding)
			elseif dspace:len() &gt; 25 then
				dspace:cut(25)
			end
			cecho("&lt;DarkSlateBlue&gt;"..dspace)
		end
	end

	echo("\n")
	ataxiaEcho("Other defences:")
	echo("\n")
	defLine = 0

	for _,v in pairs(defenceList.other) do
		defLine = defLine + 1
		ddx = "&lt;a_darkcyan&gt;[&lt;NavajoWhite&gt;x&lt;a_darkcyan&gt;] "

		if (defLine-1)%3 == 0 then
			echo("\n")
		end
		cecho(ddx)

		local dspace = v:title()
		if dspace:len() &lt; 25 and (defLine-1)%3 ~= 2 then
			local padding = 25 - dspace:len()
			dspace = dspace..string.rep(" ", padding)
		elseif dspace:len() &gt; 25 then
			dspace:cut(25)
		end

		cecho("&lt;DarkSlateBlue&gt;"..dspace)
	end
	echo("\n")
	ataxiaEcho(total.." total defences.")
	send(" ")
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Defence Sorting - Cleaner</name>
											<packageName></packageName>
											<script>function sortedDefenceShow()
   ataxiaTables.classDefences = {
   curatives = {
      airpocket = "airpocket",
      blindness = "blindness",
      caloric = "insulation",
      deafness = "deafness",
      deathsight = "deathsight",
			fangbarrier = "fangbarrier",
      frost = "temperance",
      insomnia = "insomnia",
      kola = "kola",
      levitation = "levitating",
      mass = "density",
      parrying = "parrying",
      rebounding = "rebounding",
      speed = "speed",
      shield = "shield",
      thirdeye = "thirdeye",
      venom = "poisonresist",
   },

		alchemist = {
			astronomy = "astronomy",
			mercury = "mercury",
			sulphur = "sulphur",
			tin = "tin",
      compoundmask = "compoundmask",
		},
	 
		apostate = {
			deathaura = "deathaura",
			demonarmour = "demonarmour",
			lifevision = "lifevision",
			putrefaction = "putrefaction",
			soulcage = "soulcage",	 
			truestare = "truestare",
			vengeance = "vengeance",
      shroud = "shroud",		
	 },
	   
   bard = {
      aria = "aria",
      lay = "lay",
      songbird = "songbird",
      tune = "blade tune",
			heartsfury = "heartsfury",
      acrobatics = "acrobatics on",
      harrying = "dance harrying",
   },

	blademaster = {
		consciousness = "consciousness",
		shinclarity = "shinclarity",
		shinbinding = "shinbinding",
		shintrance = "shintrance",
		retaliation = "retaliation",
    toughness = "toughness",
    mindnet = "mindnet",
    weathering = "weathering",

	},
	
	 depthswalker = {
			blur = "blur",
			bodyaugment = "bodyaugment",
			disperse = "disperse",
			durability = "durability",
			precision = "precision",
			shadowveil = "shadowveil",
      antiforce = "antiforce",
	 },
	 
	 infernal = {
			deathaura = "deathaura",
			lifevision = "lifevision",
			putrefaction = "putrefaction",
			soulcage = "soulcage",	 
			vengeance = "vengeance",	
      blademastery = "blademastery",	 
	 },
	 
	 jester = {
			slippery = "slippery",
			balancing = "balancing",
			acrobatics = "acrobatics",	 
	 },
	 
   endgame = {
      cohesion = "cohesion",
      dragonbreath = "dragonbreath",
      dragonarmour = "dragonarmour",
			tempest = "tempest",
			susurrating = "susurrating",
      fireshroud = "fireshroud",
      extrusion = "extrusion",
      strata = "strata",      
   },
	 
   magi = {
      chargeshield = "chargeshield",
      diamondskin = "diamondskin",
      stoneskin = "stoneskin",
      simultaneity = "simultaneity",
   },
   
   monk = {
      boostedregeneration = "boosting",
      kaitrance = "kaitrance",
      hyperfocus = "hyperfocus",
      regeneration = "regeneration",
      shikudoform = "shikudoform",
      splitmind = "splitmind",
			mindnet = "mindnet",
      bodyblock = "bodyblock",
      evadeblock = "evadeblock",
      pinchblock = "pinchblock",
      hypersense = "hypersense",
      mindcloak = "mindcloak",
      toughness = "toughness",
      kaiboost = "kaiboost",
   },
   
   occultist = {
	 		arctar = "arctar",
      devilmark = "devilmark",
      tentacles = "tentacles",
			distortedaura = "distortedaura",
   },

    pariah = {
      shieldlogograph = "shieldlogograph",
      accursedresolve = "accursedresolve",
      leechlogograph = "leechlogograph",
  },

	priest = {
			willpowerblessing = "willpowerblessing",
			enduranceblessing = "enduranceblessing",
			thermalshield = "thermalshield",
			frostshield = "frostshield",
			earthshield = "earthshield",
	},

	 psion = {
	 		guidedstrike = "guidedstrike",
	 		psitranscend = "psitranscend",
	 		secondskin = "secondskin",
			rupturesight = "rupturesight",
      psicomprehend = "psicomprehend",
      psibreakthrough = "psibreakthrough",
	},	

	 sentinel = {
	 		affinity = "affinity",
			barkskin = "barkskin",
			firstaid = "firstaid",
			stealth = "stealth",
	 },	
   
   serpent = {
      ghost = "ghost",
      lipreading = "lipreading",
      pacing = "pacing",
      scales = "scales",
      shroud = "shroud",
      weaving = "weaving",
   },
   
   shaman = {
      swiftcurse = "swiftcurse",
   },
   
   sylvan = {
      spinningstaff = "spinningstaff",
      barkskin = "barkskin",
      viridian = "viridian",
   },
   
    unnamable = {
      bulk = "bulk",
      mouths = "mouths",
      joints = "joints",
      eyes = "eyes",
      unnamablepresence = "unnamablepresence",
      blademastery = "blademastery",
    },
   
   shared = {
      constitution = "constitution",
      consciousness = "consciousness",
			curseward = "curseward",
      gripping = "gripping",
      lifevision = "lifevision",
      nightsight = "nightsight",
      resistance = "resistance",
      weathering = "weathering",
      vitality = "vitality",
			hypersight = "hypersight",
			alertness = "alertness",
			vigilance = "vigilance",
			skywatch = "skywatch",
			treewatch = "treewatch",
			groundwatch = "groundwatch",			
			coldresist = "coldresist",
			electricresist = "electricresist",
			fireresist = "fireresist",
			magicresist = "magicresist",			
      selfishness = "selfishness",
      grookbubble = "grookbubble",
      heldbreath = "heldbreath",
      shroud = "shroud",
      lifevision = "lifevision",
      deflect = "deflect",
      blademastery = "blademastery",
      
   },
   tattoos = {
      boartattoo = "boartattoo",
      cloak = "cloak",
      megalithtattoo = "megalithtattoo",
      mindseye = "mindseye",
      moontattoo = "moontattoo",
      mosstattoo = "mosstattoo",
   }
	}
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Dragon Breath</name>
											<packageName></packageName>
											<script>function getDragonBreath()
	local colour = string.match(gmcp.Char.Status.class, "%w+")
	local types = {
		Black = "acid", Blue = "ice", Golden = "psi", Green = "venom", Red = "dragonfire", Silver = "lightning",
	}
	return types[colour]
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Curing Stuff</name>
										<packageName></packageName>
										<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>Aff gains/losses</name>
											<packageName></packageName>
											<script>function confirmedUnknownAff()
	if line:match("You feel your allergy to the sun going into temporary remission.")
		or line:match("Your insomnia has cleared up.")
		or line:match("Your insulating unguent dissolves as it ameliorates the extreme cold.")
		or line:match("You gasp as your fine-tuned reflexes disappear into a haze of confusion.") 
		or line:match("Your hearing is suddenly restored.") then
	else
		if ataxia.afflictions.unknown == nil then ataxia.afflictions.unknown = 0 end
		ataxia.afflictions.unknown = ataxia.afflictions.unknown + 1
		if ataxiaBasher and ataxiaBasher.enabled and ataxia.afflictions.unknown &gt;= 2 and not sent_diagnose then
			send("queue addclear free diagnose", false)
			sent_diagnose = tempTimer(3, [[sent_diagnose = nil]])
		end
	end
end

function gotUnknownAff()
	if ataxia.vitals.hp == ataxia.vitals.maxhp and ataxia.vitals.mp == ataxia.vitals.maxmp then
		send("curing predict recklessness")
	elseif not ataxiaTemp.lokiCheck then
		tempLineTrigger(1, 1, [[confirmedUnknownAff()]])
	end
end

function affed(what)
	if ataxia.afflictions[what:lower()] then
		return true
	else
		return false
	end
end

function setStackAff(aff, num)
	local affs = {"horror", "pyre", "unweavingspirit", "unweavingmind", "unweavingbody", "temperedsanguine", "temperedcholeric", 
    "temperedmelancholic", "temperedphlegmatic", "pressure", "crackedribs", "torntendons", 
    "skullfractures", "wristfractures", "burning, burns,","crescendo",}
	local tow = ""
	for _, x in pairs(affs) do
		if aff:find(x) then
			tow = x
		end
	end
	
	if num then
		ataxia.afflictions[tow] = 0
	elseif tonumber( string.sub(aff, -2, -2) ) then
		ataxia.afflictions[tow] = tonumber(string.sub(aff, -2, -2))
	else
		ataxia.afflictions[tow] = 1
	end
end

function afflictionList()
	local affs = gmcp.Char.Afflictions.List
  local ignore = {"blindness", "deafness", "insomnia","deathsickness",}
 
	
 
	ataxia.afflictions = {}
	sent_diagnose = nil

	for _, affl in pairs(affs) do
		local aff = affl.name
		if not table.contains(ignore, aff:lower()) then
			if tonumber( string.sub(aff:lower(), -2, -2) ) then
				setStackAff(aff:lower())
			else
				ataxia.afflictions[aff:lower()] = true
				raiseEvent("aff gained", aff:lower())
			end
		end
  Algedonic.AffCount = Algedonic.Count_My_Affs() 
	end
  
  if ataxiaBasher.enabled then
    basher_needAction = true
  end
  if zgui then zgui.showAffs() end
end

function gotAff()
	local ignore = {"blindness", "deafness", "insomnia"}
	local aff = gmcp.Char.Afflictions.Add.name
	if not table.contains(ignore, aff) then
  	if tonumber( string.sub(aff, -2, -2) ) then
			setStackAff(aff)
		else
			ataxia.afflictions[aff:lower()] = true
      local parAff = "incoming_"..aff
      ataxia.afflictions[parAff] = nil
		end
	end

	if aff == "guilt" then
		send("curing focus off")
	elseif aff == "amnesia" then
		send("touch friends")
  elseif aff == "paralysis" then
   send("endure")
  elseif aff == "haemophilia" then
    sentinel_swaphaemophilia()
 elseif aff == "prone" and not ataxia.afflictions.aeon then
  --Smoke for Rebounding - Serverside doesn't put it up
    send("smoke malachite") 
  ---AUTO TUMBLER
  --If we have the below afflictions then tumble
    if ataxia.afflictions.damagedrightleg and ataxia.afflictions.damagedleftleg and ataxiaNDB_getClass(target) ~= "Blademaster" then
    getdirectionn()
    send("tumble " ..random_direction)
    elseif ataxia.afflictions.damagedrightleg and ataxia.afflictions.damagedleftleg and ataxiaNDB_getClass(target) == "Blademaster" then
    expandAlias("hh")
    elseif ataxia.afflictions.brokenrightarm and ataxia.afflictions.brokenleftarm then
    send("restore")    
    end
  --Sentinel Restore to Prevent Rift Lock
  --elseif aff == "brokenrightarm" or aff == "brokenleftarm" and ataxia.afflictions.prone and ataxiaNDB_getClass(target) == "Sentinel" then
    --send("restore")
  -- Sentinel Touch Shield to Prevent Rift Lock
  
  
  --Druid Nonsense
  elseif aff == "damagedrightarm" or aff == "damagedleftarm" and not ataxia.afflictions.prone and ataxiaNDB_getClass(target) == "Druid" then
    send("cq all;goto 11090")
    ataxia_boxEcho("EMBRACE DANGER NEED TO RUN", "goldenrod")
    ataxia_boxEcho("EMBRACE DANGER NEED TO RUN", "goldenrod")

  elseif aff == "entangled" and ataxiaNDB_getClass(target) == "Druid" then
    getdirectionn()
    send("apply mass to arms")
    send("curing queue insert 1 restoration to legs")
    ataxia_boxEcho("WE ARE PREAPPLYING", "yellow")
    send("tumble " ..random_direction)
   elseif aff == "damagedrightleg" or aff == "damagedleftleg" and ataxia.afflictions.prone and ataxiaNDB_getClass(target) == "Druid" then
    getdirectionn()
    send("tumble " ..random_direction)
    
  -- This is to prepare for DISEMBOWEL from /BM
	elseif aff == "internalbleeding" then
    tempTimer(2, [[send("curing queue insert 1 restoration to legs"), ataxia_boxEcho("WE ARE PREAPPLYING", "yellow")]])
    ataxia_boxEcho("PREPARE THINE ANUS FOR ENTRY", "a_darkred")
  -- Handle Blackout
	elseif aff == "blackout" then
  
		if ataxiaBasher.enabled and ataxiaBasher.treeblackout then
			send("touch tree")
		elseif type(target) == "string" and ataxiaNDB_getClass(target) == ("Runewarden" or "Infernal" or "Paladin") then
			tempTimer(2.5, [[send("curing predict impaled",false)]])
		end
	elseif aff == "prone" then
		if ataxiaBasher.enabled then
			send("queue prepend eqbal stand")
		end
	elseif aff == "corruption" then
		send("curing clotat 9999",false)
		ataxia_boxEcho("CORRUPTION ON US - MANUAL CLOT", "a_darkred")
	elseif (aff == "entangled" or aff == "webbed") then
    if ataxia_isClass("bard") then
		  send("queue addclear class recite haidar",false)
    elseif ataxia_isClass("pariah") then
      send("accursed reconstitute", false)
    end
  -- Handle Retardation or Aeon
  elseif aff == "aeon" and not ataxia.retardation then
    send("curing prioaff aeon")
    partyrelay = false
    retardationOn()
  elseif aff == "aeon" and ataxia.afflictions.asthma then
    send("curing prioaff asthma")
    partyrelay = false
  elseif aff == "impatience" and ataxiaNDB_getClass(target) == "Serpent" then
    myaeon = true
	end
  --Are we close to being locked where we need to hit our active ability?
	ataxia_lockBreak()
	raiseEvent("aff gained", aff)
  if zgui then zgui.showAffs() end

--If facing a specific class, call out priorities to ensure we are curing correctly
Algedonic.Prioritize()
-- Calulate Stacks (Kelp/Goldenseal/Bloodroot/etc)
Algedonic.Stack_My_Affs(true, aff)
end

function lostAff()
	local ignore = {"blindness", "deafness", "insomnia"}
	local aff = gmcp.Char.Afflictions.Remove

	if not table.contains(ignore, aff) then
  	if tonumber( string.sub(aff[1]:lower(), -2, -2) ) and tonumber( string.sub(aff[1]:lower(), -2, -2) ) == 1 then
			setStackAff(aff[1]:lower(), true)
		else
			ataxia.afflictions[aff[1]:lower()] = nil
		end
	end

	if aff[1] == "guilt" then
		send("curing focus on")
  elseif aff[1] == "voyria" or aff[1] == "latency" then
    stoplatency = false
	elseif aff[1] == "blackout" then
		if not ataxia.vitals.eq then
			send("curing predict disrupted",false)
		end
		send("allies",false)
	elseif aff[1] == "corruption" then
		send("curing clotat 180",false)
		ataxia_boxEcho("CORRUPTION IS GONE - SAFE", "white")
  elseif aff[1] == "brokenrightarm" or aff[1] == "brokenleftarm" then
    preventriftlock = false
  elseif aff[1] == "paralysis" then
    send("endure stop")
  elseif aff[1] == "haemophilia" or aff[1] == "flushings" then
    stopscourge = false
  elseif aff[1] == "aeon" and ataxia.retardation then
    retardationOff()
    myaeon = false
    partyrelay = true
  elseif aff[1] == "impatience" then
     myaeon = false
  elseif aff[1] == "impatience" and ataxia.prioritySwaps.impSnap and ataxia.prioritySwaps.impSnap.active then
	   ataxia_restorePrio("impatience")
     myaeon = false
  elseif aff[1] == "unweavingmind" then
    ataxia.afflictions.unweavingmind = 0
  elseif aff[1] == "unweavingbody" then
    ataxia.afflictions.unweavingbody = 0
  elseif aff[1] == "unweavingspirit" then
    ataxia.afflictions.unweavingspirit = 0
  elseif aff[1] == "crescendo" then
    ataxia.afflictions.crescendo = 0
  end
	
	raiseEvent("aff cured", aff[1])
  if zgui then zgui.showAffs() end
Algedonic.Prioritize()
Algedonic.Stack_My_Affs(false, aff)
end

registerAnonymousEventHandler("gmcp.Char.Afflictions.List", "afflictionList")
registerAnonymousEventHandler("gmcp.Char.Afflictions.Add", "gotAff")
registerAnonymousEventHandler("gmcp.Char.Afflictions.Remove", "lostAff")</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Prompt Affs</name>
											<packageName></packageName>
											<script>function ataxia_promptAffs()
	if not affs_to_colour then populate_aff_colours() end
	local aff_str = ""

	if (rTabSize(ataxia.afflictions) == 0 or ataxia.afflictions == {}) and not ataxia.afflictions.unknown and ataxia.vitals.bleed &lt; 100 then
		return ""
	else
		aff_str = "&lt;tomato&gt; ["
		if ataxia.vitals.bleed &gt;= 100 then
			aff_str = aff_str.." &lt;a_red&gt;bld(&lt;NavajoWhite&gt;"..ataxia.vitals.bleed.."&lt;a_red&gt;)"
		end
		if ataxia.afflictions.unknown then
			aff_str = aff_str.." "
			for i=1, ataxia.afflictions.unknown do
				aff_str = aff_str.."&lt;brown&gt;?"
			end
		end
		for aff,boo in pairs(ataxia.afflictions) do
			if type(boo) ~= "number" then
				local foundAff = false
				for conv, tab in pairs(affs_to_colour) do
					if aff == conv then
						aff_str = aff_str.." &lt;"..tab[1].."&gt;"..tab[2]
						foundAff = true
						break
					end
				end
				if not foundAff then aff_str = aff_str.." &lt;NavajoWhite&gt;"..aff end
			elseif tonumber(boo) ~= 0 then
				if aff == "temperedsanguine" then
					aff_str = aff_str.." &lt;a_red&gt;TS(&lt;white&gt;"..boo.."&lt;a_red&gt;)"
				elseif aff == "temperedphlegmatic" then
					aff_str = aff_str.." &lt;NavajoWhite&gt;TP(&lt;white&gt;"..boo.."&lt;NavajoWhite&gt;)"
				elseif aff == "temperedcholeric" then
					aff_str = aff_str.." &lt;DarkGreen&gt;TC(&lt;white&gt;"..boo.."&lt;DarkGreen&gt;)"
				elseif aff == "temperedmelancholic" then
					aff_str = aff_str.." &lt;DodgerBlue&gt;TM(&lt;white&gt;"..boo.."&lt;DodgerBlue&gt;)"
				elseif aff == "skullfractures" then
					aff_str = aff_str.." &lt;a_darkred&gt;Sf(&lt;white&gt;"..boo.."&lt;a_darkred&gt;)"
				elseif aff == "torntendons" then
					aff_str = aff_str.." &lt;a_darkred&gt;Tt(&lt;white&gt;"..boo.."&lt;a_darkred&gt;)"
				elseif aff == "crackedribs" then
					aff_str = aff_str.." &lt;a_red&gt;Cr(&lt;white&gt;"..boo.."&lt;a_darkred&gt;)"
        	elseif aff == "crescendo" then
					aff_str = aff_str.." &lt;a_red&gt;Cres(&lt;white&gt;"..boo.."&lt;a_darkred&gt;)"
				elseif aff == "wristfractures" then
					aff_str = aff_str.." &lt;a_red&gt;Wf(&lt;white&gt;"..boo.."&lt;a_darkred&gt;)"
				elseif aff == "pressure" then
					aff_str = aff_str.." &lt;purple&gt;Pr(&lt;white&gt;"..boo.."&lt;purple&gt;)"
				elseif aff == "burning" then
					aff_str = aff_str.." &lt;orange&gt;burns(&lt;white&gt;"..boo.."&lt;orange&gt;)"
				elseif aff == "unweavingmind" then
					aff_str = aff_str.." &lt;a_yellow&gt;UWM(&lt;white&gt;"..boo.."&lt;a_yellow&gt;)"
				elseif aff == "unweavingbody" then
					aff_str = aff_str.." &lt;sienna&gt;UWB(&lt;white&gt;"..boo.."&lt;sienna&gt;)"
				elseif aff == "unweavingspirit" then
					aff_str = aff_str.." &lt;NavajoWhite&gt;UWS(&lt;white&gt;"..boo.."&lt;NavajoWhite&gt;)"	
        elseif aff == "horror" then
          aff_str = aff_str.." &lt;magenta&gt;HORROR(&lt;white&gt;"..boo.."&lt;magenta&gt;)"
        elseif aff == "pyre" then
          aff_str = aff_str.." &lt;magenta&gt;PYRE(&lt;white&gt;"..boo.."&lt;magenta&gt;)"
				end
			end
		end
    aff_str = aff_str .. ataxia_promptLocks()
		aff_str = aff_str .. " &lt;tomato&gt;]"		
	end
	return aff_str
end</script>
											<eventHandlerList />
										</Script>
										<ScriptGroup isActive="yes" isFolder="yes">
											<name>Priority-related</name>
											<packageName></packageName>
											<script></script>
											<eventHandlerList />
											<Script isActive="yes" isFolder="no">
												<name>Default Curing Prios</name>
												<packageName></packageName>
												<script>function ataxia_resetOnLogin()
	local defaultPrios = ataxia_defaultCuringPrios()
	ataxia.curingprio = ataxia.curingprio or {}
	
--	for aff, val in pairs(defaultPrios) do
--		if ataxia.curingprio[aff] == nil or ataxia.curingprio[aff] ~= val then
--send("curing priority "..aff.." "..val)		end
--	end

send("curing priority parasite 7;curing priority hypersomnia 9;curing priority flushings 5;curing priority generosity 16;curing priority anorexia 4")
tempTimer(1.5, [[ send("curing priority transfixation 6;curing priority whisperingmadness 11;curing priority epilepsy 18;curing priority confusion 20;curing priority damagedleftleg 8") ]])
tempTimer(2.5, [[ send("curing priority vertigo 16;curing priority temperedmelancholic 14;curing priority recklessness 21;curing priority weariness 7;curing priority loneliness 16") ]])
tempTimer(3.5, [[ send("curing priority pyramides 6;curing priority pressure 17;curing priority impatience 6;curing priority paralysis 4;curing priority pacified 14") ]])
tempTimer(4.5, [[ send("curing priority serioustrauma 17;curing priority brokenrightleg 7;curing priority webbed 6;curing priority mangledrightarm 14;curing priority stuttering 19") ]])
tempTimer(5.5, [[ send("curing priority crackedribs 9;curing priority spiritburn 11;curing priority shadowmadness 6;curing priority unweavingbody 7;curing priority retribution 6") ]])
tempTimer(6.5, [[ send("curing priority guilt 8;curing priority haemophilia 11;curing priority horror 8;curing priority fear 20;curing priority sensitivity 7") ]])
tempTimer(7.5, [[ send("curing priority temperedsanguine 14;curing priority disrupted 9;curing priority prone 9;curing priority dissonance 14;curing priority timeloop 5") ]])
tempTimer(8.5, [[ send("curing priority voyria 9;curing priority sleeping 2;curing priority impaled 6;curing priority daeggerimpale 6;curing priority entangled 6") ]])
tempTimer(9.5, [[ send("curing priority addiction 11;curing priority frozen 15;curing priority bound 6;curing priority unweavingmind 8;curing priority slashedthroat 19") ]])
tempTimer(10.5, [[ send("curing priority wristfractures 11;curing priority concussion 12;curing priority sandfever 4;curing priority scalded 16;curing priority skullfractures 8") ]])
tempTimer(11.5, [[ send("curing priority tension 16;curing priority disloyalty 15;curing priority deadening 14;curing priority clumsiness 14;curing priority darkshade 9") ]])
tempTimer(12.5, [[ send("curing priority manaleech 13;curing priority hellsight 12;curing priority depression 6;curing priority lovers 14;curing priority slickness 2") ]])
tempTimer(13.5, [[ send("curing priority itching 5;curing priority peace 16;curing priority stupidity 18;curing priority mangledleftarm 14;curing priority healthleech 14") ]])
tempTimer(14.5, [[ send("curing priority aeon 1;curing priority agoraphobia 16;curing priority selarnia 20;curing priority laceratedthroat 19;curing priority burning 19") ]])
tempTimer(15.5, [[ send("curing priority deafness 26;curing priority dementia 17;curing priority paranoia 17;curing priority tenderskin 11;curing priority scytherus 3") ]])
tempTimer(16.5, [[ send("curing priority mangledleftleg 8;curing priority lethargy 11;curing priority shyness 23;curing priority shivering 15;curing priority damagedrightarm 13") ]])
tempTimer(17.5, [[ send("curing priority brokenleftarm 10;curing priority torntendons 10;curing priority damagedhead 12;curing priority damagedleftarm 11;curing priority brokenrightarm 10") ]])
tempTimer(18.5, [[ send("curing priority mangledhead 9;curing priority mangledrightleg 8;curing priority damagedrightleg 8;curing priority crushedthroat 5;curing priority rebbies 7") ]])
tempTimer(20.5, [[ send("curing priority temperedphlegmatic 14;curing priority hypothermia 1;curing priority masochism 21;curing priority blindness 26;curing priority mycalium 5") ]])
tempTimer(21.5, [[ send("curing priority mildtrauma 17;curing priority hypochondria 5;curing priority nausea 11;curing priority hallucinations 9;curing priority dizziness 23") ]])
tempTimer(22.5, [[ send("curing priority heartseed 3;curing priority temperedcholeric 14;curing priority claustrophobia 16;curing priority asthma 7;curing priority justice 16") ]])
tempTimer(23.5, [[ send("curing priority brokenleftleg 7") ]])
end

function ataxia_resetPrios()
	local defaultPrios = ataxia_defaultCuringPrios()
  
send("curing priority parasite 7;curing priority hypersomnia 9;curing priority flushings 5;curing priority generosity 16;curing priority anorexia 4")
tempTimer(1.5, [[ send("curing priority transfixation 6;curing priority whisperingmadness 11;curing priority epilepsy 18;curing priority confusion 20;curing priority damagedleftleg 8") ]])
tempTimer(2.5, [[ send("curing priority vertigo 16;curing priority temperedmelancholic 14;curing priority recklessness 21;curing priority weariness 7;curing priority loneliness 16") ]])
tempTimer(3.5, [[ send("curing priority pyramides 6;curing priority pressure 17;curing priority impatience 6;curing priority paralysis 4;curing priority pacified 14") ]])
tempTimer(4.5, [[ send("curing priority serioustrauma 17;curing priority brokenrightleg 7;curing priority webbed 6;curing priority mangledrightarm 14;curing priority stuttering 19") ]])
tempTimer(5.5, [[ send("curing priority crackedribs 9;curing priority spiritburn 11;curing priority shadowmadness 6;curing priority unweavingbody 7;curing priority retribution 6") ]])
tempTimer(6.5, [[ send("curing priority guilt 8;curing priority haemophilia 11;curing priority horror 10;curing priority fear 20;curing priority sensitivity 7") ]])
tempTimer(7.5, [[ send("curing priority temperedsanguine 14;curing priority disrupted 9;curing priority prone 9;curing priority dissonance 14;curing priority timeloop 5") ]])
tempTimer(8.5, [[ send("curing priority voyria 9;curing priority sleeping 2;curing priority impaled 6;curing priority daeggerimpale 6;curing priority entangled 6") ]])
tempTimer(9.5, [[ send("curing priority addiction 11;curing priority frozen 15;curing priority bound 6;curing priority unweavingmind 8;curing priority slashedthroat 19") ]])
tempTimer(10.5, [[ send("curing priority wristfractures 11;curing priority concussion 12;curing priority sandfever 4;curing priority scalded 16;curing priority skullfractures 8") ]])
tempTimer(11.5, [[ send("curing priority tension 16;curing priority disloyalty 15;curing priority deadening 14;curing priority clumsiness 14;curing priority darkshade 9") ]])
tempTimer(12.5, [[ send("curing priority manaleech 13;curing priority hellsight 12;curing priority depression 6;curing priority lovers 14;curing priority slickness 2") ]])
tempTimer(13.5, [[ send("curing priority itching 5;curing priority peace 16;curing priority stupidity 18;curing priority mangledleftarm 14;curing priority healthleech 14") ]])
tempTimer(14.5, [[ send("curing priority aeon 1;curing priority agoraphobia 16;curing priority selarnia 20;curing priority laceratedthroat 19;curing priority burning 19") ]])
tempTimer(15.5, [[ send("curing priority deafness 26;curing priority dementia 17;curing priority paranoia 17;curing priority tenderskin 11;curing priority scytherus 3") ]])
tempTimer(16.5, [[ send("curing priority mangledleftleg 8;curing priority lethargy 11;curing priority shyness 23;curing priority shivering 15;curing priority damagedrightarm 13") ]])
tempTimer(17.5, [[ send("curing priority brokenleftarm 10;curing priority torntendons 10;curing priority damagedhead 12;curing priority damagedleftarm 11;curing priority brokenrightarm 10") ]])
tempTimer(18.5, [[ send("curing priority mangledhead 9;curing priority mangledrightleg 8;curing priority damagedrightleg 8;curing priority crushedthroat 5;curing priority rebbies 7") ]])
tempTimer(20.5, [[ send("curing priority temperedphlegmatic 14;curing priority hypothermia 1;curing priority masochism 21;curing priority blindness 26;curing priority mycalium 5") ]])
tempTimer(21.5, [[ send("curing priority mildtrauma 17;curing priority hypochondria 5;curing priority nausea 11;curing priority hallucinations 9;curing priority dizziness 23") ]])
tempTimer(22.5, [[ send("curing priority heartseed 3;curing priority temperedcholeric 14;curing priority claustrophobia 16;curing priority asthma 7;curing priority justice 16") ]])
tempTimer(23.5, [[ send("curing priority brokenleftleg 7") ]])

--	for aff, val in pairs(defaultPrios) do
--send("curing priority "..aff.." "..val)	end
end

function ataxia_defaultCuringPrios()
  return {
    --Important afflictions here
    ["paralysis"] = 4,
    ["timeloop"] = 5,
    ["shadowmadness"] = 6,
    ["hypochondria"] = 5,
    ["depression"] = 6,
    ["retribution"] = 6,
    ["horror"] = 10,
    ["parasite"] = 7,
    ["scytherus"] = 3,
    ["impatience"] = 6,
    ["asthma"] = 7,
    ["sensitivity"] = 7,
    ["weariness"] = 7,
		["unweavingbody"] = 7,
		["unweavingmind"] = 8,
    ["guilt"] = 8,
    ["darkshade"] = 9,
    ["hypersomnia"] = 9,
    ["hallucinations"] = 9,
    --10 free for focus shifts; I swear I'll add this at some point.
    
    --Pariah specific afflictions
    ["sandfever"] = 4,
    ["mycalium"] = 5,
    ["flushings"] = 5,
    ["pyramides"] = 6,
    ["rebbies"] = 7,
		
    ["nausea"] = 11,
    ["haemophilia"] = 11,
    ["lethargy"] = 11,
    ["addiction"] = 11,
    ["tenderskin"] = 11,
    ["spiritburn"] = 11,
		
    --13 gap for other shifts.
    ["temperedmelancholic"] = 14,
    ["temperedcholeric"] = 14,
    ["temperedsanguine"] = 14,
    ["temperedphlegmatic"] = 14,
    ["lovers"] = 14, 
    ["pacified"] = 14, 
    ["healthleech"] = 14,
    ["clumsiness"] = 14,
    ["dissonance"] = 14,
    ["loneliness"] = 16,
    ["claustrophobia"] = 16,
    ["agoraphobia"] = 16,
    ["vertigo"] = 16,


    ["peace"] = 16, 
    ["justice"] = 16, 
    ["generosity"] = 16,

    ["dementia"] = 17,
    ["paranoia"] = 17,

    ["stupidity"] = 18, --move to 9 if off focus balance
    ["epilepsy"] = 18,
    ["confusion"] = 20, --move to 2 if disrupted, move to 8 if off focus balance
    ["recklessness"] = 21, --move up higher if off focus balance
    ["masochism"] = 21,

    ["dizziness"] = 23, --if off focus balance move this to 14? Seems too high honestly.
    ["shyness"] = 23, --if off focus balance move this to 14?
    
    ["blindness"] = 26,
    ["deafness"] = 26,

    --Salve afflictions
    ["heartseed"] = 3,
    ["hypothermia"] = 1,
    ["anorexia"] = 4,
    ["crushedthroat"] = 5,
    ["itching"] = 5,

    --6 GAP: For resto leg breaks and prone (will fix this too, at some point)

    ["brokenleftleg"] = 7,
    ["brokenrightleg"] = 7,

    ["damagedleftleg"] = 8, --move these up if prone so Sents can't screw me over.
    ["damagedrightleg"] = 8,
    ["mangledleftleg"] = 8,
    ["mangledrightleg"] = 8,

    ["mangledhead"] = 9,

    ["brokenleftarm"] = 10,
    ["brokenrightarm"] = 10,

    ["damagedleftarm"] = 11,

    ["damagedhead"] = 12,
    ["concussion"] = 12,

    ["damagedrightarm"] = 13,

    ["mangledleftarm"] = 14,
    ["mangledrightarm"] = 14,

    ["frozen"] = 15,
    ["shivering"] = 15, --same rank as frozen
    --CALORIC(insulation) at 15 unless it's a damn sentinel, then move up to 2 along with frozen and shivering
    ["scalded"] = 16,
    ["mildtrauma"] = 17,
    ["serioustrauma"] = 17,

    --MASS at 18

    ["burning"] = 19,
    ["stuttering"] = 19,
    ["slashedthroat"] = 19,
    ["laceratedthroat"] = 19,
    ["selarnia"] = 20,

    ---------------------------
    --PIPE
    ---------------------------
    ["aeon"] = 1,
    ["slickness"] = 2, --1 higher than para so that smoke &gt; eat broot if para and slick.
    ["whisperingmadness"] = 11,
    ["hellsight"] = 12,

    ["manaleech"] = 13,
    ["deadening"] = 14,
    ["disloyalty"] = 15,
    ["tension"] = 16,
    ["pressure"] = 17,

    --["rebounding"] = 18, (DEFENCE QUEUE SLOT 18) IMPORTANT TO MOVE THIS DOWN BELOW PRESSURE

    ------------------------
    --HEALTH ELIXIR
    ------------------------
    ["skullfractures"] = 8,
    ["crackedribs"] = 9,
    ["torntendons"] = 10,
    ["wristfractures"] = 11,

    -------------------------
    --WRITHE
    -------------------------
    ["bound"] = 6,
    ["transfixation"] = 6,
    ["webbed"] = 6,
    ["entangled"] = 6,
    ["daeggerimpale"] = 6,
    ["impaled"] = 6,

    -----------------------
    --BAL FREE CURES
    -----------------------
    ["sleeping"] = 2,
    ["voyria"] = 9,
    ["prone"] = 9,
    ["disrupted"] = 9,
    ["fear"] = 20, --low for retardation/aeon curing

  }
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Prio Management</name>
												<packageName></packageName>
												<script>function ataxia_defaultPrioAff(aff)
	local defaultPrios = ataxia_defaultCuringPrios()
	return defaultPrios[aff]
end

function ataxia_setAffPrio(aff, num)
	prioWaitfor = prioWaitfor or {}
	if not prioWaitfor[aff] then
		prioWaitfor[aff] = tempTimer(1, [[ prioWaitfor["]]..aff..[["] = nil ]])
		send("curing priority "..aff.. " "..num,false)
	end
end

function ataxia_restorePrio(aff)
	local defaultPrios = ataxia_defaultCuringPrios()
	ataxia.curingprio = ataxia.curingprio or {}
	
	prioWaitrestore = prioWaitrestore or {}
	
	if ataxia_getPrio(aff) == ataxia_defaultPrioAff(aff) then return end
	if not prioWaitrestore[aff] then
		prioWaitrestore[aff] = tempTimer(1, [[ prioWaitrestore["]]..aff..[["] = nil ]])
		send("curing priority "..aff.." "..defaultPrios[aff])
	end
end

function ataxia_showPrios(num)
	ataxiaEcho("Displaying our current curing priorities:")
	for prio = 1, num do
		for aff, num in pairs(ataxia.curingprio) do
			if num == prio then
				echo("\n")
				fg("green")
				echoLink(" [+]", [[ataxia_raisePrio("]]..aff..[[")]], "Raise "..aff.." to priority of "..(ataxia.curingprio[aff] + 1)..".",true)
				fg("red")
				echoLink(" [-]", [[ataxia_lowerPrio("]]..aff..[[")]], "Lower "..aff.." to priority of "..(ataxia.curingprio[aff] - 1)..".",true)
				cecho("&lt;white&gt;: &lt;DimGrey&gt;(&lt;LightSlateGrey&gt;"..prio.."&lt;DimGrey&gt;) &lt;NavajoWhite&gt;"..aff)
			end
		end	
	end
	send(" ")
end

function ataxia_getPrio(aff)
	if not ataxia.curingprio[aff] then
		return 0
	else
		return ataxia.curingprio[aff]
	end
end

function ataxia_raisePrio(aff, hide)
	local newprio = (ataxia.curingprio[aff] - 1)
	ataxia.curingprio[aff] = newprio
	send("curing priority "..aff.." "..newprio)
	
	if not hide then
		ataxiaEcho("Raised "..aff.." to a priority of "..newprio)
		ataxia_showPrios(newprio)
	end
end

function ataxia_lowerPrio(aff, hide)
	local newprio = (ataxia.curingprio[aff] + 1)
	ataxia.curingprio[aff] = newprio
	send("curing priority "..aff.." "..newprio)
	
	if not hide then
		ataxiaEcho("Lowered "..aff.." to a priority of "..newprio)
		ataxia_showPrios(newprio)
	end
end</script>
												<eventHandlerList />
											</Script>
											<ScriptGroup isActive="yes" isFolder="yes">
												<name>Swaps</name>
												<packageName></packageName>
												<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
												<eventHandlerList />
												<Script isActive="yes" isFolder="no">
													<name>Class Specific</name>
													<packageName></packageName>
													<script>function prioritySwap_psionBleedChange(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end

  if not ataxia.prioritySwaps.psionBleed.active then return end
  if event == "aff gained" then
    if affed("haemophilia") and ataxia.vitals.bleed &gt;= 125 and ataxia_getPrio("haemophilia") &gt; 2 then
      ataxia_setAffPrio("haemophilia", 2)
    end
  end
end

function prioritySwap_psionBleedReturn(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
  if not ataxia.prioritySwaps.psionBleed.active then return end
  if event == "aff cured" then
 		if affliction == "haemophilia" and ataxia_getPrio("haemophilia") ~= ataxia_defaultPrioAff("haemopilia") then
			ataxia_restorePrio("haemophilia")
		end 
  end
end
registerAnonymousEventHandler("aff gained", "prioritySwap_psionBleedChange")
registerAnonymousEventHandler("aff cured", "prioritySwap_psionBleedReturn")


function prioritySwap_magiSalveChange(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
  if not ataxia.prioritySwaps.magi.active then return end
	if event == "aff gained" then
		if affliction == "dehydrated" or (affliction == "burning" and affed("dehydrated")) and ataxia_getPrio("dehydrated") &gt; 1 then
			send("curing priority burning 1", false)
		elseif affliction == "hypothermia" then
			send("curing priority shivering 20;curing priority frozen 20",false)
		end
		
		if affed("frozen") or affed("shivering") and ataxia_getPrio("frozen") ~= 2 then
			send("curing priority frozen 2 shivering 2;curing priority defence insulation 2",false)
		end
	end
end

function prioritySwap_magiSalveReturn(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
  if not ataxia.prioritySwaps.magi.active then return end
	if event == "aff cured" then
		if affliction == "hypothermia" then
      if affed("frozen") or affed("shivering") and ataxia_getPrio("frozen") ~= 2 then
				send("curing priority frozen 2 shivering 2;curing priority defence insulation 2",false)
      else
        if ataxia_getPrio("frozen") ~= ataxia_defaultPrioAff("frozen") then
          ataxia_restorePrio("frozen")
        end
        if ataxia_getPrio("shivering") ~= ataxia_defaultPrioAff("shivering") then
          ataxia_restorePrio("shivering")
          send("curing priority defence insulation 20",false)
        end
      end
    elseif affliction == "dehydrated" then
      if ataxia_getPrio("burning") ~= ataxia_getPrio("burning") then
				ataxia_Echo("Dehydrate cured; removing all burn stacks.")
				if ataxia.afflictions.burning then ataxia.afflictions.burning = 1 end
        ataxia_restorePrio("burning")
      end
    end
	end
end
registerAnonymousEventHandler("aff gained", "prioritySwap_magiSalveChange")
registerAnonymousEventHandler("aff cured", "prioritySwap_magiSalveReturn")



--[ Scald stuff ]--
-------------------
function prioritySwap_scaldTimeflux(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if event == "aff gained" and affliction == "timeflux" then
		if ataxia_getPrio("scalded") &lt; 26 and affed("timeflux") then
			send("curing priority scalded 26")
		end
	end
end

function prioritySwap_restoreScald(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if event == "aff cured" and affliction == "timeflux" then
		if ataxia_getPrio("scalded") ~= ataxia_defaultPrioAff("scalded") then
			ataxia_restorePrio("scalded")
		end
	end
end
registerAnonymousEventHandler("aff gained", "prioritySwap_scaldTimeflux")
registerAnonymousEventHandler("aff cured", "prioritySwap_restoreScald")</script>
													<eventHandlerList />
												</Script>
												<Script isActive="yes" isFolder="no">
													<name>Priority Management</name>
													<packageName></packageName>
													<script>function ataxia_checkMissingSwaps()
  if not ataxia.prioritySwaps.impSnap then
    ataxia.prioritySwaps.impSnap = {active = true, desc = "Prioritise impatience when snapped by a Serpent."}
  end

end

function ataxia_resetSwaps()
	ataxia.prioritySwaps = {
		scyPara = {active = false, desc = "Raise scytherus prio if we have paralysis."},
		conDis = {active = false, desc = "Raise confusion prio if we're disrupted."},
		astImp = {active = true, desc = "Impatience prio swap for alchemist and serpents."},
		brSlick = {active = true, desc = "Raise slickness prio if kelp stacked."},
		hypoImp = {active = true, desc = "Prio hypochondria over impatience if stacked."},
		dShade = {active = true, desc = "Manage darkshade when it's about to complete."},
		ravaged = {active = false, desc = "Automatically prio mana sipping while ravagedmind is active."},
		magi = {active = false, desc = "Automatic handling for burns and frozen status."},
    psionBleed = {active = false, desc = "Elevate haemophilia once bleed is stacked up."},
    impSnap = {active = true, desc = "Prioritise impatience when snapped by a Serpent."},
    parshield = {active = false, desc = "Temporarily ignore paralysis when shielding."},
    WATER = {active = false, desc = "Don't get latched."},
	}
	ataxia_Echo("Priority management has been set to default. Check aconfig prios for details.")
end

function ataxia_displaySwaps()
	if not ataxia.prioritySwaps then
		ataxia_resetSwaps()
		return
  else
    ataxia_checkMissingSwaps()
	end
	ataxia_Echo("Priority swaps and their details.")
	echo("\n")
	for prio, info in pairs(ataxia.prioritySwaps) do
		if not info.active then
			fg("red")
		else
			fg("green")
		end

		echoLink(prio, [[ ataxia_toggleSwap("]]..prio..[[")]], "Toggle priority swapping for "..prio..".", true)
		cecho(string.rep(" ", 10-string.len(prio)).."&lt;NavajoWhite&gt; "..info.desc.."\n")
	end
	send(" ")
end

function ataxia_toggleSwap(prio)
	if not ataxia.prioritySwaps then
		ataxia_resetSwaps()
		return
	end
	if not ataxia.prioritySwaps[prio].active then
		ataxia.prioritySwaps[prio].active = true
		ataxia_Echo("Priority enabled for "..prio..".")
	else
		ataxia_Echo("Priority disabled for "..prio..".")
		ataxia.prioritySwaps[prio].active = false
	end
	ataxia_saveSettings(false)
end</script>
													<eventHandlerList />
												</Script>
												<Script isActive="yes" isFolder="no">
													<name>Priority Swaps</name>
													<packageName></packageName>
													<script>--scyPara functions
function ataxia_swapScyPara(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.scyPara.active then return end
  if event == "aff gained" then
		if affliction == "scytherus" and affed("paralysis") and ataxia_getPrio("scytherus") ~= 2 then
			ataxia_setAffPrio("scytherus", 2)
		end
  end
end

function ataxia_restoreScyPara(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.scyPara.active then return end
	if event == "aff cured" then
		if affliction == "scytherus" and ataxia_getPrio("scytherus") ~= ataxia_defaultPrioAff("scytherus") then
			ataxia_restorePrio("scytherus")
		end
	end
end
registerAnonymousEventHandler("aff gained", "ataxia_swapScyPara")
registerAnonymousEventHandler("aff cured", "ataxia_restoreScyPara")

--conDis functions
function ataxia_swapConDis(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.conDis.active then return end
	if event == "aff gained" then
		if affed("confusion") and affed("disrupted") and affed("impatience") and not affed("whisperingmadness") and ataxia_getPrio("confusion") ~= 2 then
			ataxia_setAffPrio("confusion", 2)
		end
	end
end

function sentinel_swaphaemophilia(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if event == "aff gained" then
		if target == "Andraste" and affed("haemophilia") then
			ataxia_setAffPrio("haemophilia", 6)
		end
	end
end

function ataxia_restoreConDis(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.conDis.active then return end
	if event == "aff cured" then
		if affliction == "confusion" and ataxia_getPrio("confusion") ~= ataxia_defaultPrioAff("confusion") then
			ataxia_restorePrio("confusion")
		end
	end
end
registerAnonymousEventHandler("aff gained", "ataxia_swapConDis")
registerAnonymousEventHandler("aff cured", "ataxia_restoreConDis")

--astImp functions
function ataxia_swapAstImp(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.astImp.active then return end
	if not ataxiaNDB_Exists(target) then return end
	if event == "aff gained" then
		if affed("paralysis") and affed("asthma") and (ataxiaNDB_getClass(target) == "Alchemist" or ataxiaNDB_getClass(target) == "Serpent") and ataxia_getPrio("impatience") ~= 1 then
			ataxia_setAffPrio("impatience", 1)
		end
	end
end

function ataxia_swapWATER(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.WATER.active then return end
	if not ataxiaNDB_Exists(target) then return end
	if event == "aff gained" then
		if affed("nausea") and (affed("asthma") or affed("weariness")) and (ataxiaNDB_getClass(target) == "Blademaster") then
			ataxia_setAffPrio("nausea", 1)
		end
	end
end
		
function ataxia_restoreAstImp(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.astImp.active then return end
	if not ataxiaNDB_Exists(target) then return end
	if event == "aff cured" then
		if (ataxia_defaultPrioAff("impatience") ~= ataxia_getPrio("impatience")) and not (affed("paralysis") and affed("asthma")) then
			ataxia_restorePrio("impatience")
		end
	end
end
registerAnonymousEventHandler("aff gained", "ataxia_swapAstImp")
registerAnonymousEventHandler("aff cured", "ataxia_restoreAstImp")

--brSlick functions
function ataxia_swapBrSlick(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.brSlick.active then return end
	if event == "aff gained" then
		if (affed("sensitivity") or affed("clumsiness") or affed("weariness") or affed("hypochondria")) and affed("asthma") and affed("slickness") and not affed("anorexia") and ataxia_getPrio("slickness") ~= 1 then 
			ataxia_setAffPrio("slickness", 1)
		end
	end
end

function ataxia_restoreBrSlick(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.brSlick.active then return end
  if event == "aff cured" then
    if (ataxia_defaultPrioAff("slickness") ~= ataxia_getPrio("slickness")) and not affed("asthma") and not (affed("sensitivity") or affed("clumsiness") or affed("weariness") or affed("hypochondria")) then
      ataxia_restorePrio("slickness")
    end
  end
end 
registerAnonymousEventHandler("aff gained", "ataxia_swapBrSlick")
registerAnonymousEventHandler("aff cured", "ataxia_restoreBrSlick")

--hypoImp functions
function ataxia_swapHypoImp(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.hypoImp.active then return end
  if event == "aff gained" then
    if (affed("lethargy") or affed("nausea") or affed("addiction")) and affed("hypochondria") and ataxia_getPrio("hypochondria") ~= 1 then
			ataxia_setAffPrio("impatience", 4)
			ataxia_setAffPrio("hypochondria", 1)
    end
  end
end

function ataxia_restoreHypoImp(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.hypoImp.active then return end
  if event == "aff cured" then
    if affliction == "hypochondria" then
			ataxia_restorePrio("hypochondria")
			ataxia_restorePrio("impatience")
		end
  end
end
registerAnonymousEventHandler("aff gained", "ataxia_swapHypoImp")
registerAnonymousEventHandler("aff cured", "ataxia_restoreHypoImp")

--Darkshade functions
function ataxia_swapDarkshade(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.dShade.active then return end
  if event == "aff gained" and affliction == "darkshade" then
    if ataxia.lightwall then
			if ataxia_getPrio("darkshade") &gt; 3 then
				ataxia_setAffPrio("darkshade", 3 )
			end
			ataxia_darkshadeTimer(true)
    else
      ataxia_darkshadeTimer(false)
    end
  end
end

function ataxia_restoreDarkshade(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.dShade.active then return end
  if event == "aff cured" then
    if affliction == "darkshade" then
			if ataxia_getPrio("darkshade") ~= ataxia_defaultPrioAff("darkshade") then
      	ataxia_restorePrio("darkshade")
			end
		end
		if ataxiaTemp.darkshadeTimer then killTimer(tostring(ataxiaTemp.darkshadeTimer)) end
		ataxiaTemp.darkshadeTimer = nil
  end
end
registerAnonymousEventHandler("aff gained", "ataxia_swapDarkshade")
registerAnonymousEventHandler("aff cured", "ataxia_restoreDarkshade")


function ataxia_darkshadeTimer(set)
  if ataxiaTemp.darkshadeTimer then killTimer(tostring(ataxiaTemp.darkshadeTimer)) end
  if ataxia.lightwall then
    ataxiaTemp.darkshadeTimer = tempTimer(15, [[ataxiaTemp.darkshadeTimer = nil; send("curing prioaff darkshade")]])

  else
    ataxiaTemp.darkshadeTimer = tempTimer(50, [[ataxiaTemp.darkshadeTimer = nil; send("curing prioaff darkshade")]])
  end
end

function ataxia_ravagedMindSwap(event, affliction)
  if not ataxia.prioritySwaps then ataxia_resetSwaps() end
	if not ataxia.prioritySwaps.ravaged or affliction ~= "mindravaged" then return end
	if event == "aff gained" and ataxia.settings.priohealth then
		send("curing priority mana",false)
	elseif event == "aff cured" then
		send("curing priority health",false)
	end
end
registerAnonymousEventHandler("aff gained", "ataxia_ravagedMindSwap")
registerAnonymousEventHandler("aff cured", "ataxia_ravagedMindSwap")
</script>
													<eventHandlerList />
												</Script>
												<Script isActive="yes" isFolder="no">
													<name>Heartseed Management</name>
													<packageName></packageName>
													<script>--Borrowed from wundersys, and cleaned up to be more readible.
--Couldn't be bothered figuring it out, myself.
ataxiaTemp.heartseedMode = ataxiaTemp.heartseedMode or nil
local fakeApply = fakeApply or false

--For handling automatic fake applies. Probably more reliable than manualling it for most people.
function ataxia_heartseedMendCheck(event, aff)
	local affl = {"brokenrightleg", "brokenleftleg", "brokenrightarm", "brokenleftarm"}
	if event == "aff cured" and ataxiaTemp.heartseedMode then
		if table.contains(affl, aff) then
			fakeApply = true
			if ataxiaTables.limbTimers.fakeApplyTimer then killTimer(ataxiaTables.limbTimers.fakeApplyTimer); ataxiaTables.limbTimers.fakeApplyTimer = nil end
			ataxiaTables.limbTimers.fakeApplyTimer = tempTimer(1.9, [[fakeApply = false; ataxiaTables.limbTimers.fakeApplyTimer = nil]])
		end
	end
end

--Will apply fake, in an attempt to bait the Sylvan to heartseed.			
function ataxia_heartseedFake()
	if ataxiaTemp.heartseedMode and fakeApply then
		if not affed("heartseed") then
			if affed("damagedrightleg") or affed("damagedleftleg") then
				send("apply mass to legs")
			elseif affed("damagedleftarm") or affed("damagedrightarm") then
				send("apply mass to arms")
			end
		end
		fakeApply = false
	end
end
	
--Turn limb curing off if our target is a Sylvan
function ataxia_heartseedDisable(event, aff)
	local affl = {"damagedleftleg", "damagedrightleg", "damagedleftarm", "damagedrightarm"}
	if event == "aff gained" and ataxiaTemp.heartseedMode and ataxiaNDB_getClass(target) == "Sylvan" then
		if table.contains(affl, aff) then
      ataxia_setAffPrio("damagedleftleg", 26)
      ataxia_setAffPrio("damagedrightleg", 26)
      ataxia_setAffPrio("mangledleftleg", 26)
      ataxia_setAffPrio("mangledrightleg", 26)
      ataxia_setAffPrio("damagedleftarm", 26)
      ataxia_setAffPrio("damagedrightarm", 26)
      ataxia_setAffPrio("mangledleftarm", 26)
      ataxia_setAffPrio("mangledrightarm", 26)
		end
	end		
end
registerAnonymousEventHandler("aff gained", "ataxia_heartseedDisable")

--Turn limb curing back on.
function ataxia_heartseedCured(event, aff)
	if event == "aff cured" and aff == "heartseed" then
		if ataxiaTemp.heartseedMode and ( affed("damagedleftleg") or affed("damagedrightleg") ) then
			ataxia_restorePrio("damagedleftleg")
			ataxia_restorePrio("damagedrightleg")
			ataxia_restorePrio("mangledleftleg")
			ataxia_restorePrio("mangledrightleg")
			ataxia_restorePrio("damagedleftarm")
			ataxia_restorePrio("damagedrightarm")
			ataxia_restorePrio("mangledleftarm")
			ataxia_restorePrio("mangledrightarm")
		end
	end
end

registerAnonymousEventHandler("aff cured", "ataxia_heartseedCured")</script>
													<eventHandlerList />
												</Script>
											</ScriptGroup>
										</ScriptGroup>
										<ScriptGroup isActive="yes" isFolder="yes">
											<name>Can(x)</name>
											<packageName></packageName>
											<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
											<eventHandlerList />
											<Script isActive="yes" isFolder="no">
												<name>Various "can do" stuff</name>
												<packageName></packageName>
												<script>function canBals()
	if ataxia_paused() then return false end
	if ataxia.vitals.bal and ataxia.vitals.eq then
		return true
	else
		return false
	end
end

function canStand()
	if ataxia_paused() then return false end
	if not affed("damagedrightleg") and not affed("brokenrightleg") and not affed("mangledrightleg")
		and not affed("damagedleftleg") and not affed("brokenleftleg") and not affed("mangledleftleg")
		and not affed("impaled") and not affed("transfixation") and not affed("roped") and not affed("webbed")
		and not affed("entangled") and not affed("sleep") and not affed("stun")
	then
		return true
	else
		return false
	end
end

function canParry()
	if ataxia_paused() then return false end
	if canStand() and ataxia.vitals.bal and ataxia.vitals.eq
		and not affed("damagedleftarm") and not affed("damagedrightarm") and not affed("prone")
		and not affed("mangledleftarm") and not affed("mangledrightarm") and not affed("aeon")
		and not affed("brokenleftarm") and not affed("brokenrightarm") and not affed("paralysis")
	then
		return true
	else
		return false
	end
end

function canOutrift()
	if ataxia_paused() then return false end
	if not affed("damagedrightarm") and not affed("brokenrightarm") and not affed("mangledrightarm")
		and not affed("damagedleftarm") and not affed("brokenleftarm") and not affed("mangledleftarm")
		and not affed("impaled") and not affed("transfixed") and not affed("roped") and not affed("webbed")
		and not affed("entangled") and not affed("sleep") and not affed("aeon")
	then
		return true
	else
		return false
	end
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Misc CanDo</name>
												<packageName></packageName>
												<script>function ataxiaBasher_canShield()
	local canShield = true
	
	for num, thing in pairs(ataxia.denizensHere) do
		if not ataxiaBasher.noShieldBreak.mobs[thing] and table.contains(ataxiaBasher.targetList[gmcp.Room.Info.area], thing) then
			canShield = false
		end
	end
	
	return canShield
end

function isMorphed(what)
	if ataxia.vitals.morph and ataxia.vitals.morph:lower() == what:lower() then
		return true
	else
		return false
	end
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Lock breakers</name>
												<packageName></packageName>
												<script>--Will return true if venom locked.
function ataxia_needLockBreak()
	if affed("asthma") and affed("anorexia") and (affed("slickness") or affed("bloodfire")) and gmcp.Char.Status.class ~= "Psion" then
		return true
  elseif affed("asthma") and affed("anorexia") and (affed("slickness") or affed("bloodfire")) and affed("impatience") and gmcp.Char.Status.class == "Psion" then
		return true
	elseif affed("whisperingmadness") then
  return true
  	elseif affed("slime") then
  return true
  else
		return false
	end
end

--If we can break the venom lock, then do so. Requires eq/bal.
function ataxia_lockBreak()

		if ataxia_needLockBreak() then
			if ataxia_canActive() and not ataxiaTemp.activeCureUsed and not attemptedLockBreak then
				attemptedLockBreak = tempTimer(1.5, [[ attemptedLockBreak = nil ]])
				ataxia_breakLock()
			end
		end
	end


function ataxia_canActive()
	if ataxiaTemp.activeCureUsed then return false end

	local blockers = {
		Alchemist = {"stupidity"},
		Blademaster = {"weariness"},
		Depthswalker = {"recklessness"},
		Druid = {"weariness"},
		Infernal = {"weariness"},
		Jester = {"paralysis"},
		Magi = {"haemophilia"},
		Monk = {"weariness"},
		Occultist = {"paralysis"},
		Paladin = {"weariness"},
		Runewarden = {"weariness"},
		Sentinel = {"weariness"},
		Serpent = {"weariness"},
		Shaman = {"selarnia"},
	}
	if affed("brokenleftarm") and affed("brokenrightarm") and blockers[ataxiaTemp.class] and blockers[ataxiaTemp.class][1] ~= "weariness" then
		return false
	elseif not blockers[ataxiaTemp.class] then
		if string.find(ataxiaTemp.class, "Dragon") then
			if affed("weariness") and affed("recklessness") then
				return false
			else
				return true
			end
    elseif string.find(ataxiaTemp.class, "Elemental") then
      if affed("weariness") then
        return true
      else
        return false
      end
		else
			return false
		end
	elseif affed( blockers[ataxiaTemp.class][1] ) then
		return false
	else
		return true
	end
end

function ataxia_breakLock()
	local sp = ataxia.settings.separator
	local lockBreaker = {
		Alchemist = "educe salt",
		Blademaster = "fitness",
		Depthswalker = "chrono accelerate boost",
		Druid = "fitness",
		Infernal = "fitness",
		Jester = "fling fool at me",
		Magi = "cast bloodboil",
		Monk = "fitness",
		Occultist = "fling fool at me",
		Paladin = "fitness",
    Psion = "psi expunge",
		Runewarden = "fitness",
		Sentinel = "fitness",
		Serpent = "shrugging",
		Shaman = "invoke purification",
    Unnamable = "fitness",
	}
	if affed("prone") and not affed("paralysis") then
		send("stand",false)
	end
	if string.find(ataxiaTemp.class, "Dragon") then
		send("dragonheal",false)
  elseif string.find(ataxiaTemp.class, "Earth") then
    send("terran eruption",false)
	else
		send( lockBreaker[ataxiaTemp.class], false )
	end
end

function ataxia_promptLocks()
  local lockTable = {}
  if affed("asthma") and (affed("slickness") or affed("bloodfire")) and affed("anorexia") then
    table.insert(lockTable, "soft")
    if affed("paralysis") then
      table.insert(lockTable, "venom")
    end
    if affed("impatience") or affed("sandfever") then
      table.insert(lockTable, "hard")
      if not ataxia_canActive() and affed("paralysis") then
        table.insert(lockTable, "true")
      end
    end
  end
  
  if affed("asthma") and (affed("bloodfire") or affed("slickness")) and (affed("damagedrightarm") or affed("mangledrightarm")) and (affed("damagedleftarm") or affed("mangledleftarm")) then
    table.insert(lockTable, "rift")
  end  

  if #lockTable &gt; 0 then
    return "&lt;NavajoWhite&gt; (&lt;orange&gt;Locks: &lt;DimGrey&gt;"..table.concat(lockTable, ", ").."&lt;NavajoWhite&gt;)"
  else
    return ""
  end
end

registerAnonymousEventHandler("aff gained", "ataxia_needLockBreak")</script>
												<eventHandlerList />
											</Script>
										</ScriptGroup>
										<Script isActive="yes" isFolder="no">
											<name>Affliction Colouring</name>
											<packageName></packageName>
											<script>function populate_aff_colours()
	affs_to_colour = {
		--Ash Afflictions/DW/Misc
		depression = {"NavajoWhite", "dep"},
		hypersomnia = {"NavajoWhite", "hyp"},
		prone = {"NavajoWhite", "prone"},
		retribution = {"NavajoWhite", "ret"},
		shadowmadness = {"NavajoWhite", "shm"},
		sleeping = {"NavajoWhite", "sleep"},
		timeloop = {"NavajoWhite", "tlo"},
    crescendo = {"NavajoWhite", "cre"},

		--Bloodroot Afflictions
		paralysis = {"red", "PAR"},
		slickness = {"red", "SLI"},

		--Focusables
		agoraphobia = {"yellow", "ago"}, 
		anorexia = {"yellow", "ANO"}, 
		claustrophobia = {"yellow", "cla"}, 
		confusion = {"yellow", "con"}, 
		dementia = {"yellow", "dem"}, 
		dizziness = {"yellow", "diz"},
		epilepsy = {"yellow", "epi"},  
		hallucinations = {"yellow", "hal"}, 
		impatience = {"yellow", "IMP"},
		loneliness = {"yellow", "lon"}, 
		lovers = {"yellow", "lov"}, 
		masochism = {"yellow", "mas"}, 
		pacified = {"yellow", "pac"}, 
		paranoia = {"yellow", "par"}, 
		recklessness = {"yellow", "rec"}, 
		shyness = {"yellow", "shy"},
		stupidity = {"yellow", "stu"}, 
		stuttering = {"yellow", "stut"}, 
		vertigo = {"yellow", "ver"}, 

		--Kelp Afflictions
		asthma = {"purple", "AST"}, 
		clumsiness = {"purple", "clu"}, 
		healthleech = {"purple", "hleech"}, 
		hypochondria = {"purple", "hyp"}, 
		parasite = {"purple", "par"}, 
		sensitivity = {"purple", "sen"}, 
		weariness = {"purple", "WEA"},

		--Ginseng Afflictions
		addiction = {"green", "add"}, 
		darkshade = {"green", "dar"}, 
		haemophilia = {"green", "hae"}, 
		lethargy = {"green", "let"}, 
		nausea = {"green", "nau"}, 
		scytherus = {"green", "scy"},
    
    --Cuprum/Bellwort
    diminished = {"brown","dim"},
    generosity = {"brown","gen"},

		--Ashtan Afflictions
		weakenedmind = {"orange", "rixil"},
		slimeobscure = {"orange", "slime"},
    palpatarfeed = {"orange", "worms"},
    horror = {"magenta", "horror"},

		--Salve Afflictions
		burning = {"orange", "burns"},
		shivering = {"LightSkyBlue", "shiv"},
		frozen = {"blue", "frz"},
		hypothermia = {"red", "hypothermia"},

		crippledleftarm = {"DodgerBlue", "la1"},
		crippledrightarm = {"DodgerBlue", "ra1"},
		crippledleftleg = {"DodgerBlue", "ll1"},
		crippledrightleg = {"DodgerBlue", "rl1"},

		brokenleftarm = {"DodgerBlue", "la1"},
		brokenrightarm = {"DodgerBlue", "ra1"},
		brokenleftleg = {"DodgerBlue", "ll1"},
		brokenrightleg = {"DodgerBlue", "rl1"},

		damagedleftleg = {"DodgerBlue", "Ll2"},
		damagedleftarm = {"DodgerBlue", "La2"},
		damagedrightarm = {"DodgerBlue", "Ra2"},
		damagedrightleg = {"DodgerBlue", "Rl2"},

		mangledleftleg = {"DodgerBlue", "LL3"},
		mangledleftarm = {"DodgerBlue", "LA3"},
		mangledrightarm = {"DodgerBlue", "RA3"},
		mangledrightleg = {"DodgerBlue", "RL3"},

		mildtrauma = {"red", "TO1"},
		serioustrauma = {"firebrick", "TO2"},

		damagedhead = {"red", "H1"},
		concussion = {"firebrick", "H2"},

		--Smoke Afflictions
		aeon = {"DimGrey", "aeon"},
		deadening = {"DimGrey", "dead"},
		disloyalty = {"DimGrey", "dis"},
		hellsight = {"DimGrey", "hell"},
		manaleech = {"DimGrey", "mleech"},
		tension = {"DimGrey", "tens"},
		whisperingmadness = {"DimGrey", "whm"},
    earworm = {"DimGrey", "ear"},

		--Psion Afflictions
    lightbind = {"firebrick", "light"},
		unweavingbody = {"firebrick", "UWB"},
		unweavingmind = {"firebrick", "UWM"},
		unweavingspirit = {"firebrick", "UWS"},

		--Priest Afflictions
		guilt = {"LightSlateBlue", "GUI"},
		inquisition = {"a_darkred", "INQ"},
		spiritburn = {"LightSlateBlue", "SPB"},
		tenderskin = {"LightSlateBlue", "TSK"},
    
    --Pariah Afflictions
      --2 diff ones incase they fix the spellings
    ensorcelled = {"DarkSlateBlue", "ensc"},
    pyramides = {"DarkSlateBlue", "PYR"},
    rebbies = {"DarkSlateBlue", "REB"},
    flushings = {"DarkSlateBlue", "FLU"},
    mycalium = {"DarkSlateBlue", "MYC"},
    sandfever = {"DarkSlateBlue", "SDF"},
    deathsickness = {"white", "PLAGUE"},
    

		--Timed Affs
		airfisted = {"white", "afist"},
    unconsciousness = {"white", "UNC"},
		blackout = {"firebrick", "blackout"},
    blistered = {"tomato", "BLI"},
		calcifiedtorso = {"red", "CalTorso"},
    calcifiedskull = {"red", "CalSkull"},
		internalbleeding = {"a_darkred", "IMPSLASH"},
    numbedleftarm = {"magenta", "NLA"},
    numbedrightarm = {"magenta", "NRA"},
		scalded = {"tomato", "scald"},
		timeflux = {"tomato", "tflux"},
		vinewreathed = {"tomato", "vines"},
    
    incoming_impatience = {"a_brown", "inc_imp"},
    incoming_weariness = {"a_darkmagenta", "inc_wea"},
    incoming_clumsiness = {"a_darkmagenta", "inc_clu"},
    incoming_haemophilia = {"a_darkgreen", "inc_hae"},
    incoming_asthma = {"a_darkmagenta", "inc_ast"},
    incoming_paralysis = {"a_darkred", "inc_par"},
    incoming_epilepsy = {"a_brown", "inc_epi"},
    incoming_addiction = {"a_darkgreen", "inc_add"},

    --Writhe Affs
    transfixation = {"orange", "TFX"},
    impaled = {"magenta", "IMP"},
    bound = {"magenta", "BOU"},
    webbed = {"magenta", "WEB"},
    entangled = {"magenta", "ENT"},

		--Other Affs
		amnesia = {"violet", "amn"},
		fear = {"violet", "fear"},
		impaled = {"grey", "IMPALED"},
		revealed = {"gold", "STAR"},
		selarnia = {"tomato", "SEL"},
		webbed = {"grey", "web"},
		voyria = {"a_red", "VOY"},
		burns = {"orange", "BRN"},
		blackout = {"a_darkred", "BLK"},
		mindravaged = {"a_darkred", "RAVAGEDMIND"},
		bloodfire = {"a_darkred", "BLOODFIRE"},
	}
end</script>
											<eventHandlerList />
										</Script>
										<ScriptGroup isActive="yes" isFolder="yes">
											<name>Fracture Management</name>
											<packageName></packageName>
											<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
											<eventHandlerList />
											<Script isActive="yes" isFolder="no">
												<name>Handle Fracture Counts</name>
												<packageName></packageName>
												<script>ataxiaTables.twohander = ataxiaTables.twohander or {}

function personFocusedPrecision(person)
	ataxiaTables.twohander = ataxiaTables.twohander or {}
	if not ataxiaTables.twohander[person] then
		ataxiaTables.twohander[person] = true
		if ataxiaTables.twohander[person.."timer"] then killTimer(ataxiaTables.twohander[person.."timer"]) end
		ataxiaTables.twohander[person.."timer"] = tempTimer(2.5,
			function() ataxiaTables.twohander[person.."timer"] = nil
				personLostPrecision(person)
			end)
	end
end

function personLostPrecision(person)
	if ataxiaTables.twohander[person.."timer"] then killTimer(ataxiaTables.twohander[person.."timer"]) end
	ataxiaTables.twohander[person] = nil
end

function twohandAddFracture(aff, who)
	ataxia.afflictions[aff] = ataxia.afflictions[aff] or 0
	local count = 1
	if ataxiaTables.twohander[who] then
		count = 2
		personLostPrecision(who)
	end
	 ataxia.afflictions[aff] = ataxia.afflictions[aff] + count
	 if ataxia.afflictions[aff] &gt; 6 then ataxia.afflictions[aff] = 6 end
end</script>
												<eventHandlerList />
											</Script>
										</ScriptGroup>
										<Script isActive="yes" isFolder="no">
											<name>Burn Handling</name>
											<packageName></packageName>
											<script>function ataxia_weAreBurning(stacks)
	if not affed("burning") or ataxia.afflictions.burning ~= stacks then
		ataxia.afflictions.burning = stacks
		raiseEvent("aff gained", "burning")
	end
end

function ataxia_burnsDecreased()
	if not affed("burning") then return end
	local stack = ataxia.afflictions.burning
	if stack &gt; 1 then
		stack = stack - 1
	end
	ataxia.afflictions.burning = stack
	raiseEvent("aff gained", "burning")
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<Script isActive="yes" isFolder="no">
										<name>Prompt Running</name>
										<packageName></packageName>
										<script>function ataxia_promptCommands()
	if not gmcp then return end
	if not gmcp.Char then return end
	if not checkedMissingVariables then
		ataxiaCheckForMissing()
	end
	ataxiaTemp.lokiCheck = false
	if not noPromptEcho then
		ataxiaPromptSub()
		
		--defunct function, keeping it for review purposes only
		--ataxia_promptEcho()
	end
	noPromptEcho = false
  if ataxiaTemp.alertness then
    alertnessDisplay()
  end
	if ataxia_isClass("monk") then
		disableTrigger("Tekura Limbs")
	end

	if ataxia.settings.use.parry and ataxia.parrying and ataxia.parry ~= "manual" then
		ataxia_parryCheck()
		if canParry() and ataxia.parrying.shouldparry ~= ataxia.parrying.limb and not parryAttempted then
      if ataxia_isClass("monk") and gmcp.Char.Vitals.charstats[3] == "Tekura" then
        send("guard "..ataxia.parrying.shouldparry)
      else
			 send("parry "..ataxia.parrying.shouldparry)
      end
			parryAttempted = true
			tempTimer(3, [[parryAttempted = false]])
		end
	end

	if ataxia_isClass("bard") and ataxiaTemp.needSymphony and ataxia.bardStuff.symphony and canBals() and bardHarmsInRoom and not ataxiaTemp.symphAttempted then
		ataxiaTemp.symphAttempted = true
		tempTimer(2, [[ataxiaTemp.symphAttempted = nil]])
		send("queue addclear freestand wield "..ataxia.bardStuff.instrument.." shield"..ataxia.settings.separator.."play symphony")
	end

if ataxiaBasher.enabled then
    
    if need_roomCheck then
      ataxiaBasher_scanRoom()
    end
  
if ataxia.vitals.hp &gt;= ataxia.vitals.maxhp and ataxiaTemp.bashFlee == true or ataxiaBasher.paused == true and guardianofmogcunts == false then
			  ataxiaTemp.bashFlee = false
        ataxiaBasher.paused = false
			  search_targets()
end
  
  if ataxia.vitals.wpp &lt;= 5 then
    if ataxiaBasher.dragonIncant == true then
      ataxiaBasher.jabBash = true
      ataxiaBasher.dragonIncant = false
    end
  end
  
    if basher_needAction and found_target and not ataxiaBasher_skipRoom then
      basher_needAction = false
      if gmcp.Char.Status.class == "Magi" then
        ataxiaBasher_magiBashing()
        ataxiaBasher_attack()
      else
      ataxiaBasher_attack()
      end
      
    end
    
		disableTrigger("Denizen Attack Find")
		ataxiaBasher_atk = false
		ataxiaBasher_patterns()
	end
	ataxia_precacheQueue()
end


function ataxia_promptEcho()

	if not ataxia.settings.prompt then return end

	if ataxia.settings.prompt.xp then
		cecho(" &lt;green&gt;(&lt;a_cyan&gt;"..gmcp.Char.Vitals.nl.."%&lt;green&gt;)")
	end

	if ataxia.settings.prompt.timestamps then
		local timestamp = tostring(getTime(true,"hh:mm:ss:zzz"))
		cecho(" &lt;dim_grey&gt;" ..timestamp)
	end
	
	if ataxia.fishing and ataxia.fishing.enabled then
		cecho(" &lt;orange&gt;[&lt;NavajoWhite&gt;"..linelength.." ft&lt;orange&gt;]")
	end
	
	if ataxia_isClass("magi") or ataxia_isClass("bard") then
		limbCounter_promptAddon()
	end
	
	if ataxia.settings.prompt.affs then		
		ataxia_promptAffs()
	end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Pause Toggling</name>
										<packageName></packageName>
										<script>function ataxiaToggle(opt)
	if opt == nil then
		if ataxia.settings.paused then
			send("curing on")
		else
			send("curing off")
		end
	else
		send("curing "..opt)
	end
end</script>
										<eventHandlerList />
									</Script>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Self Limb Tracking</name>
										<packageName></packageName>
										<script>--Initialise the tables.
selfLimbDamage = selfLimbDamage or {
	["head"] = {damage = 0},
	["torso"] = {damage = 0},
	["left arm"] = {damage = 0},
	["right arm"] = {damage = 0},
	["left leg"] = {damage = 0},
	["right leg"] = {damage = 0},
	
	timers = {},
	lasthit = "left leg",	
}

function resetMissLines()
	ataxiaTables.missLines = {}
	ataxiaTables.missLines = {
		"You parry the attack with a deft manoeuvre.", 
		"The attack rebounds back onto %w+!", 
		"The attack rebounds onto %w+!", 
		"The attack rebounds off your rebounding aura!", 
		"%w+ misses you with ", 
		"You dodge nimbly out of the way.", 
		"One of your reflections has been destroyed! You have %d+ left.", 
		"You twist your body out of harm's way.", 
		"You quickly jump back, avoiding the attack.", 
		"You frantically attempt to parry the attack of %w+, but succeed only in redirecting it.", 
		"You move inside %w+'s guard, deflecting %w+ attack to one side with your forearm before countering with a swift blow to %w+ temple.",
	}
end

function resetBladeMasterDamage()
	ataxiaTemp.blademasterDamage = {}
	local health = ataxia.vitals.maxhp
	local breakp = 0
	if health &lt; 3600 then breakp = 7
	elseif health &lt; 4300 then breakp = 8
	elseif health &lt; 4900 then breakp = 9
	elseif health &lt; 5500 then breakp = 10
	elseif health &lt; 6200 then breakp = 11
	elseif health &lt; 6900 then breakp = 12
	elseif health &lt; 7600 then breakp = 13
	elseif health &lt; 8300 then breakp = 14
	else breakp = 15 end
	
	ataxiaTemp.blademasterDamage.slash = (210/breakp)
	ataxiaTemp.blademasterDamage.off = (150/breakp)
	ataxiaTemp.blademasterDamage.compass = (200/breakp)
end

function resetKnightDamage()
	ataxiaTemp.knightDamage = {}
	local health = ataxia.vitals.maxhp
	--snb calculation first
	local brk = 7
	if health &gt; 3800 then
		health = health - 3800
		while health &gt; 0 do
			health = health - 450
			brk = brk + 1
		end
	end
	ataxiaTemp.knightDamage.snb = (100/brk)
  local dwc = ((ataxia.vitals.maxhp-3800)/500)+9
  ataxiaTemp.knightDamage.dwc = (100/dwc)
end</script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>Different Attacks</name>
											<packageName></packageName>
											<script>------------------------------------------------------------------------------------------------------------------------
--&gt; Blademaster
--[armslash]--
function armslash_selfLimbhit(side)
	selectString(side, 1)
	setBold(true)
	fg("a_blue")
	resetFormat()
	deselect()
	
	tempLineTrigger(1, 1, [[confirm_armslash("]]..side..[[")]])
end

function confirm_armslash(side)
	if not ataxiaTables.missLines then resetMissLines() end
	local parry = false
	for _, part in pairs(ataxiaTables.missLines) do
		if line:match(part) then
			parry = true
			break
		end
	end
	
	if not parry then confirmed_armslash(side) end
end

function confirmed_armslash(side)
	if not ataxiaTemp.blademasterDamage then resetBladeMasterDamage() end
	if side == "left" then
		ataxia_raiseLimbDamage("right arm", ataxiaTemp.blademasterDamage.off)
		ataxia_raiseLimbDamage("left arm", ataxiaTemp.blademasterDamage.slash)
	else
		ataxia_raiseLimbDamage("left arm", ataxiaTemp.blademasterDamage.off)
		ataxia_raiseLimbDamage("right arm", ataxiaTemp.blademasterDamage.slash)
	end
end
--[legslash]--
function legslash_selfLimbhit(side)
	selectString(side, 1)
	setBold(true)
	fg("a_blue")
	resetFormat()
	deselect()
	
	tempLineTrigger(1, 1, [[confirm_legslash("]]..side..[[")]])
end

function confirm_legslash(side)
	if not ataxiaTables.missLines then resetMissLines() end
	local parry = false
	for _, part in pairs(ataxiaTables.missLines) do
		if line:match(part) then
			parry = true
			break
		end
	end
	
	if not parry then confirmed_legslash(side) end
end

function confirmed_legslash(side)
	if not ataxiaTemp.blademasterDamage then resetBladeMasterDamage() end
	if side == "left" then
		ataxia_raiseLimbDamage("right leg", ataxiaTemp.blademasterDamage.off)
		ataxia_raiseLimbDamage("left leg", ataxiaTemp.blademasterDamage.slash)
	else
		ataxia_raiseLimbDamage("left leg", ataxiaTemp.blademasterDamage.off)
		ataxia_raiseLimbDamage("right leg", ataxiaTemp.blademasterDamage.slash)
	end
end
--[centreslash]--
function centreslash_selfLimbhit(section)
	selectString(section, 1)
	setBold(true)
	fg("a_blue")
	resetFormat()
	deselect()
	
	tempLineTrigger(1, 1, [[confirm_centreslash("]]..section..[[")]])
end

function confirm_centreslash(section)
	if not ataxiaTables.missLines then resetMissLines() end
	local parry = false
	for _, part in pairs(ataxiaTables.missLines) do
		if line:match(part) then
			parry = true
			break
		end
	end
	
	if not parry then confirmed_centreslash(section) end
end

function confirmed_centreslash(section)
	if not ataxiaTemp.blademasterDamage then resetBladeMasterDamage() end
	if section == "torso" then
		ataxia_raiseLimbDamage("head", ataxiaTemp.blademasterDamage.off)
		ataxia_raiseLimbDamage("torso", ataxiaTemp.blademasterDamage.slash)
	else
		ataxia_raiseLimbDamage("torso", ataxiaTemp.blademasterDamage.off)
		ataxia_raiseLimbDamage("head", ataxiaTemp.blademasterDamage.slash)
	end
end
------------------------------------------------------------------------------------------------------------------------
--&gt; Earth Lord
function earthLord_selfLimbHit(limb)
	selectString(limb, 1)
	setBold(true)
	fg("a_blue")
	resetFormat()
	deselect()
	
	tempLineTrigger(1, 1, [[earthLord_confirmHit("]]..limb..[[")]])
end

function earthLord_confirmHit(limb)
	if not ataxiaTables.missLines then resetMissLines() end
	local parry = false
	for _, part in pairs(ataxiaTables.missLines) do
		if line:match(part) then
			parry = true
			break
		end
	end
	
	if not parry then ataxia_raiseLimbDamage(limb, 16.7) end
end
------------------------------------------------------------------------------------------------------------------------
--&gt; Knight (WIP)
function snb_selfLimbHit(limb)
	selectString(limb, 1)
	setBold(true)
	fg("a_blue")
	resetFormat()
	deselect()
	
	tempLineTrigger(1, 1, [[confirm_snbhit("]]..limb..[[")]])
end

function confirm_snbhit(limb)
	if not ataxiaTables.missLines then resetMissLines() end
	if not ataxiaTemp.knightDamage then resetKnightDamage() end
	local parry = false
	for _, part in pairs(ataxiaTables.missLines) do
		if line:match(part) then
			parry = true
			break
		end
	end
	
	if not parry then ataxia_raiseLimbDamage(limb, ataxiaTemp.knightDamage.snb) end
end

function dwc_selfLimbHit(limb)
	selectString(limb, 1)
	setBold(true)
	fg("a_blue")
	resetFormat()
	deselect()
	
	tempLineTrigger(1, 1, [[confirm_dwchit("]]..limb..[[")]])
end

function confirm_dwchit(limb)
	if not ataxiaTables.missLines then resetMissLines() end
	if not ataxiaTemp.knightDamage then resetKnightDamage() end
	local parry = false
	for _, part in pairs(ataxiaTables.missLines) do
		if line:match(part) then
			parry = true
			break
		end
	end
	
	if not parry then ataxia_raiseLimbDamage(limb, ataxiaTemp.knightDamage.dwc) end
end

------------------------------------------------------------------------------------------------------------------------
--&gt; Priest (basic for now, just as something to work with)
function priest_selfLimbHit(limb)
  selectString(limb,1)
  setBold(true)
  fg("a_blue")
  resetFormat()
  deselect()
  
  tempLineTrigger(1, 1, [[confirm_limbsmite("]]..limb..[[")]])
end

function confirm_limbsmite(limb)
	if not ataxiaTables.missLines then resetMissLines() end
	local parry = false
	for _, part in pairs(ataxiaTables.missLines) do
		if line:match(part) then
			parry = true
			break
		end
	end
	
	if not parry then ataxia_raiseLimbDamage(limb, 15.8) end
end  

------------------------------------------------------------------------------------------------------------------------
--&gt; Dragon/Druid (quarter)

function quarterHit_selfLimbHit(limb)
	selectString(limb, 1)
	setBold(true)
	fg("a_blue")
	resetFormat()
	deselect()
	
	tempLineTrigger(1, 1, [[confirm_quarterHit("]]..limb..[[")]])
end

function confirm_quarterHit(limb)
	if not ataxiaTables.missLines then resetMissLines() end
	local parry = false
	for _, part in pairs(ataxiaTables.missLines) do
		if line:match(part) then
			parry = true
			break
		end
	end
	
	if not parry then ataxia_raiseLimbDamage(limb, 25) end
end
------------------------------------------------------------------------------------------------------------------------
--&gt; Magi

function staffStrike_selfLimbHit(element, limb)
	selectString(limb, 1)
	setBold(true)
	fg("a_blue")
	resetFormat()
	deselect()
	
	tempLineTrigger(1, 1, [[confirm_staffStrike("]]..element..[[","]]..limb..[[")]])
end

function confirm_staffStrike(element, limb)
	if not ataxiaTables.missLines then resetMissLines() end
	local parry = false
	for _, part in pairs(ataxiaTables.missLines) do
		if line:match(part) then
			parry = true
			break
		end
	end
	
	if not parry then confirmed_staffStrike(element, limb) end
end

function confirmed_staffStrike(element, limb)
	local health = ataxia.vitals.maxhp
	local sd, ad
	if health &lt;= 3499 then
		sd = string.format("%2.2f", (100/6.5))
	elseif health &lt;= 6700 then
		sd = string.format("%2.2f", (100/6.5))
	else
		sd = string.format("%2.2f", (100/7))
	end
	ad = string.format("%2.2f", (100/12))

	if element == "Whirrh" then
		ataxia_raiseLimbDamage(limb, ad)
	else
		ataxia_raiseLimbDamage(limb, sd)
	end
end
------------------------------------------------------------------------------------------------------------------------
--&gt; Sylvan

function thornrend_selfLimbHit(limb)
	selectString(limb, 1)
	setBold(true)
	fg("a_blue")
	resetFormat()
	deselect()
	
	tempLineTrigger(1, 1, [[confirm_thornrend("]]..limb..[[")]])
end

function confirm_thornrend(limb)
	if not ataxiaTables.missLines then resetMissLines() end
	local parry = false
	for _, part in pairs(ataxiaTables.missLines) do
		if line:match(part) then
			parry = true
			break
		end
	end
	
	if not parry then 
		if affed("vinewreathed") then
			ataxia_raiseLimbDamage(limb, 12.5)
		else
			ataxia_raiseLimbDamage(limb, 25)
		end
	end
end
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
-----------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------
</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Track The Damage</name>
											<packageName></packageName>
											<script>function ataxia_raiseLimbDamage(limb, num)
	if type(target) == "number" then
		tAffs.shield = false
		tAffs.rebounding = false
		tAffs.paralysis = false
		tAffs.prone = false
	end
	
	selfLimbDamage.lasthit = limb
	
	selfLimbDamage[limb]["damage"] = selfLimbDamage[limb]["damage"] + num
	if selfLimbDamage[limb]["damage"] &gt; 95 then selfLimbDamage[limb]["damage"] = 100 end
	selfLimbDamage.timers[limb] = selfLimbDamage.timers[limb] or {}
	if selfLimbDamage.timers[limb].timer then killTimer( selfLimbDamage.timers[limb].timer ) end
	selfLimbDamage.timers[limb].timer = tempTimer( 180, [[ ataxia_resetLimbDamage("]]..limb..[[")]])
	
	if limb == "torso" and selfLimbDamage.torso["damage"] &gt;= 97 then
		ataxia_boxEcho("Torso is likely broken!", "red")
		send("curing predict mildtrauma")
	end
end

function ataxia_resetLimbDamage(limb)
	ataxia_clearLimbDamage(limb)
	ataxiaEcho("Our &lt;green&gt;"..limb.."&lt;NavajoWhite&gt; has been reset.")
end

function ataxia_clearLimbDamage(limb)
	selfLimbDamage[limb]["damage"] = 0
	if selfLimbDamage.timers[limb] and selfLimbDamage.timers[limb].timer then killTimer( selfLimbDamage.timers[limb].timer ) end
	selfLimbDamage.timers[limb] = nil
end

function ataxia_brokenLimbFound(event, affliction)
	if event == "aff gained" then
		if affliction == "damagedleftarm" or affliction == "mangledleftarm" then
			ataxia_clearLimbDamage("left arm")
			ataxia_boxEcho("LEFT ARM HAS BEEN BROKEN", "black:yellow")
		elseif affliction == "damagedrightarm" or affliction == "mangledrightarm" then
			ataxia_clearLimbDamage("right arm")
			ataxia_boxEcho("RIGHT ARM HAS BEEN BROKEN", "black:yellow")
		elseif affliction == "damagedleftleg" or affliction == "mangledleftleg" then
			ataxia_clearLimbDamage("left leg")
			ataxia_boxEcho("LEFT LEG HAS BEEN BROKEN", "black:DarkOrange")
			if not affed("damagedleftarm") and not affed("damagedrightarm") and ataxiaTemp.salvelockWait then
				killTimer(ataxiaTemp.salvelockWait) 
				ataxiaTemp.salvelockWait = nil
				send("queue addclear free restore",false)
			end
		elseif affliction == "damagedrightleg" or affliction == "mangledrightleg" then
			ataxia_clearLimbDamage("right leg")
			ataxia_boxEcho("RIGHT LEG HAS BEEN BROKEN", "black:DarkOrange")
			if not affed("damagedleftarm") and not affed("damagedrightarm") and ataxiaTemp.salvelockWait then
				killTimer(ataxiaTemp.salvelockWait) 
				ataxiaTemp.salvelockWait = nil			
				send("queue addclear eqbal restore",false)
			end			
		elseif affliction == "damagedhead" or affliction == "mangledhead" then
			ataxia_clearLimbDamage("head")
			ataxia_boxEcho("HEAD HAS BEEN BROKEN", "black:goldenrod")
		elseif affliction == "mildtrauma" or affliction == "serioustrauma" then
			ataxia_clearLimbDamage("torso")
			ataxia_boxEcho("TORSO HAS BEEN BROKEN", "black:red")
		end	
	elseif event == "aff cured" then
		if affliction == "mildtrauma" or affliction == "serioustrauma" then
			ataxia_clearLimbDamage("torso")
		end	
	end
end

registerAnonymousEventHandler("aff gained", "ataxia_brokenLimbFound")
registerAnonymousEventHandler("aff cured", "ataxia_brokenLimbFound")</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Parrying</name>
											<packageName></packageName>
											<script>function ataxia_createParry()
	ataxia.parry = ataxia.parry or "stand"
	ataxia.parrying = ataxia.parrying or {
		limb = "none",
		shouldparry = "right leg",
		modes = {
			"stand", "defend", "manual", "randomarm", "randomleg"
		},
	}
	ataxiaEcho("Parrying initialised.")
end

function ataxia_collapseParry()
	ataxia.parrying = nil
end

function ataxia_parryCheck()
	local change = ""
	local method = ataxia.parry

	if method == "manual" then return end

	--Priority lists for switching.
	local prio_order = {"left leg", "right leg","torso","head","left arm", "right arm"}
	local prio_order_hypemode = {"left leg", "right leg","left arm", "right arm", "torso", "head"}

	local ties = {}

	if method == "none" then
		ataxiaEcho("Defaulting to 'stand' parry method, since it wasn't set.")
		ataxia.parry = "stand"
		method = ataxia.parry
	end
	ataxia.parrying.weights = {
		["left arm"] = 0,	["right arm"] = 0,
		["left leg"] = 0,	["right leg"] = 0,
		["head"] = 0,		["torso"] = 0,
	}

	if method == "defend" then
		for i=1, #prio_order do
			local limb = ataxia.parrying.weights[prio_order_hypemode[i]]
			local toLimb = prio_order_hypemode[i]		
			if selfLimbDamage[toLimb]["damage"] &gt; 75 then
				limb = limb + 2
			elseif selfLimbDamage[toLimb]["damage"] &gt; 50 then
				limb = limb + 1.5
			elseif selfLimbDamage[toLimb]["damage"] &gt; 25 then
				limb = limb + 1
			elseif selfLimbDamage[toLimb]["damage"] &gt; 0 then
				limb = limb + 0.5
			end
			
			if ataxia.afflictions["damaged"..prio_order_hypemode[i]:gsub(" ", "")] then
				limb = limb + 1
			elseif ataxia.afflictions["mangled"..prio_order_hypemode[i]:gsub(" ", "")] then
				limb = limb + 0
			else
				limb = limb + 2
			end
			ataxia.parrying.weights[prio_order_hypemode[i]] = limb
		end

	elseif method == "stand" then
		ataxia.parrying.weights["left leg"] = 2
		ataxia.parrying.weights["right leg"] = 2

		for i=1, #prio_order do
			local limb = ataxia.parrying.weights[prio_order_hypemode[i]]
			local toLimb = prio_order_hypemode[i]		
			if selfLimbDamage[toLimb]["damage"] &gt; 75 then
				limb = limb + 3
			elseif selfLimbDamage[toLimb]["damage"] &gt; 50 then
				limb = limb + 2
			elseif selfLimbDamage[toLimb]["damage"] &gt; 25 then
				limb = limb + 1
			elseif selfLimbDamage[toLimb]["damage"] &gt; 0 then
				limb = limb + 0.5
			end
			
	
			if ataxia.afflictions["damaged"..prio_order_hypemode[i]:gsub(" ", "")] then
				limb = limb - 1
			elseif ataxia.afflictions["mangled"..prio_order_hypemode[i]:gsub(" ", "")] then
				limb = limb + 0
			else
				limb = limb + 2
			end
			ataxia.parrying.weights[prio_order_hypemode[i]] = limb
		end
	elseif method == "randomarm" or method == "randomleg" then
	
		local x = math.random(1, 100)
		if ataxiaTemp.parryTimer then return end
		ataxiaTemp.parryTimer = tempTimer(2.5, [[ ataxiaTemp.parryTimer = nil ]])
		local limb = ( x % 2 == 0 and "left " or "right " ) .. ( method == "randomarm" and "arm" or "leg")

		ataxia.parrying.weights[limb] = 10		
	end

	local highest = ""
	local highest_value = 0

	for i=1, #prio_order do
		local limb = ataxia.parrying.weights[prio_order_hypemode[i]]
		if limb &gt; highest_value then
			ties = {prio_order[i]}
			highest = prio_order[i]
			highest_value = limb
		elseif limb == highest_value then
			table.insert(ties, prio_order[i])
		end
	end

	if highest_value &gt; 0 and #ties == 1 then
		ataxia.parrying.shouldparry = highest
	elseif #ties &gt; 1 and highest_value &gt; 0 and not table.contains(ties, ataxia.parrying.limb) then
		ataxia.parrying.shouldparry = ties[math.random(#ties)]
	else
		ataxia.parrying.shouldparry = ataxia.parrying.shouldparry or "head"
	end
  
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<Script isActive="yes" isFolder="no">
										<name>Prompt Substitution</name>
										<packageName></packageName>
										<script>function alertnessDisplay()
  moveCursor(0, getLineNumber())
  local ppl 
  for dir, list in pairs(ataxiaTemp.alertness) do
    ppl = {}
    for _, person in pairs(ataxiaTemp.alertness[dir]) do
      table.insert(ppl, "&lt;"..ataxiaNDB_getColour(person).."&gt;"..person)
    end
    cinsertText("&lt;firebrick&gt;[&lt;LightSkyBlue&gt;"..dir.."&lt;firebrick&gt;]: "..table.concat(ppl, ", ").. "&lt;cyan&gt; (&lt;NavajoWhite&gt;"..#ppl.."&lt;cyan&gt;)\n")
  end

  moveCursorEnd()


  ataxiaTemp.alertness = nil
end

function ataxiaPrompt_getColour(tag)
	for k,v in pairs(ataxiaPromptColours) do
		if table.contains(ataxiaPromptColours, tag) then
			if type(ataxiaPromptColours[tag]) == "function" then
				return "&lt;"..ataxiaPromptColours[tag]().."&gt;"
			elseif type(ataxiaPromptColours[tag]) == "string" then
				return "&lt;"..ataxiaPromptColours[tag].."&gt;"
			end
		else
			return "&lt;"..tag.."&gt;"
		end
	end
end

function ataxiaPrompt_getTag(tag)
  local theTag = false
  local tailEnd = false
    for k,v in pairs(ataxiaPromptTags) do
      if string.starts(tag, k) then
        theTag = k
        tailEnd = string.gsub(tag, theTag, "")
      end
    end
  local th = ataxiaPromptTags[theTag]
  if type(th) == "function" then
    return _G["ataxiaPromptTags"][theTag]() .. tailEnd
  elseif type(th) == "string" then
    return _G["ataxiaPromptTags"][theTag] .. tailEnd
  end
end

function ataxiaPromptSub()
	if not ataxia.settings.customprompt or ataxia.settings.customprompt == "" then return end
	
	selectCurrentLine(); replace("");

	if affed("blackout") then
		if ataxia_paused() then cecho("&lt;red&gt;(paused)") end
		cecho("&lt;black:red&gt; [BLACKOUT]")
		return
	end

	local promptString = string.gsub(ataxia.settings.customprompt, "#([A-Za-z_:]+)", ataxiaPrompt_getColour)
	promptString = string.gsub(promptString, "@(%w+)", ataxiaPrompt_getTag)
	
	local last_colour = nil
	local promptEcho = ""
	
	for colour, text in string.gmatch("&lt;white&gt;"..promptString, "&lt;([A-Za-z_:]+)&gt;([^&lt;]*)" ) do
    if not string.match( colour, "[A-Za-z_]+:[A-Za-z_]+" ) and not color_table[colour] then
      promptEcho = promptEcho .. "&lt;"..colour.."&gt;"..text
    else
      if not last_colour then last_colour = colour end

      if not string.find( colour, ":" ) and not string.find( last_colour, ":" ) then
        promptEcho = "&lt;"..last_colour.."&gt;"..promptEcho
      end
      promptEcho = promptEcho.."&lt;"..colour.."&gt;"..text
      cecho(promptEcho)
      promptEcho = ""
      last_colour = colour
    end
  end
end

--Tables for prompt stuff.
ataxiaPromptTags = {
						--Vitals related things
	["health"] = function() return ataxia.vitals.hp end,
	["percenthealth"] = function() return ataxia.vitals.hpp end,
	["mana"] = function() return ataxia.vitals.mp end,
	["percentmana"] = function() return ataxia.vitals.mpp end,
	["endurance"] = function() return ataxia.vitals.ep end,
	["percentendurance"] = function() return ataxia.vitals.epp end,
	["willpower"] = function() return ataxia.vitals.wp end,
	["percentwillpower"] = function() return ataxia.vitals.wpp end,
	["bleeding"] = function() return ataxia.vitals.bleed end,
	["bal"] = function() if ataxia.vitals.bal then return "x" else return "" end end,
	["eq"] = function() if ataxia.vitals.eq then return "e" else return "" end end,
	["exp"] = function() return gmcp.Char.Status.xp end,
	["rage"] = function() return ataxia.vitals.rage end,
	["hseed"] = function() if ataxiaTemp.heartseedMode then return "HS" else return "" end end,
  ["warning"] = function() return ataxiaTemp.warningText end,

						--Useful tags
	["affs"] = function() return ataxia_promptAffs() end,
	["age"] = function() return (ataxiaTemp.class == "Depthswalker" and " "..ataxiaTables.depthswalker.age.." " or "") end,
	["defs"] = function()
			local defStr = ""
			if ataxia.defences.blindness then defStr = defStr.."&lt;DimGrey&gt;b" end
			if ataxia.defences.deafness then defStr = defStr.."&lt;DimGrey&gt;d" end
			if ataxia.defences.cloak then defStr = defStr.."&lt;DimGrey&gt;c" end
			if ataxia.defences.kola then defStr = defStr.."&lt;DimGrey&gt;k" end
			if ataxia.defences.mass then defStr = defStr.."&lt;DimGrey&gt;m" end
			return defStr
		end,
	["metawake"] = function() if ataxia.defences.metawake then return "&lt;pink&gt;MW" end end,
	["tlimbs"] = function() return limbCounter_textTag() end,
  ["nlimbs"] = function() return limbCounter_numberTag() end,
  ["tarbals"] = function()
    local balStr = ""
    balStr = balStr.."&lt;green&gt;"..(tBals.plant and "H" or "_")
    balStr = balStr.."&lt;DodgerBlue&gt;"..(tBals.salve and "S" or "_")
    balStr = balStr.."&lt;sienna&gt;"..(tBals.tree and "T" or "_")
    balStr = balStr.."&lt;yellow&gt;"..(tBals.focus and "F" or "_")
    return balStr
  end,
	
						--Miscellaneous
            
  ["stance"] = function()
    local sStr = ""
    if ataxiaTemp.class == "Blademaster" then
      sStr = ataxia.vitals.stance or ""
    elseif ataxiaTemp.class == "Monk" then
      if not ataxia.vitals.kata then
        sStr = ataxia.vitals.stance or ""
      else
        sStr = string.sub(ataxia.vitals.form, 1, 2):title().."-"..(ataxia.vitals.kata or 0)
      end
    end
    return sStr
  end,            
  ["shaman"] = function()
    local shamStr = ""
    if ataxiaTemp.class == "Shaman" then
		  if not ataxiaTemp.dollFashions or ataxiaTemp.dollFashions &lt;= 0 then
  			shamStr = "_&lt;magenta&gt;|"
  		else
  			shamStr = ""..ataxiaTemp.dollFashions.."&lt;magenta&gt;|"
  		end
      shamStr = shamStr..(ataxiaTemp.bloodlet and "&lt;green&gt;_" or "&lt;green&gt;B")
      shamStr = shamStr..(ataxiaTemp.coagulate and "&lt;red&gt;_" or "&lt;red&gt;C")
      shamStr = shamStr..(ataxiaTemp.relapse and "&lt;purple&gt;_" or "&lt;purple&gt;R")
    end
    return shamStr
  end,
  		     
	["depthswalker"] = function()
			local dwStr = ""
			if ataxiaTemp.class == "Depthswalker" then
				dwStr = dwStr.."&lt;DimGrey&gt;(&lt;"..getAgeColour().."&gt;"..ataxiaTables.depthswalker.age.."&lt;DimGrey&gt;|"
				dwStr = dwStr..(ataxiaTables.depthswalker.canPreempt and "&lt;green&gt;P" or "&lt;DimGrey&gt;p")
				dwStr = dwStr..(ataxiaTables.depthswalker.causalityBal and "&lt;green&gt;C" or "&lt;DimGrey&gt;c")
				dwStr = dwStr..(ataxiaTables.depthswalker.wordBal and "&lt;green&gt;W&lt;DimGrey&gt;)" or "&lt;DimGrey&gt;w)")
			end
			return dwStr
		end,
	["timestamp"] = function()
			local timestamp = tostring(getTime(true,"hh:mm:ss:zzz"))
			return timestamp
		end,	
	["paused"] = function() if ataxia_paused() then return "(paused)" else return "" end end,
	["targetinfo"] = function()
			if not target or target == "Nothing" or target == "nothing" then return "" end
			local str = ""
			if target then str = "&lt;DimGrey&gt;(&lt;white&gt;"..target end
			if gmcp.IRE.Target and gmcp.IRE.Target.Info and gmcp.IRE.Target.Info.hpperc ~= "-1" then
				if ataxiaTemp.mobhealth ~= 0 then
					str = str.."&lt;DimGrey&gt;|&lt;white&gt;"..gmcp.IRE.Target.Info.hpperc
				end
			end
			str = str.."&lt;DimGrey&gt;)"
			return str
		end,
		
		["class"] = function()
			local power = ataxia.vitals.class or 0
			local str = ""
			if power == 0 then
				str = ""
			elseif power &lt;= 20 then
				str = "&lt;DimGrey&gt;"..power
			elseif power &lt;= 40 then
				str = "&lt;red&gt;"..power
			elseif power &lt;= 60 then
				str = "&lt;orange&gt;"..power
			elseif power &lt;= 80 then
				str = "&lt;yellow&gt;"..power
			else
				str = "&lt;green&gt;"..power
			end
			return str 
		end,
	
}

ataxiaPromptColours = {
	["hcolour"] = function()
			if ataxia.vitals.hpp &gt; 75 then return "green"
			elseif ataxia.vitals.hpp &gt; 50 then return "yellow"
			elseif ataxia.vitals.hpp &gt; 25 then return "orange"
			else return "red" end
		end,
		
	["mcolour"] = function()
			if ataxia.vitals.mpp &gt; 75 then return "green"
			elseif ataxia.vitals.mpp &gt; 50 then return "yellow"
			elseif ataxia.vitals.mpp &gt; 25 then return "orange"
			else return "red" end
		end,
		
	["ecolour"] = function()
			if ataxia.vitals.epp &gt; 75 then return "green"
			elseif ataxia.vitals.epp &gt; 50 then return "yellow"
			elseif ataxia.vitals.epp &gt; 25 then return "orange"
			else return "red" end
		end,
		
	["wcolour"] = function()
			if ataxia.vitals.wpp &gt; 75 then return "green"
			elseif ataxia.vitals.wpp &gt; 50 then return "yellow"
			elseif ataxia.vitals.wpp &gt; 25 then return "orange"
			else return "a_darkred" end
		end,
    
	["darkh"] = function()
			if ataxia.vitals.hpp &gt; 75 then return "a_darkgreen"
			elseif ataxia.vitals.hpp &gt; 50 then return "goldenrod"
			elseif ataxia.vitals.hpp &gt; 25 then return "dark_orange"
			else return "a_darkred" end
		end,
		
	["darkm"] = function()
			if ataxia.vitals.mpp &gt; 75 then return "a_darkgreen"
			elseif ataxia.vitals.mpp &gt; 50 then return "goldenrod"
			elseif ataxia.vitals.mpp &gt; 25 then return "dark_orange"
			else return "a_darkred" end
		end,
		
	["darke"] = function()
			if ataxia.vitals.epp &gt; 75 then return "a_darkgreen"
			elseif ataxia.vitals.epp &gt; 50 then return "goldenrod"
			elseif ataxia.vitals.epp &gt; 25 then return "dark_orange"
			else return "a_darkred" end
		end,
		
	["darkw"] = function()
			if ataxia.vitals.wpp &gt; 75 then return "a_darkgreen"
			elseif ataxia.vitals.wpp &gt; 50 then return "goldenrod"
			elseif ataxia.vitals.wpp &gt; 25 then return "dark_orange"
			else return "a_darkred" end
		end,    
}</script>
										<eventHandlerList />
									</Script>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Class Things</name>
										<packageName></packageName>
										<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>Alchemist</name>
											<packageName></packageName>
											<script>function needToSalt()
  local prio = {"hellsight", "hypochondria", "impatience", "whisperingmadness", "timeloop"}
  local others = {"addiction", "slickness", "sensitivity", "anorexia", "asthma", "lethargy", "healthleech"}
  
  local need = false
  local ot = 0
  
  for _, aff in pairs(prio) do
    if affed(aff) then
      need = true
      break
    end
  end
  
  if not need then
    for _, aff in pairs(others) do
      if affed(aff) then
        ot = ot + 1
        if ot &gt;= 2 then
          need = true
          break
        end
      end
    end
  end
  
  if affed("paralysis") then
    need = false
  end
	return need
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Depthswalker</name>
											<packageName></packageName>
											<script>ataxiaTables.depthswalker = {
		usedPreempt = false,
		canPreempt = true,
		age = 0,
		wordBal = true,
		causalityBal = true,
	}
	

function ataxia_depthswalkerReset()
	ataxiaTables = ataxiaTables or {}
	ataxiaTables.depthswalker = {
		usedPreempt = false,
		canPreempt = true,
		age = 0,
		wordBal = true,
		causalityBal = true,
	}
	
	updating_terminus_abilities = true
	sendAll("config pagelength 200", "Ab terminus", "config pagelength 60",false)
end

function haveWord(word)
	if ataxiaTables.depthswalker.abilities and ataxiaTables.depthswalker.abilities[word:lower()] then
		return true
	else
		return false
	end
end

function getAgeColour()
	local num = ataxiaTables.depthswalker.age
	local col = "DimGrey"
	if num &lt;= 250 then
		col = "DimGrey"
	elseif num &lt;= 400 then
		col = "yellow"
	elseif num &lt;= 600 then
		col = "orange"
	else
		col = "red"
	end
	return col
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<Script isActive="yes" isFolder="no">
										<name>Raid Mode Things (WIP)</name>
										<packageName></packageName>
										<script>function ataxia_raidEcho(text)
  cecho("\n&lt;a_cyan&gt;(&lt;a_magenta&gt;ataxia&lt;a_cyan&gt;): &lt;DodgerBlue&gt;"..text)
end

function ataxia_raidHelp()
  local settings = {
    ["on|off"] = "Toggle using raid mode.",
    ["fullsense"] = "Fullsense reporting to party.",
    ["mindnet"] = "Announce mindnet for enemies.",
    ["target"] = "Call out target changes.",
  }
  
  ataxia_raidEcho("The following are possible settings for 'raid mode' stuff.")
  ataxia_raidEcho("Note: announces will always call to party where applicable.")
  cecho("\n ")
  
  for setting, desc in pairs(settings) do
    if setting == "on|off" then
      cecho("\n - "..(ataxia.settings.raid.enabled and "&lt;green&gt;" or "&lt;red&gt;")..setting.."       -  &lt;LightSkyBlue&gt;"..desc)
    else
      cecho("\n - "..(ataxia.settings.raid[setting] and "&lt;green&gt;" or "&lt;red&gt;")..setting..string.rep(" ", 12-string.len(setting)).." -  &lt;LightSkyBlue&gt;"..desc)
    end
  end
  cecho("\n ")
  send(" ")
end

function ataxia_raidToggle(choice)
  if ataxia.settings.raid[choice] then
    ataxia.settings.raid[choice] = false
  else
    ataxia.settings.raid[choice] = true
  end
  ataxia_raidEcho( (ataxia.settings.raid[choice] and "&lt;green&gt;Enabled" or "&lt;red&gt;Disabled").." &lt;DodgerBlue&gt;party reporting for "..choice..".")
end

function ataxia_raidMode(option)
  if not ataxia.settings.raid then return false end
  if not ataxia.settings.raid.enabled then return false end
  
  if ataxia.settings.raid[option] then
    return true
  else
    return false
  end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Balance Timers</name>
										<packageName></packageName>
										<script>function timerOnEQUsed()
  if gmcp.Char.Vitals.eq == '0' and ataxiaEQStopwatchStarted ~= true then
    startEQTimer()
  end
end

function startEQTimer()
  ataxiaEQStopwatch = ataxiaEQStopwatch or createStopWatch()
  startStopWatch(ataxiaEQStopwatch)
  ataxiaEQStopwatchStarted = true
end

function endEQTimer()
  ataxiaEQTime = stopStopWatch(ataxiaEQStopwatch)
  resetStopWatch(ataxiaEQStopwatch)
  ataxiaEQStopwatchStarted = false
end

function EQHighlight()
etime = ataxiaEQTime or '0.000'
cecho("\n&lt;blue&gt;(((((((((((((((((((( EQUILIBRIUM:&lt;white&gt;" ..etime.. " &lt;blue&gt;))))))))))))))))))))")
end


function timerOnBalUsed()
  if gmcp.Char.Vitals.bal == '0' and ataxiaBalStopwatchStarted ~= true then
    startBalTimer()
  end
end

function startBalTimer()
  ataxiaBalStopwatch = ataxiaBalStopwatch or createStopWatch()
  startStopWatch(ataxiaBalStopwatch)
  ataxiaBalStopwatchStarted = true
end

function endBalTimer()
  ataxiaBalTime = stopStopWatch(ataxiaBalStopwatch)
  resetStopWatch(ataxiaBalStopwatch)
  ataxiaBalStopwatchStarted = false
end

function balanceHighlight()
btime = ataxiaBalTime or '0.000'
cecho("\n&lt;red&gt;(((((((((((((((((((( BALANCE: &lt;white&gt;"..btime.. " &lt;red&gt;))))))))))))))))))))")
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Set Affliction Stacks to Zero</name>
										<packageName></packageName>
										<script>function setafflictionstackslevi()
ataxia.afflictions.horror = 0
ataxia.afflictions.pyre = 0
ataxia.afflictions.unweavingspirit = 0
ataxia.afflictions.unweavingbody = 0
ataxia.afflictions.unweavingmind = 0
ataxia.afflictions.temperedsanguine = 0
ataxia.afflictions.temperedmelancholic = 0
ataxia.afflictions.temperedphlegmatic = 0
ataxia.afflictions.pressure = 0
ataxia.afflictions.crackedribs = 0
ataxia.afflictions.torntendons = 0
ataxia.afflictions.skullfractures = 0
ataxia.afflictions.wristfractures = 0
ataxia.afflictions.burns = 0
ataxia.afflictions.burning = 0
ataxia.afflictions.crescendo = 0
end



</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Misc Scripts</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Queue Scanning</name>
										<packageName></packageName>
										<script>function queue_Scan(stuff)
	instillAff = instillAff or "none"
  ataxiaTemp.hitCount = 0
	moonAff = false
  lastLimbAttack = nil
	local queueStuff = stuff
	local smallStuff = stuff:lower()
	deleteFull()
  enableTrigger("Affs Post Queue - Gated")
	
	if ataxia_isClass("monk") then
    enableTrigger("3rd Person Shikudo")
    if smallStuff:find("combo") then
      --monk_checkCombo(smallStuff)
      shikudo_findCombo(smallStuff)
    end
	end
	
	if ataxiaTemp.butchering then
		table.remove(ataxiaTemp.toButcher, 1)
		if ataxiaTemp.toButcher[1] then
			send("queue addclear free butcher "..ataxiaTemp.toButcher[1].." for reagent",false)
			ataxiaEcho(#ataxiaTemp.toButcher.." corpses left to butcher.")
		else
			ataxiaEcho("Butchering is complete!")
			ataxiaTemp.butchering = nil
		end
	end
  
  if smallStuff:find("trace") and ataxia_isClass("Pariah") then
    tempLastLogograph = smallStuff:match("trace (%w+)")
    tempTimer(0.3, [[ tempLastLogograph = nil ]] )
    if not smallStuff:find("swarm") then
      noSwarm = true
    else
      noSwarm = false
    end
  end
  
  if smallStuff:find("overcharge") then
    sylvan_overcharge = true
  end
  
	if smallStuff:find("moon") then
		local moons = {"stupidity", "masochism", "hallucinations", "hypersomnia", "confusion", "epilepsy","claustrophobia", "agoraphobia"}
		for _, aff in pairs(moons) do
			if smallStuff:find(aff) then
				moonAff = aff
				break
			end
		end
	end
	
	if ataxia_isClass("bard") then
    if smallStuff:find(ataxia.bardStuff.instrument) then
		  bardNeedRapierWield = true
    end
    if smallStuff:find("percussia") then
      ataxiaTemp.percussiaTiming = smallStuff:match("play percussia (%d+)")
    end
	end
	
	if smallStuff:find("curse") and not ataxiaBasher.enabled then
		local tar, curseAff = smallStuff:match("curse (%w+) (%w+)")
		ataxiaTemp.curse = curseConvert(curseAff)
	elseif smallStuff:find("curse") and ataxiaBasher.enabled then
		ataxiaTemp.canJinx = true
	elseif smallStuff:find("jinx") and ataxiaBasher.enabled then
		ataxiaTemp.canJinx = false
	end
	if smallStuff:find("blight") then
		local tar, curseAff = smallStuff:match("curse (%w+) (%w+)")
		ataxiaTemp.curse = curseConvert(curseAff)
	end
	if smallStuff:find("coagulation") then
		ataxiaTemp.coagulateAff = smallStuff:match("coagulation (%w+)")
	end
	if smallStuff:find("swiftcurse") then
		ataxiaTemp.swiftcurse = true
	else
		ataxiaTemp.swiftcurse = false
	end
	
	if smallStuff:find("deadeyes") and not ataxiaBasher.enabled then
		local tar, done, dtwo = smallStuff:match("deadeyes (%w+) (%w+) (%w+)")
		ataxiaTemp.deadeyesOne = curseConvert(done)
		ataxiaTemp.deadeyesTwo = curseConvert(dtwo)
	end
  
  if smallStuff:find("imbibe") then
    local imb = smallStuff:match("imbibe (%w+)")
    ataxiaTemp.imbibeAff = venom_to_aff(imb)
  end
	
	if smallStuff:find("truewrack") then
		local tar, t1, t2 = smallStuff:match("truewrack (%w+) (%w+) (%w+)")
		ataxiaTemp.truewrackOne = t1
		ataxiaTemp.truewrackTwo = t2
	elseif smallStuff:find("wrack") then
		local tar, aff = smallStuff:match("wrack (%w+) (%w+)")
		ataxiaTemp.wrackAff = aff
	end
	
	if smallStuff:find("suggest") then
		local tar, suggest = smallStuff:match("suggest (%w+) (%w+)")
		ataxiaTemp.suggestAff = suggest
	end
	
	if smallStuff:find("sketch") and runeTarget then
		if smallStuff:find("jera") then
			send("queue addclear free sketch berkana on "..runeTarget,false)
		elseif smallStuff:find("berkana") then
			send("queue addclear free sketch algiz on "..runeTarget,false)
		else
			runeTarget = nil
			ataxia_Echo("Rune sketching complete.")
		end
	end
	
	if ataxiaTemp.propagating then
		local part, prop = smallStuff:match("propagate (%w+) with (%w+)")
		ataxiaTemp.currentProps[part] = prop
		ataxia_nextPropagation()
	end
	
	if ataxiaTemp.doRepeat then
		send("queue addclear free "..ataxiaTemp.doRepeat)
	end
	
	if ataxiaTemp.repeatOffence and not ataxiaTemp.doRepeat then
		enableTrigger("Repeat Offence")
	end
end

function rTabSize(tab)
	local size = 0
	for i,v in pairs(tab) do
		size = size + 1
	end
	return size
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>System Class Functions</name>
										<packageName></packageName>
										<script>function ataxia_isClass(what)
	local x = gmcp.Char.Status.class:lower()
	local y = what:lower()

  if y == "knight" and (x == "runewarden" or x == "infernal" or x == "paladin") then
    return true
	elseif x == y then
		return true
	else
		return false
	end
end

function getClassArmour()
	local com = ""
	local armours = {
		Alchemist = "ringmail",
		Apostate = "ringmail",
		Bard = "leather",
		Blademaster = "ringmail",
		Depthswalker = "scalemail",
		Druid = "chainmail",
		Infernal = "fullplate",
		Jester = "scalemail",
		Monk = "leather",
		Occultist = "scalemail",
		Paladin = "fullplate",
		Priest = "splintmail",
		Runewarden = "fullplate",
		Sentinel = "chainmail",
		Serpent = "scalemail",
		Shaman = "scalemail",
		Sylvan = "chainmail",
    Unnamable = "fullplate",
	}
	local class = gmcp.Char.Status.class
	local race = gmcp.Char.Status.race
	if race ~= "Horkval" then
		if armours[class] then
			com = "wear "..armours[class]
		end
	end
	return com
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Box Echo</name>
										<packageName></packageName>
										<script>function ataxia_boxEcho(msg, color)
	deselect()
	local colTbl = {}
	if color then
		colTbl = string.split(color, ":")
		for k = 1,2 do
			if colTbl[k] == "" then
				colTbl[k] = nil
			end
		end
		if colTbl[2] then
			bg(colTbl[2])
		end
    end
	colTbl[1] = colTbl[1] or "red"
	fg(colTbl[1])
	local leng = ((2*string.len(msg)) + 11)
	local mes = string.upper(msg)
	echo("\n ")
	echo( string.rep("-", leng+2) )
	echo(" \n|     " .. mes .. " | " .. mes .. "     |\n ")
	echo( string.rep("-", leng+2) )
	echo(" \n")
	resetFormat()
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Retardation Management</name>
										<packageName></packageName>
										<script>--Borrowed and improved/made neater from Wundersys

function retardationOn()
  if not ataxia.retardation then
    ataxia.afflictions.aeon = true
    ataxia.retardation = true
    setRetardationSip()
    send("curing batch off",false)
    ataxia_boxEcho("Uh oh, slowcuring toggles adjusted!", "red")
    retardationDownCheck()
  end
end

function retardationOff()
  ataxia.afflictions.aeon = nil
  ataxia.retardation = false
  setNormalSip()
  send("curing batch on", false)
  ataxiaTemp.vibeSpinner = nil
  ataxia_boxEcho("Looks like we're no longer slowed", "green")
end

function setRetardationSip()
  send("curing siphealth 45", false)
  send("curing sipmana 45", false)
  send("curing mosshealth 0", false)
  send("curing mossmana 0", false)
end

function setNormalSip()
  send("curing siphealth 80", false)
  send("curing sipmana 75", false)
  send("curing mosshealth 70",false)
  send("curing mossmana 70",false)
end

function retardationDownCheck()
  if retardDropDetectionTimer then killTimer(retardDropDetectionTimer) end
  retardDropDetectionTimer = tempTimer(5, [[retardDropDetectionTimer = nil; if ataxia.retardation then retardationOff() end]])
end

function serversideRetardation(cure)
  if not affed("aeon") and not affed("blackout") then
    retardationOn()
  end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>keepAlive</name>
										<packageName></packageName>
										<script>function keepAlive()
	sendGMCP("Core.KeepAlive")
	if keepAliveTimer then
		killTimer(keepAliveTimer)
	end

	keepAliveTimer = tempTimer(120, [[keepAlive()]])	
end

keepAlive()</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Delete Full</name>
										<packageName></packageName>
										<script>function deleteFull()
 	--if deletingPrompt then killTrigger( deletingPrompt ) end
 	--deletingPrompt = tempLineTrigger(1,1,[[if not isPrompt() then 
  	--	noPromptEcho = false
  --		deletingPrompt = nil
-- 	end]])
 	deleteLine()
 	noPromptEcho = true
	
		tempLineTrigger(1,1,[[if isPrompt() then
			deleteLine()
		end
		noPromptEcho = false
	]])
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Custom Colour Table</name>
										<packageName></packageName>
										<script>color_table = {
        snow                  = {255, 250, 250},
        ghost_white           = {248, 248, 255},
        GhostWhite            = {248, 248, 255},
        white_smoke           = {245, 245, 245},
        WhiteSmoke            = {245, 245, 245},
        gainsboro             = {220, 220, 220},
        floral_white          = {255, 250, 240},
        FloralWhite           = {255, 250, 240},
        old_lace              = {253, 245, 230},
        OldLace               = {253, 245, 230},
        linen                 = {250, 240, 230},
        antique_white         = {250, 235, 215},
        AntiqueWhite          = {250, 235, 215},
        papaya_whip           = {255, 239, 213},
        PapayaWhip            = {255, 239, 213},
        blanched_almond       = {255, 235, 205},
        BlanchedAlmond        = {255, 235, 205},
        bisque                = {255, 228, 196},
        peach_puff            = {255, 218, 185},
        PeachPuff             = {255, 218, 185},
        navajo_white          = {255, 222, 173},
        NavajoWhite           = {255, 222, 173},
        moccasin              = {255, 228, 181},
        cornsilk              = {255, 248, 220},
        ivory                 = {255, 255, 240},
        lemon_chiffon         = {255, 250, 205},
        LemonChiffon          = {255, 250, 205},
        seashell              = {255, 245, 238},
        honeydew              = {240, 255, 240},
        mint_cream            = {245, 255, 250},
        MintCream             = {245, 255, 250},
        azure                 = {240, 255, 255},
        alice_blue            = {240, 248, 255},
        AliceBlue             = {240, 248, 255},
        lavender              = {230, 230, 250},
        lavender_blush        = {255, 240, 245},
        LavenderBlush         = {255, 240, 245},
        misty_rose            = {255, 228, 225},
        MistyRose             = {255, 228, 225},
        white                 = {255, 255, 255},
        black                 = {0, 0, 0},
        dark_slate_gray       = {47, 79, 79},
        DarkSlateGray         = {47, 79, 79},
        dark_slate_grey       = {47, 79, 79},
        DarkSlateGrey         = {47, 79, 79},
        dim_gray              = {105, 105, 105},
        DimGray               = {105, 105, 105},
        dim_grey              = {105, 105, 105},
        DimGrey               = {105, 105, 105},
        slate_gray            = {112, 128, 144},
        SlateGray             = {112, 128, 144},
        slate_grey            = {112, 128, 144},
        SlateGrey             = {112, 128, 144},
        light_slate_gray      = {119, 136, 153},
        LightSlateGray        = {119, 136, 153},
        light_slate_grey      = {119, 136, 153},
        LightSlateGrey        = {119, 136, 153},
        gray                  = {190, 190, 190},
        grey                  = {190, 190, 190},
        light_grey            = {211, 211, 211},
        LightGrey             = {211, 211, 211},
        light_gray            = {211, 211, 211},
        LightGray             = {211, 211, 211},
        midnight_blue         = {25, 25, 112},
        MidnightBlue          = {25, 25, 112},
        navy                  = {0, 0, 128},
        navy_blue             = {0, 0, 128},
        NavyBlue              = {0, 0, 128},
        cornflower_blue       = {100, 149, 237},
        CornflowerBlue        = {100, 149, 237},
        dark_slate_blue       = {72, 61, 139},
        DarkSlateBlue         = {72, 61, 139},
        slate_blue            = {106, 90, 205},
        SlateBlue             = {106, 90, 205},
        medium_slate_blue     = {123, 104, 238},
        MediumSlateBlue       = {123, 104, 238},
        light_slate_blue      = {132, 112, 255},
        LightSlateBlue        = {132, 112, 255},
        medium_blue           = {0, 0, 205},
        MediumBlue            = {0, 0, 205},
        royal_blue            = {65, 105, 225},
        RoyalBlue             = {65, 105, 225},
        blue                  = {0, 0, 255},
        dodger_blue           = {30, 144, 255},
        DodgerBlue            = {30, 144, 255},
        deep_sky_blue         = {0, 191, 255},
        DeepSkyBlue           = {0, 191, 255},
        sky_blue              = {135, 206, 235},
        SkyBlue               = {135, 206, 235},
        light_sky_blue        = {135, 206, 250},
        LightSkyBlue          = {135, 206, 250},
        steel_blue            = {70, 130, 180},
        SteelBlue             = {70, 130, 180},
        light_steel_blue      = {176, 196, 222},
        LightSteelBlue        = {176, 196, 222},
        light_blue            = {173, 216, 230},
        LightBlue             = {173, 216, 230},
        powder_blue           = {176, 224, 230},
        PowderBlue            = {176, 224, 230},
        pale_turquoise        = {175, 238, 238},
        PaleTurquoise         = {175, 238, 238},
        dark_turquoise        = {0, 206, 209},
        DarkTurquoise         = {0, 206, 209},
        medium_turquoise      = {72, 209, 204},
        MediumTurquoise       = {72, 209, 204},
        turquoise             = {64, 224, 208},
        cyan                  = {0, 255, 255},
        light_cyan            = {224, 255, 255},
        LightCyan             = {224, 255, 255},
        cadet_blue            = {95, 158, 160},
        CadetBlue             = {95, 158, 160},
        medium_aquamarine     = {102, 205, 170},
        MediumAquamarine      = {102, 205, 170},
        aquamarine            = {127, 255, 212},
        dark_green            = {0, 100, 0},
        DarkGreen             = {0, 100, 0},
        dark_olive_green      = {85, 107, 47},
        DarkOliveGreen        = {85, 107, 47},
        dark_sea_green        = {143, 188, 143},
        DarkSeaGreen          = {143, 188, 143},
        sea_green             = {46, 139, 87},
        SeaGreen              = {46, 139, 87},
        medium_sea_green      = {60, 179, 113},
        MediumSeaGreen        = {60, 179, 113},
        light_sea_green       = {32, 178, 170},
        LightSeaGreen         = {32, 178, 170},
        pale_green            = {152, 251, 152},
        PaleGreen             = {152, 251, 152},
        spring_green          = {0, 255, 127},
        SpringGreen           = {0, 255, 127},
        lawn_green            = {124, 252, 0},
        LawnGreen             = {124, 252, 0},
        green                 = {0, 255, 0},
        chartreuse            = {127, 255, 0},
        MediumSpringGreen     = {0, 250, 154},
        green_yellow          = {173, 255, 47},
        GreenYellow           = {173, 255, 47},
        lime_green            = {50, 205, 50},
        LimeGreen             = {50, 205, 50},
        yellow_green          = {154, 205, 50},
        YellowGreen           = {154, 205, 50},
        forest_green          = {34, 139, 34},
        ForestGreen           = {34, 139, 34},
        olive_drab            = {107, 142, 35},
        OliveDrab             = {107, 142, 35},
        dark_khaki            = {189, 183, 107},
        DarkKhaki             = {189, 183, 107},
        khaki                 = {240, 230, 140},
        pale_goldenrod        = {238, 232, 170},
        PaleGoldenrod         = {238, 232, 170},
        light_yellow          = {255, 255, 224},
        LightYellow           = {255, 255, 224},
        yellow                = {255, 255, 0},
        gold                  = {255, 215, 0},
        light_goldenrod       = {238, 221, 130},
        LightGoldenrod        = {238, 221, 130},
        goldenrod             = {218, 165, 32},
        dark_goldenrod        = {184, 134, 11},
        DarkGoldenrod         = {184, 134, 11},
        rosy_brown            = {188, 143, 143},
        RosyBrown             = {188, 143, 143},
        indian_red            = {205, 92, 92},
        IndianRed             = {205, 92, 92},
        saddle_brown          = {139, 69, 19},
        SaddleBrown           = {139, 69, 19},
        sienna                = {160, 82, 45},
        peru                  = {205, 133, 63},
        burlywood             = {222, 184, 135},
        beige                 = {245, 245, 220},
        wheat                 = {245, 222, 179},
        sandy_brown           = {244, 164, 96},
        SandyBrown            = {244, 164, 96},
        tan                   = {210, 180, 140},
        chocolate             = {210, 105, 30},
        firebrick             = {178, 34, 34},
        brown                 = {165, 42, 42},
        dark_salmon           = {233, 150, 122},
        DarkSalmon            = {233, 150, 122},
        salmon                = {250, 128, 114},
        light_salmon          = {255, 160, 122},
        LightSalmon           = {255, 160, 122},
        orange                = {255, 165, 0},
        dark_orange           = {255, 140, 0},
        DarkOrange            = {255, 140, 0},
        coral                 = {255, 127, 80},
        light_coral           = {240, 128, 128},
        LightCoral            = {240, 128, 128},
        tomato                = {255, 99, 71},
        orange_red            = {255, 69, 0},
        OrangeRed             = {255, 69, 0},
        red                   = {255, 0, 0},
        hot_pink              = {255, 105, 180},
        HotPink               = {255, 105, 180},
        deep_pink             = {255, 20, 147},
        DeepPink              = {255, 20, 147},
        pink                  = {255, 192, 203},
        light_pink            = {255, 182, 193},
        LightPink             = {255, 182, 193},
        pale_violet_red       = {219, 112, 147},
        PaleVioletRed         = {219, 112, 147},
        maroon                = {176, 48, 96},
        medium_violet_red     = {199, 21, 133},
        MediumVioletRed       = {199, 21, 133},
        violet_red            = {208, 32, 144},
        VioletRed             = {208, 32, 144},
        magenta               = {255, 0, 255},
        violet                = {238, 130, 238},
        plum                  = {221, 160, 221},
        orchid                = {218, 112, 214},
        medium_orchid         = {186, 85, 211},
        MediumOrchid          = {186, 85, 211},
        dark_orchid           = {153, 50, 204},
        DarkOrchid            = {153, 50, 204},
        dark_violet           = {148, 0, 211},
        DarkViolet            = {148, 0, 211},
        blue_violet           = {138, 43, 226},
        BlueViolet            = {138, 43, 226},
        purple                = {160, 32, 240},
        medium_purple         = {147, 112, 219},
        MediumPurple          = {147, 112, 219},
        thistle               = {216, 191, 216},

        a_darkred             = {128, 0, 0},
        a_darkgreen           = {0, 179, 0},
        a_brown               = {128, 128, 0},
        a_darkblue            = {0, 0, 128},
        a_darkmagenta         = {128, 0, 128},
        a_darkcyan            = {0, 128, 128},
        a_grey                = {192, 192, 192},
        a_darkgrey            = {128, 128, 128},
        a_red                 = {255, 0, 0},
        a_green               = {0, 255, 0},
        a_yellow              = {255, 255, 0},
        a_blue                = {0, 85, 255},
        a_magenta             = {255, 0, 255},
        a_cyan                = {0, 255, 255},
		a_white               = {255, 255, 255},

		chat_bg 				 = {25, 25, 25},
}

function fgcolor(color)
	setFgColor(color_table[color][1], color_table[color][2], color_table[color][3])
end

function bgcolor(color)
	setBgColor(color_table[color][1], color_table[color][2], color_table[color][3])
end

function cfgcolor(console, color)
	setFgColor(console, color_table[color][1], color_table[color][2], color_table[color][3])
end

function cbgcolor(console, color)
	setBgColor(console, color_table[color][1], color_table[color][2], color_table[color][3])
end

--function showColours(num)
	--cecho("\n&lt;green&gt; Showing a list of available colours, with "..num.." columns: \n")
	--local lineBreak = num
	--local linecount = 0
	--local padding = math.floor(90/num)
	
	--for col, tab in pairs(color_table) do
		--linecount = linecount + 1
		--cecho(string.rep(" ", padding-#col).."&lt;"..col.."&gt;"..col.."&lt;NavajoWhite&gt;,")
		--if linecount &gt;= lineBreak then
			--echo("\n")
			--linecount = 0
		--end
	--end
--end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Ab Cheat</name>
										<packageName></packageName>
										<script>abcheat = abcheat or {}
 
abcheat.doab = false
 
abcheat.ab = function(group, name)
        if not name then
                sendGMCP([[Char.Skills.Get {"group" : "]] .. group .. [["}]])
        else
                sendGMCP([[Char.Skills.Get {"group" : "]] .. group .. [[", "name" : "]] .. name .. [["}]])
        end
        abcheat.doab = true
        send("\n", false)
end
 
abcheat.list = function()
        if not abcheat.doab then return end
        abcheat.doab = false
        local abs = gmcp.Char.Skills.List.list
        local descs = gmcp.Char.Skills.List.descs
        local n = 21--4 + abcheat.longest(abs)
        for i, ab in ipairs(abs) do
                echo(ab .. string.rep(" ", n - #ab) .. descs[i] .. "\n")
        end
end
 
abcheat.longest = function(abs)
        local l = 0
        for _, ab in ipairs(abs) do
                if l &lt; #ab then l = #ab end
        end
        return l
end
 
abcheat.info = function()
        if not abcheat.doab then return end
        abcheat.doab = false
        echo(gmcp.Char.Skills.Info.info)
end
 
registerAnonymousEventHandler("gmcp.Char.Skills.List", "abcheat.list")
 
registerAnonymousEventHandler("gmcp.Char.Skills.Info", "abcheat.info")</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Deepcopy</name>
										<packageName></packageName>
										<script>function deepcopy(orig)
    local orig_type = type(orig)
    local copy
    if orig_type == 'table' then
        copy = {}
        for orig_key, orig_value in next, orig, nil do
            copy[deepcopy(orig_key)] = deepcopy(orig_value)
        end
        setmetatable(copy, deepcopy(getmetatable(orig)))
    else -- number, string, boolean, etc
        copy = orig
    end
    return copy
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Uncategorised Functions</name>
										<packageName></packageName>
										<script>function math.round(number, decimals) 
    decimals = decimals or 0 
    return tonumber(("%."..decimals.."f"):format(number))
end

-- Update the warning text kept by the @warning prompt tag

ataxiaTemp.warningText = ""

function ataxia_setWarning(message, duration)
  ataxiaTemp.warningText = "&lt;a_blue&gt;( &lt;red&gt;" .. message .. " &lt;a_blue&gt;) "
  if ataxiaTemp.warningTimer then killTimer(ataxiaTemp.warningTimer) end
  ataxiaTemp.warningTimer = tempTimer(duration, [[ataxiaTemp.warningTimer = nil; ataxiaTemp.warningText = ""]])
  
  ataxiaBasher_alert("Normal")

end

function ataxia_paused()
  if ataxia.settings.paused then
    return true
  else
    return false
  end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Ping/Latency measuring</name>
										<packageName></packageName>
										<script>local pingCalculation = pingCalculation or {}

--Calculate average ping.
function ataxia_getPing()
  local x, y = #pingCalculation, 0
  for i, p in pairs(pingCalculation) do
    y = y + p
  end
  return y/x
end

function ataxia_pingCheck()
  table.insert(pingCalculation, 1, getNetworkLatency())
  if #pingCalculation &gt; 15 then
    table.remove(pingCalculation, 16)
  end
end

registerAnonymousEventHandler("sysDataSendRequest", "ataxia_pingCheck")</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Directions</name>
										<packageName></packageName>
										<script>function dir_toShort(dir)
  local directions = {
    n = "north",
    ne = "northeast",
    e = "east",
    se = "southeast",
    s = "south",
    sw = "southwest",
    w = "west",
    nw = "northwest",
    u = "up",
    d = "down",
    ["in"] = "in",
    ["out"] = "out",
  }
  for short, long in pairs(directions) do
    if long == dir then
      return short
    end
  end
  return "???"
end

function dir_toLong(dir)
  local directions = {
    n = "north",
    ne = "northeast",
    e = "east",
    se = "southeast",
    s = "south",
    sw = "southwest",
    w = "west",
    nw = "northwest",
    u = "up",
    d = "down",
    ["in"] = "in",
    ["out"] = "out",
  }
  return (directions[dir] and directions[dir] or "???")
end</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Combat</name>
									<packageName></packageName>
									<script>function calculateDictate(mana)
	local dicAff = {"shadowmadness", "parasite", "retribution", "depression"}
	local c = 0
	local dictPos = 40
	for _,aff in pairs(dicAff) do
		if haveAff(aff) then
			c = c + 1
		end
	end
	if c &gt; 0 then c = (c*5) end
	dictPos = dictPos + c

	if mana &lt;= dictPos then
		cecho("&lt;NavajoWhite&gt; [&lt;blue&gt;"..mana.."%&lt;NavajoWhite&gt;|&lt;LightSkyBlue&gt;"..dictPos.."%&lt;NavajoWhite&gt;]")
		ataxia_boxEcho(string.upper(target).." CAN BE DICTATED", "black:DodgerBlue")
	else
		cecho("&lt;NavajoWhite&gt; [&lt;blue&gt;"..mana.."%&lt;NavajoWhite&gt;|&lt;LightSkyBlue&gt;"..dictPos.."%&lt;NavajoWhite&gt;]")
	end
end

function depressionCount()
	local depAff = {"depression", "nausea", "hypochondria"}
	local c = 0
	for _, aff in pairs(depAff) do
		if haveAff(aff) then
			c = c + 1
		end
	end
	return c
end

function targetAffCount()
	local ignore = {"curseward", "prone", "blindness", "deafness", "rebounding", "shield", "hierophant", "worms"}
	local c = 0
	for i,v in pairs(tAffs) do
		if not table.contains(ignore, i) then
			if v == true then
				c = c + 1
			end
		end
	end
	return c
end</script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Targeting Functions</name>
										<packageName></packageName>
										<script>function switchTarget(who)
	local tName = who
	possible_targets = ataxiaTemp.enemies

	local found_target = false
  if who ~= target then ataxia_resetLimbTable() end
	if ataxia.playersHere then
		for i,v in pairs(ataxia.playersHere) do
			if string.find(v, tName) then
				target = v
				found_target = true
				break
			end
		end				
	end

	for i,v in pairs(possible_targets) do
		if v == tName and not found_target then
			target = v
			found_target = true				
			break									
		end
	end

	if not found_target then						
		for i,v in pairs(possible_targets) do 	
			if string.find(v, tName) and not found_target then
				target = v
				found_target = true					
				break									
			end
		end
	end

	if not found_target then							
		target = tName
	end
	target = matches[2]
  if type(target) ~= "number" then
  target = matches[2]:lower():title()
  --target = matches[2]
  end
	ataxiaEcho("Target acquired. Focusing fire on &lt;white&gt;"..target.."!")
	send("unally "..target..ataxia.settings.separator.."enemy "..target..ataxia.settings.separator.."st "..target)
  send("settarget " ..target)
  --expandAlias("t " ..target)
  setafflictionstackslevi()
  php = 100
  pm = 100
  tburns = 0
  tAffs.burns = 0
  tarpreapply = false
  tAffs.rebounding = false
  tAffs.shield = false
  tAffs.curseward = false
  falconattack = false
  preventriftlock = false
  tdeliverance = false
  tBals.passive = true
  pariah.burrow = false
  taccelerates = 0
  tAffs.criticalspirit = false
  tAffs.criticalmind = false
  tAffs.criticalbody = false
  pdeconstruct = false
  mindinvert = false
  bodyinvert = false
  spiritinvert = false
  inverted = false
  lightbind = false
  
  
	if target_calling then send("pt Target: "..target) end

  targetresetafflictionslevi()
  tBals = {tree = true, focus = true, plant = true, salve = true, timers = {}, passive = true}
	ataxiaTemp.bleeding = 0
	if ataxia_isClass("magi") then
		magi_resetLimbs()
	else
		tLimbs = {H=0, T=0, RL=0, LL=0, RA=0, LA=0}
	end
	readAuraAffs = { count = 0, list = {} }
	if ataxia_isClass("sentinel") then sAnimals = sAnimals or {} end
	if ataxia_isClass("serpent") then ataxiaTemp.suggestions = nil end
	if ataxia_isClass("priest") then ataxiaTemp.prayerList = nil end
  if ataxia_isClass("pariah") then
    ataxia_resetPariah() 
  end
  if string.find(ataxiaTemp.class, "fire") then ataxiaTemp.firelord = {} end
  twohanded_resetFractures()
  twohanded_resetFractures()
  
if gmcp.Char.Status.class == "Infernal" then
  send("order hyena passive")
end
if gmcp.Char.Status.class == "Runewarden" then
  send("order falcon passive")
end
  ataxiaTemp.lastLimbHit = "none"
  ataxiaTemp.parriedLimb = "none"
  affTimers = {}
	tLimbs.BP = tLimbs.BP or 100
  disableTimer("Battlefury Perceive") 
	raiseEvent("changed target")
  
  
  if zgui and zgui.showTarAffs then
    zgui.showTarAffs()
  end
end

function ataxia_needReject()
	if not ataxia.settings.lustlist then return false end
	if not ataxia.lustedto then return false end
	
	local need = false
	ataxia.reject = nil
	for i=1, #ataxia.lustedto do
		if not table.contains(ataxia.settings.lustlist, ataxia.lustedto[i]) then
			ataxiaTemp.reject = ataxia.lustedto[i]
			need = true
			break
		end
	end
	return need
end


--type(target) == "number"
function isTargeted(who)
if type(target) ~= "number" then
  local x,y = who:lower(), target:lower()
  if string.starts(x,y) or string.starts(y,x) or x == y then
    if x ~= y then
      updateTarget(x)
    end
    return true
  else
    return false
  end
end

end

function updateTarget(name)
if type(target) ~= "number" then
  target = name:title()
  ataxiaEcho("Updated target full name to: "..target..".")
  if tar_upper then killTrigger(tar_upper) end
  tar_upper = tempTrigger(target, [[ local c = 1
      while selectString("]] .. target .. [[",c) &gt; -1 do
      fg("DarkOrchid")
      c = c + 1
    end
    resetFormat()
  ]])

  if tar_lower then killTrigger(tar_lower) end
  tar_lower = tempTrigger(target:lower(), [[ local c = 1
      while selectString("]] .. target:lower() .. [[",c) &gt; -1 do
      fg("DarkOrchid")
      c = c + 1
    end
    resetFormat()
  ]])
end
end

function switchtargetnext()



	possible_targets = table.n_intersection(ataxiaTemp.enemies, ataxia.playersHere)
  possible_targets[1] = possible_targets[1] or target
	

	local found_target = false
	if ataxia.playersHere then
  if table.contains(ataxia.playersHere, target) then
  found_target = true

  end
  end

  if not found_target then
	if possible_targets then
  expandAlias("t "..possible_targets[1])
  found_target = true
    if partyrelay and not ataxia.afflictions.aeon then
      send("pt TARGET LEFT ROOM, now switching to "..target)
    end
  end
  end
  
	if not found_target then							
		target = target
	end
end

function switchtarget()

	possible_targets = table.n_intersection(ataxiaTemp.enemies, ataxia.playersHere)
  --possible_targets[1] = possible_targets[1] or target
	

	local found_target = false
	if ataxia.playersHere then
  send("ql")
  if table.contains(ataxia.playersHere, possible_targets[1]) then
  found_target = true

  end
  end

  if found_target then
	
  expandAlias("t "..possible_targets[1])
  found_target = true
      send("pt SWITCHING TARGET to "..target)
  end
  
  
	if not found_target then							
		target = target
	end
end

function targetresetafflictionslevi()
tAffs = {
blindness = true, 
deafness = true, 
shield = false, 
rebounding = false, 
curseward = false,
addiction = false,
aeon = false,
agoraphobia = false,
airfisted = false,
amnesia = false,
anorexia = false,
asphyxiating = false,
asthma = false,
blackout = false,
blistered = false,
bloodfire = false,
bound = false,
brokenleftarm = false,
brokenleftleg = false,
brokenrightarm = false,
brokenrightleg = false,
bruisedribs = false,
burning = false,
cadmuscurse = false,
calcifiedskull = false,
calcifiedtorso = false,
claustrophobia = false,
clumsiness = false,
coldfate = false,
concussion = false,
condemned = false,
conflagration = false,
confusion = false,
constricted = false,
convergence = false,
corruption = false,
crackedribs = false,
cremated = false,
crescendo = false,
crushedthroat = false,
daeggerimpale = false,
damagedhead = false,
damagedleftarm = false,
damagedleftleg = false,
damagedrightarm = false,
damagedrightleg = false,
darkshade = false,
dazed = false,
dazzled = false,
deadening = false,
deathsickness = false,
deepsleep = false,
degenerate = false,
dehydrated = false,
dementia = false,
demonstain = false,
depression = false,
deteriorate = false,
diminished = false,
disloyalty = false,
disrupted = false,
dissonance = false,
dizziness = false,
earworm = false,
empoweredloshre = false,
empoweredmannaz = false,
enlightenment = false,
enmesh = false,
ensorcelled = false,
entangled = false,
epilepsy = false,
fear = false,
flamefisted = false,
flushings = false,
frostbite = false,
frozen = false,
fulminated = false,
generosity = false,
grievouswounds = false,
guilt = false,
haemophilia = false,
hallucinations = false,
hamstrung = false,
hatred = false,
healthleech = false,
heartseed = false,
hecatecurse = false,
hellsight = false,
hindered = false,
homunculusmercury = false,
horror = false,
hypersomnia = false,
hypochondria = false,
hypothermia = false,
icefisted = false,
impaled = false,
impatience = false,
indifference = false,
inquisition = false,
insomnia = false,
internalbleeding = false,
isolation = false,
itching = false,
justice = false,
kaisurge = false,
kkractlebrand = false,
laceratedthroat = false,
lapsingconsciousness = false,
latched = false,
lethargy = false,
lightbind = false,
loneliness = false,
lovers = false,
manaleech = false,
mangledhead = false,
mangledleftarm = false,
mangledleftleg = false,
mangledrightarm = false,
mangledrightleg = false,
masochism = false,
mildtrauma = false,
mindclamp = false,
mindravaged = false,
muddled = false, 
mycalium = false, 
nausea = false, 
numbedleftarm = false, 
numbedrightarm = false, 
pacified = false,
palpatarfeed = false, 
paralysis = false, 
paranoia = false,
parasite = false,
peace = false,
penitence = false,
petrified = false,
phlogisticated = false,
pinshot = false,
pressure = false,
prone = false,
pyramides = false,
pyre = false,
rebbies = false,
recklessness = false,
retribution = false,
revealed = false,
sandfever = false,
scalded = false,
scrambledbrains = false,
scytherus = false,
selarnia = false,
sensitivity = false,
serioustrauma = false,
shadowmadness = false,
shivering = false,
shyness = false,
silenced = false,
silver = false,
skullfractures = false,
slashedthroat = false,
sleeping = false,
slickness = false,
slimeobscure = false,
snared = false,
solarburn = false,
spiritburn = false,
stridulating = false,
stupidity = false,
stuttering = false,
temperedcholeric = false, 
temperedmelancholic = false, 
temperedphlegmatic = false, 
temperedsanguine = false, 
tenderskin = false, 
tension = false, 
timeflux = false, 
timeloop = false, 
tonguetied = false, 
torntendons = false, 
transfixation = false, 
trueblind = false, 
unconsciousness = false, 
unweavingbody = false, 
unweavingmind = false, 
unweavingspirit = false, 
vertigo = false, 
vinewreathed = false,
vitiated = false, 
vitrified = false, 
voidfisted = false, 
voyria = false, 
waterbonds = false, 
weakenedmind = false, 
weariness = false, 
webbed = false,
whisperingmadness = false, 
wristfractures = false,
}
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Affliction Management</name>
										<packageName></packageName>
										<script>function unnamableHorrorSet()
  tAffs.horror = tAffs.horror or 1
  
	local cstring = "&lt;sienna&gt;[&lt;tomato&gt;hor&lt;NavajoWhite&gt;"..tAffs.horror.."&lt;sienna&gt;] "
  cinsertText(cstring)
end

function unnamableHorrorRaise()
  tAffs.horror = tAffs.horror or 0
  tAffs.horror = tAffs.horror + 1
  
  if tAffs.horror &gt; 5 then tAffs.horror = 5 end
  
  local hlset = ataxia.settings.affhl	
	local cstring = "&lt;sienna&gt;[&lt;tomato&gt;hor&lt;NavajoWhite&gt;"..tAffs.horror.."&lt;sienna&gt;] "
  cinsertText(cstring)
end

function unnamableHorrorLower()
  if tAffs.horror &gt;= 3 then
    tAffs.horror = tAffs.horror - 2
  else
    tAffs.horror = tAffs.horror - 1
  end
  if tAffs.horror &lt; 1 then
    cecho("\n&lt;red&gt; -= horror cured completely =-")
    tAffs.horror = nil
  else
    cecho("\n&lt;green&gt; -= horror at "..tAffs.horror.." =-")
  end
end

function tarZealHit(aff)
	if not affs_to_colour then populate_aff_colours() end
	
	local cstring = "&lt;maroon&gt;["
	
	cstring = cstring.."&lt;"..affs_to_colour[aff][1].."&gt;"..affs_to_colour[aff][2]:upper()
	cstring = cstring.."&lt;maroon&gt;] &lt;reset&gt;"..target.." afflicted with "..aff.."."
	deleteLine()
	cecho("\n"..cstring)

	tAffs[aff] = true
	
	if ataxiaTemp.showingAffs then
		displayTargetAffs()
	end
end

function tarGained(event, affList )
	if not affs_to_colour then populate_aff_colours() end
  local hlset = ataxia.settings.affhl	
	local cstring = ""
	
	if event == "tar afflicted" then
		for num, aff in pairs(affList) do
			if affs_to_colour[aff] then
				cstring = cstring.."&lt;"..affs_to_colour[aff][1].."&gt;"..affs_to_colour[aff][2]:upper()
			else
				cstring = cstring.."&lt;white&gt;"..string.sub(aff, 1, 3):upper()
			end
			if num ~= #affList then cstring = cstring.."&lt;maroon&gt;|" end
		end
    
    if hlset == "default" then
      cstring = "&lt;maroon&gt;["..cstring.."&lt;maroon&gt;] "
    elseif hlset == "bar" then
      cstring = cstring.."| "
    else
      cstring = cstring..": "
    end
		cinsertText(cstring)
	end
	
	if ataxiaTemp.showingAffs then
		displayTargetAffs()
  elseif zgui then
    zgui.showTarAffs()
	end
end
registerAnonymousEventHandler("tar afflicted", "tarGained")

function erAff(what)
	if tAffs[what] then
    if what == "haemophilia" then
      tAffs.bleed = 0
      tAffs.bleeding = 0
    elseif what == "crescendo" then
			tAffs.crescendo = 0
	 else
		  tAffs[what] = false
    end
  affTimers[what] = false
	end

	if ataxiaTemp.repeatOffence and not ataxiaTemp.doRepeat then
		enableTrigger("Repeat Offence")
	end
	
	if ataxiaTemp.showingAffs then
		displayTargetAffs()
  elseif zgui then
    zgui.showTarAffs()
	end
	
	if ataxiaTemp.class == "Occultist" and readAuraAffs and readAuraAffs.count then
		readAuraAffs.count = readAuraAffs.count - 1
	end
  raiseEvent("target cured aff", what)	
end

function haveAff(what)
	if tAffs and tAffs[what] then
		return true
	else
		return false
	end
end

function tarAffed(...)
  local affs = arg
  local added = {}
  
  for _, aff in pairs(affs) do
    if type(aff) ~= "number" then
      if aff == "sensitivity" then
        if tAffs.deafness then
          tAffs.deafness = false
          table.insert(added, "nodeaf")
        else
          tAffs.sensitivity = true
          table.insert(added, "sensitivity")
          
          affTimers.sensitivity = getEpoch()
        end
      elseif aff == "burns" or aff == "burn" then
        pali_addBurns()
      elseif aff == "pyre" or aff == "pyre" then
        pali_addPyre()
      else
        tAffs[aff] = true
        table.insert(added, aff)
        affTimers[aff] = getEpoch()
      end
    end
  end
  if not table.contains(affs, "burn") and not table.contains(affs, "burns") then
    raiseEvent("tar afflicted", added)
    checkTargetLocks()
  end
end

function addAffList(affTable)
  if type(affTable) ~= "table" then return end
  local affs = affTable
  local added = {}
  
  for _, aff in pairs(affs) do
    if type(aff) ~= "number" then
      if aff == "sensitivity" then
        if tAffs.deafness then
          tAffs.deafness = false
          table.insert(added, "nodeaf")
        else
          tAffs.sensitivity = true
          table.insert(added, "sensitivity")
          affTimers.sensitivity = getEpoch()
        end
      elseif aff == "burns" or aff == "burn" then
        magi_addBurns()
      else
        tAffs[aff] = true
        table.insert(added, aff)
        affTimers[aff] = getEpoch()
      end
    end
  end
  if not table.contains(affs, "burn") and not table.contains(affs, "burns") then
    raiseEvent("tar afflicted", added)
    checkTargetLocks()
  end
end

function tarSingleAff(what)
	local aff = what
	if what == "sensitivity" then
		if tAffs.deafness then
			aff = "nodeaf"
			tAffs.deafness = false
		else
			tAffs.sensitivity = true
		end
	elseif what == "burns" or what == "burn" then
		magi_addBurns()
	elseif not tAffs[what] then
		tAffs[what] = true
	end
	
	if what ~= "burns" and what ~= "burn" then
		local affs = { aff }	
		raiseEvent("tar afflicted", affs)	
		checkTargetLocks()
	end
end

function tarDoubleAff(affone, afftwo)
	if not affs_to_colour then populate_aff_colours() end
	if affone == "sensitivity" then
		if tAffs.deafness then
			affone = "nodeaf"
			tAffs.deafness = false
		else
			tAffs.sensitivity = true
		end
	else
		tAffs[affone] = true
	end
	
	if afftwo == "sensitivity" then
		if tAffs.deafness then
			afftwo = "nodeaf"
			tAffs.deafness = false
		else
			tAffs.sensitivity = true
		end
	else
		tAffs[afftwo] = true
	end

	local affs = { affone, afftwo }	
	raiseEvent("tar afflicted", affs)	
	checkTargetLocks()
end

function tarTripleAff(affone, afftwo, affthree)
	if not tAffs[affone] then
		tAffs[affone] = true
	end
	if not tAffs[afftwo] then
		tAffs[afftwo] = true
	end
	if not tAffs[affthree] then
		tAffs[affthree] = true
	end

	local affs = { affone, afftwo, affthree }	
	raiseEvent("tar afflicted", affs)	
	checkTargetLocks()
end

function tarBonusAff(aff)
	if not affs_to_colour then populate_aff_colours() end
	tAffs[aff] = true
	cecho("&lt;NavajoWhite&gt; +&lt;"..affs_to_colour[aff][1].."&gt;"..affs_to_colour[aff][2]:upper().."&lt;NavajoWhite&gt;+")
end

function displayTargetAffs()
	ataxiagui.tarAffsConsole:clear()
	ataxiagui.tarAffsConsole:setFontSize(8)
	ataxiagui.tarAffsConsole:setWrap(36)
	
	local ignoreAffs = {"curseward", "blindness", "deafness", "rebounding", "shield"}
	local str = "&lt;a_brown&gt;[&lt;NavajoWhite&gt;"..target:title().."&lt;a_brown&gt;]: "
	for aff, boo in pairs(tAffs) do
		if boo ~= false and not table.contains(ignoreAffs, aff) then
			if affs_to_colour[aff] then
				str = str.."&lt;"..affs_to_colour[aff][1].."&gt;"..affs_to_colour[aff][2].." "
			else
				str = str.."&lt;DimGrey&gt;"..string.sub(aff, 1, 3).." "
			end	
		end
	end
	
	ataxiagui.tarAffsConsole:cecho(str)
end</script>
										<eventHandlerList />
									</Script>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Curing</name>
										<packageName></packageName>
										<script>curingTable = {
	goldenseal = {"depression", "sandfever", "stupidity", "epilepsy", "dizziness", "dissonance", "shyness", "impatience", "unweavingmind", "fulminated"},
	lobelia = {"recklessness", "vertigo", "spiritburn", "tenderskin", "loneliness", "claustrophobia", "masochism", "agoraphobia"},
	bellwort = {"timeloop", "justice", "lovers", "peace", "pacified", "generosity", "indifference","diminished"},
	kelp = {"hypochondria", "parasite", "weariness",  "asthma", "healthleech", "clumsiness", "sensitivity"},
	ash = {"confusion", "hypersomnia", "hallucinations", "paranoia", "dementia","crescendo",},
	ginseng = {"flushings", "lethargy", "haemophilia", "addiction", "nausea", "scytherus", "darkshade", "unweavingbody"},
}

function haveSmokeAff()
	local smoke = false
	local sAffs = {"deadening", "tension",
		"disloyalty", "hellsight", "manaleech", "slickness", "unweavingspirit","earworm",}
    
	for i=1, #sAffs do
		if haveAff(sAffs[i]) then
			smoke = true
			break
		end
	end
	
	return smoke
end

function hasSalveAff()
  local salve = false
  local sAffs = {"frozen", "shivering", "anorexia", "burns", "ablaze", "selarnia",
    "damagedleftleg", "damagedrightleg", "mangledleftleg", "mangledrightleg",
    "damagedleftarm", "damagedrightarm", "mangledleftarm", "mangledrightarm",
    "brokenleftarm", "brokenrightarm", "brokenleftleg", "brokenrightleg", "hypothermia"}
    
  for i=1, #sAffs do
    if haveAff(sAffs[i]) then
      salve = true
      break
    end
  end
  
  return salve
end

function restorePassiveCure()
  cecho("\n&lt;green&gt;+ "..passiveFailsafe.." +")
  tAffs[passiveFailsafe] = true
  passiveFailsafe = nil
end

</script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>Herbs</name>
											<packageName></packageName>
											<script>function taTempers()
	if tAffs.anorexia then erAff("anorexia") end
  predictBal("herb", 1.55)	
	local temper = {"melancholic", "sanguine", "phlegmatic", "choleric"}
	local highest = ""
	local highest_value = 0
	local tied = {}

	for i=1, #temper do
		if tAffs[temper[i]] and tAffs[temper[i]] &gt; highest_value then
			highest = temper[i]
			highest_value = tAffs[temper[i]]
			tied = { temper[i] }
		elseif tAffs[temper[i]] and tAffs[temper[i]] == highest_value then
			table.insert(tied, temper[i])
		end
	end
	
	if highest_value &gt; 0 and #tied == 1 then
		highest = tied[1]
	elseif highest_value &gt; 0 and #tied &gt; 1 then
		highest = tied[math.random(1, #tied)]
	end
	
	if highest ~= "" then
		tAffs[highest] = tAffs[highest] - 1
		if tAffs[highest] == 0 or tAffs[highest] &lt; 0 then
			tAffs[highest] = nil
		end
	end
end

function targetAte(herb)
	if tAffs.anorexia then erAff("anorexia") end
	for i=1, #curingTable[herb] do
		if haveAff(curingTable[herb][i]) then	
			if herb == "goldenseal" and curingTable[herb][i] ~= "impatience" then
				if haveAff("impatience") then
					lastGoldenseal = curingTable[herb][i]
					tempTimer(1, [[lastGoldenseal = nil]])
				end
			elseif herb == "ginseng" and curingTable[herb][i] == "haemophilia" then
				tAffs.bleed = 0
			elseif herb == "kelp" and haveAff("asthma") and haveSmokeAff() then
				lastKelp = curingTable[herb][i]
				tempTimer(0.4, [[ restoreLastKelp() ]])
			end
			erAff(curingTable[herb][i])
			break
		end
	end
  predictBal("herb", 1.55)	
end

function flushingsProc()
	if tAffs.anorexia then erAff("anorexia") end
  local fl = {"lethargy", "haemophilia", "addiction", "nausea", "scytherus", "darkshade"}
	for i=1, #fl do
		if haveAff(fl[i]) then	
			if fl[i] == "haemophilia" then
				tAffs.bleed = 0
      end
			erAff(fl[i])
			break
		end
	end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Wide Groups</name>
											<packageName></packageName>
											<script>function taRaged()
	if tAffs.retribution then erAff("retribution") end
	local gAffs = {"timeloop", "justice", "lovers", "peace", "pacified", "generosity", "indifference",}
	for i=1, #gAffs do
		if tAffs[gAffs[i]] then
			erAff(gAffs[i])
			break
		end
	end
end

function tFocused()
	local gAffs = {"stuttering", "stupidity", "recklessness", "hallucinations", "epilepsy", "confusion", "dizziness", "vertigo", "anorexia",  
		"earthdisrupt", "masochism", "agoraphobia", "airdisrupt", "claustrophobia", "dementia", "firedisrupt", "generosity", "loneliness", "lovers", 
		"pacified", "paranoia", "shyness", "stuttering", "waterdisrupt",}

	erAff("impatience")
  erAff("sandfever")
	
	--Readd last goldenseal, if there was any.
	if lastGoldenseal and lastGoldenseal ~= "impatience" then
		tAffs[lastGoldenseal] = true
		lastGoldenseal = nil
		ataxiaEcho("Backtracked impatience being cured with last eat.")
	end

	for i=1, #gAffs do
		if tAffs[gAffs[i]] then
			if gAffs[i] ~= "anorexia" and haveAff("anorexia") then
				anorexiaFailsafe = true
				lastFocus = gAffs[i]
				tempTimer(1.2, [[anorexiaFailsafe = nil; lastFocus = nil]])
			end
			erAff(gAffs[i])
			break
		end
	end
end

function tSingleRandom()
	local gAffs = {"aeon", "pyramides", "flushings", "crushedthroat", "sandfever", "paralysis", "timeloop", "lethargy", "depression", 
    "hypersomnia", "retribution", "confusion", "darkshade", "healthleech", "hypochondria", "manaleech",  "nausea",
    "parasite", "shivering", "frozen", "spiritburn", "clumsiness", "sensitivity", "scytherus", "tenderskin", "stupidity", "haemophilia", 
    "weariness", "hallucinations", "dizziness", "justice", "recklessness", "epilepsy", "addiction", "hallucinations", "loneliness", "shyness", 
    "vertigo", "paranoia", "agoraphobia", "claustrophobia", "generosity", "pacifism", "disloyalty", "selarnia", "frozen","brokenleftleg","brokenrightleg","brokenleftarm","brokenrightarm",}

  --[Experimental passive handling for lock affs]--
  passiveFailsafe = false
  if haveAff("asthma") and haveAff("slickness") then
    table.insert(gAffs, 35, "asthma")
    passiveFailsafe = true
  else
    table.insert(gAffs, 9, "asthma")
  end
  
  if haveAff("anorexia") then
    if haveAff("impatience") or haveAff("sandfever") or haveAff("slickness") then
      table.insert(gAffs, 35, "anorexia")
      passiveFailsafe = true
    else
      table.insert(gAffs, 12, "anorexia")
    end
  end
  
  if haveAff("slickness") and hasSalveAff() then
    table.insert(gAffs, 35, "slickness")
    passiveFailsafe = true
  else
    table.insert(gAffs, 9, "slickness")
  end
  
  if haveAff("impatience") and haveAff("anorexia") then
    table.insert(gAffs, 35, "impatience")
    passiveFailsafe = true
  else
    table.insert(gAffs, 15, "impatience")
  end

  --[Continue on as per the usual curing]--
  
	for i=1, #gAffs do
		if tAffs[gAffs[i]] then
			if gAffs[i] == "haemophilia" then 
				tAffs.bleed = 0
			end
			erAff(gAffs[i])
			cecho("&lt;red&gt; -"..gAffs[i])
      if passiveFailsafe then 
        passiveFailsafe = gAffs[i] 
        tempTimer(0.5, [[passiveFailsafe = nil]])
      end
			break
		end
	end
end

function tMultipleRandom(amt)
	local num = tonumber(amt)
	local gAffs = {"aeon", "anorexia", "pyramides", "flushings", "crushedthroat", "sandfever", "paralysis", "asthma", "timeloop", "lethargy", "depression", "impatience", 
    "hypersomnia", "retribution", "confusion", "darkshade", "healthleech", "hypochondria", "slickness", "manaleech", 
    "parasite", "shivering", "frozen", "spiritburn", "clumsiness", "sensitivity", "nausea", "scytherus", "tenderskin", "stupidity", "haemophilia", 
    "weariness", "hallucinations", "dizziness", "justice", "recklessness", "epilepsy", "addiction", "hallucinations", "loneliness", "shyness", 
    "vertigo", "paranoia", "agoraphobia", "claustrophobia", "generosity", "pacifism", "disloyalty", "selarnia", "frozen","brokenleftleg","brokenrightleg","brokenleftarm","brokenrightarm",}
		
	for i=1, #gAffs do
		if tAffs[gAffs[i]] and num &gt; 0 then
			if gAffs[i] == "haemophilia" then 
				tAffs.bleed = 0
			end
			erAff(gAffs[i])
			num = num - 1
		elseif num == 0 then
			break
		end
	end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Check Targets Conditions</name>
											<packageName></packageName>
											<script>function checkTargetLocks()
  if lockEchoTimer then return end

	softlock, hardlock, truelock, toecho = false, false, false, ""

	if checkEnlighten() and ataxia_isClass("Occultist") then
		cecho("\n&lt;yellow&gt; ~ ~ [ &lt;a_darkmagenta&gt;TARGET CAN BE ENLIGHTENED &lt;yellow&gt;] ~ ~")
	end

	if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
		softlock = true
	else
		return
	end

	if softlock and checkAffList({"impatience", "sandfever"},1) then
		hardlock = true
	end

	if hardlock and haveAff("paralysis") then
		truelock = true
	end

	toecho = "&lt;purple&gt;   [&lt;NavajoWhite&gt;LOCKS&lt;purple&gt;]:  &lt;yellow&gt;soft"
	if hardlock then toecho = toecho..", &lt;orange&gt;hard" end
	if truelock then toecho = toecho..", &lt;red&gt;true" end
	toecho = toecho.."&lt;NavajoWhite&gt;."

	cecho("\n"..toecho)	
  lockEchoTimer = tempTimer(15, [[ lockEchoTimer = nil ]])
end

function tarIsTempered()
	if tAffs.sanguine or tAffs.phlegmatic or tAffs.choleric or tAffs.melancholic then
		return true
	else
		return false
	end
end

function restoreLastKelp()
	local kelps = {"hypochondria", "parasite", "weariness", "healthleech", "clumsiness", "sensitivity"}
	if lastKelp and lastKelp == "asthma" then
		tAffs.asthma = true
		ataxiaEcho("Doesn't look like that kelp got asthma.")
		for i=1, #kelps do
			if haveAff(kelps[i]) then
				erAff(kelps[i])
				break
			end
		end
	end
end

function affDuration(aff)
  local g = getEpoch()
  if not affTimers or not affTimers[aff] then
    return 0
  else
    return tonumber( string.format("%2.3f", (g-affTimers[aff])) )
  end
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<Script isActive="yes" isFolder="no">
										<name>Parse Cures</name>
										<packageName></packageName>
										<script>
function tarClassCure(getAff)
	local x = (ataxiaNDB_Exists(target) and ataxiaNDB.players[target].class or "None")
	local aff = ""
	local affCures = {
		Alchemist = {"stupidity", "stupid"},
		Blademaster = {"weariness", "weariness"},
		Depthswalker = {"recklessness", "reckless"},
		Druid = {"weariness", "weariness"},
		Infernal = {"weariness", "weariness"},
		Magi = {"haemophilia", "haemophilia"},
		Monk = {"weariness", "weariness"},
		Paladin = {"weariness", "weariness"},
		Psion = {"confusion", "confusion"},
		Runewarden = {"weariness", "weariness"},
		Sentinel = {"weariness", "weariness"},
		Serpent = {"weariness", "weariness"},
		None = {"paralysis", "paralyse"},
	}
	if not table.contains(affCures, x) then x = "None" end
	if getAff then
		aff = affCures[x][2]
	else
		aff = affCures[x][1]
	end
	return aff
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Bard Harmonics Tracking</name>
										<packageName></packageName>
										<script>function ataxia_nextHarmonic()

	
	if not next(ataxiaTemp.harms) then
		ataxiaTemp.summoningHarms = nil
		ataxiaTemp.harmsSummoned = true
		ataxiaTemp.needSymphony = true
		ataxiaEcho("Harmonics summoning completed. Refreshing to max duration.")
		comm = comm.." ;play symphony"
	else
		ataxiaEcho("Calling "..ataxiaTemp.harms[1].." next.")
		comm = "wield rapier;wield lyre;play "..ataxiaTemp.harms[1]
	end
	
	send("queue addclear free " ..comm)
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Combat Tables</name>
										<packageName></packageName>
										<script>function load_Combat_Tables()
	ataxiaTables.combat = {}
	ataxiaTables.combat.permitted = {"Bard", "Blademaster", "Psion", "Unnamable"}
	local class = gmcp.Char.Status.class:title()
  if class:find("Earth") then
    ataxia.vitals.shaping = 0
  end
	if not table.contains(ataxiaTables.combat.permitted, class) then
		ataxiaEcho("Combat vars not yet setup for this class. This won't actually affect anything, though.")
	else
		retrieve_CombatVariables(class)
	end
end

function retrieve_CombatVariables(class)
	local combatVars = {
		Bard = {
			clumsiness = "sing maqam at tar",
			confusion = "recite haiku at tar",
			claustrophobia = "sing isorhythm at tar",
			nausea = "recite poem at tar",
			vertigo = "sing pastorale at tar",
			generosity = "chant gimmegimme at tar",
			epilepsy = "sing ditty at tar",
			impatience = "sing limerick at tar",
			paranoia = "sing requiem at tar",
			paralysis = "recite epic at tar",
			addiction = "recite ode at tar",
			anorexia = "sing qasida at tar",
			stupidity = "sing passion at tar",
      dizziness = "sing maqam at tar",
		},
		Blademaster = {
			hamstring = "strike tar hamstring",
			slickness = "strike tar underarm",
			anorexia = "strike tar stomach",
			asthma = "strike tar throat",
			hypochondria = "strike tar chest",
			recklessness = "strike tar groin",
			stupidity = "strike tar temple",
			hallucinations = "strike tar eyes",
			paralysis = "strike tar neck",
			addiction = "strike tar kidneys",
			disloyalty = "strike tar nose",
			clumsiness = "strike tar ears",
			weariness = "strike tar shoulder",
		},
		Psion = {
			paralysis = "weave prepare disruption",
			haemophilia = "weave prepare laceration",
			clumsiness = "weave prepare dazzle",
			epilepsy = "weave prepare rattle",
			asthma = "weave prepare vapours",
		},
    Unnamable = {
      nausea = "croon revelation tar",
      horror = "unnamable horror tar",
      manaleech = "croon corrosion tar",
      addiction = "croon hunger tar",
    },
	}
	ataxiaTables.combat[class] = {}
	for aff, com in pairs(combatVars[class]) do
		ataxiaTables.combat[class][aff] = com 
	end
	ataxiaEcho("Combat vars retrieved for "..class.." - Held at ataxiaTables.combat."..class)
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Magi Vibes Tracking</name>
										<packageName></packageName>
										<script>function magiVibes_isHere(what)
  vibes_inRoom = vibes_inRoom or {}
  local vibeEffects = {
    ["thrumming vibration"] = {name = "dissipate", effect = "drains mana"},
    ["hums irregularly"] = {name = "palpitation", effect = "deals damage"},
    ["loud ringing sound"] = {name = "alarm", effect = "alerts when enemy enters"},
    ["tremors vibration"] = {name = "tremors", effect = "prones/strips levitation"},
    ["barely heard tone"] = {name = "reverberation", effect = "protects vibes"},
    ["feeling of oppression"] = {name = "adduction", effect = "pulls unmassed enemies"},
    ["pleasant harmony"] = {name = "harmony", effect = "heals vitals/afflictions"},
    ["filled with tension"] = {name = "creeps", effect = "periodic shyness"},
    ["profound silence"] = {name = "silence", effect = "prevents talking in room"},
    ["crystal-clear tone"] = {name = "revelation", effect = "reveals hidden people"},
    ["discordant music"] = {name = "oscillate", effect = "periodic amnesia"},
    ["surroundings distort"] = {name = "disorientation", effect = "periodic dizziness"},
    ["vibrating circle of energy"] = {name = "energise", effect = "absorbs health from enemies"},
    ["high-pitched keening"] = {name = "stridulation", effect = "disrupts undeaf/strips deaf"},
    ["dust in the air"] = {name = "gravity", effect = "stops flying"},
    ["forest of small sharp crystals"] = {name = "forest", effect = "damage on prone"},
    ["dissonant hum"] = {name = "dissonance", effect = "causes dissonance affliction"},
    ["skin crawls"] = {name = "plague", effect = "hidden afflictions"},
    ["air vibrates"] = {name = "lullaby", effect = "periodic sleep"},
  }
  
  for line, list in pairs(vibeEffects) do
    if what:lower() == list.name then
      cecho("  -  &lt;a_yellow&gt;"..list.effect)
      vibes_inRoom[list.name] = true
      break
    elseif string.find(what, line) then
      deleteLine()
      cecho("\n&lt;magenta&gt;[&lt;a_magenta&gt;VIBE&lt;magenta&gt;]: &lt;NavajoWhite&gt;"..list.name:title().." active here - &lt;a_yellow&gt;"..list.effect..".")
      vibes_inRoom[list.name] = true
      break
    end
  end
end

function magiVibes_nextEmbed()
	if not next(ataxiaTemp.vibes) then
		ataxiaTemp.embeddingVibes = nil
		ataxiaEcho("All defined vibes have been embedded.")
	else
		ataxiaEcho("Embedding "..ataxiaTemp.vibes[1].." next.")
		send("queue addclear free embed "..ataxiaTemp.vibes[1],false)
	end
	
end</script>
										<eventHandlerList />
									</Script>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Offensive Things</name>
										<packageName></packageName>
										<script>function getLockingAffliction(type)
	local lockaff = {
		Alchemist = {"stupidity", "stupid"},
		Apostate = {"voyria", "plague"},
    Pariah = {"voyria", "plague"},
		Bard = {"voyria", "plague"},
		Blademaster = {"weariness", "weariness"},
		Depthswalker = {"recklessness", "reckless"},
		Druid = {"weariness", "weariness"},
		Infernal = {"weariness", "weariness"},
		Jester = {"paralysis", "paralyse"},
		Magi = {"haemophilia", "haemophilia"},
		Monk = {"weariness", "weariness"},
		Occultist = {"paralysis", "paralyse"},
		Paladin = {"weariness", "weariness"},
    Unnamable = {"weariness", "weariness"},
		Priest = {"voyria", "plague"},
		Psion = {"confusion", "confusion"},
		Runewarden = {"weariness", "weariness"},
		Sentinel = {"weariness", "weariness"},
		Serpent = {"weariness", "weariness"},
		Shaman = {"paralysis", "paralyse"},
		Sylvan = {"haemophilia", "haemophilia"},
    Airlord = {"weariness", "weariness"},
    Waterlord = {"weariness", "weariness"},
    Earthlord = {"weariness", "weariness"},
    Firelord = {"weariness", "weariness"},
	}
	if ataxiaNDB and ataxiaNDB_Exists(target) and ataxiaNDB.players[target].city ~= "Underworld" then
		local gClass = ataxiaNDB_getClass(target)
		if type == "name" then
			return lockaff[gClass][1]
		else
			return lockaff[gClass][2]
		end
	else
		if type == "name" and ataxiaNDB.players[target].city == "Underworld" then
			return "paralysis"
		else
			return "paralyse"
		end
	end
end</script>
										<eventHandlerList />
										<ScriptGroup isActive="yes" isFolder="yes">
											<name>Limb Management</name>
											<packageName></packageName>
											<script>function target_limbBroke(limb)
	local brk = "damaged"..string.gsub(limb, " ", "")
	local mend = "broken"..string.gsub(limb, " ", "")
	tAffs[brk] = true
--	erAff(mend)
end

function targetLimbs_updateTimers(limbhit)
	ataxiaTables.limbTimers = ataxiaTables.limbTimers or {}

	if ataxiaTables.limbTimers[limbhit] then killTimer( ataxiaTables.limbTimers[limbhit] ) end
	ataxiaTables.limbTimers[limbhit] = tempTimer(180, [[ target_resetLimb("]]..limbhit..[[")]])

end

function target_resetLimb(limbhit)
  local lco = ataxia_shortLimb(limbhit)
	tLimbs[lco] = 0
	cecho("\n&lt;a_brown&gt;( Limb damage on target's &lt;a_red&gt;"..limbhit.."&lt;a_brown&gt; has been reset )")
	
	if limbhit == "head" or limbhit == "torso" then
		erAff("damaged"..limbhit)
	end
	
	if ataxiaTables.limbTimers[limb] then 
		killTimer( ataxiaTables.limbTimers[limb] )
		ataxiaTables.limbTimers[limb] = nil
	end
end

function limbCounter_textTag()
	local zero = 0
	for limb, num in pairs(tLimbs) do
		if limb ~= "BP" and limb ~= "staff" and limb ~= "airstrike" and type(num) == "number" and num &gt; 0 then
			zero = zero + 1
		end
	end
	if zero == 0 then return "" end

	local str = " &lt;a_brown&gt;["
	local limbs = {"LL", "RL", "LA", "RA", "T", "H"}
	for i=1, #limbs do
		local colour = ""
		if tLimbs[limbs[i]] &gt;= 99 then
			colour = "&lt;a_darkred&gt;"
		elseif tLimbs[limbs[i]] &gt;= 90 then
			colour = "&lt;a_red&gt;"
		elseif tLimbs[limbs[i]] &gt;= 80 then
			colour = "&lt;OrangeRed&gt;"
		elseif tLimbs[limbs[i]] &gt;= 70 then
			colour = "&lt;dark_orange&gt;"
		elseif tLimbs[limbs[i]] &gt;= 60 then
			colour = "&lt;orange&gt;"
		elseif tLimbs[limbs[i]] &gt;= 50 then
			colour = "&lt;coral&gt;"
		elseif tLimbs[limbs[i]] &gt;= 40 then
			colour = "&lt;goldenrod&gt;"
		elseif tLimbs[limbs[i]] &gt;= 30 then
			colour = "&lt;yellow&gt;"
		elseif tLimbs[limbs[i]] &gt;= 20 then
			colour = "&lt;LightGoldenrod&gt;"
		else
			colour = "&lt;DimGrey&gt;"
		end
		
		if limbs[i] ~= limbs[#limbs] then
			str = str..colour..limbs[i].."&lt;a_brown&gt;."
		else
			str = str..colour..limbs[i].."&lt;a_brown&gt;] "
		end
	end

	return str
end

function limbCounter_numberTag()

	local zero = 0
	for limb, num in pairs(tLimbs) do
		if limb ~= "BP" and limb ~= "staff" and limb ~= "airstrike" and type(num) == "number" and num &gt; 0 then
			zero = zero + 1
		end
	end
	if zero == 0 then return "" end

	local str = " &lt;a_brown&gt;["
	local limbs = {"LL", "RL", "LA", "RA", "T", "H"}
  local val = 0
	for i=1, #limbs do
		local colour = ""
		if tLimbs[limbs[i]] &gt;= 99 then
			colour = "&lt;a_darkred&gt;"
		elseif tLimbs[limbs[i]] &gt;= 90 then
			colour = "&lt;a_red&gt;"
		elseif tLimbs[limbs[i]] &gt;= 80 then
			colour = "&lt;OrangeRed&gt;"
		elseif tLimbs[limbs[i]] &gt;= 70 then
			colour = "&lt;dark_orange&gt;"
		elseif tLimbs[limbs[i]] &gt;= 60 then
			colour = "&lt;orange&gt;"
		elseif tLimbs[limbs[i]] &gt;= 50 then
			colour = "&lt;coral&gt;"
		elseif tLimbs[limbs[i]] &gt;= 40 then
			colour = "&lt;goldenrod&gt;"
		elseif tLimbs[limbs[i]] &gt;= 30 then
			colour = "&lt;yellow&gt;"
		elseif tLimbs[limbs[i]] &gt;= 20 then
			colour = "&lt;LightGoldenrod&gt;"
		else
			colour = "&lt;DimGrey&gt;"
		end
		
		if limbs[i] ~= limbs[#limbs] then
			str = str..colour..tLimbs[limbs[i]].."&lt;NavajoWhite&gt;|"
		else
			str = str..colour..tLimbs[limbs[i]].."&lt;a_brown&gt;] "
		end
	end

	return str
end</script>
											<eventHandlerList />
											<Script isActive="yes" isFolder="no">
												<name>Bard Limbcounting</name>
												<packageName></packageName>
												<script>--unsure on how well it works yet
function bard_setBreakpoint(maxhp)
  local hits_to_break = linearFit(maxhp)
  local dmg_per_hit = 100/hits_to_break
	ataxiaTemp.rapierJab = string.format("%2.2f", (dmg_per_hit))
	cecho("  &lt;red&gt;[&lt;CadetBlue&gt;pj- &lt;green&gt;"..ataxiaTemp.rapierJab.."%&lt;red&gt;]")
end

function bard_addLimbDamage(limbhit)
	if not ataxiaTemp.rapierJab then return end
	local toLimb = {
		["head"] = "H",
		["torso"] = "T",
		["right leg"] = "RL",
		["left leg"] = "LL",
		["right arm"] = "RA",
		["left arm"] = "LA",
	}
	local lco = toLimb[limbhit]
	tLimbs[lco] = tLimbs[lco] + ataxiaTemp.rapierJab
	
	if tLimbs[lco] &gt;= 99 then
		cecho("\n&lt;a_red&gt; &gt;&gt; [ &lt;a_darkcyan&gt;"..target:upper().."'S "..limbhit:upper().." HAS BEEN BROKEN &lt;a_red&gt; ] &lt;&lt;")
		target_limbBroke(limbhit)
  elseif ataxia.bardStuff.tunesmith == "acciaccatura" and tLimbs[lco] &gt;= 80 then
    tLimbs[lco] = 100
    cecho("\n&lt;a_red&gt; &gt;&gt; [ &lt;a_darkcyan&gt;"..target:upper().."'S "..limbhit:upper().." HAS BEEN BROKEN &lt;a_red&gt; ] &lt;&lt;")
    target_limbBroke(limbhit)
	end
	targetLimbs_updateTimers(limbhit)
end

function bard_tremvib(limbhit)
	if not ataxiaTemp.rapierJab then return end
	local toLimb = {
		["head"] = "H",
		["torso"] = "T",
		["right leg"] = "RL",
		["left leg"] = "LL",
		["right arm"] = "RA",
		["left arm"] = "LA",
	}
	local lco = toLimb[limbhit]
	tLimbs[lco] = tLimbs[lco] + 60
	
	if tLimbs[lco] &gt;= 99.99 then
		cecho("\n&lt;a_red&gt; &gt;&gt; [ &lt;a_darkcyan&gt;"..target:upper().."'S "..limbhit:upper().." HAS BEEN BROKEN &lt;a_red&gt; ] &lt;&lt;")
		target_limbBroke(limbhit)
	end
	targetLimbs_updateTimers(limbhit)
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Blademaster Limbcounting</name>
												<packageName></packageName>
												<script>function ataxia_updateBlademasterStance()
  if ataxiaTables.limbData.bmBaseSlash == 0 or ataxiaTables.limbData.bmBaseCompass == 0 then return end
  local stanceDiff = {
    Sanya = 1.06,
    Arash = 1.16,
    Thyr = 0.85,
    Mir = 0.95,     
  }
  local stance = ataxia.vitals.stance
  ataxiaTables.limbData.bmCompass = ( ataxiaTables.limbData.bmBaseCompass * stanceDiff[stance] )
  ataxiaTables.limbData.bmOffSlash = ( ataxiaTables.limbData.bmBaseOffSlash * stanceDiff[stance] )
  ataxiaTables.limbData.bmSlash = ( ataxiaTables.limbData.bmBaseSlash * stanceDiff[stance] )
  cecho("\n&lt;green&gt; -= predicted stance modifiers updated =-")
end

function ataxia_updateBlademasterBases()
  local stanceDiff = {
    Sanya = 0.94,
    Arash = 0.84,
    Thyr = 1.15,
    Mir = 1.05,     
  }
  local stance = ataxia.vitals.stance
  ataxiaTables.limbData.bmBaseCompass = ( ataxiaTables.limbData.bmCompass * stanceDiff[stance] )
  ataxiaTables.limbData.bmBaseOffSlash = ( ataxiaTables.limbData.bmOffSlash * stanceDiff[stance] )
  ataxiaTables.limbData.bmBaseSlash = ( ataxiaTables.limbData.bmSlash * stanceDiff[stance] )  
end

function ataxia_blademasterNeedComp()
  local one, two = ataxiaTables.limbData.bmSlash, ataxiaTables.limbData.bmOffSlash
  local left, right = 0, 0
  --10 rounds should more than suffice
  for i=1, 10 do
    --Add to first limb
    left = left + one; right = right + two
  
    --Check if left is broken here.
    if left &gt; 99.99 and right &lt; 99.99 then
      ataxiaTables.limbData.bmProblemslash = true
      cecho("\n&lt;yellow&gt; --&gt; WE PREDICT COMPASSSLASH IS NEEDED!")
      cecho("\n&lt;orange&gt; --&gt; WE PREDICT COMPASSSLASH IS NEEDED!")
      cecho("\n&lt;red&gt; --&gt; WE PREDICT COMPASSSLASH IS NEEDED!")
      break
    end
  
    --Continue on if not
    left = left + two 
    right = right + one 
  end
  if ataxiaTables.limbData.bmProblemslash == nil then
    ataxiaTables.limbData.bmProblemslash = false
    cecho("\n&lt;green&gt; --&gt; CompassSlash is not needed for this health.")
  end
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Dragon/Elord</name>
												<packageName></packageName>
												<script>function dragon_rendHit(limb)
	local toLimb = {
		["head"] = "H",
		["torso"] = "T",
		["right leg"] = "RL",
		["left leg"] = "LL",
		["right arm"] = "RA",
		["left arm"] = "LA",
	}
	local lco = toLimb[limb]
	
	tLimbs[lco] = tLimbs[lco] + 25
	
	if tLimbs[lco] &gt;= 98 then
		cecho("\n&lt;a_red&gt; &gt;&gt; [ &lt;a_darkcyan&gt;"..target:upper().."'S "..limb:upper().." HAS BEEN BROKEN &lt;a_red&gt; ] &lt;&lt;")
		target_limbBroke(limb)
		if limb == "head" then
			tarBonusAff("stupidity")
		end
	end
	targetLimbs_updateTimers(limb)
end


function earth_powderiseHit(limb)
	local toLimb = {
		["head"] = "H",
		["torso"] = "T",
		["right leg"] = "RL",
		["left leg"] = "LL",
		["right arm"] = "RA",
		["left arm"] = "LA",
	}
	local lco = toLimb[limb]
  local x = (ataxia.vitals.shaping == 4 and 40 or 20)	
	tLimbs[lco] = tLimbs[lco] + x
  
	
	if tLimbs[lco] &gt;= 100 then
		cecho("\n&lt;red&gt; -= "..limb.." broke! =-")
    cecho("\n&lt;red&gt; -= "..limb.." broke! =-")
		target_limbBroke(limb)
		if limb == "head" then
			tarBonusAff("stupidity")
		end
	end
	targetLimbs_updateTimers(limb)
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Magi-Specific</name>
												<packageName></packageName>
												<script>function magi_checkDestroy()
	if not tAffs.burns or tAffs.burns == 0 then return false end
	if not ataxiaTemp.lastDiag then return false end
	
	if tAffs.burns &gt;= ataxiaTemp.lastDiag then
		return true
	else
		return false
	end
end

function magi_setDestroy(num)
	if not tAffs.burns or tAffs.burns == 0 then return end
  if num &gt;= 40 and tAffs.burns &gt;= 2 then
		ataxia_boxEcho(target.." CAN BE DESTROYED", "orange")
		ataxiaTemp.lastDiag = needed
		tempTimer(2, [[ ataxiaTemp.lastDiag = nil ]])
	end
end

function magi_addBurns()
tAffs.burns = tAffs.burns or 0
tAffs.burns = tAffs.burns + 1
  if tAffs.burns &gt; 5 then tAffs.burns = 5 end
cecho(" &lt;DimGrey&gt;[&lt;red&gt;"..tAffs.burns.."/5&lt;DimGrey&gt;]")
end



function magi_resetLimbs()
	tLimbs = {
		H = 0,	T = 0,
		RL = 0,	RA = 0,
		LL = 0, LA = 0,
		BP = 100,
		staff = 15,
    airstrike = 8,
	}
	ataxiaEcho("Breakpoints have been reset.")
end

function magi_setBreakpoint(health)
	if health &lt;= 3499 then
		tLimbs.staff = tonumber(string.format("%2.2f", (100/6)))
	elseif health &lt;= 6700 then
		tLimbs.staff = tonumber(string.format("%2.2f", (100/6.5)))
	else
		tLimbs.staff = tonumber(string.format("%2.2f", (100/7)))
	end
	tLimbs.airstrike = tonumber(string.format("%2.2f", (100/12)))
	cecho("\n&lt;a_blue&gt;    &gt;&gt; &lt;a_green&gt;"..health.."h &lt;a_blue&gt;| &lt;a_magenta&gt;"..tLimbs.staff.."("..math.floor((100/tLimbs.staff)+0.05)..") &lt;a_blue&gt;| &lt;a_brown&gt;"..tLimbs.airstrike.."("..math.floor((100/tLimbs.airstrike)+0.05)..") &lt;a_blue&gt;&lt;&lt;")	
end

function magi_staffStrike(element, limb)
	local toLimb = {
		["head"] = "H",
		["torso"] = "T",
		["right leg"] = "RL",
		["left leg"] = "LL",
		["right arm"] = "RA",
		["left arm"] = "LA",
	}
	local lco = toLimb[limb]
	if element:title() == "Whiirh" then
		tLimbs[lco] = tLimbs[lco] + tLimbs.airstrike
		tAffs.prone = true
	else
		tLimbs[lco] = tLimbs[lco] + tLimbs.staff
    if element:title() == "Sllshya" then
      for _, aff in pairs({"nocaloric", "shivering", "frozen"}) do
        if not haveAff(aff) then
          tAffs[aff] = true
          cecho("&lt;green&gt;+&lt;DodgerBlue&gt;"..aff.."&lt;green&gt;+")
          break
        end
      end
    end
	end
	
	if tLimbs[lco] &gt;= 98 then
		target_limbBroke(limb)
		cecho("\n&lt;a_red&gt; &gt;&gt; [ &lt;a_darkcyan&gt;"..target:upper().."'S "..limb:upper().." HAS BEEN BROKEN &lt;a_red&gt; ] &lt;&lt;")
	end
	targetLimbs_updateTimers(limb)
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Priest-Specific</name>
												<packageName></packageName>
												<script>function setPriestBreakPoint(hp)
	if hp &gt;= 6500 then
		tLimbs.BP = 6
	elseif hp &gt; 5000 then
		tLimbs.BP = 5
	elseif hp &lt; 3200 then
		tLimbs.BP = 3
	else
		tLimbs.BP = 4
	end
	ataxiaEcho("Hmm... Looks like "..target.." will break in &lt;red&gt;"..tLimbs.BP.."&lt;LightSkyBlue&gt; hits from your mace.")
end

function smoteLimb(limb)
	local toLimb = {
		["head"] = "H",
		["torso"] = "T",
		["right leg"] = "RL",
		["left leg"] = "LL",
		["right arm"] = "RA",
		["left arm"] = "LA",
	}
	local lco = toLimb[limb]
	tLimbs[lco] = tLimbs[lco] + 1
	
	if tLimbs[lco] == tLimbs.BP then
		if limb == "head" then
			tarAffed("stupidity")
		end
		target_limbBroke(limb)
		ataxia_echo("&lt;black:LightSkyBlue&gt;      "..target:upper().."'S&lt;black:green&gt; "..limb:upper().." &lt;black:LightSkyBlue&gt;IS BROKEN!      ")
	end
	targetLimbs_updateTimers(limb)
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Psion Limb Tracking</name>
												<packageName></packageName>
												<script>function psion_hitLimb(limb)
	local toLimb = {
		["head"] = "H",
		["torso"] = "T",
		["right leg"] = "RL",
		["left leg"] = "LL",
		["right arm"] = "RA",
		["left arm"] = "LA",
	}
	local lco = toLimb[limb]
	
	if lco == "RL" or lco == "LL" then
		tLimbs[lco] = tLimbs[lco] + 20
	else
		tLimbs[lco] = tLimbs[lco] + 25
	end
	
	if tLimbs[lco] &gt;= 98 then
		cecho("\n&lt;a_red&gt; &gt;&gt; [ &lt;a_darkcyan&gt;"..target:upper().."'S "..limb:upper().." HAS BEEN BROKEN &lt;a_red&gt; ] &lt;&lt;")
		target_limbBroke(limb)
		if limb == "head" then
			tAffs.stupidity = true
		end
	end
	targetLimbs_updateTimers(limb)
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Target Applied Somewhere</name>
												<packageName></packageName>
												<script>function target_curedLimb(limb)

  if haveAff("mangled"..limb) then
    erAff("mangled"..limb)
    tAffs["damaged"..limb] = true
  else
    erAff("damaged"..limb)
    tBals.salve = true
    if tBals.timers.salve then killTimer(tBals.timers.salve); tBals.timers.salve = nil end
    if limb ~= "head" and limb ~= "torso" then
      tAffs["broken"..limb] = true
    end
	end
end

function target_salveBal(num)
  local offSalve = num - 0.25
  if tBals.timers.salve then killTimer(tBals.timers.salve) end
  tBals.salve = false
  tBals.timers.salve = tempTimer(offSalve, [[ tBals.salve = true; tBals.timers.salve = nil ]])
end

function target_appliedTo(where)
	if where == "arms" then
		if ataxiaTemp.mendingWait then
			ataxia_Echo("Looks like the last apply was mending.")
			killTimer(ataxiaTemp.mendingWait)
			ataxiaTemp.mendingWait = nil
			killTimer(ataxiaTemp.checkBreak)
			ataxiaTemp.checkBreak = nil
			target_salveBal(1.1)
           
			if haveAff("brokenleftarm") then
				erAff("brokenleftarm")
			else
				erAff("brokenrightarm")
			end
		end
		if haveAff("damagedleftarm") or haveAff("mangledleftarm") then
			ataxiaTemp.mendingWait = tempTimer(2, [[ ataxiaTemp.mendingWait = nil ]])
			ataxiaTemp.checkBreak = tempTimer(3.7, [[
				target_curedLimb("leftarm");
				target_resetLimb("left arm")
			]])
      target_salveBal(4)
      
		elseif haveAff("damagedrightarm") or haveAff("mangledrightarm") then
			ataxiaTemp.mendingWait = tempTimer(2, [[ ataxiaTemp.mendingWait = nil ]])
			ataxiaTemp.checkBreak = tempTimer(3.7, [[
				target_curedLimb("rightarm");
				target_resetLimb("right arm")
			]])
			target_salveBal(4)
      
		elseif haveAff("brokenleftarm") then
			erAff("brokenleftarm")
      target_salveBal(1.1)
		else
			erAff("brokenrightarm")
      target_salveBal(1.1)      	
		end
	else
		if ataxiaTemp.mendingWait then
			ataxia_Echo("Looks like the last apply was mending.")
			tBals.salve = true
			killTimer(ataxiaTemp.mendingWait)
			ataxiaTemp.mendingWait = nil
			killTimer(ataxiaTemp.checkBreak)
			ataxiaTemp.checkBreak = nil
      target_salveBal(1.1)
			
			if haveAff("brokenleftleg") then
				erAff("brokenleftleg")
			else
				erAff("brokenrightleg")
			end
		end
		if haveAff("damagedleftleg") or haveAff("mangledleftleg") then
			ataxiaTemp.mendingWait = tempTimer(2, [[ ataxiaTemp.mendingWait = nil ]])
			ataxiaTemp.checkBreak = tempTimer(3.7, [[
				target_curedLimb("leftleg");
				target_resetLimb("left leg")
			]])
      target_salveBal(4)
      
		elseif haveAff("damagedrightleg") or haveAff("mangledrightleg") then
			ataxiaTemp.mendingWait = tempTimer(2, [[ ataxiaTemp.mendingWait = nil ]])
			ataxiaTemp.checkBreak = tempTimer(3.7, [[
				target_curedLimb("rightleg");
				target_resetLimb("right leg")
			]])
			target_salveBal(4)
      
		elseif haveAff("brokenleftleg") then
			erAff("brokenleftleg")
      target_salveBal(1.1)
		else
			erAff("brokenrightleg")
      target_salveBal(1.1)		
		end
	end
end

</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Knight Limbcounting</name>
												<packageName></packageName>
												<script>--[[if gmcp.Char.Status.class == "Paladin" then
    if matches[2] == target then
        tarMaxHealth = matches[5]
            if tarMaxHealth &gt; "8399" then
                sliceLimb = (((7*tarMaxHealth)/(400-125))+((17/8)*(125+10))+2)
                breakpoint = math.ceil(tarMaxHealth/sliceLimb)
                cecho("\n&lt;red&gt;[&lt;gold&gt;Breakpoint: " ..breakpoint.. "&lt;red&gt;]")
            elseif tarMaxHealth &lt; "8400" then
                sliceLimb = ((7*tarMaxHealth)/(400-125))+((17/8)*(125+10))
                breakpoint = math.ceil(tarMaxHealth/sliceLimb)
                cecho("\n&lt;red&gt;[&lt;gold&gt;Breakpoint: " ..breakpoint.. "&lt;red&gt;]")
        end
    end
displaySC()
end]]--

--unsure on how well it works yet
--this also only works for SnB, but with some tweaking it might be possible to work in general
--you will have to change the '125' to match whatever level sword you have
function knight_setBreakPoint(maxhp)
	local tarHP = maxhp
	local sliceLimb, perHit = 0, 0
  if ataxia.vitals.knight == "Dual Blunt" then
    --This isn't 100% correct, and will likely require tweaks. It's also based off of Level 1s.
    --This is also morningstars only.
    if tarHP &gt;= 10000 then
      sliceLimb = 10
    elseif tarHP &gt;= 8200 then
      sliceLimb = 9
    elseif tarHP &gt;= 6500 then
      sliceLimb = 8
    elseif tarHP &gt;= 5000 then
      sliceLimb = 7
    else
      sliceLimb = 6
    end
    sliceLimb = string.format("%2.2f", 100/sliceLimb)
    ataxiaTemp.maceHit = tonumber(sliceLimb)
  else
    if tarHP &gt;= 8400 then
  		sliceLimb = (((7*tarHP)/(400-125))+((17/8)*(125+10))+2)
    else
  		sliceLimb = ((7*tarHP)/(400-125))+((17/8)*(125+10))
  	end
  	if ataxia_isClass("runewarden") then
  		sliceLimb = sliceLimb * 1.1
  	end
  	perHit = (sliceLimb/tarHP)*100
  	perHit = string.format("%2.2f", perHit)
  	
  	ataxiaTemp.swordHit = perHit
  end
end

function knight_addLimbDamage(limbhit)
	if not ataxiaTemp.swordHit then return end
	local toLimb = {
		["head"] = "H",
		["torso"] = "T",
		["right leg"] = "RL",
		["left leg"] = "LL",
		["right arm"] = "RA",
		["left arm"] = "LA",
	}
	local lco = toLimb[limbhit]
	tLimbs[lco] = tLimbs[lco] + ataxiaTemp.swordHit
	
	if tLimbs[lco] &gt;= 97 then
		cecho("\n&lt;a_red&gt; &gt;&gt; [ &lt;a_darkcyan&gt;"..target:upper().."'S "..limbhit:upper().." HAS BEEN BROKEN &lt;a_red&gt; ] &lt;&lt;")
		target_limbBroke(limbhit)
	end
	targetLimbs_updateTimers(limbhit)
end

function knight_dwbAddHit(limbhit)
  if not ataxiaTemp.maceHit then return end
	local toLimb = {
		["head"] = "H",
		["torso"] = "T",
		["right leg"] = "RL",
		["left leg"] = "LL",
		["right arm"] = "RA",
		["left arm"] = "LA",
	}
	local lco = toLimb[limbhit]
	tLimbs[lco] = tLimbs[lco] + ataxiaTemp.maceHit
	
	if tLimbs[lco] &gt;= 98 then
		cecho("\n&lt;a_red&gt; &gt;&gt; [ &lt;a_darkcyan&gt;"..target:upper().."'S "..limbhit:upper().." HAS BEEN BROKEN &lt;a_red&gt; ] &lt;&lt;")
		target_limbBroke(limbhit)
	end
	targetLimbs_updateTimers(limbhit)  
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Limb Data/Scripting</name>
												<packageName></packageName>
												<script>function ataxia_resetLimbTable()
  ataxiaTables.limbData = {
    --Shikudo Attacks
    shikThrust = 10,
    shikDart = 10,
    shikFlashheel = 10,
    shikRisingkick = 10,
    shikHiraku = 10,
    shikHiru = 10,
    shikRuku = 10,
    shikFrontkick = 10,
    shikKuro = 10,
    shikLivestrike = 10,
    shikNervestrike = 10,
    shikNeedle = 15,
    shikSpinkickHead = 20,
    shikSpinkickTorso = 13,
    shikJinzuku = 8,
    
    --Tekura Attacks
    tekuraSDK = 25,
    tekuraWWK = 25,
    tekuraAXK = 25,
    tekuraSNK = 25,
    tekuraMNK = 25,
    tekuraHKP = 14,
    tekuraUCP = 14,
    tekuraHFP = 14,
    tekuraSPP = 14,
    
    --Bard
    
    bardRapier = 8,
    
    --Knights
    snbSlice = 8,
    twoHander = 10,
    dwcSlash = 8,
    dwbWhirl = 20,
    dwbMWhirl = 14,
    dwbFWhirl = 22,
    
    --Blademaster
    bmCompass = 19,
    bmSlash = 20,
    bmOffSlash = 13,
    
    bmBaseCompass = 0,
    bmBaseSlash = 0,
    bmBaseOffSlash = 0,
    
    --Forestal
    metaMaul = 25,
    thornrend = 25,
    sentSpear = 9,
    sentTrip = 5,
    
    --Other
    dragonRend = 30,  
    weaponryAxe = 15,
    priestSmite = 14,
    psionweaves = 25,
  }
  cecho("\n&lt;DodgerBlue&gt; &gt;&gt; &lt;a_green&gt;limb values reset &lt;DodgerBlue&gt;&lt;&lt;")
end

function ataxia_updateLimbHit(attack, value)
  ataxiaTables.limbData[attack] = value
end

function ataxia_shortLimb(limb)
	local limbs = {
		["head"] = "H",
		["torso"] = "T",
		["left leg"] = "LL",
		["right leg"] = "RL",
		["left arm"] = "LA",
		["right arm"] = "RA",
	}
  return limbs[limb:lower()] or "H"
end

function ataxia_addLimbDamage(attack, limb)	
  local l = ataxia_shortLimb(limb)
  local x = ataxiaTables.limbData[attack]
  tLimbs[l] = tLimbs[l] + x
  if tLimbs[l] &gt; 99.9 then
    cecho("\n&lt;red&gt; -= "..limb.." broke! =-")
    if limb == "head" then tAffs.stupidity = true end
		target_limbBroke(limb)
  end
  targetLimbs_updateTimers(limb)
end

function limbPrepped(limb, attack)
  local l = ataxia_shortLimb(limb)
  local x = ataxiaTables.limbData[attack] or 1
  return (tLimbs[l] + x &gt;= 100)
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Sentinel Limb Data</name>
												<packageName></packageName>
												<script>--Currently this is only for level 3.

function sentinel_setBreakpoint(maxhp)
  local spearDmg = linearFit(maxhp)
  local tripDmg = spearDmg/2
  local axeDmg = math.round(.166*maxhp+412, 0)

  axeDmg = (axeDmg/maxhp)*100
  axeDmg = tonumber( string.format("%2.2f", axeDmg) )
  spearDmg = tonumber( string.format("%2.2f", spearDmg) )
  tripDmg = tonumber( string.format("%2.2f", tripDmg) )

  ataxiaTemp.sentinelDamage = {
    spear = spearDmg,
    trip = tripDmg,
    axe = axeDmg
  }
  
end

function sentinel_hitLimb(attack, limb)
  local limbs = {
    ["head"] = "H",
    ["torso"] = "T",
    ["left leg"] = "LL",
    ["right leg"] = "RL",
    ["left arm"] = "LA",
    ["right arm"] = "RA",
  }
  local l = limbs[limb]
  local x = ataxiaTemp.sentinelDamage[attack]
  
  tLimbs[l] = tLimbs[l] + x
    
  if tLimbs[l] &gt; 99.99 then
    cecho("\n&lt;red&gt; -= "..limb.." broke! =-")
    if limb == "head" then tAffs.stupidity = true end
    target_limbBroke(limb)
    targetLimbs_updateTimers(limb)
  else
    cecho("&lt;NavajoWhite&gt; [ @"..tLimbs[l].."%&lt;NavajoWhite&gt;]\n")
    targetLimbs_updateTimers(limb)
  end
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Sylvan Limbcounting</name>
												<packageName></packageName>
												<script>function sylvan_setBreakpoint(maxhp)
  local breakIn = 0
  if maxhp &gt;= 7000 then
    breakIn = 4.5
  elseif maxhp &lt;= 3500 then
    breakIn = 3
  else
    breakIn = 4
  end
  
  ataxiaTemp.sylvanRend = tonumber( string.format("%2.2f", 100/breakIn) )
  
end

function sylvan_hitLimb(limb)
  local limbs = {
    ["head"] = "H",
    ["torso"] = "T",
    ["left leg"] = "LL",
    ["right leg"] = "RL",
    ["left arm"] = "LA",
    ["right arm"] = "RA",
  }
  local l = limbs[limb]
  local x = (haveAff("vinewreathe") and ataxiaTemp.sylvanRend/2 or ataxiaTemp.sylvanRend)
  
  tLimbs[l] = tLimbs[l] + x
    
  if tLimbs[l] &gt; 99 then
    cecho("\n&lt;red&gt; -= "..limb.." broke! =-")
    if limb == "head" then tAffs.stupidity = true end
    target_limbBroke(limb)
  end
  targetLimbs_updateTimers(limb)
end

function sylvan_propagateAff()
  local list = {
    kelp = "healthleech",
    bellwort = "weariness",
    valerian = "slickness",
    lobelia = "vertigo",
    elm = "dizziness",
    goldenseal = "epilepsy",
    hawthorn = "sensitivity",
  }
  local arm = ataxiaTemp.currentProps.arms
  if list[arm] then
    return list[arm]
  else
    return false
  end
end</script>
												<eventHandlerList />
											</Script>
										</ScriptGroup>
										<ScriptGroup isActive="yes" isFolder="yes">
											<name>Monk</name>
											<packageName></packageName>
											<script>function monk_checkCombo(str)
  local sp = ataxia.settings.separator or "::"
  local aSplit = string.split(str, sp)
  local shik, tekStr = true, ""
  local comboList = false
  for _, com in pairs(aSplit) do
    if com:find("combo") then
      comboList = string.split(com)
      break
    end
  end
  
  if comboList then
    ataxiaTemp.shikCombo = {}
    local kicks = {"flashheel", "risingkick", "frontkick", "spinkick", "crescent"}
    local staff = {"shatter", "thrust", "dart", "hiraku", "hiru", "ruku", "kuro", "livestrike", "nervestrike", "needle", "jinzuku"}
    local tek = {"hrs", "hkp", "snk", "jbp", "sdk", "ucp", "pmp", "hfp", "cts", "rhk", "swk", "brs",
      "slt", "mnk", "spp", "rts", "thk", "wrt", "axk", "scs", "wwk", "blp", "bbt", "jpk", "drs"}
    local hit = ""
    
    for num, act in pairs(comboList) do
      if table.contains(kicks, act) then
        ataxiaTemp.shikCombo.kick = act
      elseif table.contains(staff, act) then
        if comboList[num+1] == "light" then
          hit = act.." light"
        else
          hit = act
        end
        if ataxiaTemp.shikCombo.attackone then
          ataxiaTemp.shikCombo.attacktwo = hit
        else
          ataxiaTemp.shikCombo.attackone = hit
        end
      elseif table.contains(tek, act) then
        tekStr = tekStr.." &lt;green&gt;(&lt;NavajoWhite&gt;"..act
        if comboList[num+1] == "left" or comboList[num+1] == "right" then
          tekStr = tekStr.." "..comboList[num+1]
        end
        tekStr = tekStr.."&lt;green&gt;)"
      end
    end
    if table.contains(comboList, "sweep") then
      ataxiaTemp.shikCombo.attackone = "sweep"; ataxiaTemp.shikCombo.attacktwo = "sweep"
    end
    if not ataxiaBasher.enabled then
      cecho("\n&lt;a_darkblue&gt;[&lt;DimGrey&gt;"..comboList[2]:upper().."&lt;a_darkblue&gt;]: ")
      if tekStr == "" then
        cecho("&lt;DimGrey&gt;"..(ataxiaTemp.shikCombo.kick and ataxiaTemp.shikCombo.kick.." - " or ""))
        cecho("&lt;DimGrey&gt;"..(ataxiaTemp.shikCombo.attackone and ataxiaTemp.shikCombo.attackone.." - " or ""))
        cecho("&lt;DimGrey&gt;"..(ataxiaTemp.shikCombo.attacktwo and ataxiaTemp.shikCombo.attacktwo.."." or "."))
      else
        cecho("&lt;DimGrey&gt;"..tekStr..".")
      end
    end
  end
end</script>
											<eventHandlerList />
											<Script isActive="yes" isFolder="no">
												<name>Tekura Limb Counter</name>
												<packageName></packageName>
												<script>function tekura_addDamage(attack, limb)
  local limbs = {
    ["head"] = "H",
    ["torso"] = "T",
    ["left leg"] = "LL",
    ["right leg"] = "RL",
    ["left arm"] = "LA",
    ["right arm"] = "RA",
  }
  local l = limbs[limb]

  if not tekura_limbDamage[attack] then
    ataxiaEcho("Formula for "..attack.." not calculated?")
  else
    local x = tekura_limbDamage[attack]
  
    tLimbs[l] = tLimbs[l] + x
    
    if tLimbs[l] &gt; 99.99 then
      cecho("\n&lt;red&gt; -= "..limb.." broke! =-")
      if limb == "head" then tAffs.stupidity = true end
			target_limbBroke(limb)
      targetLimbs_updateTimers(limb)
    else
			cecho("&lt;NavajoWhite&gt; [@ &lt;purple&gt;"..tLimbs[l].."%&lt;NavajoWhite&gt;]")
      targetLimbs_updateTimers(limb)
    end
  end
end
</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Shikudo Limb Counter</name>
												<packageName></packageName>
												<script>function shikudo_addDamage(attack, limb)
	local limbs = {
		["head"] = "H",
		["torso"] = "T",
		["left leg"] = "LL",
		["right leg"] = "RL",
		["left arm"] = "LA",
		["right arm"] = "RA",
	}
	local l = limbs[limb]

  if not shikudo_limbDamage[attack] then
    ataxiaEcho("Formula for "..attack.." not calculated?")
  else
    local x = shikudo_limbDamage[attack]
    if ataxia.defences.hyperfocus and ataxiaTemp.hyperLimb == limb then
      x = x/2
    end
    
    tLimbs[l] = tLimbs[l] + x
    
    if tLimbs[l] &gt; 99.8 then
      cecho("\n&lt;red&gt; -= "..limb.." broke! =-")
      if limb == "head" then tAffs.stupidity = true end
			target_limbBroke(limb)
      targetLimbs_updateTimers(limb)
    else
      targetLimbs_updateTimers(limb)
    end
  end
end


function shikudo_breakPoint(health)
	shikudo_limbDamage = {}
  local staffMod = ataxia.shikudoLevel or 1
  
  shikudo_limbDamage.dart           = math.floor((.0440*health+156)*staffMod)
  shikudo_limbDamage.spinkicktorso  = math.floor((.0910*health+145)*staffMod)
  shikudo_limbDamage.spinkickhead   = math.floor((.2700*health+457)*staffMod)
  shikudo_limbDamage.thrust         = math.floor((.111*health+187)*staffMod)
  shikudo_limbDamage.needle         = math.floor((.1057*health+295)*staffMod)
  shikudo_limbDamage.risingkick     = math.floor((.0451*health+261)*staffMod)
  shikudo_limbDamage.flashheel      = math.floor((.0451*health+261)*staffMod)
  shikudo_limbDamage.frontkick      = math.floor((.0451*health+261)*staffMod)
  shikudo_limbDamage.kuro           = math.floor((.0451*health+261)*staffMod)
  shikudo_limbDamage.jinzuku        = math.floor((.0451*health+261)*staffMod) 
  shikudo_limbDamage.ruku           = math.floor((.0451*health+261)*staffMod)
  shikudo_limbDamage.hiraku         = math.floor((.04260*health+290)*staffMod)
  shikudo_limbDamage.hiru           = math.floor((.04260*health+290)*staffMod)
  shikudo_limbDamage.livestrike     = math.floor((.0775*health+360)*staffMod)
  shikudo_limbDamage.nervestrike    = math.floor((.0775*health+360)*staffMod)

  for atk, dmg in pairs(shikudo_limbDamage) do
    shikudo_limbDamage[atk] = (shikudo_limbDamage[atk]/health)*100
    shikudo_limbDamage[atk] = tonumber( string.format("%2.2f", shikudo_limbDamage[atk]) )
  end
  cecho("  &lt;red&gt;"..utf8.char(186).."&lt;yellow&gt;"..utf8.char(186).."&lt;green&gt;"..utf8.char(186))
end

function shikudo_findCombo(queuedAttack)
  local sp = ataxia.settings.separator or "::"
  local shikSplit = string.split(queuedAttack, sp)
  local shikudoCombo = false
  for _, com in pairs(shikSplit) do
    if com:find("combo") then
      shikudoCombo = string.split(com)
      break
    end
  end
  
  if shikudoCombo then
    ataxiaTemp.shikCombo = {}
    local kicks = {"flashheel", "risingkick", "frontkick", "spinkick", "crescent"}
    local staff = {"shatter", "thrust", "dart", "hiraku", "hiru", "ruku", "kuro", "livestrike", "nervestrike", "needle", "jinzuku"}
    local hit = ""
    for num, act in pairs(shikudoCombo) do
      if table.contains(kicks, act) then
        ataxiaTemp.shikCombo.kick = act
      elseif table.contains(staff, act) then
        if shikudoCombo[num+1] == "light" then
          hit = act.." light"
        else
          hit = act
        end
        if ataxiaTemp.shikCombo.attackone then
          ataxiaTemp.shikCombo.attacktwo = hit
        else
          ataxiaTemp.shikCombo.attackone = hit
        end
      end
    end
    if table.contains(shikudoCombo, "sweep") then
      ataxiaTemp.shikCombo.attackone = "sweep"; ataxiaTemp.shikCombo.attacktwo = "sweep"
    end
    if not ataxiaBasher.enabled then
      cecho("\n&lt;a_darkblue&gt;[&lt;DimGrey&gt;"..shikudoCombo[2]:upper().."&lt;a_darkblue&gt;]: ")
      cecho("&lt;DimGrey&gt;"..(ataxiaTemp.shikCombo.kick and ataxiaTemp.shikCombo.kick.." - " or ""))
      cecho("&lt;DimGrey&gt;"..(ataxiaTemp.shikCombo.attackone and ataxiaTemp.shikCombo.attackone.." - " or ""))
      cecho("&lt;DimGrey&gt;"..(ataxiaTemp.shikCombo.attacktwo and ataxiaTemp.shikCombo.attacktwo.."." or "."))
    end
    --display(shikudoCombo)
  end
end

function shikudo_lightAttack(atkName)
  if ataxiaTemp.shikCombo.attackone and ataxiaTemp.shikCombo.attackone:find(atkName) then
    if ataxiaTemp.shikCombo.attackone:find("light") then
      return true       
    end
    ataxiaTemp.shikCombo.attackone = nil
  elseif ataxiaTemp.shikCombo.attacktwo and ataxiaTemp.shikCombo.attacktwo:find(atkName) then
    if ataxiaTemp.shikCombo.attacktwo:find("light") then
      return true
    end
    ataxiaTemp.shikCombo.attacktwo = nil   
  end
  return false
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Shikudo Extras</name>
												<packageName></packageName>
												<script>function shikudo_checkForms()
  local k = ataxia.vitals.kata
  local f = ataxia.vitals.form:lower()
  local nextForm = {
    tykonos = {"Willow"},
    willow = {"Rain"},
    rain = {"Tykonos", "Oak"},
    oak = {"Willow", "Gaital"},
    gaital = {"Rain", "Maelstrom"},
    maelstrom = {"Oak"},
  }
  if k &gt; 5 or k == 0 then
    cecho("\n&lt;orange&gt;[&lt;green&gt;"..ataxia.vitals.form.."&lt;orange&gt;]: &lt;NavajoWhite&gt;"..table.concat(nextForm[f], " -- ").."")
  end
end</script>
												<eventHandlerList />
											</Script>
										</ScriptGroup>
										<Script isActive="yes" isFolder="no">
											<name>Miscellaneous Aff Tracking Methods</name>
											<packageName></packageName>
											<script>--In-testing function for Psion bleed tracking. May or may not work.
function psion_bleedAdd(num)
	local tobleed = tonumber(num)
	tAffs.bleed = tAffs.bleed or 0
	tAffs.bleed = tAffs.bleed + tobleed
	
	if not haveAff("haemophilia") and tAffs.bleed &gt;= 100 then
		tAffs.bleed = tAffs.bleed - 50
    if tAffs.bleed &lt; 0 then
      tAffs.bleed = 0
    end
	end
end	

--For the purpose of enlighten tracking.
function checkInstills()
  local x = 0
  for _, aff in pairs({"asthma", "clumsiness", "slickness", "darkshade", "healthleech", "paralysis", "sensitivity"}) do
    if haveAff(aff) then
      x = x + 1
    end
  end
  return x
end

function checkEnlighten()
	local enlightenAffs = {
    "claustrophobia", "agoraphobia", "lovers", "dementia", "epilepsy", "hallucinations", "confusion", "stupidity",
    "paranoia", "vertigo", "shyness", "addiction", "recklessness", "masochism"  
  }

	local c = 0
	local need = (haveAff("whisperingmadness") and 4 or 5)
  
	for _, aff in pairs(enlightenAffs) do
		if haveAff(aff) then
			c = c + 1
		end
	end
	
	if c &gt;= need then 
    return true 
	else 
		return false 
	end
	
end

function getTzantzaAffs()
	local c = 0
	local tzantza = {"agoraphobia", "amnesia", "claustrophobia", "confusion", "dementia", "dizziness", "epilepsy", "impatience",
		"masochism", "paranoia", "recklessnesS", "stupidity", "vertigo", "addiction"}

	for i,v in pairs(tzantza) do
		if haveAff(v) then
			c = c + 1
		end
	end
	return c
end

function getLatchAffs()
	local c = 0
	local latch = {"addiction", "haemophilia", "nausea", "lethargy"}
	
	for _, aff in pairs(latch) do
		if haveAff(aff) then
			c = c + 1
		end
	end
	return c
end

function getMentalAffCount()
	local c = 0
	local mentals = {"agoraphobia", "anorexia", "claustrophobia", "confusion", "dementia", "dizziness", "epilepsy", "hallucinations", 
		"impatience", "loneliness", "masochism", "paranoia", "recklessness", "shyness", "stupidity", "vertigo"}

	for _, aff in pairs(mentals) do
		if haveAff(aff) then
			c = c + 1
		end
	end
	return c
end

function getAffsFromTree(tree)
  if not curingTable[tree] then return 0 end
  local c = 0
  for _, aff in pairs(curingTable[tree]) do
    if haveAff(aff) then
      c = c + 1
    end
  end
  return c  
end

function checkAffList(afflictions, number)
  if number == 0 then return true end
  if type(afflictions) ~= "table" then return false end
  if not number then number = 1 end
  
  local count = 0
  for _, aff in pairs(afflictions) do
    if haveAff(aff) then
      count = count + 1
    end
  end
  if count &gt;= number then
    return true
  else
    return false
  end
end

function tarNeedsWeariness()
	local wc = {"Monk", "Runewarden", "Infernal", "Paladin", "Blademaster", "Serpent"}
	if ataxiaNDB and ataxiaNDB_Exists(target) then
		local gClass = ataxiaNDB_getClass(target)
		if table.contains(wc, gClass) then
			return true
		else
			return false
		end
	else
		return false
	end
end

--Works both ways. curseConvert("clumsy") will return clumsiness.
-- curseConvert("clumsiness") will return clumsy.
function toCurse(curse)
	local curses = {
		paralyse = "paralysis",
		vomiting = "nausea",
		stupid = "stupidity",
		clumsy = "clumsiness",
		dizzy = "dizziness",
		plague = "voyria",
    reckless = "recklessness",
	}
  for a, c in pairs(curses) do
    if a == curse then
      return c
    elseif c == curse then
      return a
    end
  end
  return curse
end
--Merely for the triggers. The above is for aliases.
function curseConvert(curse)
	local curses = {
		paralyse = "paralysis",
		vomiting = "nausea",
		stupid = "stupidity",
		clumsy = "clumsiness",
		dizzy = "dizziness",
		plague = "voyria",
    reckless = "recklessness",
	}
  for a, c in pairs(curses) do
    if a == curse then
      return c
    end
  end
  return curse
end

function venom_to_aff(venom)
	local affC
	local venom_to_affliction = {
		xentio = "clumsiness",			eurypteria = "recklessness",
		kalmia = "asthma",					digitalis = "shyness",
		darkshade = "darkshade",			curare = "paralysis",
		prefarar = "sensitivity",		monkshood = "disloyalty",
		euphorbia = "nausea",				vernalius = "weariness",
		larkspur = "dizziness",			slike = "anorexia",
		notechis = "haemophilia",		vardrax = "addiction",
		aconite = "stupidity",			gecko = "slickness",
		voyria = "voyria",					delphinium = "sleep",
		nechamandra = "shivering",	scytherus = "scytherus",
		epseth = "legbreak",				epteth = "armbreak",
    selarnia = "selarnia",
	}
	for i,v in pairs(venom_to_affliction) do
		if i == venom then
			affC = v
			break
		elseif v == venom then
			affC = i
			break
		end
	end
	
	if affC == "epseth" or affC == "legbreak" then
		if haveAff("brokenleftleg") or tAffs.damagedleftleg then
			affC = "brokenrightleg"
		else
			affC = "brokenleftleg"
		end
	
  elseif affC == "epteth" or affC == "armbreak" then
		if haveAff("brokenleftarm") or tAffs.damagedleftarm then
			affC = "brokenrightarm"
		else
			affC = "brokenleftarm"
		end
	end
	
	return affC
end

function psionBlastCount()
	local cnt = 0
	local dis = {"impatience", "stupidity", "blackout", "dizziness", "epilepsy", "unweavingmind"}
	for i,v in pairs(dis) do
		if tAffs[v] then
			cnt = cnt + 1
		end
	end
	return cnt
end

function petrifyCount()
	local cnt = 0
	local dis = {"dizziness", "recklessness", "confusion", "epilepsy", "impatience", "hallucinations", "paranoia"}
	for i,v in pairs(dis) do
		if tAffs[v] then
			cnt = cnt + 1
		end
	end
	return cnt
end

function paAff(affGave)
	local affC = false
	local venom_to_affliction = {
		xentio = "clumsiness",			eurypteria = "recklessness",
		kalmia = "asthma",					digitalis = "shyness",
		darkshade = "darkshade",			curare = "paralysis",
		prefarar = "sensitivity",		monkshood = "disloyalty",
		euphorbia = "nausea",				vernalius = "weariness",
		larkspur = "dizziness",			slike = "anorexia",
		notechis = "haemophilia",		vardrax = "addiction",
		aconite = "stupidity",			gecko = "slickness",
		voyria = "voyria",					delphinium = "sleep",
    selarnia = "selarnia",
	}

	for i,v in pairs(venom_to_affliction) do
		if i == affGave:lower() then
			affC = v
			break
		end
	end

	if not affC then
		if not tAffs[affGave] then
			tAffs[affGave] = true
			cecho(" &lt;green&gt;+"..affGave.."+")
		end
	else
		if not tAffs[affC] then
			tAffs[affC] = true
			cecho(" &lt;green&gt;+"..affC.."+")
		end
	end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Sentinel-specific</name>
											<packageName></packageName>
											<script>function haveAnimal(what)
	if table.contains(sAnimals, what) then
		return true
	else
		return false
	end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Queueing Related</name>
											<packageName></packageName>
											<script>function combatQueue()
	local sp = ataxia.settings.separator

  local t = "g body"..sp.."g gold"..sp.."stand"..sp
  
  --Deliverance
  if tdeliverance == true then
    if partyrelay and not ataxia.afflictions.aeon then
      send("pt "..target.. ": Has Deliverance - DO NOT HIT - Need NEW Target")
      send("pt "..target.. ": Has Deliverance - DO NOT HIT - Need NEW Target")
    end
  send("cq all")
  ataxiaEcho("TARGET HAS DELIVERANCE - PICKING NEW TARGET")
  expandAlias("nt")
  end
  --Jester Bomb
  if havebomb == true then
    send("cq all;put bomb in pack;put bomb in pack;put bomb in pack;put bomb in pack")
  end
  
  --Jester AEON Cheese \ OCCIE Wheel Cheese \ Sentinel Riftlock \ Pariah Voyria Kill
  if jestercheese == true or myaeon == true or preventriftlock == true or stoplatency == true then
    ataxiaEcho("CLASS CHEESE INCOMMING")
    if gmcp.Char.Status.class == "Magi" then
      send("cq all;cast reflection at me")
    else
    send("cq all;touch shield")
    end
  end
 if gmcp.Char.Status.class == "Psion" then 
 if affed("asthma") and (affed("slickness") or affed("bloodfire")) and affed("anorexia") and affed("paralysis") and affed("impatience") or affed("sandfever") then
  send("cq all;psi manipulate touch tree")
 end
 end
   
   
   
	if ataxia.settings.use.parry and ataxia.parry ~= "manual" then
		if ataxia.parrying.shouldparry ~= ataxia.parrying.limb then
			t = t.." " ..sp.." parry " ..ataxia.parrying.shouldparry..sp
		end
	end

	if tChaseTimer and not targetIshere then
      if dir_left ~= "fly" and dir_left ~= "ether" and dir_left ~= "forcefly" then
			t = t..dir_left..sp
		elseif dir_left == "forcefly" and not affed("tension") then
			t = t.."land"..sp
		elseif dir_left == "fly" then
			if ataxia_isClass("Alchemist") then
				t = t.."educe lead "..target
			elseif ataxia_isClass("Psion") then
				t = t.."weave prepare disruption"..sp.."weave launch "..target
       
			else
				t = t.."touch tentacle "..target..sp
			end
		end
	end

	return t
end

function depthswalkerQueue()
	local sp = ataxia.settings.separator
	local t = "stand"..sp

	if ataxia.settings.use.parry and ataxia.parry ~= "manual" then
		if ataxia.parrying.shouldparry ~= ataxia.parrying.limb then
			t = t.."parry "..ataxia.parrying.shouldparry..sp
		end
	end

	if tChaseTimer and not targetIshere then
		if dir_left ~= "fly" and dir_left ~= "ether" and dir_left ~= "forcefly" then
			t = t..dir_left..sp
		elseif dir_left == "forcefly" and not affed("tension") then
			t = t.."land"..sp
		elseif dir_left == "fly" and ataxiaTables.depthswalker.wordBal and haveWord("heila") then
			t = t.."intone heila"..sp
		else
			t = t.."touch tentacle "..target..sp
		end
	end
	
	if haveAff("shield") or attuningPerson then
		t = t.."wield shield dagger"..sp
		attuningPerson = nil
	else
		t = t.."wield shield scythe"..sp.."wipe scythe"..sp
	end
	return t
end

function resetNeededAffs()
	tarNeeds = {}
	table.insert(tarNeeds, "paralysis")
	table.insert(tarNeeds, "impatience")
	table.insert(tarNeeds, getLockingAffliction())
	table.insert(tarNeeds, "asthma")
	table.insert(tarNeeds, "vertigo")
	table.insert(tarNeeds, "dizziness")
	table.insert(tarNeeds, "anorexia")
	table.insert(tarNeeds, "slickness")
end

function predictBal(bal, time)
  balTime = balTime or {}
  balTime[bal] = getEpoch() + time
end

function getPredictBal(bal)
  return balTime[bal] or getEpoch() + 0.01
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Firelord Stuff</name>
											<packageName></packageName>
											<script>--if string.find(ataxiaTemp.class, "fire") then ataxiaTemp.firelord = {} end

function firelord_Branded()
  cinsertText("&lt;maroon&gt;BRAND&lt;white&gt;0 &lt;brown&gt;| ")
  ataxiaTemp.firelord.brand = 0
end

function firelord_Lower()
  ataxiaTemp.firelord.brand = ataxiaTemp.firelord.brand - 1
  if ataxiaTemp.firelord.brand &lt;= 0 then
    cinsertText("&lt;maroon&gt;BRAND&lt;white&gt;0 &lt;brown&gt;| ")
  elseif ataxiaTemp.firelord.brand &lt;= 1 then
    cinsertText("&lt;maroon&gt;BRAND&lt;yellow&gt;"..ataxiaTemp.firelord.brand.." &lt;brown&gt;| ")
  elseif ataxiaTemp.firelord.brand &lt;= 3 then
    cinsertText("&lt;maroon&gt;BRAND&lt;orange&gt;"..ataxiaTemp.firelord.brand.." &lt;brown&gt;| ")
  else
    cinsertText("&lt;maroon&gt;BRAND&lt;red&gt;"..ataxiaTemp.firelord.brand.." &lt;brown&gt;| ")
  end
end

function firelord_Raise()
  ataxiaTemp.firelord.brand = ataxiaTemp.firelord.brand + 1
  if ataxiaTemp.firelord.brand &gt;= 4 then ataxiaTemp.firelord.brand = 4 end
  if ataxiaTemp.firelord.brand &lt;= 0 then
    cinsertText("&lt;maroon&gt;BRAND&lt;white&gt;0 &lt;brown&gt;| ")
  elseif ataxiaTemp.firelord.brand &lt;= 1 then
    cinsertText("&lt;maroon&gt;BRAND&lt;yellow&gt;"..ataxiaTemp.firelord.brand.." &lt;brown&gt;| ")
  elseif ataxiaTemp.firelord.brand &lt;= 3 then
    cinsertText("&lt;maroon&gt;BRAND&lt;orange&gt;"..ataxiaTemp.firelord.brand.." &lt;brown&gt;| ")
  else
    cinsertText("&lt;maroon&gt;BRAND&lt;red&gt;"..ataxiaTemp.firelord.brand.." &lt;brown&gt;| ")
  end
  if ataxiaTemp.firelord.brand == 4 then cecho("\n     &lt;orange&gt;-=&lt;yellow&gt; brand is maxed&lt;orange&gt;=-") end
end

--[[
function tarGained(event, affList )
	if not affs_to_colour then populate_aff_colours() end
	
	local cstring = "&lt;maroon&gt;["
	
	if event == "tar afflicted" then
		for num, aff in pairs(affList) do
			if affs_to_colour[aff] then
				cstring = cstring.."&lt;"..affs_to_colour[aff][1].."&gt;"..affs_to_colour[aff][2]:upper()
			else
				cstring = cstring.."&lt;white&gt;"..string.sub(aff, 1, 3):upper()
			end
			if num ~= #affList then cstring = cstring.."&lt;maroon&gt;|" end
		end
		cstring = cstring.."&lt;maroon&gt;] "
		cinsertText(cstring)
	end
	
	if ataxiaTemp.showingAffs then
		displayTargetAffs()
	end
end]]</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Affliction Relapses for Two-handed</name>
											<packageName></packageName>
											<script>function twohanded_headHit()
  if ataxiaTables.fractureTimers.skull then killTimer(ataxiaTables.fractureTimers.skull) end
  
  if ataxiaTemp.fractures.skullfractures == 1 then
			ataxiaTables.fractureTimers.skull = tempTimer(5, [[twohanded_skullRelapse()]])
      
	elseif ataxiaTemp.fractures.skullfractures == 2 then
			ataxiaTables.fractureTimers.skull = tempTimer(4, [[twohanded_skullRelapse()]])
      
	elseif ataxiaTemp.fractures.skullfractures == 3 then
			ataxiaTables.fractureTimers.skull = tempTimer(3, [[twohanded_skullRelapse()]])
      
	elseif ataxiaTemp.fractures.skullfractures == 4 then
			ataxiaTables.fractureTimers.skull = tempTimer(2, [[twohanded_skullRelapse()]])
      
	elseif ataxiaTemp.fractures.skullfractures &gt;= 5 then
			ataxiaTables.fractureTimers.skull = tempTimer(1, [[twohanded_skullRelapse()]])
	end 
end

function twohanded_armsHit()
  if ataxiaTables.fractureTimers.wrist then killTimer(ataxiaTables.fractureTimers.wrist) end
  
  if ataxiaTemp.fractures.wristfractures == 1 then
			ataxiaTables.fractureTimers.wrist = tempTimer(5, [[twohanded_wristRelapse()]])
      
	elseif ataxiaTemp.fractures.wristfractures == 2 then
			ataxiaTables.fractureTimers.wrist = tempTimer(4, [[twohanded_wristRelapse()]])
      
	elseif ataxiaTemp.fractures.wristfractures == 3 then
			ataxiaTables.fractureTimers.wrist = tempTimer(3, [[twohanded_wristRelapse()]])
      
	elseif ataxiaTemp.fractures.wristfractures == 4 then
			ataxiaTables.fractureTimers.wrist = tempTimer(2, [[twohanded_wristRelapse()]])
      
	elseif ataxiaTemp.fractures.wristfractures &gt;= 5 then
			ataxiaTables.fractureTimers.wrist = tempTimer(1, [[twohanded_wristRelapse()]])
	end 
end

function twohanded_torsoHit()
  if ataxiaTables.fractureTimers.torso then killTimer(ataxiaTables.fractureTimers.torso) end
  
  if ataxiaTemp.fractures.crackedribs == 1 then
			ataxiaTables.fractureTimers.torso = tempTimer(5, [[twohanded_torsoRelapse()]])
      
	elseif ataxiaTemp.fractures.crackedribs == 2 then
			ataxiaTables.fractureTimers.torso = tempTimer(4, [[twohanded_torsoRelapse()]])
      
	elseif ataxiaTemp.fractures.crackedribs == 3 then
			ataxiaTables.fractureTimers.torso = tempTimer(3, [[twohanded_torsoRelapse()]])
      
	elseif ataxiaTemp.fractures.crackedribs == 4 then
			ataxiaTables.fractureTimers.torso = tempTimer(2, [[twohanded_torsoRelapse()]])
      
	elseif ataxiaTemp.fractures.crackedribs &gt;= 5 then
			ataxiaTables.fractureTimers.torso = tempTimer(1, [[twohanded_torsoRelapse()]])
	end 
end

function twohanded_legsHit()
  if ataxiaTables.fractureTimers.legs then killTimer(ataxiaTables.fractureTimers.legs) end
  
  if ataxiaTemp.fractures.torntendons == 1 then
			ataxiaTables.fractureTimers.legs = tempTimer(5, [[twohanded_legsRelapse()]])
      
	elseif ataxiaTemp.fractures.torntendons == 2 then
			ataxiaTables.fractureTimers.legs = tempTimer(4, [[twohanded_legsRelapse()]])
      
	elseif ataxiaTemp.fractures.torntendons == 3 then
			ataxiaTables.fractureTimers.legs = tempTimer(3, [[twohanded_legsRelapse()]])
      
	elseif ataxiaTemp.fractures.torntendons == 4 then
			ataxiaTables.fractureTimers.legs = tempTimer(2, [[twohanded_legsRelapse()]])
      
	elseif ataxiaTemp.fractures.torntendons &gt;= 5 then
			ataxiaTables.fractureTimers.legs = tempTimer(1, [[twohanded_legsRelapse()]])
	end 
end

function twohanded_skullRelapse()
  twohanded_headHit()
  send("echo "..target.."'s skull fractures relapsed nausea.",false)
  tarAffed("nausea")
end

function twohanded_wristRelapse()
  twohanded_armsHit()
  send("echo "..target.."'s wrist fractures relapsed lethargy.",false)
  tarAffed("lethargy")
end

function twohanded_torsoRelapse()
  twohanded_torsoHit()
  send("echo "..target.."'s cracked ribs relapsed sensitivity.",false)
  tarAffed("sensitivity")
end

function twohanded_legsRelapse()
  twohanded_legsHit()
  send("echo "..target.."'s torn tendons relapsed clumsiness.",false)
  tarAffed("clumsiness")
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Twohander Fractures</name>
											<packageName></packageName>
											<script>function twohanded_increaseFracture(what, count)
  if not ataxiaTemp.fractures then return end
  
  ataxiaTemp.fractures[what] = ataxiaTemp.fractures[what] + count 
  if ataxiaTemp.fractures[what] &gt;= 7 then ataxiaTemp.fractures[what] = 7 end
  
  twohanded_displayFracture(what)
end

function twohanded_decreaseFracture(what)
  if not ataxiaTemp.fractures then return end
  
  ataxiaTemp.fractures[what] = ataxiaTemp.fractures[what] -1 
  if ataxiaTemp.fractures[what] &lt; 0 then ataxiaTemp.fractures[what] = 0 end
  
  twohanded_displayFracture(what)
end

function twohanded_resetFractures()
  ataxiaTemp.fractures = {
    skullfractures = 0,
    wristfractures = 0,
    torntendons = 0,
    crackedribs = 0,
  }
  twohanded_headHit()
  twohanded_torsoHit()
  twohanded_armsHit()
  twohanded_legsHit()
end

function twohanded_displayFracture(what)
  local tc = ataxiaTemp.fractures[what]
  local cstring = ""
  
  if tc &lt; 2 then
    cstring = "&lt;SeaGreen&gt;"
  elseif tc &lt; 4 then
    cstring = "&lt;yellow&gt;"
  elseif tc &lt; 6 then
    cstring = "&lt;orange&gt;"
  else
    cstring = "&lt;red&gt;"
  end
  
  if what == "crackedribs" then
    cstring = cstring.."CR "
  elseif what == "torntendons" then
    cstring = cstring.."TT "
  elseif what == "wristfractures" then
    cstring = cstring.."WF "
  else
    cstring = cstring.."SF "
  end
  cstring = cstring..tc.."&lt;NavajoWhite&gt;| "
  
  cinsertText(cstring)
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Pariah things</name>
											<packageName></packageName>
											<script>function ataxia_resetPariah()
  if pariah then
    if pariah.infest then killTimer(pariah.infest) end
    if pariah.ensorcell then killTimer(pariah.ensorcell) end
  end 
  pariah = {
    bladePrepared = false,
    burrow = false
  }
  ataxia_Echo("Reset pariah variables.")
  send("swarms",false)
end

function pariah_canGraph(logo)
  local graphs = {
    serpent = {"nest", "skein"},
    bear = {"jackal", "scarab"},
    sun = {"serpent"},
    nest = {"bear", "scales"},
    scales = {"skein"},
    skein = {"scarab"},
    scarab = {"jackal", "scales"},
    jackal = {"serpent"},
  }
  if logo == "scorpion" then
    if ataxia.vitals.epitaph &gt;= 4 then
      return true
    else
      return false
    end
  elseif not pariah.lastLogograph then
    return true
  elseif table.contains(graphs[pariah.lastLogograph], logo) then
    return true
  else
    return false
  end
end

function pariah_canVirulence()
  if checkAffList({"rebbies", "sandfever", "flushings", "pyramides"}, 3) then
    return true
  else
    return false
  end
end  

function pariah_doVirulence()   
  local need = {"rebbies", "sandfever", "flushings", "pyramides"}
  local plague = false
  
  for _, aff in pairs(need) do
    if not haveAff(aff) then
      plague = aff
      break
    end
  end
  if not plague then plague = "mycalium" end
  return plague
end



</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Ataxia NDB</name>
									<packageName></packageName>
									<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Ataxia NDB Settings</name>
										<packageName></packageName>
										<script>function ataxiaNDB_Install()
	--Will only probably be used on initial loading of system.
	ataxiaNDB = {}
	ataxiaNDB = {
		installed = true,
		players = {},
		highlightNames = true,
		highlighting = {
			Ashtan = "purple",
			Cyrene = "CornflowerBlue",
			Eleusis = "a_darkgreen",
			Hashan = "orange",
			Mhaldor = "a_darkred",
			Targossas = "a_darkcyan",
			Enemies = "red",
			Rogues = "a_brown",
      Underworld = "a_brown",
		},
		special = {},
    player_Notes = {},
		divine = {"Aegis", "Artemis", "Aurora", "Babel", "Deucalion", "Gaia", "Lorielan", "Lupus", "Neraeos",
			"Ourania", "Pandora", "Phaestus", "Prospero", "Sartan", "Scarlatti", "Twilight", "Valnurana",
			"Vastar", "Tlalaiad", "Romeo", "Juliet",},
		cityEnemies = {},
		highlightPriority = "city",
		enemySettings = {bold = false, italics = false, underline = false},
	}

	ataxiaEcho("Systems have been loaded and are ready to go.")
	ataxiaNDB_Unhighlight()
	ataxia_saveSettings(false)
	--Save on install, as a failsafe.
  
	local path = getMudletHomeDir().."/ataxiaNDB"
	if not lfs.attributes(path) then
		--We'll need a folder to store downloaded data. Don't worry, it won't cause issues.
		lfs.mkdir(path)
	end    
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Get Information</name>
										<packageName></packageName>
										<script>function ataxiaNDB_GetOnline()
	local path = getMudletHomeDir().."/ataxiaNDB"

	if not lfs.attributes(path) then
		--We'll need a folder to store downloaded data. Don't worry, it won't cause issues.
		lfs.mkdir(path)
		ataxiaEcho("Created folder to store downloaded data at: "..path)
	end  
  
	downloadFile(path .. "/Online.json", "http://api.achaea.com/characters.json")

	ataxiaEcho("One moment while I access the list...")

	ndbWatcher = ndbWatcher or createStopWatch()
	startStopWatch(ndbWatcher)
end

function ataxiaNDB_Acquire(person)

	assert(person)
	local person = person:title()
	local path = getMudletHomeDir().."/ataxiaNDB"

	if not lfs.attributes(path) then
		--We'll need a folder to store downloaded data. Don't worry, it won't cause issues.
		lfs.mkdir(path)
		ataxiaEcho("Created folder to store downloaded data at: "..path)
	end
	
	downloadFile(path .. "/"..person..".json", "http://api.achaea.com/characters/"..person..".json")

end

function ataxiaNDB_NameList(names)
	--Parse list to see who isn't tracked.
	for _, name in pairs(names) do
		if not ataxiaNDB_Exists(name) and not table.contains(ataxiaNDB.divine, name) then
			ataxiaNDB_Acquire(name)
		end
	end
	ataxiaEcho("Database has been fully updated, thank you.")
end</script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>ataxiaNDB_Failed</name>
											<packageName></packageName>
											<script>function ataxiaNDB_Failed(_, filepath)
	ataxiaEcho("Error downloading information.")
	
	if filepath:match("server replied: Not Found") then
		echo("\n"..filepath)
		local person = filepath:match("/(%w+).json")
		local fpr = getMudletHomeDir().."/ataxiaNDB/"..person..".json"

		ataxiaEcho("This person does not exist: "..person)
		ataxiaNDB_Remove(person)
		os.remove(fpr)
	else
		ataxiaEcho("Unknown error while downloading: " .. filepath)
	end
end</script>
											<eventHandlerList>
												<string>sysDownloadError</string>
											</eventHandlerList>
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>ataxiaNDB_Success</name>
											<packageName></packageName>
											<script>function ataxiaNDB_Success(_, filepath)
	--Do not mess with if it's not ataxiaNDB information.
	if not filepath:find("ataxiaNDB", 1, true) then return end

	if filepath:find("Online",1,true) then
		ataxiaNDB_SortOnline(filepath)
		return
	end

    local f, s = io.open(filepath)
    if f then s = f:read("*l"); io.close(f) end

	-- didn't get JSON data? 
	if s:find("Internal error", 1, true) or s:find("DOCTYPE html PUBLIC", 1, true) then
		cecho("\n&lt;red&gt;Data Acquisition Failed!") 
		return 
	end

	local t = yajl.to_value(s)
	local cities = {"Ashtan", "Cyrene", "Eleusis", "Hashan", "Mhaldor", "Targossas", "Rogues","Underworld",}
	local name = t.name
	local title = t.fullname
	local house = t.house:title()
	local xp_rank = tonumber(t.xp_rank)
	local city = t.city:title()
	local class = t.class:title()
	local level = tonumber(t.level)
  local pks = tonumber(t.player_kills)

	local tmpCity = (ataxiaNDB_Exists(name) and ataxiaNDB_getCitizenship(name) or "Unknown")
  local isMark, aRank = ataxiaNDB_isMark(name), ataxiaNDB_armyRank(name)

	ataxiaNDB.players[name] = {
		name = name,
		title = title,
		house = house,
		xp_rank = xp_rank,
		city = city,
		level = level,
		class = class,
    pks = pks,
		lastUpdate = os.date(),
    armyRank = aRank or nil,
    mark = isMark or nil,
	}
	if house:find("hidden") then
		ataxiaNDB.players[name].house = "Unknown"
	elseif house:find("none") then
		ataxiaNDB.players[name].house = "None"
	else
		ataxiaNDB.players[name].house = house:title()
	end

	if city:find("hidden") then
		if not table.contains(cities, tmpCity) then
			ataxiaNDB.players[name].city = "Unknown"
			if honoursPerson == nil then ataxiaEcho("&lt;red&gt;WARNING: "..name.."'s city is hidden; will require a manual honours/setting to update it.") end
		else
      if tmpCity == "Rogues" then
        ataxiaNDB.players[name].city = "None"
      else
			 ataxiaNDB.players[name].city = tmpCity
      end
		end
	elseif city:find("none") or city == "" then
		ataxiaNDB.players[name].city = "None"
	else
		ataxiaNDB.players[name].city = city:title()
	end

  	os.remove(filepath)
	
	if honoursPerson ~= nil then 
		send("honours "..honoursPerson,false)
		tempTimer(3, [[honoursPerson = nil]])
	else
		raiseEvent("ataxiaNDB Check Highlight", t.name)
	end
  if ataxiaNDB.checking then
    ataxiaNDB_displayWho(name)
  end
end</script>
											<eventHandlerList>
												<string>sysDownloadDone</string>
											</eventHandlerList>
										</Script>
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>ataxiaNDB API</name>
										<packageName></packageName>
										<script>function ataxiaNDB_isMark(name)
  if not ataxiaNDB_Exists(name) then return false end
  if ataxiaNDB.players[name].mark then
    return ataxiaNDB.players[name].mark
  else
    return false
  end
end

function ataxiaNDB_armyRank(name)
  if not ataxiaNDB_Exists(name) then return 0 end
  if ataxiaNDB.players[name].armyRank then
    return ataxiaNDB.players[name].armyRank
  else
    return 0
  end
end

function ataxiaNDB_isEnemy(name)
	if table.contains(ataxiaNDB.cityEnemies, name) then
		return true
	else
		return false
	end
end

function ataxiaNDB_getHouse(name)
  if not ataxiaNDB_Exists(name) then
    return "Unknown"
  else
    return ataxiaNDB.players[name:title()].house 
  end
end

function ataxiaNDB_getColour(name)
	if not ataxiaNDB_Exists(name) then
		return "white"
	else
    if ataxiaNDB_getCitizenship(name) == "Unknown" or ataxiaNDB_getCitizenship(name) == "None" then
      return ataxiaNDB.highlighting.Rogues
    else
    if ataxiaNDB_getCitizenship(name) == "underworld" then
      return ataxiaNDB.highlighting.underworld
    else
		  return ataxiaNDB.highlighting[ataxiaNDB_getCitizenship(name)]
      end   
    end
	end
end
function ataxiaNDB_getClass(name)
	if ataxiaNDB_Exists(name) then
		return ataxiaNDB.players[name:title()].class
    --return ataxiaNDB.players[name].class
	else
		return "Unknown"
	end
end

function ataxiaNDB_Exists(name)
	if not ataxiaNDB.players[name] then
		return false
	else
		return true
	end
end

function ataxiaNDB_isCitizenOf(city, name)
	if ataxiaNDB_Exists(name) then
		return (ataxiaNDB.players[name:title()].city == city:title() and true or false)
	else
		ataxia_Echo("That person's information has not yet been gathered.")
		return false
	end
end

function ataxiaNDB_getCitizenship(name)
	if ataxiaNDB_Exists(name) then
		if ataxiaNDB.players[name].city:lower() == "none" or ataxiaNDB.players[name].city:lower() == "(hidden)" or ataxiaNDB.players[name].city:lower() == "underworld" then
			return "Rogues"
		else
			return ataxiaNDB.players[name].city
		end
	else
		return "Unknown"
	end
end


function ataxiaNDB_Remove(name)
	local person = name:title()
	if ataxiaNDB_Exists(person) then
		ataxiaNDB.players[person] = nil
		--If any highlight available, then clear it.
		if ataxiaNDB.highlightTriggers and ataxiaNDB.highlightTriggers[person] then
			killTrigger(ataxiaNDB.highlightTriggers[person])
		end
		ataxiaEcho(person.." has been removed from the database.")
	else
		ataxiaEcho(person.." is not in the database, anyway.")
	end
end

function ataxiaNDB_SortOnline(filepath)
	local f, s = io.open(filepath)
    if f then s = f:read("*l"); io.close(f) end

	-- didn't get JSON data? 
	if s:find("Internal error", 1, true) or s:find("DOCTYPE html PUBLIC", 1, true) then
		cecho("\n&lt;red&gt;Data Acquisition Failed!") 
		return 
	end

	local t = yajl.to_value(s)

	apiOnlineFound = {}
	apiNeedUpdate = {}
	for ind, tab in pairs(t.characters) do
		if not tab.name:find("masked") and not table.contains(ataxiaNDB.divine, tab.name) then
			table.insert(apiOnlineFound, tab.name)
		end
	end

	for ind, tab in pairs(gmcp.Comm.Channel.Players) do
		if not table.contains(apiOnlineFound, tab.name) and not tab.name:find("masked") and not table.contains(ataxiaNDB.divine, tab.name) then
			table.insert(apiOnlineFound, tab.name)
		end
	end

	os.remove(filepath)
	table.sort(apiOnlineFound)

	--Parse the list to see who needs to be added.
	local count = 0
	for index, name in pairs(apiOnlineFound) do
		if not ataxiaNDB_Exists(name) and not table.contains(ataxiaNDB.divine, name) then
			count = count + 1
			table.insert(apiNeedUpdate, name)
		end
	end

	if count &gt; 0 then
		ataxiaEcho(count.." new names identified, grabbing their info.")
		cecho("\n&lt;a_darkgrey&gt; - "..table.concat(apiNeedUpdate, ", ")..".")
		ataxiaNDB_NameList(apiNeedUpdate)
	else
		if parsingCity then
			if parsingCity:lower() == "classes" then
				ataxiaNDB_displayOnlineClass(apiOnlineFound)
			else
				ataxiaNDB_displayOnlineCity(apiOnlineFound)
			end
		else
			ataxiaNDB_displayOnline(apiOnlineFound)
		end
	end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>ataxiaNDB Highlighting</name>
										<packageName></packageName>
										<script>function ataxiaNDB_Unhighlight()
	if not ataxiaNDB.highlightTriggers or not next(ataxiaNDB.highlightTriggers) then return end

  	for k,v in pairs(ataxiaNDB.highlightTriggers) do
    	killTrigger(v)
  	end

  	ataxiaNDB.highlightTriggers = {}
end

function ataxiaNDB_enemyHighlights()
	ataxiaEcho("Clearing all highlights to prevent errors. One moment, please.")
	ataxiaNDB_Unhighlight()
	tempTimer(2, [[ ataxiaEcho("Loading new highlights now."); ataxiaNDB_loadHighlights() ]])	
end

function ataxiaNDB_loadHighlights()
	ataxiaNDB.highlightTriggers = ataxiaNDB.highlightTriggers or {}
	collectgarbage("stop")

	ataxiaNDB_Unhighlight()

	if ataxiaNDB.highlightNames then
		for index, person in pairs(ataxiaNDB.players) do
			ataxiaNDB_highlightName( person.name, person.city )
		end
	elseif ataxiaNDB.special then
		for person, colour in pairs(ataxiaNDB.special) do
			ataxiaNDB_highlightName( person, "nil" )
		end		
	end

	collectgarbage()
end

function ataxiaNDB_addHighlight(_, name)

	if not ataxiaNDB.highlightNames then return end	
	if not name then return end
	if not ataxiaNDB.players[name] then return end

	ataxiaNDB_highlightName( ataxiaNDB.players[name].name, ataxiaNDB.players[name].city)
end


function ataxiaNDB_updateHighlights(city, colour)

	ataxiaNDB.highlighting[city] = colour
	
	for name, trig in pairs(ataxiaNDB.highlightTriggers) do
		if ataxiaNDB.players[name].city == city then
			killTrigger(trig)
			if ataxiaNDB.highlightNames then
				ataxiaNDB_highlightName( ataxiaNDB.players[name].name, ataxiaNDB.players[name].city )
			end
		elseif city == "Rogues" or city == "(hidden)" or city == "underworld" then
			if ataxiaNDB_getCitizenship(name) == "None" then
				killTrigger(trig)
				if ataxiaNDB.highlightNames then
					ataxiaNDB_highlightName( ataxiaNDB.players[name].name, ataxiaNDB.players[name].city )
				end
			end
		end
	end
end


function ataxiaNDB_highlightName(who, city)
	--If any highlight available, then clear it.
	if ataxiaNDB.highlightTriggers and ataxiaNDB.highlightTriggers[who] then
		killTrigger(ataxiaNDB.highlightTriggers[who])
	end

	local colour = ataxiaNDB.highlighting.Rogues

	--Get the necessary colour.
		--Check specials first, then enemy list
	if ataxiaNDB.special and ataxiaNDB.special[who] then
		colour = ataxiaNDB.special[who]	
	elseif ataxiaNDB.highlightPriority == "enemies" then
		if table.contains(ataxiaNDB.cityEnemies, who) then
			colour = ataxiaNDB.highlighting.Enemies
		else
			if city == "None" or city == "(hidden)" then
				colour = ataxiaNDB.highlighting.Rogues
			else
				colour = ataxiaNDB.highlighting[city]
			end
		end
	else
		if city == "None" or city == "(hidden)" then
			colour = ataxiaNDB.highlighting.Rogues
		else
			colour = ataxiaNDB.highlighting[city]
		end
	end

	ataxiaNDB.highlightTriggers = ataxiaNDB.highlightTriggers or {}
	ataxiaNDB.highlightTriggers[who] = tempTrigger(who, ([[ataxiaNDB_highlight("%s", %s)]]):format(who,
		(colour and '"' .. colour .. '"' or "false")
	))
end

function ataxiaNDB_highlight(name, colour)
	local c, k = 1, 1
	while k &gt; 0 do
		k = line:find(name, k)
		if k == nil then return end
		c = c + 1

		if k == line:find("%f[%a]"..name.."%f[%A]", k) then
			if selectString(name, c-1) &gt; -1 then
				if colour then fg(colour) end
				if ataxiaNDB.highlightPriority == "enemies" and table.contains(ataxiaNDB.cityEnemies, name) then
					if ataxiaNDB.enemySettings.bold then setBold(true) end
					if ataxiaNDB.enemySettings.underline then setUnderline(true) end
					if ataxiaNDB.enemySettings.italics then setItalics(true) end
				end
				resetFormat()
			else 
				return 
			end
    		end
		k = k + 1
	end
end
registerAnonymousEventHandler("ataxiaNDB Check Highlight", "ataxiaNDB_addHighlight")
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>ataxiaNDB Display API</name>
										<packageName></packageName>
										<script>function ataxiaNDB_displayOnlineClass(players)
	local classList = {"Alchemist", "Apostate", "Bard", "Blademaster", "Depthswalker", "Druid", "Infernal", "Jester", "Magi", "Monk", "Occultist",
		"Paladin", "Priest", "Runewarden", "Sentinel", "Serpent", "Shaman", "Sylvan"}
	local classes = {
		Alchemist = {}, Apostate = {}, Bard = {}, Blademaster = {}, Depthswalker = {},
		Druid = {}, Infernal = {}, Jester = {}, Magi = {}, Monk = {}, Occultist = {},
		Paladin = {}, Priest = {}, Runewarden = {}, Sentinel = {}, Serpent = {},
		Shaman = {}, Sylvan = {},
	}

	for _, player in pairs(players) do
		local class = ataxiaNDB.players[player].class
		table.insert(classes[class], player)
	end
	ataxiaEcho("Data acqusition completed and analysed. Showing class count for online players.")

	for _, class in ipairs(classList) do
		cecho("\n &lt;DimGrey&gt;[&lt;NavajoWhite&gt;"..class:title().."&lt;DimGrey&gt;]"..string.rep(" ", 13-string.len(class)).."- &lt;NavajoWhite&gt;"..#classes[class].." tracked people are "..class..".")
	end
	send(" ")
	parsingCity = nil
end

function ataxiaNDB_displayOnlineCity(players)
	local peopleFound = {}

ataxiaEcho("Data acqusition completed and analysed. Showing online players from &lt;"..ataxiaNDB.highlighting[parsingCity:title()].."&gt;"..parsingCity:title()..".")

	for _, person in pairs(players) do
		if ataxiaNDB_isCitizenOf(parsingCity:title(), person) then
			cecho("\n &lt;"..ataxiaNDB.highlighting[parsingCity:title()].."&gt;"..person..string.rep(" ", 13-string.len(person)).."- &lt;NavajoWhite&gt;"..ataxiaNDB_getClass(person))
		end
	end
	send(" ")
	parsingCity = nil
end

function ataxiaNDB_displayOnline(players)
	local onlinePeople = {
		Ashtan = {}, Cyrene = {}, Eleusis = {}, Hashan = {}, Mhaldor = {}, Targossas = {}, Rogues = {}, Untracked = {}, underworld = {},
	}

  
	for _, person in pairs(players) do
		if not ataxiaNDB_Exists(person) then
			table.insert(onlinePeople.Untracked, person)
		elseif ataxiaNDB_getCitizenship(person):lower() == "none" or ataxiaNDB_getCitizenship(person):lower() == "unknown" or ataxiaNDB_getCitizenship(person) == "(hidden)"  or ataxiaNDB_getCitizenship(person) == "Unknown" or ataxiaNDB_getCitizenship(person):lower() == "Unknown" then
			table.insert(onlinePeople.Rogues, person)
		elseif ataxiaNDB_getCitizenship(person):lower() == "underworld" then
      table.insert(onlinePeople.underworld, person)
    else
			table.insert(onlinePeople[ataxiaNDB_getCitizenship(person)], person)
		end
	end

	ataxiaEcho("Data acquisition completed and analysed. List of players online:")
	echo("\n"..table.concat(apiOnlineFound, ", ")..".\nTotal players visible to us: "..#apiOnlineFound..".\n")

	ataxiaEcho(" City affiliations of currently online people:")
	cecho(string.format("\n&lt;%s&gt;[Ashtan]     :&lt;white&gt;(&lt;orange&gt;%d&lt;white&gt;)&lt;%s&gt; %s.", ataxiaNDB.highlighting.Ashtan, #onlinePeople.Ashtan, ataxiaNDB.highlighting.Ashtan, table.concat(onlinePeople.Ashtan, ", ")))
	cecho(string.format("\n&lt;%s&gt;[Cyrene]     :&lt;white&gt;(&lt;orange&gt;%d&lt;white&gt;)&lt;%s&gt; %s.", ataxiaNDB.highlighting.Cyrene, #onlinePeople.Cyrene, ataxiaNDB.highlighting.Cyrene, table.concat(onlinePeople.Cyrene, ", ")))
	cecho(string.format("\n&lt;%s&gt;[Eleusis]    :&lt;white&gt;(&lt;orange&gt;%d&lt;white&gt;)&lt;%s&gt; %s.", ataxiaNDB.highlighting.Eleusis, #onlinePeople.Eleusis, ataxiaNDB.highlighting.Eleusis, table.concat(onlinePeople.Eleusis, ", ")))
	cecho(string.format("\n&lt;%s&gt;[Hashan]     :&lt;white&gt;(&lt;orange&gt;%d&lt;white&gt;)&lt;%s&gt; %s.", ataxiaNDB.highlighting.Hashan, #onlinePeople.Hashan, ataxiaNDB.highlighting.Hashan, table.concat(onlinePeople.Hashan, ", ")))
	cecho(string.format("\n&lt;%s&gt;[Mhaldor]    :&lt;white&gt;(&lt;orange&gt;%d&lt;white&gt;)&lt;%s&gt; %s.", ataxiaNDB.highlighting.Mhaldor, #onlinePeople.Mhaldor, ataxiaNDB.highlighting.Mhaldor, table.concat(onlinePeople.Mhaldor, ", ")))
	cecho(string.format("\n&lt;%s&gt;[Targossas]  :&lt;white&gt;(&lt;orange&gt;%d&lt;white&gt;)&lt;%s&gt; %s.", ataxiaNDB.highlighting.Targossas, #onlinePeople.Targossas, ataxiaNDB.highlighting.Targossas, table.concat(onlinePeople.Targossas, ", ")))
	cecho(string.format("\n&lt;%s&gt;[Rogues]     :&lt;white&gt;(&lt;orange&gt;%d&lt;white&gt;)&lt;%s&gt; %s.", ataxiaNDB.highlighting.Rogues, #onlinePeople.Rogues, ataxiaNDB.highlighting.Rogues, table.concat(onlinePeople.Rogues, ", ")))
  --cecho(string.format("\n&lt;%s&gt;[Underworld]     :&lt;white&gt;(&lt;orange&gt;%d&lt;white&gt;)&lt;%s&gt; %s.",ataxiaNDB.highlighting.underworld, #onlinePeople.underworld, ataxiaNDB.highlighting.underworld, table.concat(onlinePeople.underworld, ", ")))
	echo("\n ")
	send(" ")

end

function ataxiaNDB_displayWho(person)
  ataxiaNDB.checking = nil
  local name = person:title()
  local x, c, u
  if not ataxiaNDB_Exists(name) then
  	ataxiaEcho(name.." is not yet tracked!")
  else
  	x = ataxiaNDB.players[name]
  	c = ataxiaNDB_getColour(name)
  	u = "Checked: "..(x.lastUpdate and x.lastUpdate or "n/a")
  	
  	cecho("\n\n&lt;blue&gt;- &lt;"..c.."&gt;"..x.title.." &lt;blue&gt;"..string.rep("-", 70-(string.len(x.title)+3)).."\n")
  	cecho("\n&lt;a_darkcyan&gt; City :   &lt;NavajoWhite&gt;"..x.city..string.rep(" ", 31-string.len(x.city)).."  &lt;a_darkcyan&gt; Level:   &lt;NavajoWhite&gt;"..x.level)
  	cecho("\n&lt;a_darkcyan&gt; House:   &lt;NavajoWhite&gt;"..x.house..string.rep(" ", 31-string.len(x.house)).."  &lt;a_darkcyan&gt; Rank :   &lt;NavajoWhite&gt;"..x.xp_rank)
  	cecho("\n&lt;a_darkcyan&gt; Class:   &lt;NavajoWhite&gt;"..x.class..string.rep(" ", 31-string.len(x.class)).."  &lt;a_darkcyan&gt; Kills:   &lt;NavajoWhite&gt;"..(x.pks or "n/a"))
    if ataxiaNDB_armyRank(name) &gt; 0 then
      cecho("\n&lt;a_darkcyan&gt; Army :   &lt;"..(ataxiaNDB_armyRank(name) &gt; 3 and "red" or "NavajoWhite").."&gt;"..ataxiaNDB_armyRank(name))
    end
    if ataxiaNDB_isMark(name) then
      cecho("\n&lt;a_darkcyan&gt; Mark :   &lt;"..(ataxiaNDB_isMark(name) == "Ivory" and "NavajoWhite" or "purple").."&gt;"..ataxiaNDB_isMark(name))
    end
    echo("\n ")
    if ataxiaNDB.player_Notes[name] and #ataxiaNDB.player_Notes[name] &gt; 0 then
      cecho("\n&lt;a_darkcyan&gt; Notes:")
      for num, note in pairs(ataxiaNDB.player_Notes[name]) do
        cecho("\n  &lt;DarkSlateBlue&gt;"..num..") &lt;reset&gt;"..note)
      end
      echo("\n ")
    end
  	cecho("\n &lt;a_green&gt;"..string.rep(" ", 69-string.len(u))..u)
  	cecho("\n&lt;blue&gt;"..string.rep("-", 70))
  	cecho("\n ")
  	send(" ",false)
  end	
end</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Shaman System</name>
									<packageName></packageName>
									<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Spirit Table</name>
										<packageName></packageName>
										<script>
if shaman == nil then
	shaman = { settings = { precommune = "", postcommune = ""} }
end
--cmd_sep = ataxia.settings.separator or "::"
if shaman.spiritlore == nil then
	shaman.spiritlore = { 
		bindings = {}, 
		attunements = {}, 
		wanted_bindings = {}, 
		wanted_attunements = {}, 
		unwanted_bindings = {}, 
		unwanted_attunements = {}, 
		profiles = {},
		attunement_count = 0, 
		bind_count = 0,
		override_tether = false,
    bashType = "swiftcurse",
	}
	send("spirit bindings")
	shecho("Checking current spirit bindings.")
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Save/Load functions</name>
										<packageName></packageName>
										<script>function shaman.save()
	local temp_shaman = deepcopy(shaman)
	temp_shaman.spiritlore.attunements = {}
	temp_shaman.spiritlore.bindings = {}
	temp_shaman.spiritlore.tether = ""
	if string.char(getMudletHomeDir():byte()) == "/" then _sep = "/" else  _sep = "\\" end
	local saveFile = getMudletHomeDir() ..  _sep .. "shaman_profile.lua"

	table.save(saveFile, temp_shaman)
	shecho("Settings saved.")
end

function shaman.load()
	if string.char(getMudletHomeDir():byte()) == "/" then _sep = "/" else  _sep = "\\" end
	local loadFile = getMudletHomeDir() ..  _sep .. "shaman_profile.lua"

    if io.exists(loadFile) then table.load(loadFile, shaman) end
	shecho("Settings loaded.")
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Binding functions</name>
										<packageName></packageName>
										<script>function shaman.checkSpirits(spiritlist)
  local binds = {
    "Daina", "Jhulian", "Arius", "Silvanix", "Ri\'shen", "Maligus", "Aspar", "Aelkesh", "Teraile",
    "Arcanor", "Syvis", "Marak", "Anthius", "Garon", "Tarnel", "Kosuira", "Arayan", "Adchachel", 
  }
cmd_sep = ataxia.settings.separator


  if type(spiritlist) == "string" then
    if not table.contains(binds, spiritlist:title()) then
      return false
    else
      return true
    end
  else
    local valid = true
    for _, bind in pairs(spiritlist) do
      if not table.contains(binds, bind:title()) then
        valid = false
      end
    end
    return valid
  end 
end

function shaman.loadspiritprofile(profile)
	shaman.resetwantedtables()
	
	return_status = shaman.loadprofilesettings(profile)
	if return_status ~= 1 then
		shecho("Profile '".. profile .. "' not found.")
		return 0
	end

	shaman.sortspirits()

	if shaman.spiritlore.profiles[profile]["tether"] ~= nil then
		shecho("Switching to profile &lt;green&gt;".. profile .."&lt;reset&gt;: &lt;SkyBlue&gt;".. table.concat(shaman.spiritlore.profiles[profile]["bindings"], "&lt;reset&gt;,&lt;SkyBlue&gt; ").. "&lt;reset&gt;  &lt;firebrick&gt;"..table.concat(shaman.spiritlore.profiles[profile]["attunements"], "&lt;reset&gt;,&lt;firebrick&gt; ").."&lt;reset&gt; ".. shaman.spiritlore.profiles[profile]["tether"]..".")
	else
		shecho("Switching to profile &lt;green&gt;".. profile .."&lt;reset&gt;: &lt;SkyBlue&gt;".. table.concat(shaman.spiritlore.profiles[profile]["bindings"], "&lt;reset&gt;,&lt;SkyBlue&gt; ").. "&lt;reset&gt;  &lt;firebrick&gt;"..table.concat(shaman.spiritlore.profiles[profile]["attunements"], "&lt;reset&gt;,&lt;firebrick&gt; ").. ".")
	end
	if not table.is_empty(shaman.spiritlore.wanted_bindings) then
		shaman.spiritlore.autobind = true
		shaman.commune()
	else
	-- we only need to worry about switching attunements and maybe tether
		shaman.tetherandattune()
	end

end

function shaman.spiritisbound(spirit)
	if table.contains(shaman.spiritlore.bindings, spirit:title()) or shaman.spiritlore.tether == spirit:title() then
		return true
	else
		return false
	end
end

function shaman.savecurrentprofile(profile_name)
		shaman.spiritlore.profiles[profile_name] = {
			["bindings"] = deepcopy(shaman.spiritlore.bindings),
			["attunements"] = deepcopy(shaman.spiritlore.attunements),
			["tether"] = shaman.spiritlore.tether
		}
		shecho("Saved spirit profile '&lt;green&gt;"..profile_name.."&lt;reset&gt;'.")
		shaman.save()
	return 1
end

function shaman.deleteprofile(profile_name)
	if table.contains(shaman.spiritlore.profiles, profile_name) then
		shaman.spiritlore.profiles[profile_name] = nil
		shecho("Profile '&lt;green&gt;"..profile_name.."&lt;reset&gt;' deleted.")
	else
		shecho("Profile not found.")
	end
end
function shaman.loadprofilesettings(profile_name)
	if table.contains(shaman.spiritlore.profiles, profile_name) then
		local profile_table = deepcopy(shaman.spiritlore.profiles[profile_name])
		shaman.spiritlore.wanted_bindings = profile_table.bindings
		shaman.spiritlore.wanted_attunements = profile_table.attunements
		shaman.spiritlore.wanted_tether = profile_table.tether
	else
		return 0
	end
	return 1
end

function shaman.resetspirittables()
	shaman.spiritlore.attunements = {}
	shaman.spiritlore.bindings = {}
	shaman.spiritlore.tether = nil

	shaman.resetwantedtables()
end

function shaman.resetwantedtables()
	shaman.spiritlore.wanted_attunements = {}
	shaman.spiritlore.unwanted_attunements = {}
	shaman.spiritlore.wanted_bindings = {}
	shaman.spiritlore.unwanted_bindings = {}
end

function shaman.tetherandattune()
		if shaman.spiritlore.wanted_tether ~= nil and ((shaman.spiritlore.wanted_tether ~= shaman.spiritlore.tether and shaman.spiritlore.override_tether) or shaman.spiritlore.tether == nil or shaman.spiritlore.tether == "") then
			shaman.tether(shaman.spiritlore.wanted_tether)
		end
	
		if not table.is_empty(shaman.spiritlore.unwanted_attunements) then
			shaman.unattunespirits()
		end
		if not table.is_empty(shaman.spiritlore.wanted_attunements) then
			
			shaman.attunespirits()
		end
end

function shaman.listspiritprofiles()
	cecho("\n&lt;SeaGreen&gt;(&lt;white&gt;Profile&lt;SeaGreen&gt;)"..string.rep(" ", 12).."&lt;brown&gt;(&lt;white&gt;Bindings&lt;brown&gt;)"..string.rep(" ", 25).."&lt;orange&gt;(&lt;white&gt;Attunes&lt;orange&gt;)"..string.rep(" ", 15).."&lt;violet&gt;(&lt;white&gt;Tether&lt;violet&gt;)\n")                  
	cecho("&lt;DodgerBlue&gt;"..string.rep("-", 90).."\n")
	table.sort(shaman.spiritlore.profiles)
	local bind, attune, tether = "", "", ""
	bind, attune = table.concat(shaman.spiritlore.bindings, ", "), table.concat(shaman.spiritlore.attunements, ", ")
	cecho("&lt;firebrick&gt;(Current): &lt;NavajoWhite&gt;[&lt;DimGrey&gt;"..bind.."&lt;NavajoWhite&gt;] "..string.rep(" ", 39-string.len(bind)).."&lt;orange&gt;[&lt;DarkSlateGrey&gt;"..attune.."&lt;orange&gt;]")
	cecho(string.rep(" ", 24-string.len(attune)).." &lt;green&gt;(&lt;LightSkyBlue&gt;"..(shaman.spiritlore.tether and shaman.spiritlore.tether or "None").."&lt;green&gt;)\n")
	cecho("&lt;DodgerBlue&gt;"..string.rep("-", 90).."\n")
	for profile_name, profile in spairs(shaman.spiritlore.profiles) do
		table.sort(profile.bindings)
		table.sort(profile.attunements)
		bind, attune = table.concat(profile.bindings, ", "), table.concat(profile.attunements, ", ")
		fg("green")
		echoLink("("..profile_name:title()..")", [[shaman.loadspiritprofile("]]..profile_name..[[")]], "Click to switch to this profile", true)
		resetFormat()
		cecho("&lt;blue&gt;:"..string.rep(" ", 8-string.len(profile_name)).."&lt;sienna&gt;["..bind.."] "..string.rep(" ", 39-string.len(bind)).."&lt;DarkGoldenrod&gt;["..attune.."]")
		if profile.tether ~= nil then
			cecho(string.rep(" ", 24-string.len(attune)).." &lt;purple&gt;(&lt;NavajoWhite&gt;"..profile.tether.."&lt;purple&gt;)\n")
		else
			cecho("\n")
		end
	end
	cecho("&lt;DodgerBlue&gt;"..string.rep("-", 90).."\n")
	send(" ")
end

function shaman.commune()
cmd_sep = ataxia.settings.separator



	if not shaman.spiritlore.commune then
		if svo ~= nil then
			svo.ignore.prone=true
		end
		send(shaman.settings.precommune..cmd_sep.."sit"..cmd_sep.."commune")
	end
end

function shaman.sortspirits()
	for i, binding in pairs(shaman.spiritlore.bindings) do
		if not table.contains(shaman.spiritlore.wanted_bindings, binding) then
			table.insert(shaman.spiritlore.unwanted_bindings, binding)
		elseif table.contains(shaman.spiritlore.wanted_bindings, binding) then
			table.remove(shaman.spiritlore.wanted_bindings, table.index_of(shaman.spiritlore.wanted_bindings, binding))
		end
	end 

	for i, spirit in pairs(shaman.spiritlore.attunements) do
		if not table.contains(shaman.spiritlore.wanted_attunements, spirit) then
			table.insert(shaman.spiritlore.unwanted_attunements, spirit)
		elseif table.contains(shaman.spiritlore.wanted_attunements, spirit) then
			local spirit_index = table.index_of(shaman.spiritlore.wanted_attunements, spirit)
			table.remove(shaman.spiritlore.wanted_attunements, spirit_index)
		end
	end

end

function shaman.unbindspirits()
	shecho("Unbinding &lt;SkyBlue&gt;"..table.concat(shaman.spiritlore.unwanted_bindings, "&lt;reset&gt;,&lt;SkyBlue&gt; ").."&lt;reset&gt;.")
	for i, binding in pairs(shaman.spiritlore.unwanted_bindings) do
		shaman.unbind(binding)
	end
end

function shaman.unattunespirits()
	shecho("Unattuning &lt;firebrick&gt;"..table.concat(shaman.spiritlore.unwanted_attunements, "&lt;reset&gt;,&lt;firebrick&gt; ").."&lt;reset&gt;.")
	for i, spirit in pairs(shaman.spiritlore.unwanted_attunements) do
		shaman.unattune(spirit)
	end
end

function shaman.bindspirits()
	shecho("Binding &lt;SkyBlue&gt;"..table.concat(shaman.spiritlore.wanted_bindings, "&lt;reset&gt;,&lt;SkyBlue&gt; ").."&lt;reset&gt;.")
	send("spirit bind "..table.concat(shaman.spiritlore.wanted_bindings, " "), false)
end
	
function shaman.unbind(spirit)
	send("spirit unbind ".. spirit, false)
end

function shaman.boundspirit(spirit)
	if table.contains(shaman.spiritlore.wanted_bindings, spirit) then
		table.remove(shaman.spiritlore.wanted_bindings, table.index_of(shaman.spiritlore.wanted_bindings, spirit))
	end
	if not table.contains(shaman.spiritlore.bindings, spirit) then
		table.insert(shaman.spiritlore.bindings, spirit)
	end

	if table.is_empty(shaman.spiritlore.wanted_bindings) and shaman.spiritlore.autobind then
		send("stand", false)
	end
end

function shaman.attunespirits()
	shecho("Attuning &lt;firebrick&gt;"..table.concat(shaman.spiritlore.wanted_attunements, "&lt;reset&gt;,&lt;firebrick&gt; ").."&lt;reset&gt;.")
	for i, spirit in pairs(shaman.spiritlore.wanted_attunements) do
		shaman.attune(spirit)
	end
end
	
function shaman.attune(spirit)
	send("spirit attune ".. spirit, false)
end

function shaman.unattune(spirit)
	send("spirit unattune ".. spirit, false)
end

function shaman.unboundspirit(spirit)
	if table.contains(shaman.spiritlore.unwanted_bindings,spirit) then
		local spirit_index = table.index_of(shaman.spiritlore.unwanted_bindings, spirit)
		table.remove(shaman.spiritlore.unwanted_bindings, spirit_index)
	end
	if table.contains(shaman.spiritlore.bindings,spirit) then
		local spirit_index = table.index_of(shaman.spiritlore.bindings, spirit)
		table.remove(shaman.spiritlore.bindings, spirit_index)
	end

	if table.contains(shaman.spiritlore.attunements, spirit) then
		local spirit_index = table.index_of(shaman.spiritlore.attunements, spirit)
		table.remove(shaman.spiritlore.attunements, spirit_index)
	end

	if table.contains(shaman.spiritlore.unwanted_attunements, spirit) then
		local spirit_index = table.index_of(shaman.spiritlore.unwanted_attunements, spirit)
		table.remove(shaman.spiritlore.unwanted_attunements, spirit_index)
	end
end

function shaman.unattunedspirit(spirit)
	if table.contains(shaman.spiritlore.unwanted_attunements, spirit) then
		local spirit_index = table.index_of(shaman.spiritlore.unwanted_attunements, spirit)
		table.remove(shaman.spiritlore.unwanted_attunements, spirit_index)
	end
	if table.contains(shaman.spiritlore.attunements,spirit) then
		local spirit_index = table.index_of(shaman.spiritlore.attunements, spirit)
		table.remove(shaman.spiritlore.attunements, spirit_index)
	end
end

function shaman.attunedspirit(spirit)
	if table.contains(shaman.spiritlore.wanted_attunements, spirit) then
		local spirit_index = table.index_of(shaman.spiritlore.wanted_attunements, spirit)
		table.remove(shaman.spiritlore.wanted_attunements, spirit_index)
	end
	if not table.contains(shaman.spiritlore.attunements, spirit) then
		table.insert(shaman.spiritlore.attunements, spirit)
	end
end

function shaman.tether(spirit)
	if shaman.spiritlore.tether ~= spirit then
		shecho("Tethering ".. spirit ..".")
		if shaman.spiritlore.tether ~= nil and shaman.spiritlore.tether ~= "" then
			send("spirit untether ".. shaman.spiritlore.tether, false)
		end
		send("spirit tether "..spirit, false)
	else
		shecho(spirit.." is already tethered.")
	end
end

function shaman.tethered(spirit)
	shaman.spiritlore.tether = spirit
end

function shaman.bindcount()
	local c = 0
	for i, spirit in pairs(shaman.spiritlore.bindings) do
		c = c + 1
	end
	return c
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Shaman functions</name>
										<packageName></packageName>
										<script>function shecho(text)
	cecho("\n&lt;orange_red&gt;[Shaman]:&lt;reset&gt; " .. text .. "\n")
end

function deepcopy(orig)
    local orig_type = type(orig)
    local copy
    if orig_type == 'table' then
        copy = {}
        for orig_key, orig_value in next, orig, nil do
            copy[deepcopy(orig_key)] = deepcopy(orig_value)
        end
        setmetatable(copy, deepcopy(getmetatable(orig)))
    else -- number, string, boolean, etc
        copy = orig
    end
    return copy
end</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Harvesting/Crafting</name>
									<packageName></packageName>
									<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Harvester Functions</name>
										<packageName></packageName>
										<script>function ataxiaExtractor_check()
	if (speedWalkCounter &lt; 1 or mmp.paused) then
		if harvested_in_room_stuff() then
			ataxiaBasher_nextRoom()
		else      
      ataxiaExtractor_extract()
      
			if mmp.paused then
				ataxiaHarvester_harvested()
				mmp.pause("off")
			elseif not ataxiaHarvester_manual_extracting and #ataxiaBasher_path &gt; 0 then
				expandAlias("goto "..ataxiaBasher_path[1])
			elseif not ataxiaHarvester_manual_extracting then
				disable_harvester()
			end
		end
	end
end

function ataxiaExtractor_extract()
  ataxiaExtraction = ataxiaExtraction or {}
  local a = gmcp.Room.Info.area 
  if ataxiaExtraction[a] then
    send("extract "..ataxiaExtraction[a],false)
  end
end

function ataxiaHarvester_check()
	if (mmp.speedWalkCounter &lt; 1 or mmp.paused) then
		if #harvest_in_room == 0 and not harvested_in_room_stuff() then
			get_room_harvestables()
		elseif #harvest_in_room &gt; 0 then
			ataxiaHarvester_harvest()
		else
			autoHarvest_rooms = autoHarvest_rooms or {}
			if not table.contains(autoHarvest_rooms, gmcp.Room.Info.num) then table.insert(autoHarvest_rooms, gmcp.Room.Info.num) end
			if mmp.paused then
				ataxiaHarvester_harvested()
				mmp.pause("off")
			elseif not ataxiaHarvester_manual_harvesting and #ataxiaBasher_path &gt; 0 then
				harvest_in_room = {}
				expandAlias("goto "..ataxiaBasher_path[1])
			elseif not ataxiaHarvester_manual_harvesting then
				disable_harvester()
			end
		end
	end
end

function get_room_harvestables()
	harvest_in_room = {}
	ataxiaTemp.riftContents = ataxiaTemp.riftContents or {}
	get_herbHarvestTable()

	if table.contains(env_to_get, gmcp.Room.Info.environment) then
		local herb = ""
		for i,v in pairs(env_to_get[gmcp.Room.Info.environment]) do
			herb = v:gsub("harvest ", "")
			ataxiaTemp.riftContents[herb] = ataxiaTemp.riftContents[herb] or 0
			table.insert(harvest_in_room, v)
		end
		ataxiaHarvester_harvest()
	else
		ataxiaHarvester_harvested()
		ataxiaHarvester_harvester()
		mmp.pause("off")
	end
end

function ataxiaHarvester_harvester()
	if #ataxiaBasher_path &gt; 0 and not ataxiaHarvester_manual_harvesting then
		harvest_in_room = {}
		harvest_goto = ataxiaBasher_path[1]
		expandAlias("goto "..ataxiaBasher_path[1], false)
	elseif not ataxiaHarvester_manual_harvesting then
		disable_harvester()
	end
end

function ataxiaHarvester_harvest()
	if #harvest_in_room &gt; 0 then
		
		if canBals() then
			ataxiaHarvester_harvested()
			send(harvest_in_room[1])
		end
	else
		ataxiaHarvester_harvested()
		ataxiaHarvester_harvester()
	end
end

function harvested_in_room_stuff()
	if not autoHarvest_rooms then autoHarvest_rooms = {} end
	if table.contains(autoHarvest_rooms, gmcp.Room.Info.num) then
		return true
	else
		return false
	end
end

function ataxiaHarvester_harvested()
	if autoHarvesting or autoExtracting then
		autoHarvest_rooms = autoHarvest_rooms or {}
		if not table.contains(autoHarvest_rooms, gmcp.Room.Info.num) then table.insert(autoHarvest_rooms, gmcp.Room.Info.num) end
		if not ataxiaHarvester_manual_harvesting and not ataxiaHarvester_manual_extracting then
			for i,v in pairs(ataxiaBasher_path) do
				if tonumber(gmcp.Room.Info.num) == v then
					table.remove(ataxiaBasher_path, i)
					break
				end
			end
		end
	end
end


function get_herbHarvestTable()
	env_to_get = {
		["Desert"] = {"harvest pear"},
		["Forest"] = {"harvest elm", "harvest echinacea", "harvest ginseng", "harvest lobelia", "harvest myrrh", "harvest ginger"},
		["Freshwater"] = {"harvest kelp"},
		["Garden"] = {"harvest elm", "harvest echinacea", "harvest ginseng", "harvest lobelia", "harvest myrrh", "harvest ginger"},
		["Grasslands"] = {"harvest goldenseal", "harvest slipper",},
		["Hills"] = {"harvest bayberry", "harvest hawthorn"},
		["Jungle"] = {"harvest skullcap", "harvest kola", "harvest kuzu"},
		["Mountains"] = {"harvest valerian"},
		["Natural underground"] = {"harvest bloodroot", "harvest irid"},
		["Ocean"] = {"harvest kelp"},
		["River"] = {"harvest kelp"},
		["Swamp"] = {"harvest ash", "harvest bellwort", "harvest cohosh",},
		["Valley"] = {"harvest sileris"},
	}
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Toggling Functions</name>
										<packageName></packageName>
										<script>function disable_harvester()
	mmp.pause("off")
	autoHarvesting = false
	ataxiaBasher.enabled = false
	ataxiaBasher.paused = false
	ataxiaBasher.manual = false
	ataxiaBasher.areabash = false
	ataxiaEcho("Harvesting systems disengaged.")
	raiseEvent("basher disabled")
	ataxiaHarvester_manual_harvesting = false
end

function enable_harvester()
	mmp.pause("off")
	ataxiaBasher_generatePath()
	autoHarvesting = true
	ataxiaBasher.enabled = true
	harvest_goto = ataxiaBasher_path[1]
	harvest_in_room = {}
	autoHarvest_rooms = {}	
	ataxiaEcho("Complete control sacrificed. Beginning the harvest.")
	ataxiaHarvester_manual_harvesting = false
	raiseEvent("basher enabled")
end

function enable_harvesterm()
	ataxiaHarvester_manual_harvesting = true
	autoHarvesting = true
	ataxiaBasher.enabled = true
  ataxiaBasher.manual = true
	harvest_in_room = {}
	autoHarvest_rooms = {}
	ataxiaEcho("Harvesting systems engaged.")
	raiseEvent("basher enabled")
end

function disable_extractor()
	mmp.pause("off")
	autoExtracting = false
	ataxiaBasher.enabled = false
	ataxiaBasher.paused = false
	ataxiaBasher.manual = false
	ataxiaBasher.areabash = false
	ataxiaEcho("Extraction systems disengaged.")
	raiseEvent("basher disabled")
	ataxiaHarvester_manual_extracting = false
end

function enable_extractor()
	mmp.pause("off")
	ataxiaBasher_generatePath()
	autoExtracting = true
	ataxiaBasher.enabled = true
	harvest_goto = ataxiaBasher_path[1]
	harvest_in_room = {}
	autoHarvest_rooms = {}	
	ataxiaEcho("Complete control sacrificed. Beginning extraction process.")
	ataxiaHarvester_manual_extracting = false
	raiseEvent("basher enabled")
end

function enable_extractorm()
	ataxiaHarvester_manual_extracting = true
	autoExtracting = true
	ataxiaBasher.enabled = true
  ataxiaBasher.manual = true
	harvest_in_room = {}
	autoHarvest_rooms = {}
	ataxiaEcho("Extracting systems engaged.")
	raiseEvent("basher enabled")
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Inkmilling</name>
										<packageName></packageName>
										<script>--Change this to true if you have an artifact mill.
--Make sure to click 'save profile' after changing it, so it updates.
local have_mill = false
--Change these two if you want to use the secondary reagents for red/blue reagents.
local redReagent = "red clay"
local blueReagent = "lumic moss"

local ink_reagents = {
	yellow = "yellow chitin",
	gold = "gold flakes",
	common = "fish scales",
	uncommon = "buffalo horn",
	scarce = "shark tooth",
	rare = "wyrm tongue",
}
ink_reagents.red = redReagent
ink_reagents.blue = blueReagent

local ink_costs = {
	red = {red = 1, common = 1},
	blue = {blue = 1, uncommon = 1},
	yellow = {yellow = 1, scarce = 1},
	green = {blue = 2, yellow = 1, uncommon = 2, scarce = 1},
	purple = {red = 2, blue = 2, uncommon = 2, common = 2, rare = 1},
	gold = {gold = 1, common = 2, uncommon = 2, scarce = 2, rare = 1},
}

--Print what we can make.
function inkmilling_canMake()
	ataxia_Echo("Listing the inks we can make based on the following reagents:")
	echo("\n")
	local line = 0
	for reagent, longname in pairs(ink_reagents) do
		line = line + 1
	
		if (line-1)%3 == 0 then
			echo("\n")
		end
		
		local count = ataxiaTemp.riftContents[longname] and ataxiaTemp.riftContents[longname] or 0
		cecho("&lt;a_darkgreen&gt;"..longname:title().."&lt;reset&gt;:&lt;NavajoWhite&gt;"..string.rep(" ", 14-string.len(longname))..count)
		
		local spacing = longname..":"..string.rep(" ", 14-string.len(longname))..count	
		cecho(string.rep(" ", 25 - string.len(spacing)))
	end
	echo("\n")	
	for inkType, reagents in pairs(ink_costs) do
		cecho("\n&lt;"..inkType.."&gt;"..inkType:title()..":&lt;NavajoWhite&gt;"..string.rep(" ", 8-string.len(inkType))..inkmilling_getAmount(inkType))
	end
	
	send(" ")
end

--This will return whether or not we can actually make the amount specified.
function inkmilling_getAmount(inkcolour)
	local canMake = false
	for reagent, cost in pairs(ink_costs[inkcolour]) do
		local weHave = ataxiaTemp.riftContents[ink_reagents[reagent]] and ataxiaTemp.riftContents[ink_reagents[reagent]] or 0
		if weHave == 0 then
			canMake = 0
		else
			if not canMake then
				canMake = weHave/cost
			elseif (weHave/cost) &lt; canMake then
				canMake = weHave/cost
			end
		end
	end
	return math.floor(canMake)
end

--Now we actually make the inks!
function inkmilling_createInks()
	local perMill = (have_mill and 10 or 5)
	local toMake = ( (ataxiaTemp.inkAmount &gt; perMill) and perMill or ataxiaTemp.inkAmount )
	local sp = ataxia.settings.separator
	if inkmilling_getAmount(ataxiaTemp.inkColour) &lt; ataxiaTemp.inkAmount then
		ataxia_Echo("We cannot make that many "..ataxiaTemp.inkColour.." inks.")
		inkmilling_stopInks()
	else
		for reagent, cost in pairs(ink_costs[ataxiaTemp.inkColour]) do
			local x = ink_reagents[reagent]:gsub(" ", "")
			if x == "lumicmoss" then x = "lumic" end
			send("outr "..(cost*toMake).." "..x..sp.."put group "..x.." in mill",false)
		end
		ataxiaTemp.inkAmount = ataxiaTemp.inkAmount - toMake
		send("mill for "..toMake.." "..ataxiaTemp.inkColour,false)
	end	
end

--Stop making inks.
function inkmilling_stopInks()
	ataxia_Echo("No longer making inks.")
	ataxiaTemp.inkColour = nil
	ataxiaTemp.inkAmount = nil
	ataxiaTemp.inkMaking = nil
	send("clearqueue eqbal",false)
end</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>SYSTEM DOCUMENTATION</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="no" isFolder="no">
										<name>Combat Documentation</name>
										<packageName></packageName>
										<script>--[[
  For the sake of reducing questions, this script is going to contain variables specific to combat that can be utilised in your scripts and what not.
  As Pariah is quite a tall task, compared to previous classes, this is the class I'll be working on first.
  If you play a different class, let me know and I can work on adding yours here as well in a future update.
 
  -BARD-
  
  ataxiaTemp.rapierJab          - Stores how much % your rapier does (only after assessing).
  ataxia.bardStuff.tunesmith    - Stores what your current tunesmith is set to.
  ataxiaTemp.tvBal              - Whether or not you've used tremolo/vibrato bal.
                                  this will be true if so, otherwise nil.

  --MONK-
  ataxiaTemp.hyperLimb          - Stores which limb you're hyperfocussing, if Shikudo.
  tekura_limbDamage
  shikudo_limbDamage            - Stores limb damage depending on your spec.
  
  -PARIAH-
  ***CURRENTLY NO TRACKING OF YOUR SWARMS***
  ***UNTIL THEY'RE DONE FIXING RELEASE ISSUES I WONT BE ADDING THIS***
  
  
  pariah_canVirulence()         - These two functions work in tandem, the first checks if 3 plagues are present
  pariah_doVirulence()            the second checks the 4th needed to lock with.
  
  pariah_canGraph("xxx")        - will return true if you can use the specific logograph.
                                - eg: pariah_canGraph("nest") will return true if you used serpent last
  pariah.bladePrepared          - will track if you have blood on your blade. THIS RESETS ON TARGET CHANGE.
                                - also clears on transpose, and the 'blood used up' lines as well.
                                  
  pariah.lastLogograph          - kind of speaks for itself, really.
  ataxia.vitals.epitaph         - tracks your current epitaph length.
  tAffs.burrow                  - will track if you have burrow active. Clears on infest/extract usage.
                                - I strongly suggest reading how burrow works, as well.
                                - while the affliction will clear on target change, you still need to recall your swarm.
                                  
  pariah.latency                - if this is active, it means you used latency recently.
  pariah.ensorcell              - another one that speaks for itself.
  pariah.infest                 - active when infest is up.
]]</script>
										<eventHandlerList />
									</Script>
									<Script isActive="no" isFolder="no">
										<name>Miscellaneous Documentation</name>
										<packageName></packageName>
										<script>--[[
  For the sake of reducing questions, this script is going to contain variables and functions that aren't tied to anything specific.
  
  ataxia_getPing()                    - Returns an average latency from your past 30-odd seconds, can use it to setup accurate timers etc.
                                        tempTimer(10+ataxia_getPing(), \[\[stuff\]\]) for example. Minus the \s
]]</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Login</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Login Function</name>
										<packageName></packageName>
										<script>function levilogin()

sendGMCP('Core.Supports.Add ["Comm.Channel 1"]')
sendGMCP('Core.Supports.Add ["IRE.Target 1"]')
sendGMCP('Core.Supports.Add ["IRE.Time 1"]')
registerAnonymousEventHandler('gmcp.Char.Vitals', 'timerOnBalUsed')
registerAnonymousEventHandler('gmcp.Char.Vitals', 'timerOnEQUsed')
ataxiaToggle("on")
ataxia.defences = {}
ataxia.afflictions = {}
ataxia.vitals = {}
ataxiaTemp.class = gmcp.Char.Status.class
ataxiaTemp.me = gmcp.Char.Status.name
battleRage_Timers = {}
mmp.startup()
resetBashingStats()
ataxia_resetLimbTable()
load_Combat_Tables()
ataxia_createParry()
ataxiaCheckForMissing()
ataxia_precacheQueue()
populate_keepOut()
zgui.buildBashWindow()
tracklegenddeckcountreset()
ataxia_resetPariah()

tempTimer(5, [[ slc_reset();slc_force_display() ]])
tempTimer(7, [[ataxiaNDB.highlightNames = true;ataxiaNDB_loadHighlights()]])

ataxia.vitals.focusbal = true
tftracking = false
dwbparrying = false
dwbexpendtorso = false
DWBWhirlDamage = DWBWhirlDamage or 0

if parrying == nil then parrying = "randomleg" end
expandAlias("parry randomleg")
if ataxiaTemp.parriedLimb == nil then ataxiaTemp.parriedLimb = "none" end
tempTimer(10, [[send("queue add free get 50 ink from palette")]])
tempTimer(12, [[send("queue add inr all")]])

tempTimer(30, [[setafflictionstackslevi()]])
tempTimer(30, [[targetresetafflictionslevi()]])


slow = 0
shape = 0
tAffs = {blindness = true, deafness = true, shield = false, rebounding = false, curseward = false}
ataxia_Echo("Reset target afflictions.")
affcount = 0
can_enlighten = false
engaged = false
ataxiaTemp.parriedLimb = "none"
mindlocked = false
corrupted = false
truelock = false
softlock = false
hardlock = false
daeggerhunt = false
freshblood = false

pm = 100
php = 100
tAffs.bleed = 0
mindinvert = false
spiritinvert = false
bodyinvert = false
blast_count = 0
tburns = 0
wantmindlock = false
need_dwcempower = true
need_falcon = true
inc_imp = false
timpale = false
rtiwaz = false
haveshadow = false
mypreapply = false
bardperformance = false
bardtempo = false
tBals = {tree = true, focus = true, plant = true, salve = true, timers = {}, passive = true}
expandAlias("t Penwize")
tempTimer(14, [[send("queue add freestand wear armour")]])



if gmcp.Char.Status.class == "Depthswalker" then
	ataxia_depthswalkerReset()
  ataxia_depthswalkerReset()
  send("wield left scythe;wield right shield")
  send("queue add eq shadow cloak")
  
end

if gmcp.Char.Status.class == "Monk" then
if gmcp.Char.Vitals.charstats[4]:find("Stance") == 1 then
expandAlias("defswitch tek")
expandAlias("defup tek")
else
expandAlias("defswitch shi")
expandAlias("defup shi")
send("wield staff489282")
--send("curingset switch normal")
end
end

if gmcp.Char.Status.class == "Psion" then
expandAlias("defswitch psion")
expandAlias("defup psion")
send("wield shield")
--send("curingset switch normal")
end

if gmcp.Char.Status.class == "Bard" then
expandAlias("defswitch bard")
expandAlias("defup bard")
send("wield left rapier;wield right lyre")
send("compose paean sonata scherzo maqam prelude")
--send("curingset switch normal")
end


if gmcp.Char.Status.class == "Apostate" then
expandAlias("defswitch apoo")
expandAlias("defup apoo")
send("wield right shield;summon baalzadeen;summon daegger")
--send("curingset switch normal")
end

if gmcp.Char.Status.class == "Blademaster" then
expandAlias("defswitch bm")
expandAlias("defup bm")
send("unwield left;unwield right;sheathe blade")
--send("curingset switch normal")
end

if gmcp.Char.Status.class == "Serpent" then
expandAlias("defswitch serp")
expandAlias("defup serp")
send("wield right dirk;wield left shield")
--send("curingset switch normal")
end

if gmcp.Char.Status.class == "Runewarden" then
  if gmcp.Char.Vitals.charstats[3] == "Spec: Dual Blunt" then 
    send("wield left morningstar511732; wield right morningstar511735")
    expandAlias("defswitch rdwb")
    expandAlias("defup rdwb")
  end

  if gmcp.Char.Vitals.charstats[3] == "Spec: Sword and Shield" then 
    send("wield left longsword;wield right shield")
    send("queue add free empower priority set isaz sleizak inguz")
    expandAlias("defswitch rdwc")
    expandAlias("defup rdwc")
    end

  if gmcp.Char.Vitals.charstats[3] == "Dual Cutting" then 
    send("wield left scimitar405398;wield right scimitar405403")
    send("empower priority set isaz sleizak kena")
    expandAlias("defswitch rdwc")
    expandAlias("defup rdwc")
  end


  if gmcp.Char.Vitals.charstats[3] == "Spec: Two Handed" then 
    send("wield bastard")
    send("empower priority set isaz sleizak tiwaz")
    expandAlias("defswitch rdwc")
    expandAlias("defup rdwc")
    end
send("falcon recall")
end

if ataxia_isClass("infernal") then
	if gmcp.Char.Vitals.charstats[4] == "Spec: Sword and Shield" then 
  send("wield left longsword;wield right shield")
  expandAlias("defswitch isnb")
  expandAlias("defup isnb")
  send("mastery on;hyena recall;order hyena follow me")
  end
  if gmcp.Char.Vitals.charstats[4] == "Spec: Dual Blunt" then 
    send("wield left morningstar511732; wield right morningstar511735")
    expandAlias("defswitch idwb")
    expandAlias("defup idwb")
  end
if gmcp.Char.Vitals.charstats[4] == "Spec: Dual Cutting" then 
    send("unwield left;unwield right;wield left scimitar405403; wield right scimitar405398")
    expandAlias("defswitch idwc")
    expandAlias("defup idwc")
  end
  tempTimer(15, [[send("wear armour;hellforge channel relentless;hellforge channel conqueror")]])
  send("queue add freestand hyena recall")
end

if  gmcp.Char.Status.class == "earth Elemental Lord" then
expandAlias("defup earthlord")
tempTimer(20,[[send("terran tremorsense")]])
end
if ataxia_isClass("Silver Dragon") then
	expandAlias("defup bdragon")
end
if ataxia_isClass("Blue Dragon") then
	expandAlias("defup bdragon")
end
if ataxia_isClass("Gold Dragon") then
	expandAlias("defup bdragon")
end
if ataxia_isClass("Red Dragon") then
	expandAlias("defup bdragon")
end
if ataxia_isClass("Green Dragon") then
	expandAlias("defup bdragon")
end
if ataxia_isClass("Black Dragon") then
	expandAlias("defup bdragon")
end

if ataxia_isClass("Earth Lord") then
	expandAlias("defup earth")
end


sendGMCP("IRE.Rift.Request")

if ataxia.settings.autogallop then
	mmp.settings:setOption("gallop", false)
end




tempTimer(7, [[ sendAll("allies", "enemies") ]])

raiseEvent("logged in")

end</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Legend Deck</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Legend Deck Table</name>
										<packageName></packageName>
										<script>function tracklegenddeckcountreset()
ataxiaTables.ldeckcardscount = {
Agithmaal = 3,                                    
Agithtai = 3,                                     
Alcibiades = 3,                                    
Alligator = 3,                                    
Amamaalier = 3,                                   
Ashaxei = 3,                                       
Bakios = 3,                                        
Bear = 3,                                          
Belladona = 3,                                     
Camilla = 3,                                       
Catarin = 3,                                       
Centaur = 3,                                       
Covenant = 3,                                      
Davis = 3,                                         
Eagle = 3,                                         
Elma = 3,                                          
Enheduanna = 3,                                    
Hansilnar = 3,                                    
Horror = 3,                                        
Jovan = 3,                                         
Kemnast = 3,                                       
Leopard = 3,                                       
Maran = 3,                                         
Matic = 3,                                         
Maya = 3,                                          
Morimbuul = 3,                                     
Nicator = 3,                                       
Pazuzu = 3,                                        
Rudolpho = 3,                                      
SeasoneE = 3,
SeasoneP = 3,                                       
Severian = 3,                                      
Slith = 3,                                         
Sycaerunax = 3,                                    
Travian = 3,                                       
Ugrach = 3,                                        
Urania = 3,                                        
Vulkuz = 3,                                        
Wavel = 3,                                         
Xylthus = 3,                                       
Yozhik = 3,                                        
Yudhishthira = 3,       
Yuthka = 3,         
}
end
</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
							</ScriptGroup>
							<ScriptGroup isActive="yes" isFolder="yes">
								<name>Basher</name>
								<packageName>Basher Old</packageName>
								<script></script>
								<eventHandlerList />
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>zData</name>
									<packageName>zData</packageName>
									<script></script>
									<eventHandlerList />
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>zData</name>
										<packageName></packageName>
										<script>-------------------------------------------------
--                                             --
--       Zulah's Hunting Database: zData       --
--            Last Update: 3/17/22             --
--                                             --
-------------------------------------------------
--                                             --
--                    Setup                    --
--                                             --
-------------------------------------------------
zData = zData or {}

zData.bardName = "Leviticus"
zData.bardVoice = " with a grave voice"

function zData.echo(text)
	hecho(rainbow("\n"..zData.bardName..", appears strumming his lute to a tune of your greatness.\nEager to record your recent hunt in lavish detail and song, "..zData.bardName.." frantically works his quill."))
  cecho("\n\n&lt;gold&gt;"..zData.bardName.."&lt;cyan&gt; says to you"..zData.bardVoice..", \"Quite the slaughter you had at "..text.."\"\n\n")
end

zData.deleteAble = false

createStopWatch("zoneHuntWatch")
stopStopWatch("zoneHuntWatch")
resetStopWatch("zoneHuntWatch")

zData.db = zData.db or {}

zData.defs = zData.defs or {}

zData.char = zData.char or {}
zData.char = {
  lastArea = "NA", 
  
  tempTime = 0,
  minuteTime = 0,
  xpGains = 0,
  xpGainsMin = 0,
  killsPerMinute = 0, 
  
  totalAttacks = 0,
  crithits = 0,
  crit1 = 0,
  crit2 = 0,
  crit3 = 0,
  crit4 = 0,
  crit5 = 0,
  crit6 = 0,
  searedglyph = 0,
  shield = 0,
  paragon = 0,
  mayafigure = 0,
  
  ogold = 0,         -- old gold
  gold = 0,
  gpm = 0,          -- gold per minute
  
 	xp = 0,
  oxp = 0,       --old xp
  
  str = 0,
  dex = 0,
  int = 0,
  con = 0,
  
  killsCount = 0,
  killList = {},
  
  taliCount = 0,
  taliList = {},
  
  when = 0,
}

zData.classList =  {                                                       -- List of classes for searching the database by class
  ["alchemist"] = {["int"] = zData.char.int,},
  ["apostate"] = {["int"] = zData.char.int,},
  ["bard"] = {["str"] = zData.char.str,},
  ["blademaster"] = {["str"] = zData.char.str,},
  ["depthswalker"] = {["str"] = zData.char.str,},
  ["druid"] = {["str"] = zData.char.str,},
  ["infernal"] = {["str"] = zData.char.str,},
  ["jester"] = {["str"] = zData.char.str,},
  ["magi"] = {["int"] = zData.char.int,},
  ["monk"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["occultist"] = {["int"] = zData.char.int,},
  ["paladin"] = {["str"] = zData.char.str,},
  ["pariah"] = {["int"] = zData.char.int,},
  ["priest"] = {["int"] = zData.char.int,},
  ["psion"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["runewarden"] = {["str"] = zData.char.str,},
  ["sentinel"] = {["str"] = zData.char.str,},
  ["serpent"] = {["dex"] = zData.char.dex,},
  ["shaman"] = {["int"] = zData.char.int,},
  ["sylvan"] = {["int"] = zData.char.int,},
  
  ["unnamable"] = {["str"] = zData.char.str,},
  
  ["red dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["blue dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["gold dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["silver dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["green dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["black dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["dragon"] = "na",
  ["elemental"] = "na",                                                         
}</script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>Experience Database</name>
											<packageName></packageName>
											<script>-------------------------------------------------
--                                             --
--                    Setup                    --
--                                             --
-------------------------------------------------
db:create("exp_db", 
  {
    zones={             
      "area",
      "class",
      "boost",
      "critpercent",
      "time",
      "epm",
      "exp",
      "kill",
      "kpm",
      "gold",
      "gpm",
      "str",
      "dex",
      "int",
      "con",  
      "attacks",
      "crits","crits1","crits2","crits3","crits4","crits5","crits6",
      "soa",
      "soaparagon",
      "glyph",
      "maya",
      "tali",
      "killlist",
      "talilist",
      "when",
      },
  })                                                 -- This creates database exp_db (if not already)
zData.db.expdb = db:get_database("exp_db")           -- This assigns the database name to a variable for ease of use purposes.
 
-------------------------------------------------
--                                             --
--  Add a new records: zData.db.zoneAdd(stuff) --
--                                             --
-------------------------------------------------
function zData.db.zoneAdd(area, class, boost, critpercent, time, epm, exp, kill, kpm, gold, gpm, str, dex, int, con, attacks, crits, crits1, crits2, crits3, crits4, crits5, crits6, soa, soaparagon, glyph, maya, tali, killlist, talilist, when)
  db:add(zData.db.expdb.zones,{
    area=area, class=class, boost=boost, critpercent=critpercent, 
    time=time, epm=epm, exp=exp, kill=kill, kpm=kpm, gold=gold, gpm=gpm, 
    str=str, dex=dex, int=int, con=con, 
    attacks=attacks, crits=crits, crits1=crits1, crits2=crits2, crits3=crits3, crits4=crits4, crits5=crits5, crits6=crits6, 
    soa=soa, soaparagon=soaparagon, glyph=glyph, maya=maya, 
    tali=tali, 
    killlist=killlist, 
    talilist=talilist,
    when=when})
  zData.echo("&lt;magenta&gt;"..area.."&lt;cyan&gt;\! &lt;NavajoWhite&gt;"..string.cut(exp,5).."&lt;cyan&gt; experience. &lt;NavajoWhite&gt;"..string.cut(kpm,4).."&lt;cyan&gt; KPM!")
end

-------------------------------------------------
--                                             --
--  Simple Add +1 : zData.db.addChar(addThis)  --
--                                             --
-------------------------------------------------
function zData.db.addChar(addThis)
  zData.char[addThis] = zData.char[addThis] + 1
end

------------------------------------------------------------
--                                                        --
-- Sort Database: zData.db.showData(sortWith, sortStyle)  --
--                                                        --
-- sortWith = Class / all / area search                   --
-- sortStyle = exp / epm / kill / kpm                     --
--                                                        --
------------------------------------------------------------
function zData.db.showData(sortWith, sortStyle, sortDirection)           -- This is my spaghetti code function 
  if zData.hunter then
    zData.hunter.window:show()
  else
    zData.buildHunter()
  end
  zData.db.localDB = {}                                   -- This is the table for sorting and display database results
  local maxShow = 100                     ------&lt;--&lt;--&lt;--&lt;--&lt; Max number of results to show unless ALL is used. Increase to see more (Over 200 will not allow deleting)
  local titleColor = "gold" 
  local menuColor = "purple" 
  local areaColor = "ansiMagenta"
  local classColor = "purple"
  local taliColor = "ansiMagenta"
  local timeColor = "ansiMagenta"
  local killColor = "ansiMagenta"
  local kpmColor = "ansiMagenta"
  local expColor = "ansiMagenta"
  local epmColor = "ansiMagenta"
  local gpmColor = "ansiMagenta"
  local goldColor = "ansiMagenta"
  local showCount = 0  

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Show Rows Based on Sorting  
  local function showCharts(thisChart, thisRow)
    if sortDirection and sortDirection == "down" then
      for _, row in spairs(zData.db.localDB, function(t,a,b) return tonumber(t[a][thisChart]) &lt; tonumber(t[b][thisChart]) end) do    
-------------------------- Limit results to MAXSHOW        
        if sortWith and string.lower(sortWith) == "all" then 
          zData.deleteAble = false
        else 
          if maxShow &lt; 240 then zData.deleteAble = true end
          showCount = showCount + 1
          if showCount &gt;= maxShow then break end      
        end
--------------------------- Blackout 0 talisman counts        
        if tonumber(row.tali) &lt; 1 then taliColor = "black:black" else 
          if thisChart == "tali" then
            taliColor = "gold" 
          else
            taliColor = "ansiMagenta" 
          end
        end
--------------------------- Display Each Row From The Database, Clickable For More Information
        cechoLink("hunterDisplay", 
          "\n  &lt;"..areaColor.."&gt;"..string.cut(row.area.."                   ", 20)
          .." &lt;"..classColor.."&gt;"..string.cut(row.class.."            ", 13)
          .. " &lt;"..taliColor.."&gt;"..string.cut(string.cut(row.tali,2).."   ", 4)
          .. " &lt;"..timeColor.."&gt;"..string.cut(string.cut((row.time/60), 4).."      ", 6)
          .. " &lt;"..killColor.."&gt;"..string.cut(string.cut(row.kill,4).."     ", 6)
          ..  " &lt;"..kpmColor.."&gt;"..string.cut(string.cut(row.kpm,4).."     ", 6)
          ..  " &lt;"..expColor.."&gt;"..string.cut(string.cut(row.exp,4).."     ", 6)
          ..  " &lt;"..epmColor.."&gt;"..string.cut(string.cut(row.epm,5).."      ", 7)
          ..  " &lt;"..gpmColor.."&gt;"..string.cut(string.cut(math.floor(row.gpm),6).."       ", 8) 
          .. " &lt;"..goldColor.."&gt;"..string.cut(row.gold .."      ", 7),
        ---------------------------------------------------------------------------------  
          [[zData.db.clickback(]].._..[[)]], [[]], true)                               -- What to do when clicked on
        --------------------------------------------------------------------------------- 
      end --- End of for _,row
    else
      for _, row in spairs(zData.db.localDB, function(t,a,b) return tonumber(t[a][thisChart]) &gt; tonumber(t[b][thisChart]) end) do    
-------------------------- Limit results to MAXSHOW        
        if sortWith and string.lower(sortWith) == "all" then 
          zData.deleteAble = false
        else 
          if maxShow &lt; 240 then zData.deleteAble = true end
          showCount = showCount + 1
          if showCount &gt;= maxShow then break end      
        end
--------------------------- Blackout 0 talisman counts        
        if tonumber(row.tali) &lt; 1 then taliColor = "black:black" else 
          if thisChart == "tali" then
            taliColor = "gold" 
          else
            taliColor = "ansiMagenta" 
          end
        end
--------------------------- Display Each Row From The Database, Clickable For More Information
        cechoLink("hunterDisplay", 
          "\n  &lt;"..areaColor.."&gt;"..string.cut(row.area.."                   ", 20)
          .." &lt;"..classColor.."&gt;"..string.cut(row.class.."            ", 13)
          .. " &lt;"..taliColor.."&gt;"..string.cut(string.cut(row.tali,2).."   ", 4)
          .. " &lt;"..timeColor.."&gt;"..string.cut(string.cut((row.time/60), 4).."      ", 6)
          .. " &lt;"..killColor.."&gt;"..string.cut(string.cut(row.kill,4).."     ", 6)
          ..  " &lt;"..kpmColor.."&gt;"..string.cut(string.cut(row.kpm,4).."     ", 6)
          ..  " &lt;"..expColor.."&gt;"..string.cut(string.cut(row.exp,4).."     ", 6)
          ..  " &lt;"..epmColor.."&gt;"..string.cut(string.cut(row.epm,5).."      ", 7)
          ..  " &lt;"..gpmColor.."&gt;"..string.cut(string.cut(math.floor(row.gpm),6).."       ", 8) 
          .. " &lt;"..goldColor.."&gt;"..string.cut(row.gold .."      ", 7),
        ---------------------------------------------------------------------------------  
          [[zData.db.clickback(]].._..[[)]], [[]], true)                               -- What to do when clicked on
        --------------------------------------------------------------------------------- 
      end --- End of for _,row
    end
  end --- End of local function showCharts()
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

--------------------------- Show Last 3 Zones
  local function showLast(thisChart, countBack)
    showCount = 0  
    local useRow = tonumber(#zData.db.localDB) - countBack
    for _, row in spairs(zData.db.localDB) do               
      if _ == useRow then
-------------------------- Limit results to 1        
        showCount = showCount + 1
        if showCount &gt;= 2 then break end          
--------------------------- Blackout 0 talisman counts        
        if tonumber(row.tali) &lt; 1 then taliColor = "black:black" else taliColor = "ansiMagenta" end
--------------------------- Display Each Row From The Database, Clickable For More Information
        cechoLink("hunterDisplay", 
          "&lt;"..areaColor.."&gt;"..string.cut(row.area.."                   ", 20)
          .." &lt;"..classColor.."&gt;"..string.cut(row.class.."            ", 13)
          .. " &lt;"..taliColor.."&gt;"..string.cut(string.cut(row.tali,2).."   ", 4)
          .. " &lt;"..timeColor.."&gt;"..string.cut(string.cut((row.time/60), 4).."      ", 6)
          .. " &lt;"..killColor.."&gt;"..string.cut(string.cut(row.kill,4).."     ", 6)
          ..  " &lt;"..kpmColor.."&gt;"..string.cut(string.cut(row.kpm,4).."     ", 6)
          ..  " &lt;"..expColor.."&gt;"..string.cut(string.cut(row.exp,4).."     ", 6)
          ..  " &lt;"..epmColor.."&gt;"..string.cut(string.cut(row.epm,5).."      ", 7)
          ..  " &lt;"..gpmColor.."&gt;"..string.cut(string.cut(math.floor(row.gpm),6).."       ", 8) 
          .. " &lt;"..goldColor.."&gt;"..string.cut(row.gold .."      ", 7),
        ---------------------------------------------------------------------------------  
          [[zData.db.clickback(]].._..[[)]], [[]], true)                               -- What to do when clicked on
        --------------------------------------------------------------------------------- 
      end --- End of for _,row
    end
  end --- End of local function showCharts()
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  
-------------------------- Search For sortWith (First level sort: class name / all / area random
  if sortWith then
    if string.lower(sortWith) == "all" or
       string.lower(sortWith) == "tali" or
       string.lower(sortWith) == "time" or
       string.lower(sortWith) == "kill" or 
       string.lower(sortWith) == "kpm" or
       string.lower(sortWith) == "exp" or
       string.lower(sortWith) == "epm" or
       string.lower(sortWith) == "gold" or
       string.lower(sortWith) == "gpm"
     then
      zData.db.localDB = db:fetch(zData.db.expdb.zones)
    elseif table.contains(zData.classList, string.lower(sortWith)) then
      zData.db.localDB = db:fetch(zData.db.expdb.zones, db:like(zData.db.expdb.zones.class,"%"..sortWith.."%")) 
    else
	    zData.db.localDB = db:fetch(zData.db.expdb.zones, db:like(zData.db.expdb.zones.area,"%"..sortWith.."%")) 
    end   
  else
    zData.db.localDB = db:fetch(zData.db.expdb.zones)
  end
  
-------------------------- Clear Display   
  clearWindow("hunterDisplay") 
-------------------------- Display NO Results
  if #zData.db.localDB == 0 then
    cecho("hunterDisplay", "\n\n&lt;red&gt;     Nothing Found Searching &lt;gold&gt;Zones&lt;red&gt; for the string: &lt;gold&gt;"..sortWith.."\n       &lt;green&gt;Try Typing: &lt;gold&gt;zbash "..string.lower(gmcp.Char.Status.class).."\n")
-------------------------- Display Results
  else
    cecho("hunterDisplay", "\n                                   &lt;"..titleColor.."&gt;Detailed Hunting Scrolls\n")
-------------------------- Display Last 3 Zones
  hecho("hunterDisplay", rainbow("@@#############################################################################################@@"))    
  cecho("hunterDisplay", "\n&lt;"..titleColor.."&gt;1:")
    showLast("when", 0)
  cecho("hunterDisplay", "\n&lt;"..titleColor.."&gt;2:")
    showLast("when", 1)
  cecho("hunterDisplay", "\n&lt;"..titleColor.."&gt;3:")
    showLast("when", 2)
  cecho("hunterDisplay", "\n")
  hecho("hunterDisplay", rainbow("@@#############################################################################################@@\n"))
-------------------------- Display
    cecho("hunterDisplay","&lt;"..menuColor.."&gt;                                ")
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Tali", [[zData.db.showData("tali")]], [[]], true)
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Time", [[zData.db.showData("time")]], [[]], true)
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Kill", [[zData.db.showData("kill")]], [[]], true)
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;KPM", [[zData.db.showData("kpm")]], [[]], true)
    cechoLink("hunterDisplay","    &lt;"..menuColor.."&gt;Exp", [[zData.db.showData("exp")]], [[]], true)
    cechoLink("hunterDisplay","     &lt;"..menuColor.."&gt;EPM", [[zData.db.showData("epm")]], [[]], true)
    cechoLink("hunterDisplay","    &lt;"..menuColor.."&gt;GPM", [[zData.db.showData("gpm")]], [[]], true)
    cechoLink("hunterDisplay","      &lt;"..menuColor.."&gt;Gold", [[zData.db.showData("gold")]], [[]], true) 
-------------------------- Display Results based on search(sortStyle)    
    if (sortStyle and string.lower(sortStyle) == "all") or (sortWith and string.lower(sortWith) == "all") then
      showCharts("exp", "expColor") 
    elseif (sortStyle and string.lower(sortStyle) == "exp") or (sortWith and string.lower(sortWith) == "exp") then
      expColor = "gold"
      showCharts("exp", "expColor")  
    elseif (sortStyle and string.lower(sortStyle) == "epm") or (sortWith and string.lower(sortWith) == "epm") then
      epmColor = "gold"
      showCharts("epm", "epmColor")  
    elseif (sortStyle and string.lower(sortStyle) == "time") or (sortWith and string.lower(sortWith) == "time") then
      timeColor = "gold"
      showCharts("time", "timeColor")  
    elseif (sortStyle and string.lower(sortStyle) == "tali") or (sortWith and string.lower(sortWith) == "tali") then
      taliColor = "gold"
      showCharts("tali", "taliColor")    
    elseif (sortStyle and string.lower(sortStyle) == "gpm") or (sortWith and string.lower(sortWith) == "gpm") then
      gpmColor = "gold"
      showCharts("gpm", "gpmColor") 
    elseif (sortStyle and string.lower(sortStyle) == "gold") or (sortWith and string.lower(sortWith) == "gold") then
      goldColor = "gold"
      showCharts("gold", "goldColor")  
    elseif (sortStyle and string.lower(sortStyle) == "kill") or (sortWith and string.lower(sortWith) == "kill") then
      killColor = "gold"
      showCharts("kill", "killColor")  
    elseif (sortStyle and string.lower(sortStyle) == "kpm") or (sortWith and string.lower(sortWith) == "kpm") then
      kpmColor = "gold"
      showCharts("kpm", "kpmColor")  
    else
      kpmColor = "gold"
      showCharts("kpm", "kpmColor")
    end  
    cecho("hunterDisplay","\n&lt;"..menuColor.."&gt;                                ")
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Tali", [[zData.db.showData("tali", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Time", [[zData.db.showData("time", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Kill", [[zData.db.showData("kill", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;KPM", [[zData.db.showData("kpm", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","    &lt;"..menuColor.."&gt;Exp", [[zData.db.showData("exp", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","     &lt;"..menuColor.."&gt;EPM", [[zData.db.showData("epm", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","    &lt;"..menuColor.."&gt;GPM", [[zData.db.showData("gpm", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","      &lt;"..menuColor.."&gt;Gold", [[zData.db.showData("gold", nil, "down")]], [[]], true)  
  end
-------------------------- Display Footer     
  hecho("hunterDisplay", rainbow("\n@@#############################################################################################@@\n"))  
end 


-------------------------------------------------
--                                             --
--  View a saved record: zData.db.clickback()  --
--                                             --
-------------------------------------------------
function zData.db.clickback(thisRow)
  local deleteRow = 0
-------------------------- Clear Display   
  clearWindow("hunterDisplay") 
-------------------------- DELETE DATABASE ENTRY ---------------------------
  if zData.deleteAble then
    for _, row in spairs(zData.db.localDB) do
      if _ == thisRow then
        deleteRow = _
      end
    end
    cechoLink("hunterDisplay","\n&lt;red&gt;  --@@ DELETE ENTRY @@--  ", [[zData.db.clickbackdelete(]]..thisRow..[[)]], [[Clicking here will PERMENENTLY DELETE this entry]], true)
  end
----------------------------------------------------------------------------
  hecho("hunterDisplay", rainbow("\n@@#############################################################################################@@\n")) 
-------------------------- Display Header ^
  cecho("hunterDisplay","\n  &lt;purple&gt;Extended Report For: &lt;gold&gt;"..zData.db.localDB[thisRow].class)
  cecho("hunterDisplay","\n  &lt;purple&gt;Hunting in the Zone: &lt;gold&gt;"..zData.db.localDB[thisRow].area)
  cecho("hunterDisplay","\n  &lt;purple&gt;Time Spent: &lt;ansiMagenta&gt;"..string.cut((zData.db.localDB[thisRow].time/60),4).." minutes")
  cecho("hunterDisplay","\n  &lt;purple&gt;Experience: &lt;ansiMagenta&gt;"..zData.db.localDB[thisRow].exp)
  cecho("hunterDisplay","\n  &lt;purple&gt;Experience Modifier: &lt;ansiMagenta&gt;"..zData.db.localDB[thisRow].boost.."\%\n")
  cecho("hunterDisplay","\n  &lt;purple&gt;Stats: &lt;ansiMagenta&gt;Str: &lt;gold&gt;"..zData.db.localDB[thisRow].str.." &lt;ansiMagenta&gt;Dex: &lt;gold&gt;"..zData.db.localDB[thisRow].dex.." &lt;ansiMagenta&gt;Int: &lt;gold&gt;"..zData.db.localDB[thisRow].int.." &lt;ansiMagenta&gt;Con: &lt;gold&gt;"..zData.db.localDB[thisRow].con.."\n")
  cecho("hunterDisplay","\n     &lt;purple&gt;Critical Hit Chance: &lt;ansiMagenta&gt;"..zData.db.localDB[thisRow].critpercent.."\%")
  cecho("hunterDisplay","\n &lt;gold&gt;"..zData.db.localDB[thisRow].crits.."  &lt;purple&gt;Critical Hits")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits1.."  ",3).." &lt;ansiMagenta&gt; 2x "..string.cut("Critical                    ",25).."&lt;gold&gt;"..zData.db.localDB[thisRow].glyph.."  &lt;ansiMagenta&gt;Seared Glyph")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits2.."  ",3).." &lt;ansiMagenta&gt; 4x "..string.cut("Crushing                    ",25).."&lt;gold&gt;"..zData.db.localDB[thisRow].soa.."  &lt;ansiMagenta&gt;Shield of Absorption")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits3.."  ",3).." &lt;ansiMagenta&gt; 8x "..string.cut("Obliterating                    ",25).."&lt;gold&gt;"..zData.db.localDB[thisRow].soaparagon.."  &lt;ansiMagenta&gt;SoA Paragon")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits4.."  ",3).." &lt;ansiMagenta&gt;16x "..string.cut("Annihilating                    ",25).."&lt;gold&gt;"..zData.db.localDB[thisRow].maya.."  &lt;ansiMagenta&gt;Maya Figurine")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits5.."  ",3).." &lt;ansiMagenta&gt;32x "..string.cut("World Shattering                    ",25))
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits6.."  ",3).." &lt;ansiMagenta&gt;64x "..string.cut("Plane Razing                    ",25))
  cecho("hunterDisplay","\n")   
  cecho("hunterDisplay","\n &lt;gold&gt;"..zData.db.localDB[thisRow].gold.." &lt;ansiMagenta&gt; : Total Gold Gained")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut((zData.db.localDB[thisRow].gpm),5).."&lt;ansiMagenta&gt; : Gold Gained Per Minute")
  cecho("hunterDisplay","\n") 
-------------------------- Breakdown the killList string into a table for display
  local tempTable = string.split(zData.db.localDB[thisRow].killlist, "| ")
  local tempKillTable = {}
  for k, v in pairs(tempTable) do
    if tempKillTable[v] then 
      tempKillTable[v] = tempKillTable[v] + 1
    else
      tempKillTable[v] = 1
    end
  end   
  cecho("hunterDisplay","\n &lt;gold&gt;"..zData.db.localDB[thisRow].kill.." &lt;purple&gt;Kills at &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].kpm,5).."&lt;purple&gt; Kills Per Minute")
  for k, v in spairs(tempKillTable) do
    if v&gt;9 then
      cecho("hunterDisplay","\n  &lt;purple&gt;\["..string.cut(" ",1).."&lt;gold&gt;"..string.cut(v.." ",3).."&lt;purple&gt;\]  &lt;ansiMagenta&gt;"..k)
    else
      cecho("hunterDisplay","\n  &lt;purple&gt;\["..string.cut("  ",2).."&lt;gold&gt;"..string.cut(v.." ",3).."&lt;purple&gt;\]  &lt;ansiMagenta&gt;"..k)
    end
  end
  cecho("hunterDisplay","\n") 
-------------------------- Breakdown the long taliList string into a table for display
  cecho("hunterDisplay","\n &lt;purple&gt;Total Talismans: &lt;gold&gt;"..zData.db.localDB[thisRow].tali)
  if tonumber(zData.db.localDB[thisRow].tali) &gt; 0 then
  tempTable = string.split(zData.db.localDB[thisRow].talilist, "| ") 
  local tempTaliTable = {}
  for k, v in pairs(tempTable) do
    if tempTaliTable[v] then 
      tempTaliTable[v] = tempTaliTable[v] + 1
    else
      tempTaliTable[v] = 1
    end
  end   
  for k, v in spairs(tempTaliTable) do 
    if v&gt;9 then
      cecho("hunterDisplay","\n  &lt;purple&gt;\["..string.cut(" ",1).."&lt;gold&gt;"..string.cut(v.." ",3).."&lt;purple&gt;\]  &lt;ansiMagenta&gt;"..string.gsub(k, ":", "&lt;purple&gt;:"))
    else
      cecho("hunterDisplay","\n  &lt;purple&gt;\["..string.cut("  ",2).."&lt;gold&gt;"..string.cut(v.." ",3).."&lt;purple&gt;\]  &lt;ansiMagenta&gt;"..string.gsub(k, ":", "&lt;purple&gt;:"))
    end
  end 
  end
-------------------------- Display Footer  
  cecho("hunterDisplay","\n")
  hecho("hunterDisplay", rainbow("\n@@#############################################################################################@@"))
  cechoLink("hunterDisplay", "\n                                    Click Here For zBash Chart                               ", [[zData.db.showData("kpm")]], [[]], true)
  hecho("hunterDisplay", rainbow("\n@@#############################################################################################@@"))
end 


-------------------------------------------------
--                                             --
--  Delete a saved record:                     --
--               zData.db.clickbackdelete()    --
--                                             --
-------------------------------------------------
function zData.db.clickbackdelete(thisRow)
  db:delete(zData.db.expdb.zones, zData.db.localDB[thisRow]._row_id)
  clearWindow("hunterDisplay") 
  hecho("hunterDisplay", rainbow("\n\n\n\n@@#############################################################################################@@"))  
  cecho("hunterDisplay","\n&lt;red&gt;                                     --@@ DELETED ENTRY @@--  ")
  hecho("hunterDisplay", rainbow("\n@@#############################################################################################@@\n")) 
  cechoLink("hunterDisplay", "                                    Click Here For zBash Chart                               ", [[zData.db.showData("kpm")]], [[]], true)
  hecho("hunterDisplay", rainbow("\n      @@#################################################################################@@\n"))
end


</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>movement</name>
											<packageName></packageName>
											<script>-------------------------------------------------
--                                             --
--               zData.movement()              --
--  This Function Runs Everytime Room Updates  --
--                                             --
-------------------------------------------------
function zData.movement() 
-----------------------------------------------------------------------------------------------
-- Update Area    
  if gmcp.Room.Info.area ~= zData.char.lastArea then  -------------&lt;--&lt;--&lt; Zone Change Detected

-----------------------------------------------------------------------------------------------
-- Collect experience percent from gmcp, check old xp (zData.char.oxp)
    if string.match(gmcp.Char.Status.xp, "%d+.%d+") then
      zData.char.xp = tonumber(string.match(gmcp.Char.Status.xp, "%d+.%d+"))
    elseif string.match(gmcp.Char.Status.xp, "%d+") then
      zData.char.xp = tonumber(string.match(gmcp.Char.Status.xp, "%d+"))
    end
    if zData.char.oxp == 0 then zData.char.oxp = zData.char.xp end

-----------------------------------------------------------------------------------------------
-- If your exp is not = to your old exp AND you have been in a zone FOR MORE &gt; THAN 60 SECONDS
    if (zData.char.oxp ~= zData.char.xp or zData.char.killsCount &gt; 0) and getStopWatchTime("zoneHuntWatch") &gt; 60 then
      stopStopWatch("zoneHuntWatch")  

-----------------------------------------------------------------------------------------------
-- Update zData.Character Variables used for saving to the Database
      zData.char.tempTime = getStopWatchTime("zoneHuntWatch")
      zData.char.minuteTime = zData.char.tempTime/60
      zData.char.xpGains = zData.char.xp-zData.char.oxp
      zData.char.xpGainsMin = zData.char.xpGains/zData.char.minuteTime
      zData.char.killsPerMinute = zData.char.killsCount/zData.char.minuteTime
      zData.char.gpm = zData.char.gold/zData.char.minuteTime

-----------------------------------------------------------------------------------------------
-- Convert tables to strings for the database (will turn back to tables when pulled)
      zData.char.killListString = nil
      if #zData.char.killList &gt; 0 then
        zData.char.killListString = table.concat(zData.char.killList, "| ")
      end
      zData.char.taliListString = nil
      if #zData.char.taliList &gt; 0 then
        zData.char.taliListString = table.concat(zData.char.taliList, "| ")
      end

-----------------------------------------------------------------------------------------------
-- Record when this happened with Epoch time
      zData.char.when = getEpoch()
      
-----------------------------------------------------------------------------------------------
-- Send All information to database   
      zData.db.zoneAdd(
        zData.char.lastArea,
        gmcp.Char.Status.class, 
        zData.defs.exp, 
        zData.defs.crit, 
        zData.char.tempTime, 
        zData.char.xpGainsMin, 
        zData.char.xpGains, 
        zData.char.killsCount, 
        zData.char.killsPerMinute, 
        zData.char.gold, 
        zData.char.gpm, 
        zData.char.str, 
        zData.char.dex, 
        zData.char.int, 
        zData.char.con, 
        zData.char.totalAttacks, 
        zData.char.crithits, zData.char.crit1, zData.char.crit2, zData.char.crit3, zData.char.crit4, zData.char.crit5, zData.char.crit6, 
        zData.char.shield, 
        zData.char.paragon, 
        zData.char.searedglyph, 
        zData.char.mayafigure, 
        zData.char.taliCount, 
        zData.char.killListString, 
        zData.char.taliListString,
        zData.char.when
        )
    end

-----------------------------------------------------------------------------------------------
-- Reset all saved data for next area
    zData.char = {
      lastArea = gmcp.Room.Info.area,
      tempTime = 0,
      minuteTime = 0,
      xpGains = 0,
      xpGainsMin = 0,
      killsPerMinute = 0, 
      killsCount = 0,
      taliCount = 0,
      ogold = gmcp.Char.Status.gold,
      gold = 0,
      gpm = 0,
      totalAttacks = 0,
      crithits = 0,
      crit1 = 0,
      crit2 = 0,
      crit3 = 0,
      crit4 = 0,
      crit5 = 0,
      crit6 = 0,
      searedglyph = 0,
      shield = 0,
      paragon = 0,
      mayafigure = 0,     
      killList = {},
      taliList = {},
      when= 0,
    }

-----------------------------------------------------------------------------------------------
-- Save OLD experience for new zone    
    if string.match(gmcp.Char.Status.xp, "%d+.%d+") then
      zData.char.oxp = tonumber(string.match(gmcp.Char.Status.xp, "%d+.%d+"))
    elseif string.match(gmcp.Char.Status.xp, "%d+") then
      zData.char.oxp = tonumber(string.match(gmcp.Char.Status.xp, "%d+"))
    end

-----------------------------------------------------------------------------------------------
-- Reset and Start Stopwatch for this zone (always running / only resets here on zone change)
    resetStopWatch("zoneHuntWatch")
    startStopWatch("zoneHuntWatch") 
	end  
end
-----------------------------------------------------------------------------------------------
registerAnonymousEventHandler("gmcp.Room.Info", "zData.movement") ---&lt;--&lt; Run When Room Updates
-----------------------------------------------------------------------------------------------</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Rainbow Script</name>
											<packageName></packageName>
											<script>-- Take in a string to rainbow-ify, optionally rainbow type and frequency for type 1
-- str   : string to rainbow-ify
-- type  : type of rainbow-ification
--         0 - single cycle of colours, default option
--         1 - multiple cycles determined by frequency, possible less than a full cycle
--         2 - Old, ugly, technically rainbowed thing
-- freq  : color frequency of rainbow in degrees, 0 to 360, default 15
--         higher freqs produce much shorter cycles of color, lower freqs longer cycles
--         freq of 1 is solid color
-- Return: returns a string suitable for plugging into hecho, colored in the rainbow
--         style chosen
function rainbow(str, type, freq)
	-- default settings, set to default if out-of-bounds
	type = type or 0
	if type &gt; 2 or type &lt; 0 then type = 0 end

	freq = freq or 15

	if freq &lt; 0 or freq &gt; 360 then freq = 15 end

	local product = ""
	local phase = 2 * math.pi / 3

	local rand = betterRand()


	if type == 0 then -- Non-repeating rainbow
		freq = 2*math.pi / #str
		for i = 1, #str do
			if string.sub(str, i, i) == " " then
				product = product..string.sub(str, i, i)
			else
				r = math.sin(freq*i + phase + rand*10) * 127 + 128
				g = math.sin(freq*i + 0 + rand*10) * 127 + 128
				b = math.sin(freq*i + 2*phase + rand*10) * 127 + 128
				r = string.format("%x", r)
				g = string.format("%x", g)
				b = string.format("%x", b)

				if #r &lt; 2 then r = "0"..r end
				if #g &lt; 2 then g = "0"..g end
				if #b &lt; 2 then b = "0"..b end
				product = product.."|c"..r..g..b..string.sub(str, i, i)
			end
		end
	elseif type == 1 then -- Repeating rainbow

		freq = freq * math.pi / 180
		for i = 1, #str do
			--if string.sub(str, i, i) == " " then
			--	product = product..string.sub(str, i, i)
			--else
				r = math.sin(freq*i + phase + rand*10) * 127 + 128
				g = math.sin(freq*i + 0 + rand*10) * 127 + 128
				b = math.sin(freq*i + 2*phase + rand*10) * 127 + 128
				r = string.format("%x", r)
				g = string.format("%x", g)
				b = string.format("%x", b)

				if #r &lt; 2 then r = "0"..r end
				if #g &lt; 2 then g = "0"..g end
				if #b &lt; 2 then b = "0"..b end
				product = product.."|c"..r..g..b..string.sub(str, i, i)
			--end
		end
	elseif type == 2 then -- Old, uglier rainbow
		local colours = { "|cFF0000", "|cFF6600", "|cFFEE00", "|c00FF00", "|c0099FF", "|c4400FF", "|c9900FF" }
		local pass = math.random(7)

		for char in str:gmatch"." do
			--if char == " " then
			--	product = product .. char
			--else
				product = product .. colours[pass] .. char
				if pass == #colours then pass = 1 end
					pass = pass + 1
			--end
		end
	end
	return product.."|r"
end
 
function betterRand()
	randomtable = {}
	for i = 1, 97 do
		randomtable[i] = math.random()
	end
	local x = math.random()
	local i = 1 + math.floor(97*x)
	x, randomtable[i] = randomtable[i], x
	return x
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildHunter</name>
											<packageName></packageName>
											<script>function zData.buildHunter()
  zData.hunter = {}

  --Create the hunter Adjustable
  zData.hunter.window = Adjustable.Container:new({
    name = "zgui.hunter.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = "background-color:rgba(0,40,100,100%); border: 5px inset purple;",
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)

  --Create the hunter container
  zData.hunter.container = Geyser.Container:new({
    name = "zData.hunter.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zData.hunter.window)  

  --Create the hunter Console
  zData.hunter.console = Geyser.MiniConsole:new({
    name = "hunterDisplay",
    x = 0, y = 0,
    autoWrap = false,
    width = "100%",
    height = "100%",
    color="black",
    --scrollBar = true,
  },zData.hunter.container) 

  setFontSize("hunterDisplay", 9)
  zData.hunter.window:setTitle("Hunting Scrolls","gray")
  zData.hunter.window:show()

end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Bashing</name>
									<packageName></packageName>
									<script>ataxiaBasher = ataxiaBasher or {}
ataxiaBasher.functions = ataxiaBasher.functions or {}

function get_Battlerage()
	ataxiaBasher.battlerage = {
		Alchemist = {
			small = "throw miasma at "..target, large = "educe magnesium "..target,
			raze = "throw caustic at "..target,
		},
		
		Apostate = {
			small = "stare "..target.." convulsions", large = "daegger burrow "..target,
			raze = "daegger pierce "..target,specialuse = "bloodlet " ..target, 
      specialafflict = "possess " ..target, special = "possess " ..target
      --Convulsions - Small Rage - 14 Rage | 16 Cooldown
      -- Pierce - 17 rage
      --Horrify - Gives Fear - 29 Rage | 34 CD
      -- Dagger burrow - Large Rage - 36 Rage | 24 CD
      --Bloodlet - Uses Sensitivity or Stun - 25 Rage | 23 Cooldown
      --Possess - Gives Charm - 32 Rage | 43 CD
      
		},	
		
		Bard = {
			small = "moulinet "..target,	large = "howlslash "..target,
      special2 = "play charm at "..target, special = "play trill at "..target
		},

		Blademaster = {
			small = "leapstrike "..target, large = "spinslash "..target,
			raze = "shin shatter "..target, special = "shin daze "..target,
      specialuse = "strike "..target.." head", specialafflict = "nsl " ..target,
      --Headstrike (Strike Target Head) - Uses Recklessness or Fear
      --Nerveslash - NSL Target - gives Weakness
		},

		["Black Dragon"] = {
			small = "dragonspit "..target,
			large = "override "..target,
			raze = "dissolve "..target,
      special = "dragonfear " ..target,
		},
		
		["Blue Dragon"] = {
			small = "dragonchill "..target,
			large = "override "..target,
			raze = "frostrive "..target,
      special = "ague "..target,
		},
		
		Depthswalker = {
			small = "shadow drain "..target, large = "shadow lash "..target,
			raze = "intone nakail "..target,
		},
    
    Infernal = {
      small = "ravage "..target, large = "spike "..target,
      raze = "shiver "..target, special = "soulshield",
    },
		
		Jester = {
			small = "noogie "..target, large = "ensconce firecracker on "..target,
			raze = "throw jacks at "..target,
		},
		
		Magi = {
			small = "cast windlash at "..target, large = "cast squeeze "..target,
      special = "cast dilation at "..target,
		},
		
		Monk = { 
			small = "sbp "..target,				large = "tnk "..target,
      raze = "spk "..target, special = "mind scramble " ..target,
		},
		Occultist = {
			small = "harry "..target,			large = "chaosgate "..target
		},
    
    Pariah = {
      small = "blood boil "..target,  large = "swarm feast "..target,
      raze = "accursed scour "..target, specialuse = "trace spider "..target,
      specialafflict = "accursed wail "..target, special = "accursed wail "..target,
      --Trace Spider - Sensitive or Inhitbited
      --Accursed Wail - Gives Clumsiness
    },
    
    Paladin = {
      small = "harrow "..target,
      large = "perform rite of shock at "..target,
      raze = "faithrend "..target,
    },
		
		Priest = {
			small = "angel torment "..target,
			large = "perform rite of desolation on "..target,
			raze = "crack "..target,
		},
		
		Psion = {
			small = "weave barbedblade "..target,
			large = "weave whirlwind "..target,
      special = "enact regrowth "..target,
      raze = "weave pulverise "..target,
		},
		
		Runewarden = {
			small = "collide "..target,		large = "onslaught "..target,
			raze = "fragment "..target, special = "bulwark",
		},

		Sentinel = {
			small = "pester "..target, 
			large = "skewer "..target,
		},

		Serpent = {
			small = "thrash "..target,
			large = "throatrip "..target,
			raze = "excoriate "..target,
      special = "obliviate "..target,		
		},
		
		Shaman = {
			small = "curse "..target.." corruption",
			large = "curse "..target.." haemorrhage",
			raze = "curse "..target.." vulnerability",
      special = "invoke korkma "..target,
      special2 = "invoke cesaret "..target,
		},
		
		Sylvan = {
			small = "cast torrent at "..target,
			large = "stonevine "..target,
		},
    
    Unnamable = {
      small = "unnamable shriek "..target,
      large = "unnamable destroy "..target,
      raze = "unnamable sunder "..target,
    },
		
		["Silver Dragon"] = {
			small = "overwhelm "..target,
			large = "dragonspark "..target,
			raze = "splinter "..target,
		},
		
		["Water Elemental"] = {
			small = "manifest icicles "..target,
			large = "manifest needlerain "..target,
		},
    
		["Air Elemental"] = {
			small = "manifest bolt "..target, 
			large = "manifest pressurewave "..target
		},
    
    ["Fire Elemental"] = {
      small = "manifest engulf "..target,
      large = "manifest devastation "..target,
      raze = "manifest wires "..target,
    },
    
    ["Earth Elemental"] = {
      small = "terran smash "..target,
      large = "terran flurry "..target,
      raze = "terran charge "..target,
    },
    
    ["Green Dragon"] = {
      small = "dragonspit "..target,
      large = "override "..target,
      raze = "deteriorate "..target,
    }, 
    
    ["Red Dragon"] = {
      small = "overwhelm "..target,
      large = "dragonblaze "..target,
      raze = "melt "..target,
    },
    
    ["Gold Dragon"] = {
      small = "overwhelm "..target,
      large = "psiblast "..target,
      raze = "psishatter "..target,
    },   
	}
end

function ataxiaBasher_elevatemob(mob)
	local area = gmcp.Room.Info.area
	table.remove(ataxiaBasher.targetList[area], table.index_of(ataxiaBasher.targetList[area], mob))
	table.insert(ataxiaBasher.targetList[area], 1, mob)
	ataxiaEcho("Elevated priority of "..mob..".")
	ataxia_saveSettings(false)
end

function ataxiaBasher_addmob(mob)
	local area = gmcp.Room.Info.area
	if not table.contains(ataxiaBasher.targetList[area], mob) then
		table.insert(ataxiaBasher.targetList[area], mob)
		ataxiaEcho("Added "..mob.." to "..area.."'s target list.")
	else
		ataxiaEcho("That mob is already on the list.")
	end
	ataxia_saveSettings(false)
end

function ataxiaBasher_remmob(mob)
	local area = gmcp.Room.Info.area
	if table.contains(ataxiaBasher.targetList[area], mob) then
		for i,v in pairs(ataxiaBasher.targetList[area]) do
			if v == mob then
				table.remove(ataxiaBasher.targetList[area], i)
				break
			end
		end
		ataxiaEcho("Removed "..mob.." from "..area.."'s target list.")
	else
		ataxiaEcho("That mob is not on the list.")
	end
	ataxia_saveSettings(false)
end

function ataxiaBasher_ignoremob(mob)
	if not table.contains(ataxiaBasher.mobIgnore, mob) then
		table.insert(ataxiaBasher.mobIgnore, mob)
		ataxiaEcho("Added "..mob.." to ignore list.")
	else
		ataxiaEcho("That mob is already on the list.")
	end
	ataxia_saveSettings(false)
end

function ataxiaBasher_unignoremob(mob)
	if table.contains(ataxiaBasher.mobIgnore, mob) then
		for i,v in pairs(ataxiaBasher.mobIgnore) do
			if v == mob then
				table.remove(ataxiaBasher.mobIgnore, i)
				break
			end
		end
		ataxiaEcho("Removed "..mob.." from the ignore list.")
	else
		ataxiaEcho("That mob is not on the list.")
	end
	ataxia_saveSettings(false)
end

function ataxiaBasher_dangerAdd(mob)
	ataxiaBasher.dangerList = ataxiaBasher.dangerList or {}
	if ataxiaBasher.dangerList[mob] then
		ataxiaEcho(mob:title().." is already in the danger list.")
	else
		ataxiaBasher.dangerList[mob] = true
		ataxiaEcho("Added "..mob.." to the danger list.")
	end
end

function ataxiaBasher_dangerRemove(mob)
	ataxiaBasher.dangerList = ataxiaBasher.dangerList or {}
	if ataxiaBasher.dangerList[mob] then
		ataxiaBasher.dangerList[mob] = nil
		ataxiaEcho("Removed "..mob.." from the danger list.")
	else
		ataxiaEcho(mob:title().." was not considered dangerous anyway.")
	end
end

function ataxiaBasher_shieldingRemove(mob)
	ataxiaBasher.noShieldBreak = ataxiaBasher.noShieldBreak or {mobs = {}, threshold = 0}
	if ataxiaBasher.noShieldBreak.mobs[mob] then
		ataxiaBasher.noShieldBreak.mobs[mob] = nil
		ataxiaEcho("Removed "..mob.." from the shield-safety list.")
	else
		ataxiaEcho(mob:title().." was already recognised as being able to break shields.")
	end
end

function ataxiaBasher_shieldingAdd(mob)
	ataxiaBasher.noShieldBreak = ataxiaBasher.noShieldBreak or {mobs = {}, threshold = 0}
	if ataxiaBasher.noShieldBreak.mobs[mob] then
		ataxiaEcho(mob:title().." is already in the shielding list.")
	else
		ataxiaBasher.noShieldBreak.mobs[mob] = true
		ataxiaEcho("Added "..mob.." to the shielding list.")
	end
end

function ataxiaBasher_alert(alerttype)
	if ataxiaTemp.playedAlarm then return end
	local alarm = alerttype:title()
	if not hasFocus() then 
		playSoundFile(getMudletHomeDir()..[[/Alerts/]]..alarm..[[.mp3]]) 
	end
	
	ataxiaTemp.playedAlarm = tempTimer(3, [[ ataxiaTemp.playedAlarm = nil ]])
end</script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Bashing Functions</name>
										<packageName></packageName>
										<script>function ataxiaBasher_attack()

	ataxiaBasher_bashingFuncs = {}
	ataxiaBasher_bashingFuncs = {
    --Elementals
  	["Air Elemental"] = _G.ataxiaBasher_aEleBashing,
		["Fire Elemental"] = _G.ataxiaBasher_fEleBashing,
    ["Water Elemental"] = _G.ataxiaBasher_wEleBashing, 
    ["Earth Elemental"] = _G.ataxiaBasher_eEleBashing,
    --Dragons
		["Blue Dragon"] = _G.ataxiaBasher_dragonBashing,
		["Black Dragon"] = _G.ataxiaBasher_dragonBashing,
    ["Green Dragon"] = _G.ataxiaBasher_dragonBashing,
    ["Golden Dragon"] = _G.ataxiaBasher_dragonBashing,
    ["Red Dragon"] = _G.ataxiaBasher_dragonBashing,
    ["Silver Dragon"] = _G.ataxiaBasher_dragonBashing,
    --Standard Classes
    Alchemist = _G.ataxiaBasher_alchemistBashing,
		Apostate = _G.ataxiaBasher_apostateBashing,
		Bard = _G.ataxiaBasher_bardBashing,
		Blademaster = _G.ataxiaBasher_blademasterBashing,
		Depthswalker = _G.ataxiaBasher_depthswalkerBashing,
    Infernal = _G.ataxiaBasher_infernalBashing,
		Jester = _G.ataxiaBasher_jesterBashing,
		Magi = _G.ataxiaBasher_magiBashing,
		Monk = _G.ataxiaBasher_monkBashing2,
		Occultist = _G.ataxiaBasher_occultistBashing,
    Paladin = _G.ataxiaBasher_paladinBashing,
    Pariah = _G.ataxiaBasher_pariahBashing,
		Priest = _G.ataxiaBasher_priestBashing,
		Psion = _G.ataxiaBasher_psionBashing,
		Runewarden = _G.ataxiaBasher_runewardenBashing,
		Sentinel = _G.ataxiaBasher_sentinelBashing,
		Serpent = _G.ataxiaBasher_serpentBashing,
		Shaman = _G.ataxiaBasher_shamanBashing,   
		Sylvan = _G.ataxiaBasher_sylvanBashing,
    Unnamable = _G.ataxiaBasher_knightBashing,
	}
	local class = gmcp.Char.Status.class:title()
  class = class:gsub(" Lady", ""):gsub(" Lord", "")
  if ataxiaTemp.bashFlee == nil then
    ataxiaTemp.bashFlee = false
  end
  --Make a Magi Reflection Function
if not ataxia.afflictions.aeon and not ataxia.afflictions.paralysis then
    if ataxiaTemp.bashFlee == true then
      ataxiaBasher.paused = true
      ataxiaEcho("BASH FLEE IS TRUE/PAUSING BASHER/RUNNING BACK ONE ROOM")
      send("cq all")
      if mmp.paused then mmp.pause("off") end
        expandAlias("goto " ..mmp.previousroom) 
		  if ataxia.vitals.hp &gt;= ataxia.vitals.maxhp then
			  ataxiaTemp.bashFlee = false
        ataxiaBasher.paused = false
			  search_targets()
			   if not found_target and ataxiaTemp.bashFlee == true then	
				  ataxiaEcho("Healed to threshold, moving back to v"..mmp.previousroom..".")
          ataxiaTemp.bashFlee = false
          ataxiaBasher.paused = false
          if mmp.paused then mmp.pause("off") end
          expandAlias("goto " ..mmp.previousroom)
          search_targets() 
			   end
			  ataxiaBasher_patterns()
        ataxiagui_updateVitals()
      elseif ataxia.vitals.hp &lt;= ataxiaBasher.fleeThreshold then
        ataxiaTemp.bashFlee = true
        ataxiaBasher.paused = true
        ataxiaEcho("BASH FLEE IS TRUE/PAUSING BASHER/GETTING TO FULL HEALTH")
        ataxiagui_updateVitals()
      end
    elseif gmcp.Room.Info.area == "Moghedu" and ataxia.playersHere == "Hikagejuunin" then
      guardianofmogcunts = true
      ataxiaBasher_areaoff()
      ataxiaBasher.pause = true
      expandAlias("mstop")
      send("cq all")
      expandAlias("goto Mhaldor")
   
		elseif ataxia.afflictions.unknown and ataxia.afflictions.unknown &gt;= 2 and not sent_diagnose then
			send("queue addclear freestand diagnose", false)
			sent_diagnose = tempTimer(3, [[sent_diagnose = nil]])
		elseif ataxiaBasher.noShieldBreak.threshold &gt; 0 and ataxia.vitals.hp &lt; ataxiaBasher.noShieldBreak.threshold and ataxiaBasher_canShield() then
			if not ataxia.defences.shield then
				ataxiaEcho("Going to shield on balance!")
				send("queue addclear freestand touch shield")
			end
		elseif ataxia.defences.shield and ataxiaBasher_bashingFuncs[class] and canStand() then
			if ataxia.vitals.hpp &gt;= 70 then
				ataxiaBasher_assembleAttack()
			end
		elseif ataxiaBasher_bashingFuncs[class] and canStand() then
			ataxiaBasher_assembleAttack()
		elseif not ataxiaBasher_bashingFuncs[class] and canStand() then
			ataxiaEcho(class.." isn't supported yet, sorry!")
		end
	end
   ataxiaBasher_stormhammer()  
end

function ataxiaBasher_assembleAttack()
	get_Battlerage()
  ataxiaBasher_stormhammer() 
	local command = ""
  local class = gmcp.Char.Status.class:title():gsub(" Lady", ""):gsub(" Lord", "")
	local sp = ataxia.settings.separator
	if ataxiaTemp.goldInRoom then 
    command = command.."get gold"..sp.."open pack436363"..sp.."put gold in pack436363"..sp.."close pack436363"..sp
  elseif ataxiaTemp.goldinhand then
    command = command.."open pack436363"..sp.."put gold in pack436363"..sp.."close pack436363"..sp
  end
	if ataxiaBasher.nicator and not haveDef("nicatorlegend") then command = command.."legenddeck draw nicator"..sp end
 
  if ataxiaTemp.bashFlee == false and not ataxia.afflictions.paralysis and not ataxia.afflictions.aeon then
    command = command..ataxiaBasher_bashingFuncs[class]()
    send("queue addclearfull freestand stand"..sp..command)	
	
  end
	  
end

function ataxiaBasher_assembleBattlerage()
	local command = ""
	local class = gmcp.Char.Status.class:title():gsub(" Lady", ""):gsub(" Lord", "")
	local level = tonumber(string.match(gmcp.Char.Status.level, "%d+ "))
	
	local bigRage = (ataxiaBasher.rageraze and 54 or 36)
	local smallRage = (ataxiaBasher.rageraze and 34 or 16)
  local specialRage = 25
	
	if ataxiaBasher.cullingBlade and not ataxiaTemp.bladeCooldown and ataxiaBasher_validTargets() &gt;= 2 then
		if ataxia.vitals.rage &gt;= bigRage then
			command = command.."reap "..target..ataxia.settings.separator
		end
  elseif gmcp.Char.Status.class == "Blue Dragon" then
    
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
    if ataxiaBasher_validTargets() &gt;= 2 then
    if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 16 then
      command = command..ataxiaBasher.battlerage[class].special..ataxia.settings.separator
    elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  elseif ataxiaBasher_validTargets() &lt; 2 then 
    if not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  end
  
  elseif gmcp.Char.Status.class == "Bard" then
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
  if ataxiaBasher_validTargets() &gt;= 2 then
    if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 28 then
      command = command..ataxiaBasher.battlerage[class].special..ataxia.settings.separator
    elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  elseif ataxiaBasher_validTargets() &lt; 2 then 
    if not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  end
  elseif gmcp.Char.Status.class == "Psion" then
    
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
    if not battleRage_Timers.special and mobhealth &gt;= 40 and ataxia.vitals.rage &gt;= 40 and not battleRage_Timers.small then
      command = command..ataxiaBasher.battlerage[class].special..ataxia.settings.separator
    elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 25 and battleRage_Timers.special and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  elseif gmcp.Char.Status.class == "Runewarden" then
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
    if ataxiaBasher_validTargets() &gt;= 2 then
      if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 28 then
        command = command..ataxiaBasher.battlerage[class].special..ataxia.settings.separator
      elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		    command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
      elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	     command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
      end
    elseif ataxiaBasher_validTargets() &lt; 2 then 
      if not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 then
		    command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
      elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and level &gt; 35 then
	     command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
      end
  end
  elseif gmcp.Char.Status.class == "Infernal" then
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
   if ataxiaBasher_validTargets() &gt;= 2 then
    if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 21 then
      command = command..ataxiaBasher.battlerage[class].special..ataxia.settings.separator
    elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  elseif ataxiaBasher_validTargets() &lt; 2 then 
    if not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  end
  elseif gmcp.Char.Status.class == "Pariah" then
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
    if ataxiaBasher_validTargets() &gt;= 2 then
    if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 32 then
      command = command..ataxiaBasher.battlerage[class].special..ataxia.settings.separator
    elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  elseif ataxiaBasher_validTargets() &lt; 2 then 
    if not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  end
  elseif gmcp.Char.Status.class == "Blademaster" then
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
   if ataxiaBasher_validTargets() &gt;= 2 then
    if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 26 then
      command = command..ataxiaBasher.battlerage[class].special..ataxia.settings.separator
    elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  elseif ataxiaBasher_validTargets() &lt; 2 then 
    if not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  end
  elseif gmcp.Char.Status.class == "Magi" then
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
  if ataxiaBasher_validTargets() &gt;= 2 then
    if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 35 then
      command = command..ataxiaBasher.battlerage[class].special..ataxia.settings.separator
    elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  elseif ataxiaBasher_validTargets() &lt; 2 then 
    if not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  end
  elseif gmcp.Char.Status.class == "Serpent" then
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
  if ataxiaBasher_validTargets() &gt;= 2 then
    if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 28 then
      command = command..ataxiaBasher.battlerage[class].special..ataxia.settings.separator
    elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  elseif ataxiaBasher_validTargets() &lt; 2 then 
    if not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  end
  elseif gmcp.Char.Status.class == "Apostate" then
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
   if ataxiaBasher_validTargets() &gt;= 2 then
    if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 32 then
      command = command..ataxiaBasher.battlerage[class].special..ataxia.settings.separator
    elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  elseif ataxiaBasher_validTargets() &lt; 2 then 
    if not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  end
  elseif gmcp.Char.Status.class == "Monk" then
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
 if ataxiaBasher_validTargets() &gt;= 2 then
    if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 22 then
      command = command..ataxiaBasher.battlerage[class].special..ataxia.settings.separator
    elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  elseif ataxiaBasher_validTargets() &lt; 2 then 
    if not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 then
		  command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and level &gt; 35 then
	   command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
    end
  end
   elseif gmcp.Char.Status.class == "Black Dragon" then
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
    if #stormhammerTargets &gt;= 3 then -- If there are more than two targets than Fear the third
      if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 29  then
        command = command.." dragonfear " ..stormhammerTargets[3]..ataxia.settings.separator
      elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		    command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
      elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	       command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
      end
    elseif #stormhammerTargets &lt; 3 then
      if not battleRage_Timers.small and ataxia.vitals.rage &gt;= smallRage then
		    command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
	    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= bigRage and level &gt; 35 then
		    command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
      end
    end
  elseif gmcp.Char.Status.class == "Shaman" then
   mobhealth = gmcp.IRE.Target.Info.hpperc:gsub("%%", "")
   mobhealth = tonumber(mobhealth)
    --[[if #stormhammerTargets &gt;= 1 then
      if not battleRage_Timers.special2 and ataxia.vitals.rage &gt;= 19  then
        command = command..ataxiaBasher.battlerage[class].special2..ataxia.settings.separator
      elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special2 then
		    command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
      elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special2 and level &gt; 35 then
	       command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
      end
    elseif]]
    if #stormhammerTargets &gt;= 3 then -- If there are more than two targets than Fear the third
      if not battleRage_Timers.special and ataxia.vitals.rage &gt;= 29  then
        command = command.." invoke korkma " ..stormhammerTargets[3]..ataxia.settings.separator
      elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= 14 and battleRage_Timers.special then
		    command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
      elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= 36 and battleRage_Timers.special and level &gt; 35 then
	       command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
      end
    elseif #stormhammerTargets &lt; 3 then
      if not battleRage_Timers.small and ataxia.vitals.rage &gt;= smallRage then
		    command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
	    elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= bigRage and level &gt; 35 then
		    command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
      end
    end
  elseif not battleRage_Timers.small and ataxia.vitals.rage &gt;= smallRage then
		command = command..ataxiaBasher.battlerage[class].small..ataxia.settings.separator
	elseif not battleRage_Timers.large and ataxia.vitals.rage &gt;= bigRage and level &gt; 35 then
		command = command..ataxiaBasher.battlerage[class].large..ataxia.settings.separator
	end
	return command
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Class Bashing</name>
										<packageName></packageName>
										<script>function ataxiaBasher_dragonBashing()
  local command, sp = "", ataxia.settings.separator
  local brage = ataxiaBasher_assembleBattlerage()
  local colour = string.match(gmcp.Char.Status.class, "%w+")
  local raze = ataxiaBasher.battlerage[colour.." Dragon"].raze

  if ataxiaBasher.shielded then
    if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
      command = command..raze..sp
      if not ataxiaBasher.jabBash and not ataxiaBasher.wotBash then
        if ataxiaBasher.dragonIncant then
          command = command.."incantation " ..target
        else
          command = command.."gut " ..target
        end
      elseif ataxiaBasher.wotBash then
        command = command.."whip " ..target
      else
        command = command.."jab " ..target
      end
      --Black = "acid", Blue = "ice", Gold = "psi", Green = "venom", Red = "dragonfire", Silver = "lightning",
    elseif gmcp.Char.Status.class == "Blue Dragon" then
      command = command..sp.."blast " ..target..";summon ice"..sp..brage
    elseif gmcp.Char.Status.class == "Red Dragon" then
      command = command..sp.."blast " ..target..";summon dragonfire"..sp..brage
    elseif gmcp.Char.Status.class == "Green Dragon" then
      command = command..sp.."blast " ..target..";summon venom"..sp..brage
    elseif gmcp.Char.Status.class == "Black Dragon" then
      command = command..sp.."blast " ..target..";summon acid"..sp..brage
    elseif gmcp.Char.Status.class == "Golden Dragon" then
      command = command..sp.."blast " ..target..";summon psi"..sp..brage
    elseif gmcp.Char.Status.class == "Silver Dragon" then
      command = command..sp.."blast " ..target..";summon lightning"..sp..brage
    else
      command = command..sp.."blast " ..target..sp..brage
    end
  else
    command = command..sp..brage..sp
    if not ataxiaBasher.jabBash and not ataxiaBasher.wotBash then
      if ataxiaBasher.dragonIncant then
        command = command.."incantation " ..target
      else
        command = command.."gut " ..target
      end
    elseif ataxiaBasher.wotBash then
      command = command.."whip " ..target
    else
      command = command.."jab " ..target
    end
  end
  return command
end

function ataxiaBasher_fEleBashing()
	local command, sp = "", ataxia.settings.separator
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage["Fire Elemental"].raze
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = command..raze..sp.."ignite flamewhip "..target
		else
			command = command..sp.."manifest superheat "..target..sp..brage
		end
	else
		command = command..brage..sp.."ignite flamewhip "..target	
	end
	return command  

end

function ataxiaBasher_eEleBashing()
	local command, sp = "", ataxia.settings.separator
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage["Earth Elemental"].raze
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = command..raze..sp.."terran pulverise "..target
		else
			command = command..sp.."terran crunch "..target..sp..brage
		end
	else
		command = command..brage..sp.."terran pulverise "..target	
	end
	return command  

end


function ataxiaBasher_aEleBashing()
   local command = ""   
   if ataxiaBasher.shielded then
      command = command.."manifest gale "..target..ataxia.settings.separator
   end
   
   command = command..ataxiaBasher_assembleBattlerage()
   
   if not ataxiaBasher.shielded then   
      command = command.."manifest buffet "..target
   end
   
   return command   
end

function ataxiaBasher_alchemistBashing()
	local command, sp = "", ataxia.settings.separator
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage.Alchemist.raze
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = raze..sp.."educe iron "..target
		else
			command = "educe copper "..target..sp..brage
		end
	else
		command = brage..sp.."educe iron "..target
	end
	    
	return command  
end

function ataxiaBasher_apostateBashing()
	local command, sp = "", ataxia.settings.separator 
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage.Apostate.raze
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = raze..sp.."deadeyes "..target.." bleed bleed; "
		else
			command = "deadeyes "..target.." bleed bleed; "
		end
	else
		command = brage..sp.."deadeyes "..target.." bleed bleed; "
	end
	    
	return command	
end

function ataxiaBasher_bardBashing()
   local command = ""
   if bardNeedRapierWield then
      bardNeedRapierWield = false
      command = command.."wield right rapier;wield right shield"..ataxia.settings.separator
   end
   if bardperformance == false then
    command = command.."wield left lyre;compose gusheh sonata scherzo maqam prelude;"
    enableTimer("Bard Performance")
   end
   if ataxiaBasher.shielded then
      command = command.."wield right rapier;wield left shield;blade jab  "..target.. " torso nomos;"
   end
    command = command..ataxiaBasher_assembleBattlerage()  
    command = command.."wield right rapier;wield left shield;blade jab " ..target.. " torso"

   return command   
end

function ataxiaBasher_blademasterBashing()
	local command, sp = "", ataxia.settings.separator
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage.Blademaster.raze
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = raze..sp.."drawslash "..target
		else
			command = "raze "..target..sp..brage
		end
	else
		command = brage..sp.."drawslash "..target
	end
	    
	return command   
end

function ataxiaBasher_depthswalkerBashing()
	local command, sp = "", ataxia.settings.separator
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage.Depthswalker.raze
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = raze..sp.."shadow reap "..target
		else
			command = "shadow reap "..target..sp..brage
		end
	else
		command = brage..sp.."shadow reap "..target
	end
	    
	return command  
end

function ataxiaBasher_infernalBashing()
	local command, sp = "", ataxia.settings.separator
	local raze, bash, spec = "", "", ataxia.vitals.knight
	local brage = ataxiaBasher_assembleBattlerage()
	local braze = ataxiaBasher.battlerage.Infernal.raze

	if spec == "Dual Cutting" then
		raze = "rsl "..target
		bash = "dsl "..target
	elseif spec == "Two Handed" then
		raze = "battlefury focus speed"..sp.."splinter "..target
		bash = "battlefury focus speed"..sp.."slaughter "..target
	elseif spec == "Dual Blunt" then
		raze = "fracture "..target
		bash = "doublewhirl "..target
	else
		raze = "combination "..target.." raze smash"
		bash = "combination "..target.." slice smash"
	end
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = braze..sp..bash
		else
			command = raze..sp..brage
		end
	else
		command = brage..sp..bash
	end
	    
	return command 
end

function ataxiaBasher_jesterBashing()
	local command, sp = "", ataxia.settings.separator
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage.Jester.raze
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = raze..sp.."bop "..target
		else
			command = "badjoke "..target..sp..brage
		end
	else
		command = brage..sp.."bop "..target
	end
	    
	return command   
end

function ataxiaBasher_magiBashing()

   local command = ""   
   local command, sp = "", ataxia.settings.separator 
	 local brage = ataxiaBasher_assembleBattlerage()
	 local raze = ataxiaBasher.battlerage.Magi.raze
    raiseEvent("targets updated")
    ataxia_Update_RoomContents()
    zgui.showRoomInfo() 
    ataxiaBasher_stormhammer() 
   if ataxiaBasher.shielded then
      command = command.."cast erode at "..target..ataxia.settings.separator
   end
   
   command = command..ataxiaBasher_assembleBattlerage()

   if not ataxiaBasher.shielded then
    if ataxiaBasher_validTargets() &gt; 2 then
      command = brage..sp.."cast stormhammer at "..stormhammerTargets[1].. " and " ..stormhammerTargets[2].. " and " ..stormhammerTargets[3]
    elseif ataxiaBasher_validTargets() &lt; 3 then
      command = brage..sp.."staff cast horripilation at "..target
    else
   -- Horripilation 4 percent at 17 int, max arties, half damage more speed crystal (Best)
      command = brage..sp.."staff cast horripilation at "..target
    end
   end
   return command   
end

function ataxiaBasher_monkBashing()
	local command = ""
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage.Monk.raze
  local tekura = gmcp.Char.Vitals.charstats[4]:find("Stance") == 1
  if ataxia.vitals.wp &lt;= 5000 then
    expandAlias("magepve")
  end

   --Transmute logic; transmute to 75%, keep mana above 45%.
	local xmute = math.ceil(ataxia.vitals.maxhp * 0.80)
	local mpl = (ataxia.vitals.mp - (ataxia.vitals.maxmp * 0.30))
	local hpl = (xmute - ataxia.vitals.hp)
	local tomute = 0

	if hpl &gt; 1 then
		tomute = (hpl &lt; mpl and hpl or mpl)
		if tomute &gt; 100 then
			command = command.."transmute "..tomute..ataxia.settings.separator
		end
	end

	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = command..raze..sp
      if ataxia.settings.crushbash then
        command = command.."mind crush "..target
      elseif tekura then
        command = command.."unwield all;combo "..target.." sdk ucp ucp"
      elseif not tekura and ataxia.vitals.form == "Willow" and ataxia.vitals.kata &lt; 5 then
        command = command.."dismount;wield staff;combo "..target.." flashheel left hiru hiraku"
        elseif not tekura and ataxia.vitals.form == "Willow" and ataxia.vitals.kata &gt;= 5 then
        command = command.."dismount;wield staff;combo "..target.." flashheel left hiru hiraku;transition to the rain form"
           elseif not tekura and ataxia.vitals.form == "Rain" and ataxia.vitals.kata &lt; 12 then
        command = command.."dismount;wield staff;combo "..target.." frontkick right hiru kuro right"
        elseif not tekura and ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 12 then
        command = command.."dismount;wield staff;combo "..target.." frontkick right hiru kuro right;transition to the oak form"
           elseif not tekura and ataxia.vitals.form == "Oak" and ataxia.vitals.kata &lt; 5 then
        command = command.."dismount;wield staff;combo "..target.." risingkick torso nervestrike livestrike"
        elseif not tekura and ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 5 then
        command = command.."dismount;wield staff;combo "..target.." risingkick torso nervestrike livestrike;transition to the willow form"
        
      end
		else
      if tekura then
        command = command.."unwield all;combo "..target.." rhk ucp ucp"
      elseif not tekura and ataxia.vitals.form == "Willow" and ataxia.vitals.kata &lt; 5 then
        command = command.."dismount;wield staff;combo "..target.." shatter flashheel left hiraku"
        elseif not tekura and ataxia.vitals.form == "Willow" and ataxia.vitals.kata &gt;= 5 then
        command = command.."dismount;wield staff;combo "..target.." shatter flashheel left hiraku;transition to the rain form"
           elseif not tekura and ataxia.vitals.form == "Rain" and ataxia.vitals.kata &lt; 12 then
        command = command.."dismount;wield staff;combo "..target.." shatter frontkick right kuro right"
        elseif not tekura and ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 12 then
        command = command.."dismount;wield staff;combo "..target.." shatter frontkick right kuro right;transition to the oak form"
           elseif not tekura and ataxia.vitals.form == "Oak" and ataxia.vitals.kata &lt; 5 then
        command = command.."dismount;wield staff;combo "..target.." shatter risingkick torso livestrike"
        elseif not tekura and ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 5 then
        command = command.."dismount;wield staff;combo "..target.." shatter risingkick torso livestrike;transition to the willow form"
        
      end
		end
	else
		command = command..brage
     if ataxia.settings.crushbash then
       command = command.."mind crush "..target
     elseif tekura then
       command = command.."unwield all;combo "..target.." sdk ucp ucp"
  elseif not tekura and ataxia.vitals.form == "Willow" and ataxia.vitals.kata &lt; 5 then
        command = command.."dismount;wield staff;combo "..target.." flashheel left hiru hiraku"
        elseif not tekura and ataxia.vitals.form == "Willow" and ataxia.vitals.kata &gt;= 5 then
        command = command.."dismount;wield staff;combo "..target.." flashheel left hiru hiraku;transition to the rain form"
           elseif not tekura and ataxia.vitals.form == "Rain" and ataxia.vitals.kata &lt; 12 then
        command = command.."dismount;wield staff;combo "..target.." frontkick right hiru kuro right"
        elseif not tekura and ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 12 then
        command = command.."dismount;wield staff;combo "..target.." frontkick right hiru kuro right;transition to the oak form"
           elseif not tekura and ataxia.vitals.form == "Oak" and ataxia.vitals.kata &lt; 5 then
        command = command.."dismount;wield staff;combo "..target.." risingkick torso nervestrike livestrike"
        elseif not tekura and ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 5 then
        command = command.."dismount;wield staff;combo "..target.." risingkick torso nervestrike livestrike;transition to the willow form"
        
     end    
	end
end




function ataxiaBasher_monkBashing2()
	local command, sp = "", ataxia.settings.separator
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage.Monk.raze
  local tekura = gmcp.Char.Vitals.charstats[4]:find("Stance") == 1
  local shikudo = gmcp.Char.Vitals.charstats[4]:find("Form") == 1

   --Transmute logic; transmute to 75%, keep mana above 45%.
	local xmute = math.ceil(ataxia.vitals.maxhp * 0.90)
	local mpl = (ataxia.vitals.mp - (ataxia.vitals.maxmp * 0.15))
	local hpl = (xmute - ataxia.vitals.hp)
	local tomute = 0

	if hpl &gt; 1 then
		tomute = (hpl &lt; mpl and hpl or mpl)
		if tomute &gt; 100 then
			command = command.."transmute "..tomute..ataxia.settings.separator
		end
	end

	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = command..raze..sp
      if ataxia.settings.crushbash then
        command = command.." mind crush " ..target.. ";"
      elseif tekura then
          command = command.."combo "..target.. " sdk ucp ucp; "
      elseif shikudo then
        if ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 20 then
          command = command.."combo "..target.. " ruku torso kuro left frontkick left;transition to the oak form; "
        elseif ataxia.vitals.form == "Rain" and ataxia.vitals.kata &lt; 20 then
          command = command.."combo "..target.. " ruku torso kuro left frontkick left; "
        elseif ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 8 then
          command = command.."combo "..target.. " livestrike nervestrike risingkick head;transition to the willow form; "
        elseif ataxia.vitals.form == "Oak" and ataxia.vitals.kata &lt; 8 then
          command = command.."combo "..target.. " livestrike nervestrike risingkick head; "
        elseif ataxia.vitals.form == "Willow" and ataxia.vitals.kata &gt;= 6 then
          command = command.."combo "..target.. " hiru hiraku flashheel left;transition to the rain form; "
        elseif ataxia.vitals.form == "Willow" and ataxia.vitals.kata &lt; 6 then
          command = command.."combo "..target.. " hiru hiraku flashheel left; "
        elseif ataxia.vitals.form == "Tykonos" and ataxia.vitals.kata &lt; 5 then
          command = command.."combo "..target.. " thrust head thrust head risingkick head; "
        elseif ataxia.vitals.form == "Tykonos" and ataxia.vitals.kata &gt;= 5 then
          command = command.."combo "..target.. " thrust head thrust head risingkick head;transition to the willow form; "
        end
      end
    elseif not ataxiaBasher.rageraze then
      if ataxia.settings.crushbash then
        command = command.." mind crush " ..target..";"
      elseif tekura then
        command = command.."combo "..target.. " rhk ucp ucp; "
      elseif shikudo and ataxia.settings.crushbash == false then
        if ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 19 then
          command = command.."combo "..target.. " shatter hiru frontkick left;transition to the oak form; "
        elseif ataxia.vitals.form == "Rain" and ataxia.vitals.kata &lt; 19 then
          command = command.."combo "..target.. " shatter hiru frontkick left; "
        elseif ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 7 then
          command = command.."combo "..target.. " shatter livestrike risingkick head;transition to the willow form; "
        elseif ataxia.vitals.form == "Oak" and ataxia.vitals.kata &lt; 7 then
          command = command.."combo "..target.. " shatter livestrike risingkick head; "
        elseif ataxia.vitals.form == "Willow" and ataxia.vitals.kata &gt;= 6 then
          command = command.."combo "..target.. " shatter hiru flashheel left;transition to the rain form; "
        elseif ataxia.vitals.form == "Willow" and ataxia.vitals.kata &lt; 6 then
          command = command.."combo "..target.. " shatter hiru flashheel left; "
        elseif ataxia.vitals.form == "Tykonos" and ataxia.vitals.kata &lt; 5 then
          command = command.."combo "..target.. " shatter thrust head risingkick head; "
        elseif ataxia.vitals.form == "Tykonos" and ataxia.vitals.kata &gt;= 5 then
          command = command.."combo "..target.. " shatter thrust head risingkick head;transition to the willow form; "
        end
       end
      end
 else
		command = command..brage..sp
     if ataxia.settings.crushbash then
       command = command.."mind crush " ..target..";"
     elseif tekura then
       command = command.."combo "..target.. " sdk ucp ucp; "
     elseif shikudo and ataxia.settings.crushbash == false then
        if ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 20 then
          command = command.."combo "..target.. " ruku torso kuro left frontkick left;transition to the oak form; "
        elseif ataxia.vitals.form == "Rain" and ataxia.vitals.kata &lt; 20 then
          command = command.."combo "..target.. " ruku torso kuro left frontkick left; "
        elseif ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 8 then
          command = command.."combo "..target.. " livestrike nervestrike risingkick head;transition to the willow form; "
        elseif ataxia.vitals.form == "Oak" and ataxia.vitals.kata &lt; 8 then
          command = command.."combo "..target.. " livestrike nervestrike risingkick head; "
        elseif ataxia.vitals.form == "Willow" and ataxia.vitals.kata &gt;= 6 then
          command = command.."combo "..target.. " hiru hiraku flashheel left;transition to the rain form; "
        elseif ataxia.vitals.form == "Willow" and ataxia.vitals.kata &lt; 6 then
          command = command.."combo "..target.. " hiru hiraku flashheel left; "
        elseif ataxia.vitals.form == "Tykonos" and ataxia.vitals.kata &lt; 5 then
          command = command.."combo "..target.. " thrust head thrust head risingkick head; "
        elseif ataxia.vitals.form == "Tykonos" and ataxia.vitals.kata &gt;= 5 then
          command = command.."combo "..target.. " thrust head thrust head risingkick head;transition to the willow form; "
        end
       end    
	end
  
	return command   
end









function ataxiaBasher_occultistBashing()
   local command = ""   
   
   command = command..ataxiaBasher_assembleBattlerage()
   command = command.."warp "..target

   return command   
end

function ataxiaBasher_pariahBashing()
	local command, sp = "", ataxia.settings.separator
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage.Pariah.raze
	
	if ataxiaBasher.shielded then
		command = "trace fissure "..target
	else
		command = brage.."epitaph advance "..target
	end
	    
	return command 
end

function ataxiaBasher_paladinBashing()
	local command, sp = "", ataxia.settings.separator
	local raze, bash, spec = "", "", ataxia.vitals.knight
	local brage = ataxiaBasher_assembleBattlerage()
	local braze = ataxiaBasher.battlerage.Paladin.raze

	if spec == "Dual Cutting" then
		raze = "rsl "..target
		bash = "dsl "..target
	elseif spec == "Two Handed" then
		raze = "battlefury focus speed"..sp.."carve "..target
		bash = "battlefury focus speed"..sp.."slaughter "..target
	elseif spec == "Dual Blunt" then
		raze = "fracture "..target
		bash = "doublewhirl "..target
	else
		raze = "combination "..target.." raze smash"
		bash = "combination "..target.." slice smash"
	end
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = braze..sp..bash
		else
			command = raze..sp..brage
		end
	else
		command = brage..sp..bash
	end
	    
	return command  
end

function ataxiaBasher_psionBashing()
  local command, sp = "", ataxia.settings.separator
  local brage = ataxiaBasher_assembleBattlerage()
  local raze = ataxiaBasher.battlerage.Psion.raze

  if ataxiaBasher.shielded then
    if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
      command = command..raze..sp
      command = command.."weave cleave "..target
    end
  elseif ataxiaTemp.transcendence and ataxiaTemp.transcendence == 100 then
  command = command..sp..brage..sp
    command = command.."psi shatter "..target..sp.."weave deathblow "..target
  else
    command = command..sp..brage..sp
    command = command.."weave deathblow "..target
    --Deathblow does 3 percent to elite mhun keeper
  end
  return command
end

function ataxiaBasher_priestBashing()
	local command, sp = "", ataxia.settings.separator
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage.Priest.raze
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = raze..sp.."smite "..target
		else
			command = "smite "..target
		end
	else
		command = brage..sp.."smite "..target
	end
	if empathyTick and empathyTick &gt;= 2 then
		command = command..sp.."angel power"
	end   
	return command 
end

function ataxiaBasher_knightBashing()
	local command, sp = "", ataxia.settings.separator
	local raze, bash, spec = "", "", ataxia.vitals.knight
	local brage = ataxiaBasher_assembleBattlerage()
	local braze = ataxiaBasher.battlerage[ataxiaTemp.class].raze

	if spec == "Dual Cutting" then
		raze = "rsl "..target
		bash = "dsl "..target
	elseif spec == "Two Handed" then
		raze = "battlefury focus speed"..sp.."carve "..target
		bash = "battlefury focus speed"..sp.."slaughter "..target
	elseif spec == "Dual Blunt" then
		raze = "fracture "..target
		bash = "doublewhirl "..target
	else
		raze = "combination "..target.." raze smash"
		bash = "combination "..target.." slice smash"
	end
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = braze..sp..bash
		else
			command = raze..sp..brage
		end
	else
		command = brage..sp..bash
	end
	    
	return command 
end

function ataxiaBasher_runewardenBashing()
	local command, sp = "", ataxia.settings.separator
	local raze, bash, spec = "", "", ataxia.vitals.knight
	local brage = ataxiaBasher_assembleBattlerage()
	local braze = ataxiaBasher.battlerage.Runewarden.raze

	if spec == "Dual Cutting" then
		raze = "rsl "..target
		bash = "dsl "..target
	elseif spec == "Two Handed" then
		raze = "battlefury focus speed"..sp.."carve "..target
		bash = "battlefury focus speed"..sp.."slaughter "..target
	elseif spec == "Dual Blunt" then
		raze = "fracture "..target
		bash = "doublewhirl "..target
	else
		raze = "combination "..target.." raze smash"
		bash = "combination "..target.." slice smash"
	end
	
	if ataxiaBasher.shielded then
		if ataxiaBasher.rageraze and ataxia.vitals.rage &gt;= 17 then
			command = braze..sp..bash
		else
			command = raze..sp..brage
		end
	else
		command = brage..sp..bash
	end
	    
	return command 
end

function ataxiaBasher_sentinelBashing()
   local command = ""
   if ataxiaBasher.shielded then
      command = command.."rivestrike "..target..ataxia.settings.separator
   end
   
   command = command..ataxiaBasher_assembleBattlerage()
      
   if not ataxiaBasher.shielded then 
      command = command.."thrust "..target
   end
 
   return command 
end

function ataxiaBasher_serpentBashing()
   local command = ""
	 local brage = ataxiaBasher_assembleBattlerage()
	 
   if ataxiaBasher.shielded then
      command = command.."flay "..target.." shield"..ataxia.settings.separator
   end
   
   command = command..ataxiaBasher_assembleBattlerage()
      
   if not ataxiaBasher.shielded then 
      command = command.."garrote "..target
   end
 
   return command 
end

function ataxiaBasher_shamanBashing()	
local healhealth = tonumber(math.floor((ataxia.vitals.hp/ataxia.vitals.maxhp)*100))


	local command, sp = "", ataxia.settings.separator
	local brage = ataxiaBasher_assembleBattlerage()
	local raze = ataxiaBasher.battlerage.Shaman.raze
  
  if not shaman.spiritlore.bashType then shaman.spiritlore.bashType = "swiftcure" end
	local bash_type = shaman.spiritlore.bashType
  
  
 if healhealth &lt; 60 then
          atk = "stand;wield shield;invoke regeneration"
  elseif bash_type == "arius" and shaman.spiritisbound("arius") then
    atk = "invoke roar "..target
  elseif bash_type == "swiftcurse" and shaman.spiritisbound("aelkesh") then
    if curseCharge == 1 then
      atk = "stand;wield shield;swiftcurse"

    elseif curseCharge &gt; 1 then
      atk = "stand;wield shield;swiftcurse "..target.." bleed"
    end
  else
    if ataxiaTemp.canJinx then
      atk = "jinx bleed bleed "..target
    else
      atk = "curse "..target.." bleed"
    end
  end
  
	
  if brage == "" then
  		command = atk

  else
		command = brage..sp..atk
	end
	return command   
end



function ataxiaBasher_sylvanBashing()
   local command = ""
         
   command = command..ataxiaBasher_assembleBattlerage()
   command = command.."synchronise shear windwhip "..target

   return command 
end

function ataxiaBasher_wEleBashing()
   local command = ""   
   if ataxiaBasher.shielded then
      command = command.."manifest blade "..target..ataxia.settings.separator
   end
   
   command = command..ataxiaBasher_assembleBattlerage()
   
   if not ataxiaBasher.shielded then   
      command = command.."manifest blade "..target
   end
   
   return command   
end</script>
										<eventHandlerList />
									</Script>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>genRunning</name>
										<packageName></packageName>
										<script>item_Pickup = {
  --Creville Quests
  "a dirty scalpel", "a sewing needle", "soiled bandages", "a spool of yellowed thread", "a foul syringe", "a stained sheet","a small blood ruby shard",
}

function bashConsoleEcho(type, msg)
	local colours = {
		attack = {"red", "NavajoWhite", "atk"},
		denizen = {"a_darkcyan", "a_darkmagenta", "den"},
		curing = {"green", "SeaGreen", "cure"},
		battlerage = {"orange", "DimGrey", "brg"},
		fishing = {"violet", "purple", "fish"},
    hellforge = {"red", "green", "hell"},
	}
	if not ataxiaBasher.manual then
		deleteFull()
	end
  if not zgui or ataxia.usegui then
    ataxiagui.bashConsole:setFontSize(7)
    ataxiagui.bashConsole:cecho("\n&lt;"..colours[type][1].."&gt;"..colours[type][3]:upper().."| &lt;"..colours[type][2].."&gt;"..msg)
  else
    cecho("bashDisplay","\n&lt;"..colours[type][1].."&gt;"..colours[type][3]:upper().."| &lt;"..colours[type][2].."&gt;"..msg)
  end
end

function bashConsoleEchom(type, msg, colone, coltwo)
	if not ataxiaBasher.manual then
		deleteFull()
	end
  
  if not zgui or ataxia.usegui then
    ataxiagui.bashConsole:setFontSize(7)
    ataxiagui.bashConsole:cecho("\n&lt;"..colone.."&gt;"..type.."| &lt;"..coltwo.."&gt;"..msg)
  else
    cecho("bashDisplay","\n&lt;"..colone.."&gt;"..type.."| &lt;"..coltwo.."&gt;"..msg)
  end
end

function fishParse(what, pound, ounce)
	local message = what:title()
	message = message.." - "..(pound and pound.."lb " or "")..(ounce and ounce.."oz" or "")
	bashConsoleEchom("$$$$", message, "gold", "sienna")
end</script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>Bashing API</name>
											<packageName></packageName>
											<script>function ataxiaBasher_scanRoom()
  need_roomCheck = false
  ataxiaBasher_skipRoom = false
  ignoreCount = 0
  
  for id, mob in pairs(ataxia.denizensHere) do
    if ataxiaBasher.mobIgnore and table.contains(ataxiaBasher.mobIgnore, mob) and ataxiaBasher.enabled then
      ataxiaBasher_skipRoom = true
      ataxiaEcho("Skipping room because "..mob.." is here.")
      break
		elseif ataxiaBasher.dangerList and ataxiaBasher.dangerList[mob] then
      ignoreCount = ignoreCount + 1
      if ignoreCount &gt; ataxiaBasher.dangerCount then
				ataxiaEcho("Skipping room due to too many dangerous mobs.")
				ataxiaBasher_skipRoom = true
				dangerSkip = true
        break
			end
		end
ataxiaBasher_stormhammer()
  end
  for _, player in pairs(ataxia.playersHere) do 
    if ataxiaNDB.players[player].city == "Mhaldor" then
      ataxiaBasher_skipRoom = false
    elseif not table.contains(ataxiaBasher.ignore, player) and ataxiaBasher.enabled then
      ataxiaBasher_skipRoom = true
      ataxiaEcho("Someone is here! --- "..player)
      ataxiaBasher_alert("Normal")
		end
  end 
end

function ataxiaBasher_roomBashed()
	for i,v in pairs(ataxiaBasher_path) do
		if v == tonumber(gmcp.Room.Info.num) then
			table.remove(ataxiaBasher_path, i)
			break
		end
	end
end

function ataxiaBasher_arrived()
	if not ataxiaBasher.areabash then return false end
	ataxiaBasher_roomBashed()
ataxiaBasher_stormhammer()
end

function ataxiaBasher_pathFail()
	if not ataxiaBasher.enabled then return false end
	ataxiaEcho("Impass detected. Recalculating route.")
	table.remove(ataxiaBasher_path, 1)

	if #ataxiaBasher_path &gt; 0 then
		expandAlias("goto "..ataxiaBasher_path[1])
	elseif not ataxiaBasher.manual then
		ataxiaBasher_areaoff()
	end
end

function ataxiaBasher_generatePath()
	ataxiaBasher_path = {}
  ataxiaTemp.mapperPath = nil
	bashWatcher = bashWatcher or createStopWatch()
	startStopWatch(bashWatcher)	
	if ataxiaBasherPaths and ataxiaBasherPaths[gmcp.Room.Info.area] then
		local roomsToAdd = ataxiaBasherPaths[gmcp.Room.Info.area]
		local thisRoom = tonumber(gmcp.Room.Info.num)
		
		if table.contains(roomsToAdd, thisRoom) and table.index_of(roomsToAdd, thisRoom) ~= #roomsToAdd and table.index_of(roomsToAdd, thisRoom) ~= 1 then
			ataxiaEcho("Our room is found in the middle of the path; starting from there instead.")
			table.insert(ataxiaBasher_path, thisRoom)
			local start = table.index_of(roomsToAdd, thisRoom)
			while start &lt; #roomsToAdd do
				start = start + 1
				table.insert(ataxiaBasher_path, roomsToAdd[start])
			end			
		else
			ataxiaEcho("Creating path from scratch using pathing info.")
			for i,v in pairs(ataxiaBasherPaths[gmcp.Room.Info.area]) do
				table.insert(ataxiaBasher_path, v)
			end
		end
	else
		ataxiaEcho("Current area not tracked. Grabbing information from mapper instead.")
    ataxiaTemp.mapperPath = true
		collectRooms, result = getAreaRooms(getRoomArea(mmp.currentroom)), {}
		ataxiaBasher_path = deepcopy(collectRooms)
		table.sort(ataxiaBasher_path)
	end
	ataxiaTemp.basherRooms = #ataxiaBasher_path
	ataxiaEcho("Coordinates and path have been acquired. Total rooms: "..#ataxiaBasher_path.." | Process took: "..stopStopWatch(bashWatcher).."s to complete.")
	expandAlias("goto "..ataxiaBasher_path[1])
  if ataxia.usegui or ataxia.usegui == nil then
    ataxiagui.basherBar:show()
    ataxiagui.basherBarClear:show()
  end
end

function saveRoomPath()
	bashWatcher = bashWatcher or createStopWatch()
	if #mapping_path &lt; 2 then return end
	startStopWatch(bashWatcher)
	ataxiaBasherPaths[gmcp.Room.Info.area] = {}
	ataxiaEcho("Inputting rooms into the area table for: "..gmcp.Room.Info.area..".")
	for i,v in pairs(mapping_path) do
		table.insert(ataxiaBasherPaths[gmcp.Room.Info.area], v)
	end
	ataxiaEcho(gmcp.Room.Info.area.."'s table has been updated. Process took "..stopStopWatch(bashWatcher).."s to complete.")
	ataxia_saveSettings(false)
end

registerAnonymousEventHandler("mmapper failed path", "ataxiaBasher_pathFail")
registerAnonymousEventHandler("mmapper arrived", "ataxiaBasher_arrived")</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>search_targets</name>
											<packageName></packageName>
											<script>function search_targets()
	if (not ataxiaBasher.enabled) or need_roomCheck then return false end
  if autoHarvesting or autoExtracting then return false end
	found_target = false
	if ataxiaBasher_skipRoom then return false end
	
  for i,v in pairs(ataxia.denizensHere) do
		if tonumber(i) == target then
			found_target = true
			return
 
		end
  end
	
	if not found_target then
		for num,npc in pairs(ataxiaBasher.targetList[gmcp.Room.Info.area]) do
			if num ~= "keyword" then
				for id,mob in pairs(ataxia.denizensHere) do
					if mob:lower() == npc:lower() then
						target=tonumber(id)
						secondTarget = mob
						found_target = true
						send("st "..target)
						if ataxiaBasher.manual then
							ataxiaEcho("Now targeting: "..target)
              send("pt Target: " ..target)
						end
						raiseEvent("changed target")
						--if speedWalkCounter &gt; 0 and not mmp.paused then mmp.pause("on") end
						if mmp.speedWalkCounter &gt; 0 and not mmp.paused then mmp.pause("on") end
            return
					end
				end
			end
		end
	end
  ataxiaBasher_stormhammer()
end

function ataxiaBasher_stormhammer()
stormhammerTargets = {}
for k,v in pairs(ataxia.denizensHere) do
  if (table.contains(ataxiaBasher.targetList[gmcp.Room.Info.area], v)) then 

    table.insert(stormhammerTargets, tostring(k))
    --cecho("\n&lt;green&gt;Added &lt;white&gt;"..tostring(v).."&lt;white&gt; to Stormhammer table: ")
    --display(stormhammerTargets)
  --else
    --cecho("\n&lt;white&gt;Skipping &lt;red&gt;"..v.."&lt;white&gt; as it was not found in targetList")
  end
end

end

function ataxiaBasher_retargetShielded()

  target = ataxiaTemp.retarget
  secondTarget = ataxiaTemp.retargetsecond
  basher_needAction = true
  ataxiaTemp.retarget = nil
  ataxiaTemp.retargetsecond = nil
  raiseEvent("changed target")
  bashConsoleEcho("denizen", "Retargeting previous target")
  if ataxiaTemp.mobshieldtimer then killTimer(ataxiaTemp.mobshieldtimer); ataxiaTemp.mobshieldtimer = nil end
  if ataxiaBasher.manual then
    ataxiaEcho("Unshielded, changing back to: "..target)
  end  
  send("st "..target,false)
  ataxiaBasher_stormhammer()
end

function ataxiaBasher_shieldedTarget()

  found_target = false
  for num, npc in pairs(ataxiaBasher.targetList[gmcp.Room.Info.area]) do
    if num ~= "keyword" and not found_target then
      for id, mob in pairs(ataxia.denizensHere) do
        if mob:lower() == npc:lower() then
          if target ~= tonumber(id) then
            ataxiaTemp.retarget = target
            ataxiaTemp.retargetsecond = secondTarget
            target = tonumber(id)
            secondTarget = mob
            found_target = true
            basher_needAction = true
            send("st "..target,false)
						if ataxiaBasher.manual then
							ataxiaEcho("Shielded, changing to: "..target)
						end
						raiseEvent("changed target")
            if ataxiaTemp.mobshieldtimer then killTimer(ataxiaTemp.mobshieldtimer); ataxiaTemp.mobshieldtimer = nil end
            if ataxiaTemp.retargetsecond == "a mhun knight" then
              ataxiaTemp.mobshieldtimer = tempTimer(4.7, [[ ataxiaBasher_retargetShielded() ]])
            else
              ataxiaTemp.mobshieldtimer = tempTimer(3.1, [[ ataxiaBasher_retargetShielded() ]])
            end
            return
          end
        end
      end
    end
  end   
  ataxiaBasher_stormhammer()         
end

function ataxiaBasher_validTargets()
  local c = 0
   ataxiaBasher_stormhammer()  
  for i, v in pairs(ataxia.denizensHere) do
    if table.contains(ataxiaBasher.targetList[gmcp.Room.Info.area], v) then
      c= c + 1
    end
  end
  return c

end</script>
											<eventHandlerList>
												<string>targets updated</string>
											</eventHandlerList>
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Engaged/Disengage</name>
											<packageName></packageName>
											<script>function basher_disengaged()
	disableTimer("Clear Bashing Console")
	disableTrigger("Denizen Attacks / Misc Lines")
	local times = stopStopWatch(bashWatcher)
	times = string.format("%2.2f", (times/60))

	ataxia_saveSettings(false)
	ataxiaEcho("Bashing finished. Started at ("..getCurExp.." / "..getCurGold.."g) and bashed for "..times.." minutes. ")
	ataxiaBasher_alert("Normal")

	--switchTarget("Nothing")
	
	if gmcp.Char.Status.class == "Bard" then
		send("wield rapier shield",false)
		if ataxia.bardStuff.ariaBash then
			send("curing priority defence aria reset",false)
			
			if ataxiaTemp.deafnessToggle then
				send("curing priority defence deafness 25",false)
				ataxiaTemp.deafnessToggle = nil
			end
		end
  end
  
  if string.find(ataxiaTemp.class, "fire") and ataxia_getPrio("burning") == 26 then
    send("curing priority burning 8",false)
  end  
  
  if ataxia.usegui or ataxia.usegui == nil then
    ataxiagui.basherBar:hide()
  end
	ataxiaTemp.basherRooms = nil
	autoHarvesting = false
  autoExtracting = false
  
if gmcp.Room.Info.area == "Annwyn" then
expandAlias("goto 18280")
end

if gmcp.Room.Info.area == "Annwyn" then
clearedannwyn = true
tempTimer(1900,[[clearedannwyn = false]])
elseif gmcp.Room.Info.area == "Moghedu" then
clearedmog = true
tempTimer(1800,[[clearedmog = false]])
elseif gmcp.Room.Info.area == "the Azdun Catacombs" then
clearedcatacombs = true
tempTimer(1800,[[clearedcatacombs = false]])
elseif gmcp.Room.Info.area == "Tir Murann" then
clearedtir = true
tempTimer(2400,[[clearedtir = false]])
elseif gmcp.Room.Info.area == "Quartz Peak" then
clearedquartz = true
tempTimer(1800,[[clearedquartz = false]])
elseif gmcp.Room.Info.area == "the Den of the Quisalis" then
clearedquisalis = true
tempTimer(1800,[[clearedqusalis = false]])
end


--Auto Move to New Area Stuff

if gmcp.Room.Info.area == "the Azdun Catacombs" and clearedmog == false then
--expandAlias("goto Moghedu")
--tempTimer(20,[[ataxiaBasher_areabash()]])
end
if gmcp.Room.Info.area == "The Digsite of Husks" and clearedtir == false then
--expandAlias("goto 21552")
--tempTimer(14,[[ataxiaBasher_areabash()]])
end
if gmcp.Room.Info.area == "Tir Murann" and clearedquartz == false then
--expandAlias("goto 20822")
--tempTimer(10,[[ataxiaBasher_areabash()]])
end

if gmcp.Room.Info.area == "Quartz Peak" and clearedquisalis == false then
--expandAlias("goto 27338")
--tempTimer(10,[[ataxiaBasher_areabash()]])
end

if gmcp.Room.Info.area == "the Den of the Quisalis" and clearedmog == false then
--expandAlias("goto Moghedu")
--tempTimer(20,[[ataxiaBasher_areabash()]])
end


end

function basher_engaged()
  if zgui then
    zgui.bwindow.console:clear()
  else
    ataxiagui.bashConsole:clear()
  end
	enableTrigger("Denizen Attacks / Misc Lines")
	enableTrigger("Gold Dropped")
	enableTimer("Clear Bashing Console")
	bashWatcher = bashWatcher or createStopWatch()
	startStopWatch(bashWatcher)
	ataxiaBasher.shielded = false
  
  --Lock Boss Rooms
  lockRoom(32789, true) --Azdun Cata
  lockRoom(37176, true) --Azdun Cata
  lockRoom(37312, true) --Azdun Cata
  lockRoom(8274, true) -- Annwyn Sihde King/Queen
  
  lockRoom(18678, true)-- Annwyn UnSidhe King\Queen
  lockRoom(9892, true) -- MOG 7 Knight Room
  lockRoom(27663, true) --Den of Qualisis - Grandmaster
  lockRoom(25315, true) -- Den of Qualisus Nishnatoba
  lockRoom(28221, true) -- Den of Qualisus - Enormous FuckHead
  
  guardianofmogcunts = false

	ataxia_saveSettings(false)
	getCurExp = gmcp.Char.Status.level
	getCurGold = gmcp.Char.Status.gold
	if not autoHarvesting and not autoExtracting then
		search_targets()
	end
	send("config mapshow off")
  
  if gmcp.Room.Info.area == "Moghedu" then
    send("say Tulahuar")
  end

  if gmcp.Char.Status.class == "Pariah" then
    --sendAll("epitaph focus serpent nest bear scarab jackal serpent", "crux let me",false)
    send("epitaph focus serpent nest scales skein scarab jackal serpent;crux let me",false)
    send("unwield left;unwield right;wield right shield")
	elseif ataxia_isClass("Bard") then
    send("remove lyre;wield left lyre")
    tempTimer(.1, [[send("performance end")]])
    tempTimer(.2, [[send("compose gusheh sonata scherzo maqam prelude")]])
    tempTimer(1, [[send("tempo allegro")]])
    
		bardNeedRapierWield = false
		
		--sonata maqam prelude scherzo
  elseif gmcp.Char.Status.class == "Blue Dragon" or gmcp.Char.Status.class == "Golden Dragon" or gmcp.Char.Status.class == "Silver Dragon" or gmcp.Char.Status.class == "Green Dragon" or gmcp.Char.Status.class == "Red Dragon" then
    send("unwield left;unwield right;wield left fang;wield right shield")
  elseif gmcp.Char.Status.class == "Runewarden" then
    if gmcp.Char.Vitals.charstats[3] == "Spec: Dual Cutting" then
      send("unwield left;unwield right;wield left scimitar405398;wield right scimitar405403")
    elseif gmcp.Char.Vitals.charstats[3] == "Spec: Dual Blunt" then
      send("unwield left;unwield right;wield left morningstar511732;wield right morningstar511735")
    elseif gmcp.Char.Vitals.charstats[3] == "Spec: Sword and Shield" then
      send("unwield left;unwield right;wield left longsword;wield right shield")
    elseif gmcp.Char.Vitals.charstats[3] == "Spec: Two Handed" then
      send("unwield left;unwield right;wield bastard") 
    end
    elseif gmcp.Char.Status.class == "Infernal" then
    if gmcp.Char.Vitals.charstats[4] == "Spec: Dual Cutting" then
      send("unwield left;unwield right;wield left scimitar405398;wield right scimitar405403")
    elseif gmcp.Char.Vitals.charstats[4] == "Spec: Dual Blunt" then
      send("unwield left;unwield right;wield left morningstar511732;wield right morningstar511735")
    elseif gmcp.Char.Vitals.charstats[4] == "Spec: Sword and Shield" then
      send("unwield left;unwield right;wield left longsword;wield right shield")
    elseif gmcp.Char.Vitals.charstats[4] == "Spec: Two Handed" then
      send("unwield left;unwield right;wield warhammer") 
    end
  elseif gmcp.Char.Status.class == "Serpent" then
    send("unwield left;unwield right;wield left lash;wield right shield")
  elseif gmcp.Char.Status.class == "Shaman" then
    send("unwield left;unwield right;wield right shield")
    if ataxiaTemp.me == "Leviticus" then
    shaman.spiritlore.bashType = "swiftcurse"
    end
  elseif gmcp.Char.Status.class == "Magi" then
    send("unwield left;unwield right;wield left staff569815;wield right shield")
  elseif gmcp.Char.Status.class == "Psion" then
    send("unwield left;unwield right;wield right shield")
  elseif gmcp.Char.Status.class == "Blademaster" then
    send("unwield left;unwield right")
  elseif gmcp.Char.Status.class == "Depthswalker" then
    send("unwield left;unwield right;wield right shield;wield left scythe")
  elseif gmcp.Char.Status.class == "Apostate" then
    send("unwield left;unwield right;wield right shield")
  elseif gmcp.Char.Status.class == "Monk" then
    if ataxia.settings.crushbash then
      if gmcp.Char.Vitals.charstats[4]:find("Stance") == 1 then
        if ataxia.vitals.stance ~= "Dragon" then
          send("drs")
        end
      elseif gmcp.Char.Vitals.charstats[4]:find("Form") == 1 then
        if ataxia.vitals.form ~= "Rain" then
          send("adopt rain form")
        end
      else
        if ataxia.vitals.form ~= "Rain" then
          send("wield staff;adopt rain form")
        end
      end
    elseif gmcp.Char.Vitals.charstats[4]:find("Stance") == 1 then
      if ataxia.vitals.stance ~= "Scorpion" then
        send("scs")
      end
    else
      if ataxia.vitals.form ~= "Rain" or ataxia.vitals.form ~= "Oak" or ataxia.vitals.form ~= "Willow" then
        send("wield staff489282;adopt rain form")
      end
    end    
	elseif ataxia_isClass("Apostate") then
		send("summon daegger")	
	end
  
  if string.find(ataxiaTemp.class, "fire") and ataxia_getPrio("burning") ~= 26 then
    send("curing priority burning 26;manifest torch",false)
  end  
end

registerAnonymousEventHandler("basher enabled", "basher_engaged")
registerAnonymousEventHandler("basher disabled", "basher_disengaged")</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Autobashing Functions</name>
											<packageName></packageName>
											<script>function ataxiaBasher_patterns()

  if ataxiaTemp.bashFlee then return end
  if ataxiaBasher.paused then return end
	--if not ataxiaBasher.paused and (speedWalkCounter &lt; 1 or mmp.paused == true) and not autoHarvesting and not autoExtracting then
	if not ataxiaBasher.paused and (mmp.speedWalkCounter &lt; 1 or mmp.paused == true) and not autoHarvesting and not autoExtracting then

    if not ataxiaBasher_skipRoom then
			if canBals() and canStand() then
				if found_target and not ataxiaBasher_atk then
          if gmcp.Char.Status.class == "Magi" then
            ataxiaBasher_magiBashing()
            ataxiaBasher_attack()
					  ataxiaBasher_atk = true
					  tempTimer(0.4, [[ataxiaBasher_atk=false]])
          else				
					ataxiaBasher_attack()
					ataxiaBasher_atk = true
					tempTimer(0.4, [[ataxiaBasher_atk=false]])
          end
				elseif not found_target and not ataxiaBasher.manual then
					if mmp.paused then
						ataxiaBasher_roomBashed()
						mmp.pause("off")
						send(" ")
          else
            ataxiaBasher_nextRoom()
          end
				end
			end
		elseif not ataxiaBasher.manual then
			if mmp.paused then
				ataxiaBasher_roomBashed()
				mmp.pause("off")
				send(" ")
      else
        ataxiaBasher_nextRoom()
      end
		end
	elseif autoHarvesting then
		ataxiaHarvester_check()
  elseif autoExtracting then
    ataxiaExtractor_check()
	--elseif not ataxiaBasher.manual and (speedWalkCounter &lt; 1 or mmp.paused == true) then
  elseif not ataxiaBasher.manual and (mmp.speedWalkCounter &lt; 1 or mmp.paused == true) then
	
		if mmp.paused then
			ataxiaBasher_roomBashed()
			mmp.pause("off")
			send(" ")
    else
      ataxiaBasher_nextRoom()
    end
	end
ataxiaBasher_stormhammer()		
end

function ataxiaBasher_nextRoom()
  local nextRoom, dist = 0, 9999
  
  if not autoExtracting and not autoHarvesting then
    ataxiaBasher_roomBashed()     
  else
    ataxiaHarvester_harvested()
  end
  if ataxiaBasher.manual then return end
  if #ataxiaBasher_path &gt; 0 then
    if not ataxiaTemp.mapperPath then
      expandAlias("goto "..ataxiaBasher_path[1], false)
    else
      for _, v in ipairs(ataxiaBasher_path) do
        getPath(gCurrentRoom, v)
        if table.size(speedWalkDir) == 1 then
          nextRoom = v
          break
        elseif table.size(speedWalkDir) &lt; dist then
          dist = table.size(speedWalkDir)
          nextRoom = v
        end
      end
      expandAlias("goto "..nextRoom,false)
    end
  else
    ataxiaBasher_areaoff()
  end   
   ataxiaBasher_stormhammer()         
end

function ataxiaBasher_manual()
	mmp.pause("off")
	if not ataxiaBasher.enabled then
		ataxiaEcho("Bashing module engaged. Manual movement required.")
		ataxiaBasher.enabled = true
		ataxiaBasher.paused = false
		ataxiaBasher.manual = true
		ataxiaBasher.areabash = false
		raiseEvent("basher enabled")
	else
		ataxiaBasher.enabled = false
		ataxiaBasher.paused = false
		ataxiaBasher.manual = false
		ataxiaBasher.areabash = false
		ataxiaEcho("Bashing systems disengaged.")
		raiseEvent("basher disabled")
	end
end

function ataxiaBasher_areabash()
	mmp.pause("off")
	local curArea = gmcp.Room.Info.area
	if ataxiaBasher.targetList[curArea] then
		ataxiaEcho("Complete control sacrificed. Walking to start of slaughter path.")
		ataxiaBasher.enabled = true
		ataxiaBasher.paused = false
		ataxiaBasher.manual = false
		ataxiaBasher.areabash = true
		ataxiaBasher_generatePath()
		raiseEvent("basher enabled")
	end
end

function ataxiaBasher_areaoff()
	mmp.pause("off")
	ataxiaBasher.enabled = false
	ataxiaBasher.paused = false
	ataxiaBasher.manual = false
	ataxiaBasher.areabash = false
	ataxiaEcho("Bashing systems disengaged.")
	raiseEvent("basher disabled")
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<Script isActive="yes" isFolder="no">
										<name>Bash Stats Functions</name>
										<packageName></packageName>
										<script>function resetBashingStats()
cecho("TEST TEST TEST TEST")
	bashStats = {}
	bashStats = {
		criticals = { ["2x"] = 0, ["4x"] = 0, ["8x"] = 0, ["16x"] = 0, ["32x"] = 0, ["64x"] = 0 },
		attacks = 0,
		loginGold = tonumber(gmcp.Char.Status.gold),
		gainedGold = 0,
		crits = 0,
		slain = 0,
		mobhits = 0,
		blockedhits = 0,
	}
	ataxiaEcho("Bashing statistics have been reset.")
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Guardians Of MoG</name>
										<packageName></packageName>
										<script>function findcuntyguardians()
if gmcp.Room.Info.area == "Moghedu" then
  if ataxia.playersHere == "Hikagejuunin" then
  guardianofmogcunts = true
  ataxiaBasher.pause = true
  ataxiaBasher_areaoff()
  expandAlias("mstop")
  send("cq all")
  expandAlias("goto Mhaldor")
  end
    
end
end

</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
							</ScriptGroup>
						</ScriptGroup>
						<ScriptGroup isActive="yes" isFolder="yes">
							<name>Levi  Scripts</name>
							<packageName>DominiusAtax</packageName>
							<script></script>
							<eventHandlerList />
							<ScriptGroup isActive="yes" isFolder="yes">
								<name>Leviticus</name>
								<packageName></packageName>
								<script></script>
								<eventHandlerList />
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>MONK</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>RIGHT LEG</name>
										<packageName></packageName>
										<script>function rightleg()

local atk = combatQueue()

if tLimbs.RL &lt; 100 then
need_prep_right_leg = true
else 
need_prep_right_leg = false
end

if tAffs.shield then
need_raze = true
else 
need_raze = false
end


if need_raze then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." rhk hfp right hfp right"

end

if need_prep_right_leg then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." snk right hfp right hfp right"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SWEEP RL</name>
										<packageName></packageName>
										<script>function sweeprightleg()

local atk = combatQueue()

if tLimbs.RL &lt; 100 then
need_prep_right_leg = true
else 
need_prep_right_leg = false
end

if tAffs.shield then
need_raze = true
else 
need_raze = false
end



if need_raze then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." rhk hfp right hfp right"

end

if need_prep_right_leg then

atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";combo "..target.." swk hfp right hfp right"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>LEFT LEG</name>
										<packageName></packageName>
										<script>function leftleg()

local atk = combatQueue()

if tLimbs.LL &lt; 100 then
need_prep_left_leg = true
else 
need_prep_left_leg = false
end

if tAffs.shield then
need_raze = true
else 
need_raze = false
end



if need_raze then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." rhk hfp left hfp left"

end

if need_prep_left_leg then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." snk left hfp left hfp left"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>RIGHT ARM</name>
										<packageName></packageName>
										<script>function rightarm()

local atk = combatQueue()

if tLimbs.RA &lt; 100 then
need_prep_right_arm = true
else 
need_prep_right_arm = false
end

if tAffs.shield then
need_raze = true
else 
need_raze = false
end



if need_prep_right_arm then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." swk spp right spp right"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>LEFT ARM</name>
										<packageName></packageName>
										<script>function leftarm()

local atk = combatQueue()

if tLimbs.LA &lt; 100 then
need_prep_left_arm = true
else 
need_prep_left_arm = false
end

if tAffs.shield then
need_raze = true
else 
need_raze = false
end



if need_prep_left_arm then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." swk spp left spp left"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>TORSO</name>
										<packageName></packageName>
										<script>function monktorso()

local atk = combatQueue()

if tLimbs.T &lt; 200 then
need_prep_torso = true
else 
need_prep_torso = false
end


if tAffs.shield then
need_raze = true
else 
need_raze = false
end


if need_prep_torso then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." sdk hkp hkp;hrs"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>HEAD</name>
										<packageName></packageName>
										<script>function monkhead()

local atk = combatQueue()

if tLimbs.H &lt; 100 then
need_prep_head = true
else 
need_prep_head = false
end

if tAffs.shield then
need_raze = true
else 
need_raze = false
end



if need_prep_head then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." wwk ucp ucp"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SWEEP LL</name>
										<packageName></packageName>
										<script>function sweepleftleg()

local atk = combatQueue()

if tLimbs.RL &lt; 100 then
need_prep_left_leg = true
else 
need_prep_left_leg = false
end


if tAffs.shield then
need_raze = true
else 
need_raze = false
end


if need_prep_left_leg then

atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";combo "..target.." swk hfp left hfp left"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SWEEP TORSO</name>
										<packageName></packageName>
										<script>function sweeptorso()

local atk = combatQueue()

if tLimbs.T &lt; 100 then
need_prep_torso = true
else 
need_prep_torso = false
end


if tAffs.shield then
need_raze = true
else 
need_raze = false
end


if need_prep_torso then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." swk hkp hkp"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SWEEP LEGS</name>
										<packageName></packageName>
										<script>function sweeplegs()

local atk = combatQueue()

if tLimbs.RL &lt; 100 and tLimbs.LL &lt; 100 then
need_prep_legs = true
else 
need_prep_legs = false
end


if tAffs.shield then
need_raze = true
else 
need_raze = false
end


if need_raze then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." rhk hfp right hfp right"

end

if need_prep_legs then

atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";combo "..target.." swk hfp left hfp right"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>AXE</name>
										<packageName></packageName>
										<script>function monkaxe()

local atk = combatQueue()

if tLimbs.H &lt; 100 then
need_prep_head = true
else 
need_prep_head = false
end

if tAffs.shield then
need_raze = true
else 
need_raze = false
end



if need_prep_head then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." axk ucp ucp"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SWEEP RA</name>
										<packageName></packageName>
										<script>function sweeprightarm()

local atk = combatQueue()

if tLimbs.RA &lt; 100 then
need_prep_right_arm = true
else 
need_prep_right_arm = false
end

if tAffs.shield then
need_raze = true
else 
need_raze = false
end



if need_prep_right_arm then

atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";combo "..target.." swk spp right spp right"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SWEEP HEAD</name>
										<packageName></packageName>
										<script>function sweephead()

local atk = combatQueue()

if tLimbs.H &lt; 200 then
need_prep_head = true
else 
need_prep_head = false
end

if tAffs.shield then
need_raze = true
else 
need_raze = false
end



if need_prep_head then

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." swk ucp ucp"

end


send("queue addclear free "..atk)

end
</script>
										<eventHandlerList />
									</Script>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>SCYTHE</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>SCYTHE</name>
											<packageName></packageName>
											<script>function scythe()

local atk = combatQueue()

stance = stance or "scs"
impatiencemind = impatiencemind or false
battered = battered or false


if tLimbs.RL + ataxiaTables.limbData.tekuraHFP &gt;= 100 and tLimbs.RL &lt; 100  then
 legs_prepped = true
else legs_prepped = false
end


if battered and tAffs.damagedhead then
scythe_them = true
else scythe_them = false

end


if tAffs.prone and tLimbs.H &lt; 100 then
prep_head = true
else prep_head = false
end

if tAffs.prone and tAffs.damagedhead and not epiparty then 
wrench_head = true
else wrench_head = false

end





if tAffs.shield then
need_raze = true
else 
need_raze = false
end




if scythe_them then

atk = atk.."unwield all;dismount;assess "..target..";mind scythe"

end

if epiparty and not impatiencemind and not battered then


atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";mind impatience"

end


if epiparty and impatiencemind then


atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";mind batter"

end

if legs_prepped then

atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";combo "..target.." swk hfp right jbp head;drs"

end

if prep_head then

atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";combo "..target.." axk hfp left pmp;hrs"

end

if wrench_head then

atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";combo "..target.." wrt head blp pmp;drs"


end





if legs_prepped then


send("queue addclear free "..atk)
tempTimer(0.05, [[ send("mind command apply restoration to arms") ]])

elseif prep_head then


send("queue addclear free "..atk)
tempTimer(0.05, [[ send("mind command restore") ]])



else
send("queue addclear free "..atk)


end



end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>BACKBREAKER</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>BACKBREAKER</name>
											<packageName></packageName>
											<script>

function backbreaker()
 

local atk = combatQueue()

stance = stance or "scs"

limbpreptekura()




if tAffs.prone then
back_breaker = true
else back_breaker = false

end

if leftarm_prepped_punch and not rightarm_prepped_punch and puncharm == "spp left" then puncharm = "spp right"
elseif
rightarm_prepped_punch and not leftarm_prepped_punch and puncharm == "spp right" then puncharm = "spp left"
elseif
leftarm_prepped_kick and not rightarm_prepped_kick and kickarm == "mnk left" then kickarm = "mnk right"
elseif
rightarm_prepped_kick and not leftarm_prepped_kick and kickarm == "mnk right" then kickarm = "mnk left"

end

if leftleg_prepped_punch and not rightleg_prepped_punch and punchleg == "hfp left" then punchleg = "hfp right"
elseif
rightleg_prepped_punch and not leftleg_prepped_punch and punchleg == "hfp right" then punchleg = "hfp left"
elseif
leftleg_prepped_kick and not rightleg_prepped_kick and kickleg == "snk left" then kickleg = "snk right"
elseif
rightleg_prepped_kick and not leftleg_prepped_kick and kickleg == "snk right" then kickleg = "snk left"

end




if back_breaker then
stance = "scs"
atk = atk.."unwield all;dismount;assess "..target..";bbt "..target

elseif legs_prepped_punch and tAffs.damagedleftarm and stance == "hrs" and not tAffs.prone then
stance = "scs"

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." wrt left arm hfp right hfp left;"..stance

elseif legs_prepped_punch and tAffs.damagedrightarm and stance == "hrs" and not tAffs.prone then
stance = "scs"

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." wrt right arm hfp right hfp left;"..stance

elseif legs_prepped_punch and tAffs.damagedtorso and not tAffs.prone then 
stance = "scs"

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." swk hfp right hfp left;"..stance

elseif torso_prepped_kick and rightleg_prepped_punch and leftleg_prepped_punch then
stance = "scs"

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." sdk hfp right hfp left;"..stance

elseif not legs_prepped_punch then
stance = "scs"

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." "..kickleg.." "..punchleg.." "..punchleg..";"..stance


else
stance = "scs"

atk = atk.."unwield all;dismount;assess "..target..";combo "..target.." "..kickarm.." "..puncharm.." "..puncharm..";"..stance

end


send("queue addclear free "..atk)



end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>BACKBREAKER SOLID</name>
											<packageName></packageName>
											<script>function backbreakersolid()


local atk = combatQueue()


stance = stance or "scs"


if not tAffs.prone and not bruisedribs
then 
torso_prepped = true
else torso_prepped = false
end

if tLimbs.RL + ataxiaTables.limbData.tekuraHFP &gt;= 100 and tLimbs.RL &lt; 100
and tLimbs.LL + ataxiaTables.limbData.tekuraHFP &gt;= 100 and tLimbs.LL &lt; 100
and bruisedribs then


 legs_prepped = true
else legs_prepped = false
end



if  tAffs.prone then
back_breaker = true
else back_breaker = false

end



if torso_prepped then

atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";wrt "..target.." torso;pmp "..target..";jbp "..target.." head;scs"

end

if legs_prepped then

atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";combo "..target.." swk hfp right hfp left;drs"

end

if back_breaker then
atk = atk.."unwield all;dismount;assess "..target..";assess "..target..";bbt "..target


end

if legs_prepped then


send("queue addclear free "..atk)
tempTimer(0.05, [[ send("mind command apply restoration to arms") ]])
else

send("queue addclear free "..atk)


end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>LIMB PREP FUNCTION</name>
											<packageName></packageName>
											<script>function limbpreptekura()

         
            mytablearm = {"right arm", "left arm", "torso"} 
            mytableleg = {"right leg", "left leg", "torso"} 
            




         
            mytablekicktorso = {"sdk"} 
            mytablekickleg = {"snk left", "snk right"} 
            mytablekickarm = {"mnk left", "mnk right"} 




    
         
            mytablepunchtorso = {"hkp"} 
            mytablepunchleg = {"hfp right", "hfp left"} 
            mytablepuncharm = {"spp right", "spp left"}





double_HFP = ataxiaTables.limbData.tekuraHFP + ataxiaTables.limbData.tekuraHFP
double_SPP = ataxiaTables.limbData.tekuraSPP + ataxiaTables.limbData.tekuraSPP

if (tLimbs.RL + ataxiaTables.limbData.tekuraHFP &gt;= 100 and tLimbs.RL &lt; 100)
and (tLimbs.LL + ataxiaTables.limbData.tekuraHFP &gt;= 100 and tLimbs.LL &lt; 100) then
 legs_prepped_punch = true
else legs_prepped_punch = false
end

if (tLimbs.RA + ataxiaTables.limbData.tekuraSPP &gt;= 100 and tLimbs.RA &lt; 100)
and (tLimbs.LA + ataxiaTables.limbData.tekuraSPP &gt;= 100 and tLimbs.LA &lt; 100) then
 arms_prepped_punch = true
else arms_prepped_punch = false
end

if tLimbs.RA + ataxiaTables.limbData.tekuraSPP &gt;= 100 and tLimbs.RA &lt; 100
then
rightarm_prepped_punch = true
else rightarm_prepped_punch = false
end

if tLimbs.RA + ataxiaTables.limbData.tekuraMNK &gt;= 100 and tLimbs.RA &lt; 100
then
rightarm_prepped_kick = true
else rightarm_prepped_kick = false
end

if tLimbs.LA + ataxiaTables.limbData.tekuraMNK &gt;= 100 and tLimbs.LA &lt; 100
then
leftarm_prepped_kick = true
else leftarm_prepped_kick = false
end

if tLimbs.LA + ataxiaTables.limbData.tekuraSPP &gt;= 100 and tLimbs.LA &lt; 100
then
leftarm_prepped_punch = true
else leftarm_prepped_punch = false
end

if tLimbs.RL + ataxiaTables.limbData.tekuraHFP &gt;= 100 and tLimbs.RL &lt; 100
then
rightleg_prepped_punch = true
else rightleg_prepped_punch = false
end

if tLimbs.RL + ataxiaTables.limbData.tekuraSNK &gt;= 100 and tLimbs.RL &lt; 100
then
rightleg_prepped_kick = true
else rightleg_prepped_kick = false
end

if tLimbs.LL + ataxiaTables.limbData.tekuraHFP &gt;= 100 and tLimbs.LL &lt; 100
then
leftleg_prepped_punch = true
else leftleg_prepped_punch = false
end

if tLimbs.LL + ataxiaTables.limbData.tekuraSNK &gt;= 100 and tLimbs.LL &lt; 100
then
leftleg_prepped_kick = true
else leftleg_prepped_kick = false
end

if tLimbs.T + ataxiaTables.limbData.tekuraHKP &gt;= 100 and tLimbs.T &lt; 100
then
torso_prepped_punch = true
else torso_prepped_punch = false
end

if tLimbs.T + ataxiaTables.limbData.tekuraSDK &gt;= 100 and tLimbs.T &lt; 100
then
torso_prepped_kick = true
else torso_prepped_kick = false
end

targetarm = mytablearm[math.random(#mytablearm)]

targetleg = mytableleg[math.random(#mytableleg)]

kickleg = mytablekickleg[math.random(#mytablekickleg)]

punchleg = mytablepunchleg[math.random(#mytablepunchleg)]

kickarm = mytablekickarm[math.random(#mytablekickarm)]

puncharm = mytablepuncharm[math.random(#mytablepuncharm)]

kicktorso = mytablekicktorso[math.random(#mytablekicktorso)]

punchtorso = mytablepunchtorso[math.random(#mytablepunchtorso)]


end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>SHIKUDO</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>LOCK THEM</name>
											<packageName></packageName>
											<script>function lock_base_attack()

formswaplock()

local atk = combatQueue()
   

  if shikudo[1] == "sweep" then
  
  atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." "..shikudo[1].." "..shikudo[2]
 
elseif


shikudo[1] == "dispatch" then
  
  atk = atk.."wield staff489282;dismount;assess "..target..";dispatch "..target.." "..form[1]
 
 elseif ataxia.vitals.form == "Oak" and rightarmpreppedRUK and leftarmpreppedRUK and rightlegpreppedKUR and leftlegpreppedKUR then

  atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." "..shikudo[1].." "..shikudo[2]


elseif ataxia.vitals.form == "Gaital" and leftarmpreppedRUK and rightlegpreppedKUR and leftlegpreppedKUR and
(tLimbs.RA + ataxiaTables.limbData.shikRuku + ataxiaTables.limbData.shikRuku &gt;=  100)

 then
 
  atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." "..shikudo[1].." "..shikudo[2]

 
 else

atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." "..shikudo[1].." "..shikudo[2].." "..shikudo[3]
 
end
 
if ataxia.vitals.form ~= form[1] then

send("cq all;transition to the "..form[1].." form")

else

send("queue addclear freestand " ..atk)



end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>LOCK PRIOS</name>
											<packageName></packageName>
											<script>
function lock_base_prios()
  
  


preplimb = preplimb or "right leg"
shikudo = {}

if tAffs.prone or tAffs.paralysis then ataxiaTemp.parriedLimb = "none" end


if tLimbs.LA + ataxiaTables.limbData.shikRuku &gt;=  100 then  leftarmpreppedRUK = true else leftarmpreppedRUK = false end
if tLimbs.RA + ataxiaTables.limbData.shikRuku &gt;=  100 then  rightarmpreppedRUK = true else rightarmpreppedRUK = false end
if tLimbs.LA + ataxiaTables.limbData.shikFrontkick &gt;=  100 then  leftarmpreppedFRO = true  else leftarmpreppedFRO = false end
if tLimbs.RA + ataxiaTables.limbData.shikFrontkick &gt;=  100 then  rightarmpreppedFRO = true  else rightarmpreppedFRO = false end


if tLimbs.RL + ataxiaTables.limbData.shikKuro &gt;=  100 and not tAffs.damagedrightleg then  rightlegpreppedKUR = true else rightlegpreppedKUR = false end
if tLimbs.LL + ataxiaTables.limbData.shikKuro &gt;=  100 and not tAffs.damagedleftleg then leftlegpreppedKUR = true else leftlegpreppedKUR = false end
if tLimbs.LL + ataxiaTables.limbData.shikFlashheel &gt;=  100 and not tAffs.damagedleftleg then leftlegpreppedFLASH = true else leftlegpreppedFLASH = false end
if tLimbs.RL + ataxiaTables.limbData.shikFlashheel &gt;=  100 and not tAffs.damagedrightleg then  rightlegpreppedFLASH = true else rightlegpreppedFLASH = false end

if tLimbs.H + ataxiaTables.limbData.shikNervestrike &gt;=  100 then  headpreppedNERV = true else headpreppedNERV = false end
if tLimbs.H + ataxiaTables.limbData.shikSpinkickHead &gt;=  100 then  headpreppedSPIN = true else headpreppedSPIN = false end
if tLimbs.H + ataxiaTables.limbData.shikRisingkick &gt;=  100 then  headpreppedRIS = true else headpreppedRIS = false end
if tLimbs.H + ataxiaTables.limbData.shikHiru &gt;=  100 then  headpreppedHIRU = true else headpreppedHIRU = false end
if tLimbs.H + ataxiaTables.limbData.shikHiraku &gt;=  100 then  headpreppedHIRA = true  else headpreppedHIRA = false end
if tLimbs.H + ataxiaTables.limbData.shikNeedle &gt;=  100 then  headpreppedNEED = true  else headpreppedNEED = false end
if tLimbs.H + ataxiaTables.limbData.shikNervestrike + ataxiaTables.limbData.shikRisingkick &gt;=  100 then  headpreppedNERVRIS = true else headpreppedNERVRIS = false end
if tLimbs.H + ataxiaTables.limbData.shikNeedle &gt;=  100 then  headpreppedNEED = true else headpreppedNEED = false end

  
 
 if tAffs.shield then
 
     table.insert(shikudo,"shatter")
 end
 
 if tAffs.prone and tAffs.damagedhead and tAffs.crushedthroat then
table.insert(shikudo,"dispatch")
end
 
 
-- TYKONOS --




if ataxia.vitals.form == "Tykonos" then

if

 not tAffs.prone then
 table.insert(shikudo,"sweep")
  table.insert(shikudo,"risingkick head")
 table.insert(shikudo,"risingkick head")
end



end

-- WILLOW --

if ataxia.vitals.form == "Willow" then
if
shikudo[1] ~= "shatter" then
if ataxiaTemp.parriedLimb ~= "left leg" and not leftlegpreppedFLASH then
 table.insert(shikudo,"flashheel left")
  table.insert(shikudo,"hiraku")
  table.insert(shikudo,"hiru")
  
  elseif ataxiaTemp.parriedLimb == "left leg" and not rightlegpreppedFLASH then
   table.insert(shikudo,"flashheel right")
  table.insert(shikudo,"hiraku")
  table.insert(shikudo,"hiru")
 end

end

 end
 
 
  -- OAK --


if ataxia.vitals.form == "Oak" then
table.insert(shikudo,"risingkick torso")







if tAffs.brokenleftarm and tAffs.brokenrightarm and tAffs.asthma and not tAffs.slickness then
        table.insert(shikudo,"ruku torso")
end


if not leftlegpreppedKUR then

       table.insert(shikudo,"kuro left")
end


if not rightlegpreppedKUR  then 
       table.insert(shikudo,"kuro right")

  end

if not leftarmpreppedRUK and ataxiaTemp.parriedLimb ~= "left arm" then 

        table.insert(shikudo,"ruku left")
end
if not rightarmpreppedRUK then
       table.insert(shikudo,"ruku right")
end
if not tAffs.asthma then
      table.insert(shikudo,"livestrike")
end



end
 
-- RAIN --



 if ataxia.vitals.form == "Rain" then

if ataxiaTemp.parriedLimb ~= "left arm" and not leftarmpreppedFRO then
  table.insert(shikudo,"frontkick left")
  elseif ataxiaTemp.parriedLimb == "left arm" and not rightarmpreppedFRO then
  table.insert(shikudo,"frontkick right")
  elseif tLimbs.LA &gt;= 90 and not rightarmpreppedFRO then
  table.insert(shikudo,"frontkick right")
  else
table.insert(shikudo,"frontkick right")
 end
 

if  not leftlegpreppedKUR then

       table.insert(shikudo,"kuro left")
end


if not rightlegpreppedKUR  then 
       table.insert(shikudo,"kuro right")

  end
  
 if leftlegpreppedKUR and not rightlegpreppedKUR and not rightarmpreppedRUK then 
          table.insert(shikudo,"ruku right")
            table.insert(shikudo,"kuro right")
 end
 
  if rightlegpreppedKUR and not leftlegpreppedKUR then 
          table.insert(shikudo,"ruku left")
            table.insert(shikudo,"kuro left")
 end
 
 if leftlegpreppedKUR and  rightlegpreppedKUR then 
          table.insert(shikudo,"ruku right")
          
 end
 if rightlegpreppedKUR and not leftarmpreppedRUK then 
          table.insert(shikudo,"ruku left")
 end
 
 if rightlegpreppedKUR and (leftarmpreppedRUK or rightarmpreppedRUK) then
         table.insert(shikudo,"hiru")
 end
 
  if leftlegpreppedKUR and (leftarmpreppedRUK or rightarmpreppedRUK) then
         table.insert(shikudo,"hiru")
 end

end

-- GAITAL --


if ataxia.vitals.form == "Gaital" then





if rightlegpreppedFLASH and leftlegpreppedKUR and rightarmpreppedRUK and leftarmpreppedRUK
then
table.insert(shikudo,"flashheel right")
  table.insert(shikudo,"kuro left")
  table.insert(shikudo,"ruku right")
end

if not tAffs.prone and tAffs.damagedhead then
table.insert(shikudo,"sweep")
  table.insert(shikudo,"spinkick")
end





if not tAffs.damagedleftleg and  not leftlegpreppedFLASH  then

       table.insert(shikudo,"flashheel left")
end

if not tAffs.damagedrightleg and not rightlegpreppedFLASH and shikudo[1] ~= "flashheel left"  then

       table.insert(shikudo,"flashheel right")
end




if not rightlegpreppedKUR and not tAffs.prone  then 
       table.insert(shikudo,"kuro right")

  end
  
  if not leftlegpreppedKUR and not tAffs.prone  then 
       table.insert(shikudo,"kuro left")

  end



if not rightarmpreppedRUK  then

       table.insert(shikudo,"ruku right")
end

if not rightarmpreppedRUK and rightlegpreppedKUR and leftlegpreppedKUR and leftarmpreppedRUK then

       table.insert(shikudo,"ruku right")
end

if not leftarmpreppedRUK  then

       table.insert(shikudo,"ruku left")
end

if
shikudo[1] ~= "shatter" and ataxiaTemp.shikCombo.kick ~= "flashheel" then
  table.insert(shikudo,"spinkick")

end



 


end



-- MAELSTROM --

if ataxia.vitals.form == "Maelstrom" then
if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 then
  table.insert(shikudo,"sweep")

 table.insert(shikudo,"crescent")
 end
 
if not tAffs.prone then 
 table.insert(shikudo,"sweep")
 table.insert(shikudo,"risingkick head")
 end
 
 if tAffs.prone then
  table.insert(shikudo,"risingkick head")
  end
 
 if tAffs.prone and not tAffs.damagedrightarm then
  table.insert(shikudo,"ruku right")
 end
 
  if tAffs.prone and not tAffs.damagedleftarm then
  table.insert(shikudo,"ruku left")
 end
 
 if tAffs.prone and not tAffs.addiction then
   table.insert(shikudo,"jinzuku")
 end
 
  if tAffs.prone and not tAffs.asthma then
   table.insert(shikudo,"livestrike")
 end
 
end


lock_base_attack()

end


</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>FORM SWAP LOCK</name>
											<packageName></packageName>
											<script>function formswaplock()

form = {}






if ataxia.vitals.form == "Tykonos" and ataxia.vitals.kata &gt;= 5 then
 table.insert(form,"Willow")
end

if ataxia.vitals.form == "Gaital" and ataxia.vitals.kata &gt;= 5 and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50  then
 table.insert(form,"Maelstrom")
end

if ataxia.vitals.form == "Gaital" and ataxia.vitals.kata &gt;= 5 and tAffs.brokenrightleg and tAffs.brokenleftleg  then
 table.insert(form,"Maelstrom")
end

if ataxia.vitals.form == "Gaital" and ataxia.vitals.kata &gt;= 11 then
 table.insert(form,"Maelstrom")
end

if ataxia.vitals.form == "Maelstrom" and ataxia.vitals.kata &gt;= 11 then
 table.insert(form,"Oak")
end

if ataxia.vitals.form == "Maelstrom" and ataxia.vitals.kata &gt;= 5 and tAffs.damagedleftarm and tAffs.damagedrightarm and tAffs.addiction then
 table.insert(form,"Oak")
end

if ataxia.vitals.form == "Willow" and ataxia.vitals.kata &gt;= 5 then
 table.insert(form,"Rain")
end

if ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 5 and leftlegpreppedKUR and rightlegpreppedKUR and leftarmpreppedRUK and rightarmpreppedRUK then
 table.insert(form,"Oak")
end

if ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 23 then
 table.insert(form,"Oak")
end



if ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 11 then
 table.insert(form,"Gaital")
end

if ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 5 and leftlegpreppedKUR and rightlegpreppedKUR and leftarmpreppedRUK and rightarmpreppedRUK then
 
 table.insert(form,"Gaital")
end

if ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 5 and tAffs.slickness and tAffs.asthma and tAffs.brokenrightarm and tAffs.brokenleftarm then
 table.insert(form,"Willow")
end




if ataxia.vitals.form == "Gaital" and ataxia.vitals.kata &gt;= 11 then
 table.insert(form,"Rain")
end

-- BASE --


if ataxia.vitals.form == "Tykonos" and form[1] ~= "Willow" then
 table.insert(form,"Tykonos")
end

if ataxia.vitals.form == "Willow" and form[1] ~= "Rain" then
 table.insert(form,"Willow")
end


if ataxia.vitals.form == "Rain" and form[1] ~= "Oak" and form[1] ~= "Tykonos" then
 table.insert(form,"Rain")
end

if ataxia.vitals.form == "Oak" and (form[1] ~= "Willow" or form[1] ~= "Gaital") then
 table.insert(form,"Oak")
end


if ataxia.vitals.form == "Gaital" and form[1] ~= "Rain" and form[1] ~= "Maelstrom" then
 table.insert(form,"Gaital")
end

if ataxia.vitals.form == "Maelstrom" and form[1] ~= "Oak" then
 table.insert(form,"Maelstrom")
end


end
</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>FORM SWAP DISPATCH</name>
											<packageName></packageName>
											<script>function formswapdispatch()

form = {}





if ataxia.vitals.form == "Tykonos" and ataxia.vitals.kata &gt;= 5 then
 table.insert(form,"Willow")
end

if ataxia.vitals.form == "Gaital" and ataxia.vitals.kata &gt;= 5 and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50  then
 table.insert(form,"Maelstrom")
end

if ataxia.vitals.form == "Willow" and ataxia.vitals.kata &gt;= 5 then
 table.insert(form,"Rain")
end

if ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 5 and llKUR and rlKUR and laRUK and raRUK  then
 table.insert(form,"Oak")
end

if ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 22 then
 table.insert(form,"Oak")
end



if ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 11 then
 table.insert(form,"Gaital")
end

if ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 5 and llKUR and rlKUR and hNEED then
 table.insert(form,"Gaital")
end

if ataxia.vitals.form == "Gaital" and ataxia.vitals.kata &gt;= 11 and not tAffs.prone and not tAffs.damagedhead and ataxiaTemp.lastAssess &gt;= 50 then
 table.insert(form,"Rain")
end

if ataxia.vitals.form == "Maelstrom" and ataxia.vitals.kata &gt;= 11 and not tAffs.prone and not tAffs.damagedhead and ataxiaTemp.lastAssess &gt;= 50 then
 table.insert(form,"Oak")
end


-- BASE --


if ataxia.vitals.form == "Tykonos" and form[1] ~= "Willow" then
 table.insert(form,"Tykonos")
end

if ataxia.vitals.form == "Willow" and form[1] ~= "Rain" then
 table.insert(form,"Willow")
end


if ataxia.vitals.form == "Rain" and form[1] ~= "Oak" and form[1] ~= "Tykonos" then
 table.insert(form,"Rain")
end

if ataxia.vitals.form == "Oak" and (form[1] ~= "Willow" or form[1] ~= "Gaital") then
 table.insert(form,"Oak")
end


if ataxia.vitals.form == "Gaital" and form[1] ~= "Rain" and form[1] ~= "Maelstrom" then
 table.insert(form,"Gaital")
end

if ataxia.vitals.form == "Maelstrom" and form[1] ~= "Oak" then
 table.insert(form,"Maelstrom")
end


end
</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>FORM group</name>
											<packageName></packageName>
											<script>function formswapdispatch()

form = {}






if ataxia.vitals.form == "Tykonos" and ataxia.vitals.kata &gt;= 5 then
 table.insert(form,"Willow")
end


if ataxia.vitals.form == "Willow" and ataxia.vitals.kata &gt;= 5 and tAffs.anorexia and tAffs.impatience then
 table.insert(form,"Rain")
end

if ataxia.vitals.form == "Willow" and ataxia.vitals.kata &gt;= 11 then
 table.insert(form,"Rain")
end

if ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 5 and tAffs.weariness and tAffs.lethargy  then
 table.insert(form,"Oak")
end

if ataxia.vitals.form == "Rain" and ataxia.vitals.kata &gt;= 22 then
 table.insert(form,"Oak")
end



if ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 11 then
 table.insert(form,"Willow")
end

if ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 5 and tAffs.asthma and tAffs.slickness and tAffs.paralysis then
 table.insert(form,"Willow")
end

if ataxia.vitals.form == "Gaital" and ataxia.vitals.kata &gt;= 11  then
 table.insert(form,"Rain")
end




-- BASE --


if ataxia.vitals.form == "Tykonos" and form[1] ~= "Willow" then
 table.insert(form,"Tykonos")
end

if ataxia.vitals.form == "Willow" and form[1] ~= "Rain" then
 table.insert(form,"Willow")
end


if ataxia.vitals.form == "Rain" and form[1] ~= "Oak" and form[1] ~= "Tykonos" then
 table.insert(form,"Rain")
end

if ataxia.vitals.form == "Oak" and (form[1] ~= "Willow" or form[1] ~= "Gaital") then
 table.insert(form,"Oak")
end


if ataxia.vitals.form == "Gaital" and form[1] ~= "Rain" and form[1] ~= "Maelstrom" then
 table.insert(form,"Gaital")
end

if ataxia.vitals.form == "Maelstrom" and form[1] ~= "Oak" then
 table.insert(form,"Maelstrom")
end


end
</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>DISPTACH GROUP</name>
											<packageName></packageName>
											<script>
function dispatch_base_attackGROUP()

formswapdispatch()
local xmute = math.ceil(ataxia.vitals.maxhp * 0.80)
	local mpl = (ataxia.vitals.mp - (ataxia.vitals.maxmp * 0.30))
	local hpl = (xmute - ataxia.vitals.hp)
	local tomute = 0

	if hpl &gt; 1 then
		tomute = (hpl &lt; mpl and hpl or mpl)
		if tomute &gt; 100 then
			command = command.."transmute "..tomute..ataxia.settings.separator
		end
	end

local atk = combatQueue()

if ataxia.vitals.class &gt;= 50 and tAffs.slickness and tAffs.impatience and tAffs.anorexia then go_cripple = true else go_cripple = false end

if (tAffs.paralysis or tAffs.weariness or tAffs.lethargy or tAffs.asthma) and not tAffs.impatience then need_impatience = true else need_impatience = false end

if tAffs.impatience and not battered then need_batter = true else need_batter = false end

   
if tAffs.shield then shistick[1] = "shatter"

end

 if tAffs.prone and tLimbs.H &gt;= 100 and tAffs.crushedthroat then
shikick = "dispatch"
end



  if (shistick[1] == "sweep" or shistick[1] == "shatter") then
  
  atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." "..shistick[1].." "..shikick
 
 elseif need_impatience then
 atk = atk.."mind impatience "..target
 
 elseif need_batter then
  atk = atk.."mind batter "..target
 
 
 
elseif


shikick == "dispatch" then
  
  atk = atk.."wield staff489282;dismount;assess "..target..";incapacitate "..target.." "..form[1]

elseif shikick == "none" then

  atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." "..shistick[1].." "..shistick[2]


  
 else

atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." "..shikick.." "..shistick[1].." "..shistick[2]
 
end
 
if ataxia.vitals.form ~= form[1] then

send("cq all;transition to the "..form[1].." form")


elseif table.contains(ataxia.playersHere, target) then

if not ataxia.settings.paused and not ataxia_needLockBreak() and not ataxia.afflictions.stupidity then

if go_cripple then
send("queue addclear free kai cripple "..target)
else

send("queue addclear free "..atk)


end
end
end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>DISPTACH LEG PRIOS</name>
											<packageName></packageName>
											<script>



  function dispatch_base_priosTEST()
  
  
preplimb = preplimb or "right leg"
shistick = {}

if tAffs.prone or tAffs.paralysis then ataxiaTemp.parriedLimb = "none" end


if tLimbs.LA + ataxiaTables.limbData.shikRuku &gt;=  100 then  laRUK = true else laRUK = false end
if tLimbs.RA + ataxiaTables.limbData.shikRuku &gt;=  100 then  raRUK = true else raRUK = false end
if tLimbs.LA + ataxiaTables.limbData.shikFrontkick &gt;=  100 then  laFRO = true  else laFRO = false end
if tLimbs.RA + ataxiaTables.limbData.shikFrontkick &gt;=  100 then  raFRO = true  else raFRO = false end
if tLimbs.LA + ataxiaTables.limbData.shikDart &gt;=  100 then  laDAR = true else laDAR = false end
if tLimbs.RA + ataxiaTables.limbData.shikDart &gt;=  100 then  raDAR = true else raDAR = false end


if tLimbs.RL + ataxiaTables.limbData.shikKuro &gt;=  100 and not tAffs.damagedrightleg then  rlKUR = true else rlKUR = false end
if tLimbs.LL + ataxiaTables.limbData.shikKuro &gt;=  100 and not tAffs.damagedleftleg then llKUR = true else llKUR = false end
if tLimbs.LL + ataxiaTables.limbData.shikFlashheel &gt;=  100 and not tAffs.damagedleftleg then llFLASH = true else llFLASH = false end
if tLimbs.RL + ataxiaTables.limbData.shikFlashheel &gt;=  100 and not tAffs.damagedrightleg then  rlFLASH = true else rlFLASH = false end
if tLimbs.LL + ataxiaTables.limbData.shikFlashheel + ataxiaTables.limbData.shikKuro &gt;=  100 and not tAffs.damagedleftleg then llFLASHKUR = true else llFLASHKUR = false end
if tLimbs.RL + ataxiaTables.limbData.shikFlashheel + ataxiaTables.limbData.shikKuro &gt;=  100 and not tAffs.damagedrightleg then  rlFLASHKUR = true else rlFLASHKUR = false end
if tLimbs.RL + ataxiaTables.limbData.shikDart &gt;=  100 and not tAffs.damagedrightleg then  rlDAR = true else rlDAR = false end
if tLimbs.LL + ataxiaTables.limbData.shikDart &gt;=  100 and not tAffs.damagedleftleg then llDAR = true else llDAR = false end




if tLimbs.H + ataxiaTables.limbData.shikNervestrike &gt;=  100 then  hNERV = true else hNERV = false end
if tLimbs.H + ataxiaTables.limbData.shikSpinkickHead &gt;=  100 then  hSPIN = true else hSPIN = false end
if tLimbs.H + ataxiaTables.limbData.shikRisingkick &gt;=  100 then  hRIS = true else hRIS = false end
if tLimbs.H + ataxiaTables.limbData.shikHiru &gt;=  100 then  hHIRU = true else hHIRU = false end
if tLimbs.H + ataxiaTables.limbData.shikHiraku &gt;=  100 then  hHIRA = true  else hHIRA = false end
if tLimbs.H + ataxiaTables.limbData.shikNeedle &gt;=  100 then  hNEED = true  else hNEED = false end
if tLimbs.H + ataxiaTables.limbData.shikNervestrike + ataxiaTables.limbData.shikRisingkick &gt;=  100 then  hNERVRIS = true else hNERVRIS = false end
if tLimbs.H + ataxiaTables.limbData.shikHiru + ataxiaTables.limbData.shikHiraku &gt;= 100 then hHIHI = true else hHIHI = false end
if tLimbs.H + ataxiaTables.limbData.shikNeedle + ataxiaTables.limbData.shikNeedle &gt;=  100 then  hNEED2 = true else hNEED2 = false end

 
if rlKUR and raRUK then rightprep = true else rightprep = false end
if llKUR and laRUK then leftprep = true else leftprep = false end


 
 
-- TYKONOS --
-- THRUST, SWEEP, RISINGKICK
-- WILLOW



if ataxia.vitals.form == "Tykonos" then
if

 not tAffs.prone then
 table.insert(shistick,"sweep")
 
 end


if not hRIS then shikick = "risingkick head"
else shikick = "risingkick torso" end
 



end

-- WILLOW --
-- DART, SWEEP, HIRU, FLASHHEEL, HIRAKU
-- RAIN



if ataxia.vitals.form == "Willow" then


if not llFLASH and not llKUR then
shikick = "flashheel left"
  elseif (llFLASH or llKUR) and not rlFLASH and not rlKUR then
  shikick = "flashheel right"
  end
  
  if not hHIHI then
  table.insert(shistick,"hiraku")
  table.insert(shistick,"hiru")
  end

if hHIHI and not laDAR and not laRUK then
  table.insert(shistick,"dart left arm")
  table.insert(shistick,"dart left arm")

 end

if hHIHI and not raDAR and not raRUK then
  table.insert(shistick,"dart right arm")
  table.insert(shistick,"dart right arm")

 end
 
if rlFLASH and llFLASH then
  table.insert(shistick,"sweep")

 end

end


 
 
  -- OAK --
-- LIVESTRIKE, NERVESTRIKE, RUKU, RISINGKICK, KURO
-- WILLOW GAITAL


if ataxia.vitals.form == "Oak" then


if (ataxiaTemp.parriedLimb ~= "head" or ataxiaTemp.hyperLimb == "head") and not hNERV then
      table.insert(shistick,"nervestrike")
end

if (ataxiaTemp.parriedLimb ~= "head" or ataxiaTemp.hyperLimb == "head") and not hNERVRIS then
    shikick = "risingkick head"
end

if hNERVRIS or (ataxiaTemp.parriedLimb == "head" and ataxiaTemp.hyperLimb ~= "head") then 
    shikick = "risingkick torso"
end


if not tAffs.asthma then
      table.insert(shistick,"livestrike")
end

if laRUK and raRUK and not tAffs.slickness and (tAffs.paralysis or shistick[1] == "nervestrike") then
        table.insert(shistick,"ruku torso")
end


if not llKUR then

       table.insert(shistick,"kuro left")

end

if  not rlKUR then 

  table.insert(shistick,"kuro right")
      
end


if not laRUK then
       table.insert(shistick,"ruku left")
end

if not raRUK then
       table.insert(shistick,"ruku right")
end


end
 
-- RAIN --
-- RUKU, KURO, HIRU, FRONTKICK
-- TYKONOS OAK



 if ataxia.vitals.form == "Rain" then
 

if  not laFRO then
  shikick = "frontkick left"
  elseif laFRO and not raFRO then
shikick = "frontkick right" 
else shikick = "none" end
 

if laRUK and raRUK and not tAffs.slickness then
        table.insert(shistick,"ruku torso")
end


if not leftprep and not llKUR then

       table.insert(shistick,"kuro left")
       table.insert(shistick,"ruku left")

end

if not leftprep and  llKUR and not laRUK then

       table.insert(shistick,"ruku left")
       table.insert(shistick,"ruku left")

end

if not rightprep and not rlKUR then 

  table.insert(shistick,"kuro right")
         table.insert(shistick,"ruku right")
end

if not rightprep and rlKUR and not raRUK then 

  table.insert(shistick,"ruku right")
         table.insert(shistick,"ruku right")
end



 if not hHIRU then
         table.insert(shistick,"hiru")
      
 end
end

if raRUK or laRUK and hHIRU then
        table.insert(shistick,"ruku torso")
end

-- GAITAL --
-- NEEDLE, SPINKICK, SWEEP, RUKU, FLASHHEEL, KURO
-- RAIN MAELSTROM


if ataxia.vitals.form == "Gaital" then

if tAffs.prone and llFLASH and hNEED and tLimbs.H &lt; 100
then

shikick = "flashheel left"
  table.insert(shistick,"ruku left")
  table.insert(shistick,"needle")

end

if not hNEED2 and rlFLASH and llFLASH and raRUK and laRUK then
  table.insert(shistick,"needle")
   table.insert(shistick,"needle")
shikick = "spinkick"
 end

if hNEED2 and not hNEED and rlFLASH and llFLASH and raRUK and laRUK then
  table.insert(shistick,"needle")
   table.insert(shistick,"ruku torso")
shikick = "spinkick"
 end

if  tAffs.prone and not tAffs.crushedthroat and tLimbs.H &gt;= 100 then
  table.insert(shistick,"needle")
   table.insert(shistick,"ruku right")
    table.insert(shistick,"ruku right")
shikick = "spinkick"
 end
 

if tAffs.prone and tAffs.damagedhead and not tAffs.crushedthroat then

  table.insert(shistick,"needle")
 end
 
 if not tAffs.prone and rlFLASH and llKUR and hNEED then
table.insert(shistick,"sweep")

shikick = "flashheel right"

end








if   not llFLASH and not tAffs.prone  then

shikick = "flashheel left"
end

if not rlFLASH and llFLASH and not tAffs.prone  then

shikick = "flashheel right"
end

--if rlFLASH and shistick[1] ~= "sweep" and llFLASH then
--shikick = "spinkick"
--end



if not rlKUR and not tAffs.prone and shikick ~= "flashheel right" then 
       table.insert(shistick,"kuro right")

  end
  
if not raRUK  and not tAffs.prone then

       table.insert(shistick,"ruku right")
end
  
  if not llKUR and not tAffs.prone and shikick ~= "flashheel left" then 
       table.insert(shistick,"kuro left")

  end
if not laRUK  and not tAffs.prone then

       table.insert(shistick,"ruku left")
end

if not hNEED and (rlKUR or llKUR) then
       table.insert(shistick,"needle")
end





if  laRUK and tAffs.prone then

       table.insert(shistick,"ruku left")
end



if raRUK and tAffs.prone and tAffs.mangledhead then

       table.insert(shistick,"ruku right")
end

if laRUK and raRUK and not tAffs.slickness and not tAffs.prone and shistick[1] ~= "sweep" then
        table.insert(shistick,"ruku torso")
end

--if
 --not tAffs.prone and not rlFLASH and not  llKUR and not hNEED then
 --shikick = "spinkick"

--end


 
-- if (tAffs.brokenrightleg or tAffs.brokenleftleg) and not tAffs.prone then
 -- table.insert(shistick,"sweep")
 -- end



 


end



-- MAELSTROM --
-- RUKU, RISINGKICK, SWEEP, CRESCENT, LIVESTRIKE, JINZUKU
-- OAK


if ataxia.vitals.form == "Maelstrom" then


if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 then
  table.insert(shistick,"sweep")

 shikick = "crescent"
 end
end

dispatch_base_attack()

end

</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>DISPTACH PRIOS</name>
											<packageName></packageName>
											<script>
  function dispatch_base_priosGROUP()
  
  
preplimb = preplimb or "right leg"
shistick = {}

if tAffs.prone or tAffs.paralysis then ataxiaTemp.parriedLimb = "none" end


 
 
-- TYKONOS --
-- THRUST, SWEEP, RISINGKICK
-- WILLOW



if ataxia.vitals.form == "Tykonos" then

 table.insert(shistick,"sweep")
 shikick = "risingkick head"
 end






-- WILLOW --
-- DART, SWEEP, HIRU, FLASHHEEL, HIRAKU
-- RAIN



if ataxia.vitals.form == "Willow" then



shikick = "flashheel left"


 
  table.insert(shistick,"hiraku")
  table.insert(shistick,"hiru")
 



end
 
 
  -- OAK --
-- LIVESTRIKE, NERVESTRIKE, RUKU, RISINGKICK, KURO
-- WILLOW GAITAL


if ataxia.vitals.form == "Oak" then

    shikick = "risingkick torso"


if (ataxiaTemp.parriedLimb ~= "head" or ataxiaTemp.hyperLimb == "head") then
      table.insert(shistick,"nervestrike")
end




if not tAffs.asthma then
      table.insert(shistick,"livestrike")
end

if not tAffs.slickness and (tAffs.paralysis or shistick[1] == "nervestrike") then
        table.insert(shistick,"ruku torso")
end


if tAffs.slickness and tAffs.asthma then

       table.insert(shistick,"kuro left")
       table.insert(shistick,"kuro left")

end

if  tAffs.weariness and tAffs.lethargy then 

  table.insert(shistick,"ruku left")
    table.insert(shistick,"ruku left")
      
end


 end
-- RAIN --
-- RUKU, KURO, HIRU, FRONTKICK
-- TYKONOS OAK



 if ataxia.vitals.form == "Rain" then
 

if  (ataxiaTemp.parriedLimb ~= "left arm" or ataxiaTemp.hyperLimb == "left arm") then
  shikick = "frontkick left"
  end
if (ataxiaTemp.parriedLimb == "left arm" or ataxiaTemp.hyperLimb ~= "left arm") then
shikick = "frontkick right" 
 end
 



if tAffs.asthma and not tAffs.weariness and not tAffs.slickness then

       table.insert(shistick,"kuro left")
        table.insert(shistick,"ruku torso")

end

if not tAffs.weariness and not tAffs.lethargy then

       table.insert(shistick,"kuro left")
       table.insert(shistick,"kuro left")

end

if  tAffs.weariness and tAffs.lethargy then


  table.insert(shistick,"ruku left")
         table.insert(shistick,"ruku right")
end


   
end


dispatch_base_attackGROUP()


end

</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>DISPATCH</name>
											<packageName></packageName>
											<script>function dispatch_base_attack()

formswapdispatch()
local xmute = math.ceil(ataxia.vitals.maxhp * 0.80)
	local mpl = (ataxia.vitals.mp - (ataxia.vitals.maxmp * 0.30))
	local hpl = (xmute - ataxia.vitals.hp)
	local tomute = 0

	if hpl &gt; 1 then
		tomute = (hpl &lt; mpl and hpl or mpl)
		if tomute &gt; 100 then
			command = command.."transmute "..tomute..ataxia.settings.separator
		end
	end

local atk = combatQueue()
   
if tAffs.shield then shistick[1] = "shatter"

end

 if tAffs.prone and tLimbs.H &gt;= 100 and tAffs.crushedthroat then
shikick = "dispatch"
end



  if (shistick[1] == "sweep" or shistick[2] == "sweep" or shistick[1] == "shatter") then
  
  atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." sweep "..shikick
 
elseif

 llKUR and rlKUR and hNEED and ataxia.vitals.form ~= "Gaital" then
atk = atk.."adopt gaital form"

elseif
shikick == "dispatch" then
  
  atk = atk.."wield staff489282;dismount;assess "..target..";incapacitate "..target.." "..form[1]

elseif shikick == "none" then

  atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." "..shistick[1].." "..shistick[2]

elseif ataxia.vitals.form == "Oak" and raRUK and laRUK and rlKUR and llKUR then

  atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." "..shikick.." "..shistick[1]
  
elseif ataxia.vitals.form == "Gaital" and rlKUR and llKUR and not hNEED then

  atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." "..shikick.." "..shistick[1]

 else

atk = atk.."wield staff489282;dismount;assess "..target..";combo "..target.." "..shikick.." "..shistick[1].." "..shistick[2]
 
end
 
if ataxia.vitals.form ~= form[1] then

send("cq all;transition to the "..form[1].." form")


elseif table.contains(ataxia.playersHere, target) then

if not ataxia.settings.paused and not ataxia_needLockBreak() and not ataxia.afflictions.stupidity then


send("queue addclear free "..atk)



end
end
end</script>
											<eventHandlerList />
										</Script>
										<ScriptGroup isActive="yes" isFolder="yes">
											<name>TELEPATHY</name>
											<packageName></packageName>
											<script></script>
											<eventHandlerList />
											<Script isActive="yes" isFolder="no">
												<name>DISRUPT</name>
												<packageName></packageName>
												<script>function disruptmind()

local atk = combatQueue()


if not tAffs.blackout then 
  atk = atk.."mind blackout"
elseif tAffs.blackout and not tAffs.confusion then
  atk = atk.."mind confuse"
  elseif tAffs.confusion and not tAffs.disrupted then
  atk = atk.."mind disrupt"
elseif tAffs.confusion and tAffs.disrupted and not tAffs.impatience then
  atk = atk.."mind impatience"
  end
  




if not ataxia.settings.paused and not ataxia_needLockBreak() and not ataxia.afflictions.stupidity then


send("queue addclear free "..atk)

end
end</script>
												<eventHandlerList />
											</Script>
										</ScriptGroup>
									</ScriptGroup>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>EARTH LORD</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>HEAD PATH</name>
										<packageName></packageName>
										<script>function headpath()
 limbtable() 
local atk = combatQueue()

if tAffs.shield == true then

atk = atk.."terran magnet rise;wield shield;terran crunch "..target

elseif ataxia.vitals.shaping

and tLimbs.H &gt;= 100 and tAffs.prone then


atk = atk.."terran magnet rise;wield shield;assess "..target..";manifest avalanche"


elseif ataxia.vitals.shaping == 4


and tLimbs.RL &gt;= 80
and tLimbs.LL &gt;= 80
and tLimbs.H &lt; 63 then


targetlimb = "head"


atk = atk.."terran magnet rise;wield shield;assess "..target..";manifest quake;terran powderise "..target.." "..targetlimb


elseif ataxia.vitals.shaping &lt; 4


and tLimbs.RL &gt;= 80
and tLimbs.LL &gt;= 80
and tLimbs.H &lt; 63 then

if ataxiaTemp.parriedLimb == "head" then
targetlimb = mytable[math.random(#mytable)]
else 
targetlimb = "head"
end

atk = atk.."terran magnet rise;wield shield;assess "..target..";terran powderise "..target.." "..targetlimb




elseif ataxia.vitals.shaping == 4 and not tAffs.prone


and tLimbs.RL &gt;= 80 and tLimbs.RL &lt; 100
and tLimbs.LL &gt;= 80 and tLimbs.LL &lt; 100
and tLimbs.H &gt; 63 and tLimbs.H &lt; 100 then

if ataxiaTemp.parriedLimb == "right leg" then
targetlimb = "left leg"
else 
targetlimb = "right leg"
end


atk = atk.."terran magnet rise;wield shield;assess "..target..";manifest quake;terran powderise "..target.." "..targetlimb



elseif ataxia.vitals.shaping


and tLimbs.RL &gt;= 100
and tLimbs.LL &lt; 84
and tLimbs.H &gt;= 63 then

if ataxiaTemp.parriedLimb == "left leg" and not tAffs.prone then
targetlimb = mytable[math.random(#mytable)]
else 
targetlimb = "left leg"
end

atk = atk.."terran magnet rise;wield shield;assess "..target..";terran powderise "..target.." "..targetlimb


elseif ataxia.vitals.shaping == 4



and tLimbs.LL &gt;= 100
and tLimbs.H &gt;= 63 then
if ataxiaTemp.parriedLimb == "right leg" and not tAffs.prone then
targetlimb = mytable[math.random(#mytable)]
else 
targetlimb = "head"
end

atk = atk.."terran magnet rise;wield shield;assess "..target..";terran calcify "..target.." head;terran powderise "..target.." "..targetlimb




elseif ataxia.vitals.shaping == 4


and (tLimbs.RL &gt; 84 or tLimbs.LL &gt; 84)
and tLimbs.H &gt;= 63 then

if ataxiaTemp.parriedLimb == "head" then
targetlimb = mytable[math.random(#mytable)]
else 
targetlimb = "head"
end

atk = atk.."terran magnet rise;wield shield;assess "..target..";terran calcify "..target.." head;terran powderise "..target.." "..targetlimb







end

send("terran magnet rise;queue addclear free "..atk)
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>TORSO PATH</name>
										<packageName></packageName>
										<script>function torsopath()
 limbtable() 
local atk = combatQueue()

if tAffs.shield == true then

atk = atk.."terran magnet rise;wield shield;terran crunch "..target


elseif shape == 4
and tLimbs.T &gt;= 100
 then

targetlimb = "torso"


atk = atk.."terran magnet rise;wield shield;assess "..target..";terran calcify "..target.." torso;terran squeeze "..target


elseif shape == 4 and tLimbs.T == 63 then
targetlimb = "torso"


atk = atk.."terran magnet rise;wield shield;assess "..target..";terran calcify "..target.." torso;terran powderise "..target.." "..targetlimb

elseif shape == 4 and tLimbs.T == 84 then
targetlimb = "torso"


atk = atk.."terran magnet rise;wield shield;assess "..target..";terran calcify "..target.." torso;terran powderise "..target.." "..targetlimb

elseif tLimbs.T == 84 and shape &lt; 4 then

if ataxiaTemp.parriedLimb == "right arm" then
targetlimb = "left arm"
else 
targetlimb = "right arm"
end

atk = atk.."terran magnet rise;wield shield;assess "..target..";terran powderise "..target.." "..targetlimb



elseif tLimbs.T &gt;= 100 and shape &lt; 4 then

if ataxiaTemp.parriedLimb == "right arm" then
targetlimb = "left arm"
else 
targetlimb = "right arm"
end

atk = atk.."terran magnet rise;wield shield;assess "..target..";terran powderise "..target.." "..targetlimb


 elseif shape == 4



and tLimbs.T &lt; 200 then


atk = atk.."terran magnet rise;wield shield;assess "..target..";manifest quake;terran powderise "..target.." "..targetlimb



elseif shape &lt; 4



and tLimbs.T &lt; 200 then


targetlimb = "torso"


atk = atk.."terran magnet rise;wield shield;assess "..target..";terran powderise "..target.." "..targetlimb






end

send("terran magnet rise;queue addclear free "..atk)
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>RIGHT SIDE</name>
										<packageName></packageName>
										<script>function rightside()
local atk = combatQueue()

if tAffs.shield == true then

atk = atk.."terran magnet rise;wield shield;terran crunch "..target



elseif ataxia.vitals.shaping == 4 and tLimbs.RL &lt; 100
 then
 targetlimb = "right leg"
atk = atk.."terran magnet rise;wield shield;assess "..target..";manifest quake;terran powderise "..target.." "..targetlimb


elseif ataxia.vitals.shaping &lt; 4 and tLimbs.RL &lt; 100 then
targetlimb = "right leg"

atk = atk.."terran magnet rise;wield shield;assess "..target..";terran powderise "..target.." "..targetlimb



end

send("terran magnet rise;queue addclear free "..atk)
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>LEFT SIDE</name>
										<packageName></packageName>
										<script>function leftside()
local atk = combatQueue()

if tAffs.shield == true then

atk = atk.."terran magnet rise;wield shield;terran crunch "..target



elseif ataxia.vitals.shaping == 4 and tLimbs.LL &lt; 100
 then
 targetlimb = "left leg"
atk = atk.."terran magnet rise;wield shield;assess "..target..";manifest quake;terran powderise "..target.." "..targetlimb


elseif ataxia.vitals.shaping &lt; 4 and tLimbs.LL &lt; 100 then
targetlimb = "left leg"

atk = atk.."terran magnet rise;wield shield;assess "..target..";terran powderise "..target.." "..targetlimb



end

send("terran magnet rise;queue addclear free "..atk)
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>LIMB HEAD</name>
										<packageName></packageName>
										<script>function limbtable()        
         
            mytable = {"right arm", "left arm", "torso"} 



end</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>APOSTATE</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>CLUMSY PRIOS</name>
										<packageName></packageName>
										<script>function apostate_clumsy()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
curses = {}


ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


 if tAffs.curseward  then

    table.insert(curses,"breach")
end

if ataxiaTemp.tarTumble then
 table.insert(curses,"cowardice")
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end

if tAffs.slickness and not tAffs.anorexia and (tAffs.impatience or curses[2] == "impatience") and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if tAffs.manaleech and not tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and tAffs.impatience and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if  tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and not tAffs.impatience and curses[1] ~= "breach" and not tBals.tree then
    table.insert(curses,"anorexia")
    table.insert(curses,"impatience")
end






if maretick and maretick == true and not tAffs.hellsight and tAffs.hypersomnia and not tAffs.dementia and not tAffs.asthma and tAffs.impatience then
   table.insert(curses,"dementia")
end



if tAffs.asthma and tAffs.impatience and not tAffs.slickness then
   table.insert(curses,"sicken")
end



if not tAffs.paralysis then
    table.insert(curses,"paralysis")
end

if tAffs.deafness then
    table.insert(curses,"sensitivity")
end

if not tAffs.clumsiness  then
    table.insert(curses,"clumsy")
end



if not tAffs.impatience  then
    table.insert(curses,"impatience")
end

if tAffs.impatience and not tAffs.stupidity and not tAffs.asthma then
    table.insert(curses,"stupid")
end



if not tAffs.asthma then
    table.insert(curses,"asthma")
       table.insert(curses,"sicken")
end




if not tAffs.weariness  then
    table.insert(curses,"weariness")
end








if tAffs.deafness and ataxiaNDB_getClass(target) ~= "Blademaster" and ataxiaNDB_getClass(target) ~= "Monk" then
 table.insert(curses,"sensitivity")
end




if  getLockingAffliction() ~= "plague" and getLockingAffliction() ~= "stupid" and getLockingAffliction() ~= "reckless" and getLockingAffliction() ~= "paralyse" and getLockingAffliction() ~= "haemophilia" and
 not tAffs[getLockingAffliction()] 
then    table.insert(curses,getLockingAffliction())
end





if tAffs.impatience and not tAffs.dizziness then
    table.insert(curses,"dizzy")
end




if not tAffs.nausea  then
    table.insert(curses,"vomiting")
end





if not tAffs.addiction then
    table.insert(curses,"addiction")
end









if not tAffs.confusion  then
    table.insert(curses,"confusion")
end







if not tAffs.epilepsy  then
    table.insert(curses,"epilepsy")
end



if not tAffs.dementia  then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo then
    table.insert(curses,"vertigo")
end



if not tAffs.dizziness  then
    table.insert(curses,"dizzy")
end



if not tAffs.recklessness  then
table.insert(curses,"reckless")
end

if not tAffs.masochism  then
    table.insert(curses,"masochism")
end

















apostate_lockattack()
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>CORRUPT ATTACK 2</name>
										<packageName></packageName>
										<script>function apostate_lock()
local atk = combatQueue()
corruptDmg()
demon()
daeggerhunt = daeggerhunt or false
handshere = handshere or false
freshblood = freshblood or false
if not pm then pm = 100 end
fiendthing = fiendthing or "nightmare"
partyrelay = partyrelay or true
clumsycurse = curses[1]


curse1 = curses[1]
curse2 = curses[2]


if curse1 == "paralysis" then
curse2 = "paralysis"
curse1 = curses[2]
end

if not tBals.tree and tAffs.manaleech and 
curse1 == "sicken" and curse2 == "paralysis" then
curse2 = curses[3]
end

daeggerhere = daeggerhere or false

if pm and pm &lt; 50 then 
need_catharsis = true else
need_catharsis = false
end

if pm and pm &gt; 50 and daeggerhere == false then 
pretattack =  "summon daegger;wield daegger shield;"
pre = true
else  pre = false
end

if curses[1] == "sleep" and curses[2] == "sleep" then
pretattack =  "summon daegger;wield daegger shield;"
 pre4 = true
else  pre4 = false
end


if tAffs.prone and daeggerhere == false then
pretattack =  "summon daegger;wield daegger shield;"
 pre2 = true
else  pre2 = false
end



if bloodworm() == false and freshblood then
postattack =  ";summon bloodworms"
 post1 = true
else  post1 = false
end

if daeggerhunt == false and not tAffs.prone and daeggerhere == true then
postattack =  ";wield daegger shield;daegger levitate;daegger hunt "..target
 post = true
else  post = false
end

if daeggerhunt == false and not tAffs.prone and daeggerhere == false and curses[1] ~= "sleep" and curses[2] ~= "sleep" then
postattack =  ";summon daegger;wield daegger shield;daegger levitate;daegger hunt "..target
 post2 = true
else  post2 = false
end

if (need_catharsis or currupted) and tAffs.shield then
shield_strip = true
else
shield_strip = false
end




if freshblood and not apopentagram() then
  
preattack =  "summon daegger;wield daegger shield;demon bloodpact "..target.." for "..fiendthing..";order "..fiendthing.." kill "..target..";"
 pre3 = true
 else pre3 = false 
 end

if apopentagram() and demon() ~= fiendthing and daeggerhunt then
postattack =  ";summon daegger;wield daegger shield;dispel pentagram;summon "..fiendthing
 post3 = true
else post3 = false
end


if tAffs.asthma and (curses[1] == "sicken" or curses[2] == "sicken") and not tAffs.disloyalty then
postattack =  ";disfigure "..target
 post4 = true
else post4 = false
end




if pm and pm &lt;= 60  and pm &lt; 50 then 
need_sap = true else
need_sap = false
end

  if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= corruptDmg() then
 need_corrupt = true else
 need_corrupt = false
end

  if pm - corruptDmg() &lt;= 15 and not tAffs.anorexia and not tAffs.slickness then
 need_corrupt_cath = true else
 need_corrupt_cath = false
  end




if shield_strip then

atk = atk.."wield shield;demon strip "..target..";assess "..target


elseif need_catharsis and not shield_strip then 

atk = atk.."wield shield;demon catharsis "..target..";assess "..target

elseif need_corrupt then

atk = atk.."wield shield;demon corrupt "..target.." paralysis;assess "..target

elseif not corrupted and need_corrupt_cath  then

atk = atk.."wield shield;demon corrupt "..target.." paralysis;assess "..target

elseif corrupted and not tAffs.shield then

atk = atk.."wield shield;demon catharsis "..target..";assess "..target

    
    
 
elseif (daeggerhunt == false or (bloodworm() == false and freshblood)) then

atk = atk.."wield shield;deadeyes "..target.." "..curse1.." "..curse2..";assess "..target

elseif curse1 == "sicken" or curse2 == "sicken" and not tAffs.disloyalty then

atk = atk.."wield shield;deadeyes "..target.." "..curse1.." "..curse2..";assess "..target

 
else

atk = atk.."wield shield;deadeyes "..target.." "..curse1.." "..curse2..";assess "..target..";contemplate "..target
 

end

if table.contains(ataxia.playersHere, target) then

if baalzadeen() == false then

send("queue prepend free summon baalzadeen")

end

if (post1 or post or post2 or post3 or post4) then
send("queue addclear free "..atk..""..postattack)

elseif (pre or pre2 or pre3) then
send("queue addclear free "..preattack..""..atk)




else

send("queue addclear free "..atk)


end
end
end

function apostate_lockImpale()
local atk = combatQueue()
corruptDmg()
demon()
daeggerhunt = daeggerhunt or false
handshere = handshere or false
freshblood = freshblood or false
if not pm then pm = 100 end
fiendthing = fiendthing or "nightmare"
partyrelay = partyrelay or true

daeggerhere = daeggerhere or false

if pm and pm &lt; 50 then 
need_catharsis = true else
need_catharsis = false
end

if pm and pm &lt; 50 and daeggerhere == false then 
pretattack =  "summon daegger;wield daegger shield;"
pre = true
else  pre = false
end

if curses[1] == "sleep" and curses[2] == "sleep" then
pretattack =  "summon daegger;wield daegger shield;"
 pre4 = true
else  pre4 = false
end


if tAffs.prone and daeggerhere == false then
pretattack =  "summon daegger;wield daegger shield;"
 pre2 = true
else  pre2 = false
end



if bloodworm() == false and freshblood then
postattack =  ";summon bloodworms"
 post1 = true
else  post1 = false
end

if daeggerhunt == false and not tAffs.prone and daeggerhere == true and not apopentagram() then
postattack =  ";wield daegger shield;daegger levitate;daegger hunt "..target
 post = true
else  post = false
end

if daeggerhunt == false and not tAffs.prone and daeggerhere == false and curses[1] ~= "sleep" and curses[2] ~= "sleep" and not apopentagram() then
postattack =  ";summon daegger;wield daegger shield;daegger levitate;daegger hunt "..target
 post2 = true
else  post2 = false
end

if (need_catharsis or currupted) and tAffs.shield then
shield_strip = true
else
shield_strip = false
end

if apopentagram() and not tAffs.impaled then
postattack = ";summon daegger;wield daegger;daegger levitate;daegger shadowstrike "..target
post5 = true
else
post5 = false
end


if freshblood and not apopentagram() then
  
preattack =  "summon daegger;wield daegger shield;demon bloodpact "..target.." for "..fiendthing..";order "..fiendthing.." kill "..target..";"
 pre3 = true
 else pre3 = false 
 end

if apopentagram() and demon() ~= fiendthing and daeggerhunt then
postattack =  ";summon daegger;wield daegger shield;dispel pentagram;summon "..fiendthing
 post3 = true
else post3 = false
end


if tAffs.asthma and (curses[1] == "sicken" or curses[2] == "sicken") and tAffs.manaleech and not tAffs.disloyalty then
postattack =  ";disfigure "..target
 post4 = true
else post4 = false
end




if pm and pm &lt;= 60  and pm &gt; 50 then 
need_sap = true else
need_sap = false
end

  if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= corruptDmg() then
 need_corrupt = true else
 need_corrupt = false
end

  if pm - corruptDmg() &lt;= 15 and not tAffs.anorexia and not tAffs.slickness then
 need_corrupt_cath = true else
 need_corrupt_cath = false
  end




if shield_strip then

atk = atk.."wield shield;demon strip "..target..";assess "..target


elseif need_catharsis and not shield_strip then 

atk = atk.."wield shield;demon catharsis "..target..";assess "..target

elseif need_corrupt then

atk = atk.."wield shield;demon corrupt "..target.." paralysis;assess "..target

elseif not corrupted and need_corrupt_cath  then

atk = atk.."wield shield;demon corrupt "..target.." paralysis;assess "..target

elseif corrupted and not tAffs.shield then

atk = atk.."wield shield;demon catharsis "..target..";assess "..target

    
    

 elseif (daeggerhunt == false or (bloodworm() == false and freshblood)) and curses[1] == "paralysis" and ataxia.afflictions.clumsiness then

atk = atk.."wield shield;deadeyes "..target.." "..curses[2].." "..curses[1]..";assess "..target

elseif curses[1] == "sicken" or curses[2] == "sicken" and not tAffs.disloyalty and curses[1] == "paralysis" and ataxia.afflictions.clumsiness then

atk = atk.."wield shield;deadeyes "..target.." "..curses[2].." "..curses[1]..";assess "..target   

 
elseif (daeggerhunt == false or (bloodworm() == false and freshblood)) then

atk = atk.."wield shield;deadeyes "..target.." "..curses[1].." "..curses[2]..";assess "..target

elseif curses[1] == "sicken" or curses[2] == "sicken" and not tAffs.disloyalty then

atk = atk.."wield shield;deadeyes "..target.." "..curses[1].." "..curses[2]..";assess "..target

elseif curses[1] == "paralysis" and ataxia.afflictions.clumsiness then

atk = atk.."wield shield;deadeyes "..target.." "..curses[2].." "..curses[1]..";assess "..target..";contemplate "..target
 

 
else

atk = atk.."wield shield;deadeyes "..target.." "..curses[1].." "..curses[2]..";assess "..target..";contemplate "..target
 

end

if table.contains(ataxia.playersHere, target) then

if baalzadeen() == false then

send("queue prepend free summon baalzadeen")

end

if (post1 or post or post2 or post3 or post4 or post5) and not (ataxia.afflictions.paralysis ) then
send("queue addclear free "..atk..""..postattack)

elseif (pre or pre2 or pre3) and not (ataxia.afflictions.paralysis) then
send("queue addclear free "..preattack..""..atk)




elseif not (ataxia.afflictions.aeon ) then

send("queue addclear free "..atk)


end
end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>VIVISECT</name>
										<packageName></packageName>
										<script>function apostate_vivisect()
local atk = combatQueue()
corruptDmg()
demon()


daeggerhunt = daeggerhunt or false
handshere = handshere or false
freshblood = freshblood or false
if not pm then pm = 100 end
fiendthing = fiendthing or "nightmare"



daeggerhere = daeggerhere or false


if tAffs.paralysis and tAffs.impatience and tAffs.slickness and tAffs.anorexia then truelock = true else truelock = false end



if pm and pm &lt; 45 then 
need_catharsis = true else
need_catharsis = false
end

if pm and pm &lt; 45 and daeggerhere == false then 
pretattack =  "summon daegger;wield daegger shield;"
pre = true
else  pre = false
end

if tAffs.prone and daeggerhere == false then
pretattack =  "summon daegger;wield daegger shield;"
 pre2 = true
else  pre2 = false
end

if bloodworm() == false and freshblood then
postattack =  ";summon bloodworms"
 post1 = true
else  post1 = false
end

if daeggerhunt == false and not tAffs.prone and daeggerhere == true then
postattack =  ";wield daegger shield;daegger levitate;daegger hunt "..target
 post = true
else  post = false
end

if daeggerhunt == false and not tAffs.prone and daeggerhere == false then
postattack =  ";summon daegger;wield daegger shield;daegger levitate;daegger hunt "..target
 post2 = true
else  post2 = false
end




if freshblood and not apopentagram() then
  
preattack =  "summon daegger;wield daegger shield;demon bloodpact "..target.." for "..fiendthing..";order "..fiendthing.." kill "..target..";"
 pre3 = true
 else pre3 = false 
 end

if apopentagram() and demon() ~= fiendthing and daeggerhunt then
postattack =  ";summon daegger;wield daegger shield;dispel pentagram;summon "..fiendthing
 post3 = true
else post3 = false
end



if pm and pm &lt;= 60  and pm &gt; 50 then 
need_sap = true else
need_sap = false
end

  if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= corruptDmg() then
 need_corrupt = true else
 need_corrupt = false
end

  if pm - corruptDmg() &lt;= 15 and not tAffs.anorexia and not tAffs.slickness then
 need_corrupt_cath = true else
 need_corrupt_cath = false
  end


if truelock and tAffs.prone and not tAffs.brokenrightarm and not tAffs.brokenleftarm and not tAffs.brokenrightleg and not tAffs.brokenleftleg then
shrivel_ra = true
else shrivel_ra = false
end

if truelock and tAffs.prone and tAffs.brokenrightarm and not tAffs.brokenleftarm and not tAffs.brokenrightleg and not tAffs.brokenleftleg then
shrivel_la = true
else shrivel_la = false
end

if truelock and tAffs.prone and tAffs.brokenrightarm and tAffs.brokenleftarm and not tAffs.brokenrightleg and not tAffs.brokenleftleg then
shrivel_rl = true
else shrivel_rl = false
end

if truelock and tAffs.prone and tAffs.brokenrightarm and  tAffs.brokenleftarm and tAffs.brokenrightleg and not tAffs.brokenleftleg then
shrivel_ll = true
else shrivel_ll = false
end

if truelock and tAffs.prone then need_trample = true else need_trample = false end

if tAffs.brokenrightarm and tAffs.brokenleftarm and tAffs.brokenrightleg and tAffs.brokenleftleg then
need_vivisect = true
else need_vivisect = false
end



if need_vivisect then

atk = atk.."wield shield;dismount;vivisect "..target..";assess "..target


elseif need_catharsis then 

atk = atk.."summon daegger;wield shield daegger;demon catharsis "..target..";assess "..target




elseif corrupted  then

atk = atk.."wield shield;demon catharsis "..target..";assess "..target

elseif need_trample then

atk = atk.."wield shield;trample;assess "..target


elseif shrivel_la then
  
  atk = atk.."wield shield;dismount;shrivel left arm "..target..";assess "..target

elseif shrivel_ra then
  
  atk = atk.."wield shield;dismount;shrivel right arm "..target..";assess "..target

    elseif shrivel_rl then
  
  atk = atk.."wield shield;dismount;shrivel right leg "..target..";assess "..target

 
 elseif shrivel_ll then
  
  atk = atk.."wield shield;dismount;shrivel left leg "..target..";assess "..target

   

    

elseif (daeggerhunt == false or (bloodworm() == false and freshblood)) then

atk = atk.."wield shield;deadeyes "..target.." "..curses[1].." "..curses[2]..";assess "..target
 
else

atk = atk.."wield shield;deadeyes "..target.." "..curses[1].." "..curses[2]..";assess "..target..";contemplate "..target
 

end


if baalzadeen() == false then

send("queue prepend free summon baalzadeen")

end


if (post1 or post or post2 or post3)  then
send("queue addclear free "..atk..""..postattack)

elseif (pre or pre2 or pre3) and not (ataxia.afflictions.paralysis ) then
send("queue addclear free "..preattack..""..atk)




elseif not (ataxia.afflictions.paralysis ) then


send("queue addclear free "..atk)

end
end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>VIVI PRIOS</name>
										<packageName></packageName>
										<script>function apostate_viviprio()
getLockingAffliction()
checkTargetLocks()

curses = {}


ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


 if tAffs.curseward  then

    table.insert(curses,"breach")
end

if ataxiaTemp.tarTumble then
 table.insert(curses,"cowardice")
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end

if truelock and not tAffs.prone then
    table.insert(curses,"sleep")
        table.insert(curses,"sleep")
end

if tAffs.slickness and not tAffs.anorexia and (tAffs.impatience or curses[2] == "impatience") and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if tAffs.manaleech and not tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and tAffs.impatience and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if tAffs.manaleech and tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and not tAffs.impatience and curses[1] ~= "breach" and not tBals.tree then
    table.insert(curses,"anorexia")
    table.insert(curses,"impatience")
end



if  tAffs.asthma and not tAffs.manaleech then
   table.insert(curses,"sicken")
end

if tAffs.asthma and tAffs.manaleech and not tAffs.slickness then
   table.insert(curses,"sicken")
end

if not tAffs.impatience and tAffs.slickness and (curses[1] == "anorexia" or curses[2] == "anorexia") then
    table.insert(curses,"impatience")
end

if not tAffs.paralysis then
    table.insert(curses,"paralysis")
end

if not tAffs.impatience then
    table.insert(curses,"impatience")
end

if not tAffs.weariness  then
    table.insert(curses,"weariness")
end



if not tAffs.asthma then
    table.insert(curses,"asthma")
end







if tAffs.impatience and not tAffs.stupidity  then
    table.insert(curses,"stupid")
end




if  getLockingAffliction() ~= "plague" and getLockingAffliction() ~= "stupid" and getLockingAffliction() ~= "reckless" and getLockingAffliction() ~= "paralyse" and getLockingAffliction() ~= "haemophilia" and
 not tAffs[getLockingAffliction()] 
then    table.insert(curses,getLockingAffliction())
end


if not tAffs.weariness  then
    table.insert(curses,"weariness")
end

if not tAffs.clumsiness then
    table.insert(curses,"clumsy")
end


if not tAffs.sensitivity then
    table.insert(curses,"sensitivity")
     table.insert(curses,"sensitivity")
end









if not tAffs.nausea  then
    table.insert(curses,"vomiting")
end


if not tAffs.addiction then
    table.insert(curses,"addiction")
end









if not tAffs.confusion  then
    table.insert(curses,"confusion")
end







if not tAffs.epilepsy  then
    table.insert(curses,"epilepsy")
end



if not tAffs.dementia  then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo then
    table.insert(curses,"vertigo")
end



if not tAffs.dizziness  then
    table.insert(curses,"dizzy")
end



if not tAffs.recklessness  then
table.insert(curses,"reckless")
end

if not tAffs.masochism  then
    table.insert(curses,"masochism")
end




















apostate_vivisect()
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>MENTAL PRIOS</name>
										<packageName></packageName>
										<script>function apostate_mental()
getLockingAffliction()
checkTargetLocks()

curses = {}


ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


 if tAffs.curseward  then

    table.insert(curses,"breach")
end

if ataxiaTemp.tarTumble then
 table.insert(curses,"cowardice")
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end



if tAffs.slickness and not tAffs.anorexia and (tAffs.impatience or curses[2] == "impatience") and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if tAffs.manaleech and not tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and tAffs.impatience and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if  tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and not tAffs.impatience and curses[1] ~= "breach" and not tBals.tree then
    table.insert(curses,"anorexia")
    table.insert(curses,"impatience")
end



if not tAffs.prone and tAffs.deafness and tAffs.paralysis and bloodworm() == true and ataxiaNDB_getClass(target) ~= "Blademaster" and ataxiaNDB_getClass(target) ~= "Monk" then
 table.insert(curses,"sensitivity")
end


if maretick and maretick == true and not tAffs.hellsight and tAffs.hypersomnia and not tAffs.dementia and tAffs.asthma and tAffs.impatience then
   table.insert(curses,"dementia")
end




if tAffs.asthma and not tAffs.slickness then
   table.insert(curses,"sicken")
end



if not tAffs.paralysis then
    table.insert(curses,"paralysis")
end

if tAffs.deafness then
    table.insert(curses,"sensitivity")
end


if tAffs.impatience and not tAffs.stupidity  then
    table.insert(curses,"stupid")
end






if not tAffs.impatience  then
    table.insert(curses,"impatience")
end


if table.contains(gmcp.Room.Info.details, "indoors") and not tAffs.agoraphobia then
  table.insert(curses,"agoraphobia")
end


if not tAffs.confusion  then
    table.insert(curses,"confusion")
end

if not tAffs.recklessness  then
table.insert(curses,"reckless")
end



if not tAffs.vertigo then
    table.insert(curses,"vertigo")
end


if not tAffs.dizziness  then
    table.insert(curses,"dizzy")
end

if not tAffs.epilepsy  then
    table.insert(curses,"epilepsy")
end






if not tAffs.paranoia then
    table.insert(curses,"paranoia")
end

if not tAffs.masochism  then
    table.insert(curses,"masochism")
end







if not tAffs.claustrophobia then
    table.insert(curses,"claustrophobia")
end


if not tAffs.agoraphobia then
    table.insert(curses,"agoraphobia")
end




if not tAffs.asthma then
    table.insert(curses,"asthma")
end



if  getLockingAffliction() ~= "plague" and getLockingAffliction() ~= "stupid" and getLockingAffliction() ~= "reckless" and getLockingAffliction() ~= "paralyse" and getLockingAffliction() ~= "haemophilia" and
 not tAffs[getLockingAffliction()] 
then    table.insert(curses,getLockingAffliction())
end










if not tAffs.addiction then
    table.insert(curses,"addiction")
end



if not tAffs.nausea  then
    table.insert(curses,"vomiting")
end











if not tAffs.weariness  then
    table.insert(curses,"weariness")
end

if not tAffs.clumsiness then
    table.insert(curses,"clumsy")
end














apostate_lockattack()
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>KELP STACK</name>
										<packageName></packageName>
										<script>function apostate_kelp()
getLockingAffliction()
checkTargetLocks()

curses = {}


ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


 if tAffs.curseward  then

    table.insert(curses,"breach")
end

if ataxiaTemp.tarTumble then
 table.insert(curses,"cowardice")
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end


if tAffs.slickness and not tAffs.anorexia and (tAffs.impatience or curses[2] == "impatience") and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if  tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and tAffs.impatience and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if tAffs.manaleech and tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and not tAffs.impatience and curses[1] ~= "breach" and not tBals.tree then
    table.insert(curses,"anorexia")
    table.insert(curses,"impatience")
end




if tAffs.deafness and bloodworm() == true then
 table.insert(curses,"sensitivity")
end


if maretick and maretick == true and not tAffs.hellsight and tAffs.hypersomnia and not tAffs.dementia and tAffs.asthma and tAffs.impatience then
   table.insert(curses,"dementia")
end



if tAffs.asthma and not tAffs.slickness then
   table.insert(curses,"sicken")
     table.insert(curses,"sicken")
end



if not tAffs.paralysis then
    table.insert(curses,"paralysis")
end

if not tAffs.impatience  then
    table.insert(curses,"impatience")
end

if not tAffs.clumsiness then
    table.insert(curses,"clumsy")
end



if not tAffs.weariness  then
    table.insert(curses,"weariness")
end




if not tAffs.asthma then
    table.insert(curses,"asthma")
end


if not tAffs.deafness and not tAffs.sensitivity then
 table.insert(curses,"sensitivity")
end




if tAffs.impatience and not tAffs.stupidity  then
    table.insert(curses,"stupid")
end




if getLockingAffliction() ~= "weariness" and  getLockingAffliction() ~= "plague" and getLockingAffliction() ~= "stupid" and getLockingAffliction() ~= "haemophilia" and
 not tAffs[getLockingAffliction()] 
then    table.insert(curses,getLockingAffliction())
end





if not tAffs.nausea  then
    table.insert(curses,"vomiting")
end


if not tAffs.addiction then
    table.insert(curses,"addiction")
end









if not tAffs.confusion  then
    table.insert(curses,"confusion")
end







if not tAffs.epilepsy  then
    table.insert(curses,"epilepsy")
end



if not tAffs.dementia  then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo then
    table.insert(curses,"vertigo")
end



if not tAffs.dizziness  then
    table.insert(curses,"dizzy")
end



if not tAffs.recklessness  then
table.insert(curses,"reckless")
end

if not tAffs.masochism  then
    table.insert(curses,"masochism")
end
















apostate_lock()
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SLEEP</name>
										<packageName></packageName>
										<script>function apostate_sleep()
getLockingAffliction()
checkTargetLocks()

curses = {}


ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


 if tAffs.curseward  then

    table.insert(curses,"breach")
end

if ataxiaTemp.tarTumble then
 table.insert(curses,"cowardice")
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end

if tAffs.hypersomnia and tarInsomnia == true then
 table.insert(curses,"sleep")
end

if tarInsomnia == false and not tAffs.prone then
 table.insert(curses,"sleep")
  table.insert(curses,"sleep")
end

if truelock and not tAffs.prone then
 table.insert(curses,"sleep")
  table.insert(curses,"sleep")
end



if tAffs.slickness and not tAffs.anorexia and (tAffs.impatience or curses[2] == "impatience") and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if tAffs.manaleech and not tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and tAffs.impatience and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if tAffs.manaleech and tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and not tAffs.impatience and curses[1] ~= "breach" and not tBals.tree then
    table.insert(curses,"anorexia")
    table.insert(curses,"impatience")
end



if maretick and maretick == true and not tAffs.hellsight and tAffs.hypersomnia and not tAffs.dementia and tAffs.asthma and tAffs.impatience then
   table.insert(curses,"dementia")
end

if  tAffs.asthma and not tAffs.manaleech then
   table.insert(curses,"sicken")
end

if tAffs.asthma and tAffs.manaleech and not tAffs.slickness then
   table.insert(curses,"sicken")
end



if not tAffs.paralysis then
    table.insert(curses,"paralysis")
end





if tAffs.impatience and not tAffs.stupidity  then
    table.insert(curses,"stupid")
end

if not tAffs.impatience  then
    table.insert(curses,"impatience")
end

if not tAffs.asthma then
    table.insert(curses,"asthma")
end


if  getLockingAffliction() ~= "plague" and getLockingAffliction() ~= "stupid" and getLockingAffliction() ~= "reckless" and getLockingAffliction() ~= "paralyse" and getLockingAffliction() ~= "haemophilia" and
 not tAffs[getLockingAffliction()] 
then    table.insert(curses,getLockingAffliction())
end





if not tAffs.nausea  then
    table.insert(curses,"vomiting")
end





if not tAffs.addiction then
    table.insert(curses,"addiction")
end

if not tAffs.clumsiness then
    table.insert(curses,"clumsy")
end







if not tAffs.confusion  then
    table.insert(curses,"confusion")
end







if not tAffs.epilepsy  then
    table.insert(curses,"epilepsy")
end



if not tAffs.dementia  then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo then
    table.insert(curses,"vertigo")
end



if not tAffs.dizziness  then
    table.insert(curses,"dizzy")
end



if not tAffs.recklessness  then
table.insert(curses,"reckless")
end

if not tAffs.masochism  then
    table.insert(curses,"masochism")
end




if not tAffs.weariness  then
    table.insert(curses,"weariness")
end















apostate_sleepattack()
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SLEEP ATTACK</name>
										<packageName></packageName>
										<script>function apostate_sleepattack()
local atk = combatQueue()
corruptDmg()
demon()
daeggerhunt = daeggerhunt or false
handshere = handshere or false
freshblood = freshblood or false
if not pm then pm = 100 end
fiendthing = fiendthing or "nightmare"
partyrelay = partyrelay or true

daeggerhere = daeggerhere or false

if pm and pm &lt; 50 then 
need_catharsis = true else
need_catharsis = false
end

if pm and pm &lt; 50 and daeggerhere == false then 
pretattack =  "summon daegger;wield daegger shield;"
pre = true
else  pre = false
end

if curses[1] == "sleep" and curses[2] == "sleep" then
pretattack =  "summon daegger;wield daegger shield;"
 pre4 = true
else  pre4 = false
end


if tAffs.prone and daeggerhere == false then
pretattack =  "summon daegger;wield daegger shield;"
 pre2 = true
else  pre2 = false
end


if (need_catharsis or currupted) and tAffs.shield then
shield_strip = true
else
shield_strip = false
end




if freshblood and not apopentagram() then
  
preattack =  "summon daegger;wield daegger shield;demon bloodpact "..target.." for "..fiendthing..";order "..fiendthing.." kill "..target..";"
 pre3 = true
 else pre3 = false 
 end

if apopentagram() and demon() ~= fiendthing and daeggerhunt then
postattack =  ";summon daegger;wield daegger shield;dispel pentagram;summon "..fiendthing
 post3 = true
else post3 = false
end





if pm and pm &lt;= 60  and pm &gt; 50 then 
need_sap = true else
need_sap = false
end

  if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= corruptDmg() then
 need_corrupt = true else
 need_corrupt = false
end

  if pm - corruptDmg() &lt;= 15 and not tAffs.anorexia and not tAffs.slickness then
 need_corrupt_cath = true else
 need_corrupt_cath = false
  end




if shield_strip then

atk = atk.."wield shield;demon strip "..target..";assess "..target


elseif need_catharsis and not shield_strip then 

atk = atk.."wield shield;demon catharsis "..target..";assess "..target

elseif need_corrupt then

atk = atk.."wield shield;demon corrupt "..target.." paralysis;assess "..target

elseif not corrupted and need_corrupt_cath  then

atk = atk.."wield shield;demon corrupt "..target.." paralysis;assess "..target

elseif corrupted and not tAffs.shield then

atk = atk.."wield shield;demon catharsis "..target..";assess "..target

    
    

 elseif (daeggerhunt == false or (bloodworm() == false and freshblood)) and curses[1] == "paralysis" and ataxia.afflictions.clumsiness then

atk = atk.."wield shield;deadeyes "..target.." "..curses[2].." "..curses[1]..";assess "..target

elseif curses[1] == "sicken" or curses[2] == "sicken" and not tAffs.disloyalty and curses[1] == "paralysis" and ataxia.afflictions.clumsiness then

atk = atk.."wield shield;deadeyes "..target.." "..curses[2].." "..curses[1]..";assess "..target   

 
elseif (daeggerhunt == false or (bloodworm() == false and freshblood)) then

atk = atk.."wield shield;deadeyes "..target.." "..curses[1].." "..curses[2]..";assess "..target

elseif curses[1] == "sicken" or curses[2] == "sicken" and not tAffs.disloyalty and not tAffs.manaleech then

atk = atk.."wield shield;deadeyes "..target.." "..curses[1].." "..curses[2]..";assess "..target

elseif curses[1] == "paralysis" and ataxia.afflictions.clumsiness then

atk = atk.."wield shield;deadeyes "..target.." "..curses[2].." "..curses[1]..";assess "..target..";contemplate "..target
 

 
else

atk = atk.."wield shield;deadeyes "..target.." "..curses[1].." "..curses[2]..";assess "..target..";contemplate "..target
 

end

if table.contains(ataxia.playersHere, target) then

if baalzadeen() == false then

send("queue prepend free summon baalzadeen")

end

if (post1 or post or post2 or post3 or post4) and not (ataxia.afflictions.paralysis ) then
send("queue addclear free "..atk..""..postattack)

elseif (pre or pre2 or pre3) and not (ataxia.afflictions.paralysis ) then
send("queue addclear free "..preattack..""..atk)




elseif not (ataxia.afflictions.aeon) then

send("queue addclear free "..atk)


end
end
end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>GROUP PRIOS</name>
										<packageName></packageName>
										<script>function apostate_group()
getLockingAffliction()
checkTargetLocks()

curses = {}


ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


if tAffs.curseward  then

    table.insert(curses,"breach")
end

if ataxiaTemp.tarTumble then
 table.insert(curses,"cowardice")
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end

if tAffs.slickness and not tAffs.anorexia and (tAffs.impatience or curses[2] == "impatience" or curses[1] == "impatience") and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end


if tAffs.manaleech and not tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and tAffs.impatience and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if tAffs.manaleech and tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and not tAffs.impatience and curses[1] ~= "breach" and not tBals.tree then
    table.insert(curses,"anorexia")
    table.insert(curses,"impatience")
end

if tAffs.impatience and tAffs.asthma and tAffs.manaleech and not tAffs.slickness then
    table.insert(curses,"sicken")
    end

if tAffs.impatience and tAffs.asthma and not tAffs.manaleech then
    table.insert(curses,"sicken")
    end

if not tAffs.impatience  then
    table.insert(curses,"impatience")
end

if not tAffs.asthma then
    table.insert(curses,"asthma")
end

if not tAffs.paralysis then
    table.insert(curses,"paralysis")
end
if not tAffs.weariness  then
    table.insert(curses,"weariness")
end

if tAffs.impatience and not tAffs.recklessness  then
table.insert(curses,"reckless")
end

if tAffs.impatience and not tAffs.stupidity and not tAffs.confusion then
    table.insert(curses,"stupid")
    table.insert(curses,"confusion")
end
if tAffs.impatience and tAffs.stupidity and not tAffs.confusion then    
    table.insert(curses,"confusion")
end

if  tAffs.asthma and not tAffs.manaleech then
   table.insert(curses,"sicken")
end

if not tAffs.clumsiness and not tAffs.asthma then
    table.insert(curses,"clumsy")
end


if  getLockingAffliction() ~= "plague" and getLockingAffliction() ~= "stupid" and getLockingAffliction() ~= "reckless" and getLockingAffliction() ~= "paralyse" and getLockingAffliction() ~= "haemophilia" and
 not tAffs[getLockingAffliction()] 
then    table.insert(curses,getLockingAffliction())
end


if tAffs.impatience and not tAffs.dizziness then
    table.insert(curses,"dizzy")
end

if not tAffs.nausea  then
    table.insert(curses,"vomiting")
end

if not tAffs.addiction then
    table.insert(curses,"addiction")
end

if not tAffs.confusion  then
    table.insert(curses,"confusion")
end

if not tAffs.epilepsy  then
    table.insert(curses,"epilepsy")
end

if not tAffs.dementia  then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo then
    table.insert(curses,"vertigo")
end

if not tAffs.dizziness  then
    table.insert(curses,"dizzy")
end

if not tAffs.recklessness  then
table.insert(curses,"reckless")
end

if not tAffs.masochism  then
    table.insert(curses,"masochism")
end


















apostate_lock()
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Weariness STACK</name>
										<packageName></packageName>
										<script>function apostate_weariness()
getLockingAffliction()
checkTargetLocks()

curses = {}


ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


 if tAffs.curseward  then

    table.insert(curses,"breach")
end

if ataxiaTemp.tarTumble then
 table.insert(curses,"cowardice")
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end


if tAffs.slickness and not tAffs.anorexia and (tAffs.impatience or curses[2] == "impatience") and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if tAffs.manaleech and not tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and tAffs.impatience and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if  tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and not tAffs.impatience and curses[1] ~= "breach" and not tBals.tree then
    table.insert(curses,"anorexia")
    table.insert(curses,"impatience")
end




if maretick and maretick == true and not tAffs.hellsight and tAffs.hypersomnia and not tAffs.dementia and not tAffs.asthma and tAffs.impatience then
   table.insert(curses,"dementia")
end


if tAffs.asthma and not tAffs.slickness then
   table.insert(curses,"sicken")
end





if not tAffs.paralysis then
    table.insert(curses,"paralysis")
end

if tAffs.deafness then
    table.insert(curses,"sensitivity")
end

if not tAffs.weariness  then
    table.insert(curses,"weariness")
end




if not tAffs.impatience  then
    table.insert(curses,"impatience")
end


if tAffs.impatience and not tAffs.stupidity and not tAffs.asthma then
    table.insert(curses,"stupid")
end

if not tAffs.asthma then
    table.insert(curses,"asthma")
       table.insert(curses,"sicken")
end





if not tAffs.clumsiness and tAffs.asthma then
    table.insert(curses,"clumsy")
end


if tAffs.impatience and not tAffs.recklessness  then
    table.insert(curses,"reckless")
end


if tAffs.impatience and not tAffs.confusion and not tAffs.asthma  then
    table.insert(curses,"confusion")
end


if tAffs.deafness and ataxiaNDB_getClass(target) ~= "Blademaster" and ataxiaNDB_getClass(target) ~= "Monk" then
 table.insert(curses,"sensitivity")
end




if not tAffs.nausea  then
    table.insert(curses,"vomiting")
end














if getLockingAffliction() ~= "weariness" and getLockingAffliction() ~= "plague" and getLockingAffliction() ~= "stupid" and getLockingAffliction() ~= "reckless" and getLockingAffliction() ~= "paralyse" and getLockingAffliction() ~= "haemophilia" and
 not tAffs[getLockingAffliction()] 
then    table.insert(curses,getLockingAffliction())
end





if tAffs.impatience and not tAffs.dizziness then
    table.insert(curses,"dizzy")
end







if not tAffs.addiction then
    table.insert(curses,"addiction")
end









if not tAffs.confusion  then
    table.insert(curses,"confusion")
end







if not tAffs.epilepsy  then
    table.insert(curses,"epilepsy")
end



if not tAffs.dementia  then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo then
    table.insert(curses,"vertigo")
end



if not tAffs.dizziness  then
    table.insert(curses,"dizzy")
end



if not tAffs.recklessness  then
table.insert(curses,"reckless")
end

if not tAffs.masochism  then
    table.insert(curses,"masochism")
end

















apostate_lockattack()
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Faster Lock</name>
										<packageName></packageName>
										<script>

--if ataxiaNDB_getClass(target) ~= "Pariah" or ataxiaNDB_getClass(target) ~= "Occultist" or ataxiaNDB_getClass(target) ~= "Priest"  then
function apostate_fasterlock()
getLockingAffliction()
checkTargetLocks()

curses = {}


ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


if tAffs.curseward  then

    table.insert(curses,"breach")
end

if ataxiaTemp.tarTumble then
 table.insert(curses,"cowardice")
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end

if tAffs.slickness and not tAffs.anorexia and (tAffs.impatience or curses[2] == "impatience" or curses[1] == "impatience") and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end


if tAffs.manaleech and not tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and tAffs.impatience and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if tAffs.manaleech and tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and not tAffs.impatience and curses[1] ~= "breach" and not tBals.tree then
    table.insert(curses,"anorexia")
    table.insert(curses,"impatience")
end



if tAffs.deafness and bloodworm() == true and (ataxiaNDB_getClass(target) ~= "Monk" or ataxiaNDB_getClass(target)) ~= "Blademaster" then
 table.insert(curses,"sensitivity")
end

if maretick and maretick == true and not tAffs.hellsight and tAffs.hypersomnia and not tAffs.dementia and tAffs.asthma and tAffs.impatience then
   table.insert(curses,"dementia")
end

if  tAffs.asthma and not tAffs.manaleech then
   table.insert(curses,"sicken")
end

if tAffs.asthma and tAffs.manaleech and not tAffs.slickness then
   table.insert(curses,"sicken")
end



if not tAffs.paralysis then
    table.insert(curses,"paralysis")
end

if not tAffs.clumsiness and not tAffs.asthma then
    table.insert(curses,"clumsy")
end

if not tAffs.impatience  then
    table.insert(curses,"impatience")
end

if not tAffs.asthma then
    table.insert(curses,"asthma")
end

if not tAffs.clumsiness then
    table.insert(curses,"clumsy")
end

if tAffs.impatience and not tAffs.stupidity and not tAffs.confusion then
    table.insert(curses,"stupid")
    table.insert(curses,"confusion")
end
if tAffs.impatience and tAffs.stupidity and not tAffs.confusion then    
    table.insert(curses,"confusion")

end


if  getLockingAffliction() ~= "plague" and getLockingAffliction() ~= "stupid" and getLockingAffliction() ~= "reckless" and getLockingAffliction() ~= "paralyse" and getLockingAffliction() ~= "haemophilia" and
 not tAffs[getLockingAffliction()] 
then    table.insert(curses,getLockingAffliction())
end

if tAffs.impatience and not tAffs.recklessness  then
table.insert(curses,"reckless")
end

if tAffs.impatience and not tAffs.dizziness then
    table.insert(curses,"dizzy")
end

if not tAffs.nausea  then
    table.insert(curses,"vomiting")
end

if not tAffs.addiction then
    table.insert(curses,"addiction")
end

if not tAffs.confusion  then
    table.insert(curses,"confusion")
end

if not tAffs.epilepsy  then
    table.insert(curses,"epilepsy")
end

if not tAffs.dementia  then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo then
    table.insert(curses,"vertigo")
end

if not tAffs.dizziness  then
    table.insert(curses,"dizzy")
end

if not tAffs.recklessness  then
table.insert(curses,"reckless")
end

if not tAffs.masochism  then
    table.insert(curses,"masochism")
end

if not tAffs.weariness  then
    table.insert(curses,"weariness")
end
















apostate_lock()
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Illusion Clum</name>
										<packageName></packageName>
										<script>function apostate_clumsyillusion()
getLockingAffliction()
checkTargetLocks()

curses = {}


ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


if tAffs.curseward  then

    table.insert(curses,"breach")
end

if ataxiaTemp.tarTumble then
 table.insert(curses,"cowardice")
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end

if tAffs.slickness and not tAffs.anorexia and (tAffs.impatience or curses[2] == "impatience" or curses[1] == "impatience") and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end


if tAffs.manaleech and not tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and tAffs.impatience and curses[1] ~= "breach" then
    table.insert(curses,"anorexia")
end

if tAffs.manaleech and tAffs.slickness and not tAffs.anorexia  and tAffs.asthma and not tAffs.impatience and curses[1] ~= "breach" and not tBals.tree then
    table.insert(curses,"anorexia")
    table.insert(curses,"impatience")
end



if tAffs.deafness and bloodworm() == true and (ataxiaNDB_getClass(target) ~= "Monk" or ataxiaNDB_getClass(target)) ~= "Blademaster" then
 table.insert(curses,"sensitivity")
end

if maretick and maretick == true and not tAffs.hellsight and tAffs.hypersomnia and not tAffs.dementia and tAffs.asthma and tAffs.impatience then
   table.insert(curses,"dementia")
end

if  tAffs.asthma and not tAffs.manaleech then
   table.insert(curses,"sicken")
  
end

if tAffs.asthma and tAffs.manaleech and not tAffs.slickness then
   table.insert(curses,"sicken")
end

if not tAffs.paralysis then
    table.insert(curses,"paralysis")
end

if not tAffs.clumsiness and not tAffs.asthma then
    table.insert(curses,"clumsy")
end

if not tAffs.impatience  then
    table.insert(curses,"impatience")
end

if not tAffs.asthma then
    table.insert(curses,"asthma")
end

if tAffs.impatience and not tAffs.stupidity and not tAffs.confusion then
    table.insert(curses,"stupid")
    table.insert(curses,"confusion")
end
if tAffs.impatience and tAffs.stupidity and not tAffs.confusion then    
    table.insert(curses,"confusion")

end


if  getLockingAffliction() ~= "plague" and getLockingAffliction() ~= "stupid" and getLockingAffliction() ~= "reckless" and getLockingAffliction() ~= "paralyse" and getLockingAffliction() ~= "haemophilia" and
 not tAffs[getLockingAffliction()] 
then    table.insert(curses,getLockingAffliction())
end

if tAffs.impatience and not tAffs.recklessness  then
table.insert(curses,"reckless")
end

if tAffs.impatience and not tAffs.dizziness then
    table.insert(curses,"dizzy")
end

if not tAffs.nausea  then
    table.insert(curses,"vomiting")
end

if not tAffs.addiction then
    table.insert(curses,"addiction")
end

if not tAffs.confusion  then
    table.insert(curses,"confusion")
end

if not tAffs.epilepsy  then
    table.insert(curses,"epilepsy")
end

if not tAffs.dementia  then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo then
    table.insert(curses,"vertigo")
end

if not tAffs.dizziness  then
    table.insert(curses,"dizzy")
end

if not tAffs.recklessness  then
table.insert(curses,"reckless")
end

if not tAffs.masochism  then
    table.insert(curses,"masochism")
end

if not tAffs.weariness  then
    table.insert(curses,"weariness")
end
















apostate_lock()
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>LOCK ATTACK</name>
										<packageName></packageName>
										<script>function apostate_lockattack()
local atk = combatQueue()
corruptDmg()
demon()
daeggerhunt = daeggerhunt or false
handshere = handshere or false
freshblood = freshblood or false
if not pm then pm = 100 end
fiendthing = fiendthing or "nightmare"
partyrelay = partyrelay or true
want_disloyalty = want_disloyalty or false
clumsycurse = curses[1]
getLockingAffliction()
checkTargetLocks()

curse1 = curses[1]
curse2 = curses[2]


if curse1 == "paralysis" then
curse2 = "paralysis"
curse1 = curses[2]
end

if not tBals.tree and tAffs.manaleech and 
curse1 == "sicken" and curse2 == "paralysis" then
curse2 = curses[3]
end

daeggerhere = daeggerhere or false

if pm and pm &lt; 50 then 
need_catharsis = true else
need_catharsis = false
end

if pm and pm &lt; 50 and daeggerhere == false then 
preattack =  "summon daegger;wield daegger shield;"
pre = true
else  pre = false
end

if curses[1] == "sleep" and curses[2] == "sleep" then
preattack =  "summon daegger;wield daegger shield;"
 pre4 = true
else  pre4 = false
end


if tAffs.prone and daeggerhere == false then
preattack =  "summon daegger;wield daegger shield;"
 pre2 = true
else  pre2 = false
end



if bloodworm() == false and freshblood then
postattack =  ";summon bloodworms"
 post1 = true
else  post1 = false
end

if daeggerhunt == false and not tAffs.prone and daeggerhere == true then
postattack =  ";wield daegger shield;daegger levitate;daegger hunt "..target
 post = true
else  post = false
end

if daeggerhunt == false and not tAffs.prone and daeggerhere == false and curses[1] ~= "sleep" and curses[2] ~= "sleep" then
postattack =  ";summon daegger;wield daegger shield;daegger levitate;daegger hunt "..target
 post2 = true
else  post2 = false
end

if (need_catharsis or currupted) and tAffs.shield then
shield_strip = true
else
shield_strip = false
end




if freshblood and not apopentagram() then
  
preattack =  "summon daegger;wield daegger shield;demon bloodpact "..target.." for "..fiendthing..";order "..fiendthing.." kill "..target..";"
 pre3 = true
 else pre3 = false 
 end

if apopentagram() and demon() ~= fiendthing and daeggerhunt then
postattack =  ";summon daegger;wield daegger shield;dispel pentagram;summon "..fiendthing
 post3 = true
else post3 = false
end


if want_disloyalty and tAffs.asthma and (curses[1] == "sicken" or curses[2] == "sicken") and not tAffs.disloyalty then
postattack =  ";disfigure "..target
 post4 = true
else post4 = false
end


if truelock and tAffs.prone then need_trample = true else need_trample = false end

if tAffs.prone and tAffs.brokenrightarm and tAffs.brokenleftarm and tAffs.brokenrightleg and tAffs.brokenleftleg then
need_vivisect = true
else need_vivisect = false
end


if pm and pm &lt;= 60  and pm &gt; 50 then 
need_sap = true else
need_sap = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= corruptDmg() then
 need_corrupt = true else
 need_corrupt = false
end

  if pm - corruptDmg() &lt;= 15 and not tAffs.anorexia and not tAffs.slickness then
 need_corrupt_cath = true else
 need_corrupt_cath = false
  end


if need_vivisect then

atk = atk.."wield shield;dismount;vivisect "..target..";assess "..target



elseif shield_strip then

atk = atk.."wield shield;demon strip "..target..";assess "..target

elseif need_trample then

atk = atk.."wield shield;trample;assess "..target


elseif need_catharsis and not shield_strip then 

atk = atk.."wield shield;demon catharsis "..target..";assess "..target

    

elseif (daeggerhunt == false or (bloodworm() == false and freshblood)) then

atk = atk.."wield shield;deadeyes "..target.." "..curse1.." "..curse2..";assess "..target

elseif curse1 == "sicken" or curse2 == "sicken" and not tAffs.disloyalty and want_disloyalty then

atk = atk.."wield shield;deadeyes "..target.." "..curse1.." "..curse2..";assess "..target

 
else

atk = atk.."wield shield;deadeyes "..target.." "..curse1.." "..curse2..";assess "..target..";contemplate "..target
 

end

if table.contains(ataxia.playersHere, target) then



if baalzadeen() == false then

send("queue prepend free summon baalzadeen")

end

if (post1 or post or post2 or post3 or post4) and not ataxia.afflictions.aeon then
send("queue addclear freestand "..atk..""..postattack)

elseif (pre or pre2 or pre3) and not ataxia.afflictions.aeon then
send("queue addclear freestand "..preattack..""..atk)




elseif not ataxia.afflictions.aeon then

send("queue addclear freestand "..atk)





end
end
end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Levi Apostate</name>
										<packageName></packageName>
										<script>function leviclumsapo()
--Clumsiness Classes


--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()


--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  
--Set Table
curses = {}

--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false

--Curses 1
if tAffs.curseward  then
  table.insert(curses,"breach")

elseif truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(curses,"paralysis") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(curses,"weariness")
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(curses,"plague")
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(curses,"stupid")
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(curses,"reckless")
  elseif getLockingAffliction(target) == "confusion" and not tAffs.confusion then
    table.insert(curses,"confusion")
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(curses,"paralysis")
elseif softlock == true and not tAffs.paralysis then
  table.insert(curses,"paralysis")
elseif softlock == true and tAffs.paralysis and not tAffs.impatience then
  table.insert(curses,"impatience")
elseif tAffs.manaleech and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(curses,"anorexia")
elseif not tAffs.paralysis then
  table.insert(curses,"paralysis")
elseif tAffs.paralysis then
  if tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
    table.insert(curses,"anorexia")
  elseif tAffs.slickness and tAffs.asthma and not tAffs.impatience then
    table.insert(curses,"impatience")
  elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.manaleech then
    table.insert(curses,"sicken") 
   elseif not tAffs.slickness and tAffs.asthma and tAffs.manaleech then
    table.insert(curses,"sicken")
   elseif tAffs.asthma and not tAffs.manaleech and tAffs.impatience then
    table.insert(curses,"sicken")
  elseif tAffs.asthma and not tAffs.impatience then
    table.insert(curses,"impatience")
  elseif not tAffs.asthma then
    table.insert(curses,"asthma")
  elseif not tAffs.weariness then
    table.insert(curses,"weariness")
  elseif not tAffs.clumsiness then
    table.insert(curses,"clumsiness")
  end
end

--Curses Two
if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and curses[1] ~= "paralysis" then
    table.insert(curses,"paralysis") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and curses[1] ~= "weariness" then
    table.insert(curses,"weariness")
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and curses[1] ~= "plague" then
    table.insert(curses,"plague")
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and curses[1] ~= "stupid" then
    table.insert(curses,"stupid")
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and curses[1] ~= "reckless" then
    table.insert(curses,"reckless")
  elseif getLockingAffliction(target) == "confusion" and not tAffs.confusion and curses[1] ~= "confusion" then
    table.insert(curses,"confusion")
  end
elseif hardlock == true and not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(curses,"paralysis")
elseif softlock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(curses,"paralysis") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(curses,"weariness")
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(curses,"plague")
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(curses,"stupid")
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(curses,"reckless")
  elseif getLockingAffliction(target) == "confusion" and not tAffs.confusion then
    table.insert(curses,"confusion")
  end
elseif softlock == true and not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(curses,"paralysis")
elseif softlock == true and tAffs.paralysis and not tAffs.impatience and curses[1] ~= "impatience" then
  table.insert(curses,"impatience")
elseif tAffs.manaleech and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and curses[1] == "anorexia" then
  table.insert(curses,"sicken")
elseif tAffs.manaleech and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and curses[1] == "sicken" then
  table.insert(curses,"anorexia")
elseif not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(curses,"paralysis")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and curses[1] ~= "anorexia" then
    table.insert(curses,"anorexia")
elseif tAffs.slickness and tAffs.asthma and not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.manaleech and curses[1] ~= "sicken" then
    table.insert(curses,"sicken") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.manaleech and curses[1] ~= "sicken" then
    table.insert(curses,"sicken")
elseif maretick and maretick == true and not tAffs.hellsight and tAffs.hypersomnia and not tAffs.dementia and tAffs.asthma and tAffs.impatience then
   table.insert(curses,"dementia")
elseif tAffs.asthma and not tAffs.manaleech and tAffs.impatience then
    table.insert(curses,"sicken")
elseif tAffs.asthma and not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif tAffs.impatience and not tAffs.stupidity and curses[1] ~= "stupid" then
  table.insert(curses,"stupid")
elseif tAffs.impatience and not tAffs.asthma and curses[1] ~= "asthma" then
    table.insert(curses,"asthma")
elseif tAffs.clumsiness and not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif not tAffs.clumsiness and curses[1] ~= "clumsy" then
    table.insert(curses,"clumsy")
elseif not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif not tAffs.asthma and curses[1] ~= "asthma" then
    table.insert(curses,"asthma")
elseif not tAffs.weariness and curses[1] ~= "weariness" then
    table.insert(curses,"weariness")
end

apostate_lockattack()

end


function leviweariapo()
--Weariness Classes


--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()


--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  
--Set Table
curses = {}

--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false

--Curses 1
if tAffs.curseward then
  table.insert(curses,"breach")
elseif truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(curses,"paralysis") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(curses,"weariness")
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(curses,"plague")
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(curses,"stupid")
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(curses,"reckless")
  elseif getLockingAffliction(target) == "confusion" and not tAffs.confusion then
    table.insert(curses,"confusion")
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(curses,"paralysis")
elseif softlock == true and not tAffs.paralysis then
  table.insert(curses,"paralysis")
elseif softlock == true and tAffs.paralysis and not tAffs.impatience then
  table.insert(curses,"impatience")
elseif tAffs.manaleech and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(curses,"anorexia")
elseif not tAffs.paralysis then
  table.insert(curses,"paralysis")
elseif tAffs.paralysis then
  if tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
    table.insert(curses,"anorexia")
  elseif tAffs.slickness and tAffs.asthma and not tAffs.impatience then
    table.insert(curses,"impatience")
  elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.manaleech then
    table.insert(curses,"sicken") 
   elseif not tAffs.slickness and tAffs.asthma and tAffs.manaleech then
    table.insert(curses,"sicken")
   elseif tAffs.asthma and not tAffs.manaleech and tAffs.impatience then
    table.insert(curses,"sicken")
  elseif tAffs.asthma and not tAffs.impatience then
    table.insert(curses,"impatience")
  elseif not tAffs.asthma then
    table.insert(curses,"asthma")
  elseif not tAffs.weariness then
    table.insert(curses,"weariness")
  elseif not tAffs.clumsiness then
    table.insert(curses,"clumsiness")
  end
end

--Curses Two
if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and curses[1] ~= "paralysis" then
    table.insert(curses,"paralysis") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and curses[1] ~= "weariness" then
    table.insert(curses,"weariness")
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and curses[1] ~= "plague" then
    table.insert(curses,"plague")
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and curses[1] ~= "stupid" then
    table.insert(curses,"stupid")
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and curses[1] ~= "reckless" then
    table.insert(curses,"reckless")
  elseif getLockingAffliction(target) == "confusion" and not tAffs.confusion and curses[1] ~= "confusion" then
    table.insert(curses,"confusion")
  end
elseif hardlock == true and not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(curses,"paralysis")
elseif softlock == true and not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(curses,"paralysis")
elseif softlock == true and tAffs.paralysis and not tAffs.impatience and curses[1] ~= "impatience" then
  table.insert(curses,"impatience")
elseif tAffs.manaleech and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and curses[1] == "anorexia" then
  table.insert(curses,"sicken")
elseif tAffs.manaleech and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and curses[1] == "sicken" then
  table.insert(curses,"anorexia")
elseif not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(curses,"paralysis")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and curses[1] ~= "anorexia" then
    table.insert(curses,"anorexia")
elseif tAffs.slickness and tAffs.asthma and not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.manaleech and curses[1] ~= "sicken" then
    table.insert(curses,"sicken") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.manaleech and curses[1] ~= "sicken" then
    table.insert(curses,"sicken")
elseif maretick and maretick == true and not tAffs.hellsight and tAffs.hypersomnia and not tAffs.dementia and tAffs.asthma and tAffs.impatience then
   table.insert(curses,"dementia")
elseif tAffs.asthma and not tAffs.manaleech and tAffs.impatience then
    table.insert(curses,"sicken")
elseif tAffs.asthma and not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif tAffs.impatience and not tAffs.stupidity and curses[1] ~= "stupid" then
  table.insert(curses,"stupid")
elseif tAffs.impatience and not tAffs.asthma and curses[1] ~= "asthma" then
    table.insert(curses,"asthma")
elseif tAffs.weariness and not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif not tAffs.weariness and curses[1] ~= "weariness" then
    table.insert(curses,"weariness")
elseif not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif not tAffs.asthma and curses[1] ~= "asthma" then
    table.insert(curses,"asthma")
elseif not tAffs.clumsiness and curses[1] ~= "clumsy" then
    table.insert(curses,"clumsy")

end

apostate_lockattack()

end

function levisleepapo()
--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()
--Set Curses Table
curses = {}
--Set if Target is tumbling or not
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false

--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
 
--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil

--Curses 1
if tAffs.curseward then
  table.insert(curses,"breach")
elseif truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(curses,"paralysis") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(curses,"weariness")
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(curses,"plague")
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(curses,"stupid")
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(curses,"reckless")
  elseif getLockingAffliction(target) == "confusion" and not tAffs.confusion then
    table.insert(curses,"confusion")
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(curses,"paralysis")
elseif softlock == true and not tAffs.paralysis then
  table.insert(curses,"paralysis")
elseif softlock == true and tAffs.paralysis and not tAffs.impatience then
  table.insert(curses,"impatience")
elseif tAffs.manaleech and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(curses,"anorexia")
elseif tarInsomnia == false and tAffs.hypersomnia and tAffs.impatience and not tAffs.prone then
  table.insert(curses,"sleep")
elseif not tAffs.paralysis then
  table.insert(curses,"paralysis")
elseif tAffs.paralysis then
  if tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
    table.insert(curses,"anorexia")
  elseif tAffs.slickness and tAffs.asthma and not tAffs.impatience then
    table.insert(curses,"impatience")
  elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.manaleech then
    table.insert(curses,"sicken") 
   elseif not tAffs.slickness and tAffs.asthma and tAffs.manaleech then
    table.insert(curses,"sicken")
   elseif tAffs.asthma and not tAffs.manaleech and tAffs.impatience then
    table.insert(curses,"sicken")
  elseif tAffs.asthma and not tAffs.impatience then
    table.insert(curses,"impatience")
  elseif not tAffs.asthma then
    table.insert(curses,"asthma")
  elseif not tAffs.weariness then
    table.insert(curses,"weariness")
  elseif not tAffs.clumsiness then
    table.insert(curses,"clumsiness")
  end
end

--Curses Two
if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and curses[1] ~= "paralysis" then
    table.insert(curses,"paralysis") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and curses[1] ~= "weariness" then
    table.insert(curses,"weariness")
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and curses[1] ~= "plague" then
    table.insert(curses,"plague")
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and curses[1] ~= "stupid" then
    table.insert(curses,"stupid")
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and curses[1] ~= "reckless" then
    table.insert(curses,"reckless")
  elseif getLockingAffliction(target) == "confusion" and not tAffs.confusion and curses[1] ~= "confusion" then
    table.insert(curses,"confusion")
  end
elseif hardlock == true and not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(curses,"paralysis")
elseif softlock == true and not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(curses,"paralysis")
elseif softlock == true and tAffs.paralysis and not tAffs.impatience and curses[1] ~= "impatience" then
  table.insert(curses,"impatience")
elseif tAffs.manaleech and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and curses[1] == "anorexia" then
  table.insert(curses,"sicken")
elseif tAffs.manaleech and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and curses[1] == "sicken" then
  table.insert(curses,"anorexia")
elseif not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(curses,"paralysis")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and curses[1] ~= "anorexia" then
    table.insert(curses,"anorexia")
elseif tAffs.slickness and tAffs.asthma and not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.manaleech and curses[1] ~= "sicken" then
    table.insert(curses,"sicken") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.manaleech and curses[1] ~= "sicken" then
    table.insert(curses,"sicken")
elseif tarInsomnia == false and tAffs.hypersomnia and tAffs.impatience and not tAffs.prone then
  table.insert(curses,"sleep")
elseif tAffs.hypersomnia and tarInsomnia == true and tAffs.impatience then
 table.insert(curses,"sleep")
elseif tAffs.asthma and not tAffs.manaleech and tAffs.impatience then
    table.insert(curses,"sicken")
elseif tAffs.asthma and not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif tAffs.impatience and not tAffs.asthma and curses[1] ~= "asthma" then
    table.insert(curses,"asthma")
elseif tAffs.weariness and not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif not tAffs.weariness and curses[1] ~= "weariness" then
    table.insert(curses,"weariness")
elseif not tAffs.impatience and curses[1] ~= "impatience" then
    table.insert(curses,"impatience")
elseif not tAffs.asthma and curses[1] ~= "asthma" then
    table.insert(curses,"asthma")
elseif not tAffs.clumsiness and curses[1] ~= "clumsy" then
    table.insert(curses,"clumsy")

end

apostate_sleepattack()
end

--Corrupt Damage Function
function corruptDmg()

--Get Physical Affs
  local physAffs =
    {
      "clumsiness",
      "paralysis",
      "asthma",
      "sensitivity",
      "nausea",
      "stupidity",
      "impatience",
    
    }
--Get Mentals Affs
  local mentalAffs =
    {
      "vertigo",
      "agoraphobia",
      "dizziness",
      "claustrophobia",
      "paranoia",
      "dementia",
      "masochism",
      "recklessness",
      "epilepsy",
      "confusion",
      "anorexia",
      "addiction",
      "weariness",
      
    }
--Get Smoke Affs
  local smokeAffs = {"manaleech", "healthleech"}
  local phys_count = 0
--Identify how many physical Affs they have
  for _, v in pairs(physAffs) do
    if tAffs[v] then
      phys_count = phys_count + 1
    end
  end
  local phys_damage = phys_count * 7
  local mental_count = 0
--Identify how many mental Affs they have
  for _, v in pairs(mentalAffs) do
    if tAffs[v] then
      mental_count = mental_count + 1
    end
  end
  local mental_damage = mental_count * 8
  local smoke_count = 0
--Identify how many smoke Affs they have
  for _, v in pairs(smokeAffs) do
    if tAffs[v] then
      smoke_count = smoke_count + 1
    end
  end
  local smoke_damage = smoke_count * 9
  return smoke_damage + phys_damage + mental_damage
end

--Corruption Kill Logic
function corruptKill()
local atk = combatQueue()
  if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= corruptDmg() then
atk = atk.."stand;wield shield;assess "..target..";demon corrupt "..target
  end
end
 
function cathCorrupt()
local atk = combatQueue()
  if pm - corruptDmg() &lt;= 20 and not tAffs.anorexia and not tAffs.slickness then
atk = atk.."stand;wield shield;assess "..target..";demon corrupt "..target
  end
end



function bloodPact()
  if not apo.pentagram() then
    if bloodTimer then
      if not dsum then
        addToCommand("summon daegger")
      end
      addToCommand(
        "wield daegger shield;demon bloodpact &amp;tar for " ..
        pentagramEnt ..
        "/order loyals kill &amp;tar"
      )
    end
  elseif apo.demon() ~= pentagramEnt then
    if not dsum then
      addToCommand("summon daegger")
    end
    addToCommand("wield daegger shield;dispel pentagram;summon " .. pentagramEnt)
  end
end

--
function bloodworm()
  if not zgui.roomDenizenList then
    return false
  end
  if table.contains(zgui.roomDenizenList, "a frenzied bloodworm") then
      return true
    else

  return false
end
end


function baalzadeen()

  if not zgui.roomDenizenList then
    return false
  end
  if table.contains(zgui.roomDenizenList, "a Baalzadeen") then
      return true
    else

  return false
end
end

--

function apopentagram()
   if not zgui.roomItemList then
    return false
  end

     if table.contains(zgui.roomItemList,"a floating silver pentagram") then
      return true
  
  else
  return false
end
end

function demon()
  if not zgui.roomDenizenList then
    return false
  end

    if table.contains(zgui.roomDenizenList,"a small winged daemonite") then
      return "daemonite"
    elseif table.contains(zgui.roomDenizenList,"a fiendish nightmare") then
      return "nightmare"
    elseif table.contains(zgui.roomDenizenList,"a razor fiend") then
      return "fiend"
    else 

  return ""
end
end

function daemonite()
  if not zgui.roomDenizenList then
    return false
  end
  for id, item in pairs(zgui.roomItemList) do
    if item.name:match("a small winged daemonite") then
      return true
    end
  end
  return false
end

function nightmare()
  if not zgui.roomItemList then
    return false
  end
  for id, item in pairs(roomItems) do
    if item.name:match("zgui.roomItemList") then
      return true
    end
  end
  return false
end

function fiend()
  if not zgui.roomItemList then
    return false
  end
  for id, item in pairs(zgui.roomItemList) do
    if item.name:match("a razor fiend") then
      return true
    end
  end
  return false
end




---------------



function corruptDmg2()
  local physAffs =
    {
      "xentio",
      "paralyse",
      "kalmia",
      "sensitivity",
      "euphorbia",
      "stupidity",
      "impatience",
    }
  local mentalAffs =
    {
      "vertigo",
      "agoraphobia",
      "dizzy",
      "claustrophobia",
      "paranoia",
      "dementia",
      "masochism",
      "eurypteria",
      "epilepsy",
      "confuse",
      "slike",
      "vardrax", --??
      "vernalius", --??
    }
  local smokeAffs = {"manaleech", "healthleech"}
  local phys_count = 0
  for _, v in pairs(physAffs) do
    if tarAff[v] then
      phys_count = phys_count + 1
    end
  end
  local phys_damage = phys_count * 7
  local mental_count = 0
  for _, v in pairs(mentalAffs) do
    if tarAff[v] then
      mental_count = mental_count + 1
    end
  end
  local mental_damage = mental_count * 8
  local smoke_count = 0
  for _, v in pairs(smokeAffs) do
    if tarAff[v] then
      smoke_count = smoke_count + 1
    end
  end
  local smoke_damage = smoke_count * 9
  return smoke_damage + phys_damage + mental_damage
end
 
function corruptKill2()
  if targetHealth &lt;= corruptDmg() then
    addToCommand("demon corrupt &amp;tar/assess &amp;tar")
  end
end
 
function cathCorrupt2()
  if targetMana - corruptDmg() &lt;= 25 and not tarAff["slike"] and not tarAff["gecko"] then
    addToCommand("demon corrupt &amp;tar/assess &amp;tar")
  end
end



function nightmare()

if gmcp.Char.Status.class == "Apostate" and demon() == "nightmare" then

maretick = tempTimer(6.5, [[maretick = false; maretick = true]])
nightmareaff = tempTimer(8.5, [[nightmareaff = false; nightmareaff = true]])

if nightmareaff and tAffs.dementia and tAffs.hypersomnia then 

tarAffed("hellsight")

elseif

nightmareaff and tAffs.hypersomnia and not tAffs.dementia then

 tarAffed("dementia")

end
end





end




</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>INFERNAL</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>INFERNAL</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>LIMB PREP</name>
											<packageName></packageName>
											<script>function dwcprep()

local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
scimdamage = ataxiaTables.limbData.dwcSlash + ataxiaTables.limbData.dwcSlash
axedamage = scimdamage - 3

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
  




--VENOMS

  venoms = {}
  



if
((prepped_leftleg and prepped_rightleg) or (prepped_leftleg and tAffs.damagedrightleg) or (prepped_rightleg and tAffs.damagedleftleg)) and not tAffs.prone and not tAffs.rebounding and not tAffs.shield then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
end

if
(prepped_leftleg or prepped_rightleg) and prepped_leftarm and prepped_rightarm and not tAffs.prone and not tAffs.rebounding and not tAffs.shield then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
end

if
(prepped_leftleg or prepped_rightleg) and tAffs.damagedtorso and not tAffs.prone and not tAffs.rebounding and not tAffs.shield then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
end



if (tAffs.damagedrightleg or tAffs.damagedleftleg) and (prepped_rightleg or prepped_leftleg) then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epteth")
  
  elseif tAffs.damagedrightleg and tAffs.damagedleftleg  then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epteth")
  
  
  
  elseif (tAffs.damagedrightleg or tAffs.damagedleftleg) and (prepped_rightarm or prepped_leftarm) then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
  
   elseif (tAffs.damagedrightleg or tAffs.damagedleftleg) and (tAffs.damagedrightarm or tAffs.damagedleftarm) then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
  
 elseif (tAffs.damagedrightarm or tAffs.damagedleftarm) and (prepped_rightleg or prepped_leftleg) then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
  
   elseif tAffs.damagedrightarm and tAffs.damagedleftarm then
    table.insert(venoms,"epseth")
  table.insert(venoms,"epseth")


 
end

if tAffs.slickness and not tAffs.anorexia and tAffs.paralysis and not tAffs.stupid then
  table.insert(venoms,"aconite")
  table.insert(venoms,"slike")
end
  



if not tAffs.paralysis then
  table.insert(venoms,"curare")

end

if not tAffs.nausea then
  table.insert(venoms,"euphorbia")

end








if not tAffs.asthma then
  table.insert(venoms,"kalmia")

end

if not tAffs.clumsiness then
  table.insert(venoms,"xentio")

end



if not tAffs.slickness and tAffs.asthma and venoms[1] == "curare" then

  table.insert(venoms,"gecko")

end




if not tAffs.dizziness then
table.insert(venoms,"larkspur")
end


if not tAffs.stupidity then
  table.insert(venoms,"aconite")


end

if not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end





if not tAffs.shyness then
  table.insert(venoms,"digitalis")

end

if not tAffs.sensitivity then

  table.insert(venoms,"prefarar")
  table.insert(venoms,"prefarar")

end



if not tAffs.addiction then

  table.insert(venoms,"vardrax")

end

if not tAffs.darkshade then
  table.insert(venoms,"darkshade")

end




--INVESTS


invest = {}

if venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" and not tAffs.weariness and tAffs.anorexia and tAffs.asthma and tAffs.slickness then invest = "exploit"

elseif venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" and not tAffs.weariness and (venoms[1] == "aconite" or venoms[2] == "aconite") and tAffs.asthma and tAffs.slickness then invest = "exploit"

elseif venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" and tAffs.haemophilia then invest = "agony" 

elseif getMentalAffCount() &gt;= 4 then invest = "punishment" 

else invest = "agony" end
  
  



--ATTACK


local atk = combatQueue()

if tAffs.impaled and tLimbs.T &gt;= 100 then
disembowel = true
else
disembowel = false
end


if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.5) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
(ataxiaNDB_getClass(target) ~= "Apostate" or ataxiaNDB_getClass(target)) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end

if (tLimbs.RL + scimdamage &gt;= 100) and (tLimbs.RL + axedamage &lt; 100) and targetlimb == "right leg" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.RA + scimdamage &gt;= 100) and (tLimbs.RA + axedamage &lt; 100) and targetlimb == "right arm" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.LL + scimdamage &gt;= 100) and (tLimbs.LL + axedamage &lt; 100) and targetlimb == "left leg" then

need_raze3 = true
else
need_raze3 = false
end

if (tLimbs.LA + scimdamage &gt;= 100) and (tLimbs.LA + axedamage &lt; 100) and targetlimb == "left arm" then

need_raze3 = true
else
need_raze3 = false
end

if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end


if (tAffs.brokenrightleg or tAffs.damagedrightleg) and (tAffs.brokenleftleg or tAffs.damagedleftleg)
 and (tAffs.brokenleftarm or tAffs.damagedleftarm)  and  (tAffs.brokenrightarm or tAffs.damagedrightarm) and tAffs.prone then
vivisect = true
else
vivisect = false
end

if tAffs.rebounding and tAffs.shield then
need_shieldraze = true
else
need_shieldraze = false
end

if  tLimbs.LL + scimdamage &gt;= 100 and not tAffs.damagedleftleg then 
prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + scimdamage &gt;= 100 and not tAffs.damagedrightleg then 
prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + scimdamage &gt;= 100 and not tAffs.damagedrightarm then 
prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + scimdamage &gt;= 100 and not tAffs.damagedleftarm then 
prepped_leftarm = true else
prepped_leftarm = false

end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &gt; 50 and ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 and ataxia.vitals.class == 4 then
impale_blackout = true
else
impale_blackout = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 40 then
quash_arc = true
else
quash_arc = false
end


if quash_arc then

atk = "stand/wield shield longsword63894/assess "..target.."/quash "..target.."/arc curare"

elseif vivisect then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";dismount;vivisect "..target

elseif disembowel then 

atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";disembowel "..target



elseif need_shieldraze then
atk = "stand/wield shield longsword63894/assess "..target.."/quash "..target.."/arc curare"


elseif need_raze then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";razeslash "..target.." "..targetlimb.." "..venoms[1]

elseif need_raze2 then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";razeslash "..target.." "..targetlimb.." "..venoms[1]

elseif need_raze3 then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";razeslash "..target.." "..targetlimb.." "..venoms[1]

--elseif prepped_leftleg and prepped_rightleg and not tAffs.prone then

--atk = atk.."wield battleaxe;rampage against "..target..";assess "..target..";hellforge invest "..invest..";undercut "..target.." "..targetlimb.." "..venoms[1]

--elseif prepped_leftleg and prepped_rightarm and not tAffs.prone then

--atk = atk.."wield battleaxe;rampage against "..target..";assess "..target..";hellforge invest "..invest..";undercut "..target.." left leg "..venoms[1]

--elseif prepped_rightleg and prepped_rightarm and not tAffs.prone then

--atk = atk.."wield battleaxe;rampage against "..target..";assess "..target..";hellforge invest "..invest..";undercut "..target.." right leg "..venoms[1]



elseif (invest == "exploit" or invest == "torture" or invest == "torment") and venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" then

atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";envenom scimitar383498 with "..venoms[1]..";dsl "..target.." "..targetlimb

elseif tAffs.prone and tAffs.damagedtorso and tAffs.damagedrightleg and tAffs.damagedleftleg then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";impale "..target


else
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";dsl "..target.." "..targetlimb.." "..venoms[1].." "..venoms[2]

end


if not ataxia.settings.paused then

if quash_arc then
send("setalias quasharc "..atk)
send("queue addclear bal quasharc")

elseif not engaged then
send("queue addclear free "..atk..";engage "..target..";tyranny")

else

send("queue addclear free "..atk..";tyranny")

end
end


end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>RAMPAGE</name>
											<packageName></packageName>
											<script>function infernalpriosrampage()


local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
scimdamage = ataxiaTables.limbData.dwcSlash + ataxiaTables.limbData.dwcSlash
axedamage = scimdamage - 3

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
  




--VENOMS

  venoms = {}
  



if
((prepped_leftleg and prepped_rightleg) or (prepped_leftleg and tAffs.damagedrightleg) or (prepped_rightleg and tAffs.damagedleftleg)) and not tAffs.prone and not tAffs.rebounding and not tAffs.shield then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
end

if
(prepped_leftleg or prepped_rightleg) and prepped_leftarm and prepped_rightarm and not tAffs.prone and not tAffs.rebounding and not tAffs.shield then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
end



if (tAffs.damagedrightleg or tAffs.damagedleftleg) and (prepped_rightleg or prepped_leftleg) then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epteth")
  
  elseif tAffs.damagedrightleg and tAffs.damagedleftleg  then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epteth")
  
  
  
  elseif (tAffs.damagedrightleg or tAffs.damagedleftleg) and (prepped_rightarm or prepped_leftarm) then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
  
   elseif (tAffs.damagedrightleg or tAffs.damagedleftleg) and (tAffs.damagedrightarm or tAffs.damagedleftarm) then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
  
 elseif (tAffs.damagedrightarm or tAffs.damagedleftarm) and (prepped_rightleg or prepped_leftleg) then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
  
   elseif tAffs.damagedrightarm and tAffs.damagedleftarm then
    table.insert(venoms,"epseth")
  table.insert(venoms,"epseth")


 
end

if tAffs.slickness and not tAffs.anorexia and tAffs.paralysis and not tAffs.stupid then
  table.insert(venoms,"aconite")
  table.insert(venoms,"slike")
  
  end
  




if not tAffs.paralysis then
  table.insert(venoms,"curare")

end

if not tAffs.nausea then
  table.insert(venoms,"euphorbia")

end








if not tAffs.asthma then
  table.insert(venoms,"kalmia")

end

if not tAffs.clumsiness then
  table.insert(venoms,"xentio")

end


if not tAffs.slickness and tAffs.asthma and venoms[1] == "curare" then

  table.insert(venoms,"gecko")

end




if not tAffs.dizziness then
table.insert(venoms,"larkspur")
end


if not tAffs.stupidity then
  table.insert(venoms,"aconite")


end

if not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end





if not tAffs.shyness then
  table.insert(venoms,"digitalis")

end

if not tAffs.sensitivity then

  table.insert(venoms,"prefarar")
  table.insert(venoms,"prefarar")

end



if not tAffs.addiction then

  table.insert(venoms,"vardrax")

end

if not tAffs.darkshade then
  table.insert(venoms,"darkshade")

end




--INVESTS


invest = {}

if venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" and not tAffs.weariness and tAffs.anorexia and tAffs.asthma and tAffs.slickness then invest = "exploit"

elseif venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" and not tAffs.weariness and (venoms[1] == "aconite" or venoms[2] == "aconite") and tAffs.asthma and tAffs.slickness then invest = "exploit"

elseif venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" and tAffs.haemophilia then invest = "agony" 

elseif getMentalAffCount() &gt;= 4 then invest = "punishment" 

else invest = "agony" end
  
  



--ATTACK


local atk = combatQueue()

if tAffs.impaled and tLimbs.T &gt;= 100 then
disembowel = true
else
disembowel = false
end

if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.5) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
(ataxiaNDB_getClass(target) ~= "Apostate" or ataxiaNDB_getClass(target)) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end

if (tLimbs.RL + scimdamage &gt;= 100) and (tLimbs.RL + axedamage &lt; 100) and targetlimb == "right leg" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.RA + scimdamage &gt;= 100) and (tLimbs.RA + axedamage &lt; 100) and targetlimb == "right arm" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.LL + scimdamage &gt;= 100) and (tLimbs.LL + axedamage &lt; 100) and targetlimb == "left leg" then

need_raze3 = true
else
need_raze3 = false
end

if (tLimbs.LA + scimdamage &gt;= 100) and (tLimbs.LA + axedamage &lt; 100) and targetlimb == "left arm" then

need_raze3 = true
else
need_raze3 = false
end

if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end


if (tAffs.brokenrightleg or tAffs.damagedrightleg) and (tAffs.brokenleftleg or tAffs.damagedleftleg)
 and (tAffs.brokenleftarm or tAffs.damagedleftarm)  and  (tAffs.brokenrightarm or tAffs.damagedrightarm) and tAffs.prone then
vivisect = true
else
vivisect = false
end

if tAffs.rebounding and tAffs.shield then
need_shieldraze = true
else
need_shieldraze = false
end

if  tLimbs.LL + scimdamage &gt;= 100 and not tAffs.damagedleftleg then 
prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + scimdamage &gt;= 100 and not tAffs.damagedrightleg then 
prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + scimdamage &gt;= 100 and not tAffs.damagedrightarm then 
prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + scimdamage &gt;= 100 and not tAffs.damagedleftarm then 
prepped_leftarm = true else
prepped_leftarm = false

end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &gt; 50 and ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 and ataxia.vitals.class == 4 then
impale_blackout = true
else
impale_blackout = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 40 then
quash_arc = true
else
quash_arc = false
end


if quash_arc then

atk = "stand/wield shield longsword63894/assess "..target.."/quash "..target.."/arc curare"

elseif vivisect then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";dismount;vivisect "..target

elseif disembowel then 

atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";disembowel "..target



elseif need_shieldraze then
atk = "stand/wield shield longsword63894/assess "..target.."/quash "..target.."/arc curare"


elseif need_raze then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";razeslash "..target.." "..venoms[1]

elseif need_raze2 then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";razeslash "..target.." "..venoms[1]

elseif need_raze3 then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";razeslash "..target.." "..venoms[1]

--elseif prepped_leftleg and prepped_rightleg and not tAffs.prone then

--atk = atk.."wield battleaxe;rampage against "..target..";assess "..target..";hellforge invest "..invest..";undercut "..target.." "..targetlimb.." "..venoms[1]

--elseif prepped_leftleg and prepped_rightarm and not tAffs.prone then

--atk = atk.."wield battleaxe;rampage against "..target..";assess "..target..";hellforge invest "..invest..";undercut "..target.." left leg "..venoms[1]

--elseif prepped_rightleg and prepped_rightarm and not tAffs.prone then

--atk = atk.."wield battleaxe;rampage against "..target..";assess "..target..";hellforge invest "..invest..";undercut "..target.." right leg "..venoms[1]



elseif (invest == "exploit" or invest == "torture" or invest == "torment") and venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" then

atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";envenom scimitar383498 with "..venoms[1]..";dsl "..target



elseif tAffs.prone and tAffs.damagedtorso and tAffs.damagedrightleg and tAffs.damagedleftleg then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";impale "..target

else

atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;assess "..target..";hellforge invest "..invest..";dsl "..target.." "..venoms[1].." "..venoms[2]

end


if not ataxia.settings.paused then

if quash_arc then
send("setalias quasharc "..atk)
send("queue addclear bal quasharc")

elseif not engaged then
send("queue addclear free "..atk..";engage "..target..";tyranny")

else

send("queue addclear free "..atk..";tyranny")

end
end


end</script>
											<eventHandlerList />
										</Script>
										<ScriptGroup isActive="yes" isFolder="yes">
											<name>TWO HANDED</name>
											<packageName></packageName>
											<script></script>
											<eventHandlerList />
											<Script isActive="yes" isFolder="no">
												<name>BAST PRIOS</name>
												<packageName></packageName>
												<script>function infernaltwohandprios()

  venoms = {}


if not tAffs.paralysis then
  table.insert(venoms,"curare")

end

if not tAffs.nausea then
  table.insert(venoms,"euphorbia")

end

if not tAffs.asthma then
  table.insert(venoms,"kalmia")

end

if not tAffs.clumsiness then
  table.insert(venoms,"xentio")

end

if not tAffs.sensitivity then
  table.insert(venoms,"prefarar")

end


if not tAffs.slickness and tAffs.asthma then
  table.insert(venoms,"gecko")

end

infernaltwohand()


end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>LIMBSELECT CLU</name>
												<packageName></packageName>
												<script>function limbselectCLU()


local prepped_speed = prepped_speed or 25
local prepped_precision = prepped_precision or 12.5

local scimdamage = ataxiaTables.limbData.twoHander or 15
local totalfracs = ataxiaTemp.fractures.skullfractures + ataxiaTemp.fractures.crackedribs + ataxiaTemp.fractures.torntendons + ataxiaTemp.fractures.wristfractures 
if totalfracs &gt;= 1 then bfocus = "speed" else bfocus = "precision" end
if scimdamage &lt; 17 then  prepped_precision = scimdamage end
if scimdamage &gt; 17 then  prepped_speed = scimdamage end





--if bfocus == "speed" then limdamage = prepped_speed elseif bfocus == "precision" then limdamage = prepped_precision end
limdamage = prepped_speed

if  tLimbs.LL + limdamage &gt;= 100 and tLimbs.LL &lt; 100 and not tAffs.damagedleftleg then 
 prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + limdamage &gt;= 100 and tLimbs.RL &lt; 100 then 
 prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + limdamage &gt;= 100 and tLimbs.RA &lt; 100 then 
 prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + limdamage &gt;= 100 and tLimbs.LA &lt; 100 then 
 prepped_leftarm = true else
prepped_leftarm = false

end

if  tLimbs.H + limdamage &gt;= 100 and tLimbs.H &lt; 100 then 
 prepped_head = true else
prepped_head = false

end

if  tLimbs.T + limdamage &gt;= 200 and tLimbs.T &lt; 200 then 
 prepped_torso = true else
prepped_torso = false

end

if prepped_rightarm and prepped_leftarm then
arm_prep = true
else
arm_prep = false
end

if prepped_rightleg and prepped_leftleg then
leg_prep = true
else
leg_prep = false
end

if leg_prep and arm_prep then full_prep = true
else
full_prep = false
end

if ataxiaTemp.fractures.skullfractures &gt;= 3 then
can_overwhelm = true
else can_overwhelm = false
end

if  ataxiaTemp.fractures.torntendons &gt;= 6 or (ataxiaTemp.fractures.torntendons &gt;= 4 and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 60) then
can_devastate_legs = true else
can_devastate_legs = false 
end

if  ataxiaTemp.fractures.wristfractures &gt;= 4 then
can_devastate_arms = true else
can_devastate_arms = false 
end

targetlimb = {}

if full_prep then
  table.insert(targetlimb,"right leg")
    table.insert(targetlimb,"left leg")

else


--if not prepped_rightleg then
  table.insert(targetlimb,"right leg")
--end

--if not prepped_leftleg then
  table.insert(targetlimb,"left leg")
--end

--if not prepped_head then
  table.insert(targetlimb,"head")
--end

--if not prepped_rightarm then
  table.insert(targetlimb,"right arm")
--end

--if not prepped_leftarm then
  table.insert(targetlimb,"left arm")
--end

--if not prepped_torso then
  table.insert(targetlimb,"torso")
--end

end

if ataxiaTemp.parriedLimb == targetlimb[1] and not tAffs.prone and targetlimb[2] ~= "torso" then 
targetlimb[1] = targetlimb[2]
elseif 
ataxiaTemp.parriedLimb == targetlimb[1] and not tAffs.prone and targetlimb[2] ~= "torso" then 
targetlimb[1] = targetlimb[3]

end
infernaltwohandhammer()

end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>LIMBSELECT NAU</name>
												<packageName></packageName>
												<script>function limbselectNAU()


local prepped_speed = prepped_speed or 25
local prepped_precision = prepped_precision or 12.5

local scimdamage = ataxiaTables.limbData.twoHander or 15
local totalfracs = ataxiaTemp.fractures.skullfractures + ataxiaTemp.fractures.crackedribs + ataxiaTemp.fractures.torntendons + ataxiaTemp.fractures.wristfractures 
if totalfracs &gt;= 1 then bfocus = "speed" else bfocus = "precision" end
if scimdamage &lt; 17 then  prepped_precision = scimdamage end
if scimdamage &gt; 17 then  prepped_speed = scimdamage end





--if bfocus == "speed" then limdamage = prepped_speed elseif bfocus == "precision" then limdamage = prepped_precision end
limdamage = prepped_speed

if  tLimbs.LL + limdamage &gt;= 100 and tLimbs.LL &lt; 100 and not tAffs.damagedleftleg then 
 prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + limdamage &gt;= 100 and tLimbs.RL &lt; 100 then 
 prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + limdamage &gt;= 100 and tLimbs.RA &lt; 100 then 
 prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + limdamage &gt;= 100 and tLimbs.LA &lt; 100 then 
 prepped_leftarm = true else
prepped_leftarm = false

end

if  tLimbs.H + limdamage &gt;= 100 and tLimbs.H &lt; 100 then 
 prepped_head = true else
prepped_head = false

end

if  tLimbs.T + limdamage &gt;= 200 and tLimbs.T &lt; 200 then 
 prepped_torso = true else
prepped_torso = false

end

if prepped_rightarm and prepped_leftarm then
arm_prep = true
else
arm_prep = false
end

if prepped_rightleg and prepped_leftleg then
leg_prep = true
else
leg_prep = false
end

if leg_prep and arm_prep then full_prep = true
else
full_prep = false
end

if ataxiaTemp.fractures.skullfractures &gt;= 3 then
can_overwhelm = true
else can_overwhelm = false
end

if  ataxiaTemp.fractures.torntendons &gt;= 6 or (ataxiaTemp.fractures.torntendons &gt;= 4 and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 60) then
can_devastate_legs = true else
can_devastate_legs = false 
end

if  ataxiaTemp.fractures.wristfractures &gt;= 4 then
can_devastate_arms = true else
can_devastate_arms = false 
end

targetlimb = {}

if full_prep then
  table.insert(targetlimb,"right leg")
    table.insert(targetlimb,"left leg")

end

--if not prepped_head then
  table.insert(targetlimb,"head")
--end


--if not prepped_rightleg then
  table.insert(targetlimb,"right leg")
--end

--if not prepped_leftleg then
  table.insert(targetlimb,"left leg")
--end


--if not prepped_rightarm then
  table.insert(targetlimb,"right arm")
--end

--if not prepped_leftarm then
  table.insert(targetlimb,"left arm")
--end

--if not prepped_torso then
  table.insert(targetlimb,"torso")
--end



if ataxiaTemp.parriedLimb == targetlimb[1] and not tAffs.prone and targetlimb[2] ~= "torso" then 
targetlimb[1] = targetlimb[2]
elseif 
ataxiaTemp.parriedLimb == targetlimb[1] and not tAffs.prone and targetlimb[2] ~= "torso" then 
targetlimb[1] = targetlimb[3]

end
infernaltwohandhammer()

end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>LIMBSELECT LET</name>
												<packageName></packageName>
												<script>function limbselectLET()


local prepped_speed = prepped_speed or 25
local prepped_precision = prepped_precision or 12.5

local scimdamage = ataxiaTables.limbData.twoHander or 15
local totalfracs = ataxiaTemp.fractures.skullfractures + ataxiaTemp.fractures.crackedribs + ataxiaTemp.fractures.torntendons + ataxiaTemp.fractures.wristfractures 
if totalfracs &gt;= 1 then bfocus = "speed" else bfocus = "precision" end
if scimdamage &lt; 17 then  prepped_precision = scimdamage end
if scimdamage &gt; 17 then  prepped_speed = scimdamage end





--if bfocus == "speed" then limdamage = prepped_speed elseif bfocus == "precision" then limdamage = prepped_precision end
limdamage = prepped_speed

if  tLimbs.LL + limdamage &gt;= 100 and tLimbs.LL &lt; 100 and not tAffs.damagedleftleg then 
 prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + limdamage &gt;= 100 and tLimbs.RL &lt; 100 then 
 prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + limdamage &gt;= 100 and tLimbs.RA &lt; 100 then 
 prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + limdamage &gt;= 100 and tLimbs.LA &lt; 100 then 
 prepped_leftarm = true else
prepped_leftarm = false

end

if  tLimbs.H + limdamage &gt;= 100 and tLimbs.H &lt; 100 then 
 prepped_head = true else
prepped_head = false

end

if  tLimbs.T + limdamage &gt;= 200 and tLimbs.T &lt; 200 then 
 prepped_torso = true else
prepped_torso = false

end

if prepped_rightarm and prepped_leftarm then
arm_prep = true
else
arm_prep = false
end

if prepped_rightleg and prepped_leftleg then
leg_prep = true
else
leg_prep = false
end

if leg_prep and arm_prep then full_prep = true
else
full_prep = false
end

if ataxiaTemp.fractures.skullfractures &gt;= 3 then
can_overwhelm = true
else can_overwhelm = false
end

if  ataxiaTemp.fractures.torntendons &gt;= 6 or (ataxiaTemp.fractures.torntendons &gt;= 4 and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 60) then
can_devastate_legs = true else
can_devastate_legs = false 
end

if  ataxiaTemp.fractures.wristfractures &gt;= 4 then
can_devastate_arms = true else
can_devastate_arms = false 
end

targetlimb = {}

if full_prep then
  table.insert(targetlimb,"right leg")
    table.insert(targetlimb,"left leg")

end

if not prepped_rightarm then
  table.insert(targetlimb,"right arm")
end

if not prepped_leftarm then
  table.insert(targetlimb,"left arm")
end

if not prepped_rightleg then
  table.insert(targetlimb,"right leg")
end

if not prepped_leftleg then
  table.insert(targetlimb,"left leg")
end

if not prepped_head then
  table.insert(targetlimb,"head")
end



if not prepped_torso then
  table.insert(targetlimb,"torso")
end



if ataxiaTemp.parriedLimb == targetlimb[1] and not tAffs.prone and targetlimb[2] ~= "torso" then 
targetlimb[1] = targetlimb[2]
elseif 
ataxiaTemp.parriedLimb == targetlimb[1] and not tAffs.prone and targetlimb[2] ~= "torso" then 
targetlimb[1] = targetlimb[3]

end
infernaltwohandhammer()

end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>LIMBSELECT SEN</name>
												<packageName></packageName>
												<script>function limbselectSEN()


local prepped_speed = prepped_speed or 25
local prepped_precision = prepped_precision or 12.5

local scimdamage = ataxiaTables.limbData.twoHander or 15
local totalfracs = ataxiaTemp.fractures.skullfractures + ataxiaTemp.fractures.crackedribs + ataxiaTemp.fractures.torntendons + ataxiaTemp.fractures.wristfractures 
if totalfracs &gt;= 2 then bfocus = "speed" else bfocus = "precision" end
if scimdamage &lt; 17 then  prepped_precision = scimdamage end
if scimdamage &gt; 17 then  prepped_speed = scimdamage end





--if bfocus == "speed" then limdamage = prepped_speed elseif bfocus == "precision" then limdamage = prepped_precision end
limdamage = prepped_speed

if  tLimbs.LL + limdamage &gt;= 100 and tLimbs.LL &lt; 100 and not tAffs.damagedleftleg then 
 prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + limdamage &gt;= 100 and tLimbs.RL &lt; 100 then 
 prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + limdamage &gt;= 100 and tLimbs.RA &lt; 100 then 
 prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + limdamage &gt;= 100 and tLimbs.LA &lt; 100 then 
 prepped_leftarm = true else
prepped_leftarm = false

end

if  tLimbs.H + limdamage &gt;= 100 and tLimbs.H &lt; 100 then 
 prepped_head = true else
prepped_head = false

end

if  tLimbs.T + limdamage &gt;= 200 and tLimbs.T &lt; 200 then 
 prepped_torso = true else
prepped_torso = false

end

if prepped_rightarm and prepped_leftarm then
arm_prep = true
else
arm_prep = false
end

if prepped_rightleg and prepped_leftleg then
leg_prep = true
else
leg_prep = false
end

if leg_prep and arm_prep then full_prep = true
else
full_prep = false
end

if ataxiaTemp.fractures.skullfractures &gt;= 3 then
can_overwhelm = true
else can_overwhelm = false
end

if  ataxiaTemp.fractures.torntendons &gt;= 6 or (ataxiaTemp.fractures.torntendons &gt;= 4 and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 60) then
can_devastate_legs = true else
can_devastate_legs = false 
end

if  ataxiaTemp.fractures.wristfractures &gt;= 4 then
can_devastate_arms = true else
can_devastate_arms = false 
end

targetlimb = {}

if full_prep then
  table.insert(targetlimb,"right leg")
    table.insert(targetlimb,"left leg")

end

if not prepped_torso then
  table.insert(targetlimb,"torso")
end


if not prepped_rightleg then
  table.insert(targetlimb,"right leg")
end

if not prepped_leftleg then
  table.insert(targetlimb,"left leg")
end

if not prepped_head then
  table.insert(targetlimb,"head")
end

if not prepped_rightarm then
  table.insert(targetlimb,"right arm")
end

if not prepped_leftarm then
  table.insert(targetlimb,"left arm")
end




if ataxiaTemp.parriedLimb == targetlimb[1] and not tAffs.prone and targetlimb[2] ~= "torso" then 
targetlimb[1] = targetlimb[2]
elseif 
ataxiaTemp.parriedLimb == targetlimb[1] and not tAffs.prone and targetlimb[2] ~= "torso" then 
targetlimb[1] = targetlimb[3]

end

infernaltwohandhammer()
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>WAR Devastate</name>
												<packageName></packageName>
												<script>function infernaltwohandhammerdev()
			--	ataxia_breakLock()






local prepped_speed = prepped_speed or 25
local prepped_precision = prepped_precision or 12.5

local scimdamage = ataxiaTables.limbData.twoHander or 15
local totalfracs = ataxiaTemp.fractures.skullfractures + ataxiaTemp.fractures.crackedribs + ataxiaTemp.fractures.torntendons + ataxiaTemp.fractures.wristfractures 
if totalfracs &gt;= 1 then bfocus = "speed" else bfocus = "precision" end
if scimdamage &lt; 17 then  prepped_precision = scimdamage end
if scimdamage &gt; 17 then  prepped_speed = scimdamage end





--if bfocus == "speed" then limdamage = prepped_speed elseif bfocus == "precision" then limdamage = prepped_precision end
limdamage = prepped_speed

if  tLimbs.LL + limdamage &gt;= 100 and tLimbs.LL &lt; 100 and not tAffs.damagedleftleg then 
 prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + limdamage &gt;= 100 and tLimbs.RL &lt; 100 then 
 prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + limdamage &gt;= 100 and tLimbs.RA &lt; 100 then 
 prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + limdamage &gt;= 100 and tLimbs.LA &lt; 100 then 
 prepped_leftarm = true else
prepped_leftarm = false

end

if  tLimbs.H + limdamage &gt;= 100 and tLimbs.H &lt; 100 then 
 prepped_head = true else
prepped_head = false

end

if  tLimbs.T + limdamage &gt;= 200 and tLimbs.T &lt; 200 then 
 prepped_torso = true else
prepped_torso = false

end

if prepped_rightarm and prepped_leftarm then
arm_prep = true
else
arm_prep = false
end

if prepped_rightleg and prepped_leftleg then
leg_prep = true
else
leg_prep = false
end

if leg_prep and arm_prep then full_prep = true
else
full_prep = false
end

if ataxiaTemp.fractures.skullfractures &gt;= 3 then
can_overwhelm = true
else can_overwhelm = false
end

if  ataxiaTemp.fractures.torntendons &gt;= 6 or (ataxiaTemp.fractures.torntendons &gt;= 4 and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 60) then
can_devastate_legs = true else
can_devastate_legs = false 
end

if  ataxiaTemp.fractures.wristfractures &gt;= 4 then
can_devastate_arms = true else
can_devastate_arms = false 
end

targetlimb = {}

if full_prep then
  table.insert(targetlimb,"right leg")
    table.insert(targetlimb,"left leg")

end



if not prepped_rightleg then
  table.insert(targetlimb,"right leg")
end

if not prepped_leftleg then
  table.insert(targetlimb,"left leg")
end


if not prepped_rightarm then
  table.insert(targetlimb,"right arm")
end

if not prepped_leftarm then
  table.insert(targetlimb,"left arm")
end

if not prepped_head then
  table.insert(targetlimb,"head")
end


if not prepped_torso then
  table.insert(targetlimb,"torso")
end



if ataxiaTemp.parriedLimb == targetlimb[1] and not tAffs.prone and targetlimb[2] ~= "torso" then 
targetlimb[1] = targetlimb[2]
elseif 
ataxiaTemp.parriedLimb == targetlimb[1] and not tAffs.prone and targetlimb[2] ~= "torso" then 
targetlimb[1] = targetlimb[3]

end




























local atk = combatQueue()
--INVESTS

devastated = devastated or false
if precision_hit then bfocus = "precision" 
elseif not tBals.salve then bfocus = "precision" else bfocus = bfocus end

 venoms = {}


if not tAffs.slickness and tAffs.asthma then
  table.insert(venoms,"gecko")

end

if not tAffs.paralysis then
  table.insert(venoms,"curare")

end

if not tAffs.asthma then
  table.insert(venoms,"kalmia")

end








invest = {}



if not tAffs.healthleech then invest = "torment"


elseif not tAffs.haemophilia then invest = "torture"

elseif not tAffs.weariness then invest = "exploit"


elseif getMentalAffCount() &gt;= 4 then invest = "punishment" 

else invest = "torment" end




--ATTACK



if tAffs.impaled then
disembowel = true
else
disembowel = false
end




if tAffs.rebounding then

need_raze = true
else
need_raze = false
end

if tAffs.shield then

need_raze2 = true
else
need_raze2 = false
end




if (tAffs.brokenrightleg or tAffs.damagedrightleg) and (tAffs.brokenleftleg or tAffs.damagedleftleg)
 and (tAffs.brokenleftarm or tAffs.damagedleftarm)  and  (tAffs.brokenrightarm or tAffs.damagedrightarm) then
vivisect = true
else
vivisect = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 20 then
quash_arc = true
else
quash_arc = false
end




if quash_arc then

atk = "stand/wield shield longsword/assess "..target.."/quash "..target.."/arc curare"

elseif vivisect then
atk = atk.."assess "..target..";wipe "..wield_weapon..";hellforge invest "..invest..";dismount;vivisect "..target..";battlefury perceive "..target

elseif disembowel
then 


atk = atk.."battlefury focus speed;hellforge invest "..invest..";disembowel "..target..";battlefury perceive "..target..";assess "..target

elseif tAffs.prone and devastated then

atk = atk.."wield bastard;wipe bastard;battlefury perceive "..target..";hellforge invest "..invest..";battlefury focus speed;impale "..target..";assess "..target


elseif need_raze or need_raze2 then
bfocus = "speed"
atk = atk.."wield warhammer;wipe warhammer;battlefury perceive "..target..";battlefury focus "..bfocus..";hellforge invest "..invest..";splinter "..target..";assess "..target


elseif can_devastate_legs then

atk = atk.."wield warhammer;wipe warhammer;hellforge invest "..invest..";devastate "..target.." legs;battlefury upset "..target..";assess "..target


elseif tAffs.prone and can_overwhelm then

atk = atk.."wield warhammer;wipe warhammer;hellforge invest "..invest..";battlefury overwhelm "..target..";fury;brain "..target..";assess "..target

elseif leg_prep and not tAffs.prone then

atk = atk.."wield warhammer;wipe warhammer;hellforge invest "..invest..";pulverise "..target.." right leg;battlefury upset "..target..";assess "..target

elseif tAffs.damagedrightleg and tAffs.prone then

atk = atk.."wield warhammer;wipe warhammer;hellforge invest "..invest..";pulverise "..target.." left leg;battlefury upset "..target..";assess "..target

elseif targetlimb[1] == "right leg" or targetlimb[1] == "left leg" or targetlimb[1] == "left arm" or targetlimb[1] == "right arm" then

atk = atk.."wield warhammer;wipe warhammer;battlefury perceive "..target..";battlefury focus speed;hellforge invest "..invest..";pulverise "..target.." "..targetlimb[1]..";assess "..target


elseif    targetlimb[1] == "head"  then

atk = atk.."wield warhammer;wipe warhammer;battlefury perceive "..target..";battlefury focus precision;hellforge invest "..invest..";overhand "..target..";assess "..target


else
atk = atk.."wield warhammer;wipe warhammer;battlefury perceive "..target..";battlefury focus "..bfocus..";hellforge invest "..invest..";slaughter "..target..";battlefury perceive "..target..";assess "..target


end



if table.contains(ataxia.playersHere, target) then

if gmcp.Char.Vitals.bal == "0"
or gmcp.Char.Vitals.eq == "0"
then
send("cq all")
end

if gmcp.Char.Vitals.bal == "1"
and gmcp.Char.Vitals.eq == "1" then

if quash_arc then
send("setalias quasharc "..atk)
send("queue addclear free quasharc")

elseif not engaged then
send("queue addclear free discipline;"..atk..";engage "..target..";tyranny;order hyena kill "..target)

else

send("queue addclear free discipline;"..atk..";tyranny")

end
end

end

end

</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>WAR BASIC</name>
												<packageName></packageName>
												<script>function infernaltwohandhammer()
			--	ataxia_breakLock()

local atk = combatQueue()
--INVESTS

devastated = devastated or false
if precision_hit then bfocus = "precision" 
elseif not tBals.salve then bfocus = "precision" else bfocus = bfocus end
can_brain = ataxiaTemp.fractures.skullfractures
if can_brain == 1 then can_brain = 10 end
if can_brain == 2 then can_brain = 20 end
if can_brain == 3 then can_brain = 30 end
if can_brain == 4 then can_brain = 40 end
if can_brain == 5 then can_brain = 50 end
if can_brain == 6 then can_brain = 60 end
if can_brain == 7 then can_brain = 70 end
if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess - can_brain  &lt;= 20 and not battlefury_overwhelm then
need_overwhelm = true else need_overwhelm = false end

if tAffs.sensitivity and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess - can_brain  &lt;= 40 and not battlefury_overwhelm then
need_overwhelm2 = true else need_overwhelm2 = false end





 venoms = {}


if not tAffs.slickness and tAffs.asthma then
  table.insert(venoms,"gecko")

end

if not tAffs.paralysis then
  table.insert(venoms,"curare")

end

if not tAffs.asthma then
  table.insert(venoms,"kalmia")

end








invest = {}


if not tAffs.healthleech then invest = "torment"


elseif not tAffs.weariness then invest = "exploit"





elseif not tAffs.haemophilia then invest = "torture"


elseif getMentalAffCount() &gt;= 4 then invest = "punishment" 

else invest = "torment" end




--ATTACK



if tAffs.impaled then
disembowel = true
else
disembowel = false
end




if tAffs.rebounding then

need_raze = true
else
need_raze = false
end

if tAffs.shield then

need_raze2 = true
else
need_raze2 = false
end




if (tAffs.brokenrightleg or tAffs.damagedrightleg) and (tAffs.brokenleftleg or tAffs.damagedleftleg)
 and (tAffs.brokenleftarm or tAffs.damagedleftarm)  and  (tAffs.brokenrightarm or tAffs.damagedrightarm) then
vivisect = true
else
vivisect = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 20 then
quash_arc = true
else
quash_arc = false
end




if quash_arc then

atk = "stand/wield shield longsword/assess "..target.."/quash "..target.."/arc curare"

elseif vivisect then
atk = atk.."assess "..target..";wipe "..wield_weapon..";hellforge invest "..invest..";dismount;vivisect "..target..";battlefury perceive "..target

elseif disembowel then 

atk = atk.."battlefury focus speed;hellforge invest "..invest..";disembowel "..target..";battlefury perceive "..target..";assess "..target

elseif tAffs.prone and devastated then

atk = atk.."wield bastard;wipe bastard;battlefury perceive "..target..";hellforge invest "..invest..";battlefury focus speed;impale "..target..";assess "..target


elseif need_raze or need_raze2 then
bfocus = "speed"
atk = atk.."wield warhammer;wipe warhammer;battlefury perceive "..target..";battlefury focus "..bfocus..";hellforge invest "..invest..";splinter "..target..";assess "..target


elseif battlefury_overwhelm == true then

atk = atk.."wield warhammer;wipe warhammer;assess "..target..";hellforge invest "..invest..";battlefury focus speed;brain "..target


elseif need_overwhelm or need_overwhelm2 then

atk = atk.."wield warhammer;wipe warhammer;assess "..target..";hellforge invest "..invest..";battlefury overwhelm "..target..";fury"





elseif can_devastate_legs then

atk = atk.."wield warhammer;wipe warhammer;hellforge invest "..invest..";devastate "..target.." legs;battlefury upset "..target..";assess "..target



elseif leg_prep and not tAffs.prone and ataxiaTemp.parriedLimb == "head" then

atk = atk.."wield warhammer;wipe warhammer;hellforge invest "..invest..";pulverise "..target.." right leg;battlefury upset "..target..";assess "..target


elseif full_prep then

atk = atk.."wield warhammer;wipe warhammer;hellforge invest "..invest..";pulverise "..target.." "..targetlimb..";battlefury upset "..target..";assess "..target



elseif can_devastate_arms then

atk = atk.."wield "..wield_weapon..";wipe "..wield_weapon..";devastate "..target.." arms;battlefury upset "..target..";assess "..target


elseif wield_weapon == "bastard" and targetlimb[1] == "right leg" or targetlimb[1] == "left leg" or targetlimb[1] == "left arm" or targetlimb[1] == "right arm" then

atk = atk.."wield bastard;wipe bastard;battlefury perceive "..target..";battlefury focus "..bfocus..";hew "..target.." "..targetlimb[1].." "..venoms[1]..";assess "..target




elseif wield_weapon == "warhammer" and targetlimb[1] == "right leg" or targetlimb[1] == "left leg" or targetlimb[1] == "left arm" or targetlimb[1] == "right arm" then

atk = atk.."wield warhammer;wipe warhammer;battlefury perceive "..target..";battlefury focus "..bfocus..";hellforge invest "..invest..";pulverise "..target.." "..targetlimb[1]..";assess "..target

elseif targetlimb[1] == "torso" and wield_weapon == "bastard"  then

atk = atk.."wield bastard;wipe bastard;battlefury perceive "..target..";battlefury focus "..bfocus..";underhand "..target.." "..venoms[1]..";assess "..target


elseif targetlimb[1] == "torso" and wield_weapon == "warhammer" then

atk = atk.."wield warhammer;wipe warhammer;battlefury perceive "..target..";battlefury focus "..bfocus..";hellforge invest "..invest..";underhand "..target..";assess "..target


elseif    targetlimb[1] == "head" and wield_weapon == "bastard"  then

atk = atk.."wield bastard;wipe bastard;battlefury perceive "..target..";battlefury focus "..bfocus..";overhand "..target.." "..venoms[1]..";assess "..target




elseif    targetlimb[1] == "head" and wield_weapon == "warhammer"  then

atk = atk.."wield warhammer;wipe warhammer;battlefury perceive "..target..";battlefury focus "..bfocus..";hellforge invest "..invest..";overhand "..target..";assess "..target


else
atk = atk.."wield warhammer;wipe warhammer;battlefury perceive "..target..";battlefury focus "..bfocus..";hellforge invest "..invest..";slaughter "..target..";battlefury perceive "..target..";assess "..target


end
if bfocus == "precision" then wield_weapon = "warhammer" elseif bfocus == "speed" then wield_weapon = "bastard" 
else wield_weapon = "warhammer" 

end


if not ataxia.afflictions.aeon then
if table.contains(ataxia.playersHere, target) then

if gmcp.Char.Vitals.bal == "0"
or gmcp.Char.Vitals.eq == "0"
then
send("cq all")
end

if gmcp.Char.Vitals.bal == "1"
and gmcp.Char.Vitals.eq == "1" then

if quash_arc then
send("setalias quasharc "..atk)
send("queue addclear free quasharc")

elseif not engaged then
send("queue addclear freestand discipline;"..atk..";engage "..target..";tyranny;order hyena kill "..target)

else

send("queue addclear freestand discipline;"..atk..";tyranny")

end
end

end

end
end
</script>
												<eventHandlerList />
											</Script>
										</ScriptGroup>
										<ScriptGroup isActive="yes" isFolder="yes">
											<name>S n B</name>
											<packageName></packageName>
											<script></script>
											<eventHandlerList />
											<Script isActive="yes" isFolder="no">
												<name>DAMAGE</name>
												<packageName></packageName>
												<script>function infernalpriosdamage()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()
add_dedication = add_dedication or false
need_raze = need_raze or false
partyrelay = partyrelay or false
strikingHigh = true

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  



  
  

--SHIELDNEED

  shieldneed = {}
  


if tAffs.slickness and tBals.focus and not tAffs.anorexia then
    table.insert(shieldneed,"smash high")


elseif tAffs.anorexia and tAffs.slickness then
    table.insert(shieldneed,"smash high")



elseif treelock  then
    table.insert(shieldneed,"smash high")



elseif not tAffs.paralysis then
    table.insert(shieldneed,"smash mid")
    
elseif not tAffs.asthma then
    table.insert(shieldneed,"drive")
    
    
elseif not tAffs.clumsiness then
    table.insert(shieldneed,"smash low")
    

else
    table.insert(shieldneed,"smash high")
end

















--SWORDLIST

swordneed = {}


if not tAffs.paralysis and shieldneed[1] ~= "smash mid" and softlock then
    table.insert(swordneed, "combination "..target.." slice curare")
end

if not tAffs.slickness and tAffs.asthma then
     table.insert(swordneed,"combination "..target.." slice gecko")
end

--if not tAffs.slickness and tAffs.asthma and tAffs.weariness then
--     table.insert(swordneed,"combination "..target.." slice gecko")
--end


if tAffs.anorexia and not tAffs.stupidity then
   table.insert(swordneed,"combination "..target.." slice aconite")
   end

if tAffs.anorexia and not tAffs.recklessness then
   table.insert(swordneed,"combination "..target.." slice eurypteria")
   end
if tAffs.anorexia and not tAffs.dizziness then
   table.insert(swordneed,"combination "..target.." slice larkspur")
   end

if tAffs.anorexia and not tAffs.shyness then
   table.insert(swordneed,"combination "..target.." slice digitalis")
   end

if not tAffs.anorexia and tAffs.slickness and tBals.focus then
    table.insert(swordneed,"combination "..target.." slice slike")
end


if not softlock and not tAffs.healthleech then
 table.insert(swordneed,"wipe longsword;hellforge invest torment;combination "..target.." slice")
end


if not softlock and not tAffs.haemophilia then
table.insert(swordneed,"wipe longsword;hellforge invest torture;combination "..target.." slice")
end

if not tAffs.asthma and shieldneed[1] ~= "drive" then
      table.insert(swordneed,"combination "..target.." slice kalmia")
end





   if not tAffs.weariness then
    table.insert(swordneed,"wipe longsword;hellforge invest exploit;combination "..target.." slice")
end



if not tAffs.nausea then
      table.insert(swordneed,"combination "..target.." slice euphorbia")
end



if not tAffs.addiction then
  table.insert(swordneed,"combination "..target.." slice vardrax")
end






if not softlock and not tAffs.sensitivity then
  table.insert(swordneed,"combination "..target.." slice prefarar")
end





if not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    table.insert(swordneed,"combination "..target.." slice curare")
end



if not tAffs.asthma and shieldneed[1] ~= "drive" then
  table.insert(swordneed,"combination "..target.." slice kalmia")
end




if tAffs.prone and tAffs.paralysis and tAffs.slickness then
table.insert(swordneed,"combination "..target.." slice epseth")
   end
   
   if softlock and not tAffs.paralysis then
table.insert(swordneed,"combination "..target.." slice curare")
   end


   

   




--ATTACK



if tAffs.rebounding and not tAffs.shield then

need_raze = true
else
need_raze = false
end

if tAffs.shield and not tAffs.rebounding then

need_raze2 = true
else
need_raze2 = false
end

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end

if tAffs.healthleech and tAffs.sensitivity and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 60 then
quash_arc1 = true
else
quash_arc1 = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 then
quash_arc = true
else
quash_arc = false
end

if tAffs.shield and tAffs.rebounding then
quash_arc2 = true
else
quash_arc2 = false
end



if quash_arc or quash_arc1 or quash_arc2 then

atk = "stand;wield shield longsword;hellforge invest torment;quash "..target..";arc/;ssess "..target

elseif need_raze or need_raze2 then
atk = atk.."wield shield longsword;assess "..target..";combination raze "..target.." "..shieldneed[1]

elseif ferocity_full and tLimbs.RL &lt; 100 and tLimbs.RL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice right leg slike smash high"

elseif ferocity_full and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"


elseif ferocity_full and not tAffs.sensitivity then

atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." mid;"..swordneed[1].." "..shieldneed[1]

elseif ferocity_full and not tAffs.slickness and tAffs.asthma and tAffs.sensitivity
 and not tAffs.prone then

atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"

elseif ferocity_full and not tAffs.slickness and tAffs.asthma and tAffs.sensitivity
 and not tAffs.prone then

atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"


--and ataxiaNDB_getClass(target) ~= "Apostate" and ataxiaNDB_getClass(target) ~= "Priest"

else
atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]

end

if table.contains(ataxia.playersHere, target) then


if quash_arc or quash_arc1 or quash_arc2 then
send("setalias quasharc "..atk)
send("queue addclear free quasharc")

elseif not engaged then
send("queue addclear free land;"..atk..";engage "..target..";order hyena kill "..target)

elseif ataxia.afflictions.paralysis == true  then

send("queue addclear free dedication;"..atk..";tyranny")

else

send("queue addclear free land;"..atk..";tyranny")

end


end

end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>IMPALE</name>
												<packageName></packageName>
												<script>function infernalpriosimpale()

local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
strikingHigh = false

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  

targetlimb = ""
if tAffs.nausea or tAffs.paralysis or tAffs.prone then
if  not torso_prepped then targetlimb = "torso" elseif torso_prepped and not right_leg_prepped then targetlimb = "right leg" 
end end

  
  

--SHIELDNEED

  shieldneed = {}
  


if tAffs.slickness and tBals.focus and not tAffs.anorexia then
    table.insert(shieldneed,"smash high")


elseif tAffs.anorexia and tAffs.slickness then
    table.insert(shieldneed,"smash high")



elseif treelock  then
    table.insert(shieldneed,"smash high")



elseif not tAffs.paralysis then
    table.insert(shieldneed,"smash mid")
    
elseif not tAffs.asthma then
    table.insert(shieldneed,"drive")
    
    
elseif not tAffs.clumsiness then
    table.insert(shieldneed,"smash low")
    

else
    table.insert(shieldneed,"smash high")
end

















--SWORDLIST

swordneed = {}



if not tAffs.paralysis and shieldneed[1] ~= "smash mid" and softlock then
    table.insert(swordneed, "combination "..target.." slice "..targetlimb.." curare")
end

if not tAffs.slickness and tAffs.asthma then
     table.insert(swordneed,"combination "..target.." slice "..targetlimb.." gecko")
end

--if not tAffs.slickness and tAffs.asthma and tAffs.weariness then
--     table.insert(swordneed,"combination "..target.." slice gecko")
--end


if tAffs.anorexia and not tAffs.stupidity then
   table.insert(swordneed,"combination "..target.." slice "..targetlimb.." aconite")
   end

if tAffs.anorexia and not tAffs.recklessness then
   table.insert(swordneed,"combination "..target.." slice "..targetlimb.." eurypteria")
   end
if tAffs.anorexia and not tAffs.dizziness then
   table.insert(swordneed,"combination "..target.." slice "..targetlimb.." larkspur")
   end

if tAffs.anorexia and not tAffs.shyness then
   table.insert(swordneed,"combination "..target.." slice "..targetlimb.." digitalis")
   end

if not tAffs.anorexia and tAffs.slickness and tBals.focus then
    table.insert(swordneed,"combination "..target.." slice "..targetlimb.." slike")
end

if not tAffs.nausea then
      table.insert(swordneed,"combination "..target.." slice euphorbia")
end



if not softlock and not tAffs.healthleech then
 table.insert(swordneed,"wipe longsword;hellforge invest torment;combination "..target.." slice "..targetlimb)
end


if not softlock and not tAffs.haemophilia then
table.insert(swordneed,"wipe longsword;hellforge invest torture;combination "..target.." slice "..targetlimb)
end

if not tAffs.asthma and shieldneed[1] ~= "drive" then
      table.insert(swordneed,"combination "..target.." slice kalmia")
end





   if not tAffs.weariness then
    table.insert(swordneed,"wipe longsword;hellforge invest exploit;combination "..target.." slice "..targetlimb)
end





if not tAffs.addiction then
  table.insert(swordneed,"combination "..target.." slice "..targetlimb.." vardrax")
end






if not softlock and not tAffs.sensitivity then
  table.insert(swordneed,"combination "..target.." slice "..targetlimb.." prefarar")
end





if not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    table.insert(swordneed,"combination "..target.." slice "..targetlimb.." curare")
end



if not tAffs.asthma and shieldneed[1] ~= "drive" then
  table.insert(swordneed,"combination "..target.." slice "..targetlimb.." kalmia")
end




if tAffs.prone and tAffs.paralysis and tAffs.slickness then
table.insert(swordneed,"combination "..target.." slice "..targetlimb.." epseth")
   end
   
   if softlock and not tAffs.paralysis then
   table.insert(swordneed,"combination "..target.." slice "..targetlimb.." curare")
   end


   

   




--ATTACK




if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.7) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
ataxiaNDB_getClass(target) ~= "Apostate" and ataxiaNDB_getClass(target) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end



if tAffs.rebounding then

need_raze = true
else
need_raze = false
end

if tAffs.shield then

need_raze2 = true
else
need_raze2 = false
end

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end



if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
quash_arc = true
else
quash_arc = false
end

if tAffs.shield and tAffs.rebounding then
quash_arc2 = true
else
quash_arc2 = false
end


if tLimbs.RL + ataxiaTables.limbData.snbSlice &gt;= 100 and tLimbs.RL &lt; 100 then 
right_leg_prepped = true
else
right_leg_prepped = false
end

if tLimbs.T + ataxiaTables.limbData.snbSlice &gt;= 100 and tLimbs.T &lt; 100 then 
torso_prepped = true
else
torso_prepped = false
end

if tLimbs.LL + ataxiaTables.limbData.snbSlice &gt;= 100 and tLimbs.LL &lt; 100 then 
left_leg_prepped = true
else
left_leg_prepped = false
end

if tLimbs.H + ataxiaTables.limbData.snbSlice &gt;= 100 and tLimbs.H &lt; 100 then 
head_prepped = true
else
head_prepped = false
end



if ataxia.vitals.class == 4 and tAffs.blackout then
impale_blackout = true
else
impale_blackout = false
end

if tAffs.impaled and tLimbs.T &gt;= 100 then
disembowel = true
else
disembowel = false
end





if disembowel then
atk = atk.."wield longsword shield;disembowel "..target



elseif ferocity_full and (tAffs.damagedrightleg or tAffs.damagedleftleg) and tLimbs.T &gt;= 100 and tAffs.prone then

atk = atk.."wield longsword shield;assess "..target..";shieldstrike "..target.." high;combination "..target.." impale club"

elseif not ferocity_full and (tAffs.damagedrightleg or tAffs.damagedleftleg) and tLimbs.T &gt;= 100 and tAffs.prone then

atk = atk.."wield longsword shield;assess "..target..";combination "..target.." impale club"

elseif quash_arc or quash_arc1 or quash_arc2 then

atk = "stand/wield shield longsword/quash "..target.."/arc curare/assess "..target


elseif need_raze or need_raze2 then
atk = atk.."wield longsword shield;assess "..target..";combination raze "..target.." "..shieldneed[1]


elseif (right_leg_prepped or left_leg_prepped) and not tAffs.prone and not ferocity_full and tLimbs.T &gt;= 100 then

atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." trip"

elseif (right_leg_prepped or left_leg_prepped) and not tAffs.prone and ferocity_full and tLimbs.T &gt;= 100 then

atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"

elseif (right_leg_prepped or left_leg_prepped) and not tAffs.prone and ferocity_full and torso_prepped then
targetlimb = "torso"

atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"

elseif (tAffs.damagedrightleg or tAffs.damagedleftleg) and tLimbs.T &lt; 100 and tAffs.prone then
targetlimb = "torso"

atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." "..shieldneed[1]


elseif ferocity_full and not tAffs.sensitivity then

atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." mid;"..swordneed[1].." "..shieldneed[1]

elseif tAffs.nausea or tAffs.paralysis or tAffs.prone then

atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." "..shieldneed[1]



else
atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." "..shieldneed[1]

end

if quash_arc or quash_arc1 or quash_arc2 then
send("setalias quasharc "..atk)
send("queue addclear eq quasharc")

elseif not engaged then
send("queue addclear free "..atk..";engage "..target..";order hyena kill "..target)

elseif ataxia.afflictions.paralysis == true then

send("queue addclear free dedication;"..atk..";tyranny")

else

send("queue addclear free land;"..atk..";tyranny")




end
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>HEAD TORSO toggle</name>
												<packageName></packageName>
												<script>function infernalprioshead()

local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
strikingHigh = true

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  

targetlimb = ""
if tAffs.nausea or tAffs.paralysis or tAffs.prone then
if  not head_prepped then targetlimb = "head" 
elseif head_prepped and tAffs.asthma then targetlimb = "head"
elseif head_prepped and not torso_prepped and not tAffs.asthma then targetlimb = "torso" 
end end

  
  

--SHIELDNEED

  shieldneed = {}
  


if tAffs.slickness and tBals.focus and not tAffs.anorexia then
    table.insert(shieldneed,"smash high")


elseif tAffs.anorexia and tAffs.slickness then
    table.insert(shieldneed,"smash high")



elseif treelock  then
    table.insert(shieldneed,"smash high")



elseif not tAffs.paralysis then
    table.insert(shieldneed,"smash mid")
    
    elseif not tAffs.clumsiness then
    table.insert(shieldneed,"smash low")
    
    
elseif not tAffs.asthma then
    table.insert(shieldneed,"drive")
    
    


else
    table.insert(shieldneed,"smash high")
end















--SWORDLIST

swordneed = {}



if not tAffs.paralysis and shieldneed[1] ~= "smash mid" and softlock then
    table.insert(swordneed, "combination "..target.." slice "..targetlimb.." curare")
end

if not tAffs.slickness and shieldneed[1] == "drive" then
     table.insert(swordneed,"combination "..target.." slice "..targetlimb.." gecko")
end

if not tAffs.slickness and tAffs.asthma then
     table.insert(swordneed,"combination "..target.." slice "..targetlimb.." gecko")
end


if tAffs.anorexia and not tAffs.stupidity then
   table.insert(swordneed,"combination "..target.." slice "..targetlimb.." aconite")
   end

if tAffs.anorexia and not tAffs.recklessness then
   table.insert(swordneed,"combination "..target.." slice "..targetlimb.." eurypteria")
   end
if tAffs.anorexia and not tAffs.dizziness then
   table.insert(swordneed,"combination "..target.." slice "..targetlimb.." larkspur")
   end

if tAffs.anorexia and not tAffs.shyness then
   table.insert(swordneed,"combination "..target.." slice "..targetlimb.." digitalis")
   end

if not tAffs.anorexia and tAffs.slickness and tBals.focus then
    table.insert(swordneed,"combination "..target.." slice "..targetlimb.." slike")
end



if not tAffs.nausea then
      table.insert(swordneed,"combination "..target.." slice "..targetlimb.." euphorbia")
end

if not tAffs.asthma and shieldneed[1] ~= "drive" and head_prepped then
  table.insert(swordneed,"combination "..target.." slice "..targetlimb.." kalmia")
end




if not softlock and not tAffs.healthleech then
 table.insert(swordneed,"wipe longsword;hellforge invest torment;combination "..target.." slice "..targetlimb)
end

if not softlock and not tAffs.haemophilia then
table.insert(swordneed,"wipe longsword;hellforge invest torture;combination "..target.." slice "..targetlimb)
end




if not tAffs.asthma and shieldneed[1] ~= "drive" then
  table.insert(swordneed,"combination "..target.." slice "..targetlimb.." kalmia")
end


if not tAffs.addiction then
  table.insert(swordneed,"combination "..target.." slice "..targetlimb.." vardrax")
end





   if not tAffs.weariness then
    table.insert(swordneed,"wipe longsword;hellforge invest exploit;combination "..target.." slice "..targetlimb)
end







if not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    table.insert(swordneed,"combination "..target.." slice "..targetlimb.." curare")
end



if not softlock and not tAffs.sensitivity then
  table.insert(swordneed,"combination "..target.." slice "..targetlimb.." prefarar")
end



if tAffs.prone and tAffs.paralysis and tAffs.slickness then
table.insert(swordneed,"combination "..target.." slice "..targetlimb.." epseth")
   end
   
   if softlock and not tAffs.paralysis then
   table.insert(swordneed,"combination "..target.." slice "..targetlimb.." curare")
   end


   

   




--ATTACK




if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.7) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
ataxiaNDB_getClass(target) ~= "Apostate" and ataxiaNDB_getClass(target) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end



if tAffs.rebounding then

need_raze = true
else
need_raze = false
end

if tAffs.shield then

need_raze2 = true
else
need_raze2 = false
end

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end



if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
quash_arc = true
else
quash_arc = false
end

if tAffs.shield and tAffs.rebounding then
quash_arc2 = true
else
quash_arc2 = false
end


if tLimbs.RL + ataxiaTables.limbData.snbSlice &gt;= 100 and tLimbs.RL &lt; 100 then 
right_leg_prepped = true
else
right_leg_prepped = false
end

if tLimbs.T + ataxiaTables.limbData.snbSlice &gt;= 100 and tLimbs.T &lt; 100 then 
torso_prepped = true
else
torso_prepped = false
end

if tLimbs.LL + ataxiaTables.limbData.snbSlice &gt;= 100 and tLimbs.LL &lt; 100 then 
left_leg_prepped = true
else
left_leg_prepped = false
end

if tLimbs.H + ataxiaTables.limbData.snbSlice &gt;= 100 and tLimbs.H &lt; 100 then 
head_prepped = true
else
head_prepped = false
end



if ataxia.vitals.class == 4 and tAffs.blackout then
impale_blackout = true
else
impale_blackout = false
end

if tAffs.impaled and tLimbs.T &gt;= 100 then
disembowel = true
else
disembowel = false
end





if disembowel then
atk = atk.."wield longsword shield;disembowel "..target



elseif ferocity_full and (tAffs.damagedrightleg or tAffs.damagedleftleg) and tLimbs.T &gt;= 100 and tAffs.prone then

atk = atk.."wield longsword shield;assess "..target..";shieldstrike "..target.." high;combination "..target.." impale club"

elseif not ferocity_full and (tAffs.damagedrightleg or tAffs.damagedleftleg) and tLimbs.T &gt;= 100 and tAffs.prone then

atk = atk.."wield longsword shield;assess "..target..";combination "..target.." impale club"

elseif quash_arc or quash_arc1 or quash_arc2 then

atk = "stand/wield shield longsword/hellforge invest torment/quash "..target.."/arc/assess "..target


elseif need_raze or need_raze2 then
atk = atk.."wield longsword shield;assess "..target..";combination raze "..target.." "..shieldneed[1]


elseif (right_leg_prepped or left_leg_prepped) and not tAffs.prone and not ferocity_full and tLimbs.T &gt;= 100 then

atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." trip"

elseif (right_leg_prepped or left_leg_prepped) and not tAffs.prone and ferocity_full and tLimbs.T &gt;= 100 then

atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"

elseif (right_leg_prepped or left_leg_prepped) and not tAffs.prone and ferocity_full and torso_prepped then
targetlimb = "torso"

atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"

elseif (tAffs.damagedrightleg or tAffs.damagedleftleg) and tLimbs.T &lt; 100 and tAffs.prone then
targetlimb = "torso"

atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." "..shieldneed[1]


elseif ferocity_full and not tAffs.sensitivity then

atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." mid;"..swordneed[1].." "..shieldneed[1]

elseif tAffs.nausea or tAffs.paralysis or tAffs.prone then

atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." "..shieldneed[1]



else
atk = atk.."wield longsword shield;assess "..target..";"..swordneed[1].." "..shieldneed[1]

end

if quash_arc or quash_arc1 or quash_arc2 then
send("setalias quasharc "..atk)
send("queue addclear free quasharc")

elseif not engaged then
send("queue addclear free "..atk..";engage "..target..";order hyena kill "..target)

elseif ataxia.afflictions.paralysis then

send("queue addclear free dedication;"..atk..";tyranny")

else

send("queue addclear free land;"..atk..";tyranny")




end
end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>DARKSHADE</name>
												<packageName></packageName>
												<script>function infernalpriosdarkshade()


local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
strikingHigh = true

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  



  
  

--SHIELDNEED

  shieldneed = {}
  


if tAffs.slickness and tBals.focus and not tAffs.anorexia then
    table.insert(shieldneed,"smash high")


elseif tAffs.anorexia and tAffs.slickness then
    table.insert(shieldneed,"smash high")



elseif treelock  then
    table.insert(shieldneed,"smash high")



elseif not tAffs.paralysis then
    table.insert(shieldneed,"smash mid")
    
elseif not tAffs.asthma then
    table.insert(shieldneed,"drive")
    
    
elseif not tAffs.clumsiness then
    table.insert(shieldneed,"smash low")
    

else
    table.insert(shieldneed,"smash high")
end

















--SWORDLIST

swordneed = {}


if not tAffs.paralysis and shieldneed[1] ~= "smash mid" and softlock then
    table.insert(swordneed, "combination "..target.." slice curare")
end

if not tAffs.slickness and tAffs.asthma then
     table.insert(swordneed,"combination "..target.." slice gecko")
end

--if not tAffs.slickness and tAffs.asthma and tAffs.weariness then
--     table.insert(swordneed,"combination "..target.." slice gecko")
--end


if tAffs.anorexia and not tAffs.stupidity then
   table.insert(swordneed,"combination "..target.." slice aconite")
   end

if tAffs.anorexia and not tAffs.recklessness then
   table.insert(swordneed,"combination "..target.." slice eurypteria")
   end
if tAffs.anorexia and not tAffs.dizziness then
   table.insert(swordneed,"combination "..target.." slice larkspur")
   end

if tAffs.anorexia and not tAffs.shyness then
   table.insert(swordneed,"combination "..target.." slice digitalis")
   end

if not tAffs.anorexia and tAffs.slickness and tBals.focus then
    table.insert(swordneed,"combination "..target.." slice slike")
end

if not softlock and not tAffs.darkshade then
 table.insert(swordneed,"combination "..target.." slice darkshade")
end



if not softlock and not tAffs.healthleech then
 table.insert(swordneed,"wipe longsword;hellforge invest torment;combination "..target.." slice")
end


if not softlock and not tAffs.haemophilia then
table.insert(swordneed,"wipe longsword;hellforge invest torture;combination "..target.." slice")
end

if not tAffs.asthma and shieldneed[1] ~= "drive" then
      table.insert(swordneed,"combination "..target.." slice kalmia")
end





   if not tAffs.weariness then
    table.insert(swordneed,"wipe longsword;hellforge invest exploit;combination "..target.." slice")
end



if not tAffs.nausea then
      table.insert(swordneed,"combination "..target.." slice euphorbia")
end



if not tAffs.addiction then
  table.insert(swordneed,"combination "..target.." slice vardrax")
end






if not softlock and not tAffs.sensitivity then
  table.insert(swordneed,"combination "..target.." slice prefarar")
end





if not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    table.insert(swordneed,"combination "..target.." slice curare")
end



if not tAffs.asthma and shieldneed[1] ~= "drive" then
  table.insert(swordneed,"combination "..target.." slice kalmia")
end




if tAffs.prone and tAffs.paralysis and tAffs.slickness then
table.insert(swordneed,"combination "..target.." slice epseth")
   end
   
   if softlock and not tAffs.paralysis then
   table.insert(swordneed,"combination "..target.." slice curare")
   end


   

   




--ATTACK




--if sand not ataxia.afflictions.prone 
--and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.7) 
--and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
--ataxiaNDB_getClass(target) ~= "Apostate" and ataxiaNDB_getClass(target) ~= "Priest" then

--add_dedication = true
--else 
--add_dedication = false
--end




if tAffs.rebounding and not tAffs.shield then

need_raze = true
else
need_raze = false
end

if tAffs.shield and not tAffs.rebounding then

need_raze2 = true
else
need_raze2 = false
end

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end


if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 then
quash_arc = true
else
quash_arc = false
end

if tAffs.shield and tAffs.rebounding then
quash_arc2 = true
else
quash_arc2 = false
end



if quash_arc or quash_arc1 or quash_arc2 then

atk = "stand/wield shield longsword/hellforge invest torment/quash "..target.."/arc/assess "..target

elseif need_raze or need_raze2 then
atk = atk.."wield shield longsword;assess "..target..";combination raze "..target.." "..shieldneed[1]

elseif ferocity_full and tLimbs.RL &lt; 100 and tLimbs.RL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice right leg slike smash high"

elseif ferocity_full and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"


elseif ferocity_full and not tAffs.sensitivity then

atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." mid;"..swordneed[1].." "..shieldneed[1]

elseif ferocity_full and not tAffs.slickness and tAffs.asthma and tAffs.sensitivity
 and not tAffs.prone then

atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"

elseif ferocity_full and not tAffs.slickness and tAffs.asthma and tAffs.sensitivity
 and not tAffs.prone then

atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"


--and ataxiaNDB_getClass(target) ~= "Apostate" and ataxiaNDB_getClass(target) ~= "Priest"

else
atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]

end

if table.contains(ataxia.playersHere, target) then


if quash_arc or quash_arc1 or quash_arc2 then
send("setalias quasharc "..atk)
send("queue addclear free quasharc")

elseif not engaged then
send("queue addclear free land;"..atk..";engage "..target..";order hyena kill "..target)

elseif ataxia.afflictions.paralysis == true  then

send("queue addclear free dedication;"..atk..";tyranny")

else

send("queue addclear free land;"..atk..";tyranny")

end


end

end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>SOFT LOCK WEA</name>
												<packageName></packageName>
												<script>function infernalpriossoftlockwea()

local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
strikingHigh = false

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  



  
  

--SHIELDNEED

  shieldneed = {}
  


if tAffs.slickness and tBals.focus and not tAffs.anorexia then
    table.insert(shieldneed,"smash high")


elseif tAffs.anorexia and tAffs.slickness then
    table.insert(shieldneed,"smash high")



elseif treelock  then
    table.insert(shieldneed,"smash high")



elseif not tAffs.paralysis then
    table.insert(shieldneed,"smash mid")
    
elseif not tAffs.asthma then
    table.insert(shieldneed,"drive")
    
    
elseif not tAffs.clumsiness then
    table.insert(shieldneed,"smash low")
    

else
    table.insert(shieldneed,"smash high")
end













--SWORDLIST

swordneed = {}



if not tAffs.paralysis and shieldneed[1] ~= "smash mid" and softlock then
    table.insert(swordneed, "combination "..target.." slice curare")
end

if not tAffs.slickness and tAffs.asthma and tAffs.weariness then
     table.insert(swordneed,"combination "..target.." slice gecko")
end

--if not tAffs.slickness and tAffs.asthma and tAffs.weariness then
--     table.insert(swordneed,"combination "..target.." slice gecko")
--end


if tAffs.anorexia and not tAffs.stupidity then
   table.insert(swordneed,"combination "..target.." slice aconite")
   end

if tAffs.anorexia and not tAffs.recklessness then
   table.insert(swordneed,"combination "..target.." slice eurypteria")
   end
if tAffs.anorexia and not tAffs.dizziness then
   table.insert(swordneed,"combination "..target.." slice larkspur")
   end

if tAffs.anorexia and not tAffs.shyness then
   table.insert(swordneed,"combination "..target.." slice digitalis")
   end

if not tAffs.anorexia and tAffs.slickness and tBals.focus then
    table.insert(swordneed,"combination "..target.." slice slike")
end

   if not tAffs.weariness then
    table.insert(swordneed,"wipe longsword;hellforge invest exploit;combination "..target.." slice")
end


if not tAffs.asthma and shieldneed[1] ~= "drive" then
      table.insert(swordneed,"combination "..target.." slice kalmia")
end


if not softlock and not tAffs.haemophilia then
table.insert(swordneed,"wipe longsword;hellforge invest torture;combination "..target.." slice")
end

if not tAffs.nausea then
      table.insert(swordneed,"combination "..target.." slice euphorbia")
end



if not tAffs.addiction then
  table.insert(swordneed,"combination "..target.." slice vardrax")
end




if not softlock and not tAffs.healthleech then
 table.insert(swordneed,"wipe longsword;hellforge invest torment;combination "..target.." slice")
end



if not softlock and not tAffs.sensitivity then
  table.insert(swordneed,"combination "..target.." slice prefarar")
end





if not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    table.insert(swordneed,"combination "..target.." slice curare")
end



if not tAffs.asthma and shieldneed[1] ~= "drive" then
  table.insert(swordneed,"combination "..target.." slice kalmia")
end




if tAffs.prone and tAffs.paralysis and tAffs.slickness then
table.insert(swordneed,"combination "..target.." slice epseth")
   end
   
   if softlock and not tAffs.paralysis then
   table.insert(swordneed,"combination "..target.." slice curare")
   end


   

   
if not softlock and not tAffs.haemophilia then
 table.insert(swordneed,"wipe longsword;hellforge invest torture;combination "..target.." slice")
end
  







--ATTACK




if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.7) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
ataxiaNDB_getClass(target) ~= "Apostate" and ataxiaNDB_getClass(target) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end




if tAffs.rebounding and not tAffs.shield then

need_raze = true
else
need_raze = false
end

if tAffs.shield and not tAffs.rebounding then

need_raze2 = true
else
need_raze2 = false
end

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end



if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
quash_arc = true
else
quash_arc = false
end

if tAffs.shield and tAffs.rebounding then
quash_arc2 = true
else
quash_arc2 = false
end



if quash_arc or quash_arc1 or quash_arc2 then

atk = "stand/wield shield longsword/hellforge invest torment/quash "..target.."/arc/assess "..target

elseif need_raze or need_raze2 then
atk = atk.."wield shield longsword;assess "..target..";combination raze "..target.." "..shieldneed[1]

elseif ferocity_full and tLimbs.RL &lt; 100 and tLimbs.RL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice right leg slike smash high"

elseif ferocity_full and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"


elseif ferocity_full and not tAffs.sensitivity then

atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." mid;"..swordneed[1].." "..shieldneed[1]

elseif ferocity_full and not tAffs.slickness and tAffs.asthma and tAffs.weariness
 and not tAffs.prone then

atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"

elseif ferocity_full and not tAffs.slickness and tAffs.asthma and tAffs.weariness
 and not tAffs.prone then

atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"




else
atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]

end


if table.contains(ataxia.playersHere, target) then


if quash_arc or quash_arc1 or quash_arc2 then
send("setalias quasharc "..atk)
send("queue addclear eq quasharc")

elseif not engaged then
send("queue addclear free land;"..atk..";engage "..target..";order hyena kill "..target)

elseif ataxia.afflictions.paralysis == true  then

send("queue addclear free dedication;"..atk..";tyranny")

else

send("queue addclear free land;"..atk..";tyranny")

end


end

end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>SOFT LOCK CLU</name>
												<packageName></packageName>
												<script>function infernalpriossoftlockclu()

local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
strikingHigh = true

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  



  
  

--SHIELDNEED

  shieldneed = {}
  


if tAffs.slickness and tBals.focus and not tAffs.anorexia then
    table.insert(shieldneed,"smash high")


elseif tAffs.anorexia and tAffs.slickness then
    table.insert(shieldneed,"smash high")



elseif treelock  then
    table.insert(shieldneed,"smash high")

 
elseif not tAffs.paralysis then
    table.insert(shieldneed,"smash mid")

   elseif not tAffs.clumsiness then
    table.insert(shieldneed,"smash low")
    
  

    
elseif not tAffs.asthma then
    table.insert(shieldneed,"drive")
    
    


else
    table.insert(shieldneed,"smash high")
end













--SWORDLIST

swordneed = {}



if not tAffs.paralysis and shieldneed[1] ~= "smash mid" and softlock then
    table.insert(swordneed, "combination "..target.." slice curare")
end


if not tAffs.slickness and tAffs.asthma and tAffs.clumsiness then
     table.insert(swordneed,"combination "..target.." slice gecko")
end


if tAffs.anorexia and not tAffs.stupidity then
   table.insert(swordneed,"combination "..target.." slice aconite")
   end

if tAffs.anorexia and not tAffs.recklessness then
   table.insert(swordneed,"combination "..target.." slice eurypteria")
   end
if tAffs.anorexia and not tAffs.dizziness then
   table.insert(swordneed,"combination "..target.." slice larkspur")
   end

if tAffs.anorexia and not tAffs.shyness then
   table.insert(swordneed,"combination "..target.." slice digitalis")
   end

if not tAffs.anorexia and tAffs.slickness and tBals.focus then
    table.insert(swordneed,"combination "..target.." slice slike")
end

if not tAffs.clumsiness and shieldneed[1] ~= "smash low" then
  table.insert(swordneed,"combination "..target.." slice xentio")
end




if not tAffs.asthma and shieldneed[1] ~= "drive" then
      table.insert(swordneed,"combination "..target.." slice kalmia")
end


if not softlock and not tAffs.haemophilia then
table.insert(swordneed,"wipe longsword;hellforge invest torture;combination "..target.." slice")
end

if not tAffs.nausea then
      table.insert(swordneed,"combination "..target.." slice euphorbia")
end



if not tAffs.addiction then
  table.insert(swordneed,"combination "..target.." slice vardrax")
end




if not softlock and not tAffs.healthleech then
 table.insert(swordneed,"wipe longsword;hellforge invest torment;combination "..target.." slice")
end

   if not tAffs.weariness then
    table.insert(swordneed,"wipe longsword;hellforge invest exploit;combination "..target.." slice")
end



if not softlock and not tAffs.sensitivity then
  table.insert(swordneed,"combination "..target.." slice prefarar")
end





if not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    table.insert(swordneed,"combination "..target.." slice curare")
end



if not tAffs.asthma and shieldneed[1] ~= "drive" then
  table.insert(swordneed,"combination "..target.." slice kalmia")
end




if tAffs.prone and tAffs.paralysis and tAffs.slickness then
table.insert(swordneed,"combination "..target.." slice epseth")
   end
   
   if softlock and not tAffs.paralysis then
   table.insert(swordneed,"combination "..target.." slice curare")
   end


   

   
if not softlock and not tAffs.haemophilia then
 table.insert(swordneed,"wipe longsword;hellforge invest torture;combination "..target.." slice")
end
  







--ATTACK




if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.7) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
ataxiaNDB_getClass(target) ~= "Apostate" and ataxiaNDB_getClass(target) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end



if tAffs.rebounding and not tAffs.shield then

need_raze = true
else
need_raze = false
end

if tAffs.shield and not tAffs.rebounding then

need_raze2 = true
else
need_raze2 = false
end

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end



if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
quash_arc = true
else
quash_arc = false
end

if tAffs.shield and tAffs.rebounding then
quash_arc2 = true
else
quash_arc2 = false
end



if quash_arc or quash_arc1 or quash_arc2 then

atk = "stand/wield shield longsword/hellforge invest torment/quash "..target.."/arc/assess "..target

elseif need_raze or need_raze2 then
atk = atk.."wield shield longsword;assess "..target..";combination raze "..target.." "..shieldneed[1]

elseif ferocity_full and tLimbs.RL &lt; 100 and tLimbs.RL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice right leg slike smash high"

elseif ferocity_full and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"


--elseif ferocity_full and not tAffs.sensitivity then

--atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." mid;"..swordneed[1].." "..shieldneed[1]

elseif ferocity_full and not tAffs.slickness and tAffs.asthma and not tBals.tree
 and not tAffs.prone then

atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"

elseif ferocity_full and not tAffs.slickness and tAffs.asthma and tAffs.weariness
 and not tAffs.prone then

atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"




else
atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]

end

if table.contains(ataxia.playersHere, target) then


if quash_arc or quash_arc1 or quash_arc2 then
send("setalias quasharc "..atk)
send("queue addclear eq quasharc")

elseif not engaged then
send("queue addclear free land;"..atk..";engage "..target..";order hyena kill "..target)

elseif ataxia.afflictions.paralysis == true  then

send("queue addclear free dedication;"..atk..";tyranny")

else

send("queue addclear free land;"..atk..";tyranny")

end


end

end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>SOFT LOCK</name>
												<packageName></packageName>
												<script>function infernalpriossoftlock()

local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
strikingHigh = false

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  



  
  

--SHIELDNEED

  shieldneed = {}
  


if tAffs.slickness and tBals.focus and not tAffs.anorexia then
    table.insert(shieldneed,"smash high")


elseif tAffs.anorexia and tAffs.slickness then
    table.insert(shieldneed,"smash high")



elseif treelock  then
    table.insert(shieldneed,"smash high")



elseif not tAffs.paralysis then
    table.insert(shieldneed,"smash mid")
    
elseif not tAffs.asthma then
    table.insert(shieldneed,"drive")
    
    
elseif not tAffs.clumsiness then
    table.insert(shieldneed,"smash low")
    

else
    table.insert(shieldneed,"smash high")
end













--SWORDLIST

swordneed = {}


if not tAffs.paralysis and shieldneed[1] ~= "smash mid" and softlock then
    table.insert(swordneed, "combination "..target.." slice curare")
end

if not tAffs.slickness and tAffs.asthma then
     table.insert(swordneed,"combination "..target.." slice gecko")
end


if tAffs.anorexia and not tAffs.stupidity then
   table.insert(swordneed,"combination "..target.." slice aconite")
   end

if tAffs.anorexia and not tAffs.recklessness then
   table.insert(swordneed,"combination "..target.." slice eurypteria")
   end
if tAffs.anorexia and not tAffs.dizziness then
   table.insert(swordneed,"combination "..target.." slice larkspur")
   end

if tAffs.anorexia and not tAffs.shyness then
   table.insert(swordneed,"combination "..target.." slice digitalis")
   end

if not tAffs.anorexia and tAffs.slickness and tBals.focus then
    table.insert(swordneed,"combination "..target.." slice slike")
end



if not tAffs.asthma and shieldneed[1] ~= "drive" then
      table.insert(swordneed,"combination "..target.." slice kalmia")
end


if not softlock and not tAffs.healthleech then
 table.insert(swordneed,"wipe longsword;hellforge invest torment;combination "..target.." slice")
end


if not softlock and not tAffs.haemophilia then
table.insert(swordneed,"wipe longsword;hellforge invest torture;combination "..target.." slice")
end

if not tAffs.nausea then
      table.insert(swordneed,"combination "..target.." slice euphorbia")
end



if not tAffs.addiction then
  table.insert(swordneed,"combination "..target.." slice vardrax")
end




   if not tAffs.weariness then
    table.insert(swordneed,"wipe longsword;hellforge invest exploit;combination "..target.." slice")
end

if not softlock and not tAffs.sensitivity then
  table.insert(swordneed,"combination "..target.." slice prefarar")
end





if not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    table.insert(swordneed,"combination "..target.." slice curare")
end



if not tAffs.asthma and shieldneed[1] ~= "drive" then
  table.insert(swordneed,"combination "..target.." slice kalmia")
end




if tAffs.prone and tAffs.paralysis and tAffs.slickness then
table.insert(swordneed,"combination "..target.." slice epseth")
   end
   
   if softlock and not tAffs.paralysis then
   table.insert(swordneed,"combination "..target.." slice curare")
   end


   

   
if not softlock and not tAffs.haemophilia then
 table.insert(swordneed,"wipe longsword;hellforge invest torture;combination "..target.." slice")
end
  







--ATTACK




if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.7) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
ataxiaNDB_getClass(target) ~= "Apostate" and ataxiaNDB_getClass(target) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end



if tAffs.rebounding then

need_raze = true
else
need_raze = false
end

if tAffs.shield then

need_raze2 = true
else
need_raze2 = false
end

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end



if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
quash_arc = true
else
quash_arc = false
end

if tAffs.shield and tAffs.rebounding then
quash_arc2 = true
else
quash_arc2 = false
end



if quash_arc or quash_arc1 or quash_arc2 then

atk = "stand/wield shield longsword/hellforge invest torment/quash "..target.."/assess "..target

elseif need_raze or need_raze2 then
atk = atk.."wield shield longsword;assess "..target..";combination raze "..target.." "..shieldneed[1]

elseif ferocity_full and tLimbs.RL &lt; 100 and tLimbs.RL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice right leg slike smash high"

elseif ferocity_full and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 93 and tAffs.slickness then
atk = atk.."wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"


--elseif ferocity_full and not tAffs.sensitivity then

--atk = atk.."wield shield longsword;assess "..target..";shieldstrike "..target.." mid;"..swordneed[1].." "..shieldneed[1]

elseif ferocity_full and not tAffs.slickness and tAffs.asthma and not tBals.tree
 and not tAffs.prone then

atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"

elseif ferocity_full and not tAffs.slickness and tAffs.asthma and tAffs.weariness
 and not tAffs.prone then

atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]..";shieldstrike "..target.." low"




else
atk = atk.."wield shield longsword;assess "..target..";"..swordneed[1].." "..shieldneed[1]

end


if table.contains(ataxia.playersHere, target) then
if gmcp.Char.Vitals.bal == "0"
and gmcp.Char.Vitals.eq == "0"
then
send("cq all")
end

if gmcp.Char.Vitals.bal == "1"
and gmcp.Char.Vitals.eq == "1" then

if quash_arc or quash_arc1 or quash_arc2 then
send("setalias quasharc "..atk)
send("queue addclear eq quasharc")

elseif not engaged then
send("queue addclear free land;"..atk..";engage "..target..";order hyena kill "..target)

elseif ataxia.afflictions.paralysis == true  then

send("queue addclear free dedication;"..atk..";tyranny")

else

send("queue addclear free land;"..atk..";tyranny")

end
end

end

end</script>
												<eventHandlerList />
											</Script>
											<Script isActive="yes" isFolder="no">
												<name>Levi Damage</name>
												<packageName></packageName>
												<script>function isnbdamageroute()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()
add_dedication = add_dedication or false
need_raze = need_raze or false
partyrelay = partyrelay or false
strikingHigh = true

invest = invest or nil
saffliction = saffliction or "none"

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end

if tAffs.healthleech and tAffs.sensitivity and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 then
quash_arc1 = true
else
quash_arc1 = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
quash_arc = true
else
quash_arc = false
end

if tAffs.shield and tAffs.rebounding and ataxiaTemp.lastAssess &lt;= 30 then
quash_arc2 = true
else
quash_arc2 = false
end


--VIVI
if (tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and tAffs.damagedleftarm or tAffs.brokenleftarm and tAffs.damagedrightarm or tAffs.brokenrightarm) then
tvivsect = true
else 
tvivisect = false
end


--SHIELD Logic

shieldneed = {}

if hardlock == true then
  table.insert(shieldneed,"smash high")

elseif tAffs.slickness and tBals.focus and not tAffs.anorexia then
  table.insert(shieldneed,"smash high")

elseif tAffs.anorexia and tAffs.slickness then
  table.insert(shieldneed,"smash high")

elseif treelock then
  table.insert(shieldneed,"smash high")

elseif not tAffs.paralysis then
  table.insert(shieldneed,"smash mid")
    
elseif not tAffs.asthma then
  table.insert(shieldneed,"drive")
    
elseif not tAffs.clumsiness then
  table.insert(shieldneed,"smash low")

else
    table.insert(shieldneed,"smash high")
end

--SWORDLIST
envenomList = {}


if tvivisect == true then
    atk = atk.."dismount;vivisect " ..target
elseif quash_arc or quash_arc1 or quash_arc2 then
    atk = atk.."wield shield longsword;dismount;quash " ..target..";arc"
elseif tAffs.rebounding or tAffs.shield then
    atk = atk.."wield shield longsword;assess "..target..";combination raze "..target.." "..shieldneed[1]
    
--True Lock
elseif truelock and tarClassCure(getAff) == "paralysis" and not tAffs.paralysis then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice curare " ..shieldneed[1]
    table.insert(envenomList, "curare")
    saffliction = "paralysis"
elseif truelock and tarClassCure(getAff) == "paralysis" and tAffs.paralysis then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice voyria " ..shieldneed[1]
    table.insert(envenomList, "voyria")
     saffliction = "plague"  
elseif truelock and tarClassCure(getAff) == "weariness" and not tAffs.weariness then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest exploit;combination "..target.." slice " ..shieldneed[1]
    envenomList = {}
    invest = "exploit"
    saffliction = "none"
elseif truelock and tarClassCure(getAff) == "weariness" and tAffs.weariness then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice voyria " ..shieldneed[1]
    table.insert(envenomList, "voyria")
     saffliction = "plague"
elseif truelock and tarClassCure(getAff) == "haemophilia" and not tAffs.haemophilia then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torture;combination "..target.." slice " ..shieldneed[1]
    envenomList = {}
    invest = "torture"
    saffliction = "none"
elseif truelock and tarClassCure(getAff) == "haemophilia" and tAffs.haemophilia then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice voyria " ..shieldneed[1]
    table.insert(envenomList, "voyria")
     saffliction = "plague"
elseif truelock and tarClassCure(getAff) == "recklessness" and not tAffs.recklessness then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice eurypteria " ..shieldneed[1]
    table.insert(envenomList, "eurypteria") 
     saffliction = "recklessness"
elseif truelock and tarClassCure(getAff) == "recklessness" and tAffs.recklessness then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice voyria " ..shieldneed[1]
    table.insert(envenomList, "voyria")
elseif truelock and tarClassCure(getAff) == "confusion" and not tAffs.confusion and tAffs.healthleech then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torment;combination "..target.." slice " ..shieldneed[1]
    envenomList = {}
    invest = "torment"
    saffliction = "none"
elseif truelock and tarClassCure(getAff) == "confusion" and tAffs.confusion and tAffs.healthleech then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest "..invest..";combination "..target.." slice voyria " ..shieldneed[1]
    table.insert(envenomList, "voyria")
    saffliction = "plague"
    
elseif truelock and tarClassCure(getAff) == "confusion" and not tAffs.confusion and not tAffs.healthleech then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torment;combination "..target.." slice " ..shieldneed[1]
    envenomList = {}
    invest = "torment"
    saffliction = "none"
           
--Hardlock
elseif hardlock and not tAffs.paralysis and shieldneed[1] ~= "smash mid" and not tAffs.prone and ataxia.vitals.class == 4 then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice curare " ..shieldneed[1]..";shieldstrike low"
    table.insert(envenomList, "curare")
     saffliction = "paralysis"    
elseif hardlock and not tAffs.paralysis and shieldneed[1] ~= "smash mid" and ataxia.vitals.class == 4 and tAffs.prone then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice curare " ..shieldneed[1]..";shieldstrike high"
    table.insert(envenomList, "curare")  
     saffliction = "paralysis"  
elseif hardlock and not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice curare " ..shieldneed[1]
    table.insert(envenomList, "curare") 
     saffliction = "paralysis"
elseif hardlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and not tAffs.prone and ataxia.vitals.class == 4 and tarClassCure(getAff) == "weariness" and not tAffs.weariness then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest exploit;combination "..target.." slice " ..shieldneed[1]..";shieldstrike low"
    envenomList = {}
    invest = "exploit"
    saffliction = "none"
elseif hardlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and not tAffs.prone and ataxia.vitals.class == 4 and tarClassCure(getAff) == "haemophilia" and not tAffs.haemophilia then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torture;combination "..target.." slice " ..shieldneed[1]..";shieldstrike low"
    envenomList = {}
    invest = "torture"
    saffliction = "none"
elseif hardlock and tarClassCure(getAff) == "recklessness" and not tAffs.recklessness and not tAffs.paralysis and shieldneed[1] == "smash mid" and not tAffs.prone and ataxia.vitals.class == 4 then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice eurypteria " ..shieldneed[1]..";shieldstrike low"
    table.insert(envenomList, "eurypteria") 
     saffliction = "recklessness"
elseif hardlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and not tAffs.prone and ataxia.vitals.class == 4 and tarClassCure(getAff) == "confusion" and not tAffs.confusion and tAffs.healthleech then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torment;combination "..target.." slice " ..shieldneed[1]..";shieldstrike low"
    envenomList = {}
    invest = "torment"
    saffliction = "none"

elseif hardlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and tAffs.prone and ataxia.vitals.class == 4 and tarClassCure(getAff) == "weariness" and not tAffs.weariness then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest exploit;combination "..target.." slice " ..shieldneed[1]..";shieldstrike high"
    envenomList = {}
    invest = "exploit"
    saffliction = "none"
elseif hardlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and tAffs.prone and ataxia.vitals.class == 4 and tarClassCure(getAff) == "haemophilia" and not tAffs.haemophilia then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torture;combination "..target.." slice " ..shieldneed[1]..";shieldstrike high"
    envenomList = {}
    invest = "torture"
    saffliction = "none"
elseif hardlock and tarClassCure(getAff) == "recklessness" and not tAffs.recklessness and not tAffs.paralysis and shieldneed[1] == "smash mid" and tAffs.prone and ataxia.vitals.class == 4 then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice eurypteria " ..shieldneed[1]..";shieldstrike high"
    table.insert(envenomList, "eurypteria")
     saffliction = "recklessness" 
elseif hardlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and tAffs.prone and ataxia.vitals.class == 4 and tarClassCure(getAff) == "confusion" and not tAffs.confusion and tAffs.healthleech then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torment;combination "..target.." slice " ..shieldneed[1]..";shieldstrike high"
    envenomList = {}
    invest = "torment"
    saffliction = "none"
    
elseif hardlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and tarClassCure(getAff) == "weariness" and not tAffs.weariness then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest exploit;combination "..target.." slice " ..shieldneed[1]
    envenomList = {}
    invest = "exploit"
    saffliction = "none"
elseif hardlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and tarClassCure(getAff) == "haemophilia" and not tAffs.haemophilia then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torture;combination "..target.." slice " ..shieldneed[1]
    envenomList = {}
    invest = "torture"
    saffliction = "none"
elseif hardlock and tarClassCure(getAff) == "recklessness" and not tAffs.recklessness and not tAffs.paralysis and shieldneed[1] == "smash mid" then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice eurypteria " ..shieldneed[1]
    table.insert(envenomList, "eurypteria") 
elseif hardlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and tarClassCure(getAff) == "confusion" and not tAffs.confusion and tAffs.healthleech then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torment;combination "..target.." slice " ..shieldneed[1]
    envenomList = {}
    invest = "torment"
    saffliction = "none"



--Soft Lock
elseif softlock and not tAffs.paralysis and shieldneed[1] ~= "smash mid" and ataxia.vitals.class == 4 and not tAffs.prone then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice curare " ..shieldneed[1]..";shieldstrike low"
    table.insert(envenomList, "curare") 
     saffliction = "paralysis"
elseif softlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and ataxia.vitals.class == 4 and not tAffs.prone and tarClassCure(getAff) == "recklessness" and not tAffs.recklessness then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice eurypteria " ..shieldneed[1]..";shieldstrike low"
    table.insert(envenomList, "eurypteria") 
     saffliction = "recklessness"
elseif softlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and ataxia.vitals.class == 4 and not tAffs.prone and tarClassCure(getAff) == "weariness" and not tAffs.weariness then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest exploit;combination "..target.." slice " ..shieldneed[1]..";shieldstrike low"
    envenomList = {}
    invest = "exploit"
    saffliction = "none"
elseif softlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and ataxia.vitals.class == 4 and not tAffs.prone and tarClassCure(getAff) == "haemophilia" and not tAffs.haemophilia then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torture;combination "..target.." slice " ..shieldneed[1]..";shieldstrike low"
    envenomList = {}
    invest = "torture"
    saffliction = "none" 

elseif softlock and not tAffs.paralysis and shieldneed[1] ~= "smash mid" and ataxia.vitals.class == 4 and tAffs.prone then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice curare " ..shieldneed[1]..";shieldstrike high"
    table.insert(envenomList, "curare") 
     saffliction = "paralysis"
elseif softlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and ataxia.vitals.class == 4 and tAffs.prone and tarClassCure(getAff) == "recklessness" and not tAffs.recklessness then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice eurypteria " ..shieldneed[1]..";shieldstrike high"
    table.insert(envenomList, "eurypteria") 
     saffliction = "recklessness"
elseif softlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and ataxia.vitals.class == 4 and tAffs.prone and tarClassCure(getAff) == "weariness" and not tAffs.weariness then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest exploit;combination "..target.." slice " ..shieldneed[1]..";shieldstrike high"
    envenomList = {}
    invest = "exploit"
    saffliction = "none"
elseif softlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and ataxia.vitals.class == 4 and tAffs.prone and tarClassCure(getAff) == "haemophilia" and not tAffs.haemophilia then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torture;combination "..target.." slice " ..shieldneed[1]..";shieldstrike high"
    envenomList = {}
    invest = "torture"
    saffliction = "none"
    
elseif softlock and not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice curare " ..shieldneed[1]
    table.insert(envenomList, "curare") 
     saffliction = "paralysis"
elseif softlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and tarClassCure(getAff) == "recklessness" and not tAffs.recklessness then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice eurypteria " ..shieldneed[1]
    table.insert(envenomList, "eurypteria") 
     saffliction = "recklessness"
elseif softlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and tarClassCure(getAff) == "weariness" and not tAffs.weariness then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest exploit;combination "..target.." slice " ..shieldneed[1]
    envenomList = {}
    invest = "exploit"
    saffliction = "none"
elseif softlock and not tAffs.paralysis and shieldneed[1] == "smash mid" and tarClassCure(getAff) == "haemophilia" and not tAffs.haemophilia then
    atk = atk.." wield shield longsword;assess "..target..";hellforge invest torture;combination "..target.." slice " ..shieldneed[1]
    envenomList = {}
    invest = "torture"
    saffliction = "none"
         
-- Build to Softlock
elseif tAffs.anorexia and not tAffs.stupidity then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice aconite " ..shieldneed[1]
    table.insert(envenomList, "aconite")
     saffliction = "stupidity"
elseif tAffs.anorexia and not tAffs.recklessness then
 atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice eurypteria " ..shieldneed[1]
    table.insert(envenomList, "eurypteria")
     saffliction = "recklessness"
elseif tAffs.anorexia and not tAffs.dizziness then
 atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice larkspur " ..shieldneed[1]
    table.insert(envenomList, "larkspur")
     saffliction = "dizziness"
elseif tAffs.anorexia and not tAffs.shyness then
 atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice digitalis " ..shieldneed[1]
    table.insert(envenomList, "digitalis")
     saffliction = "shyness"
elseif not tAffs.anorexia and tAffs.slickness and tBals.focus and ataxia.vitals.class == 4 and tAffs.prone then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice slike " ..shieldneed[1]..";shieldstrike high"
    table.insert(envenomList, "slike")
     saffliction = "anorexia"
elseif not tAffs.anorexia and tAffs.slickness and tBals.focus and ataxia.vitals.class == 4 and not tAffs.prone then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice slike " ..shieldneed[1]..";shieldstrike low"
    table.insert(envenomList, "slike")
     saffliction = "anorexia"
elseif not tAffs.anorexia and tAffs.slickness and tBals.focus then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice slike " ..shieldneed[1]
    table.insert(envenomList, "slike")
     saffliction = "anorexia"
elseif not tAffs.anorexia and tAffs.slickness and not tBals.focus then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice slike " ..shieldneed[1]
    table.insert(envenomList, "slike")
     saffliction = "anorexia"
elseif tAffs.asthma and not tAffs.slickness and ataxia.vitals.class == 4 and tAffs.prone then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice gecko " ..shieldneed[1]..";shieldstrike high"
    table.insert(envenomList, "gecko")
     saffliction = "slickness"
elseif tAffs.asthma and not tAffs.slickness and ataxia.vitals.class == 4 and not tAffs.prone then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice gecko " ..shieldneed[1]..";shieldstrike low"
    table.insert(envenomList, "gecko")
     saffliction = "slickness"
elseif tAffs.asthma and not tAffs.slickness then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice gecko " ..shieldneed[1]
    table.insert(envenomList, "gecko")
     saffliction = "slickness"
elseif not tAffs.asthma and shieldneed[1] ~= "drive" and tAffs.clumsiness then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice kalmia " ..shieldneed[1]
    table.insert(envenomList, "kalmia")
     saffliction = "asthma"
elseif not tAffs.clumsiness then
    atk = atk.." wield shield longsword;assess "..target..";combination "..target.." slice xentio " ..shieldneed[1]
    table.insert(envenomList, "xentio")
     saffliction = "clumsiness"

end    
--ATTACK

if table.contains(ataxia.playersHere, target) then
  if not engaged then
    send("queue addclear free land;"..atk..";engage "..target..";order hyena kill "..target)
  elseif ataxia.afflictions.paralysis == true  then
    send("queue addclear free dedication;"..atk..";tyranny")
  else
    send("queue addclear free land;"..atk..";tyranny")
  end
end

end</script>
												<eventHandlerList />
											</Script>
										</ScriptGroup>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>DWB</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>Infernal DWB Logic - Levi</name>
											<packageName></packageName>
											<script>DWBWhirlDamage = DWBWhirlDamage or 0

function infernaldwbviviprio()

toppression = toppression or "exploit"

if mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true and mprepped_head == true then
toppression = "torture"
elseif mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true then
toppression = "torture"
elseif mprepped_leftarm == true and mprepped_rightarm == true then
toppression = "torture"
elseif mprepped_leftleg == true and mprepped_rightleg == true then
toppression = "torture"

elseif tAffs.haemophilia and tAffs.healthleech then
toppression = "exploit"
elseif tAffs.healthleech and not tAffs.haemophilia then
toppression = "torture"
elseif not tAffs.healthleech and tAffs.weariness then
toppression = "torment"
elseif not tAffs.weariness then 
toppression = "exploit"
end

end



function idwb_pocketleg()
--When you need a breather
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 34 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Stuff
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end


--ATTACKKKKK
 
-- Bisect

if myinstantcath == true then
  atk = atk.." touch shield"
elseif not tAffs.shield and use_bisect == true then
  atk = atk.. "wield bastard;bisect " ..target.. " ;assess " ..target.. " ;sizeup " ..target

-- Pulp

elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 5) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;dismount;pulp " ..target.. ";sizeup " ..target.. " ;assess " ..target

--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon track " ..target.. ";falcon slay " ..target.. ";fracture " ..target.. " ;assess " ..target.. " ;sizeup " ..target

elseif mprepped_leftleg == true and ataxia.vitals.class &gt;= 3 and ataxiaTemp.parriedLimb ~= "left leg" then
  if mprepped_rightleg == false  then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg expend right leg;assess " ..target
  elseif mprepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg expend head;assess " ..target
  elseif mprepped_torso == false then
   atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg expend torso;assess " ..target
  end
elseif mprepped_rightleg == true and ataxia.vitals.class &gt;= 3 and ataxiaTemp.parriedLimb ~= "right leg" then
  if mprepped_leftleg == false  then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " right leg expend left leg;assess " ..target
  elseif mprepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " right leg expend head;assess " ..target
  elseif mprepped_torso == false then
   atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " right leg expend torso;assess " ..target
  end
  else
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " ;assess " ..target

  end

if table.contains(ataxia.playersHere, target) then
	if not engaged then
		send("queue addclear freestand " ..atk.. ";engage " ..target)
	else
	send("queue addclear freestand " ..atk)
	end
end
end


function idwb_skullfractures()
infernaldwbviviprio()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
flail2damage = DWBWhirlDamage + DWBWhirlDamage

tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
if ataxiaTemp.parriedLimb == nil then ataxiaTemp.parriedLimb = "none" end
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Stuff
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + flail2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + flail2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end


--Priority of Limb
if mprepped_rightleg == false then
tarlimb = "right leg"
elseif mprepped_head == false then
tarlimb = "head"
elseif mprepped_leftleg == false then
tarlimb = "left leg"
end

if (tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and tAffs.damagedleftarm or tAffs.brokenleftarm and tAffs.damagedrightarm or tAffs.brokenrightarm) then
tvivsect = true
else 
tvivisect = false
end

--ATTACKKKKK
 
-- Bisect

if myinstantcath == true then
  atk = atk.." touch shield"

-- Vivisect --
elseif tvivisect == true and ataxiaNDB.players[target].city ~= "Mhaldor" then
  atk = atk.. "dismount;vivisect " ..target
elseif tvivisect == true and ataxiaNDB.players[target].city == "Mhaldor" then
  send("say Vivisect")

elseif use_bisect == true then
  atk = atk.. "wield bastard;quash " ..target.. ";arc;sizeup " ..target.. ";assess " ..target

-- Pulp

elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 5) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";pulp " ..target.. " ;engage " ..target.. ";sizeup " ..target.. " ;assess " ..target

--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. ";hyena slay " ..target.. ";fracture " ..target.. " ;assess " ..target.. " ;sizeup " ..target

-- Skull Fractures --
elseif tAffs.prone and ataxia.vitals.class &gt;= 2 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head expend head expend;assess " ..target.." ;sizeup " ..target
elseif tAffs.prone and ataxia.vitals.class &lt; 2 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target


-- Break Sequence --

--Dont Double Break if they Pre-Apply
elseif tarpreapply == true then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso torso expend;assess " ..target.. " ;engage " ..target

--Doublebreak with or without clumsiness (Add Discipline)
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target.. " ;engage " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target.. " ;engage " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target.. " ;engage " ..target

elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

 

--Anti Parry
elseif not tAffs.numbedleftarm and ataxiaTemp.parriedLimb ~= "left arm" and ataxiaTemp.parriedLimb == "left leg" or ataxiaTemp.parriedLimb == "right leg" or ataxiaTemp.parriedLimb == "head" then
  if ataxia.vitals.class &lt; 1 then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. " ;hyena slay " ..target.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
 
  elseif ataxia.vitals.class &gt; 1 then
    if m2prepped_rightleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_head == true and mprepped_leftleg == false and mprepped_rightleg == false and mpreppedhead == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    elseif mprepped_leftleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_rightleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_head == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    else 
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend torso;sizeup " ..target.. ";assess " ..target
  
    end
  end
  
--Prep Head\ Left Leg\ Right Leg
elseif m2prepped_rightleg == true and mprepped_head == true and mprepped_rightleg == false and mprepped_leftleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso right leg;assess " ..target
  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " left leg right leg;assess " ..target

elseif m2prepped_head == true and mprepped_head == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " head right leg;assess " ..target
  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " left leg right leg;assess " ..target

elseif mprepped_head == false and m2prepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
elseif mprepped_leftleg == false and m2prepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg left leg;sizeup " ..target.. ";assess " ..target
elseif mprepped_rightleg == false and m2prepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg right leg;sizeup " ..target.. ";assess " ..target
else
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " ;sizeup " ..target.. ";assess " ..target
end

if table.contains(ataxia.playersHere, target) then
if falconattack == true then
  if not engaged then
    send("queue addclear freestand " ..atk.. ";engage " ..target)
  else
    send("queue addclear freestand " ..atk)
  end
elseif falconattack == false then
 if not engaged then
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target.." ;engage " ..target)
  else
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target)
  end
end
else
  expandAlias("nt")
  send("queue addclear freestand " ..atk)

end
end



----------------------------------------------------------------------------------------
function idwb_assaultheadpulpsetup()
infernaldwbviviprio()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
flail2damage = DWBWhirlDamage + DWBWhirlDamage

tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
if ataxiaTemp.parriedLimb == nil then ataxiaTemp.parriedLimb = "none" end
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Stuff
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + flail2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + flail2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end


--Priority of Limb
if mprepped_rightleg == false then
  tarlimb = "right leg"
elseif mprepped_head == false then
  tarlimb = "head"
elseif mprepped_leftleg == false then
  tarlimb = "left leg"
end

if (tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and tAffs.damagedleftarm or tAffs.brokenleftarm and tAffs.damagedrightarm or tAffs.brokenrightarm) then
tvivsect = true
else 
tvivisect = false
end

--ATTACKKKKK
 
-- Bisect

if myinstantcath == true then
  atk = atk.." touch shield"

-- Vivisect --
elseif tvivisect == true and ataxiaNDB.players[target].city ~= "Mhaldor" then
  atk = atk.. "dismount;vivisect " ..target
elseif tvivisect == true and ataxiaNDB.players[target].city == "Mhaldor" then
  send("say Vivisect")

elseif use_bisect == true then
  atk = atk.. "wield bastard;quash " ..target.. ";arc;sizeup " ..target.. ";assess " ..target

-- Pulp
elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 4) and ataxiaNDB.players[target].city ~= "Mhaldor" and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";pulp " ..target.. ";assess " ..target


--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. ";hyena slay " ..target.. ";sizeup " ..target.. ";fracture " ..target.. " ;engage " ..target.. " ;assess " ..target

--Assault Head
elseif tAffs.prone and (tAffs.damagedhead or lb[target].hits["head"] &gt;= 100) and ataxia.vitals.class &gt;= 7 then
  atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";sizeup " ..target.. ";assault " ..target.. " head;assess " ..target
elseif tAffs.prone and mprepped_head == true and ataxia.vitals.class &lt; 7 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " head head;assess " ..target
  
-- Skull Fractures
elseif tAffs.prone and (tAffs.damagedhead or lb[target].hits["head"] &gt;= 100) and ataxia.vitals.class &lt; 7 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " head head;assess " ..target
elseif tAffs.prone and (tAffs.mildtrauma or lb[target].hits["torso"] &gt;= 100) and ataxia.vitals.class &lt; 7 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso torso;assess " ..target


--Beat Head

elseif tAffs.prone and ataxia.vitals.class &gt;= 2 and (lb[target].hits["head"] &gt;= 100 or tAffs.damagedhead) or mprepped_head == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " head expend head expend;assess " ..target
elseif tAffs.prone and ataxia.vitals.class &lt; 2 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " head head;assess " ..target



-- Break Sequence
elseif tarpreapply == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso torso expend;assess " ..target

elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

 
--Anti Parry
elseif not tAffs.numbedleftarm and ataxiaTemp.parriedLimb ~= "left arm" and ataxiaTemp.parriedLimb == "left leg" or ataxiaTemp.parriedLimb == "right leg" or ataxiaTemp.parriedLimb == "head" then
  if ataxia.vitals.class &lt; 1 then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. " ;hyena slay " ..target.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
 
  elseif ataxia.vitals.class &gt; 1 then
    if m2prepped_rightleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_head == true and mprepped_leftleg == false and mprepped_rightleg == false and mpreppedhead == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    elseif mprepped_leftleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_rightleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_head == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    else 
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend torso;sizeup " ..target.. ";assess " ..target
  
    end
  end
  
--Prep Head\ Left Leg\ Right Leg
  --If doublewhirl on head is going to break than do one whirl and hit another limb
elseif m2prepped_rightleg == true and mprepped_head == true and mprepped_rightleg == false and mprepped_leftleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso right leg;sizeup " ..target.. ";assess " ..target
  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg right leg;sizeup " ..target.. ";assess " ..target

elseif m2prepped_head == true and mprepped_head == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head right leg;sizeup " ..target.. ";assess " ..target
  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg left arm;sizeup " ..target.. ";assess " ..target

elseif mprepped_head == false and m2prepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
elseif mprepped_leftleg == false and m2prepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg left leg;sizeup " ..target.. ";assess " ..target
elseif mprepped_rightleg == false and m2prepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg right leg;sizeup " ..target.. ";assess " ..target
else
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " ;sizeup " ..target.. ";assess " ..target
end


if table.contains(ataxia.playersHere, target) then
if falconattack == true then
  if not engaged then
    send("queue addclear freestand " ..atk.. ";engage " ..target)
  else
    send("queue addclear freestand " ..atk)
  end
elseif falconattack == false then
 if not engaged then
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target.." ;engage " ..target)
  else
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target)
  end
end
else
  expandAlias("nt")
  send("queue addclear freestand " ..atk)

end
end



function idwb_torsodamage()
infernaldwbviviprio()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
flail2damage = DWBWhirlDamage + DWBWhirlDamage

tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
if ataxiaTemp.parriedLimb == nil then ataxiaTemp.parriedLimb = "none" end
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Stuff
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + flail2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + flail2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end


if (tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and tAffs.damagedleftarm or tAffs.brokenleftarm and tAffs.damagedrightarm or tAffs.brokenrightarm) then
tvivsect = true
else 
tvivisect = false
end

--ATTACKKKKK
 
-- Bisect

if myinstantcath == true then
  atk = atk.." touch shield"

-- Vivisect --
elseif tvivisect == true and ataxiaNDB.players[target].city ~= "Mhaldor" then
  atk = atk.. "dismount;vivisect " ..target
elseif tvivisect == true and ataxiaNDB.players[target].city == "Mhaldor" then
  send("say Vivisect")

elseif use_bisect == true then
  atk = atk.. "wield bastard;quash " ..target.. ";arc;sizeup " ..target.. ";assess " ..target

-- Pulp
elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 5) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";pulp " ..target.. ";assess " ..target

--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. " ;hyena slay " ..target.. ";sizeup " ..target.. ";fracture " ..target.. " ;engage " ..target.. " ;assess " ..target

--Torso Damage
elseif tAffs.prone and ataxia.vitals.class &gt;= 3 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";sizeup " ..target.. ";assault " ..target.. " torso;assess " ..target
elseif ataxia.vitals.class &gt;= 2 and ataxiaTemp.fractures.crackedribs &gt;= 1 and ataxiaTemp.parriedLimb ~= "torso" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso expend torso expend;assess " ..target
elseif ataxia.vitals.class &lt; 2 and ataxiaTemp.fractures.crackedribs &gt;= 1 and ataxiaTemp.parriedLimb ~= "torso" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso torso;assess " ..target
elseif ataxia.vitals.class &lt; 2 and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso torso;assess " ..target
elseif ataxia.vitals.class &lt; 2 and lb[target].hits["head"]&gt;= 100 and ataxiaTemp.parriedLimb ~= "torso" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso torso;assess " ..target

--Pre-Apply Counter
elseif tarpreapply == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso expend torso ;assess " ..target

-- Double Break
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

 
--Anti Parry

elseif not tAffs.numbedleftarm and ataxiaTemp.parriedLimb ~= "left arm" and ataxiaTemp.parriedLimb == "left leg" or ataxiaTemp.parriedLimb == "right leg" or ataxiaTemp.parriedLimb == "torso" then
  if ataxia.vitals.class &lt; 1 then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. " ;hyena slay " ..target.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
 
  elseif ataxia.vitals.class &gt; 1 then
    if m2prepped_rightleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_head == true and mprepped_leftleg == false and mprepped_rightleg == false and mpreppedhead == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    elseif mprepped_leftleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_rightleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    else 
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend torso;sizeup " ..target.. ";assess " ..target
  
    end
  end
  
--One Prepped | Now the other
elseif m2prepped_rightleg == true and mprepped_rightleg == false and mprepped_leftleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " left arm right leg;assess " ..target
  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " left leg right leg;assess " ..target
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " left leg left arm;assess " ..target


-- Prep
elseif mprepped_leftleg == false and m2prepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg left leg;sizeup " ..target.. ";assess " ..target

elseif mprepped_rightleg == false and m2prepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg right leg;sizeup " ..target.. ";assess " ..target

else
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " ;sizeup " ..target.. ";assess " ..target

end

if table.contains(ataxia.playersHere, target) then
if falconattack == true then
  if not engaged then
    send("queue addclear freestand " ..atk.. ";engage " ..target)
  else
    send("queue addclear freestand " ..atk)
  end
elseif falconattack == false then
 if not engaged then
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target.." ;engage " ..target)
  else
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target)
  end
end
else
  expandAlias("nt")
  send("queue addclear freestand " ..atk)

end
end


-------------USE BELOW FOR GROUP COMBAT and TO MELT MOFOS--------------------
function idwb_damageroute()
infernaldwbviviprio()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
flail2damage = DWBWhirlDamage + DWBWhirlDamage

tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
if ataxiaTemp.parriedLimb == nil then ataxiaTemp.parriedLimb = "none" end
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Stuff
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + flail2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + flail2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end


--Priority of Limb
if mprepped_rightleg == false then
tarlimb = "right leg"
elseif mprepped_head == false then
tarlimb = "head"
elseif mprepped_leftleg == false then
tarlimb = "left leg"
end

if (tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and tAffs.damagedleftarm or tAffs.brokenleftarm and tAffs.damagedrightarm or tAffs.brokenrightarm) then
tvivsect = true
else 
tvivisect = false
end

--ATTACKKKKK
 
-- Bisect

if myinstantcath == true then
  atk = atk.." touch shield"

-- Vivisect --
elseif tvivisect == true and ataxiaNDB.players[target].city ~= "Mhaldor" then
  atk = atk.. "dismount;vivisect " ..target
elseif tvivisect == true and ataxiaNDB.players[target].city == "Mhaldor" then
  send("say Vivisect")

elseif use_bisect == true then
  atk = atk.. "wield bastard;quash " ..target.. ";arc;sizeup " ..target.. ";assess " ..target


--elseif not tAffs.shield and use_bisect == true and ataxiaNDB.players[target].city == "Mhaldor" then
  --send("say QUASH ARC")

-- Pulp

elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 5) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";pulp " ..target.. " ;engage " ..target.. ";sizeup " ..target.. " ;assess " ..target

--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. ";hyena slay " ..target.. ";fracture " ..target.. " ;assess " ..target.. " ;sizeup " ..target

-- Skull Fractures --
elseif tAffs.prone and ataxia.vitals.class &gt;= 2 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head expend head expend;assess " ..target.." ;sizeup " ..target
elseif tAffs.prone and ataxia.vitals.class &lt; 2 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
 
--Anti Parry
elseif not tAffs.numbedleftarm and ataxiaTemp.parriedLimb ~= "left arm" and ataxiaTemp.parriedLimb == "left leg" or ataxiaTemp.parriedLimb == "right leg" or ataxiaTemp.parriedLimb == "head" or ataxiaTemp.parriedLimb == "torso" or ataxiaTemp.parriedLimb == "right arm" then
  if ataxia.vitals.class &lt; 1 then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. " ;hyena slay " ..target.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
 
  elseif ataxia.vitals.class &gt; 1 then
    if mprepped_head == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    else 
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend torso;sizeup " ..target.. ";assess " ..target
    end
  end
  
  --If we have above 4 momentum, prone and hit head with flails to give skull fractures
elseif ataxia.vitals.class &gt;= 4 then  
  if ataxiaTemp.parriedLimb ~= "right leg" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right flail408566;hellforge invest torment;doublewhirl " ..target.. " right leg expend head expend;sizeup " ..target.. ";assess " ..target  
  elseif ataxiaTemp.parriedLimb ~= "left leg" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right flail408566;hellforge invest torment;doublewhirl " ..target.. " left leg expend head expend;sizeup " ..target.. ";assess " ..target  
  end
  
  --If we have above 2 momentum, use flails 
elseif ataxia.vitals.class &gt;= 2 then
  if ataxiaTemp.parriedLimb ~= "left arm" or tAffs.numbedleftarm then
    if ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &gt;= 2 and ataxiaTemp.fractures.wristfractures &gt;= 2 and tAffs.clumsiness then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend head expend;sizeup " ..target.. ";assess " ..target
    elseif ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &gt;= 2 and ataxiaTemp.fractures.wristfractures &gt;= 2 then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend left leg expend;sizeup " ..target.. ";assess " ..target
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.skullfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend head expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 and ataxiaTemp.fractures.skullfractures &lt; 1 then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend head expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &lt; 2 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend torso expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &lt; 1 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest exploit;doublewhirl " ..target.. " left arm expend right arm expend;sizeup " ..target.. ";assess " ..target  
    elseif not tAffs.clumsiness then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend right leg expend;sizeup " ..target.. ";assess " ..target
    end
  elseif ataxiaTemp.parriedLimb ~= "right arm" or tAffs.numbedleftarm then
    if ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &gt;= 2 and ataxiaTemp.fractures.wristfractures &gt;= 2 and tAffs.clumsiness then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend head expend;sizeup " ..target.. ";assess " ..target
    elseif ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &gt;= 2 and ataxiaTemp.fractures.wristfractures &gt;= 2 then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend left leg expend;sizeup " ..target.. ";assess " ..target
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.skullfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend head expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 and ataxiaTemp.fractures.skullfractures &lt; 1 then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend head expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &lt; 2 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend torso expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &lt; 1 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest exploit;doublewhirl " ..target.. " right arm expend right arm expend;sizeup " ..target.. ";assess " ..target  
    elseif not tAffs.clumsiness then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend right leg expend;sizeup " ..target.. ";assess " ..target
    end
  
  
  end
  
  --If we have less than 2 momentum, get momentum
elseif ataxia.vitals.class &lt; 2 then
  if ataxiaTemp.fractures.skullfractures &lt;= 1 and tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
  elseif ataxiaTemp.fractures.crackedribs &lt;= 1 and tAffs.mildtrauma and tAffs.paralysis and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
  elseif tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
  elseif tAffs.mildtrauma and ataxiaTemp.fractures.crackedribs &lt; 4 and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
  elseif tAffs.damagedrightarm and ataxiaTemp.parriedLimb ~= "right arm" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm right arm;sizeup " ..target.. ";assess " ..target
  elseif tAffs.damagedleftarm and ataxiaTemp.parriedLimb ~= "left arm" or tAffs.numbedleftarm then 
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
  elseif mprepped_torso == false and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
  elseif m2prepped_head == false and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
  elseif mprepped_rightleg == false and mprepped_leftleg == false and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg right leg;sizeup " ..target.. ";assess " ..target
  end
end

if table.contains(ataxia.playersHere, target) then
if falconattack == true then
  if not engaged then
    send("queue addclear freestand " ..atk.. ";engage " ..target)
  else
    send("queue addclear freestand " ..atk)
  end
elseif falconattack == false then
 if not engaged then
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target.." ;engage " ..target)
  else
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target)
  end
end
else
  expandAlias("nt")
  send("queue addclear freestand " ..atk)

end
end





function idwb_viviroute()
infernaldwbviviprio()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
MDWBWhirlDamage = MDWBWhirlDamage or 14
FDWBWhirlDamage = FDWBWhirlDamage or 20

ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = MDWBWhirlDamage
flaildamage = FDWBWhirlDamage
mstar2damage = MDWBWhirlDamage + MDWBWhirlDamage
flail2damage = FDWBWhirlDamage + FDWBWhirlDamage

tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
if ataxiaTemp.parriedLimb == nil then ataxiaTemp.parriedLimb = "none" end
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
use_bisect = true else
use_bisect = false
end


if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Stuff
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + flail2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + flail2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end


--Priority of Limb
if mprepped_rightleg == false then
tarlimb = "right leg"
elseif mprepped_head == false then
tarlimb = "head"
elseif mprepped_leftleg == false then
tarlimb = "left leg"
end


--ATTACKKKKK
 
-- Bisect

if myinstantcath == true then
  atk = atk.." touch shield"
elseif use_bisect == true then
  atk = atk.. "wield bastard;quash " ..target.. ";arc;assess " ..target.. " ;sizeup " ..target


-- Vivisect --
elseif tvivisect == true and ataxiaNDB.players[target].city ~= "Mhaldor" then
  atk = atk.. "dismount;vivisect " ..target
elseif tvivisect == true and ataxiaNDB.players[target].city == "Mhaldor" then
  send("say Vivisect")


-- Pulp
elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 5) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";pulp " ..target.. " ;sizeup " ..target.. " ;assess " ..target

--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. ";hyena slay " ..target.. ";fracture " ..target.. " ;assess " ..target.. " ;sizeup " ..target

-- Vivisect --
elseif (tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and tAffs.damagedleftarm or tAffs.brokenleftarm and tAffs.damagedrightarm or tAffs.brokenrightarm) and ataxiaNDB.players[target].city ~= "Mhaldor" then
  atk = atk.. "dismount;vivisect " ..target
elseif (tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and tAffs.damagedleftarm or tAffs.brokenleftarm and tAffs.damagedrightarm or tAffs.brokenrightarm) and ataxiaNDB.players[target].city == "Mhaldor" then
  send("say Vivisect")
  
  
--4 Break
-- Break Sequence
  -- If target preapplied - don't break
elseif tarpreapply == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso torso expend;assess " ..target

  --Break Head
elseif mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true and mprepped_head == true and ataxiaTemp.parriedLimb ~= "head" and ataxia.vitals.class &gt;= 5 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " head expend head;sizeup " ..target.. ";assess " ..target
elseif mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true and mprepped_head == true and ataxiaTemp.parriedLimb ~= "head" and ataxia.vitals.class &lt;= 3 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target

  --If not clumsiness don't use discipline
   
    -- Broken Legs -- Break Arms
elseif not ataxia.afflictions.clumsiness and mprepped_leftarm == true and mprepped_rightarm == true and tAffs.numbedleftarm and (tAffs.damagedrightleg or lb[target].hits["right leg"] &gt;= 100) or (tAffs.damagedleftleg or lb[target].hits["left leg"] &gt;= 100) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm left arm;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftarm == true and mprepped_rightarm == true and (tAffs.damagedrightleg or lb[target].hits["right leg"] &gt;= 100) or (tAffs.damagedleftleg or lb[target].hits["left leg"] &gt;= 100) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm left arm;sizeup " ..target.. ";assess " ..target

 -- Leg and Arm Prepped - Leg Prone
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true and tAffs.numbedleftarm and ataxia.vitals.class &gt;= 3 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true and ataxia.vitals.class &gt;= 3 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true and ataxia.vitals.class &gt;= 3 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

    --We need more momentum to prone with Stars
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true and ataxia.vitals.class &lt; 3 and ataxiaTemp.parriedLimb ~= "torso" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target

----------------
--If clumsiness use discipline
  -- Break Arms if Legs are broke
elseif ataxia.afflictions.clumsiness and mprepped_leftarm == true and mprepped_rightarm == true and tAffs.numbedleftarm and tAffs.damagedrightleg and tAffs.damagedleftleg then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " right arm left arm;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftarm == true and mprepped_rightarm == true and tAffs.damagedrightleg and tAffs.damagedleftleg then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " right arm left arm;sizeup " ..target.. ";assess " ..target

  -- Leg and Arm Prepped - Leg Prone
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true and tAffs.numbedleftarm and ataxia.vitals.class &gt;= 3 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true and ataxia.vitals.class &gt;= 3 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true and ataxia.vitals.class &gt;= 3 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target
    --We need more momentum to prone with Stars
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and mprepped_leftarm == true and mprepped_rightarm == true and ataxia.vitals.class &lt; 3 and ataxiaTemp.parriedLimb ~= "torso" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target

  
 
--Anti Parry
elseif not tAffs.numbedleftarm and ataxiaTemp.parriedLimb ~= "left arm" and ataxiaTemp.parriedLimb == "left leg" or ataxiaTemp.parriedLimb == "right leg" or ataxiaTemp.parriedLimb == "right arm" and m2prepped_leftarm == false and mprepped_leftarm == false then
  if ataxia.vitals.class &lt; 1 and ataxiaTemp.parriedLimb ~= "torso" then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
  elseif ataxia.vitals.class &lt; 1 and ataxiaTemp.parriedLimb == "torso" then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. ";sizeup " ..target.. ";assess " ..target
  elseif ataxia.vitals.class &gt; 1 then
    if mprepped_head == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    elseif mprepped_rightleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_leftleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_rightarm == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend right arm;sizeup " ..target.. ";assess " ..target
    elseif mprepped_leftarm == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend left arm;sizeup " ..target.. ";assess " ..target
    else
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend torso;sizeup " ..target.. ";assess " ..target
  
    end  
  end

-- 4 Prep
--Prep Head\ Left Leg\ Right Leg \ Right arm \ Left Arm
elseif m2prepped_leftarm == true and mprepped_leftleg == true and mprepped_rightleg == true and mprepped_rightarm == true and mprepped_head == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " left arm torso;assess " ..target
elseif m2prepped_rightarm == true and mprepped_leftleg == true and mprepped_rightleg == true and mprepped_rightarm == false and mprepped_leftarm == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " right arm left arm;assess " ..target
elseif m2prepped_rightleg == true and mprepped_head == true and mprepped_rightleg == false and mprepped_leftleg == true and mprepped_rightarm == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " right arm right leg;assess " ..target
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " left leg right leg;assess " ..target
elseif m2prepped_head == true and mprepped_head == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " head right leg;assess " ..target



-- 5 Prep
elseif mprepped_head == false and m2prepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " head head;assess " ..target
elseif mprepped_leftleg == false and m2prepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " left leg left leg;assess " ..target
elseif mprepped_rightleg == false and m2prepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " right leg right leg;assess " ..target
elseif mprepped_rightarm == false and m2prepped_rightarm == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " right arm right arm;assess " ..target
elseif mprepped_leftarm == false and m2prepped_leftarm == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " left arm left arm;assess " ..target


else
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " ;assess " ..target

end

if table.contains(ataxia.playersHere, target) then
if falconattack == true then
  if not engaged then
    send("queue addclear freestand " ..atk.. ";engage " ..target)
  else
    send("queue addclear freestand " ..atk)
  end
elseif falconattack == false then
 if not engaged then
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target.." ;engage " ..target)
  else
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target)
  end
end
else
  expandAlias("nt")
  send("queue addclear freestand " ..atk)

end
end

---Ideal
-------------USE BELOW FOR GROUP COMBAT and TO MELT MOFOS--------------------
function idwb_damageroute2()
infernaldwbviviprio()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
flail2damage = DWBWhirlDamage + DWBWhirlDamage

tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
if ataxiaTemp.parriedLimb == nil then ataxiaTemp.parriedLimb = "none" end
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Stuff
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + flail2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + flail2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end


--Priority of Limb
if mprepped_rightleg == false then
tarlimb = "right leg"
elseif mprepped_head == false then
tarlimb = "head"
elseif mprepped_leftleg == false then
tarlimb = "left leg"
end

if (tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and tAffs.damagedleftarm or tAffs.brokenleftarm and tAffs.damagedrightarm or tAffs.brokenrightarm) then
tvivsect = true
else 
tvivisect = false
end

--ATTACKKKKK
 
-- Bisect

if myinstantcath == true then
  atk = atk.." touch shield"

-- Vivisect --
elseif tvivisect == true and ataxiaNDB.players[target].city ~= "Mhaldor" then
  atk = atk.. "dismount;vivisect " ..target
elseif tvivisect == true and ataxiaNDB.players[target].city == "Mhaldor" then
  send("say Vivisect")

elseif use_bisect == true then
  atk = atk.. "wield bastard;quash " ..target.. ";arc;sizeup " ..target.. ";assess " ..target




-- Pulp

elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 5) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";pulp " ..target.. " ;engage " ..target.. ";sizeup " ..target.. " ;assess " ..target

--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. ";hyena slay " ..target.. ";fracture " ..target.. " ;assess " ..target.. " ;sizeup " ..target

-- Skull Fractures --
elseif tAffs.prone and ataxia.vitals.class &gt;= 2 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head expend head expend;assess " ..target.." ;sizeup " ..target
elseif tAffs.prone and ataxia.vitals.class &lt; 2 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
 
--Anti Parry
elseif not tAffs.numbedleftarm and ataxiaTemp.parriedLimb ~= "left arm" and ataxiaTemp.parriedLimb == "left leg" or ataxiaTemp.parriedLimb == "right leg" or ataxiaTemp.parriedLimb == "head" or ataxiaTemp.parriedLimb == "torso" or ataxiaTemp.parriedLimb == "right arm" then
  if ataxia.vitals.class &lt; 1 then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. " ;hyena slay " ..target.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
 
  elseif ataxia.vitals.class &gt; 1 then
    if mprepped_head == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    else 
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend torso;sizeup " ..target.. ";assess " ..target
    end
  end
  
  --If we have above 4 momentum, prone and hit head with flails to give skull fractures
elseif ataxia.vitals.class &gt;= 4 then  
  if ataxiaTemp.parriedLimb ~= "right leg" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right flail408566;hellforge invest torment;doublewhirl " ..target.. " right leg expend head expend;sizeup " ..target.. ";assess " ..target  
  elseif ataxiaTemp.parriedLimb ~= "left leg" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right flail408566;hellforge invest torment;doublewhirl " ..target.. " left leg expend head expend;sizeup " ..target.. ";assess " ..target  
  end
  
  --If we have above 2 momentum, use flails 
elseif ataxia.vitals.class &gt;= 2 then
  if ataxiaTemp.parriedLimb ~= "left arm" or tAffs.numbedleftarm then
    if ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &gt;= 2 and ataxiaTemp.fractures.wristfractures &gt;= 2 and tAffs.clumsiness then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend head expend;sizeup " ..target.. ";assess " ..target
    elseif ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &gt;= 2 and ataxiaTemp.fractures.wristfractures &gt;= 2 then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend left leg expend;sizeup " ..target.. ";assess " ..target
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.skullfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend head expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 and ataxiaTemp.fractures.skullfractures &lt; 1 then
      if ataxiaTemp.fractures.skullfractures &lt;= 1 and tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif ataxiaTemp.fractures.crackedribs &lt;= 1 and tAffs.mildtrauma and tAffs.paralysis and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif tAffs.mildtrauma and ataxiaTemp.fractures.crackedribs &lt; 4 and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedrightarm and ataxiaTemp.parriedLimb ~= "right arm" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm right arm;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedleftarm and ataxiaTemp.parriedLimb ~= "left arm" or tAffs.numbedleftarm then 
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
      elseif mprepped_torso == false and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif m2prepped_head == false and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif mprepped_rightleg == false and mprepped_leftleg == false and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg right leg;sizeup " ..target.. ";assess " ..target
      end
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &lt; 2 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend torso expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &lt; 1 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest exploit;doublewhirl " ..target.. " left arm expend right arm expend;sizeup " ..target.. ";assess " ..target  
    elseif not tAffs.clumsiness then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend right leg expend;sizeup " ..target.. ";assess " ..target
    end
  elseif ataxiaTemp.parriedLimb ~= "right arm" or tAffs.numbedleftarm then
    if ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &gt;= 2 and ataxiaTemp.fractures.wristfractures &gt;= 2 and tAffs.clumsiness then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend head expend;sizeup " ..target.. ";assess " ..target
    elseif ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &gt;= 2 and ataxiaTemp.fractures.wristfractures &gt;= 2 then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend left leg expend;sizeup " ..target.. ";assess " ..target
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.skullfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend head expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 and ataxiaTemp.fractures.skullfractures &lt; 1 then
      if ataxiaTemp.fractures.skullfractures &lt;= 1 and tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif ataxiaTemp.fractures.crackedribs &lt;= 1 and tAffs.mildtrauma and tAffs.paralysis and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif tAffs.mildtrauma and ataxiaTemp.fractures.crackedribs &lt; 4 and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedrightarm and ataxiaTemp.parriedLimb ~= "right arm" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm right arm;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedleftarm and ataxiaTemp.parriedLimb ~= "left arm" or tAffs.numbedleftarm then 
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
      elseif mprepped_torso == false and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif m2prepped_head == false and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif mprepped_rightleg == false and mprepped_leftleg == false and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg right leg;sizeup " ..target.. ";assess " ..target
      end
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &lt; 2 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend torso expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &lt; 1 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest exploit;doublewhirl " ..target.. " right arm expend right arm expend;sizeup " ..target.. ";assess " ..target  
    elseif not tAffs.clumsiness then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend right leg expend;sizeup " ..target.. ";assess " ..target
    end
  
  
  end
  
  --If we have less than 2 momentum, get momentum
elseif ataxia.vitals.class &lt; 2 then
  if ataxiaTemp.fractures.skullfractures &lt;= 1 and tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
  elseif ataxiaTemp.fractures.crackedribs &lt;= 1 and tAffs.mildtrauma and tAffs.paralysis and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
  elseif tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
  elseif tAffs.mildtrauma and ataxiaTemp.fractures.crackedribs &lt; 4 and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
  elseif tAffs.damagedrightarm and ataxiaTemp.parriedLimb ~= "right arm" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm right arm;sizeup " ..target.. ";assess " ..target
  elseif tAffs.damagedleftarm and ataxiaTemp.parriedLimb ~= "left arm" or tAffs.numbedleftarm then 
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
  elseif mprepped_torso == false and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
  elseif m2prepped_head == false and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
  elseif mprepped_rightleg == false and mprepped_leftleg == false and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg right leg;sizeup " ..target.. ";assess " ..target
  end
end

if table.contains(ataxia.playersHere, target) then
if falconattack == true then
  if not engaged then
    send("queue addclear freestand " ..atk.. ";engage " ..target)
  else
    send("queue addclear freestand " ..atk)
  end
elseif falconattack == false then
 if not engaged then
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target.." ;engage " ..target)
  else
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target)
  end
end
else
  expandAlias("nt")
  send("queue addclear freestand " ..atk)

end
end




---Not Ideal yet...
-------------BREAK ONE LEB/PRONE/SKULL FRACTURES/FLAIL WRIST/CRACKED RIBS AND DAMAGAEEEEEEEEEEEEEEEEEEEEEEEEE-------------------
function idwb_damageroute3()
infernaldwbviviprio()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
flail2damage = DWBWhirlDamage + DWBWhirlDamage

tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
if ataxiaTemp.parriedLimb == nil then ataxiaTemp.parriedLimb = "none" end
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Stuff
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + flail2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + flail2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + flail2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end

---Vivisect Condition
if (tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and tAffs.damagedleftarm or tAffs.brokenleftarm and tAffs.damagedrightarm or tAffs.brokenrightarm) then
tvivsect = true
else 
tvivisect = false
end

--ATTACKKKKK
 
-- Bisect

if myinstantcath == true then
  atk = atk.." touch shield"

-- Vivisect --
elseif tvivisect == true and ataxiaNDB.players[target].city ~= "Mhaldor" then
  atk = atk.. "dismount;vivisect " ..target
elseif tvivisect == true and ataxiaNDB.players[target].city == "Mhaldor" then
  send("say Vivisect")

--QUASH
elseif use_bisect == true then
  atk = atk.. " wield bastard;quash " ..target.. ";arc;sizeup " ..target.. ";assess " ..target




-- Pulp

elseif (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 5) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";pulp " ..target.. " ;engage " ..target.. ";sizeup " ..target.. " ;assess " ..target

--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. ";hyena slay " ..target.. ";fracture " ..target.. " ;assess " ..target.. " ;sizeup " ..target

-- Skull Fractures if Prone --
elseif tAffs.prone and ataxia.vitals.class &gt;= 2 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest torment;doublewhirl " ..target.. " head expend head expend;assess " ..target.." ;sizeup " ..target
elseif tAffs.prone and ataxia.vitals.class &lt; 2 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target

-- Break Sequence --

--Dont Double Break if they Pre-Apply
elseif tarpreapply == true then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso torso expend;assess " ..target

--Doublebreak with or without clumsiness (Add Discipline)
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. " wield left morningstar511732;wield right flail408566;hellforge invest torment;doublewhirl " ..target.. " left leg expend head expend;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. " wield left morningstar511732;wield right flail408566;hellforge invest torment;doublewhirl " ..target.. " left leg expend head expend;sizeup " ..target.. ";assess " ..target

elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. " wield left morningstar511732;wield right flail408566;hellforge invest torment;discipline;doublewhirl " ..target.. " left leg expend head expend;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and ataxia.vitals.class &gt;= 4 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. " wield left morningstar511732;wield right flail408566;hellforge invest torment;discipline;doublewhirl " ..target.. " left leg expend head expend;sizeup " ..target.. ";assess " ..target
--Doublebreak within Doublewhirl of Stars
elseif not ataxia.afflictions.clumsiness and m2prepped_leftleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg left leg expend;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and m2prepped_leftleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg left leg expend;sizeup " ..target.. ";assess " ..target

elseif ataxia.afflictions.clumsiness and m2prepped_leftleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " left leg left leg expend;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and m2prepped_leftleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";discipline;doublewhirl " ..target.. " left leg left leg expend;sizeup " ..target.. ";assess " ..target





--Anti Parry
elseif not tAffs.numbedleftarm and ataxiaTemp.parriedLimb ~= "left arm" and ataxiaTemp.parriedLimb == "left leg" or ataxiaTemp.parriedLimb == "right leg" or ataxiaTemp.parriedLimb == "head" or ataxiaTemp.parriedLimb == "torso" or ataxiaTemp.parriedLimb == "right arm" then
  if ataxia.vitals.class &lt; 1 then
    atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena track " ..target.. " ;hyena slay " ..target.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
 
  elseif ataxia.vitals.class &gt;= 1 then
    if mprepped_head == false then
      atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    else 
      atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";hyena slay " ..target.. ";doublewhirl " ..target.. " left arm expend torso;sizeup " ..target.. ";assess " ..target
    end
  end

-- Prep Left Leg

elseif mprepped_leftleg == true or m2prepped_leftleg == true and ataxia.vitals.class &lt; 4 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right leg right leg;sizeup " ..target.. ";assess " ..target

elseif ataxiaTemp.fractures.skullfractures &lt; 1 and ataxiaTemp.fractures.wristfractures &lt; 1 and ataxiaTemp.fractures.crackedribs &lt; 1 then
  if mprepped_leftleg == true or m2prepped_leftleg == true and ataxia.vitals.class &lt; 8 and ataxiaTemp.parriedLimb ~= "head" then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
  elseif mprepped_leftleg == true or m2prepped_leftleg == true and ataxia.vitals.class &lt; 8 and ataxiaTemp.parriedLimb ~= "torso" then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
  elseif mprepped_leftleg == false and m2prepped_leftleg == false then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg left leg;sizeup " ..target.. ";assess " ..target
  end
   

  
  --If we have above 2 momentum, use flails 
elseif ataxia.vitals.class &gt;= 2 and mprepped_leftleg == false and m2prepped_leftleg == false then
  if ataxiaTemp.parriedLimb ~= "left arm" or tAffs.numbedleftarm then
     if ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.skullfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 then
      atk = atk.. " wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend left leg expend;sizeup " ..target.. ";assess " ..target  
     elseif ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &lt; 1 and ataxiaTemp.fractures.wristfractures &gt;= 1 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend torso expend;sizeup " ..target.. ";assess " ..target  
     elseif ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &lt; 1 and ataxiaTemp.fractures.wristfractures &lt; 1 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest exploit;doublewhirl " ..target.. " left arm expend right arm expend;sizeup " ..target.. ";assess " ..target  
 
    
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 and ataxiaTemp.fractures.skullfractures &lt; 1 then
      if ataxiaTemp.fractures.skullfractures &lt;= 1 and tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif ataxiaTemp.fractures.crackedribs &lt;= 1 and tAffs.mildtrauma and tAffs.paralysis and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. " wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif tAffs.mildtrauma and ataxiaTemp.fractures.crackedribs &lt; 4 and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedrightarm and ataxiaTemp.parriedLimb ~= "right arm" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm right arm;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedleftarm and ataxiaTemp.parriedLimb ~= "left arm" or tAffs.numbedleftarm then 
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
      elseif mprepped_torso == false and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif m2prepped_head == false and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif mprepped_rightleg == false and mprepped_leftleg == false and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg right leg;sizeup " ..target.. ";assess " ..target
      end
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &lt; 2 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend torso expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &lt; 1 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest exploit;doublewhirl " ..target.. " left arm expend right arm expend;sizeup " ..target.. ";assess " ..target  
    elseif not tAffs.clumsiness then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm expend right leg expend;sizeup " ..target.. ";assess " ..target
    end
  elseif ataxiaTemp.parriedLimb ~= "right arm" or tAffs.numbedleftarm then
     if ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.skullfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 then
      atk = atk.. " wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend left leg expend;sizeup " ..target.. ";assess " ..target  
     elseif ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &lt; 1 and ataxiaTemp.fractures.wristfractures &gt;= 1 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend torso expend;sizeup " ..target.. ";assess " ..target  
     elseif ataxiaTemp.fractures.skullfractures &gt;= 2 and ataxiaTemp.fractures.crackedribs &lt; 1 and ataxiaTemp.fractures.wristfractures &lt; 1 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest exploit;doublewhirl " ..target.. " right arm expend right arm expend;sizeup " ..target.. ";assess " ..target  
 
    
    
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &gt;= 1 and ataxiaTemp.fractures.skullfractures &lt; 1 then
      if ataxiaTemp.fractures.skullfractures &lt;= 1 and tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif ataxiaTemp.fractures.crackedribs &lt;= 1 and tAffs.mildtrauma and tAffs.paralysis and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif tAffs.mildtrauma and ataxiaTemp.fractures.crackedribs &lt; 4 and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedrightarm and ataxiaTemp.parriedLimb ~= "right arm" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm right arm;sizeup " ..target.. ";assess " ..target
      elseif tAffs.damagedleftarm and ataxiaTemp.parriedLimb ~= "left arm" or tAffs.numbedleftarm then 
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
      elseif mprepped_torso == false and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
      elseif m2prepped_head == false and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
      elseif mprepped_rightleg == false and mprepped_leftleg == false and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" then
        atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg right leg;sizeup " ..target.. ";assess " ..target
      end
    elseif ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.crackedribs &lt; 2 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend torso expend;sizeup " ..target.. ";assess " ..target  
    elseif ataxiaTemp.fractures.wristfractures &lt; 1 then
      atk = atk.. "wield left flail343168;wield right morningstar511735;hellforge invest exploit;doublewhirl " ..target.. " right arm expend right arm expend;sizeup " ..target.. ";assess " ..target  
    elseif not tAffs.clumsiness then
      atk = atk.. "wield left flail343168;wield right flail408566;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm expend right leg expend;sizeup " ..target.. ";assess " ..target
    end
  
  
  end
  
  --If we have less than 2 momentum, get momentum
elseif ataxia.vitals.class &lt; 2 then
  if ataxiaTemp.fractures.skullfractures &lt;= 1 and tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
  elseif ataxiaTemp.fractures.crackedribs &lt;= 1 and tAffs.mildtrauma and tAffs.paralysis and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
  elseif tAffs.damagedhead and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
  elseif tAffs.mildtrauma and ataxiaTemp.fractures.crackedribs &lt; 4 and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
  elseif tAffs.damagedrightarm and ataxiaTemp.parriedLimb ~= "right arm" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " right arm right arm;sizeup " ..target.. ";assess " ..target
  elseif tAffs.damagedleftarm and ataxiaTemp.parriedLimb ~= "left arm" or tAffs.numbedleftarm then 
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left arm left arm;sizeup " ..target.. ";assess " ..target
  elseif mprepped_torso == false and ataxiaTemp.parriedLimb ~= "torso" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
  elseif m2prepped_head == false and ataxiaTemp.parriedLimb ~= "head" or tAffs.numbedleftarm then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target
  elseif mprepped_rightleg == false and mprepped_leftleg == false and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;hellforge invest " ..toppression.. ";doublewhirl " ..target.. " left leg right leg;sizeup " ..target.. ";assess " ..target
  end
end

if table.contains(ataxia.playersHere, target) then
if falconattack == true then
  if not engaged then
    send("queue addclear freestand " ..atk.. ";engage " ..target)
  else
    send("queue addclear freestand " ..atk)
  end
elseif falconattack == false then
 if not engaged then
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target.." ;engage " ..target)
  else
    send("queue addclear freestand " ..atk.. ";hyena slay " ..target)
  end
end
else
  expandAlias("nt")
  send("queue addclear freestand " ..atk)

end
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>I SNB</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>BLACKOUT HELL</name>
											<packageName></packageName>
											<script>function infernalpriosblackout()
if ataxia.afflictions.blackout then

send("queue addclear free touch shield")
else

local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
strikingHigh = false

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  



if tAffs.haemophilia then invest = "agony" elseif getMentalAffCount() &gt;= 3 then invest = "punishment" else invest = "agony" end
  
  

--SHIELDNEED

  shieldneed = {}
  
if ferocity_full and not tAffs.blackout then 
  table.insert(shieldneed,"concuss")
   
  
elseif tAffs.prone and not tAffs.blackout then
    table.insert(shieldneed,"concuss")
  

elseif tAffs.slickness and tAffs.asthma then
    table.insert(shieldneed,"smash high")


elseif tAffs.anorexia then
    table.insert(shieldneed,"smash high")



elseif softlock and tAffs.paralysis  then
    table.insert(shieldneed,"smash high")



elseif not tAffs.paralysis then
    table.insert(shieldneed,"smash mid")
    
elseif not tAffs.asthma then
    table.insert(shieldneed,"drive")
    
    
elseif not tAffs.clumsiness then
    table.insert(shieldneed,"smash low")
    

else
    table.insert(shieldneed,"smash high")
end

--SWORDLIST

swordneed = {}

if ferocity_full and not tAffs.blackout and not tAffs.prone and
tBals.tree and tLimbs.RL &gt;= 92.4 and tLimbs.RL &lt; 100 and tLimbs.LL &gt;= 92.4 then
targetlimb = "right leg"
    table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice curare")
end

if not tAffs.paralysis and shieldneed[1] ~= "smash mid" and softlock then
    table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice curare")
end

if not tAffs.slickness and tAffs.asthma and not tBals.tree then
     table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice gecko")
end

if not tAffs.slickness and tAffs.asthma and tAffs.clumsiness and tAffs.weariness then
     table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice gecko")
end


if tAffs.anorexia and not tAffs.stupidity then
   table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice aconite")
   end

if tAffs.anorexia and not tAffs.recklessness then
   table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice eurypteria")
   end
if tAffs.anorexia and not tAffs.dizziness then
   table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice larkspur")
   end

if tAffs.anorexia and not tAffs.shyness then
   table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice digitalis")
   end

if not tAffs.anorexia and tAffs.slickness then
    table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice slike")
end

   
if not tAffs.clumsiness and shieldneed[1] ~= "smash low" then
      table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice xentio")
end
   if tAffs.asthma and tAffs.clumsiness and not tAffs.weariness then
    table.insert(swordneed,"wipe longsword441711;hellforge invest exploit;combination "..target.." slice")
end

if not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice curare")
end

if not tAffs.asthma and shieldneed[1] ~= "drive" then
  table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice kalmia")
end

  if not tAffs.nausea and not softlock then
  table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice euphorbia")
end



if tAffs.prone and tAffs.paralysis and tAffs.slickness then
table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice epseth")
   end
   
   if softlock and not tAffs.paralysis then
   table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice curare")
   end


   
   if softlock and not tAffs.confusion then
  table.insert(swordneed,"wipe longsword441711;hellforge invest torment;combination "..target.." slice")
   end
   

   

   
if not softlock and not tAffs.haemophilia then
 table.insert(swordneed,"wipe longsword441711;hellforge invest torture;combination "..target.." slice")
end
  

if not softlock and not tAffs.healthleech then
 table.insert(swordneed,"wipe longsword441711;hellforge invest torment;combination "..target.." slice")
end


if not softlock and not tAffs.sensitivity then
  table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice prefarar")
end



if not tAffs.addiction then
  table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice vardrax")
end






--ATTACK


local atk = combatQueue()


if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.7) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
(ataxiaNDB_getClass(target) ~= "Apostate" or ataxiaNDB_getClass(target)) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end



if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end

if (tAffs.brokenrightleg or tAffs.damagedrightleg) and (tAffs.brokenleftleg or tAffs.damagedleftleg)
 and (tAffs.brokenleftarm or tAffs.damagedleftarm)  and  (tAffs.brokenrightarm or tAffs.damagedrightarm) then
vivisect = true
else
vivisect = false
end


if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
quash_arc = true
else
quash_arc = false
end

if quash_arc then

atk = "stand;wield shield longsword441711;assess "..target..";quash "..target..";arc "..target.." curare"

elseif need_raze then
atk = atk.."wield shield longsword441711;assess "..target..";combination " ..target.. " raze " ..shieldneed[1]

elseif vivisect then
atk = atk.."wield shield longsword441711;assess "..target..";vivisect "..target


elseif ferocity_full and not tAffs.prone and not tAffs.blackout then
atk = atk.."wield shield longsword441711;assess "..target..";shieldstrike "..target.." low;"..swordneed[1].." "..shieldneed[1]


elseif ferocity_full and tLimbs.RL &lt; 100 and tLimbs.RL &gt;= 92.4 and tAffs.slickness then
atk = atk.."wield shield longsword441711;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice right leg slike smash high"

elseif ferocity_full and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 92.4 and tAffs.slickness then
atk = atk.."wield shield longsword441711;assess "..target..";shieldstrike "..target.." low;hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 92.4 and tAffs.slickness then
atk = atk.."wield shield longsword441711;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 92.4 and tAffs.slickness then
atk = atk.."wield shield longsword441711;assess "..target..";hellforge invest "..invest..";combination "..target.." slice left leg slike smash high"


elseif ferocity_full and not tAffs.sensitivity then

atk = atk.."wield shield longsword441711;assess "..target..";shieldstrike "..target.." mid;"..swordneed[1].." "..shieldneed[1]


else
atk = atk.."wield shield longsword441711;assess "..target..";"..swordneed[1].." "..shieldneed[1]

end

if partyrelay and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 40 then send("pt "..target..": Health is at "..ataxiaTemp.lastAssess.."%")
end
if not ataxia.settings.paused then
 if add_dedication then
 send("queue addclear free dedication;"..atk)
elseif quash_arc then
send("setalias quasharc "..atk)
send("queue addclear free quasharc")
elseif not engaged then
send("queue addclear free "..atk..";engage "..target)

else

send("queue addclear free "..atk)

end

end
end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>test</name>
											<packageName></packageName>
											<script>function infernalpriostest()
local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
strikingHigh = false


if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
  


if tAffs.haemophilia then invest = "agony" elseif getMentalAffCount() &gt;= 3 then invest = "punishment" else invest = "agony" end
  
    shieldneed = {}
  if not tAffs.prone then
   table.insert(shieldneed,"trip")

  
elseif tAffs.impatience then
 table.insert(shieldneed,"smash high")


elseif tAffs.slickness and tAffs.asthma then
    table.insert(shieldneed,"smash high")


elseif tAffs.anorexia then
    table.insert(shieldneed,"smash high")


elseif softlock then
    table.insert(shieldneed,"smash high")



elseif not tAffs.paralysis then
    table.insert(shieldneed,"smash mid")
    

elseif not tAffs.asthma then
    table.insert(shieldneed,"drive")


elseif not tAffs.clumsiness then
    table.insert(shieldneed,"smash low")
    
else
    table.insert(shieldneed,"smash high")
end

--SWORDLIST

swordneed = {}

if not tAffs.prone then
    table.insert(swordneed,"hellforge invest "..invest..";combination "..target.." slice epseth")
end

atk = atk.."wield shield longsword441711;assess "..target..";hyena scent;"..swordneed[1].." "..shieldneed[1]

if partyrelay and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 40 then send("pt "..target..": Health is at "..ataxiaTemp.lastAssess.."%")
end
if not ataxia.settings.paused then
 if add_dedication then
 send("queue addclear free dedication;"..atk)
elseif quash_arc then
send("setalias quasharc "..atk)
send("queue addclear eq quasharc")
else

send("queue addclear free "..atk)

end

end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="no" isFolder="no">
											<name>PRIOS WEARINESS</name>
											<packageName></packageName>
											<script>function infernalpriosweariness()
envenomList = {}

local atk = combatQueue()

partyrelay = partyrelay or false
strikingHigh = true

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  


 

--SHIELDNEED

  shieldneed = {}
  



if not softlock and tAffs.slickness and tAffs.asthma then
    table.insert(shieldneed,"smash high")



elseif treelock then
    table.insert(shieldneed,"smash high")



elseif not tAffs.paralysis then
    table.insert(shieldneed,"smash mid")
    
    elseif not tAffs.clumsiness then
    table.insert(shieldneed,"smash low")
    
    
elseif not tAffs.asthma then
    table.insert(shieldneed,"drive")
    
    


else
    table.insert(shieldneed,"smash high")
end













--SWORDLIST

swordneed = {}

if tAffs.slickness and not tAffs.anorexia then
    table.insert(swordneed,"combination "..target.." slice slike")
    table.insert(envenomList, "slike")
end

if ferocity_full and not tAffs.slickness and tAffs.asthma and not tBals.tree and shieldneed[1] == "smash mid" then
     table.insert(swordneed,"shieldstrike "..target.." low;combination "..target.." slice gecko")
  table.insert(envenomList, "gecko")
end

if (tAffs.prone or ferocity_full) and not tAffs.slickness and tAffs.asthma and tAffs.weariness then
     table.insert(swordneed,"shieldstrike "..target.." low;combination "..target.." slice gecko")
     table.insert(envenomList, "gecko")
end

if  not tAffs.slickness and tAffs.asthma and tAffs.paralysis then
     table.insert(swordneed,"combination "..target.." slice gecko")
     table.insert(envenomList, "gecko")
end

if treelock and not tAffs.stupidity then
   table.insert(swordneed,"combination "..target.." slice aconite")
   table.insert(envenomList, "aconite")
   end

if treelock and not tAffs.recklessness then
   table.insert(swordneed,"combination "..target.." slice eurypteria")
   table.insert(envenomList, "eurypteria")
   end
if treelock and not tAffs.dizziness then
   table.insert(swordneed,"combination "..target.." slice larkspur")
   table.insert(envenomList, "larkspur")
   end

if treelock and not tAffs.shyness then
   table.insert(swordneed,"combination "..target.." slice digitalis")
   table.insert(envenomList, "digitalis")
   end
if treelock and not brokenleftarm then
  table.insert(swordneed,"combination "..target.." slice epteth")
  table.insert(envenomList, "epteth")
   end
if treelock and not brokenrightarm then
  table.insert(swordneed,"combination "..target.." slice epteth")
  table.insert(envenomList, "epteth")
   end

if treelock and not brokenleftleg then
  table.insert(swordneed,"combination "..target.." slice epseth")
  table.insert(envenomList, "epseth")
   end
   
if treelock and not brokenrightleg then
  table.insert(swordneed,"combination "..target.." slice epseth")
  table.insert(envenomList, "epseth")
   end

if not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    table.insert(swordneed,"combination "..target.." slice curare")
    table.insert(envenomList, "curare")
end

   if  not tAffs.weariness then
    table.insert(swordneed,"combination "..target.." slice vernalius")
    table.insert(envenomList, "vernalius")
end

if not tAffs.asthma and shieldneed[1] ~= "drive" then
    table.insert(swordneed,"combination "..target.." slice kalmia")
    table.insert(envenomList, "kalmia")
end


if not tAffs.clumsiness and shieldneed[1] ~= "smash low" then
    table.insert(swordneed,"combination "..target.." slice xentio")
    table.insert(envenomList, "xentio")
end




  if not tAffs.nausea and not softlock and not tAffs.slickness then
    table.insert(swordneed,"combination "..target.." slice euphorbia")
    table.insert(envenomList, "euphorbia")
end


if not tAffs.darkshade then
    table.insert(swordneed,"combination "..target.." slice darkshade")
    table.insert(envenomList, "darkshade")
end

if not tAffs.addiction then
    table.insert(swordneed,"combination "..target.." slice vardrax")
    table.insert(envenomList, "vardrax")
end




if not softlock and not tAffs.sensitivity then
  table.insert(swordneed,"combination "..target.." slice prefarar")
  table.insert(envenomList, "prefarar")
end









--ATTACK


local atk = combatQueue()


if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.7) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
(ataxiaNDB_getClass(target) ~= "Apostate" or ataxiaNDB_getClass(target)) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end



if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end


--if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then


if need_raze then
atk = atk.."wield shield longsword441711;assess "..target..";combination " ..target.. " raze " ..shieldneed[1]

elseif ferocity_full and tLimbs.RL &lt; 100 and tLimbs.RL &gt;= 92.4 and not tAffs.slickness and tAffs.asthma and tAffs.weariness then
targetlimb = "right leg"
infernalpriosprep()

elseif ferocity_full and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 92.4 and not tAffs.slickness and tAffs.asthma and tAffs.weariness then
targetlimb = "left leg"
infernalpriosprep()

elseif not ferocity_full and tLimbs.RL &lt; 100 and tLimbs.RL &gt;= 92.4 and tAffs.slickness then
targetlimb = "right leg"
infernalpriosprep()

elseif not ferocity_full and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 92.4 and tAffs.slickness then
targetlimb = "left leg"
infernalpriosprep()



elseif ferocity_full and not tAffs.sensitivity and not softlock and not tAffs.asthma and tBals.tree then

atk = atk.."wield shield longsword441711;assess "..target..";shieldstrike "..target.." mid;"..swordneed[1].." "..shieldneed[1]



else
atk = atk.."wield shield longsword441711;assess "..target..";"..swordneed[1].." "..shieldneed[1]

end

if partyrelay and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 40 then send("pt "..target..": Health is at "..ataxiaTemp.lastAssess.."%")
end
if not ataxia.settings.paused then
 if add_dedication then
 send("queue addclear free dedication;"..atk)
elseif not engaged then
send("queue addclear free "..atk..";engage "..target)

else

send("queue addclear free "..atk)

end
end

end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>RAMPAGE</name>
											<packageName></packageName>
											<script>function infernalpriosrampage()
local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false



if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
  




--VENOMS

  venoms = {}
  


if not tAffs.slickness and not tAffs.asthma and not tBals.tree then
    table.insert(venoms,"kalmia")
  table.insert(venoms,"gecko")
 
end

if not tAffs.paralysis then
  table.insert(venoms,"curare")

end

if not tAffs.nausea then
  table.insert(venoms,"euphorbia")

end


if not tAffs.clumsiness then
  table.insert(venoms,"xentio")

end

if not tAffs.asthma then
  table.insert(venoms,"kalmia")

end



if not tAffs.darkshade then
  table.insert(venoms,"darkshade")

end

if not tAffs.stupidity then
  table.insert(venoms,"aconite")

end

if not tAffs.addiction then

  table.insert(venoms,"vardrax")

end



--INVESTS


invest = {}

if not tAffs.weariness and tAffs.clumsiness then invest = "exploit"

elseif not tAffs.haemophilia and tAffs.nausea then invest = "torture"

elseif tAffs.haemophilia then invest = "agony" 

elseif getMentalAffCount() &gt;= 2 then invest = "punishment" 

else invest = "agony" end
  
  



--ATTACK


local atk = combatQueue()


if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.5) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
(ataxiaNDB_getClass(target) ~= "Apostate" or ataxiaNDB_getClass(target)) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end



if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end

if tAffs.rebounding and tAffs.shield then
need_shieldraze = true
else
need_shieldraze = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &gt; 50 and ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 and ataxia.vitals.class == 4 then
impale_blackout = true
else
impale_blackout = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
quash_arc = true
else
quash_arc = false
end


if quash_arc then

atk = "stand/wield shield longsword441711/quash "..target.."/arc "..target.." curare"

elseif need_shieldraze then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;rampage against "..target..";assess "..target..";hellforge invest "..invest..";raze "..target.." shield"


elseif need_raze then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;rampage against "..target..";assess "..target..";hellforge invest "..invest..";razeslash "..target.." "..venoms[1]

elseif (invest == "exploit" or invest == "torture") then

atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;rampage against "..target..";assess "..target..";hellforge invest "..invest..";envenom scimitar383498 with "..venoms[1]..";dsl "..target

else
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;rampage against "..target..";assess "..target..";hellforge invest "..invest..";dsl "..target.." "..venoms[1].." "..venoms[2]

end


if not ataxia.settings.paused then

if quash_arc then
send("setalias quasharc "..atk)
send("queue addclear eq quasharc")

elseif not engaged then
send("queue addclear free "..atk..";engage "..target..";tyranny")

else

send("queue addclear free "..atk..";tyranny")

end
end


end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>LIMB PREP</name>
											<packageName></packageName>
											<script>function dwcprep()

local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
scimdamage = ataxiaTables.limbData.dwcSlash + ataxiaTables.limbData.dwcSlash
axedamage = scimdamage - 3

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
  




--VENOMS

  venoms = {}
  



if
((prepped_leftleg and prepped_rightleg) or (prepped_leftleg and tAffs.damagedrightleg) or (prepped_rightleg and tAffs.damagedleftleg)) and not tAffs.prone and not tAffs.rebounding and not tAffs.shield then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
end



if (tAffs.damagedrightleg or tAffs.damagedleftleg) and (prepped_rightleg or prepped_leftleg) then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epteth")
  
  elseif tAffs.damagedrightleg and tAffs.damagedleftleg  then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epteth")
  
  
  
  elseif (tAffs.damagedrightleg or tAffs.damagedleftleg) and (prepped_rightarm or prepped_leftarm) then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
  
   elseif (tAffs.damagedrightleg or tAffs.damagedleftleg) and (tAffs.damagedrightarm or tAffs.damagedleftarm) then
    table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
  
 elseif (tAffs.damagedrightarm or tAffs.damagedleftarm) and (prepped_rightleg or prepped_leftleg) then
    table.insert(venoms,"epseth")
  table.insert(venoms,"epseth")
  
   elseif tAffs.damagedrightarm and tAffs.damagedleftarm then
    table.insert(venoms,"epseth")
  table.insert(venoms,"epseth")


 
end

if tAffs.slickness and not tAffs.anorexia and tAffs.paralysis and not tAffs.stupid then
  table.insert(venoms,"aconite")
  table.insert(venoms,"slike")
  
  end
  



if not tAffs.paralysis then
  table.insert(venoms,"curare")

end

if not tAffs.nausea then
  table.insert(venoms,"euphorbia")

end





if not tAffs.clumsiness then
  table.insert(venoms,"xentio")

end

if not tAffs.asthma then
  table.insert(venoms,"kalmia")

end

if not tAffs.sensitivity then

  table.insert(venoms,"prefarar")
  table.insert(venoms,"prefarar")

end




if not tAffs.slickness and tAffs.asthma and venoms[1] == "curare" then

  table.insert(venoms,"gecko")

end


if not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end

if not tAffs.dizziness then
table.insert(venoms,"larkspur")
end


if not tAffs.stupidity then
  table.insert(venoms,"aconite")

end

if not tAffs.addiction then

  table.insert(venoms,"vardrax")

end

if not tAffs.darkshade then
  table.insert(venoms,"darkshade")

end





--INVESTS


invest = {}

if venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" and not tAffs.weariness and tAffs.anorexia and tAffs.asthma and tAffs.slickness then invest = "exploit"

elseif venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" and not tAffs.weariness and (venoms[1] == "aconite" or venoms[2] == "aconite") and tAffs.asthma and tAffs.slickness then invest = "exploit"

elseif venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" and tAffs.haemophilia then invest = "agony" 

elseif getMentalAffCount() &gt;= 4 then invest = "punishment" 

else invest = "agony" end
  
  



--ATTACK


local atk = combatQueue()


if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.5) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
(ataxiaNDB_getClass(target) ~= "Apostate" or ataxiaNDB_getClass(target)) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end

if (tLimbs.RL + scimdamage &gt;= 100) and (tLimbs.RL + axedamage &lt; 100) and targetlimb == "right leg" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.RA + scimdamage &gt;= 100) and (tLimbs.RA + axedamage &lt; 100) and targetlimb == "right arm" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.LL + scimdamage &gt;= 100) and (tLimbs.LL + axedamage &lt; 100) and targetlimb == "left leg" then

need_raze3 = true
else
need_raze3 = false
end

if (tLimbs.LA + scimdamage &gt;= 100) and (tLimbs.LA + axedamage &lt; 100) and targetlimb == "left arm" then

need_raze3 = true
else
need_raze3 = false
end

if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end


if (tAffs.brokenrightleg or tAffs.damagedrightleg) and (tAffs.brokenleftleg or tAffs.damagedleftleg)
 and (tAffs.brokenleftarm or tAffs.damagedleftarm)  and  (tAffs.brokenrightarm or tAffs.damagedrightarm) and tAffs.prone then
vivisect = true
else
vivisect = false
end

if tAffs.rebounding and tAffs.shield then
need_shieldraze = true
else
need_shieldraze = false
end

if  tLimbs.LL + scimdamage &gt;= 100 and not tAffs.damagedleftleg then 
prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + scimdamage &gt;= 100 and not tAffs.damagedrightleg then 
prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + scimdamage &gt;= 100 and not tAffs.damagedrightarm then 
prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + scimdamage &gt;= 100 and not tAffs.damagedleftarm then 
prepped_leftarm = true else
prepped_leftarm = false

end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &gt; 50 and ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 and ataxia.vitals.class == 4 then
impale_blackout = true
else
impale_blackout = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 35 then
quash_arc = true
else
quash_arc = false
end


if quash_arc then

atk = "stand/wield shield longsword441711/assess "..target.."/quash "..target.."/arc "..target.." curare"

elseif vivisect then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;rampage against "..target..";assess "..target..";hellforge invest "..invest..";dismount;vivisect "..target



elseif need_shieldraze then
atk = "stand/wield shield longsword441711/assess "..target.."/quash "..target.."/arc "..target.." curare"


elseif need_raze then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;rampage against "..target..";assess "..target..";hellforge invest "..invest..";razeslash "..target.." "..targetlimb.." "..venoms[1]

elseif need_raze2 then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;rampage against "..target..";assess "..target..";hellforge invest "..invest..";razeslash "..target.." "..targetlimb.." "..venoms[1]

elseif need_raze3 then
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;rampage against "..target..";assess "..target..";hellforge invest "..invest..";razeslash "..target.." "..targetlimb.." "..venoms[1]

--elseif prepped_leftleg and prepped_rightleg and not tAffs.prone then

--atk = atk.."wield battleaxe;rampage against "..target..";assess "..target..";hellforge invest "..invest..";undercut "..target.." "..targetlimb.." "..venoms[1]

--elseif prepped_leftleg and prepped_rightarm and not tAffs.prone then

--atk = atk.."wield battleaxe;rampage against "..target..";assess "..target..";hellforge invest "..invest..";undercut "..target.." left leg "..venoms[1]

--elseif prepped_rightleg and prepped_rightarm and not tAffs.prone then

--atk = atk.."wield battleaxe;rampage against "..target..";assess "..target..";hellforge invest "..invest..";undercut "..target.." right leg "..venoms[1]



elseif (invest == "exploit" or invest == "torture" or invest == "torment") and venoms[1] ~= "epteth" and venoms[1] ~= "delphinium" then

atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;rampage against "..target..";assess "..target..";hellforge invest "..invest..";envenom scimitar383498 with "..venoms[1]..";dsl "..target.." "..targetlimb

else
atk = atk.."wield scimitar scimitar;wipe scimitar383498;wipe scimitar355418;rampage against "..target..";assess "..target..";hellforge invest "..invest..";dsl "..target.." "..targetlimb.." "..venoms[1].." "..venoms[2]

end


if not ataxia.settings.paused then

if quash_arc then
send("setalias quasharc "..atk)
send("queue addclear free quasharc")

elseif not engaged then
send("queue addclear free "..atk..";engage "..target..";tyranny")

else

send("queue addclear free "..atk..";tyranny")

end
end


end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Damage Into Lock</name>
											<packageName></packageName>
											<script>function infernalpriosdamage()
if ataxia.afflictions.blackout then
send("queue addclear free touch shield")
else
envenomList = {}
local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or false
strikingHigh = false
need_falcon = true


-- Check for Lock
if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
  
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end

  
if checkAffList({"anorexia", "asthma", "slickness", "paralysis", "impatience"},5) then
	local	truelock = true
  else
  truelock = false
	
	end

-- Invest
-- Punishment = Scales off Mentals
-- Torture = Haemophilia and if attack breaks limb more bleeding
-- Exploit = Weariness and Paranoia
-- Agony = Strikes a target bleeding 200 , cures affliction - Can be used with venoms, persists on blade have to remove 
-- torment = healthleech then confusion

if not tAffs.healthleech then invest = "torment" elseif getMentalAffCount() &gt;= 3 then invest = "punishment" else invest = "agony" end
  
  

--SHIELDNEED/Shield Attack

  shieldneed = {}

if tAffs.prone and not tAffs.blackout and ferocity_full then
    table.insert(shieldneed,"concuss")
  

elseif tAffs.slickness and tAffs.asthma then
    table.insert(shieldneed,"smash high")


elseif tAffs.anorexia then
    table.insert(shieldneed,"smash high")


elseif softlock and tAffs.paralysis  then
    table.insert(shieldneed,"smash high")

elseif not tAffs.paralysis then
    table.insert(shieldneed,"smash mid")
    
elseif not tAffs.asthma then
    table.insert(shieldneed,"drive")
    
elseif tAffs.impatience and tAffs.paralysis then
     table.insert(shieldneed,"smash high")

elseif not tAffs.clumsiness then
    table.insert(shieldneed,"smash low")
    
else
    table.insert(shieldneed,"smash high")
end

--SWORDLIST


 

swordneed = {}

if truelock == true and not tAffs.voyria then
 invest = "punishment"
table.insert(envenomList,"voyria")
end

if tAffs.impatience and not tAffs.anorexia and not tBals.salve then
 invest = "agony"
table.insert(envenomList,"slike")
end

if tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
  invest = "agony"
 table.insert(envenomList,"slike")
end

if tAffs.impatience and not tAffs.slickness and tAffs.asthma then
 invest = "agony"
table.insert(envenomList,"gecko")
end


if not tAffs.paralysis and shieldneed[1] ~= "smash mid" and softlock then
     invest = "agony"
    table.insert(envenomList,"curare")
end


if tAffs.anorexia and not tAffs.stupidity then
    invest = "agony"
   table.insert(envenomList,"aconite")
   end

if tAffs.anorexia and not tAffs.recklessness then
    invest = "agony"
   table.insert(envenomList,"eurypteria")
   end
if tAffs.anorexia and not tAffs.dizziness then
    invest = "agony"
   table.insert(envenomList,"larkspur")
   end

if tAffs.anorexia and not tAffs.shyness then
    invest = "agony"
   table.insert(envenomList,"digitalis")
   end

if not tAffs.anorexia and tAffs.slickness then
     invest = "agony"
    table.insert(envenomList,"slike")
end

if not tAffs.slickness and tAffs.asthma  then
     invest = "agony"
     table.insert(envenomList,"gecko")
end
   
if tAffs.healthleech and tAffs.clumsiness and not tAffs.asthma and shieldneed[1] ~= "drive" then
     invest = "agony"
    table.insert(envenomList,"kalmia")
end


if tAffs.healthleech and not tAffs.clumsiness and shieldneed[1] ~= "smash low" then
     invest = "agony"
    table.insert(envenomList,"xentio")
end

if not tAffs.haemophilia then
invest = "torture"
table.insert(envenomList,"torture")
end
  
if not tAffs.sensitivity and tAffs.healthleech then
   invest = "agony"
  table.insert(envenomList,"prefarar")
end

if not tAffs.haemophilia then
invest = "torture"
table.insert(envenomList,"torture")
end

if not tAffs.healthleech then
 invest = "torment"
 table.insert(envenomList,"healthleech")
end


if tAffs.asthma and tAffs.clumsiness and not tAffs.weariness then
    invest = "exploit"
    table.insert(envenomList,"exploit")
end

if not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
    invest = "agony"
    table.insert(envenomList,"curare")
end

if not tAffs.asthma and shieldneed[1] ~= "drive" then
   invest = "agony"
  table.insert(envenomList,"kalmia")
end


if not tAffs.nausea then
  invest = "agony"
  table.insert(envenomList,"euphorbia")
end


if softlock and not tAffs.paralysis and shieldneed[1] ~= "smash mid" then
   invest = "agony"
   table.insert(envenomList,"curare")
   end

if softlock and not tAffs.confusion then
   invest = "agony"
  table.insert(envenomList,"torment")
   end
   

if not tAffs.haemophilia then
invest = "torture"
table.insert(envenomList,"torture")
end
  
if not tAffs.addiction then
   invest = "agony"
  table.insert(envenomList,"vardrax")
end






--ATTACK


local atk = combatQueue()


if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.7) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
(ataxiaNDB_getClass(target) ~= "Apostate" or ataxiaNDB_getClass(target)) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end



if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end

if (tAffs.brokenrightleg or tAffs.damagedrightleg) and (tAffs.brokenleftleg or tAffs.damagedleftleg)
 and (tAffs.brokenleftarm or tAffs.damagedleftarm)  and  (tAffs.brokenrightarm or tAffs.damagedrightarm) then
vivisect = true
else
vivisect = false
end


if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
quash_arc = true
else
quash_arc = false
end

if php &lt;= 30 then
quash_arc = true
else
quash_arc = false
end

if php &lt;= 32 and tAffs.sensitivity then
quash_arc = true
else
quash_arc = false
end

if quash_arc then

atk = "stand;wield shield longsword441711;assess "..target..";quash "..target..";arc "..target.." curare"

elseif need_raze then
atk = atk.."wield shield longsword441711;assess "..target..";combination " ..target.. " raze " ..shieldneed[1]

elseif vivisect then
atk = atk.."wield shield longsword441711;assess "..target..";vivisect "..target


elseif ferocity_full and not tAffs.prone and not tAffs.slickness and not tAffs.paralysis and tAffs.asthma then
atk = atk.."wield shield longsword441711;assess "..target..";combination " ..target.. " slice gecko smash mid;shieldstrike "..target.." low"

elseif ferocity_full and not tAffs.prone and tAffs.slickness and not tAffs.paralysis and tAffs.asthma then
atk = atk.."wield shield longsword441711;assess "..target..";combination " ..target.. " slice slike smash mid;shieldstrike "..target.." low"

elseif ferocity_full and not tAffs.prone and not tAffs.slickness and tAffs.paralysis and tAffs.asthma then
atk = atk.."wield shield longsword441711;assess "..target..";combination " ..target.. " slice gecko smash high;shieldstrike "..target.." low"



elseif ferocity_full and tLimbs.RL &lt; 100 and tLimbs.RL &gt;= 92.4 and tAffs.slickness then
atk = atk.."wield shield longsword441711;assess "..target..";shieldstrike "..target.." low;combination "..target.." slice right leg slike smash high"

elseif ferocity_full and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 92.4 and tAffs.slickness then
atk = atk.."wield shield longsword441711;assess "..target..";shieldstrike "..target.." low;combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 92.4 and tAffs.slickness then
atk = atk.."wield shield longsword441711;assess "..target..";combination "..target.." slice left leg slike smash high"

elseif tAffs.prone and tLimbs.LL &lt; 100 and tLimbs.LL &gt;= 92.4 and tAffs.slickness then
atk = atk.."wield shield longsword441711;assess "..target..";combination "..target.." slice left leg slike smash high"


elseif ferocity_full and not tAffs.sensitivity then

atk = atk.."wield shield longsword441711;assess "..target..";hellforge invest agony;shieldstrike "..target.." mid;combination " ..target.. " slice " ..envenomList[1].. " " ..shieldneed[1]



-- Punishment = Scales off Mentals
-- Torture = Haemophilia and if attack breaks limb more bleeding
-- Exploit = Weariness and Paranoia
-- Agony = Strikes a target bleeding 200 , cures affliction - Can be used with venoms, persists on blade have to remove 
-- torment = healthleech then confusion
elseif invest == "punishment" then
atk = atk.."wield shield longsword441711;assess "..target..";hellforge invest punishment;combination " ..target.. " slice " ..shieldneed[1]
elseif invest == "torture" then
atk = atk.."wield shield longsword441711;assess "..target..";hellforge invest torture;combination " ..target.. " slice " ..shieldneed[1]
elseif invest == "exploit" then
atk = atk.."wield shield longsword441711;assess "..target..";hellforge invest exploit;combination " ..target.. " slice " ..shieldneed[1]
elseif invest == "torment" then
atk = atk.."wield shield longsword441711;assess "..target..";hellforge invest torment;combination " ..target.. " slice " ..shieldneed[1]

elseif invest == "agony" then
atk = atk.."wield shield longsword441711;assess "..target..";hellforge invest agony;combination " ..target.. " slice " ..envenomList[1].. " " ..shieldneed[1]


else
atk = atk.."wield shield longsword441711;assess "..target..";combination " ..target.. " slice "  ..envenomList[1].. " "..shieldneed[1]


end

if partyrelay and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 40 then send("pt "..target..": Health is at "..ataxiaTemp.lastAssess.."%")
end
if not ataxia.settings.paused then

if add_dedication then
 send("queue addclear free dedication;"..atk)
elseif quash_arc then
send("setalias quasharc "..atk)
send("queue addclear free quasharc")
elseif not engaged then
send("queue addclear free stand;hyena slay " ..target.. ";" ..atk.. ";engage "..target)
elseif invest == "agony" then
send("queue addclear free stand;hyena slay " ..target.. ";" ..atk)
else
send("queue addclear free "..atk)

end

end
end
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Infernal 2H</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<ScriptGroup isActive="yes" isFolder="yes">
											<name>TWO HANDED</name>
											<packageName></packageName>
											<script></script>
											<eventHandlerList />
											<Script isActive="yes" isFolder="no">
												<name>Infernal Two Hand</name>
												<packageName></packageName>
												<script>function infernaltwohand()
tfractureamt = tfractureamt or 0
tfractureloc = tfractureloc or nil
tpriofrac = tpriofrac or "none"
local atk = combatQueue()
twohanddamage = ataxiaTables.limbData.twoHander

--INVESTS

invest = invest or "exploit"
if tAffs.haemophilia and tAffs.healthleech and not tAffs.confusion then
invest = "torment"
elseif tAffs.healthleech and not tAffs.haemophilia then
invest = "torture"
elseif not tAffs.healthleech and tAffs.weariness then
invest = "torment"
elseif not tAffs.weariness then 
invest = "exploit"
else
invest = "exploit"
end

--Venoms
venoms = {}


if not tAffs.paralysis then
  table.insert(venoms,"curare")

end

if not tAffs.nausea then
  table.insert(venoms,"euphorbia")

end

if not tAffs.asthma then
  table.insert(venoms,"kalmia")

end

if not tAffs.clumsiness then
  table.insert(venoms,"xentio")

end

if not tAffs.sensitivity then
  table.insert(venoms,"prefarar")

end


if not tAffs.slickness and tAffs.asthma then
  table.insert(venoms,"gecko")

end





--ATTACK

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 30 then
quash_arc = true
else
quash_arc = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 40 and tAffs.sensitivity then
quash_arc2 = true
else
quash_arc2 = false
end

if tAffs.impaled then
disembowel = true
else
disembowel = false
end

if tAffs.rebounding or tAffs.shield then
need_raze = true
else
need_raze = false
end

if not tAffs.rebounding and tAffs.shield then
need_shieldraze = true
else
need_shieldraze = false
end


if (tAffs.brokenrightleg or tAffs.damagedrightleg) and (tAffs.brokenleftleg or tAffs.damagedleftleg) and (tAffs.brokenleftarm or tAffs.damagedleftarm)  and  (tAffs.brokenrightarm or tAffs.damagedrightarm) and tAffs.prone then
vivisect = true
else
vivisect = false
end



if lb[target].hits["left leg"] + twohanddamage &gt; 100 and not tAffs.damagedleftleg then 
prepped_leftleg = true else
prepped_leftleg = false

end

if lb[target].hits["right leg"] + twohanddamage &gt; 100 and not tAffs.damagedrightleg then 
prepped_rightleg = true else
prepped_rightleg = false

end

if lb[target].hits["right arm"] + twohanddamage &gt; 100 and not tAffs.damagedrightarm then 
prepped_rightarm = true else
prepped_rightarm = false

end

if lb[target].hits["left arm"] + twohanddamage &gt; 100 and not tAffs.damagedleftarm then 
prepped_leftarm = true else
prepped_leftarm = false
end

-- Target Limb and Battlefury Focus

if disembowel then 

  atk = atk.."wield bastard405364;battlefury perceive "..target..";hellforge invest "..invest..";disembowel "..target..";assess "..target

elseif quash_arc == true or quash_arc2 == true then

  atk = "stand;wield bastard405364;assess "..target..";quash "..target..";arc curare"

elseif vivisect then
  atk = atk.."dismount;vivisect "..target..";assess "..target

elseif need_shieldraze then
  atk = "stand;wield shield bastard;assess "..target..";quash "..target..";arc curare"

elseif need_raze and not tAffs.prone then
  atk = atk.."wield warhammer109410;wipe warhammer109410;battlefury perceive "..target..";battlefury focus speed;hellforge invest "..invest..";splinter "..target..";assess "..target

elseif tAffs.prone then
  atk = atk.."wield bastard405364;wipe bastard405364;battlefury perceive "..target..";hellforge invest "..invest..";impale "..target..";assess "..target

elseif ataxiaTemp.fractures.torntendons == 6 then 
  atk = atk.."wield warhammer109410;wipe warhammer109410;battlefury perceive "..target..";hellforge invest "..invest..";devastate "..target.." legs;battlefury upset "..target..";assess "..target

elseif ataxiaTemp.fractures.torntendons == 5 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.."wield bastard405364;wipe bastard405364;battlefury perceive "..target.."battlefury focus speed;envenom bastard with " ..venoms[1].. ";hew " ..target.. " left leg;assess " ..target

elseif ataxiaTemp.fractures.torntendons == 5 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.."wield bastard405364;wipe bastard405364;battlefury perceive "..target.."battlefury focus speed;envenom bastard with " ..venoms[1].. ";hew " ..target.. " right leg;assess " ..target


elseif ataxiaTemp.fractures.torntendons == 4 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.."wield warhammer109410;wipe warhammer109410;battlefury perceive "..target..";battlefury focus precision;hellforge invest "..invest..";pulverise "..target.. " left leg;assess "..target

elseif ataxiaTemp.fractures.torntendons == 4 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.."wield warhammer109410;wipe warhammer109410;battlefury perceive "..target..";battlefury focus precision;hellforge invest "..invest..";pulverise "..target.. " right leg;assess "..target


elseif ataxiaTemp.fractures.torntendons == 3 and (ataxiaTemp.fractures.skullfractures &gt;= 1 or ataxiaTemp.fractures.crackedribs &gt;= 1) and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.."wield warhammer109410;wipe warhammer109410;battlefury perceive "..target..";battlefury focus precision;hellforge invest "..invest..";pulverise "..target.. " left leg;assess "..target

elseif ataxiaTemp.fractures.torntendons == 3 and (ataxiaTemp.fractures.skullfractures &gt;= 1 or ataxiaTemp.fractures.crackedribs &gt;= 1) and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.."wield warhammer109410;wipe warhammer109410;battlefury perceive "..target..";battlefury focus precision;hellforge invest "..invest..";pulverise "..target.. " right leg;assess "..target

elseif ataxiaTemp.fractures.torntendons == 2 and (ataxiaTemp.fractures.skullfractures &gt;= 1 or ataxiaTemp.fractures.crackedribs &gt;= 1) and ataxiaTemp.parriedLimb ~= "left leg" then

  atk = atk.."wield bastard405364;wipe bastard405364;battlefury perceive "..target.."battlefury focus speed;envenom bastard with " ..venoms[1].. ";hew " ..target.. " left leg;assess " ..target

elseif ataxiaTemp.fractures.torntendons == 2 and (ataxiaTemp.fractures.skullfractures &gt;= 1 or ataxiaTemp.fractures.crackedribs &gt;= 1) and ataxiaTemp.parriedLimb ~= "right leg" then

  atk = atk.."wield bastard405364;wipe bastard405364;battlefury perceive "..target.."battlefury focus speed;envenom bastard with " ..venoms[1].. ";hew " ..target.. " right leg;assess " ..target

elseif ataxiaTemp.fractures.torntendons &lt; 1 and (ataxiaTemp.fractures.skullfractures &gt;= 1 or ataxiaTemp.fractures.crackedribs &gt;= 1 and ataxiaTemp.fractures.wristfractures &gt;= 1) and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.."wield warhammer109410;wipe warhammer109410;battlefury perceive "..target..";battlefury focus precision;hellforge invest "..invest..";pulverise "..target.. " left leg;assess "..target
elseif ataxiaTemp.fractures.torntendons &lt; 1 and (ataxiaTemp.fractures.skullfractures &gt;= 1 or ataxiaTemp.fractures.crackedribs &gt;= 1 and ataxiaTemp.fractures.wristfractures &gt;= 1) and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.."wield warhammer109410;wipe warhammer109410;battlefury perceive "..target..";battlefury focus precision;hellforge invest "..invest..";pulverise "..target.. " right leg;assess "..target

elseif ataxiaTemp.fractures.skullfractures &lt; 1 and ataxiaTemp.parriedLimb ~= "head" then
  atk = atk.."wield warhammer109410;wipe warhammer109410;battlefury perceive "..target..";battlefury focus precision;hellforge invest "..invest..";overhand "..target.. ";assess "..target

elseif ataxiaTemp.fractures.crackedribs &lt; 1 and ataxiaTemp.parriedLimb ~= "torso" then

  atk = atk.."wield warhammer109410;wipe warhammer109410;battlefury perceive "..target..";battlefury focus precision;hellforge invest "..invest..";underhand "..target.. ";assess "..target

elseif ataxiaTemp.fractures.wristfractures &lt; 1 and ataxiaTemp.parriedLimb ~= "left arm" then

atk = atk.."wield bastard405364;wipe bastard405364;battlefury perceive "..target.."battlefury focus speed;envenom bastard with " ..venoms[1].. ";hew " ..target.. " left arm;assess " ..target

elseif ataxiaTemp.fractures.wristfractures &lt; 1 and ataxiaTemp.parriedLimb ~= "right arm" then

atk = atk.."wield bastard405364;wipe bastard405364;battlefury perceive "..target.."battlefury focus speed;envenom bastard with " ..venoms[1].. ";hew " ..target.. " right arm;assess " ..target




end



if ataxiaNDB_getClass(target) == "Bard" and  ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.torntendons == 0 and ataxiaTemp.parriedLimb ~= "right leg" and ataxiaTemp.parriedLimb ~= "right arm"  then
targetlimb = "right leg" bfocus = "precision"

elseif  ataxiaNDB_getClass(target) == "Bard" and ataxiaTemp.fractures.wristfractures &gt;= 1 and ataxiaTemp.fractures.torntendons == 0   and (ataxiaTemp.parriedLimb == "right arm" or ataxiaTemp.parriedLimb == "right leg") then

targetlimb = "left leg" bfocus = "precision"
end



if ataxiaNDB_getClass(target) == "Bard" and ataxiaTemp.fractures.wristfractures == 0  and ataxiaTemp.parriedLimb ~= "right arm" and ataxiaTemp.parriedLimb ~= "right leg" then
targetlimb = "right arm" bfocus = "precision"

elseif ataxiaNDB_getClass(target) == "Bard" and ataxiaTemp.fractures.wristfractures == 0  and (ataxiaTemp.parriedLimb == "right arm" or ataxiaTemp.parriedLimb == "right leg") then

targetlimb = "left arm" bfocus = "precision"
end




--ATTACK
--ATTACK
--ATTACK
--ATTACK







if not ataxia.settings.paused then
  if not engaged then
    send("queue addclear freestand hyena slay "..target.."; "..atk.." ;engage "..target.." ;tyranny")
  else
    send("queue addclear freestand " ..atk.." ;tyranny")
  end

end

end

</script>
												<eventHandlerList />
											</Script>
										</ScriptGroup>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>DWC</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>Dom Infernal DWC</name>
											<packageName></packageName>
											<script>function dwcpriosbasicinfernallimbvivi()


scimdamage = ataxiaTables.limbData.dwcSlash + ataxiaTables.limbData.dwcSlash
axedamage = scimdamage - 3


limdamage = scimdamage



if  tLimbs.LL + limdamage &gt;= 100 and tLimbs.LL &lt; 100 and not tAffs.damagedleftleg then 
 prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + limdamage &gt;= 100 and tLimbs.RL &lt; 100 then 
 prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + limdamage &gt;= 100 and tLimbs.RA &lt; 100 then 
 prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + limdamage &gt;= 100 and tLimbs.LA &lt; 100 then 
 prepped_leftarm = true else
prepped_leftarm = false

end

if  tLimbs.H + limdamage &gt;= 100 and tLimbs.H &lt; 100 then 
 prepped_head = true else
prepped_head = false

end

if  tLimbs.T + limdamage &gt;= 200 and tLimbs.T &lt; 100 then 
 prepped_torso = true else
prepped_torso = false

end

if prepped_rightarm and prepped_leftarm then
arm_prep = true
else
arm_prep = false
end

if prepped_rightleg and prepped_leftleg then
leg_prep = true
else
leg_prep = false
end

if leg_prep and arm_prep then full_prep = true
else
full_prep = false
end

if arm_prep and prepped_leftleg then
prep_arm_ll = true
else
prep_arm_ll = false
end

if arm_prep and prepped_rightleg then
prep_arm_rl = true
else
prep_arm_rl = false
end


if prepped_rightarm and prepped_leftleg then
prep_ra_ll = true
else prep_ra_ll = false
end

if prepped_rightarm and prepped_rightleg then
prep_ra_rl = true
else prep_ra_rl = false
end

if prepped_leftarm and prepped_rightleg then
prep_la_rl = true
else prep_la_rl = false
end

if prepped_leftarm and prepped_leftleg then
prep_la_ll = true
else prep_la_ll = false
end


targetlimb = {}



if not prepped_rightleg then
  table.insert(targetlimb,"right leg")
end

if not prepped_leftleg then
  table.insert(targetlimb,"left leg")
end

if not prepped_rightarm then
  table.insert(targetlimb,"right arm")
end

if not prepped_leftarm then
  table.insert(targetlimb,"left arm")
end

if not prepped_head then
  table.insert(targetlimb,"head")
end


if not prepped_torso then
  table.insert(targetlimb,"torso")
end







if ataxiaTemp.parriedLimb == targetlimb[1] and not tAffs.prone then 
targetlimb[1] = targetlimb[2]

end

dwcpriosbasicinfernalvivi()
end

function dwcpriosbasicinfernalvivi()
weapon1 = "scimitar266559"
weapon2 = "scimitar269323"
local atk = combatQueue()


need_raze = false
partyrelay = partyrelay or true
scimdamage = ataxiaTables.limbData.dwcSlash + ataxiaTables.limbData.dwcSlash
axedamage = scimdamage - 3

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
  




--VENOMS

   venoms = {}
  
if not tAffs.damagedrightleg and (tAffs.brokenleftleg or tAffs.damagedleftleg) and 
not tAffs.damagedrightarm and (tAffs.brokenleftarm or tAffs.damagedleftarm) then
 table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
end

if  not tAffs.damagedleftleg and (tAffs.brokenrightleg or tAffs.damagedrightleg) and 
not tAffs.damagedrightarm and (tAffs.brokenleftarm or tAffs.damagedleftarm) then
 table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
end

if  not tAffs.damagedleftleg and (tAffs.brokenrightleg or tAffs.damagedrightleg) and 
not tAffs.damagedleftarm and (tAffs.brokenrightarm or tAffs.damagedrightarm) then
 table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
end

if  not tAffs.damagedrightleg and (tAffs.brokenleftleg or tAffs.damagedleftleg) and 
not tAffs.damagedleftarm and (tAffs.brokenrightarm or tAffs.damagedrightarm) then
 table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
end

if tAffs.damagedleftarm and tAffs.damagedrightarm and (tAffs.damagedleftleg or tAffs.damagedrightleg) then
 table.insert(venoms,"epteth")
  table.insert(venoms,"epseth")
end

if
leg_prep and not tAffs.prone and not tAffs.rebounding and not tAffs.shield and tAffs.nausea then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
  vivi_legs = true
  else
  vivi_legs = false
end

if
prepped_leftleg and not tAffs.prone and not tAffs.rebounding and not tAffs.shield and prepped_rightarm and prepped_leftarm then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
  vivi_arms2 = true
  else
  vivi_arms2 = false
end

if
prepped_rightleg and not tAffs.prone and not tAffs.rebounding and not tAffs.shield and prepped_rightarm and prepped_leftarmm then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
  vivi_arms3 = true
  else
  vivi_arms3 = false
end

if
prepped_leftleg and not tAffs.prone and not tAffs.rebounding and not tAffs.shield and tAffs.damagedrightarm and tAffs.damagedleftarm then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
  vivi_legs2 = true
  else
  vivi_legs2 = false
end

if
prepped_rightleg and not tAffs.prone and not tAffs.rebounding and not tAffs.shield and tAffs.damagedrightarm and tAffs.damagedleftarm then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
  vivi_legs3 = true
  else
  vivi_legs3 = false
end

if
arm_prep and not tAffs.rebounding and not tAffs.shield then

  vivi_arms = true
  else
  vivi_arms = false
end



if tAffs.slickness and not tAffs.anorexia and not tAffs.rebounding then
  table.insert(venoms,"slike")
  
  end

  
if tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and tAffs.asthma then
table.insert(venoms,"slike")
table.insert(venoms,"gecko")
end

if tAffs.impatience and not tAffs.anorexia and not tBals.salve then
table.insert(venoms,"slike")
end

if venoms[1] == "slike" and not tAffs.stupidity then 
  table.insert(venoms,"aconite")
  end



if tAffs.anorexia and not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end



  
  if tAffs.anorexia and not tAffs.dizziness then
table.insert(venoms,"larkspur")
end





if tAffs.anorexia and not tAffs.shyness then
  table.insert(venoms,"digitalis")

end



if not tAffs.paralysis and not tAffs.slickness then
  table.insert(venoms,"curare")

end


if not tAffs.slickness and tAffs.asthma then

  table.insert(venoms,"gecko")

end




if not tAffs.clumsiness then
  table.insert(venoms,"xentio")

end

if not tAffs.nausea then
  table.insert(venoms,"euphorbia")

end

if not tAffs.asthma then
  table.insert(venoms,"kalmia")

end




if not tAffs.weariness then
  table.insert(venoms,"vernalius")

end



if not tAffs.addiction then
  table.insert(venoms,"vardrax")

end







if not tAffs.sensitivity then

  table.insert(venoms,"prefarar")
  table.insert(venoms,"prefarar")

end





if not tAffs.darkshade then
  table.insert(venoms,"darkshade")

end




if tAffs.prone and vivi_legs and not tAffs.brokenrightarm and not tAffs.brokenleftarm then
  table.insert(venoms,"epteth")
  table.insert(venoms,"epteth")

end

if tAffs.prone and tAffs.damagedrightleg and tAffs.damagedleftleg and not tAffs.brokenrightarm and not tAffs.brokenleftarm then
  table.insert(venoms,"epteth")
  table.insert(venoms,"epteth")

end

if  tAffs.damagedrightarm and tAffs.damagedleftarm and not tAffs.brokenrightleg and not tAffs.brokenleftleg
 then
  table.insert(venoms,"epteth")
  table.insert(venoms,"epteth")

end

if tAffs.prone and vivi_arms and not tAffs.brokenrightleg and not tAffs.brokenleftleg then
  table.insert(venoms,"epseth")
  table.insert(venoms,"epseth")

end

if tAffs.damagedrightarm and tAffs.damagedleftarm then
  table.insert(venoms,"epseth")
  table.insert(venoms,"epseth")

end



if tAffs.asthma and not tAffs.disloyalty then
 table.insert(venoms,"monkshood")

end


if not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end


if not tAffs.stupidity then
  table.insert(venoms,"aconite")


end

if not tAffs.dizziness then
table.insert(venoms,"larkspur")
end


if not tAffs.shyness then
  table.insert(venoms,"digitalis")

end








--ATTACK



if tAffs.impaled and tLimbs.T &gt;= 100 then
disembowel = true
else
disembowel = false
end



if (tLimbs.RL + scimdamage &gt;= 100) and (tLimbs.RL + axedamage &lt; 100) and targetlimb == "right leg" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.RA + scimdamage &gt;= 100) and (tLimbs.RA + axedamage &lt; 100) and targetlimb == "right arm" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.LL + scimdamage &gt;= 100) and (tLimbs.LL + axedamage &lt; 100) and targetlimb == "left leg" then

need_raze3 = true
else
need_raze3 = false
end

if (tLimbs.LA + scimdamage &gt;= 100) and (tLimbs.LA + axedamage &lt; 100) and targetlimb == "left arm" then

need_raze3 = true
else
need_raze3 = false
end

if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end

if (ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 35 and not tAffs.shield) then
need_quash = true else
need_quash = false
end


if tAffs.rebounding and tAffs.shield then
need_shieldraze = true
else
need_shieldraze = false
end




if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 and ataxia.vitals.class == 4 then
impale_blackout = true
else
impale_blackout = false
end


if (tAffs.brokenrightleg or tAffs.damagedrightleg) and (tAffs.brokenleftleg or tAffs.damagedleftleg)
 and (tAffs.brokenleftarm or tAffs.damagedleftarm)  and  (tAffs.brokenrightarm or tAffs.damagedrightarm) then
need_vivisect = true
else
need_vivisect = false
end

--ataxiaNDB.players[target].city ~= "Mhaldor"

if need_vivisect  then
atk = atk.."dismount;vivisect "..target

--elseif need_vivisect and ataxiaNDB.players[target].city == "Mhaldor" then
--atk = send("say DOOMED!")


elseif need_quash then

atk = "stand/wield shield longsword/assess "..target.."/quash "..target.."/arc curare"


elseif disembowel then 

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";disembowel "..target



elseif need_raze then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.."  "..targetlimb[1].." "..venoms[1]

elseif need_raze2 then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.."  "..targetlimb[1].." "..venoms[1]

elseif need_raze3 then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.."  "..targetlimb[1].." "..venoms[1]


if venoms[1] == "curare" then
venoms[1] = venoms[2]
venoms[2] = "curare"
end




elseif tAffs.prone and tAffs.damagedtorso and tAffs.damagedrightleg and tAffs.damagedleftleg then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";assess "..target..";impale "..target

elseif not tAffs.rebounding and not tAffs.shield and tAffs.prone and prepped_leftleg then
targetlimb = "left leg"


atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.." epteth epteth"

elseif not tAffs.rebounding and not tAffs.shield and tAffs.prone and prepped_rightleg then
targetlimb = "right leg"


atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.." epteth epteth"


elseif vivi_legs then
targetlimb = "right leg"

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.."  "..venoms[1].." "..venoms[2]

elseif vivi_legs2 then
targetlimb = "left leg"

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.."  "..venoms[1].." "..venoms[2]

elseif vivi_legs3 then
targetlimb = "right leg"

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.."  "..venoms[1].." "..venoms[2]

elseif vivi_arms2 then
targetlimb = "left leg"

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.."  "..venoms[1].." "..venoms[2]

elseif vivi_arms3 then
targetlimb = "right leg"

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.."  "..venoms[1].." "..venoms[2]




elseif tAffs.damagedrightarm and prepped_leftarm then
targetlimb = "left arm"

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.." epseth epseth"


elseif vivi_arms then
targetlimb = "right arm"

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.."  "..venoms[1].." "..venoms[2]

elseif tAffs.damagedleftarm and prepped_leftleg then
targetlimb = "left leg"

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.."  "..venoms[1].." "..venoms[2]


elseif arm_prep and prepped_leftleg then
targetlimb = "left leg"

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.."  "..venoms[1].." "..venoms[2]

elseif arm_prep and prepped_rightleg then
targetlimb = "right leg"

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.."  "..venoms[1].." "..venoms[2]

--elseif not tAffs.nausea then

--atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..venoms[1].." "..venoms[2]

else

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb[1].." "..venoms[1].." "..venoms[2]

end


if not ataxia.afflictions.aeon then
if table.contains(ataxia.playersHere, target) then

if need_quash then
send("setalias quasharc "..atk)
send("queue addclear free quasharc")

elseif not engaged then
send("queue addclear free "..atk..";engage "..target..";tyranny;order hyena kill "..target)

else

send("queue addclear free "..atk..";tyranny")


end

end
end

end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Infernal DWC - Levi</name>
											<packageName></packageName>
											<script>function infernaldwckelpstacklevi()
--Set Weapons
weapon1 = "scimitar405403"
weapon2 = "scimitar405398"
ataxiaTemp.hitCount = 0



-- Set Varables
dwcslashdmg = ataxiaTables.limbData.dwcSlash
dwcslash2dmg = tonumber(ataxiaTables.limbData.dwcSlash) + tonumber(ataxiaTables.limbData.dwcSlash)

--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--tBals.plant
--tBals.tree


--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
  local	treelock = true
else
  treelock = false
end

--Define Kelp Stack
if checkAffList({"hypochondria", "parasite", "weariness",  "asthma", "healthleech", "clumsiness", "sensitivity"},3) then
  tAffs.kelpstack = true
else
  tAffs.kelpstack = false
end

--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


--Set Quash
if php &lt;= 35 then
need_quash = true
elseif php &lt;= 45 and tAffs.sensitivity and tAffs.healthleech then
need_quash = true
else need_quash = false end

--Set First Venom Table
envenomList = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(envenomList,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(envenomList,"exploit") 
  elseif getLockingAffliction(target) == "haemophilia" then
    table.insert(envenomList,"torture")
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(envenomList,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(envenomList,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(envenomList,"eurypteria")
  else
    table.insert(envenomList,"voyria")   
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare")
elseif tvenomsleep == true then
  table.insert(envenomList,"delphinium")
elseif tvenomvivisectarms == true then
  table.insert(envenomList,"epteth")
elseif tvenomvivisectarms2 == true then
  table.insert(envenomList,"epteth")
elseif softlock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(envenomList,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(envenomList,"exploit") 
  elseif getLockingAffliction(target) == "haemophilia" then
    table.insert(envenomList,"torture")
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(envenomList,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(envenomList,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(envenomList,"eurypteria")
  else
    table.insert(envenomList,"voyria")   
  end
elseif softlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare") 
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
  table.insert(envenomList,"slike")
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience then
  table.insert(envenomList,"gecko") 
elseif tAffs.slickness or tAffs.paralysis and tAffs.asthma then 
  table.insert(envenomList,"slike")
elseif not tAffs.slickness and tAffs.asthma then
  table.insert(envenomList,"gecko")
--These Classes are impacted by Weariness not Clumsiness
elseif ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then
  if not tAffs.weariness then
    table.insert(envenomList,"exploit")
  elseif not tAffs.healthleech then
    table.insert(envenomList,"torment")
  elseif not tAffs.sensitivity then
    table.insert(envenomList,"prefarar")
  elseif not tAffs.asthma then
    table.insert(envenomList,"kalmia")
  elseif not tAffs.nausea then
    table.insert(envenomList,"euphorbia")
  elseif not tAffs.darkshade then
    table.insert(envenomList,"darkshade")
  elseif not tAffs.addiction then
    table.insert(envenomList,"vardrax")

  else
    table.insert(envenomList,"aconite")
  end
elseif not tAffs.clumsiness then
  table.insert(envenomList,"xentio")
elseif not tAffs.sensitivity then
  table.insert(envenomList,"prefarar")
elseif not tAffs.healthleech then
  table.insert(envenomList,"torment")
elseif not tAffs.asthma then
  table.insert(envenomList,"kalmia")
elseif not tAffs.nausea then
  table.insert(envenomList,"euphorbia")
elseif not tAffs.darkshade then
  table.insert(envenomList,"darkshade")
elseif not tAffs.addiction then
  table.insert(envenomList,"vardrax")
else
  table.insert(envenomList,"aconite")
end


--Set Venom Two Table
envenomListTwo = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and envenomList[1] ~= "curare" then
    table.insert(envenomListTwo,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and envenomList[1] ~= "vernalius" then
    table.insert(envenomListTwo,"vernalius") 
  elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and envenomList[1] ~= "voyria" then
    table.insert(envenomListTwo,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and envenomList[1] ~= "aconite" then
    table.insert(envenomListTwo,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and envenomList[1] ~= "eurypteria" then
    table.insert(envenomListTwo,"eurypteria") 
  end
elseif hardlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare") 
elseif tvenomsleep == true then
  table.insert(envenomListTwo,"delphinium")
elseif tvenomvivisectarms == true then
  table.insert(envenomListTwo,"epteth")
elseif tvenomvivisectarms2 == true then
  table.insert(envenomList,"epseth")
elseif softlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko") 
elseif not tAffs.slickness and tAffs.asthma and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.prone and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then
  if not tAffs.weariness and envenomList[1] ~= "exploit" then
    table.insert(envenomListTwo,"exploit")
  elseif not tAffs.nausea and envenomList[1] ~= "euphorbia" then
    table.insert(envenomListTwo,"euphorbia")
  elseif not tAffs.healthleech and envenomList[1] ~= "torment" then
    table.insert(envenomListTwo,"torment")
  elseif not tAffs.haemophilia and envenomList[1] ~= "torture" then
    table.insert(envenomListTwo,"torture")
  elseif not tAffs.asthma and envenomList[1] ~= "kalmia" then
    table.insert(envenomListTwo,"kalmia")
  elseif not tAffs.sensitivity and envenomList[1] ~= "prefarar" then
    table.insert(envenomListTwo,"prefarar")
  elseif not tAffs.darkshade and envenomList[1] ~= "darkshade" then
    table.insert(envenomListTwo,"darkshade")
  elseif not tAffs.addiction and envenomList[1] ~= "vardrax" then
    table.insert(envenomListTwo,"vardrax")
  else
    table.insert(envenomListTwo,"larkspur")
  end
elseif not tAffs.nausea and envenomList[1] ~= "euphorbia" then
  table.insert(envenomListTwo,"euphorbia")
elseif not tAffs.clumsiness and envenomList[1] ~= "xentio" then
  table.insert(envenomListTwo,"xentio")
elseif not tAffs.healthleech and envenomList[1] ~= "torment" then
  table.insert(envenomListTwo,"torment")
elseif not tAffs.haemophilia and envenomList[1] ~= "torture" then
  table.insert(envenomListTwo,"torture")
elseif not tAffs.asthma and envenomList[1] ~= "kalmia" then
  table.insert(envenomListTwo,"kalmia")
elseif not tAffs.weariness and envenomList[1] ~= "exploit" then
  table.insert(envenomListTwo,"exploit")
elseif not tAffs.darkshade and envenomList[1] ~= "darkshade" then
  table.insert(envenomListTwo,"darkshade")
elseif not tAffs.addiction and envenomList[1] ~= "vardrax" then
  table.insert(envenomListTwo,"vardrax")
elseif envenomList[1] ~= "aconite" then
  table.insert(envenomListTwo,"aconite")
end

infernaldwckelpstackattacklevi()
end

function infernaldwckelpstackattacklevi()
if not php then php = 100 end
if not pm then pm = 100 end
partyrelay = partyrelay or true
local atk = combatQueue()

if need_quash then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";quash " ..target.. ";arc " ..target
elseif tAffs.shield and tAffs.rebounding then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";raze " ..target
elseif tAffs.shield then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";rsl " ..target.. " " ..envenomList[1]
elseif tAffs.rebounding then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";rsl " ..target.. " " ..envenomList[1]
elseif envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " " ..envenomListTwo[1]
elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " " ..envenomList[1]
else
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]
end

if table.contains(ataxia.playersHere, target) then
  if falconattack == true then
   if not engaged then
    send("queue addclear freestand " ..atk.. ";engage " ..target..";assess " ..target..";assess " ..target)
   else
    send("queue addclear freestand " ..atk..";assess " ..target..";assess " ..target)
   end
  elseif falconattack == false then
    if not engaged then
      send("queue addclear freestand " ..atk.. ";hyena slay " ..target.." ;engage " ..target..";assess " ..target..";assess " ..target)
    else
      send("queue addclear freestand " ..atk.. ";hyena slay " ..target..";assess " ..target..";assess " ..target)
    end
   end
else
  send("queue addclear freestand lunge " ..target..";assess " ..target)

end

end

function infernaldwcvivi3limblevitest()
--Set Weapons
weapon1 = "scimitar405398"
weapon2 = "scimitar405403"

ataxiaTemp.hitCount = 0

--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--tBals.plant
--tBals.tree
tvenomvivisectarms = false
tvenomvivisectarms2 = false
tvenomsleep = false
tvivisect = false

--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
  local	treelock = true
else
  treelock = false
end

--Define Kelp Stack
if checkAffList({"hypochondria", "parasite", "weariness",  "asthma", "healthleech", "clumsiness", "sensitivity"},3) then
  tAffs.kelpstack = true
else
  tAffs.kelpstack = false
end

--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


--Set Variables
mylimbattackpercentage = tonumber(ataxiaTables.limbData.dwcSlash)
-- Set Varables
dwcslashdmg = ataxiaTables.limbData.dwcSlash
dwcslash2dmg = tonumber(ataxiaTables.limbData.dwcSlash) + tonumber(ataxiaTables.limbData.dwcSlash)

--Prep Function
if lb[target].hits["head"] + dwcslashdmg &gt;= 100 and not tAffs.damagedhead then 
dprepped_head = true else
dprepped_head = false
end
if lb[target].hits["head"] + dwcslash2dmg &gt;= 100 and not tAffs.damagedhead then 
d2prepped_head = true else
d2prepped_head = false
end

if lb[target].hits["torso"] + dwcslashdmg &gt;= 100 and not tAffs.mildtrauma then 
dprepped_torso = true else
dprepped_torso = false
end
if lb[target].hits["torso"] + dwcslash2dmg &gt;= 100 and not tAffs.mildtrauma then 
d2prepped_torso = true else
d2prepped_torso = false
end

if lb[target].hits["left leg"] + dwcslashdmg &gt;= 100 and not tAffs.damagedleftleg then 
dprepped_leftleg = true else
dprepped_leftleg = false
end
if lb[target].hits["left leg"] + dwcslash2dmg &gt;= 100 and not tAffs.damagedleftleg then 
d2prepped_leftleg = true else
d2prepped_leftleg = false
end

if lb[target].hits["right leg"] + dwcslashdmg &gt;= 100 and not tAffs.damagedrightleg then 
dprepped_rightleg = true else
dprepped_rightleg = false
end

if lb[target].hits["right leg"] + dwcslash2dmg &gt;= 100 and not tAffs.damagedrightleg then 
d2prepped_rightleg = true 
else
d2prepped_rightleg = false
end

if lb[target].hits["right arm"] + dwcslashdmg &gt;= 100 and not tAffs.damagedrightarm then 
dprepped_rightarm = true else
dprepped_rightarm = false
end
if lb[target].hits["right arm"] + dwcslash2dmg &gt;= 100 and not tAffs.damagedrightarm then 
d2prepped_rightarm = true else
d2prepped_rightarm = false
end

if lb[target].hits["left arm"] + dwcslashdmg &gt;= 100 and not tAffs.damagedleftarm then 
dprepped_leftarm = true else
dprepped_leftarm = false
end
if lb[target].hits["left arm"] + dwcslash2dmg &gt;= 100 and not tAffs.damagedleftarm then 
d2prepped_leftarm = true else
d2prepped_leftarm = false
end

--Limbs
if d2prepped_rightleg == true and d2prepped_leftleg == true and not tAffs.damagedleftleg or tAffs.damagedrightleg then
tvenomsleep = true
end

if tAffs.damagedrightleg and tAffs.prone and d2prepped_leftleg == true then
tvenomvivisectarms = true
tvenomsleep = false
tvenomvivisectarms2 = false
end

if tAffs.damagedleftleg and tAffs.prone and d2prepped_rightleg == true then
tvenomvivisectarms = true
tvenomvivisectarms2 = false
tvenomsleep = false
end

if tAffs.damagedleftleg and tAffs.prone and tAffs.damagedrightleg then
tvenomvivisectarms = true
tvenomvivisectarms2 = false
tvenomsleep = false
end



if tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and tAffs.damagedrightarm or tAffs.brokenrightarm and tAffs.damagedleftarm or tAffs.brokenleftarm then
tvivisect = true
else
tvivisect = false
end


--Set Quash
if php &lt;= 35 then
need_quash = true
elseif php &lt;= 40 and tAffs.sensitivity and tAffs.healthleech then
need_quash = true
else need_quash = false end

--Set First Venom Table
envenomList = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(envenomList,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(envenomList,"exploit") 
  elseif getLockingAffliction(target) == "haemophilia" then
    table.insert(envenomList,"torture")
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(envenomList,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(envenomList,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(envenomList,"eurypteria")
  else
    table.insert(envenomList,"voyria")   
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare")
elseif tvenomsleep == true then
  table.insert(envenomList,"delphinium")
elseif tvenomvivisectarms == true then
  table.insert(envenomList,"epteth")
elseif tvenomvivisectarms2 == true then
  table.insert(envenomList,"epteth")
elseif softlock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(envenomList,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(envenomList,"exploit") 
  elseif getLockingAffliction(target) == "haemophilia" then
    table.insert(envenomList,"torture")
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(envenomList,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(envenomList,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(envenomList,"eurypteria")
  else
    table.insert(envenomList,"voyria")   
  end
elseif softlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare") 
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
  table.insert(envenomList,"slike")
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience then
  table.insert(envenomList,"gecko") 
elseif tAffs.slickness or tAffs.paralysis and tAffs.asthma then 
  table.insert(envenomList,"slike")
elseif not tAffs.slickness and tAffs.asthma then
  table.insert(envenomList,"gecko")
--These Classes are impacted by Weariness not Clumsiness
elseif ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then
  if not tAffs.weariness then
    table.insert(envenomList,"exploit")
  elseif not tAffs.healthleech then
    table.insert(envenomList,"torment")
  elseif not tAffs.nausea then
    table.insert(envenomList,"euphorbia")
  elseif not tAffs.asthma then
    table.insert(envenomList,"kalmia")
  elseif not tAffs.sensitivity then
    table.insert(envenomList,"prefarar")
  elseif not tAffs.darkshade then
    table.insert(envenomList,"darkshade")
  elseif not tAffs.addiction then
    table.insert(envenomList,"vardrax")
  else
    table.insert(envenomList,"aconite")
  end
elseif not tAffs.clumsiness then
  table.insert(envenomList,"xentio")
elseif not tAffs.healthleech then
  table.insert(envenomList,"torment")
elseif not tAffs.nausea then
  table.insert(envenomList,"euphorbia")
elseif not tAffs.asthma then
  table.insert(envenomList,"kalmia")
elseif not tAffs.sensitivity then
  table.insert(envenomList,"prefarar")
elseif not tAffs.darkshade then
  table.insert(envenomList,"darkshade")
elseif not tAffs.addiction then
  table.insert(envenomList,"vardrax")
else
  table.insert(envenomList,"aconite")
end


--Set Venom Two Table
envenomListTwo = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and envenomList[1] ~= "curare" then
    table.insert(envenomListTwo,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and envenomList[1] ~= "vernalius" then
    table.insert(envenomListTwo,"vernalius") 
  elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and envenomList[1] ~= "voyria" then
    table.insert(envenomListTwo,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and envenomList[1] ~= "aconite" then
    table.insert(envenomListTwo,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and envenomList[1] ~= "eurypteria" then
    table.insert(envenomListTwo,"eurypteria") 
  end
elseif hardlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare") 
elseif tvenomsleep == true then
  table.insert(envenomListTwo,"delphinium")
elseif tvenomvivisectarms == true then
  table.insert(envenomListTwo,"epteth")
elseif tvenomvivisectarms2 == true then
  table.insert(envenomList,"epseth")
elseif softlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko") 
elseif not tAffs.slickness and tAffs.asthma and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.prone and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then
  if not tAffs.weariness and envenomList[1] ~= "exploit" then
    table.insert(envenomListTwo,"exploit")
  elseif not tAffs.nausea and envenomList[1] ~= "euphorbia" then
    table.insert(envenomListTwo,"euphorbia")
  elseif not tAffs.healthleech and envenomList[1] ~= "torment" then
    table.insert(envenomListTwo,"torment")
  elseif not tAffs.haemophilia and envenomList[1] ~= "torture" then
    table.insert(envenomListTwo,"torture")
  elseif not tAffs.asthma and envenomList[1] ~= "kalmia" then
    table.insert(envenomListTwo,"kalmia")
  elseif not tAffs.sensitivity and envenomList[1] ~= "prefarar" then
    table.insert(envenomListTwo,"prefarar")
  elseif not tAffs.darkshade and envenomList[1] ~= "darkshade" then
    table.insert(envenomListTwo,"darkshade")
  elseif not tAffs.addiction and envenomList[1] ~= "vardrax" then
    table.insert(envenomListTwo,"vardrax")
  else
    table.insert(envenomListTwo,"larkspur")
  end
elseif not tAffs.nausea and envenomList[1] ~= "euphorbia" then
  table.insert(envenomListTwo,"euphorbia")
elseif not tAffs.clumsiness and envenomList[1] ~= "xentio" then
  table.insert(envenomListTwo,"xentio")
elseif not tAffs.healthleech and envenomList[1] ~= "torment" then
  table.insert(envenomListTwo,"torment")
elseif not tAffs.haemophilia and envenomList[1] ~= "torture" then
  table.insert(envenomListTwo,"torture")
elseif not tAffs.asthma and envenomList[1] ~= "kalmia" then
  table.insert(envenomListTwo,"kalmia")
elseif not tAffs.weariness and envenomList[1] ~= "exploit" then
  table.insert(envenomListTwo,"exploit")
elseif not tAffs.darkshade and envenomList[1] ~= "darkshade" then
  table.insert(envenomListTwo,"darkshade")
elseif not tAffs.addiction and envenomList[1] ~= "vardrax" then
  table.insert(envenomListTwo,"vardrax")
elseif envenomList[1] ~= "aconite" then
  table.insert(envenomListTwo,"aconite")
end




if not php then php = 100 end
if not pm then pm = 100 end
partyrelay = partyrelay or true
local atk = combatQueue()

if tvivisect == true then
 atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dismount;vivisect " ..target
elseif tvivisect == true and ataxiaNDB.players[target].city == "Mhaldor" then
 atk = atk..";say Vivisect"

elseif need_quash then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";quash " ..target.. ";arc " ..target
elseif tAffs.shield and tAffs.rebounding then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";raze " ..target
elseif tAffs.shield then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";rsl " ..target.. " " ..envenomList[1]
elseif tAffs.rebounding then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";rsl " ..target.. " " ..envenomList[1]
--Prep
elseif tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and d2prepped_leftarm == true and tAffs.prone then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " left arm " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " left arm " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " left arm " ..envenomList[1].. " " ..envenomListTwo[1]
  end

elseif tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and d2prepped_rightarm == true and tAffs.prone then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right arm " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right arm " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right arm " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_leftleg == true and tAffs.damagedrightleg and d2prepped_rightarm == true or d2prepped_leftarm == true and tAffs.prone then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " left leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " left leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " left leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_rightleg == true and tAffs.damagedleftleg and d2prepped_rightarm == true or d2prepped_leftarm == true and tAffs.prone then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_rightleg == true and d2prepped_leftleg == true and d2prepped_rightarm == true or d2prepped_leftarm == true and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" or tAffs.nausea) then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_rightleg == true and d2prepped_leftleg == true and d2prepped_rightarm == true or d2prepped_leftarm == true and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "left leg" or tAffs.nausea) then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " left leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " left leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " left leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_rightleg == true and d2prepped_leftleg == true and d2prepped_rightarm == false and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right arm" or tAffs.nausea) then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right arm " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right arm " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right arm " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_rightleg == true and d2prepped_leftleg == false and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "left leg" or tAffs.nausea) then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " left leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " left leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " left leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_rightleg == false and d2prepped_leftleg == true and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" or tAffs.nausea) then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_rightleg == false and not tAffs.damagedrightleg and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" or tAffs.nausea) then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif not d2prepped_leftleg and not tAffs.damagedleftleg and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "left leg" or tAffs.nausea)  then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " left leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " left leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " left leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif not d2prepped_rightarm and not tAffs.damagedrightarm and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right arm" or tAffs.nausea)  then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right arm " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right arm " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right arm " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif not d2prepped_leftarm and not tAffs.damagedleftarm and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "left arm" or tAffs.nausea)  then
   if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " left arm " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " left arm " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " left arm " ..envenomList[1].. " " ..envenomListTwo[1]
  end
else 
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]

end

--ATTACK
if table.contains(ataxia.playersHere, target) then
  if falconattack == true then
   if not engaged then
    send("queue addclear freestand " ..atk.. ";engage " ..target..";assess " ..target)
   else
    send("queue addclear freestand " ..atk..";assess " ..target)
   end
  elseif falconattack == false then
    if not engaged then
      send("queue addclear freestand " ..atk.. ";hyena slay " ..target.." ;engage " ..target..";assess " ..target)
    else
      send("queue addclear freestand " ..atk.. ";hyena slay " ..target..";assess " ..target)
    end
   end
else
  send("queue addclear freestand lunge " ..target..";assess " ..target)

end

end



function infernaldwcvivi2limblevitest()
--Set Weapons
weapon1 = "scimitar405398"
weapon2 = "scimitar405403"

--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--tBals.plant
--tBals.tree
tvenomvivisectarms = false
tvenomvivisectarms2 = false
tvenomsleep = false
tvivisect = false

--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
  local	treelock = true
else
  treelock = false
end

--Define Kelp Stack
if checkAffList({"hypochondria", "parasite", "weariness",  "asthma", "healthleech", "clumsiness", "sensitivity"},3) then
  tAffs.kelpstack = true
else
  tAffs.kelpstack = false
end

--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false


--Set Variables
mylimbattackpercentage = tonumber(ataxiaTables.limbData.dwcSlash)
-- Set Varables
dwcslashdmg = ataxiaTables.limbData.dwcSlash
dwcslash2dmg = tonumber(ataxiaTables.limbData.dwcSlash) + tonumber(ataxiaTables.limbData.dwcSlash)

--Prep Function
if lb[target].hits["head"] + dwcslashdmg &gt;= 100 and not tAffs.damagedhead then 
dprepped_head = true else
dprepped_head = false
end
if lb[target].hits["head"] + dwcslash2dmg &gt;= 100 and not tAffs.damagedhead then 
d2prepped_head = true else
d2prepped_head = false
end

if lb[target].hits["torso"] + dwcslashdmg &gt;= 100 and not tAffs.mildtrauma then 
dprepped_torso = true else
dprepped_torso = false
end
if lb[target].hits["torso"] + dwcslash2dmg &gt;= 100 and not tAffs.mildtrauma then 
d2prepped_torso = true else
d2prepped_torso = false
end

if lb[target].hits["left leg"] + dwcslashdmg &gt;= 100 and not tAffs.damagedleftleg then 
dprepped_leftleg = true else
dprepped_leftleg = false
end
if lb[target].hits["left leg"] + dwcslash2dmg &gt;= 100 and not tAffs.damagedleftleg then 
d2prepped_leftleg = true else
d2prepped_leftleg = false
end

if lb[target].hits["right leg"] + dwcslashdmg &gt;= 100 and not tAffs.damagedrightleg then 
dprepped_rightleg = true else
dprepped_rightleg = false
end

if lb[target].hits["right leg"] + dwcslash2dmg &gt;= 100 and not tAffs.damagedrightleg then 
d2prepped_rightleg = true 
else
d2prepped_rightleg = false
end

if lb[target].hits["right arm"] + dwcslashdmg &gt;= 100 and not tAffs.damagedrightarm then 
dprepped_rightarm = true else
dprepped_rightarm = false
end
if lb[target].hits["right arm"] + dwcslash2dmg &gt;= 100 and not tAffs.damagedrightarm then 
d2prepped_rightarm = true else
d2prepped_rightarm = false
end

if lb[target].hits["left arm"] + dwcslashdmg &gt;= 100 and not tAffs.damagedleftarm then 
dprepped_leftarm = true else
dprepped_leftarm = false
end
if lb[target].hits["left arm"] + dwcslash2dmg &gt;= 100 and not tAffs.damagedleftarm then 
d2prepped_leftarm = true else
d2prepped_leftarm = false
end

--Limbs
if d2prepped_rightleg == true and d2prepped_leftleg == true and not tAffs.damagedleftleg or tAffs.damagedrightleg then
tvenomsleep = true
end

if tAffs.damagedrightleg and tAffs.prone and d2prepped_leftleg == true then
tvenomvivisectarms = true
tvenomsleep = false
tvenomvivisectarms2 = false
end

if tAffs.damagedleftleg and tAffs.prone and d2prepped_rightleg == true then
tvenomvivisectarms = true
tvenomvivisectarms2 = false
tvenomsleep = false
end

if tAffs.damagedleftleg and tAffs.prone and tAffs.damagedrightleg then
tvenomvivisectarms = true
tvenomvivisectarms2 = false
tvenomsleep = false
end



if tAffs.damagedleftleg or tAffs.brokenleftleg and tAffs.damagedrightleg or tAffs.brokenrightleg and tAffs.damagedrightarm or tAffs.brokenrightarm and tAffs.damagedleftarm or tAffs.brokenleftarm then
tvivisect = true
else
tvivisect = false
end

--Set Quash
if php &lt;= 35 then
need_quash = true
elseif php &lt;= 40 and tAffs.sensitivity and tAffs.healthleech then
need_quash = true
else need_quash = false end

--Set First Venom Table
envenomList = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(envenomList,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(envenomList,"exploit") 
  elseif getLockingAffliction(target) == "haemophilia" then
    table.insert(envenomList,"torture")
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(envenomList,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(envenomList,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(envenomList,"eurypteria")
  else
    table.insert(envenomList,"voyria")   
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare")
elseif tvenomsleep == true then
  table.insert(envenomList,"delphinium")
elseif tvenomvivisectarms == true then
  table.insert(envenomList,"epteth")
elseif tvenomvivisectarms2 == true then
  table.insert(envenomList,"epteth")
elseif softlock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(envenomList,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(envenomList,"exploit") 
  elseif getLockingAffliction(target) == "haemophilia" then
    table.insert(envenomList,"torture")
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(envenomList,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(envenomList,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(envenomList,"eurypteria")
  else
    table.insert(envenomList,"voyria")   
  end
elseif softlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare") 
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
  table.insert(envenomList,"slike")
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience then
  table.insert(envenomList,"gecko") 
elseif tAffs.slickness or tAffs.paralysis and tAffs.asthma then 
  table.insert(envenomList,"slike")
elseif not tAffs.slickness and tAffs.asthma then
  table.insert(envenomList,"gecko")
--These Classes are impacted by Weariness not Clumsiness
elseif ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then
  if not tAffs.weariness then
    table.insert(envenomList,"exploit")
  elseif not tAffs.healthleech then
    table.insert(envenomList,"torment")
  elseif not tAffs.nausea then
    table.insert(envenomList,"euphorbia")
  elseif not tAffs.asthma then
    table.insert(envenomList,"kalmia")
  elseif not tAffs.sensitivity then
    table.insert(envenomList,"prefarar")
  elseif not tAffs.darkshade then
    table.insert(envenomList,"darkshade")
  elseif not tAffs.addiction then
    table.insert(envenomList,"vardrax")
  else
    table.insert(envenomList,"aconite")
  end
elseif not tAffs.nausea then
  table.insert(envenomList,"euphorbia")
elseif not tAffs.clumsiness then
  table.insert(envenomList,"xentio")
elseif not tAffs.sensitivity then
    table.insert(envenomList,"prefarar")
elseif not tAffs.healthleech then
  table.insert(envenomList,"torment")
elseif not tAffs.asthma then
  table.insert(envenomList,"kalmia")
elseif not tAffs.darkshade then
  table.insert(envenomList,"darkshade")
elseif not tAffs.addiction then
  table.insert(envenomList,"vardrax")
else
  table.insert(envenomList,"aconite")
end


--Set Venom Two Table
envenomListTwo = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and envenomList[1] ~= "curare" then
    table.insert(envenomListTwo,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and envenomList[1] ~= "vernalius" then
    table.insert(envenomListTwo,"vernalius") 
  elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and envenomList[1] ~= "voyria" then
    table.insert(envenomListTwo,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and envenomList[1] ~= "aconite" then
    table.insert(envenomListTwo,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and envenomList[1] ~= "eurypteria" then
    table.insert(envenomListTwo,"eurypteria") 
  end
elseif hardlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare") 
elseif tvenomsleep == true then
  table.insert(envenomListTwo,"delphinium")
elseif tvenomvivisectarms == true then
  table.insert(envenomListTwo,"epteth")
elseif tvenomvivisectarms2 == true then
  table.insert(envenomList,"epseth")
elseif softlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko") 
elseif not tAffs.slickness and tAffs.asthma and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.prone and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then
  if not tAffs.weariness and envenomList[1] ~= "exploit" then
    table.insert(envenomListTwo,"exploit")
  elseif not tAffs.nausea and envenomList[1] ~= "euphorbia" then
    table.insert(envenomListTwo,"euphorbia")
  elseif not tAffs.healthleech and envenomList[1] ~= "torment" then
    table.insert(envenomListTwo,"torment")
  elseif not tAffs.haemophilia and envenomList[1] ~= "torture" then
    table.insert(envenomListTwo,"torture")
  elseif not tAffs.asthma and envenomList[1] ~= "kalmia" then
    table.insert(envenomListTwo,"kalmia")
  elseif not tAffs.sensitivity and envenomList[1] ~= "prefarar" then
    table.insert(envenomListTwo,"prefarar")
  elseif not tAffs.darkshade and envenomList[1] ~= "darkshade" then
    table.insert(envenomListTwo,"darkshade")
  elseif not tAffs.addiction and envenomList[1] ~= "vardrax" then
    table.insert(envenomListTwo,"vardrax")
  else
    table.insert(envenomListTwo,"larkspur")
  end
elseif not tAffs.nausea and envenomList[1] ~= "euphorbia" then
  table.insert(envenomListTwo,"euphorbia")
elseif not tAffs.clumsiness and envenomList[1] ~= "xentio" then
  table.insert(envenomListTwo,"xentio")
elseif not tAffs.sensitivity and envenomList[1] ~= "prefarar" then
    table.insert(envenomListTwo,"prefarar")
elseif not tAffs.healthleech and envenomList[1] ~= "torment" then
  table.insert(envenomListTwo,"torment")
elseif not tAffs.haemophilia and envenomList[1] ~= "torture" then
  table.insert(envenomListTwo,"torture")
elseif not tAffs.asthma and envenomList[1] ~= "kalmia" then
  table.insert(envenomListTwo,"kalmia")
elseif not tAffs.weariness and envenomList[1] ~= "exploit" then
  table.insert(envenomListTwo,"exploit")
elseif not tAffs.darkshade and envenomList[1] ~= "darkshade" then
  table.insert(envenomListTwo,"darkshade")
elseif not tAffs.addiction and envenomList[1] ~= "vardrax" then
  table.insert(envenomListTwo,"vardrax")
elseif envenomList[1] ~= "aconite" then
  table.insert(envenomListTwo,"aconite")
end
  infernaldwcvivi2limblevitestattack()
end

function infernaldwcvivi2limblevitestattack()

if not php then php = 100 end
if not pm then pm = 100 end
partyrelay = partyrelay or true
local atk = combatQueue()
ataxiaTemp.hitCount = 0

if tvivisect == true and ataxiaNDB.players[target].city ~= "Mhaldor" then
 atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dismount;vivisect " ..target


elseif need_quash then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";quash " ..target.. ";arc " ..target
elseif tAffs.shield and tAffs.rebounding then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";raze " ..target
elseif tAffs.shield then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";rsl " ..target.. " " ..envenomList[1]
elseif tAffs.rebounding then
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";rsl " ..target.. " " ..envenomList[1]

--Prep
elseif d2prepped_rightleg == true and tAffs.damagedleftleg and tAffs.prone then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_leftleg == true and tAffs.damagedrightleg and tAffs.prone then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " left leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " left leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " left leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_rightleg == true and d2prepped_leftleg == true and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" or tAffs.nausea) then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_rightleg == true and d2prepped_leftleg == true and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "left leg" or tAffs.nausea) then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " left leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " left leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " left leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end

elseif d2prepped_rightleg == true and d2prepped_leftleg == false and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "left leg" or tAffs.nausea) then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " left leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " left leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " left leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_rightleg == false and d2prepped_leftleg == true and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" or tAffs.nausea) then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif d2prepped_rightleg == false and not tAffs.damagedrightleg and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right leg" or tAffs.nausea) then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif not d2prepped_leftleg and not tAffs.damagedleftleg and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "left leg" or tAffs.nausea)  then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " left leg " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " left leg " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " left leg " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif not d2prepped_torso and not tAffs.mildtrauma and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "torso" or tAffs.nausea)  then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " torso " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " torso " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " torso " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif not d2prepped_rightarm and not tAffs.damagedrightarm and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "right arm" or tAffs.nausea)  then
  if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " right arm " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " right arm " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " right arm " ..envenomList[1].. " " ..envenomListTwo[1]
  end
elseif not d2prepped_leftarm and not tAffs.damagedleftarm and (tAffs.numbedleftarm or ataxiaTemp.parriedLimb ~= "left arm" or tAffs.nausea)  then
   if envenomList[1] == "exploit" or envenomList[1] == "torture" or envenomList[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomList[1]..";dsl " ..target.. " left arm " ..envenomListTwo[1]
  elseif envenomListTwo[1] == "exploit" or envenomListTwo[1] == "torture" or envenomListTwo[1] == "torment" then
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";hellforge invest " ..envenomListTwo[1]..";dsl " ..target.. " left arm " ..envenomList[1]
  else
    atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " left arm " ..envenomList[1].. " " ..envenomListTwo[1]
  end
else 
  atk = atk.. "wield left "..weapon1..";wield right "..weapon2.. ";wipe " ..weapon1.. ";wipe " ..weapon2.. ";dsl " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]

end

--ATTACK
if table.contains(ataxia.playersHere, target) then
  if falconattack == true then
   if not engaged then
    send("queue addclear freestand " ..atk.. ";engage " ..target..";assess " ..target)
   else
    send("queue addclear freestand " ..atk..";assess " ..target)
   end
  elseif falconattack == false then
    if not engaged then
      send("queue addclear freestand " ..atk.. ";hyena slay " ..target.." ;engage " ..target..";assess " ..target)
    else
      send("queue addclear freestand " ..atk.. ";hyena slay " ..target..";assess " ..target)
    end
   end
else
  send("queue addclear freestand lunge " ..target)

end

end


</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>DEPTHSWALKER</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Attack</name>
										<packageName></packageName>
										<script>function depthswalker_damageroute()
--Pick an Attune
tattune = tattune or ""
--Are they Attuned?
ttattune = ttattune or false
-- Pick a scythe Instill
tinstall = tinstill or "degeneration"
Target_Instill = tinstill or "degeneration" --For affliction tracking

-- For timeloop tracking and calling
tloop = tloop or false
tloop2 = tloop2 or false
--Cull logic isn't met
tcull = tcull or false
--Did we distort yet?
depdistort = depdistort or false
--Do I have their shadow?
haveshadow = haveshadow or false
--Envenom List
envenomList = {}

-- Attack
local atk = combatQueue()
--Set Health and Mana, based on Assess
if not php then php = 100 end
if not pm then pm = 100 end
partyrelay = partyrelay or true

--get Age
dep_age = tonumber(string.sub(gmcp.Char.Vitals.charstats[4], 6))
--Is the target locked?
checkTargetLocks()

--Set Dictate Requirements
if pm &lt;= 40 then 
need_dictate = true else
need_dictate = false
end
  --Set all Dictate requirements based on afflictions
if checkAffList({"depression", "retribution", "parasite", "madness"},1) and pm &lt;= 45 then
	need_dictate1 = true
else
  need_dictate1 = false
end
if checkAffList({"depression", "retribution", "parasite", "madness"},2) and pm &lt;= 50 then
	need_dictate2 = true
else
  need_dictate2 = false
end
if checkAffList({"depression", "retribution", "parasite", "madness"},3) and pm &lt;= 55 then
	need_dictate3 = true
else
  need_dictate3 = false
end
if checkAffList({"depression", "retribution", "parasite", "madness"},4) and pm &lt;= 60 then
	need_dictate4 = true
else
  need_dictate4 = false
end

-- If their mana is below dictate threshold then dictate 
if need_dictate == true or need_dictate1 == true or need_dictate2 == true or need_dictate3 == true or need_dictate4 == true then 
  tloop = false
  tloop2 = false
  atk = atk.." shadow dictate "..target

-- If their health is below 35 percent, then cull with TOOROS for damage
elseif php &lt;= 35 then
  tloop = false
  tloop2 = false
  table.insert(envenomList,"curare")
  atk = atk.." shadow attune " ..target.. " to " ..tattune.. " ;intone tooros;chrono assert;shadow cull " ..target.." curare;assess " ..target..";contemplate " ..target

-- We have shadow Lets go Damage
elseif haveshadow == true then
  -- if we have shadow and health less than or at 60
  if php &lt;= 50 and haveshadow == true then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"curare")
    atk = atk.."wield right dagger;shadow mutilate " ..target.. " curare;assess " ..target.. " ;contemplate " ..target
  --If they have clumsiness and weariness and age is below or at 250 than chrono boost for damage
  elseif tAffs.clumsiness and tAffs.weariness and not tAffs.paralysis and dep_age &lt;= 250 then
    tloop2 = true
    tloop = false
     table.insert(envenomList,"timeloop")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with degeneration;chrono assert;chrono loop boost;shadow reap "..target.. ";assess "..target.." ;contemplate "..target
  -- If the above but age over 250 curare for damage
  elseif tAffs.clumsiness and tAffs.weariness and not tAffs.paralysis and dep_age &gt; 250 then
    tloop = false
    tloop2 = false
    tattune = "degeneration"
    table.insert(envenomList,"curare")
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with degeneration;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
  -- If not timeloop then timeloop if they have justice or retribution
  elseif not tAffs.timeloop and tAffs.clumsiness or tAffs.weariness and tAffs.justice or tAffs.retribution then
    tloop = true
    table.insert(envenomList,"timeloop")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with degeneration;chrono assert;chrono loop;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
  -- If not timeloop and not retribution then get to retribution to stack Bellwort
  elseif not tAffs.timeloop and tAffs.clumsiness or tAffs.weariness and not tAffs.retribution then
    tloop = false
    tloop2 = false
    tattune = "degeneration"
    table.insert(envenomList,"curare")
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with retribution;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
  
  -- If not weariness then stick weariness
  elseif not tAffs.weariness and not tAffs.paralysis then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"curare")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with degeneration;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
  -- if not clumsiness then stick clumsiness
  elseif not tAffs.clumsiness and not tAffs.paralysis then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"curare")
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with degeneration;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
  
  end


--Let's Get Shadow
elseif haveshadow == false then
  -- If we are two away from Shadow, Chrono Loop Boost
  if tAffs.parasite and tAffs.healthleech and not tAffs.manaleech and dep_age &lt;= 250 then
    tloop2 = true
    tloop = false
    table.insert(envenomList,"timeloop")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with leach;chrono assert;chrono loop boost;shadow reap "..target.. ";assess "..target.." ;contemplate "..target
  -- If we dont have enough Age but have asthma and not manaleech
  elseif tAffs.parasite and tAffs.healthleech and not tAffs.manaleech and dep_age &gt; 250 and tAffs.asthma and not tAffs.paralysis then
    tloop = false
    tloop2 = false
    tattune = "degeneration"
    table.insert(envenomList,"curare")
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with leach;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
    -- If we dont have enough age and not asthma then
  elseif tAffs.parasite and tAffs.healthleech and not tAffs.manaleech and dep_age &gt; 250 and not tAffs.asthma then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"kalmia")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with leach;chrono assert;shadow reap "..target.. " kalmia;assess "..target.." ;contemplate "..target
    -- If they have parasite but not heathleech and not paralysis
  elseif tAffs.parasite and not tAffs.healthleech and not tAffs.paralysis then
    tloop = false
    tloop2 = false
    tattune = "degeneration"
    table.insert(envenomList,"curare")
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with leach;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
    -- If they have weariness and not parasite then
  elseif tAffs.weariness and not tAffs.parasite and not tAffs.paralysis then
    tloop = false
    tloop2 = false
    tattune = "degeneration"
    table.insert(envenomList,"curare")
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with leach;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
    -- If they dont have weariness then get to weariness
  elseif not tAffs.weariness and not tAffs.paralysis then
    tloop = false
    tloop2 = false
    tattune = "degeneration"
    table.insert(envenomList,"curare")
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with degeneration;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
  else
    tloop = false
    tloop2 = false
    table.insert(envenomList,"kalmia")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
  end
    

  
  
end



----ATTTTTACKKKKKK
--If the target is here and Shield then raze
if table.contains(ataxia.playersHere, target) and tAffs.shield then
send("wield left scythe20431;wield right dagger;wipe scythe20431;queue addclear free shadow strike "..target..";assess "..target..";contemplate " ..target)
--if the target is here and not shielded then attack
elseif table.contains(ataxia.playersHere, target) then
send("wield left scythe20431;wield right shield;wipe scythe20431;queue addclear free "..atk)
--this is in case the above function is broken
else
expandAlias("nt")
send("wield left scythe20431;wield right shield;wipe scythe20431;queue addclear free "..atk)


  end
end


---------------------------LOCK-------------------------------------------------

function depthswalker_lockroute()
--Pick an Attune
tattune = tattune or ""
--Are they Attuned?
ttattune = false
-- Pick a scythe Instill
tinstall = tinstill or "degeneration"
Target_Instill = tinstill or "degeneration" --For affliction tracking

-- For timeloop tracking and calling
tloop = tloop or false
tloop2 = tloop2 or false
--Cull logic isn't met
tcull = false
--Did we distort yet?
depdistort = depdistort or false
--Do I have their shadow?
haveshadow = haveshadow or false
--Envenom List
envenomList = {}

-- Attack
local atk = combatQueue()
--Set Health and Mana, based on Assess
if not php then php = 100 end
if not pm then pm = 100 end
partyrelay = partyrelay or true

--get Age
dep_age = tonumber(string.sub(gmcp.Char.Vitals.charstats[4], 6))
--Is the target locked?
checkTargetLocks()

--Set Dictate Requirements
if pm &lt;= 40 then 
need_dictate = true else
need_dictate = false
end
  --Set all Dictate requirements based on afflictions
if checkAffList({"depression", "retribution", "parasite", "madness"},1) and pm &lt;= 45 then
	need_dictate1 = true
else
  need_dictate1 = false
end
if checkAffList({"depression", "retribution", "parasite", "madness"},2) and pm &lt;= 50 then
	need_dictate2 = true
else
  need_dictate2 = false
end
if checkAffList({"depression", "retribution", "parasite", "madness"},3) and pm &lt;= 55 then
	need_dictate3 = true
else
  need_dictate3 = false
end
if checkAffList({"depression", "retribution", "parasite", "madness"},4) and pm &lt;= 60 then
	need_dictate4 = true
else
  need_dictate4 = false
end

--Need to Know What Stops Curing
tstopcuring = getLockingAffliction(target) or nil








-- If their mana is below dictate threshold then dictate 
if need_dictate == true or need_dictate1 == true or need_dictate2 == true or need_dictate3 == true or need_dictate4 == true then 
  tloop = false
  tloop2 = false
  atk = atk.." shadow dictate "..target

-- If their health is below 35 percent, then cull with TOOROS for damage
elseif php &lt;= 30 then
  tloop = false
  tloop2 = false
  table.insert(envenomList,"curare")
  atk = atk.." shadow attune " ..target.. " to " ..tattune.. " ;intone tooros;chrono assert;shadow cull " ..target.." curare;assess " ..target..";contemplate " ..target

--Stop Passives 
elseif tstopcuring ~= nil and truelock == true then
  if tstopcuring == "reckless" and not tAffs.recklessness then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"eurypteria")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with madness;chrono assert;shadow reap "..target.. " eurypteria;assess "..target.." ;contemplate "..target
  elseif tstopcuring == "weariness" and not tAffs.weariness then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"xentio")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with degeneration;chrono assert;shadow reap "..target.. " xentio;assess "..target.." ;contemplate "..target
  elseif tstopcuring == "plague" and not tAffs.voyria then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"voyria")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono assert;shadow reap "..target.. " voyria;assess "..target.." ;contemplate "..target
  elseif tstopcuring == "stupid" and not tAffs.stupidity then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"aconite")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with madness;chrono assert;shadow reap "..target.. " aconite;assess "..target.." ;contemplate "..target
  end

-- Last Stage Lock
elseif tAffs.impatience and tAffs.asthma and tAffs.hypochondria and tAffs.nausea and tAffs.depression and tAffs.slickness and tAffs.anorexia and not tAffs.paralysis then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"curare")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with degeneration;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
 
elseif tAffs.impatience and tAffs.asthma and tAffs.nausea and tAffs.depression and tAffs.slickness then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"kalmia")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono assert;shadow reap "..target.. " kalmia;assess "..target.." ;contemplate "..target


-- First Stage Lock
elseif tAffs.impatience and tAffs.asthma and tAffs.nausea and tAffs.depression then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"gecko")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono assert;shadow reap "..target.. " gecko;assess "..target.." ;contemplate "..target

--If they have impatience lets rock depression until lock
elseif tAffs.impatience and tAffs.asthma then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"gecko")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono assert;shadow reap "..target.. " gecko;assess "..target.." ;contemplate "..target

elseif tAffs.impatience and not tAffs.asthma then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"kalmia")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono assert;shadow reap "..target.. " kalmia;assess "..target.." ;contemplate "..target

elseif tAffs.impatience then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"gecko")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono assert;shadow reap "..target.. " gecko;assess "..target.." ;contemplate "..target

-- if they have hypochondria lets madness until impatience tick!
elseif tAffs.hypochondria and not tAffs.madness and not tAffs.asthma and tAffs.depression then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"kalmia")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with madness;chrono assert;shadow reap "..target.. " kalmia;assess "..target.." ;contemplate "..target

elseif tAffs.hypochondria and not tAffs.stupidity or tAffs.madness and tAffs.depression then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"aconite")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with madness;chrono assert;shadow reap "..target.. " aconite;assess "..target.." ;contemplate "..target
  
-- progress towards impatience 
elseif not tAffs.hypochondria and not tAffs.asthma and tAffs.timeloop and tAffs.depression then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"kalmia")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono assert;shadow reap "..target.. " kalmia;assess "..target.." ;contemplate "..target

elseif not tAffs.hypochondria and tAffs.asthma and tAffs.timeloop and tAffs.depression and not tAffs.nausea then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"euphorbia")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono assert;shadow reap "..target.. " euphorbia;assess "..target.." ;contemplate "..target



--if depression and not timeloop then go up depression tree with timeloop
elseif tAffs.depression and not tAffs.timeloop and tAffs.nausea then
    tloop = true
    tloop2 = false
    table.insert(envenomList,"timeloop")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono loop;shadow reap "..target.. ";assess "..target.." ;contemplate "..target

elseif not tAffs.depression and tAffs.timeloop and tAffs.clumsines and tAffs.justice or tAffs.retribution and not tAffs.nausea then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"euphorbia")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono assert;shadow reap "..target.. " euphorbia;assess "..target.." ;contemplate "..target

 
--if they have clumsiness but not timeloop and not depression hit them with it
elseif tAffs.clumsiness and not tAffs.timeloop and not tAffs.depression and tAffs.justice or tAffs.retribution then
    tloop = true
    tloop2 = false
    table.insert(envenomList,"timeloop")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono loop;shadow reap "..target.. ";assess "..target.." ;contemplate "..target
 

--if they have clumsiness then go depression 
elseif tAffs.clumsiness and not tAffs.depression and tAffs.justice or tAffs.retribution and not tAffs.asthma then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"kalmia")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with depression;chrono assert;shadow reap "..target.. " kalmia;assess "..target.." ;contemplate "..target
 

--Try sticking clumsiness if they have retribution or timeloop
elseif tAffs.justice and tAffs.retribution or tAffs.timeloop and not tAffs.clumsiness then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"curare")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with degeneration;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
  --Try to Stick Timeloop with Retribution
elseif tAffs.justice and not tAffs.retribution and not tAffs.timeloop then
    tloop = true
    tloop2 = false
    table.insert(envenomList,"timeloop")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with retribution;chrono loop;shadow reap "..target.. " ;assess "..target.." ;contemplate "..target
  -- If not justice then stick justice
elseif not tAffs.justice and not tAffs.paralysis and tAffs.clumsiness then
    tloop = false
    tloop2 = false
    table.insert(envenomList,"curare")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with retribution;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
else
    tloop = false
    tloop2 = false
    table.insert(envenomList,"curare")
    tattune = "degeneration"
    atk = atk.."shadow attune " ..target.. " to " ..tattune.. " ;shadow instill scythe with degeneration;chrono assert;shadow reap "..target.. " curare;assess "..target.." ;contemplate "..target
end




  




----ATTTTTACKKKKKK
--If the target is here and Shield then raze
if table.contains(ataxia.playersHere, target) and tAffs.shield then
send("wield left scythe20431;wield right dagger;wipe scythe20431;queue addclear free shadow strike "..target..";assess "..target..";contemplate " ..target)
--if the target is here and not shielded then attack
elseif table.contains(ataxia.playersHere, target) then
send("wield left scythe20431;wield right shield;wipe scythe20431;queue addclear free "..atk)
--this is in case the above function is broken
else
expandAlias("nt")
send("wield left scythe20431;wield right shield;wipe scythe20431;queue addclear free "..atk)


  end
end



</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>RuneWarden</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>SNB</name>
										<packageName></packageName>
										<script>--myferocity = string.match(gmcp.Char.Vitals.charstats[4],"Ferocity\: (%w+)")
ferocity_full = false
function snbsoftlock()
envenomList = {}
if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end


svenom1 = ""

if tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.anorexia and tAffs.weariness and tAffs.voyria then
	svenom1 = "voyria"
  table.insert(envenomList, "voyria")
  -- Voyria
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.anorexia and tAffs.weariness then
  svenom1 = "eurypteria"
  table.insert(envenomList, "eurypteria")
elseif tAffs.slickness and tAffs.asthma and tAffs.anorexia and tAffs.weariness then
  svenom1 = "eurypteria"
  table.insert(envenomList, "eurypteria")
elseif tAffs.anorexia and tAffs.stupidity then
  svenom1 = "eurypteria"
  table.insert(envenomList, "eurypteria")
elseif tAffs.anorexia then
  svenom1 = "aconite"
  table.insert(envenomList, "aconite")
elseif tAffs.slickness and tAffs.asthma and tAffs.prone then
  svenom1 = "slike"
  table.insert(envenomList, "slike")
elseif tAffs.slickness and tAffs.asthma then
  svenom1 = "slike"
  table.insert(envenomList, "slike")
elseif tAffs.asthma and tAffs.paralysis and tAffs.prone then
	svenom1 = "gecko"
  table.insert(envenomList, "gecko")
elseif tAffs.asthma and not tAffs.slickness then
	svenom1 = "gecko"
  table.insert(envenomList, "gecko")
elseif not tAffs.asthma and tAffs.weariness and tAffs.clumsiness then 
	svenom1 = "kalmia"
  table.insert(envenomList, "kalmia")
elseif tAffs.weariness and not tAffs.clumsiness then
  svenom1 = "xentio"
  table.insert(envenomList, "xentio")
elseif not tAffs.weariness then
  svenom1 = "vernalius"
  table.insert(envenomList, "vernalius")

else
	svenom1 = "darkshade"
  table.insert(envenomList, "darkshade")
  end
end

function shieldstrike()
  sstrike = ""
if tAffs.slickness and tAffs.asthma then
  sstrike = "high"
elseif tAffs.anorexia then
  sstrike = "high"
elseif not tAffs.anorexia and svenom1 == "slike" then
  sstrike = "high"
elseif tAffs.paralysis and tAffs.anorexia then
  sstrike = "high" 
elseif tAffs.prone then
  sstrike = "high"
elseif tAffs.paralysis or tAffs.slickness and tAffs.prone then
  sstrike = "high"
elseif tAffs.slickness then
  sstrike = "high"
elseif not tAffs.paralysis and svenom1 ~= "curare" then
	sstrike = "mid"
elseif not tAffs.clumsiness then
  sstrike = "low"
else
	sstrike = "high"
  end
end


function snblimblock()

if ataxia.vitals.class == 4 then
ferocity_full = true
else 
ferocity_full = false
end

envenomList = {}

svenom1 = ""

if tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.anorexia and tAffs.weariness and tAffs.voyria then
	svenom1 = "voyria"
  -- Voyria
  table.insert(envenomList, "voyria")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.anorexia and tAffs.weariness then
 svenom1 = "eurypteria"
 table.insert(envenomList, "eurypteria")
elseif tAffs.slickness and tAffs.asthma and tAffs.anorexia and tAffs.weariness then
  svenom1 = "eurypteria"
  table.insert(envenomList, "eurypteria")
elseif tAffs.anorexia and tAffs.stupidity then
  svenom1 = "eurypteria"
  table.insert(envenomList, "eurypteria")
elseif tAffs.slickness and tAffs.asthma and tAffs.prone then
  svenom1 = "slike"
  table.insert(envenomList, "slike")
elseif tAffs.slickness and tAffs.asthma then
  svenom1 = "slike"
  table.insert(envenomList, "slike")
elseif tAffs.asthma and tAffs.paralysis and tAffs.prone then
	svenom1 = "gecko"
  table.insert(envenomList, "gecko")
elseif tAffs.asthma and not tAffs.slickness then
	svenom1 = "gecko"
  table.insert(envenomList, "gecko")
elseif not tAffs.asthma and tAffs.weariness and tAffs.clumsiness then 
	svenom1 = "kalmia"
  table.insert(envenomList, "kalmia")
elseif not tAffs.clumsiness and tAffs.weariness then
  svenom1 = "xentio"
  table.insert(envenomList, "xentio")

elseif not tAffs.weariness then
	svenom1 = "vernalius"
  table.insert(envenomList, "vernalius")
else
	svenom1 = "darkshade"
  table.insert(envenomList, "darkshade")
  end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Two Handed Runie</name>
										<packageName></packageName>
										<script>function twohandedrunie()
tparrying = tparrying or "head"
ltarget = ltarget or "torso"
envenom1 = envenom1 or nil
taffenvenom1 = taffenvenom1 or nil
preport1 = preport1 or ""
envenom2 = evenom2 or nil
taffenvenom2 = taffenvenom2 or nil
omount = omount or ""
engaged = engaged or false
need_raze = false
need_bisect = false
if not php then php = 100 end
if not pm then pm = 100 end
partyrelay = partyrelay or true
if tAffs.rebounding or tAffs.shield then
need_raze = true
  else
need_raze = false
  end
if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	end
  
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
		treelock = true
  else
    treelock = false
	end
getLockingAffliction()
checkTargetLocks()
local atk = combatQueue()

if (lb[target].hits["right leg"] &gt;= 93 ) then 
atk = atk.."wield bastard;falcon slay " ..target.. "wipe bastard;envenom bastard with epseth;hew " ..target.. "right leg;battlefury upset " ..target.. ";assess "..target
 


  end

end</script>
										<eventHandlerList />
									</Script>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>DWC RUNIE</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="no" isFolder="no">
											<name>RIFT</name>
											<packageName></packageName>
											<script>function runie_riftlock()


local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or true
scimdamage = ataxiaTables.limbData.dwcSlash + ataxiaTables.limbData.dwcSlash
axedamage = scimdamage - 3

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
  




--VENOMS

  venoms = {}
  
if tBals.salve == false and tAffs.addiciton then
 table.insert(venoms,"epteth")
 table.insert(venoms,"epteth")

end


if
(prepped_leftleg and prepped_rightleg) and tAffs.damagedtorso and not tAffs.prone and not tAffs.rebounding and not tAffs.shield then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
end

if
(prepped_leftleg or prepped_rightleg) and prepped_head and not tAffs.prone and not tAffs.rebounding and not tAffs.shield then
 table.insert(venoms,"delphinium")
  table.insert(venoms,"delphinium")
end






if tAffs.slickness and not tAffs.anorexia and tAffs.paralysis and not tAffs.stupid then
  table.insert(venoms,"aconite")
  table.insert(venoms,"slike")
  
  end


  
if tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
table.insert(venoms,"slike")
table.insert(venoms,"gecko")
end

if tAffs.impatience and not tAffs.anorexia and not tBals.salve then
table.insert(venoms,"slike")
end

if tAffs.damagedhead and not tAffs.stupidity then
  table.insert(venoms,"aconite")
  end
  
  if tAffs.damagedhead and not tAffs.dizziness then
table.insert(venoms,"larkspur")
end



if tAffs.damagedhead and not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end





if tAffs.damagedhead and not tAffs.shyness then
  table.insert(venoms,"digitalis")

end


if not tAffs.paralysis then
  table.insert(venoms,"curare")

end

if not tAffs.addiction then
  table.insert(venoms,"vardrax")

end

if not tAffs.weariness then
  table.insert(venoms,"vernalius")

end






if not tAffs.asthma then
  table.insert(venoms,"kalmia")

end

if not tAffs.clumsiness then
  table.insert(venoms,"xentio")

end



if not tAffs.slickness and tAffs.asthma and venoms[1] == "curare" then

  table.insert(venoms,"gecko")

end

if not tAffs.nausea then
  table.insert(venoms,"euphorbia")

end




if not tAffs.dizziness then
table.insert(venoms,"larkspur")
end


if not tAffs.stupidity then
  table.insert(venoms,"aconite")


end

if not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end





if not tAffs.shyness then
  table.insert(venoms,"digitalis")

end

if not tAffs.sensitivity then

  table.insert(venoms,"prefarar")
  table.insert(venoms,"prefarar")

end







if not tAffs.darkshade then
  table.insert(venoms,"darkshade")

end














--ATTACK



if tAffs.impaled and tLimbs.T &gt;= 100 then
disembowel = true
else
disembowel = false
end

if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.5) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
(ataxiaNDB_getClass(target) ~= "Apostate" or ataxiaNDB_getClass(target)) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end

if (tLimbs.RL + scimdamage &gt;= 100) and (tLimbs.RL + axedamage &lt; 100) and targetlimb == "right leg" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.RA + scimdamage &gt;= 100) and (tLimbs.RA + axedamage &lt; 100) and targetlimb == "right arm" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.LL + scimdamage &gt;= 100) and (tLimbs.LL + axedamage &lt; 100) and targetlimb == "left leg" then

need_raze3 = true
else
need_raze3 = false
end

if (tLimbs.LA + scimdamage &gt;= 100) and (tLimbs.LA + axedamage &lt; 100) and targetlimb == "left arm" then

need_raze3 = true
else
need_raze3 = false
end

if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 35 then
use_bisect = true else
use_bisect = false
end


if tAffs.rebounding and tAffs.shield then
need_shieldraze = true
else
need_shieldraze = false
end

if  tLimbs.LL + scimdamage &gt;= 100 and not tAffs.damagedleftleg then 
prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + scimdamage &gt;= 100 and not tAffs.damagedrightleg then 
prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + scimdamage &gt;= 100 and not tAffs.damagedrightarm then 
prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + scimdamage &gt;= 100 and not tAffs.damagedleftarm then 
prepped_leftarm = true else
prepped_leftarm = false

end

if  tLimbs.H + scimdamage &gt;= 100 and not tAffs.damagedhead then 
prepped_head = true else
prepped_head = false

end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 and ataxia.vitals.class == 4 then
impale_blackout = true
else
impale_blackout = false
end




if use_bisect then

atk = atk.."wield shield longsword;assess "..target..";bisect "..target.." curare"


elseif disembowel then 

atk = atk.."wield scimitar355418 scimitar383498;wipe scimitar383498;wipe scimitar355418;assess "..target..";disembowel "..target



elseif need_raze then
atk = atk.."wield scimitar355418 scimitar383498;wipe scimitar383498;wipe scimitar355418;assess "..target..";razeslash "..target.." "..targetlimb.." "..venoms[1]

elseif need_raze2 then
atk = atk.."wield scimitar355418 scimitar383498;wipe scimitar383498;wipe scimitar355418;assess "..target..";razeslash "..target.." "..targetlimb.." "..venoms[1]

elseif need_raze3 then
atk = atk.."wield scimitar355418 scimitar383498;wipe scimitar383498;wipe scimitar355418;assess "..target..";razeslash "..target.." "..targetlimb.." "..venoms[1]





elseif tAffs.prone and tAffs.damagedtorso and tAffs.damagedrightleg and tAffs.damagedleftleg then
atk = atk.."wield scimitar355418 scimitar383498;wipe scimitar383498;wipe scimitar355418;assess "..target..";impale "..target

elseif tBals.salve == false and tAffs.addiction then
atk = atk.."wield scimitar355418 scimitar383498;wipe scimitar383498;wipe scimitar355418;assess "..target..";dsl "..target.." "..targetlimb.." epteth epteth"


else


atk = atk.."wield scimitar355418 scimitar383498;wipe scimitar383498;wipe scimitar355418;assess "..target..";dsl "..target.." "..targetlimb.." "..venoms[1].." "..venoms[2]

end


if not ataxia.settings.paused then


if not engaged then
send("queue addclear free "..atk..";engage "..target)

else

send("queue addclear free "..atk)


end
end

end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>BASIC 2</name>
											<packageName></packageName>
											<script>function dwcpriosbasic()
weapon1 = "scimitar405398"
weapon2 = "scimitar405403"

local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or true
scimdamage = ataxiaTables.limbData.dwcSlash + ataxiaTables.limbData.dwcSlash
axedamage = scimdamage - 3

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
  




--VENOMS

  venoms = {}
  







if tAffs.slickness and not tAffs.anorexia and tAffs.paralysis and not tAffs.stupidity and tAffs.asthma and not tAffs.rebounding then
  table.insert(venoms,"aconite")
  table.insert(venoms,"slike")
  
  end
  
if tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and tAffs.asthma then
table.insert(venoms,"slike")
table.insert(venoms,"gecko")
end

if tAffs.impatience and not tAffs.anorexia and not tBals.salve then
table.insert(venoms,"slike")
end



  
  if tAffs.anorexia and not tAffs.dizziness then
table.insert(venoms,"larkspur")
end



if tAffs.anorexia and not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end





if tAffs.anorexia and not tAffs.shyness then
  table.insert(venoms,"digitalis")

end

if not tAffs.paralysis then
  table.insert(venoms,"curare")

end



if not tAffs.weariness then
  table.insert(venoms,"vernalius")

end





if not tAffs.asthma then
  table.insert(venoms,"kalmia")

end

if not tAffs.clumsiness then
  table.insert(venoms,"xentio")

end




if not tAffs.slickness and tAffs.asthma and venoms[1] == "curare" then

  table.insert(venoms,"gecko")

end


if not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end


if not tAffs.stupidity then
  table.insert(venoms,"aconite")


end

if not tAffs.dizziness then
table.insert(venoms,"larkspur")
end




if tAffs.asthma and not tAffs.disloyalty then
 table.insert(venoms,"monkshood")

end


if not tAffs.shyness then
  table.insert(venoms,"digitalis")

end

if not tAffs.sensitivity then

  table.insert(venoms,"prefarar")
  table.insert(venoms,"prefarar")

end


if not tAffs.addiction then
  table.insert(venoms,"vardrax")

end

if not tAffs.darkshade then
  table.insert(venoms,"darkshade")

end












--ATTACK



if tAffs.impaled and tLimbs.T &gt;= 100 then
disembowel = true
else
disembowel = false
end

if ataxia.afflictions.paralysis and not ataxia.afflictions.prone 
and (tonumber(gmcp.Char.Vitals.hp) &gt;=  tonumber(gmcp.Char.Vitals.maxhp)*.5) 
and (tonumber(gmcp.Char.Vitals.mp) &gt;= tonumber(gmcp.Char.Vitals.maxmp)*.6) and
(ataxiaNDB_getClass(target) ~= "Apostate" or ataxiaNDB_getClass(target)) ~= "Priest" then

add_dedication = true
else 
add_dedication = false
end

if (tLimbs.RL + scimdamage &gt;= 100) and (tLimbs.RL + axedamage &lt; 100) and targetlimb == "right leg" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.RA + scimdamage &gt;= 100) and (tLimbs.RA + axedamage &lt; 100) and targetlimb == "right arm" then

need_raze2 = true
else
need_raze2 = false
end

if (tLimbs.LL + scimdamage &gt;= 100) and (tLimbs.LL + axedamage &lt; 100) and targetlimb == "left leg" then

need_raze3 = true
else
need_raze3 = false
end

if (tLimbs.LA + scimdamage &gt;= 100) and (tLimbs.LA + axedamage &lt; 100) and targetlimb == "left arm" then

need_raze3 = true
else
need_raze3 = false
end

if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end

if (ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 35 and not tAffs.shield) or tAffs.healthleech then
use_bisect = true else
use_bisect = false
end


if tAffs.rebounding and tAffs.shield then
need_shieldraze = true
else
need_shieldraze = false
end

if  tLimbs.LL + scimdamage &gt;= 100 and not tAffs.damagedleftleg then 
prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + scimdamage &gt;= 100 and not tAffs.damagedrightleg then 
prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + scimdamage &gt;= 100 and not tAffs.damagedrightarm then 
prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + scimdamage &gt;= 100 and not tAffs.damagedleftarm then 
prepped_leftarm = true else
prepped_leftarm = false

end


if  tLimbs.H + scimdamage &gt;= 100 and not tAffs.damagedhead then 
prepped_head = true else
prepped_head = false

end


if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 and ataxia.vitals.class == 4 then
impale_blackout = true
else
impale_blackout = false
end




if tAffs.nausea and not prepped_rightleg and not tAffs.prone then
dwcprioslimb()

elseif tAffs.nausea and not prepped_leftleg and not tAffs.prone then
dwcprioslimb()

elseif tAffs.nausea and not prepped_torso then
dwcprioslimb()

elseif use_bisect then

atk = atk.."wield shield longsword;assess "..target..";bisect "..target.." curare"


elseif disembowel then 

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";disembowel "..target



elseif need_raze then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.." "..venoms[1]

elseif need_raze2 then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.." "..venoms[1]

elseif need_raze3 then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.." "..venoms[1]





elseif tAffs.prone and tAffs.damagedtorso and tAffs.damagedrightleg and tAffs.damagedleftleg then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";assess "..target..";impale "..target

elseif not tAffs.rebounding and not tAffs.shield and prepped_head and tAffs.prone then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." head gecko curare"



elseif not tAffs.damagedrightleg and tAffs.nausea and not tAffs.rebounding and not tAffs.shield and prepped_rightleg and prepped_leftleg and not tAffs.prone and prepped_torso then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." right leg delphinium delphinium"

elseif venoms[1] == "curare" then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..venoms[2].." "..venoms[1]


else

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..venoms[1].." "..venoms[2]

end


if not ataxia.settings.paused then



if not engaged then
send("queue addclear free falcon slay " ..target .. "; "..atk.." ;engage "..target.." ;assess " ..target)

else

send("queue addclear free falcon slay " ..target .. "; "..atk.. ";assess " ..target)

end
end

end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Disembowel Prep</name>
											<packageName></packageName>
											<script>function dwcprioslimb()
weapon1 = "scimitar405398"
weapon2 = "scimitar405403"


local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or true
scimdamage = ataxiaTables.limbData.dwcSlash + ataxiaTables.limbData.dwcSlash
axedamage = scimdamage - 3

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
  




--VENOMS

  venoms = {}
  

if (prepped_leftleg and prepped_rightleg) and tAffs.damagedtorso and not tAffs.prone and not tAffs.rebounding and not tAffs.shield then
 table.insert(venoms,"delphinium")
 table.insert(venoms,"delphinium")
end

if (prepped_leftleg or prepped_rightleg) and prepped_head and not tAffs.prone and not tAffs.rebounding and not tAffs.shield then
 table.insert(venoms,"delphinium")
 table.insert(venoms,"delphinium")
end

if tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and tAffs.asthma then
table.insert(venoms,"slike")
table.insert(venoms,"gecko")
end

if tAffs.impatience and not tAffs.anorexia and not tBals.salve then
table.insert(venoms,"slike")
end

if tAffs.slickness and not tAffs.anorexia and not tAffs.stupidity and tAffs.asthma then
  table.insert(venoms,"aconite")
  table.insert(venoms,"slike")
  
  end

if tAffs.anorexia and not tAffs.dizziness then
table.insert(venoms,"larkspur")
end


if tAffs.anorexia and not tAffs.stupidity then
table.insert(venoms,"aconite")
end

if tAffs.anorexia and not tAffs.shyness then
  table.insert(venoms,"digitalis")

end

if tAffs.anorexia and not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end



if not tAffs.paralysis then
  table.insert(venoms,"curare")
end

if not tAffs.nausea then
  table.insert(venoms,"vernalius")
end

if not tAffs.asthma then
  table.insert(venoms,"kalmia")
end

if not tAffs.clumsiness then
  table.insert(venoms,"xentio")
end

if not tAffs.slickness and tAffs.asthma and venoms[1] == "curare" then

  table.insert(venoms,"gecko")

end

if not tAffs.addiction then
  table.insert(venoms,"vardrax")

end

if not tAffs.sensitivity and tAffs.deaf then

  table.insert(venoms,"prefarar")
  table.insert(venoms,"prefarar")

end

if not tAffs.sensitivity and not tAffs.deaf then

  table.insert(venoms,"prefarar")
 
end

if not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end


if not tAffs.stupidity then
  table.insert(venoms,"aconite")


end

if not tAffs.dizziness then
table.insert(venoms,"larkspur")
end



if not tAffs.shyness then
  table.insert(venoms,"digitalis")

end



if not tAffs.brokenrightarm then
  table.insert(venoms,"epteth")

end

if not tAffs.brokenleftarm then
  table.insert(venoms,"epteth")

end

if not tAffs.darkshade then
  table.insert(venoms,"darkshade")

end

--ATTACK


if php &lt;= 35 then
use_bisect = true else
use_bisect = false
end

if tAffs.impaled or timpale == true then
disembowel = true
else
disembowel = false
end

if (lb[target].hits["right leg"] + scimdamage &gt;= 100) and (lb[target].hits["right leg"] + axedamage &lt; 100) and targetlimb == "right leg" then

need_raze2 = true
else
need_raze2 = false
end

if (lb[target].hits["right arm"] + scimdamage &gt;= 100) and (lb[target].hits["right arm"] + axedamage &lt; 100) and targetlimb == "right arm" then

need_raze2 = true
else
need_raze2 = false
end

if (lb[target].hits["left leg"] + scimdamage &gt;= 100) and (lb[target].hits["left leg"] + axedamage &lt; 100) and targetlimb == "left leg" then

need_raze3 = true
else
need_raze3 = false
end

if (lb[target].hits["left arm"] + scimdamage &gt;= 100) and (lb[target].hits["left arm"] + axedamage &lt; 100) and targetlimb == "left arm" then

need_raze3 = true
else
need_raze3 = false
end

if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end

if tAffs.rebounding and tAffs.shield then
need_shieldraze = true
else
need_shieldraze = false
end

if lb[target].hits["left leg"] + scimdamage &gt;= 100 and not tAffs.damagedleftleg then 
prepped_leftleg = true else
prepped_leftleg = false

end

if lb[target].hits["right leg"] + scimdamage &gt;= 100 and not tAffs.damagedrightleg then 
prepped_rightleg = true else
prepped_rightleg = false

end

if lb[target].hits["right arm"] + scimdamage &gt;= 100 and not tAffs.damagedrightarm then 
prepped_rightarm = true else
prepped_rightarm = false

end

if lb[target].hits["left arm"] + scimdamage &gt;= 100 and not tAffs.damagedleftarm then 
prepped_leftarm = true else
prepped_leftarm = false

end

if lb[target].hits["head"] + scimdamage &gt;= 100 and not tAffs.damagedhead then 
prepped_head = true else
prepped_head = false

end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 and ataxia.vitals.class == 4 then
impale_blackout = true
else
impale_blackout = false
end


--Logic for limb target
if not tAffs.damagedtorso then targetlimb = "torso"
elseif not prepped_rightleg then targetlimb = "right leg"
elseif prepped_rightleg and not prepped_leftleg then targetlimb = "left leg"
end

--Bisect
if use_bisect and not tAffs.shield then

atk = atk.."wield shield bastard;assess "..target..";bisect "..target.." curare"

-- Disembowel
elseif disembowel then 

atk = atk..";disembowel "..target

-- Impale
elseif tAffs.prone and tAffs.damagedleftleg then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";impale "..target.. ";fury on"

elseif lb[target].hits["left leg"] + scimdamage &gt;= 101 or tAffs.damagedleftleg then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";impale "..target.. ";fury on"


-- Raze
elseif need_raze then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.." "..targetlimb.." "..venoms[1]

elseif need_raze2 then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.." "..targetlimb.." "..venoms[1]

elseif need_raze3 then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.." "..targetlimb.." "..venoms[1]


-- Break Right Leg

elseif not tAffs.damagedrightleg and tAffs.nausea and not tAffs.rebounding and not tAffs.shield and prepped_rightleg and prepped_leftleg and not tAffs.prone and tAffs.damagedtorso then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." right leg delphinium delphinium"

-- Break Left Leg Slickness and Paralysis

elseif tAffs.damagedrightleg and not tAffs.rebounding and not tAffs.shield and prepped_leftleg and tAffs.damagedtorso and not tAffs.slickness then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." left leg gecko curare"

elseif tAffs.damagedrightleg and not tAffs.rebounding and not tAffs.shield and prepped_leftleg and tAffs.damagedtorso and tAffs.slickness then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." left leg epteth curare"

elseif tAffs.nausea and (not prepped_leftleg or not prepped_rightleg) then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.." "..venoms[2].." "..venoms[1]

elseif tAffs.nausea and not tAffs.damagedtorso then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.. " torso "..venoms[2].." "..venoms[1]

else

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..venoms[2].." "..venoms[1]

end


if not ataxia.settings.paused then


if use_bisect == true then
send("queue addclear free wield bastard;grip;assess "..target..";bisect "..target.." curare;engage " ..target)

elseif not engaged and need_falcon == true then
send("queue addclear free falcon slay " ..target.. ";" ..atk.." ;engage "..target.." ;assess " ..target)
elseif not engaged then
send("queue addclear free " ..atk.." ;engage "..target.." ;assess " ..target)

else

send("queue addclear free "..atk.. ";assess " ..target)


end
end

end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Head Prep</name>
											<packageName></packageName>
											<script>function dwcpriosheadprep()
weapon1 = "scimitar405398"
weapon2 = "scimitar405403"


local atk = combatQueue()

add_dedication = false
need_raze = false
partyrelay = partyrelay or true
scimdamage = ataxiaTables.limbData.dwcSlash + ataxiaTables.limbData.dwcSlash
axedamage = scimdamage - 3

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
  

--VENOMS

  venoms = {}

if tAffs.impatience and tAffs.anorexia and not tAffs.slickness and not tAffs.paralysis then
  table.insert(venoms,"curare")
  table.insert(venoms,"gecko")
end

if tAffs.impatience and not tAffs.anorexia and tAffs.slickness and not tAffs.paralysis then
  table.insert(venoms,"curare")
  table.insert(venoms,"slike")
end

if tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(venoms,"gecko")
  table.insert(venoms,"slike")
  end
if tAffs.slickness and not tAffs.anorexia and not tAffs.stupidity and tAffs.asthma then
  table.insert(venoms,"aconite")
  table.insert(venoms,"slike")
  
  end
  
if tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and tAffs.asthma then
table.insert(venoms,"slike")
table.insert(venoms,"gecko")
end

if tAffs.impatience and not tAffs.anorexia and not tBals.salve then
table.insert(venoms,"slike")
end

if inc_imp == true and not tAffs.paralysis then
  table.insert(venoms,"curare")
end

if inc_imp == true and not tAffs.asthma then
  table.insert(venoms,"kalmia")
end


if tAffs.anorexia and not tAffs.dizziness then
table.insert(venoms,"larkspur")
end


if tAffs.anorexia and not tAffs.stupidity then
table.insert(venoms,"aconite")
end

if tAffs.anorexia and not tAffs.shyness then
  table.insert(venoms,"digitalis")

end

if tAffs.anorexia and not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end



if not tAffs.paralysis then
  table.insert(venoms,"curare")
end

if not tAffs.nausea then
  table.insert(venoms,"vernalius")
end

if not tAffs.asthma then
  table.insert(venoms,"kalmia")
end

if not tAffs.clumsiness then
  table.insert(venoms,"xentio")
end

if not tAffs.slickness and tAffs.asthma and venoms[1] == "curare" then

  table.insert(venoms,"gecko")

end

if not tAffs.sensitivity and tAffs.deaf then

  table.insert(venoms,"prefarar")
  table.insert(venoms,"prefarar")

end

if not tAffs.sensitivity and not tAffs.deaf then

  table.insert(venoms,"prefarar")
 
end

if not tAffs.addiction then
  table.insert(venoms,"vardrax")

end

if not tAffs.recklessness then
table.insert(venoms,"eurypteria")
end


if not tAffs.stupidity then
  table.insert(venoms,"aconite")


end

if not tAffs.dizziness then
table.insert(venoms,"larkspur")
end


if not tAffs.shyness then
  table.insert(venoms,"digitalis")

end

if not tAffs.brokenrightarm then
  table.insert(venoms,"epteth")

end

if not tAffs.brokenleftarm then
  table.insert(venoms,"epteth")

end

if not tAffs.darkshade then
  table.insert(venoms,"darkshade")

end













--ATTACK


if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 35 then
use_bisect = true else
use_bisect = false
end

if tAffs.impaled then
disembowel = true
else
disembowel = false
end

if (lb[target].hits["right leg"] + scimdamage &gt;= 100) and (lb[target].hits["right leg"] + axedamage &lt; 100) and targetlimb == "right leg" then

need_raze2 = true
else
need_raze2 = false
end

if (lb[target].hits["right arm"] + scimdamage &gt;= 100) and (lb[target].hits["right arm"] + axedamage &lt; 100) and targetlimb == "right arm" then

need_raze2 = true
else
need_raze2 = false
end

if (lb[target].hits["left leg"] + scimdamage &gt;= 100) and (lb[target].hits["left leg"] + axedamage &lt; 100) and targetlimb == "left leg" then

need_raze3 = true
else
need_raze3 = false
end

if (lb[target].hits["left arm"] + scimdamage &gt;= 100) and (lb[target].hits["left arm"] + axedamage &lt; 100) and targetlimb == "left arm" then

need_raze3 = true
else
need_raze3 = false
end

if tAffs.rebounding or tAffs.shield then

need_raze = true
else
need_raze = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 35 then
use_bisect = true else
use_bisect = false
end


if tAffs.rebounding and tAffs.shield then
need_shieldraze = true
else
need_shieldraze = false
end


if  tLimbs.LL + scimdamage &gt;= 100 and not tAffs.damagedleftleg then 
prepped_leftleg = true else
prepped_leftleg = false

end

if  tLimbs.RL + scimdamage &gt;= 100 and not tAffs.damagedrightleg then 
prepped_rightleg = true else
prepped_rightleg = false

end

if  tLimbs.RA + scimdamage &gt;= 100 and not tAffs.damagedrightarm then 
prepped_rightarm = true else
prepped_rightarm = false

end

if  tLimbs.LA + scimdamage &gt;= 100 and not tAffs.damagedleftarm then 
prepped_leftarm = true else
prepped_leftarm = false

end

if  tLimbs.H + scimdamage &gt;= 100 and not tAffs.damagedhead then 
prepped_head = true else
prepped_head = false

end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 50 and ataxia.vitals.class == 4 then
impale_blackout = true
else
impale_blackout = false
end


--Logic for limb target
if not prepped_head then targetlimb = "head"
elseif not prepped_rightleg then targetlimb = "right leg"
elseif tAffs.damagedrightleg and not tAffs.damagedhead and prepped_head then targetlimb = "head"
elseif prepped_rightleg and not prepped_leftleg then targetlimb = "left leg"
end

--Bisect
if use_bisect and not tAffs.shield then

atk = atk.."wield shield bastard;assess "..target..";bisect "..target.." curare"

-- Disembowel
elseif disembowel then 

atk = atk..";disembowel "..target


-- Raze
elseif need_raze then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.." "..targetlimb.." "..venoms[1]

elseif need_raze2 then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.." "..targetlimb.." "..venoms[1]

elseif need_raze3 then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";razeslash "..target.." "..targetlimb.." "..venoms[1]


-- Impale
elseif tAffs.prone and tAffs.damagedleftleg then
atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";fury on;impale "..target

-- Break Right Leg

elseif not tAffs.damagedrightleg and tAffs.nausea and not tAffs.rebounding and not tAffs.shield and prepped_rightleg then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." right leg delphinium delphinium"

-- Break Head
elseif tAffs.damagedrightleg and not tAffs.rebounding and not tAffs.shield and prepped_head then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." head slike aconite"

elseif tAffs.nausea and not tAffs.rebounding and not tAffs.shield and tAffs.damagedhead then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." head " ..venoms[2].." "..venoms[1]

-- Break Left Leg Slickness and Paralysis

elseif tAffs.damagedrightleg and not tAffs.rebounding and not tAffs.shield and prepped_leftleg and tAffs.damagedtorso and not tAffs.slickness then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." left leg gecko curare"

elseif tAffs.damagedrightleg and not tAffs.rebounding and not tAffs.shield and prepped_leftleg and tAffs.damagedtorso and tAffs.slickness then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." left leg epteth curare"

elseif tAffs.nausea and (not prepped_leftleg or not prepped_rightleg) then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..targetlimb.." "..venoms[2].." "..venoms[1]

elseif tAffs.nausea and not tAffs.damagedtorso then

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.. " torso "..venoms[2].." "..venoms[1]

else

atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.." "..venoms[2].." "..venoms[1]

end


if not ataxia.settings.paused then


if use_bisect == true then
send("queue addclear free wield bastard;grip;assess "..target..";bisect "..target.." curare;engage " ..target)

elseif not engaged and need_falcon == true then
send("queue addclear free empower priority set kena mannaz sleizak;falcon slay " ..target.. ";" ..atk.." ;engage "..target.." ;assess " ..target.. ";contemplate " ..target)
elseif not engaged then
send("queue addclear free empower priority set kena mannaz sleizak; " ..atk.." ;engage "..target.." ;assess " ..target.. " ;contemplate " ..target)

else

send("queue addclear free empower priority set kena mannaz sleizak; "..atk.. ";assess " ..target.. ";contemplate " ..target)


end
end

end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>DWCLogic</name>
											<packageName></packageName>
											<script>
function runiedwckelpstack2()


if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	end
  
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
		treelock = true
  else
    treelock = false
	end


if softlock == true and not tAffs.recklessness then
   envenom1 = "eurypteria"
   end
if softlock == true and not tAffs.stupidity then
   envenom1 = "aconite"
   
   end
   
if softlock == true and not tAffs.brokenleftarm then
	envenom1 = "epteth"
   
   end
   

if softlock == true and not tAffs.brokenrightarm then
	envenom1 = "epteth"
   
   end

if tAffs.prone then
	envenom1 = "epseth"
	envenom2 = "epseth"
 
  end

if tAffs.prone and not tAffs.anorexia and not tBals.salve then
    envenom1 = "slike"

  end

if tAffs.slickness and not tAffs.anorexia and tAffs.asthma then
   envenom1 = "slike"
  
  end

if tAffs.asthma and not tAffs.slickness then
	envenom1 = "gecko"

  end
if not tAffs.addiction and tAffs.weariness then
	envenom1 = "vardrax"

  end

if not tAffs.weariness then
   envenom1 = "vernalius"
  
  end

if not tAffs.asthma then
	envenom1 = "kalmia"
end


if not tAffs.clumsiness then
	envenom1 = "xentio"

  end

end

function envenom2dwc()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	end
  
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
		treelock = true
  else
    treelock = false
	end


if not tAffs.paralysis then
	envenom2 = "curare"


elseif tAffs.asthma and not tAffs.slickness and not tAffs.paralysis then
	envenom2 = "curare"
  

elseif softlock == true and not tAffs.recklessness and envenom1 ~= "eurypteria"  then
   envenom2 = "eurypteria"
  
elseif softlock == true and not tAffs.stupidity and envenom1 ~= "aconite" then
   envenom2 = "aconite"
   
  
   
elseif softlock == true and not tAffs.brokenleftarm  and not tAffs.brokenrightarm and envenom1 == "epteth" then
	envenom2 = "epteth"
      
  

elseif tAffs.prone and envenom1 == "epseth" then
	
	envenom2 = "epseth"
 
  

elseif tAffs.prone and not tAffs.anorexia and not tBals.salve and envenom1 ~= "slike" then
    envenom2 = "slike"

  
  
elseif not tAffs.paralysis and envenom1 ~= "curare" then
	envenom2 = "curare"
  
  

elseif tAffs.slickness and not tAffs.anorexia and tAffs.asthma and envenom1 ~= "slike" then
   envenom2 = "slike"
  
 

elseif tAffs.asthma and not tAffs.slickness and envenom1 ~= "slike" then
	envenom2 = "slike"
  
 

elseif not tAffs.addiction and tAffs.weariness and envenom1 ~= "vardrax" then
	envenom2 = "vardrax"

 

elseif not tAffs.paralysis and envenom1 ~= "curare" then
	envenom2 = "curare"

 

elseif not tAffs.weariness and envenom1 ~= "vernalius" then
   envenom2 = "vernalius"
  
 

elseif not tAffs.asthma and envenom1 ~= "kalmia" then
	envenom2 = "kalmia"

 


elseif not tAffs.clumsiness and envenom1 ~= "xentio" then
	envenom2 = "xentio"

 
 end


dwcattack()
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Attack DWC</name>
											<packageName></packageName>
											<script>function dwcattack()

if tAffs.rebounding or tAffs.shield and engaged == false then
send("queue addclear free wield left scimitar405398;wield right scimitar405403;grip;falcon slay " ..target..";assess "..target..";rsl " ..target.. " " ..envenom2..";engage " ..target)
elseif tAffs.rebounding or tAffs.shield and engaged == true then
send("queue addclear free wield left scimitar405398;wield right scimitar405403;grip;falcon slay " ..target..";assess "..target..";rsl " ..target.. " " ..envenom2)
elseif use_bisect == true then
send("queue addclear free wield bastard;grip;assess "..target..";bisect "..target.." curare;engage " ..target)
elseif not engaged then
send("queue addclear free wield left scimitar405398;wield right scimitar405403;grip;falcon slay " ..target..";assess "..target..";dsl " ..target.. " " ..envenom1.. " " ..envenom2..";engage " ..target)
else
send("queue addclear free wield left scimitar405398;wield right scimitar405403;grip;falcon slay " ..target..";assess "..target..";dsl " ..target.. " " ..envenom1.. " " ..envenom2)
  end

end

</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>LeviDWCDisembowel</name>
											<packageName></packageName>
											<script>function levidwcheadprep()
weapon1 = "scimitar405398"
weapon2 = "scimitar405403"
local atk = combatQueue()
need_raze = need_raze or false
empowerrunesset = "kena mannaz sleizak"

ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"

--Set Damage per DSL and Regular
scimdamage = ataxiaTables.limbData.dwcSlash + ataxiaTables.limbData.dwcSlash

-- For Raze Slash Situations
scim1damage = ataxiaTables.limbData.dwcSlash

--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()


--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  



--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false

--VENOMS
--Set Table
  venoms = {}
  
--Venoms 1
if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(venoms,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(venoms,"vernalius") 
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(venoms,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(venoms,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
   table.insert(venoms,"eurypteria") 
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(venoms,"curare") 
elseif softlock == true and not tAffs.paralysis then
  table.insert(venoms,"curare") 
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
  table.insert(venoms,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness then
  table.insert(venoms,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(venoms,"slike")
elseif not tAffs.paralysis then
   table.insert(venoms,"curare")

elseif tAffs.paralysis then
  if tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
    table.insert(venoms,"slike") 
  elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience then
    table.insert(venoms,"gecko") 
   elseif not tAffs.slickness and tAffs.asthma then
    table.insert(venoms,"gecko")
  elseif not tAffs.nausea then
    table.insert(venoms,"vernalius")
  elseif not tAffs.clumsiness then
    table.insert(venoms,"xentio")
  elseif not tAffs.asthma then
    table.insert(venoms,"kalmia")
  elseif not tAffs.weariness then
    table.insert(venoms,"vernalius")
  
  end
end


--Venoms Two
if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and venoms[1] ~= "curare" then
    table.insert(venoms,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and venoms[1] ~= "vernalius" then
    table.insert(venoms,"vernalius")
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and venoms[1] ~= "voyria" then
    table.insert(venoms,"voyria")
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and venoms[1] ~= "aconite" then
    table.insert(venoms,"aconite")
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and venoms[1] ~= "eurypteria" then
    table.insert(venoms,"eurypteria")
  end
elseif hardlock == true and not tAffs.paralysis and venoms[1] ~= "curare" then
  table.insert(venoms,"curare")
elseif softlock == true and not tAffs.paralysis and venoms[1] ~= "curare" then
  table.insert(venoms,"curare")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and venoms[1] == "slike" then
  table.insert(venoms,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and venoms[1] == "gecko" then
  table.insert(venoms,"slike")
elseif not tAffs.paralysis and venoms[1] ~= "curare" then
  table.insert(venoms,"curare")
elseif not tAffs.nausea and venoms[1] ~= "vernalius" then
  table.insert(venoms,"vernalius")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and venoms[1] ~= "slike" then
    table.insert(venoms,"slike")
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and venoms[1] ~= "gecko" then
    table.insert(venoms,"gecko") 
elseif not tAffs.slickness and tAffs.asthma and venoms[1] ~= "gecko" then
    table.insert(venoms,"gecko")
elseif tAffs.clumsiness and not tAffs.asthma and venoms[1] ~= "kalmia" then
    table.insert(venoms,"kalmia")
elseif not tAffs.clumsiness and venoms[1] ~= "xentio" then
    table.insert(venoms,"xentio")
elseif not tAffs.weariness and venoms[1] ~= "vernalius" then
    table.insert(venoms,"vernalius")
elseif not tAffs.addiction and venoms[1] ~= "vardrax" then
    table.insert(venoms,"vardrax")
elseif not tAffs.darkshade and venoms[1] ~= "darkshade" then
    table.insert(venoms,"darkshade")
elseif not tAffs.stupidity and venoms[1] ~= "aconite" then
    table.insert(venoms,"aconite")
else
  table.insert(venoms,"prefarar")
end  
  

-- Limb Prep Calc


if lb[target].hits["right leg"] + scimdamage &gt;= 100 and not tAffs.damagedrightleg then
prepped_rightleg = true else
prepped_rightleg = false
end

if lb[target].hits["right leg"] + scim1damage &gt;= 100 and not tAffs.damagedrightleg and tAffs.shield or tAffs.rebounding then
prepped2_rightleg = true else
prepped2_rightleg = false
end

if lb[target].hits["left leg"] + scimdamage &gt;= 100 and not tAffs.damagedleftleg then
prepped_leftleg = true else
prepped_leftleg = false
end

if lb[target].hits["left leg"] + scim1damage &gt;= 100 and not tAffs.damagedleftleg and tAffs.shield or tAffs.rebounding then
prepped2_leftleg = true else
prepped2_leftleg = false
end

if lb[target].hits["left arm"] + scimdamage &gt;= 100 and not tAffs.damagedleftarm then
prepped_leftleg = true else
prepped_leftleg = false
end

if lb[target].hits["left arm"] + scim1damage &gt;= 100 and not tAffs.damagedleftarm and tAffs.shield or tAffs.rebounding then
prepped2_leftarm = true else
prepped2_leftarm = false
end

if lb[target].hits["right arm"] + scimdamage &gt;= 100 and not tAffs.damagedrightarm then
prepped_rightarm = true else
prepped_rightarm = false
end

if lb[target].hits["right arm"] + scim1damage &gt;= 100 and not tAffs.damagedrightarm and tAffs.shield or tAffs.rebounding then
prepped2_rightarm = true else
prepped2_rightarm = false
end

if lb[target].hits["torso"] + scimdamage &gt;= 100 and not tAffs.mildtrauma then
prepped_torso = true else
prepped_torso = false
end

if lb[target].hits["torso"] + scim1damage &gt;= 100 and not tAffs.mildtrauma and tAffs.shield or tAffs.rebounding then
prepped2_torso = true else
prepped2_torso = false
end

if lb[target].hits["head"] + scimdamage &gt;= 100 and not tAffs.damagedhead then
prepped_head = true else
prepped_head = false
end

if lb[target].hits["head"] + scim1damage &gt;= 100 and not tAffs.damagedhead and tAffs.shield or tAffs.rebounding then
prepped2_head = true else
prepped2_head = false
end


  
  
--ATTACK

-- Bisect
if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 35 then
use_bisect = true else
use_bisect = false
end

--Disembowel
if tAffs.impaled then
disembowel = true
else
disembowel = false
end

--Logic for limb target
if not prepped_torso then targetlimb = "torso"
elseif not prepped_rightleg then targetlimb = "right leg"
elseif not prepped_leftleg then targetlimb = "left leg"
end

--Bisect
if use_bisect and not tAffs.shield then

atk = atk.."wield bastard;assess "..target..";bisect "..target.." curare"

-- Disembowel
elseif disembowel then 

atk = atk..";disembowel "..target

-- Raze
elseif tAffs.rebounding and not tAffs.shield then
    if tAffs.nausea then
      if prepped_torso then
        atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";empower priority set " ..empowerrunesset.. ";razeslash "..target.." torso "..venoms[1].. ";assess "..target.. ";contemplate " ..target
      elseif prepped_leftleg then
        atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";empower priority set " ..empowerrunesset.. ";razeslash "..target.." left leg "..venoms[1].. ";assess "..target.. ";contemplate " ..target
      elseif prepped_rightleg then
        atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";empower priority set " ..empowerrunesset.. ";razeslash "..target.." right leg "..venoms[1].. ";assess "..target.. ";contemplate " ..target
      else
        atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";empower priority set " ..empowerrunesset.. ";razeslash "..target.. " "..venoms[1].. ";assess "..target.. ";contemplate " ..target
      end
    else 
      atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";empower priority set " ..empowerrunesset.. ";razeslash "..target.. " " ..venoms[1].. ";assess "..target.. ";contemplate " ..target
    end
    
elseif not tAffs.rebounding and tAffs.shield then
    if tAffs.nausea then
      if prepped_torso then
        atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";empower priority set " ..empowerrunesset.. ";razeslash "..target.." torso "..venoms[1].. ";assess "..target.. ";contemplate " ..target
      elseif prepped_leftleg then
        atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";empower priority set " ..empowerrunesset.. ";razeslash "..target.." left leg "..venoms[1].. ";assess "..target.. ";contemplate " ..target
      elseif prepped_rightleg then
        atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";empower priority set " ..empowerrunesset.. ";razeslash "..target.." right leg "..venoms[1].. ";assess "..target.. ";contemplate " ..target
      else
        atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";empower priority set " ..empowerrunesset.. ";razeslash "..target.. " "..venoms[1].. ";assess "..target.. ";contemplate " ..target
      end
    else 
        atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";empower priority set " ..empowerrunesset.. ";razeslash "..target.. " " ..venoms[1].. ";assess "..target.. ";contemplate " ..target
    end

elseif tAffs.shield and tAffs.rebounding then
  atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";empower priority set " ..empowerrunesset.. ";raze "..target.. ";assess "..target.. ";contemplate " ..target
   
-- Impale
elseif tAffs.prone and tAffs.damagedleftleg and tAffs.damagedrightleg then
  atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";fury on;impale "..target

--Double Break
elseif tAffs.damagedrightleg and prepped_leftleg and tAffs.mildtrauma or lb[target].hits["torso"] &gt;= 100 and tAffs.prone then
  atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.. " left leg "..venoms[2].." "..venoms[1].. ";assess "..target.. ";contemplate " ..target
elseif tAffs.nausea then
  if prepped_rightleg and prepped_leftleg and tAffs.mildtrauma or lb[target].hits["torso"] &gt;= 100 and not tAffs.prone then
  atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.. " right leg delphinium delphinium;assess "..target.. ";contemplate " ..target
  elseif prepped_rightleg and prepped_leftleg and prepped_torso and not tAffs.mildtrauma then
  atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.. " torso "..venoms[2].." "..venoms[1].. ";assess "..target.. ";contemplate " ..target
  --Prep
 elseif prepped_rightleg and prepped_torso and not prepped_leftleg and not prepped2_leftleg then
  atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.. " left leg "..venoms[2].." "..venoms[1].. ";assess "..target.. ";contemplate " ..target
 elseif prepped_leftleg and prepped_torso and not prepped_rightleg and not prepped2_rightleg then
  atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.. " right leg "..venoms[2].." "..venoms[1].. ";assess "..target.. ";contemplate " ..target
 elseif not prepped_torso then
  atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.. " torso "..venoms[2].." "..venoms[1].. ";assess "..target.. ";contemplate " ..target
 elseif not prepped_rightleg then
  atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.. " right leg "..venoms[2].." "..venoms[1].. ";assess "..target.. ";contemplate " ..target
 elseif not prepped_leftleg then
  atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.. " left leg "..venoms[2].." "..venoms[1].. ";assess "..target.. ";contemplate " ..target

 end
else 
  atk = atk.."wield "..weapon1.." "..weapon2..";wipe "..weapon1..";wipe "..weapon2..";assess "..target..";dsl "..target.. " "..venoms[2].." "..venoms[1].. ";assess "..target.. ";contemplate " ..target


end
--Attack
if table.contains(ataxia.playersHere, target) then
if falconattack == true then
  if not engaged then
    send("queue addclear freestand " ..atk.. ";engage " ..target)
  else
    send("queue addclear freestand " ..atk)
  end
elseif falconattack == false then
 if not engaged then
    send("queue addclear freestand " ..atk.. ";falcon slay " ..target.." ;engage " ..target)
  else
    send("queue addclear freestand " ..atk.. ";falcon slay " ..target)
  end
end
else
  expandAlias("nt")
  send("queue addclear freestand " ..atk)

end

--Function End
end



</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>DWB Runie</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>DWB Runie Logic</name>
											<packageName></packageName>
											<script>
DWBWhirlDamage = DWBWhirlDamage or 0
-- isaz tiwaz wunjo
-- tiwaz wunjo sowulu

function dwb_pocketleg()
--When you need a breather
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 34 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Stuff
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end


--ATTACKKKKK
 
-- Bisect

if myinstantcath == true then
  atk = atk.." touch shield"
elseif not tAffs.shield and use_bisect == true then
  atk = atk.. "wield bastard;bisect " ..target.. " ;assess " ..target.. " ;sizeup " ..target

-- Pulp

elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 5) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;dismount;pulp " ..target.. ";sizeup " ..target.. " ;assess " ..target

--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon track " ..target.. ";falcon slay " ..target.. ";fracture " ..target.. " ;assess " ..target.. " ;sizeup " ..target

elseif mprepped_leftleg == true and ataxia.vitals.class &gt;= 3 and ataxiaTemp.parriedLimb ~= "left leg" then
  if mprepped_rightleg == false  then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg expend right leg;assess " ..target
  elseif mprepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg expend head;assess " ..target
  elseif mprepped_torso == false then
   atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg expend torso;assess " ..target
  end
elseif mprepped_rightleg == true and ataxia.vitals.class &gt;= 3 and ataxiaTemp.parriedLimb ~= "right leg" then
  if mprepped_leftleg == false  then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " right leg expend left leg;assess " ..target
  elseif mprepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " right leg expend head;assess " ..target
  elseif mprepped_torso == false then
   atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " right leg expend torso;assess " ..target
  end
  else
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " ;assess " ..target

  end

if table.contains(ataxia.playersHere, target) then
	if not engaged then
		send("queue addclear freestand " ..atk.. ";engage " ..target)
	else
	send("queue addclear freestand " ..atk)
	end
end
end


function dwb_skullfractures()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 34 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Stuff
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end


--Priority of Limb
if mprepped_rightleg == false then
tarlimb = "right leg"
elseif mprepped_head == false then
tarlimb = "head"
elseif mprepped_leftleg == false then
tarlimb = "left leg"
end


--ATTACKKKKK
 
-- Bisect

if myinstantcath == true then
  atk = atk.." touch shield"
elseif not tAffs.shield and use_bisect == true then
  atk = atk.. "wield bastard;bisect " ..target.. " ;assess " ..target.. " ;sizeup " ..target

-- Pulp

elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 5) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;dismount;pulp " ..target.. ";sizeup " ..target.. " ;assess " ..target

--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon track " ..target.. ";falcon slay " ..target.. ";fracture " ..target.. " ;assess " ..target.. " ;sizeup " ..target

-- Skull Fractures --
elseif tAffs.prone and ataxia.vitals.class &gt;= 2 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " head expend head expend;assess " ..target.." ;sizeup " ..target
elseif tAffs.prone and ataxia.vitals.class &lt; 2 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " head head;sizeup " ..target.. ";assess " ..target


-- Break Sequence --

--Dont Double Break if they Pre-Apply
elseif tarpreapply == true and ataxiaTemp.parriedLimb ~= "torso" then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " torso torso expend;assess " ..target
elseif tarpreapply == true and ataxiaTemp.parriedLimb ~= "head" then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. ";assess " ..target



--Doublebreak with or without clumsiness (Add Discipline
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. " ;assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. " ;assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. " ;assess " ..target

elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

 

--Anti Parry
elseif not tAffs.numbedleftarm and ataxiaTemp.parriedLimb ~= "left arm" and ataxiaTemp.parriedLimb == "left leg" or ataxiaTemp.parriedLimb == "right leg" or ataxiaTemp.parriedLimb == "head" then
  if ataxia.vitals.class &lt; 1 then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon track " ..target.. " ;falcon slay " ..target.. ";doublewhirl " ..target.. " right arm right arm;sizeup " ..target.. ";assess " ..target
 
  elseif ataxia.vitals.class &gt;= 2 then
    if ataxiaTemp.parriedLimb ~= "torso" then 
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " torso expend left arm expend;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_rightleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_head == true and mprepped_leftleg == false and mprepped_rightleg == false and mpreppedhead == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    elseif mprepped_leftleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_head == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    else 
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend torso;sizeup " ..target.. ";assess " ..target
  
    end
  end
  
--Prep Head\ Left Leg\ Right Leg


--RIGHT LEG SCENARIOS
elseif m2prepped_rightleg == true and mprepped_head == true and mprepped_rightleg == false and mprepped_leftleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left arm right leg;assess " ..target
  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_rightleg == true and mprepped_rightleg == false and mprepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head right leg;assess " ..target
elseif m2prepped_rightleg == true and mprepped_rightleg == false and mprepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left left right leg;assess " ..target



--HEAD SCENARIOS
elseif m2prepped_head == true and mprepped_head == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head right leg;assess " ..target
elseif m2prepped_head == true and mprepped_head == false and mprepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head left leg;assess " ..target
elseif m2prepped_head == true and mprepped_head == false and mprepped_leftleg == true and mprepped_rightleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head left arm;assess " ..target
 
 
 
  --LEFT LEG SCENARIOS
  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg right leg;assess " ..target
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == true  and mprepped_head == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg left arm;assess " ..target
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == true and mprepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg head;assess " ..target



elseif mprepped_head == false and m2prepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head head;assess " ..target
elseif mprepped_leftleg == false and m2prepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg left leg;assess " ..target
elseif mprepped_rightleg == false and m2prepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " right leg right leg;assess " ..target
else
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " ;assess " ..target

  end

if table.contains(ataxia.playersHere, target) then
	if not engaged then
		send("queue addclear freestand " ..atk.. ";engage " ..target)
	else
	send("queue addclear freestand " ..atk)
	end
end
end


----------------------------------------------------------------------------------------
function dwb_assaultheadpulpsetup()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 35 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Stuff
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
  m2prepped_rightleg = true else
  m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
  f2prepped_rightleg = true else
  f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
  m2prepped_leftleg = true else
  m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
  f2prepped_leftleg = true else
  f2prepped_leftleg = false
end


--Priority of Limb
if mprepped_rightleg == false then
  tarlimb = "right leg"
elseif mprepped_head == false then
  tarlimb = "head"
elseif mprepped_leftleg == false then
  tarlimb = "left leg"
end


--ATTACKKKKK
 
-- Bisect\ if Not Mhaldorian

if myinstantcath == true then
  atk = atk.. "touch shield"
elseif not tAffs.shield and use_bisect == true then
  atk = atk.. "sizeup " ..target.. ";wield bastard;bisect " ..target.. ";assess " ..target
-- Pulp
elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 4) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";pulp " ..target.. ";assess " ..target


--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon track " ..target.. ";falcon slay " ..target.. ";sizeup " ..target.. ";fracture " ..target.. "  ;assess " ..target

--Assault Head
elseif tAffs.prone and (tAffs.damagedhead or lb[target].hits["head"] &gt;= 100) and ataxia.vitals.class &gt;= 7 then
  atk = atk.. "wield left flail343168;wield right flail408566;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";sizeup " ..target.. ";assault " ..target.. " head;assess " ..target

-- Skull Fractures
elseif tAffs.prone and (tAffs.damagedhead or lb[target].hits["head"] &gt;= 100) and ataxia.vitals.class &lt; 7 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head head;assess " ..target
elseif tAffs.prone and (tAffs.mildtrauma or lb[target].hits["torso"] &gt;= 100) and ataxia.vitals.class &lt; 7 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " torso torso;assess " ..target


--Beat Head
elseif tAffs.prone and ataxia.vitals.class == 1 and not tAffs.numbedrightarm then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " torso right arm expend;sizeup " ..target.. ";assess " ..target
elseif tAffs.prone and ataxia.vitals.class &gt;= 2 and not tAffs.numbedrightarm then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " torso expend right arm expend;sizeup " ..target.. ";assess " ..target
elseif tAffs.prone and ataxia.vitals.class &gt;= 2 and (lb[target].hits["head"] &gt;= 100 or tAffs.damagedhead) then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head expend head expend;assess " ..target
elseif tAffs.prone and ataxia.vitals.class &lt; 2 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head head;assess " ..target


-- Break Sequence
elseif tarpreapply == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " torso torso expend;assess " ..target

elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

 
--Anti Parry
elseif not tAffs.numbedleftarm and ataxiaTemp.parriedLimb ~= "left arm" and ataxiaTemp.parriedLimb == "left leg" or ataxiaTemp.parriedLimb == "right leg" or ataxiaTemp.parriedLimb == "head" then
  if ataxia.vitals.class &lt; 1 then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon track " ..target.. " ;falcon slay " ..target.. ";doublewhirl " ..target.. " right arm right arm;sizeup " ..target.. ";assess " ..target
 
  elseif ataxia.vitals.class &gt;= 2 then
    if ataxiaTemp.parriedLimb ~= "torso" then 
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " torso expend left arm expend;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_rightleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_head == true and mprepped_leftleg == false and mprepped_rightleg == false and mpreppedhead == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    elseif mprepped_leftleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_head == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    else 
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend torso;sizeup " ..target.. ";assess " ..target
  
    end
  end

  
--Prep Head\ Left Leg\ Right Leg


--RIGHT LEG SCENARIOS
elseif m2prepped_rightleg == true and mprepped_head == true and mprepped_rightleg == false and mprepped_leftleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left arm right leg;assess " ..target
  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_rightleg == true and mprepped_rightleg == false and mprepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head right leg;assess " ..target
elseif m2prepped_rightleg == true and mprepped_rightleg == false and mprepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left left right leg;assess " ..target



--HEAD SCENARIOS
elseif m2prepped_head == true and mprepped_head == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head right leg;assess " ..target
elseif m2prepped_head == true and mprepped_head == false and mprepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head left leg;assess " ..target
elseif m2prepped_head == true and mprepped_head == false and mprepped_leftleg == true and mprepped_rightleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head left arm;assess " ..target
 
 
 
  --LEFT LEG SCENARIOS
  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg right leg;assess " ..target
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == true  and mprepped_head == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg left arm;assess " ..target
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == true and mprepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg head;assess " ..target



elseif mprepped_head == false and m2prepped_head == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head head;assess " ..target
elseif mprepped_leftleg == false and m2prepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg left leg;assess " ..target
elseif mprepped_rightleg == false and m2prepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " right leg right leg;assess " ..target
else
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " ;assess " ..target

  end

if table.contains(ataxia.playersHere, target) then
	if not engaged then
		send("queue addclear freestand " ..atk.. ";engage " ..target)
	else
	send("queue addclear freestand " ..atk)
	end
end
end





function dwb_torsodamage()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 35 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Formula
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end


--Priority of Limb
if mprepped_leftleg == false then
tarlimb = "left leg"
elseif mprepped_rightleg == false then
tarlimb = "right leg"
else
tarlimb = "torso"
end


--ATTACKKKKK
 
-- Bisect

if myinstantcath == true then
  atk = atk.. "touch shield"
elseif not tAffs.shield and use_bisect == true then
  atk = atk.. "sizeup " ..target.. ";wield bastard;bisect " ..target.. " ;assess " ..target
-- Pulp
elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 5) and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";pulp " ..target.. ";assess " ..target

--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon track " ..target.. " ;falcon slay " ..target.. ";sizeup " ..target.. ";fracture " ..target.. "  ;assess " ..target

--Torso Damage
-- Get rid of Rebounding and Tattoos
--elseif tAffs.prone and ataxia.vitals.class == 1 and not tAffs.numbedrightarm then
  --atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " torso right arm expend;sizeup " ..target.. ";assess " ..target
--elseif tAffs.prone and ataxia.vitals.class &gt;= 2 and not tAffs.numbedrightarm then
  --atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " torso expend right arm expend;sizeup " ..target.. ";assess " ..target
elseif tAffs.prone and ataxia.vitals.class &gt;= 3 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";sizeup " ..target.. ";assault " ..target.. " torso;assess " ..target
elseif ataxia.vitals.class &gt;= 2 and ataxiaTemp.fractures.crackedribs &gt;= 1 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso expend torso expend;assess " ..target
elseif ataxia.vitals.class &lt; 2 and ataxiaTemp.fractures.crackedribs &gt;= 1 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso torso;assess " ..target
elseif ataxia.vitals.class &lt; 2 and tAffs.prone then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso torso;assess " ..target
elseif ataxia.vitals.class &lt; 2 and lb[target].hits["head"]&gt;= 100 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";sizeup " ..target.. ";doublewhirl " ..target.. " torso torso;assess " ..target

--Pre-Apply Counter
elseif tarpreapply == true and ataxiaTemp.parriedLimb ~= "torso" then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " torso expend torso;assess " ..target
elseif tarpreapply == true and ataxiaTemp.parriedLimb ~= "head" then
  atk = atk.. " wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " head head;assess " ..target

-- Double Break
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

 
--Anti Parry

--Anti Parry
elseif not tAffs.numbedleftarm and ataxiaTemp.parriedLimb ~= "left arm" and ataxiaTemp.parriedLimb == "left leg" or ataxiaTemp.parriedLimb == "right leg" or ataxiaTemp.parriedLimb == "head" then
  if ataxia.vitals.class &lt; 1 then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon track " ..target.. " ;falcon slay " ..target.. ";doublewhirl " ..target.. " right arm right arm;sizeup " ..target.. ";assess " ..target
 
  elseif ataxia.vitals.class &gt;= 2 then
    if ataxiaTemp.parriedLimb ~= "torso" then 
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " torso expend left arm expend;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_rightleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_head == true and mprepped_leftleg == false and mprepped_rightleg == false and mpreppedhead == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    elseif mprepped_leftleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_head == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    else 
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend torso;sizeup " ..target.. ";assess " ..target
  
    end
  end

  
--One Prepped | Now the other
elseif m2prepped_rightleg == true and mprepped_rightleg == false and mprepped_leftleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left arm right leg;assess " ..target
elseif m2prepped_rightleg == true and mprepped_rightleg == false and mprepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg right leg;assess " ..target

  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg right leg;assess " ..target
  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg left arm;assess " ..target


-- Prep
elseif mprepped_leftleg == false and m2prepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " left leg left leg;sizeup " ..target.. ";assess " ..target

elseif mprepped_rightleg == false and m2prepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " right leg right leg;sizeup " ..target.. ";assess " ..target

else
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " ;sizeup " ..target.. ";assess " ..target

end

if table.contains(ataxia.playersHere, target) then
	if not engaged then
		send("queue addclear freestand " ..atk.. ";engage " ..target)
	else
	send("queue addclear freestand " ..atk)
	end
end
end

function dwb_groupsetup()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
end
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
mstardamage = DWBWhirlDamage
flaildamage = DWBWhirlDamage
mstar2damage = DWBWhirlDamage + DWBWhirlDamage
tarlimb = tarlimb or "right arm"
tarlimb2 = tarlimb2 or "none"
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"
wieldweapons = wieldweapons or "morningstars"

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 35 then
use_bisect = true else
use_bisect = false
end

if lb[target].hits["head"] + mstardamage &gt;= 99.9 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end
if lb[target].hits["head"] + flaildamage &gt;= 99.9 and not tAffs.damagedhead then 
fprepped_head = true else
fprepped_head = false
end

if lb[target].hits["torso"] + mstardamage &gt;= 99.9 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end
if lb[target].hits["torso"] + flaildamage &gt;= 99.9 and not tAffs.damagedtorso then 
fprepped_torso = true else
fprepped_torso = false
end

if lb[target].hits["left leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end
if lb[target].hits["left leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftleg then 
fprepped_leftleg = true else
fprepped_leftleg = false
end

if lb[target].hits["right leg"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end
if lb[target].hits["right leg"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightleg then 
fprepped_rightleg = true else
fprepped_rightleg = false
end

if lb[target].hits["right arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end
if lb[target].hits["right arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedrightarm then 
fprepped_rightarm = true else
fprepped_rightarm = false
end

if lb[target].hits["left arm"] + mstardamage &gt;= 99.9 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end
if lb[target].hits["left arm"] + flaildamage &gt;= 99.9 and not tAffs.damagedleftarm then 
fprepped_leftarm = true else
fprepped_leftarm = false
end

--Double Whirl Formula
-----------------
-----------------
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
m2prepped_head = true else
m2prepped_head = false
end
if lb[target].hits["head"] + mstar2damage &gt;= 99.9 and not tAffs.damagedhead then 
f2prepped_head = true else
f2prepped_head = false
end

if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
m2prepped_torso = true else
m2prepped_torso = false
end
if lb[target].hits["torso"] + mstar2damage &gt;= 99.9 and not tAffs.damagedtorso then 
f2prepped_torso = true else
f2prepped_torso = false
end

if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
m2prepped_leftarm = true else
m2prepped_leftarm = false
end
if lb[target].hits["left arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftarm then 
f2prepped_leftarm = true else
f2prepped_leftarm = false
end

if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
m2prepped_rightarm = true else
m2prepped_rightarm = false
end
if lb[target].hits["right arm"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightarm then 
f2prepped_rightarm = true else
f2prepped_rightarm = false
end

if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
m2prepped_rightleg = true else
m2prepped_rightleg = false
end
if lb[target].hits["right leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedrightleg then 
f2prepped_rightleg = true else
f2prepped_rightleg = false
end

if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
m2prepped_leftleg = true else
m2prepped_leftleg = false
end
if lb[target].hits["left leg"] + mstar2damage &gt;= 99.9 and not tAffs.damagedleftleg then 
f2prepped_leftleg = true else
f2prepped_leftleg = false
end


--Priority of Limb
if mprepped_leftleg == false then
tarlimb = "left leg"
elseif mprepped_rightleg == false then
tarlimb = "right leg"
else
tarlimb = "torso"
end


--ATTACKKKKK
 
-- Bisect
if myinstantcath == true then
  atk = atk.. "touch shield"
elseif not tAffs.shield and use_bisect == true then
  atk = atk.. "sizeup " ..target.. ";wield bastard;bisect " ..target
-- Pulp
elseif not tAffs.shield and (tAffs.concussion or lb[target].hits["head"] &gt;= 200 or ataxiaTemp.fractures.skullfractures &gt;= 5) and tAffs.prone then
  atk = atk.. "wield left flail343168;wield right flail408566;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";sizeup " ..target.. ";pulp " ..target.. ";assess " ..target

--Raze
elseif tAffs.rebounding or tAffs.shield then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon track " ..target.. " ;falcon slay " ..target.. ";fracture " ..target.. "  ;assess " ..target.. ";sizeup " ..target

--Torso Damage
elseif tAffs.prone and ataxia.vitals.class == 1 and not tAffs.numbedrightarm then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " torso right arm expend;sizeup " ..target.. ";assess " ..target
elseif tAffs.prone and ataxia.vitals.class &gt;= 2 and not tAffs.numbedrightarm then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " torso expend right arm expend;sizeup " ..target.. ";assess " ..target
elseif tAffs.prone and ataxia.vitals.class &gt;= 3 then
  atk = atk.. "wield left flail343168;wield right flail408566;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";assault " ..target.. " torso;sizeup " ..target.. ";assess " ..target
elseif ataxia.vitals.class &gt;= 2 and ataxiaTemp.fractures.crackedribs &gt;= 1 then
  atk = atk.. "wield left flail343168;wield right flail408566;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " torso expend torso expend;sizeup " ..target.. ";assess " ..target
elseif ataxia.vitals.class &lt; 2 and ataxiaTemp.fractures.crackedribs &gt;= 1 then
  atk = atk.. "wield left flail343168;wield right flail408566;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target
elseif ataxia.vitals.class &lt; 2 and tAffs.prone then
  atk = atk.. "wield left flail343168;wield right flail408566;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " torso torso;sizeup " ..target.. ";assess " ..target

--Pre-Apply Counter
elseif tarpreapply == true then
  atk = atk.. "wield left flail343168;wield right flail408566;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " torso expend torso ;sizeup " ..target.. ";assess " ..target

-- Double Break
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif not ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and tAffs.numbedleftarm and ataxia.vitals.class == 8 then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " right leg expend left leg;sizeup " ..target.. ";assess " ..target
elseif ataxia.afflictions.clumsiness and mprepped_leftleg == true and mprepped_rightleg == true and ataxia.vitals.class == 8 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;discipline;doublewhirl " ..target.. " left leg expend right leg;sizeup " ..target.. ";assess " ..target

 


--Anti Parry
elseif not tAffs.numbedleftarm and ataxiaTemp.parriedLimb ~= "left arm" and ataxiaTemp.parriedLimb == "left leg" or ataxiaTemp.parriedLimb == "right leg" or ataxiaTemp.parriedLimb == "head" then
  if ataxia.vitals.class &lt; 1 then
    atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon track " ..target.. " ;falcon slay " ..target.. ";doublewhirl " ..target.. " right arm right arm;sizeup " ..target.. ";assess " ..target
 
  elseif ataxia.vitals.class &gt;= 2 then
    if ataxiaTemp.parriedLimb ~= "torso" then 
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " torso expend left arm expend;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_rightleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif m2prepped_head == true and mprepped_leftleg == false and mprepped_rightleg == false and mpreppedhead == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    elseif mprepped_leftleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend left leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_rightleg == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend right leg;sizeup " ..target.. ";assess " ..target
    elseif mprepped_head == false then
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend head;sizeup " ..target.. ";assess " ..target
    else 
      atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;falcon slay " ..target.. ";doublewhirl " ..target.. " left arm expend torso;sizeup " ..target.. ";assess " ..target
  
    end
  end

  
--One Prepped | Now the other
elseif m2prepped_rightleg == true and mprepped_rightleg == false and mprepped_leftleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left arm right leg;assess " ..target
elseif m2prepped_rightleg == true and mprepped_rightleg == false and mprepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg right leg;assess " ..target

  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg right leg;assess " ..target
  --if doublewhirl on left leg is going to break than do one whirl and hit another limb
elseif m2prepped_leftleg == true and mprepped_leftleg == false and mprepped_rightleg == true then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;sizeup " ..target.. ";doublewhirl " ..target.. " left leg left arm;assess " ..target


-- Prep
elseif mprepped_leftleg == false and m2prepped_leftleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " left leg left leg;sizeup " ..target.. ";assess " ..target

elseif mprepped_rightleg == false and m2prepped_rightleg == false then
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " right leg right leg;sizeup " ..target.. ";assess " ..target

else
  atk = atk.. "wield left morningstar511732;wield right morningstar511735;empower priority set isaz tiwaz wunjo;doublewhirl " ..target.. " ;sizeup " ..target.. ";assess " ..target

end
  

if table.contains(ataxia.playersHere, target) then
	if not engaged then
		send("queue addclear freestand " ..atk.. ";engage " ..target)
	else
	send("queue addclear freestand " ..atk)
	end
else
expandAlias("nt")
send("queue addclear freestand " ..atk)
end
end

</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>BARD</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="no" isFolder="no">
										<name>VENOM PRIOS LIMB</name>
										<packageName></packageName>
										<script>function bardvenomprioslimb()
getLockingAffliction()
bardvenom = {}
bardsong = {}

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
		softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
		hardlock = true
   hardlock = false
  end
	
if tAffs.asthma and checkAffList({"healthleech", "weariness", "sensitivity", "clumsiness", "hypochondria", "parasite", "rebbies"},3) then
		kelpstack = true
  else
  kelpstack = false

	end
if checkAffList({"addiction", "nausea", "lethargy", "scytherus", "darkshade", "haemophilia", "flushings", "unweavingbody"},3) then
		ginstack = true
  else
  ginstack = false

	end
  
if checkAffList({"impatience", "stupidity", "epilepsy", "vertigo", "confusion", "dizziness", "paranoia", "claustrophobia", "agoraphobia", "paranoia", "dementia"},3) then
		mentalstack = true
  else
  mentalstack = false

	end

	if hardlock and haveAff("paralysis") then
		truelock = true
 truelock = false
	
	end

 if tAffs.rebounding and tAffs.shield then
        table.insert(bardsong,"cantata")
end


if truelock and not tAffs.voyria  then

    table.insert(bardvenom,"voyria")
end



--if not tAffs.paralysis and tBals.tree and not softlock and ataxia.vitals.voice == "No" and bardsong[1] ~= "recite epic" then
 --   table.insert(bardvenom,"curare")
--end

--if not tAffs.paralysis and hardlock and ataxia.vitals.voice == "No" and bardsong[1] ~= "recite epic" then
 --   table.insert(bardvenom,"curare")
 --   end
  
if not tAffs.paralysis and not tAffs.asthma and not tAffs.slickness and not mentalstack and not kelpstack and not softlock then
       table.insert(bardvenom,"curare")
end

if not tAffs.paralysis and softlock and tBals.tree == true then

       table.insert(bardvenom,"curare")
end

if not tAffs.paralysis and hardlock then

       table.insert(bardvenom,"curare")
end

if not tAffs.anorexia and tAffs.slickness and tAffs.asthma then
  table.insert(bardvenom,"slike")
      table.insert(bardsong,"sing qasida")
      end

if tAffs.asthma and not tAffs.slickness and tAffs.impatience then 
  table.insert(bardvenom,"gecko")
    
  end
  if not tAffs.impatience then
    table.insert(bardsong,"sing limerick")
end



if not tAffs.weariness and bardvenom[1] ~= "curare" then
    table.insert(bardvenom,"vernalius")
end

if not tAffs.asthma then
    table.insert(bardvenom,"kalmia")
end



if not tAffs.sensitivity then
          table.insert(bardvenom,"prefarar")

end



if not tAffs.clumsiness then
          table.insert(bardvenom,"xentio")

     table.insert(bardsong,"sing maqam")
end












if not tAffs.vertigo and (tAffs.impatience or tBals.focus == false) then
     table.insert(bardsong,"sing pastorale")

end

if not tAffs.confusion and (tAffs.impatience or tBals.focus == false) then
     table.insert(bardsong,"recite haiku")

end

if not tAffs.epilepsy and (tAffs.impatience or tBals.focus == false) then
     table.insert(bardsong,"sing ditty")

end

if not tAffs.stupidity and (tAffs.impatience or tBals.focus == false) then
        table.insert(bardsong,"sing passion")

end






if not tAffs.recklessness then
    table.insert(bardvenom,"eurypteria")
    
end

if not tAffs.shyness then
    table.insert(bardvenom,"digitalis")
    
end




if not tAffs.dizziness then
    table.insert(bardvenom,"larkspur")
end






    







if not tAffs.addiction and tAffs.impatience and tAffs.clumsiness then
    table.insert(bardvenom,"vardrax")
     table.insert(bardsong,"recite ode")
end

if not tAffs.nausea and tAffs.impatience and tAffs.clumsiness then
    table.insert(bardvenom,"euphorbia")
     table.insert(bardsong,"recite poem")
end










bardlimbattack()
end


</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>VOICECRAFT PRIOS</name>
										<packageName></packageName>
										<script>function bardvoiceprios()
getLockingAffliction()
bardsong = {}

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
	local	hardlock = true
   hardlock = false
  end
	
if checkAffList({"healthleech", "asthma", "weariness", "sensitivity", "clumsiness", "hypochondria", "parasite", "rebbies"},3) then
		kelpstack = true
  else
  kelpstack = false

	end
if checkAffList({"addiction", "nausea", "lethargy", "scytherus", "darkshade", "haemophilia", "flushings", "unweavingbody"},3) then
		ginstack = true
  else
  ginstack = false

	end

	if hardlock and haveAff("paralysis") then
	local	truelock = true
 truelock = false
	
	end


if truelock and not tAffs.voyria  then

    table.insert(bardsong,"recite epic")
end

if tAffs.slickness and not tAffs.anorexia and tAffs.impatience then
    table.insert(curses,"anorexia")
end


if not tAffs.paralysis and bardvenom[1] ~= "curare" then
    table.insert(bardsong,"recite epic")
end




if not tAffs.clumsiness and ataxiaTemp.relapseAff ~= "clumsiness" then
    table.insert(curses,"clumsy")
end

if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end

if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end



if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end










if getLockingAffliction() ~= "confusion" and getLockingAffliction() ~= "weariness" and getLockingAffliction() ~= "plague" and
 not tAffs[getLockingAffliction()] and ataxiaTemp.relapseAff ~= getLockingAffliction()
then    table.insert(curses,getLockingAffliction())
end

if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end



if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end



if not tAffs.dizziness  and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.dementia  and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo  and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end



if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end



if not tAffs.masochism and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end







if swiftness == false then
attack()
elseif swiftness == true then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>ATTACK</name>
										<packageName></packageName>
										<script>function bardattack() 
local atk = combatQueue()
tune = "pesante"
targetlimb = ""



if not tAffs.paralysis and not tAffs.prone and kelpstack and not tAffs.slickness then targetlimb = "" tune = "martellato" bardvenom[1] = "gecko" bardsong[1] = "recite epic" end
if bardvenom[1] == "gecko" then tune = "martellato" end


if not tAffs.shield and tAffs.slickness and not tAffs.anorexia and kelpstack and not tAffs.impatience and ((not tBals.tree) or (tAffs.paralysis)) then
tune = "acciaccatura"
bardvenom[1] = "slike"
bardsong[1] = "sing limerick"



need_sync = true
else
need_sync = false
end

if not tAffs.shield and not haveAff("anorexia") and not tAffs.slickness and kelpstack and not tBals.tree and haveAff("impatience") then
tune = "acciaccatura"
bardvenom[1] = "gecko"
bardsong[1] = "sing qasida"


need_sync2 = true
else
need_sync2 = false
end


if tAffs.prone and not tAffs.brokenrightleg then targetlimb = "right leg" tune = "acciaccatura" end
if tAffs.prone and not tAffs.brokenleftleg then targetlimb = "left leg" tune = "acciaccatura" end
if tAffs.prone and not tAffs.brokenrightarm then targetlimb = "right arm" tune = "acciaccatura" end
if tAffs.prone and not tAffs.brokenleftarm then targetlimb = "left arm" tune = "acciaccatura" end







if  mentalstack then
tune = "accentato"
targetlimb = ""
end

if tAffs.deafness then 
tune = "pesante"
end



if tAffs.rebounding or tAffs.shield then

if not tAffs.paralysis then
bardsong[1] = "recite epic" end

atk = atk.."wield rapier shield;tunesmith rapier "..tune..";raze "..target..";assess "..target



else

atk = atk.."wield rapier shield;tunesmith rapier "..tune..";jab "..target.." "..targetlimb.." "..bardvenom[1]..";assess "..target
catk = bardsong[1].." at "..target

end

if ataxia.defences.songbird and ataxia.defences.songbird == true  then
not_need_bird = true
else not_need_bird = false
end

if ataxia.afflictions.prone and not tAffs.paralysis then bardsong[1] = "recite epic" end

if ataxia.afflictions.brokenrightarm and ataxia.afflictions.brokenleftarm and  not tAffs.paralysis then bardsong[1] = "recite epic" end



if tAffs.shield and not tAffs.paralysis then bardsong[1] = "recite epic" end

if bardHarmsInRoom and not not_need_bird  then atk = atk..ataxia.settings.separator.."whistle for songbird" end


   if ataxiaTemp.needSymphony and bardHarmsInRoom then
      atk = atk.."wield "..ataxia.bardStuff.instrument.." shield"..ataxia.settings.separator.."play symphony"
   elseif not bardHarmsInRoom and not attemptedHarmsRecall then
         attemptedHarmsRecall = tempTimer(1, [[ attemptedHarmsRecall = nil ]])
         atk = atk..ataxia.settings.separator.."call harmonics"
      end

if table.contains(ataxia.playersHere, target) then




if needwipe and (not need_sync) and (not need_sync2)  then

send("queue addclear freestand wipe rapier;"..atk)
if not tAffs.deafness then
send("queue addclear class "..catk)
end

elseif need_sync  then
send("cq all")
send("queue addclear full "..atk..";"..catk)


elseif need_sync2  then
send("cq all")
send("queue addclear full "..catk..";"..atk)





elseif (not need_sync) and (not need_sync2) and not needwipe then


send("queue addclear freestand "..atk)
if not tAffs.deafness then
send("queue addclear class "..catk)
end
end
end

end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SOFTATTACK</name>
										<packageName></packageName>
										<script>function bardattacksoft() 
local atk = combatQueue()
tune = "pesante"
targetlimb = ""

if ((bardvenom[1] == "kalmia") or (tAffs.asthma)) and not tAffs.paralysis and not tAffs.prone  and not mentalstack then bardsong[1] = "recite epic" elseif mentalstack and not tAffs.impatience then bardsong[1] = "sing limerick" end
--targetlimb = "left leg"
--if ataxiaTemp.parriedLimb == "left leg" then targetlimb = "right leg" elseif ataxiaTemp.parriedLimb == "right leg" then targetlimb = "left leg" end


--if tAffs.impatience and tAffs.asthma and mentalstack then need_order = true else need_order = false end

if not tAffs.prone and kelpstack and not tAffs.slickness then targetlimb = "" tune = "martellato" bardvenom[1] = "gecko" bardsong[1] = "recite epic" end



if mentalstack and not tAffs.anorexia and ((not tBals.tree) or (tAffs.paralysis)) then
tune = "acciaccatura"
bardvenom[1] = "gecko"
bardsong[1] = "sing qasida"
targetlimb = "left arm"

need_sync = true
else
need_sync = false
end

if not haveAff("anorexia") and not tAffs.slickness and kelpstack and not tBals.tree and haveAff("impatience") then
tune = "acciaccatura"
bardvenom[1] = "gecko"
bardsong[1] = "sing qasida"
targetlimb = "right arm"

need_sync2 = true
else
need_sync2 = false
end

if not tAffs.prone and bardsong[1] == "recite epic" and bardvenom[1] == "curare" then bardvenom[1] = bardvenom[2] end

if tAffs.prone and not tAffs.brokenrightleg then targetlimb = "right leg" tune = "acciaccatura" end
if tAffs.prone and not tAffs.brokenleftleg then targetlimb = "left leg" tune = "acciaccatura" end
if tAffs.prone and not tAffs.brokenrightarm then targetlimb = "right arm" tune = "acciaccatura" end
if tAffs.prone and not tAffs.brokenleftarm then targetlimb = "left arm" tune = "acciaccatura" end


if hardlock and not truelock then bardvenom[1] = "curare" bardsong[1] = "recite epic" end





if  mentalstack then
tune = "accentato"
targetlimb = ""
end

if tAffs.deafness then 
tune = "pesante"
end



if tAffs.rebounding then


atk = atk.."wield rapier shield;tunesmith rapier "..tune..";raze "..target..";assess "..target

elseif tAffs.shield and not tAffs.rebounding then

atk = atk.."wield rapier shield;tunesmith rapier "..tune..";raze "..target..";assess "..target



else

atk = atk.."wield rapier shield;tunesmith rapier "..tune..";jab "..target.." "..targetlimb.." "..bardvenom[1]..";assess "..target
catk = bardsong[1].." at "..target

end


   if ataxiaTemp.needSymphony and bardHarmsInRoom then
      atk = atk.."wield "..ataxia.bardStuff.instrument.." shield"..ataxia.settings.separator.."play symphony"
   elseif not bardHarmsInRoom and not attemptedHarmsRecall then
         attemptedHarmsRecall = tempTimer(1, [[ attemptedHarmsRecall = nil ]])
         atk = atk..ataxia.settings.separator.."call harmonics"
      end

--send("setalias kickass "..atk)
--send("setalias kickassclass "..catk)
if table.contains(ataxia.playersHere, target) then




if needwipe and (not need_sync) and (not need_sync2)  then

send("queue addclear freestand wipe rapier;"..atk)
if not tAffs.deafness then
send("queue addclear class "..catk)
end

elseif need_sync  then
send("cq all")
send("queue addclear full "..atk..";"..catk)


elseif need_sync2  then
send("cq all")
send("queue addclear full "..catk..";"..atk)



--elseif need_order then

--send("queue addclear freestand order "..target.." apply restoration to torso;"..atk)
--if not tAffs.deafness then
--send("queue addclear class "..catk)
--end

elseif (not need_sync) and (not need_sync2) and not needwipe then


send("queue addclear freestand "..atk)
if not tAffs.deafness then
send("queue addclear class "..catk)
end
end
end

end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>LIMBATTACK</name>
										<packageName></packageName>
										<script>function bardlimbattack() 
local atk = combatQueue()
targetlimb = targetlimb or "" 
almostrebound = almostrebound or false
if ataxiaTables.limbData.bardRapier == 60 then ataxiaTables.limbData.bardRapier = 8 end
if tLimbs.LL + ataxiaTables.limbData.bardRapier &gt;= 101 and tLimbs.LL &lt; 101 then LL_prep = true else LL_prep = false end
if tLimbs.RL + ataxiaTables.limbData.bardRapier &gt;= 101 and tLimbs.RL &lt; 101 then RL_prep = true else RL_prep = false end

tune = "pesante"

if tAffs.prone then tune = "acciaccatura" end

if not tAffs.prone and kelpstack and not tAffs.slickness then targetlimb = "" tune = "martellato" bardvenom[1] = "gecko" bardsong[1] = "recite epic" end


if not  LL_prep and not haveAff("rebounding") and not haveAff("shield") and tLimbs.LL &lt;= 40 and ataxiaTemp.parriedLimb == "right leg" then targetlimb = "left leg" tune = "acciaccatura" bardvenom[1] = "prefarar" bardsong[1] = "sing tremolo" need_sync = true else need_sync = false end
if not  RL_prep and not haveAff("rebounding") and not haveAff("shield") and tLimbs.RL &lt;= 40 and ataxiaTemp.parriedLimb == "left leg" then targetlimb = "right leg" tune = "acciaccatura" bardvenom[1] = "prefarar" bardsong[1] = "sing tremolo" need_sync5 = true else need_sync5 = false end



if  not haveAff("rebounding") and not haveAff("shield") and not LL_prep and ataxiaTemp.parriedLimb == "left leg" and tLimbs.LL &gt;= 40 then bardsong[1] = "recite epic" tune = "pesante" targetlimb = "left leg" need_sync4 = true else need_sync4 = false end
if  not haveAff("rebounding") and not haveAff("shield") and not RL_prep and ataxiaTemp.parriedLimb == "right leg" and tLimbs.RL &gt;= 40 then bardsong[1] = "recite epic" tune = "pesante" targetlimb = "right leg" need_sync6 = true else need_sync6 = false end

if not LL_prep and ataxiaTemp.parriedLimb == "right leg" then targetlimb = "left leg" 
elseif ataxiaTemp.parriedLimb == "left leg" and not RL_prep then targetlimb = "right leg" elseif LL_prep and RL_prep then targetlimb = "" end


if tAffs.prone  and tAffs.weariness and not haveAff("rebounding") and not haveAff("shield") and LL_prep then tune = "pesante" targetlimb = "left leg"  end
if tAffs.prone  and  tAffs.weariness and not haveAff("rebounding") and not haveAff("shield") and RL_prep then tune = "pesante" targetlimb = "right leg"  end

if tAffs.prone and not tAffs.anorexia and not tBals.salve and not haveAff("rebounding") and not haveAff("shield") and tLimbs.LL &gt;= 101 then bardsong[1] = "sing limerick" bardvenom[1] = "slike" targetlimb = "right leg" tune = "acciaccatura" need_sync2 = true else need_sync2 = false end
if tAffs.prone  and not tAffs.anoreixa and not tBals.salve and not haveAff("rebounding") and not haveAff("shield") and tLimbs.RL &gt;= 101 then bardsong[1] = "sing limerick" bardvenom[1] = "slike"  targetlimb = "left leg" tune = "acciaccatura" need_sync7 = true else need_sync7 = false end


if not tAffs.prone and bardsong[1] == "recite epic" and bardvenom[1] == "curare" then bardvenom[1] = bardvenom[2] end

if not tAffs.prone and kelpstack and not tAffs.slickness and LL_prep and RL_prep then targetlimb = "left leg" tune = "martellato" bardvenom[1] = "gecko" bardsong[1] = "recite epic" end


if (need_sync2 or need_sync7) and bardsong[1] == "sing qasida" then bardsong[1] = bardsong[2] end


if tAffs.prone and targetlimb == "" and not tAffs.brokenrightarm then targetlimb = "right arm" tune = "acciaccatura"  end
if tAffs.prone and targetlimb == "" and not tAffs.brokenleftarm  then targetlimb = "left arm" tune = "acciaccatura" end
if tAffs.prone and targetlimb == "" and not tAffs.brokenleftleg then targetlimb = "left leg" tune = "acciaccatura" end
if tAffs.prone and targetlimb == "" and not  tAffs.brokenrightleg then targetlimb = "right leg" tune = "acciaccatura" end



--if tAffs.prone and tAffs.anorexia and tAffs.impatience and not tAffs.slickness and not tAffs.paralysis and tAffs.asthma then
--tune = "pesante"
--bardvenom[1] = "gecko"
--bardsong[1] = "recite epic"


--end

if hardlock and not truelock then bardvenom[1] = "curare" bardsong[1] = "recite epic" end




if not tAffs.deafness and mentalstack then
tune = "accentato"
targetlimb = ""
end




if tAffs.rebounding then

atk = atk.."wield rapier shield;tunesmith rapier "..tune..";raze "..target..";assess "..target

elseif tAffs.shield and not tAffs.rebounding then

atk = atk.."wield rapier shield;tunesmith rapier "..tune..";raze "..target..";assess "..target

elseif
bardsong[1] == "sing tremolo" then catk = bardsong[1].." at "..target.." "..targetlimb 
atk = atk.."wield rapier shield;tunesmith rapier "..tune..";jab "..target.." "..targetlimb.." "..bardvenom[1]..";assess "..target



else

atk = atk.."wield rapier shield;tunesmith rapier "..tune..";jab "..target.." "..targetlimb.." "..bardvenom[1]..";assess "..target
catk = bardsong[1].." at "..target

end

--send("setalias kickass "..atk)
--send("setalias kickassclass "..catk)



if needwipe and (not need_sync) and (not need_sync2) and (not need_sync3) and (not need_sync4) and (not need_sync5) and (not need_sync6) and (not need_sync7) then

send("queue addclear freestand wipe rapier;"..atk)
if not tAffs.deafness then
send("queue addclear class "..catk)
end
elseif (need_sync or need_sync3 or need_sync5 or need_sync2 or need_sync7) then
send("cq all")
send("queue addclear full "..atk..";"..catk..";whistle for songbird")


elseif ( need_sync4 or need_sync6) then
send("cq all")
send("queue addclear full "..catk..";"..atk..";whistle for songbird")


--elseif need_order then

--send("queue addclear freestand order "..target.." apply restoration to torso;"..atk)
--if not tAffs.deafness then
--send("queue addclear class "..catk)
--end

elseif (not need_sync) and (not need_sync2) and (not need_sync3) and (not need_sync4) and (not need_sync5) and (not need_sync6) and (not need_sync7) and not needwipe then
   if ataxiaTemp.needSymphony and bardHarmsInRoom then
      atk = atk.."wield "..ataxia.bardStuff.instrument.." shield"..ataxia.settings.separator.."play symphony"
   elseif not bardHarmsInRoom and not attemptedHarmsRecall then
         attemptedHarmsRecall = tempTimer(1, [[ attemptedHarmsRecall = nil ]])
         atk = atk..ataxia.settings.separator.."call harmonics"
      end

send("queue addclear freestand "..atk)

if not tAffs.deafness then
send("queue addclear class "..catk)
end


end



end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SINGATTACK</name>
										<packageName></packageName>
										<script>function singattack() 
local atk = combatQueue()
tune = tune or "pesante"
targetlimb = ""

if bardvenom[1] == "kalmia" and not tAffs.paralysis then  bardsong[1] = "recite epic" end
--targetlimb = "left leg"
--if ataxiaTemp.parriedLimb == "left leg" then targetlimb = "right leg" elseif ataxiaTemp.parriedLimb == "right leg" then targetlimb = "left leg" end


--if tAffs.impatience and tAffs.asthma and mentalstack then need_order = true else need_order = false end



if not tAffs.anorexia and ((tAffs.asthma and tAffs.weariness) or not tBals.salve) and tAffs.impatience then
--tune = "acciaccatura"
bardvenom[1] = "gecko"
bardsong[1] = "sing qasida"

need_sync = true
else
need_sync = false
end

if hardlock and not truelock then bardvenom[1] = "curare" bardsong[1] = "recite epic" end


if not tAffs.deafness and not tAffs.prone and mentalstack or tAffs.paralysis then
tune = "martellato"
else
tune = "pesante"

end

if not tAffs.deafness and ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 40 then
tune = "accentato"
targetlimb = ""
end

if tAffs.deafness then 
tune = "pesante"
end


if tAffs.rebounding then

atk = atk.."wield rapier shield;tunesmith rapier "..tune..";raze "..target..";assess "..target

elseif tAffs.shield and not tAffs.rebounding then

atk = atk.."wield rapier shield;tunesmith rapier "..tune..";raze "..target..";assess "..target



else

atk = atk.."wield rapier shield;tunesmith rapier "..tune..";jab "..target.." "..targetlimb.." "..bardvenom[1]..";assess "..target
catk = bardsong[1].." at "..target

end

--send("setalias kickass "..atk)
--send("setalias kickassclass "..catk)
if table.contains(ataxia.playersHere, target) then



if not (ataxia.afflictions.paralysis or ataxia.afflictions.stupidity) then


send("queue addclear class "..catk)


end

end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SINGPRIOS</name>
										<packageName></packageName>
										<script>function bardvenompriossing()
getLockingAffliction()
bardvenom = {}
bardsong = {}

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
		softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
		hardlock = true
   hardlock = false
  end
	
if checkAffList({"healthleech", "asthma", "weariness", "sensitivity", "clumsiness", "hypochondria", "parasite", "rebbies"},3) then
		kelpstack = true
  else
  kelpstack = false

	end
if checkAffList({"addiction", "nausea", "lethargy", "scytherus", "darkshade", "haemophilia", "flushings", "unweavingbody"},3) then
		ginstack = true
  else
  ginstack = false

	end
  
if checkAffList({"impatience", "stupidity", "epilepsy", "vertigo", "confusion", "dizziness", "paranoia", "claustrophobia", "agoraphobia", "paranoia", "dementia"},3) then
		mentalstack = true
  else
  mentalstack = false

	end

	if hardlock and haveAff("paralysis") then
	local	truelock = true
 truelock = false
	
	end

 


if truelock and not tAffs.voyria  then

    table.insert(bardvenom,"voyria")
end



--if not tAffs.paralysis and tBals.tree and not softlock and ataxia.vitals.voice == "No" and bardsong[1] ~= "recite epic" then
 --   table.insert(bardvenom,"curare")
--end

--if not tAffs.paralysis and hardlock and ataxia.vitals.voice == "No" and bardsong[1] ~= "recite epic" then
 --   table.insert(bardvenom,"curare")
 --   end
  
if not tAffs.paralysis and not tAffs.asthma and not tAffs.slickness and not mentalstack and not kelpstack and not softlock then
       table.insert(bardvenom,"curare")
end

if not tAffs.paralysis and softlock and tBals.tree == true then

       table.insert(bardvenom,"curare")
end

if not tAffs.paralysis and hardlock then

       table.insert(bardvenom,"curare")
end

if not tAffs.anorexia and tAffs.slickness and tAffs.asthma then
  table.insert(bardvenom,"slike")
      table.insert(bardsong,"sing qasida")
      end

if kelpstack and tAffs.asthma and not tAffs.slickness then 
  table.insert(bardvenom,"gecko")
    
  end

if (mentalstack or not kelpstack) and not tAffs.asthma then
    table.insert(bardvenom,"kalmia")
end

if not tAffs.clumsiness then
          table.insert(bardvenom,"xentio")

     table.insert(bardsong,"sing maqam")
end

if not tAffs.weariness and bardvenom[1] ~= "curare" then
    table.insert(bardvenom,"vernalius")
end

if not tAffs.sensitivity then
          table.insert(bardvenom,"prefarar")

end


if not tAffs.impatience then
    table.insert(bardsong,"sing limerick")
end



if not tAffs.confusion and (tAffs.impatience or tBals.focus == false) then
     table.insert(bardsong,"recite haiku")

end

if not tAffs.epilepsy and (tAffs.impatience or tBals.focus == false) then
     table.insert(bardsong,"sing ditty")

end

if not tAffs.vertigo and (tAffs.impatience or tBals.focus == false) then
     table.insert(bardsong,"sing pastorale")

end


if not tAffs.stupidity and (tAffs.impatience or tBals.focus == false) then
        table.insert(bardsong,"sing passion")

end




if tAffs.impatience then
if not tAffs.dizziness then
    table.insert(bardvenom,"larkspur")
end

if not tAffs.recklessness then
    table.insert(bardvenom,"eurypteria")
    
end

if not tAffs.shyness then
    table.insert(bardvenom,"digitalis")
    
end
end









    







if not tAffs.addiction then
    table.insert(bardvenom,"vardrax")
     table.insert(bardsong,"recite ode")
end

if not tAffs.nausea then
    table.insert(bardvenom,"euphorbia")
     table.insert(bardsong,"recite poem")
end







singattack()
end


</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>TEST PRIOS</name>
										<packageName></packageName>
										<script>function bardvenomprios()
getLockingAffliction()
bardvenom = {}
bardsong = {}

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
		softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
		hardlock = true
   hardlock = false
  end
	
if tAffs.asthma and checkAffList({"healthleech", "weariness", "sensitivity", "clumsiness", "hypochondria", "parasite", "rebbies"},2) then
		kelpstack = true
  else
  kelpstack = false

	end
if checkAffList({"addiction", "nausea", "lethargy", "scytherus", "darkshade", "haemophilia", "flushings", "unweavingbody"},3) then
		ginstack = true
  else
  ginstack = false

	end
  
if checkAffList({"impatience", "stupidity", "epilepsy", "vertigo", "confusion", "dizziness", "paranoia", "claustrophobia", "agoraphobia", "paranoia", "dementia"},4) then
		mentalstack = true
  else
  mentalstack = false

	end

	if hardlock and haveAff("paralysis") then
		truelock = true
 truelock = false
	
	end

 if tAffs.rebounding and tAffs.shield then
        table.insert(bardsong,"cantata")
end


if truelock and not tAffs.voyria  then

    table.insert(bardvenom,"voyria")
end





if not tAffs.paralysis and bardsong[1] == "sing limerick" then

       table.insert(bardvenom,"curare")
end

if not tAffs.paralysis and tAffs.impatience then

       table.insert(bardsong,"recite epic")
end



if not tAffs.anorexia and tAffs.slickness and tAffs.asthma and tAffs.impatience then
  table.insert(bardvenom,"slike")
      table.insert(bardsong,"sing qasida")
      end

if kelpstack and not tAffs.slickness and tAffs.impatience then 
  table.insert(bardvenom,"gecko")
    
  end
  
  if not tAffs.paralysis and bardsong[1] ~= "recite epic" then

       table.insert(bardvenom,"curare")
end
  
  if not tAffs.impatience then
    table.insert(bardsong,"sing limerick")
end



if not tAffs.stupidity and tAffs.impatience and tAffs.asthma then
    table.insert(bardvenom,"aconite")
    
end

if not tAffs.dizziness and tAffs.impatience and tAffs.asthma  then
    table.insert(bardvenom,"larkspur")
end


if not tAffs.recklessness and tAffs.impatience and tAffs.asthma   then
    table.insert(bardvenom,"eurypteria")
    
end

if not tAffs.sensitivity then
          table.insert(bardvenom,"prefarar")

end

if not tAffs.weariness then
    table.insert(bardvenom,"vernalius")
end


if not tAffs.asthma then
    table.insert(bardvenom,"kalmia")
end







if not tAffs.clumsiness then
          table.insert(bardvenom,"xentio")

     table.insert(bardsong,"sing maqam")
end




















if not tAffs.shyness and tAffs.impatience  then
    table.insert(bardvenom,"digitalis")
    
end

















if not tAffs.vertigo and (tAffs.impatience or tBals.focus == false) and tAffs.anorexia then
     table.insert(bardsong,"sing pastorale")

end

if not tAffs.confusion and (tAffs.impatience or tBals.focus == false) and tAffs.anorexia then
     table.insert(bardsong,"recite haiku")

end

if not tAffs.epilepsy and (tAffs.impatience or tBals.focus == false) and tAffs.anorexia then
     table.insert(bardsong,"sing ditty")

end

if not tAffs.stupidity and (tAffs.impatience or tBals.focus == false) and tAffs.anorexia then
        table.insert(bardsong,"sing passion")

end








    







if not tAffs.addiction and tAffs.impatience and tAffs.clumsiness then
    table.insert(bardvenom,"vardrax")
     table.insert(bardsong,"recite ode")
end

if not tAffs.nausea and tAffs.impatience and tAffs.clumsiness then
    table.insert(bardvenom,"euphorbia")
     table.insert(bardsong,"recite poem")
end







bardattack()
end


</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>TEST PRIOS SOFT</name>
										<packageName></packageName>
										<script>function bardvenompriossoft()
getLockingAffliction()
bardvenom = {}
bardsong = {}

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
		softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
		hardlock = true
   hardlock = false
  end
	
if tAffs.asthma and checkAffList({"healthleech", "weariness", "sensitivity", "clumsiness", "hypochondria", "parasite", "rebbies"},1) then
		kelpstack = true
  else
  kelpstack = false

	end
if checkAffList({"addiction", "nausea", "lethargy", "scytherus", "darkshade", "haemophilia", "flushings", "unweavingbody"},3) then
		ginstack = true
  else
  ginstack = false

	end
  
if checkAffList({"stupidity", "epilepsy", "anorexia", "vertigo", "confusion", "dizziness", "paranoia", "claustrophobia", "agoraphobia", "paranoia", "dementia"},1) then
		mentalstack = true
  else
  mentalstack = false

	end

	if hardlock and haveAff("paralysis") then
		truelock = true
 truelock = false
	
	end

 if tAffs.rebounding and tAffs.shield then
        table.insert(bardsong,"cantata")
end


if truelock and not tAffs.voyria  then

    table.insert(bardvenom,"voyria")
end



--if not tAffs.paralysis and tBals.tree and not softlock and ataxia.vitals.voice == "No" and bardsong[1] ~= "recite epic" then
 --   table.insert(bardvenom,"curare")
--end

--if not tAffs.paralysis and hardlock and ataxia.vitals.voice == "No" and bardsong[1] ~= "recite epic" then
 --   table.insert(bardvenom,"curare")
 --   end
  
if tAffs.asthma and not tAffs.paralysis and not tAffs.slickness and not mentalstack and not softlock then
       table.insert(bardvenom,"curare")

end

if not tAffs.paralysis and softlock and tBals.tree == true then

       table.insert(bardvenom,"curare")
end

if not tAffs.paralysis and hardlock then

       table.insert(bardvenom,"curare")
end

if not tAffs.anorexia and tAffs.slickness and tAffs.asthma and tAffs.impatience then
  table.insert(bardvenom,"slike")
      table.insert(bardsong,"sing qasida")
      end

if kelpstack and not tAffs.slickness and tAffs.impatience then 
  table.insert(bardvenom,"gecko")
    
  end
  
  
  if not tAffs.impatience then
    table.insert(bardsong,"sing limerick")
end

if not tAffs.asthma then
    table.insert(bardvenom,"kalmia")
end

if not tAffs.stupidity then
    table.insert(bardvenom,"aconite")
    
end


if not tAffs.recklessness then
    table.insert(bardvenom,"eurypteria")
    
end

if not tAffs.shyness then
    table.insert(bardvenom,"digitalis")
    
end




if not tAffs.dizziness then
    table.insert(bardvenom,"larkspur")
end





if not tAffs.weariness and bardvenom[1] ~= "curare" then
    table.insert(bardvenom,"vernalius")
end


if not tAffs.vertigo and (tAffs.impatience or tBals.focus == false)  then
     table.insert(bardsong,"sing pastorale")

end

if not tAffs.confusion and (tAffs.impatience or tBals.focus == false) then
     table.insert(bardsong,"recite haiku")

end

if not tAffs.epilepsy and (tAffs.impatience or tBals.focus == false) then
     table.insert(bardsong,"sing ditty")

end

if not tAffs.stupidity and (tAffs.impatience or tBals.focus == false) then
        table.insert(bardsong,"sing passion")

end



if not tAffs.clumsiness then
          table.insert(bardvenom,"xentio")

     table.insert(bardsong,"sing maqam")
end

if not tAffs.sensitivity then
          table.insert(bardvenom,"prefarar")

end




























    







if not tAffs.addiction and tAffs.impatience and tAffs.clumsiness then
    table.insert(bardvenom,"vardrax")
     table.insert(bardsong,"recite ode")
end

if not tAffs.nausea and tAffs.impatience and tAffs.clumsiness then
    table.insert(bardvenom,"euphorbia")
     table.insert(bardsong,"recite poem")
end







bardattacksoft()
end


</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>TEST LIMB PRIOS</name>
										<packageName></packageName>
										<script>function bardvenomprioslimb()
getLockingAffliction()
bardvenom = {}
bardsong = {}

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
		softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
		hardlock = true
   hardlock = false
  end
	
if tAffs.asthma and checkAffList({"healthleech", "weariness", "sensitivity", "hypochondria", "parasite", "rebbies"},1) then
		kelpstack = true
  else
  kelpstack = false

	end
if checkAffList({"addiction", "nausea", "lethargy", "scytherus", "darkshade", "haemophilia", "flushings", "unweavingbody"},3) then
		ginstack = true
  else
  ginstack = false

	end
  
if checkAffList({"impatience", "stupidity", "epilepsy", "vertigo", "confusion", "dizziness", "paranoia", "claustrophobia", "agoraphobia", "paranoia", "dementia"},4) then
		mentalstack = true
  else
  mentalstack = false

	end

	if hardlock and haveAff("paralysis") then
		truelock = true
 truelock = false
	
	end

 if tAffs.rebounding and tAffs.shield then
        table.insert(bardsong,"cantata")
end


if truelock and not tAffs.voyria  then

    table.insert(bardvenom,"voyria")
end



--if not tAffs.paralysis and tBals.tree and not softlock and ataxia.vitals.voice == "No" and bardsong[1] ~= "recite epic" then
 --   table.insert(bardvenom,"curare")
--end

--if not tAffs.paralysis and hardlock and ataxia.vitals.voice == "No" and bardsong[1] ~= "recite epic" then
 --   table.insert(bardvenom,"curare")
 --   end
  
if tAffs.asthma and not tAffs.paralysis and not tAffs.slickness and not mentalstack and not softlock then
       table.insert(bardvenom,"curare")

end

if not tAffs.paralysis and softlock and tBals.tree == true then

       table.insert(bardvenom,"curare")
end

if not tAffs.paralysis and hardlock then

       table.insert(bardvenom,"curare")
end

if not tAffs.anorexia and tAffs.slickness and tAffs.impatience then
  table.insert(bardvenom,"slike")
      table.insert(bardsong,"sing qasida")
      end



  if not tAffs.impatience then
    table.insert(bardsong,"sing limerick")
end
if kelpstack and not tAffs.slickness and tAffs.impatience then 
  table.insert(bardvenom,"gecko")
    
  end


if not tAffs.asthma then
    table.insert(bardvenom,"kalmia")
end

if not tAffs.weariness and bardvenom[1] ~= "curare" then
    table.insert(bardvenom,"vernalius")
end

if not tAffs.clumsiness then
          table.insert(bardvenom,"xentio")

end

if not tAffs.sensitivity then
          table.insert(bardvenom,"prefarar")

end
























if not tAffs.vertigo and (tAffs.impatience or tBals.focus == false) and tAffs.anorexia then
     table.insert(bardsong,"sing pastorale")

end

if not tAffs.confusion and (tAffs.impatience or tBals.focus == false) and tAffs.anorexia then
     table.insert(bardsong,"recite haiku")

end

if not tAffs.epilepsy and (tAffs.impatience or tBals.focus == false) and tAffs.anorexia then
     table.insert(bardsong,"sing ditty")

end

if not tAffs.stupidity and (tAffs.impatience or tBals.focus == false) and tAffs.anorexia then
        table.insert(bardsong,"sing passion")

end



if not tAffs.stupidity then
    table.insert(bardvenom,"aconite")
    
end


if not tAffs.recklessness then
    table.insert(bardvenom,"eurypteria")
    
end

if not tAffs.shyness then
    table.insert(bardvenom,"digitalis")
    
end




if not tAffs.dizziness then
    table.insert(bardvenom,"larkspur")
end






    







if not tAffs.addiction and tAffs.impatience and tAffs.clumsiness then
    table.insert(bardvenom,"vardrax")
     table.insert(bardsong,"recite ode")
end

if not tAffs.nausea and tAffs.impatience and tAffs.clumsiness then
    table.insert(bardvenom,"euphorbia")
     table.insert(bardsong,"recite poem")
end








bardlimbattack()
end


</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Blademaster</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Logic</name>
										<packageName></packageName>
										<script>tstrike = tstrike or ""
tmounted = tmounted or false
timpaleslash = false
tparrying = tparrying or "none"

function getshinn()

-- mykaii = tonumber(string.match(gmcp.Char.Vitals.charstats[3],"Kai\: (%d+)"))
bmshin = tonumber(gmcp.Char.Vitals.charstats[3]:match("(%d+)"))

end

function tbleeding()
  tAffs.bleed = 0
end

function bmstriking()

if not tAffs.hamstring then
tstrike = "hamstring"
  end
if tmounted == true then
tstrike = "feet"
  end
if tmounted == false then
  tstrike = "knees"
  end  
if not tAffs.paralysis then
tstrike = "neck"
  end
bm_attack()
end

function bmstriking2()

if not tAffs.hamstring then
tstrike = "hamstring"
  end
if tmounted == true then
tstrike = "feet"
  end
if tmounted == false then
  tstrike = "knees"
  end  
if not tAffs.paralysis then
tstrike = "neck"
  end
bm_attackjew()
end


function bmstriking4()

if not tAffs.hamstring then
tstrike = "hamstring"
 
elseif not tAffs.airfist and ataxia.vitals.class &gt;= 20 then
tstrike = "airfist" 

elseif tmounted == true then
tstrike = "feet"

elseif tAffs.paralysis and tAffs.hypochondria and not tAffs.asthma then
tstrike = "throat"

elseif tAffs.paralysis and not tAffs.hypochondria then
tstrike = "chest"

elseif not tAffs.paralysis then
tstrike = "neck"

  end
end

function bmgrouplock()
getLockingAffliction()
checkTargetLocks()

if not tAffs.hamstring then
  tstrike = "hamstring"
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.anorexia and tAffs.weariness and tAffs.recklessness then
	tstrike = "eyes"
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and tAffs.anorexia and tAffs.weariness and not tAffs.recklessness then
  tstrike = "groin"
elseif tAffs.slickness and tAffs.asthma and tAffs.anorexia and not tAffs.impatience then
	tstrike = "chest"
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness then
  tstrike = "underarm"
elseif tAffs.asthma and tAffs.impatience and tAffs.slickness and not tAffs.anorexia then
  tstrike = "stomach"
elseif tAffs.slickness and tAffs.asthma then
  tstrike = "eyes"
elseif tAffs.prone and not tAffs.slickness and tAffs.asthma then
  tstrike = "underarm"
elseif not tAffs.slickness and tAffs.asthma and tAffs.paralysis then
	tstrike = "underarm"
elseif not tAffs.paralysis then
  tstrike = "neck"
elseif not tAffs.hypochondria then
  tstrike = "chest"
elseif not tAffs.asthma then
	tstrike = "throat"
elseif not tAffs.weariness then
  tstrike = "vernalius"

  end


end


function levibmtruelock()
if not tAffs.hamstring then
  tstrike = "hamstring"
elseif not tAffs.airfist and ataxia.vitals.class &gt;= 20 then
  tstrike = "airfist" 
elseif truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    tstrike = "neck"
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    tstrike = "shoulder"
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    tstrike = "eyes"
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    tstrike = "temple"
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    tstrike = "groin"
  end
elseif hardlock == true and not tAffs.paralysis then
  tstrike = "neck"
elseif softlock == true and not tAffs.paralysis then
  tstrike = "neck"
elseif softlock == true and tAffs.paralysis and not tAffs.impatience then
  tstrike = "chest"
elseif tAffs.asthma and tAffs.impatience and tAffs.slickness and not tAffs.anorexia then
  tstrike = "stomach"
elseif tAffs.asthma and tAffs.impatience and not tAffs.slickness then
  tstrike = "underarm"
elseif not tAffs.paralysis then
  tstrike = "neck"
elseif tAffs.paralysis then
  if tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
    tstrike = "stomach"
  elseif tAffs.slickness and tAffs.asthma and not tAffs.impatience then
    tstrike = "chest"
  elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience then
    tstrike = "underarm"
  elseif not tAffs.slickness and tAffs.asthma then
    tstrike = "underarm"
  elseif tAffs.asthma and not tAffs.impatience then
    tstrike = "chest"
  elseif not tAffs.asthma then
    tstrike = "throat"
  elseif not tAffs.weariness then
    tstrike = "shoulder"
  end
end
end
</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Attack</name>
										<packageName></packageName>
										<script>function bm_attack()
attk = attk or ""
tside = tside or ""

if tparrying == false then

attk = "centreslash"
tside = "up"
  end

if tparrying == "head" then
attk = "legslash"
tside = "left"
  end
  
if tparrying == "torso" then
attk = "legslash"
tside = "left"
  end  
  
if tparrying == "left leg" then
attk = "legslash"
tside = "right"
  end

if tparrying == "right leg" then
attk = "legslash"
tside = "left"
  end
  
if tparrying == "left leg" then
attk = "legslash"
tside = "right"
  end
  
if (tAffs.bleed == nil or tAffs.bleed == false) then tAffs.bleed = 0 end


--BrokenStar or Bladetwist or Impaleslash or Impale

if ataxiaNDB.players[target].city == "Mhaldor" and (tAffs.bleed &gt;= 600) then
send("say BrokenStarrrrrrr")
end
if ataxiaNDB.players[target].city ~= "Mhaldor" and (tAffs.bleed &gt;= 600) then
send("queue addclear free withdraw blade;sheathe sword;brokenstar " ..target)
end
if tAffs.impaled and timpaleslash == true then
send("queue addclear free assess "..target..";bladetwist;discern " ..target)
end

if tAffs.impaled and timpaleslash == false then
send("queue addclear free assess "..target..";impaleslash")
end

if tAffs.paralysis and not tAffs.impaled then
send("queue addclear free assess "..target..";impale " ..target)
end


--Rebounding or Shield and Hamstring
if tAffs.rebounding and not tAffs.hamstring then
send("queue addclear free assess "..target..";parry " ..ataxia.parrying.shouldparry.. ";raze " ..target.. " hamstring; assess " ..target)
end
if tAffs.shield and not tAffs.hamstring then
send("queue addclear free assess "..target..";parry " ..ataxia.parrying.shouldparry.. ";raze " ..target.. " hamstring; assess " ..target)
end
if tAffs.rebounding and tAffs.hamstring then
send("queue addclear free assess "..target..";parry " ..ataxia.parrying.shouldparry.. ";raze " ..target.. " throat; assess " ..target)
end

if tAffs.shield and tAffs.hamstring then
send("queue addclear free assess "..target..";parry " ..ataxia.parrying.shouldparry.. ";raze " ..target.. " " ..tstrike.. " ;assess " ..target)
end

if not tAffs.impaled and tAffs.clumsiness then
send("queue addclear free infuse ice;parry " ..ataxia.parrying.shouldparry.. ";assess "..target.. ";" ..attk.. " " ..target.. " " ..tside.. " " ..tstrike.. " ;assess " ..target)
end

if not tAffs.impaled and not tAffs.clumsiness then
send("queue addclear free infuse lightning;parry " ..ataxia.parrying.shouldparry.. ";assess "..target..";" ..attk.. " " ..target.. " " ..tside.. " " ..tstrike.. " ;assess " ..target)
  end
  


end










</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>BrokenStar</name>
										<packageName></packageName>
										<script>--17.0/11.3
function bm_brokenstarroute()
bmstriking4()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
else
  treelock = false
end



ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
bmslash1 = ataxiaTables.limbData.bmSlash
bmslash2 = ataxiaTables.limbData.bmOffSlash
bmcslash = ataxiaTables.limbData.bmCompass
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"

if lb[target].hits["head"] + bmslash1 &gt;= 100 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end



if lb[target].hits["torso"] + bmslash1 &gt;= 100 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end


if lb[target].hits["left leg"] + bmslash1 &gt;= 100 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end


if lb[target].hits["right leg"] + bmslash1 &gt;= 100 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end


if lb[target].hits["right arm"] + bmslash1 &gt;= 100 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end


if lb[target].hits["left arm"] + bmslash1 &gt;= 100 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end




if ataxiaNDB.players[target].city == "Mhaldor" and tAffs.bleed &gt;= 700 then
send("say BrokenStarrrrrrr")

elseif ataxiaNDB.players[target].city ~= "Mhaldor" and tAffs.bleed &gt;= 700 then
atk = atk.. "withdraw blade;sheathe sword;brokenstar " ..target

elseif tAffs.impaled and timpaleslash == true then
atk = atk.."bladetwist;assess "..target..";discern " ..target

elseif tAffs.impaled and timpaleslash == false then
atk = atk.. " assess "..target..";impaleslash"


elseif tAffs.prone and lb[target].hits["left leg"] &gt;= 100 or tAffs.damagedleftleg and lb[target].hits["right leg"] &gt;= 100 or tAffs.damagedrightleg and not tAffs.impaled then
atk = atk.. " assess "..target..";impale " ..target

elseif tAffs.prone and lb[target].hits["left leg"] &gt;= 100 or tAffs.damagedleftleg or lb[target].hits["right leg"] &gt;= 100 or tAffs.damagedrightleg and not tAffs.impaled then
atk = atk.. " assess "..target..";impale " ..target



--Prep
elseif tAffs.paralysis or tAffs.prone and timpaleslash == false then
  atk = atk.. " assess "..target..";impale " ..target

elseif mprepped_rightleg and mprepped_leftleg and lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and timpaleslash == false then
  atk = atk.. " infuse lightning;assess "..target.. ";pommelstrike " ..target.. " neck;assess " ..target
   

elseif timpaleslash == true then
  if not tAffs.clumsiness then
    if lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and tmounted == true then 
      atk = atk.. " infuse lightning;assess "..target.. ";pommelstrike " ..target.. " left knees;assess " ..target
    elseif lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted then 
      atk = atk.. " infuse lightning;assess "..target.. ";legslash " ..target.. " left knees;assess " ..target
    elseif lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted then 
      atk = atk.. " infuse lightning;assess "..target.. ";legslash " ..target.. " right knees;assess " ..target
    elseif mprepped_rightleg and mprepped_leftleg and mprepped_torso and ataxiaTemp.parriedLimb ~= "torso" or tAffs.airfisted then
      atk = atk.. " infuse lightning;assess "..target.. ";centreslash " ..target.. " up " ..tstrike.. ";assess " ..target
    elseif mprepped_rightleg and not mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted then
      atk = atk.. " infuse lightning;assess "..target.. ";compassslash " ..target.. " southeast " ..tstrike.. ";assess " ..target
    elseif mprepped_leftleg and not mprepped_rightleg and mprepped_torso and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted then
      atk = atk.. " infuse lightning;assess "..target.. ";compassslash " ..target.. " southwest " ..tstrike.. ";assess " ..target
    elseif not mprepped_torso and ataxiaTemp.parriedLimb ~= "torso" or tAffs.airfisted then
      atk = atk.. " infuse lightning;assess "..target.. ";centreslash " ..target.. " up " ..tstrike.. ";assess " ..target
    elseif not mprepped_torso and ataxiaTemp.parriedLimb == "torso" and not tAffs.airfisted then
      atk = atk.. " infuse lightning;assess "..target.. ";centreslash " ..target.. " down " ..tstrike.. ";assess " ..target
    elseif not mprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted and not mprepped_leftleg then
      atk = atk.. " infuse lightning;assess "..target.. ";legslash " ..target.. " right " ..tstrike.. " ;assess " ..target
    elseif not mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted and not mprepped_leftleg then
      atk = atk.. " infuse lightning;assess "..target.. ";legslash " ..target.. " left " ..tstrike.. " ;assess " ..target
    else
      atk = atk.. " infuse lightning;assess "..target.. ";balanceslash " ..target.. " " ..tstrike.. " ;assess " ..target
    end
  
  elseif tAffs.clumsiness then
     if lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and tmounted == true then 
      atk = atk.. " infuse ice;assess "..target.. ";pommelstrike " ..target.. " left knees;assess " ..target
    elseif lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted then 
      atk = atk.. " infuse ice;assess "..target.. ";legslash " ..target.. " left knees;assess " ..target
    elseif lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted then 
      atk = atk.. " infuse ice;assess "..target.. ";legslash " ..target.. " right knees;assess " ..target
    elseif mprepped_rightleg and mprepped_leftleg and mprepped_torso and ataxiaTemp.parriedLimb ~= "torso" or tAffs.airfisted then
      atk = atk.. " infuse ice;assess "..target.. ";centreslash " ..target.. " up " ..tstrike.. ";assess " ..target
    elseif mprepped_rightleg and not mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted then
      atk = atk.. " infuse ice;assess "..target.. ";compassslash " ..target.. " southeast " ..tstrike.. ";assess " ..target
    elseif mprepped_leftleg and not mprepped_rightleg and mprepped_torso and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted then
      atk = atk.. " infuse ice;assess "..target.. ";compassslash " ..target.. " southwest " ..tstrike.. ";assess " ..target
    elseif not mprepped_torso and ataxiaTemp.parriedLimb ~= "torso" or tAffs.airfisted then
      atk = atk.. " infuse ice;assess "..target.. ";centreslash " ..target.. " up " ..tstrike.. ";assess " ..target
    elseif not mprepped_torso and ataxiaTemp.parriedLimb == "torso" or not tAffs.airfisted then
      atk = atk.. " infuse ice;assess "..target.. ";centreslash " ..target.. " down " ..tstrike.. ";assess " ..target
    elseif not mprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted and not mprepped_leftleg then
      atk = atk.. " infuse ice;assess "..target.. ";legslash " ..target.. " right " ..tstrike.. " ;assess " ..target
    elseif not mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted and not mprepped_leftleg then
      atk = atk.. " infuse ice;assess "..target.. ";legslash " ..target.. " left " ..tstrike.. " ;assess " ..target
    else
      atk = atk.. " infuse ice;assess "..target.. ";balanceslash " ..target.. " " ..tstrike.. " ;assess " ..target
    end
  end

elseif timpaleslash == false then
  if not tAffs.clumsiness then
    if lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and tmounted == true then 
      atk = atk.. " infuse lightning;assess "..target.. ";pommelstrike " ..target.. " left knees;assess " ..target
    elseif lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted then 
      atk = atk.. " infuse lightning;assess "..target.. ";legslash " ..target.. " left knees;assess " ..target
    elseif lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted then 
      atk = atk.. " infuse lightning;assess "..target.. ";legslash " ..target.. " right knees;assess " ..target
    elseif mprepped_rightleg and mprepped_leftleg and mprepped_torso and ataxiaTemp.parriedLimb ~= "torso" or tAffs.airfisted then
      atk = atk.. " infuse lightning;assess "..target.. ";centreslash " ..target.. " up " ..tstrike.. ";assess " ..target
    elseif mprepped_rightleg and not mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted then
      atk = atk.. " infuse lightning;assess "..target.. ";compassslash " ..target.. " southeast " ..tstrike.. ";assess " ..target
    elseif mprepped_leftleg and not mprepped_rightleg and mprepped_torso and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted then
      atk = atk.. " infuse lightning;assess "..target.. ";compassslash " ..target.. " southwest " ..tstrike.. ";assess " ..target
    elseif not mprepped_torso and ataxiaTemp.parriedLimb ~= "torso" or tAffs.airfisted then
      atk = atk.. " infuse lightning;assess "..target.. ";centreslash " ..target.. " up " ..tstrike.. ";assess " ..target
    elseif not mprepped_torso and ataxiaTemp.parriedLimb == "torso" or not tAffs.airfisted then
      atk = atk.. " infuse lightning;assess "..target.. ";centreslash " ..target.. " down " ..tstrike.. ";assess " ..target
    elseif not mprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted and not mprepped_leftleg then
      atk = atk.. " infuse lightning;assess "..target.. ";legslash " ..target.. " right " ..tstrike.. " ;assess " ..target
    elseif not mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted and not mprepped_leftleg then
      atk = atk.. " infuse lightning;assess "..target.. ";legslash " ..target.. " left " ..tstrike.. " ;assess " ..target
    else
      atk = atk.. " infuse lightning;assess "..target.. ";balanceslash " ..target.. " " ..tstrike.. " ;assess " ..target
    end
  
  elseif tAffs.clumsiness then
     if lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and tmounted == true then 
      atk = atk.. " infuse ice;assess "..target.. ";pommelstrike " ..target.. " left knees;assess " ..target
    elseif lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted then 
      atk = atk.. " infuse ice;assess "..target.. ";legslash " ..target.. " left knees;assess " ..target
    elseif lb[target].hits["torso"] &gt;= 100 or tAffs.mildtrauma and mprepped_rightleg and mprepped_leftleg and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted then 
      atk = atk.. " infuse ice;assess "..target.. ";legslash " ..target.. " right knees;assess " ..target
    elseif mprepped_rightleg and mprepped_leftleg and mprepped_torso and ataxiaTemp.parriedLimb ~= "torso" or tAffs.airfisted then
      atk = atk.. " infuse ice;assess "..target.. ";centreslash " ..target.. " up " ..tstrike.. ";assess " ..target
    elseif mprepped_rightleg and not mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted then
      atk = atk.. " infuse ice;assess "..target.. ";compassslash " ..target.. " southeast " ..tstrike.. ";assess " ..target
    elseif mprepped_leftleg and not mprepped_rightleg and mprepped_torso and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted then
      atk = atk.. " infuse ice;assess "..target.. ";compassslash " ..target.. " southwest " ..tstrike.. ";assess " ..target
    elseif not mprepped_torso and ataxiaTemp.parriedLimb ~= "torso" or tAffs.airfisted then
      atk = atk.. " infuse ice;assess "..target.. ";centreslash " ..target.. " up " ..tstrike.. ";assess " ..target
    elseif not mprepped_torso and ataxiaTemp.parriedLimb == "torso" or not tAffs.airfisted then
      atk = atk.. " infuse ice;assess "..target.. ";centreslash " ..target.. " down " ..tstrike.. ";assess " ..target
    elseif not mprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted and not mprepped_leftleg then
      atk = atk.. " infuse ice;assess "..target.. ";legslash " ..target.. " right " ..tstrike.. " ;assess " ..target
    elseif not mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted and not mprepped_leftleg then
      atk = atk.. " infuse ice;assess "..target.. ";legslash " ..target.. " left " ..tstrike.. " ;assess " ..target
    else
      atk = atk.. " infuse ice;assess "..target.. ";balanceslash " ..target.. " " ..tstrike.. " ;assess " ..target
    end
  end

  
end 
if tAffs.rebounding or tAffs.shield then
  send("queue addclear freestand raze " ..target.. " " ..tstrike.. "assess " ..target)
elseif not engaged then
  send("queue addclear freestand " ..atk.. ";engage " ..target)
else
send("queue addclear freestand " ..atk)

end
end




function bm_brokenstarroute2()
bmstriking4()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
else
  treelock = false
end

ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
bmslash1 = bmslash1 or ataxiaTables.limbData.bmSlash
bmslash2 = bmslash2 or ataxiaTables.limbData.bmOffSlash
bmcslash = bmcslash or ataxiaTables.limbData.bmCompass
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"

if lb[target].hits["head"] + bmslash1 &gt;= 100 and not tAffs.damagedhead then 
bmprepped_head = true else
bmprepped_head = false
end
if lb[target].hits["head"] + bmslash2 &gt;= 100 and not tAffs.damagedhead then 
bm2prepped_head = true else
bm2prepped_head = false
end
if lb[target].hits.head + bmcslash &gt;= 100 and not tAffs.damagedhead then 
bm3prepped_head = true else
bm3prepped_head = false
end

if lb[target].hits.torso + bmslash1 &gt;= 100 and not tAffs.mildtrauma then 
bmprepped_torso = true else
bmprepped_torso = false
end
if lb[target].hits.torso + bmslash2 &gt;= 100 and not tAffs.mildtrauma then 
bm2prepped_torso = true else
bm2prepped_torso = false
end

if lb[target].hits.torso + bmcslash &gt;= 100 and not tAffs.mildtrauma then 
bm3prepped_torso = true else
bm3prepped_torso = false
end

if lb[target].hits["left arm"] + bmslash1 &gt;= 100 and not tAffs.damagedleftarm then 
bmprepped_leftarm = true else
bmprepped_leftarm = false
end
if lb[target].hits["left arm"] + bmslash2 &gt;= 100 and not tAffs.damagedleftarm then 
bm2prepped_leftarm = true else
bm2prepped_leftarm = false
end
if lb[target].hits["left arm"] + bmcslash &gt;= 100 and not tAffs.damagedleftarm then 
bm3prepped_leftarm = true else
bm3prepped_leftarm = false
end

if lb[target].hits["right arm"] + bmslash1 &gt;= 100 and not tAffs.damagedrightarm then 
bmprepped_rightarm = true else
bmprepped_rightarm = false
end
if lb[target].hits["right arm"] + bmslash2 &gt;= 100 and not tAffs.damagedrightarm then 
bm2prepped_rightarm = true else
bm2prepped_rightarm = false
end
if lb[target].hits["right arm"] + bmcslash &gt;= 100 and not tAffs.damagedrightarm then 
bm3prepped_rightarm = true else
bm3prepped_rightarm = false
end

if lb[target].hits["left leg"] + bmslash1 &gt;= 100 and not tAffs.damagedleftleg then 
bmprepped_leftleg = true else
bmprepped_leftleg = false
end
if lb[target].hits["left leg"] + bmslash2 &gt;= 100 and not tAffs.damagedleftleg then 
bm2prepped_leftleg = true else
bm2prepped_leftleg = false
end
if lb[target].hits["left leg"] + bmcslash &gt;= 100 and not tAffs.damagedleftleg then 
bm3prepped_leftleg = true else
bm3prepped_leftleg = false
end

if lb[target].hits["right leg"] + bmslash1 &gt;= 100 and not tAffs.damagedrightleg then 
bmprepped_rightleg = true else
bmprepped_rightleg = false
end
if lb[target].hits["right leg"] + bmslash2 &gt;= 100 and not tAffs.damagedrightleg then 
bm2prepped_rightleg = true else
bm2prepped_rightleg = false
end
if lb[target].hits["right leg"] + bmcslash &gt;= 100 and not tAffs.damagedrightleg then 
bm3prepped_rightleg = true else
bm3prepped_rightleg = false
end


if ataxiaNDB.players[target].city == "Mhaldor" and tAffs.bleed &gt;= 700 then
send("say BrokenStarrrrrrr")

elseif ataxiaNDB.players[target].city ~= "Mhaldor" and tAffs.bleed &gt;= 700 then
atk = atk.. "withdraw blade;sheathe sword;brokenstar " ..target

elseif tAffs.impaled and timpaleslash == true then
atk = atk.."bladetwist;assess "..target..";discern " ..target

elseif tAffs.impaled and timpaleslash == false then
atk = atk.. " assess "..target..";impaleslash;discern " ..target


elseif tAffs.prone and lb[target].hits["left leg"] &gt;= 100 or tAffs.damagedleftleg and lb[target].hits["right leg"] &gt;= 100 or tAffs.damagedrightleg and not tAffs.impaled then
atk = atk.. " assess "..target..";impale " ..target




--Prep
elseif tAffs.paralysis or tAffs.prone and timpaleslash == false then
  atk = atk.. " assess "..target..";impale " ..target
elseif bmprepped_torso and bmprepped_rightleg and not bm3prepped_leftleg and not bm2prepped_leftleg and (ataxiaTemp.parriedLimb == "left leg" and not tAffs.airfisted) then
  atk = atk.. ";compassslash " ..target.. " southeast " ..tstrike
elseif bmprepped_torso and bmprepped_leftleg and not bm3prepped_rightleg and not bm2prepped_rightleg and (ataxiaTemp.parriedLimb == "right leg" and not tAffs.airfisted) then
  atk = atk.. ";compassslash " ..target.. " southwest " ..tstrike
elseif not bmprepped_torso and (ataxiaTemp.parriedLimb ~= "torso" or tAffs.airfisted) then
  atk = atk.. ";centreslash " ..target.. " up " ..tstrike
elseif not bm2prepped_torso and (ataxiaTemp.parriedLimb == "torso" and not tAffs.airfisted) then
  atk = atk.. ";centreslash " ..target.. " down " ..tstrike
elseif not bmprepped_rightleg and (ataxiaTemp.parriedLimb ~= "right leg" or tAffs.airfisted) then
  atk = atk.. ";legslash " ..target.. " right " ..tstrike
elseif not bmprepped_leftleg and (ataxiaTemp.parriedLimb ~= "left leg" or tAffs.airfisted) then
  atk = atk.. ";legslash " ..target.. " left " ..tstrike
else
  atk = atk.. ";balanceslash " ..target.. " left " ..tstrike





end 
if tAffs.rebounding or tAffs.shield then
  send("queue addclear freestand raze " ..target.. " " ..tstrike)
elseif not engaged then
  send("queue addclear freestand " ..atk.. ";engage " ..target)
else
send("queue addclear freestand " ..atk)

end
end








</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Group</name>
										<packageName></packageName>
										<script>--17.0/11.3
function bm_groupfighting()
bmgrouplock()
local atk = combatQueue()
getLockingAffliction()
checkTargetLocks()

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
else
  softlock = false
	
end
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
else
  treelock = false
end
if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 21 then
use_bisect = true else
use_bisect = false
end

if ataxiaTemp.lastAssess and ataxiaTemp.lastAssess &lt;= 26 then
use_bisect2 = true else
use_bisect2 = false
end

ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
tarpreapply = tarpreapply or false
tAffs.bleed = tAffs.bleed or 0
bmslash1 = bmslash1 or ataxiaTables.limbData.bmSlash
bmslash2 = bmslash2 or ataxiaTables.limbData.bmOffSlash
bmcslash = bmcslash or ataxiaTables.limbData.bmCompass
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"

if lb[target].hits["head"] + bmslash1 &gt;= 100 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end

if lb[target].hits["torso"] + bmslash1 &gt;= 99 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end


if lb[target].hits["left leg"] + bmslash1 &gt;= 100 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end


if lb[target].hits["right leg"] + bmslash1 &gt;= 100 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end


if lb[target].hits["right arm"] + bmslash1 &gt;= 100 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end


if lb[target].hits["left arm"] + bmslash1 &gt;= 100 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end




if ataxiaNDB.players[target].city == "Mhaldor" and tAffs.bleed &gt;= 600 then
send("say BrokenStarrrrrrr")

elseif ataxiaNDB.players[target].city ~= "Mhaldor" and tAffs.bleed &gt;= 600 then
atk = atk.. "withdraw blade;sheathe sword;brokenstar " ..target

elseif tAffs.impaled and timpaleslash == true then
atk = atk.."bladetwist;assess "..target..";discern " ..target

elseif tAffs.impaled and timpaleslash == false then
atk = atk.. " assess "..target..";impaleslash"


elseif tAffs.prone and lb[target].hits["left leg"] &gt;= 100 and lb[target].hits["right leg"] &gt;= 100 and not tAffs.impaled then
atk = atk.. " assess "..target..";impale " ..target

elseif tAffs.prone and lb[target].hits["left leg"] &gt;= 100 or lb[target].hits["right leg"] &gt;= 100 and not tAffs.impaled then
atk = atk.. " assess "..target..";impale " ..target
else
atk = atk.. "infuse ice;pommelstrike " ..target.. " " ..tstrike.. ";assess " ..target  

end
  
if use_bisect == true then
  send("queue addclear freestand " ..atk)
elseif tAffs.rebounding or tAffs.shield then
  send("queue addclear freestand raze " ..target.. " " ..tstrike.. "assess " ..target)
elseif not engaged then
  send("queue addclear freestand " ..atk.. ";engage " ..target)
else
send("queue addclear freestand " ..atk)

end
end













</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Serpent</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Levi Kelp Stack</name>
										<packageName></packageName>
										<script>serpentsuggest = false
incommingsnakeprone = false
snapscenarioone = false
snapscenariotwo = false
function serp_quicklock()
-- Set Varables

snapscenarioone = true
snapscenariotwo = false
tAffs.hypnotising = tAffs.hypnotising or false
tAffs.hypnotised = tAffs.hypnotised or false
tAffs.hypnoseal = tAffs.hypnoseal or false
ataxiaTemp.hypnoseal = ataxiaTemp.hypnoseal or false
tAffs.snapped = tAffs.snapped or false



--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--tBals.plant
--tBals.tree
--tAffs.hypnoseal
--snapTarget
--tAffs.snapped
--tAffs.hypnotising

--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
  local	treelock = true
else
  treelock = false
end

--Define Kelp Stack
if checkAffList({"hypochondria", "parasite", "weariness",  "asthma", "healthleech", "clumsiness", "sensitivity"},3) then
  tAffs.kelpstack = true
else
  tAffs.kelpstack = false
end

--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
envenomList = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(envenomList,"paralyse") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(envenomList,"weariness") 
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(envenomList,"plague") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(envenomList,"stupid")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(envenomList,"reckless")
  else
    table.insert(envenomList,"plague")   
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare")
elseif softlock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(envenomList,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(envenomList,"vernalius") 
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(envenomList,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(envenomList,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(envenomList,"eurypteria")
  else
    table.insert(envenomList,"voyria")   
  end
elseif softlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare") 
elseif tAffs.snapped == true and not tAffs.anorexia then
  table.insert(envenomList,"slike")
elseif tAffs.snapped == true and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
  table.insert(envenomList,"slike") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience then
  table.insert(envenomList,"gecko")
elseif incommingsnakeprone == true and not tAffs.slickness then 
  table.insert(envenomList,"gecko")
elseif not tAffs.slickness and tAffs.asthma then
  table.insert(envenomList,"gecko")
elseif tAffs.prone and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
  table.insert(envenomList,"vernalius")
elseif not tAffs.clumsiness and getLockingAffliction(target) ~= "weariness" then
  table.insert(envenomList,"xentio")
elseif not tAffs.asthma then
  table.insert(envenomList,"kalmia")
elseif not tAffs.weariness then
  table.insert(envenomList,"vernalius")
elseif not tAffs.darkshade then
  table.insert(envenomList,"darkshade")
elseif not tAffs.nausea then
  table.insert(envenomList,"euphorbia")
elseif not tAffs.addiction then
  table.insert(envenomList,"vardrax")
else
  table.insert(envenomList,"aconite")
end


--Set Venom Two Table
envenomListTwo = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and envenomList[1] ~= "curare" then
    table.insert(envenomListTwo,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and envenomList[1] ~= "vernalius" then
    table.insert(envenomListTwo,"vernalius") 
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and envenomList[1] ~= "voyria" then
    table.insert(envenomListTwo,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and envenomList[1] ~= "aconite" then
    table.insert(envenomListTwo,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and envenomList[1] ~= "eurypteria" then
   table.insert(envenomListTwo,"eurypteria") 
  end
elseif hardlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare") 
elseif softlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif tAffs.snapped == true and not tAffs.anorexia and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.snapped == true and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko") 
elseif incommingsnakeprone == true and not tAffs.slickness and envenomList[1] ~= "gecko" then 
  table.insert(envenomListTwo,"gecko")
elseif not tAffs.slickness and tAffs.asthma and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.prone and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif not tAffs.clumsiness and envenomList[1] ~= "xentio" then
  table.insert(envenomListTwo,"xentio")
elseif not tAffs.asthma and envenomList[1] ~= "kalmia" then
  table.insert(envenomListTwo,"kalmia")
elseif not tAffs.weariness and envenomList[1] ~= "vernalius" then
  table.insert(envenomListTwo,"vernalius")
elseif not tAffs.darkshade and envenomList[1] ~= "darkshade" then
  table.insert(envenomListTwo,"darkshade")
elseif not tAffs.nausea and envenomList[1] ~= "euphorbia" then
  table.insert(envenomListTwo,"euphorbia")
elseif not tAffs.addiction and envenomList[1] ~= "vardrax" then
  table.insert(envenomListTwo,"vardrax")
elseif envenomList[1] ~= "aconite" then
  table.insert(envenomListTwo,"aconite")
end




serp_lockattack()

end

function serp_quicklocksnakeprone()
-- Set Varables

tAffs.hypnotising = tAffs.hypnotising or false
tAffs.hypnotised = tAffs.hypnotised or false
tAffs.hypnoseal = tAffs.hypnoseal or false
ataxiaTemp.hypnoseal = ataxiaTemp.hypnoseal or false
tAffs.snapped = tAffs.snapped or false
snapscenarioone = false
snapscenariotwo = true


--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--tBals.plant
--tBals.tree
--tAffs.hypnoseal
--snapTarget
--tAffs.snapped
--tAffs.hypnotising

--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
  local	treelock = true
else
  treelock = false
end

--Define Kelp Stack
if checkAffList({"hypochondria", "parasite", "weariness",  "asthma", "healthleech", "clumsiness", "sensitivity"},3) then
  tAffs.kelpstack = true
else
  tAffs.kelpstack = false
end

--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
envenomList = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(envenomList,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(envenomList,"vernalius") 
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(envenomList,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(envenomList,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(envenomList,"eurypteria")
  else
    table.insert(envenomList,"voyria")   
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare") 
elseif softlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare") 
elseif tAffs.snapped == true and not tAffs.anorexia then
  table.insert(envenomList,"slike")
elseif tAffs.snapped == true and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif incommingsnakeprone == true and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
  table.insert(envenomList,"slike") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience then
  table.insert(envenomList,"gecko") 
elseif not tAffs.slickness and tAffs.asthma then
  table.insert(envenomList,"gecko")
elseif tAffs.prone and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif not tAffs.clumsiness then
  table.insert(envenomList,"xentio")
elseif not tAffs.asthma then
  table.insert(envenomList,"kalmia")
elseif not tAffs.weariness then
  table.insert(envenomList,"vernalius")
elseif not tAffs.darkshade then
  table.insert(envenomList,"darkshade")
elseif not tAffs.nausea then
  table.insert(envenomList,"euphorbia")
elseif not tAffs.addiction then
  table.insert(envenomList,"vardrax")
else
  table.insert(envenomList,"aconite")
end


--Set Venom Two Table
envenomListTwo = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and envenomList[1] ~= "curare" then
    table.insert(envenomListTwo,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and envenomList[1] ~= "vernalius" then
    table.insert(envenomListTwo,"vernalius") 
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and envenomList[1] ~= "voyria" then
    table.insert(envenomListTwo,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and envenomList[1] ~= "aconite" then
    table.insert(envenomListTwo,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and envenomList[1] ~= "eurypteria" then
   table.insert(envenomListTwo,"eurypteria") 
  end
elseif hardlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare") 
elseif softlock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and envenomList[1] ~= "curare" then
    table.insert(envenomListTwo,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and envenomList[1] ~= "vernalius" then
    table.insert(envenomListTwo,"vernalius") 
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and envenomList[1] ~= "voyria" then
    table.insert(envenomListTwo,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and envenomList[1] ~= "aconite" then
    table.insert(envenomListTwo,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and envenomList[1] ~= "eurypteria" then
   table.insert(envenomListTwo,"eurypteria") 
  end
  
elseif softlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif tAffs.snapped == true and not tAffs.anorexia and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.snapped == true and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif incommingsnakeprone == true and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomList,"gecko")
elseif incommingsnakeprone == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomList,"curare")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko") 
elseif not tAffs.slickness and tAffs.asthma and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.prone and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif not tAffs.clumsiness and envenomList[1] ~= "xentio" then
  table.insert(envenomListTwo,"xentio")
elseif not tAffs.asthma and envenomList[1] ~= "kalmia" then
  table.insert(envenomListTwo,"kalmia")
elseif not tAffs.weariness and envenomList[1] ~= "vernalius" then
  table.insert(envenomListTwo,"vernalius")
elseif not tAffs.darkshade and envenomList[1] ~= "darkshade" then
  table.insert(envenomListTwo,"darkshade")
elseif not tAffs.nausea and envenomList[1] ~= "euphorbia" then
  table.insert(envenomListTwo,"euphorbia")
elseif not tAffs.addiction and envenomList[1] ~= "vardrax" then
  table.insert(envenomListTwo,"vardrax")
elseif envenomList[1] ~= "aconite" then
  table.insert(envenomListTwo,"aconite")
end





serp_lockattack2()
end

function serp_grouplock()
-- Set Varables

tAffs.hypnotising = tAffs.hypnotising or false
tAffs.hypnotised = tAffs.hypnotised or false
tAffs.hypnoseal = tAffs.hypnoseal or false
ataxiaTemp.hypnoseal = ataxiaTemp.hypnoseal or false
tAffs.snapped = tAffs.snapped or false
snapscenarioone = false
snapscenariotwo = true


--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--tBals.plant
--tBals.tree
--tAffs.hypnoseal
--snapTarget
--tAffs.snapped
--tAffs.hypnotising

--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
  local	treelock = true
else
  treelock = false
end

--Define Kelp Stack
if checkAffList({"hypochondria", "parasite", "weariness",  "asthma", "healthleech", "clumsiness", "sensitivity"},3) then
  tAffs.kelpstack = true
else
  tAffs.kelpstack = false
end

--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
envenomList = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(envenomList,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(envenomList,"vernalius") 
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(envenomList,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(envenomList,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(envenomList,"eurypteria")
  else
    table.insert(envenomList,"voyria")   
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare") 
elseif softlock == true and not tAffs.paralysis then
  table.insert(envenomList,"curare") 
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
  table.insert(envenomList,"slike") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience then
  table.insert(envenomList,"gecko") 
elseif not tAffs.slickness and tAffs.asthma then
  table.insert(envenomList,"gecko")
elseif tAffs.prone and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif not tAffs.asthma then
  table.insert(envenomList,"kalmia")
elseif not tAffs.darkshade then
  table.insert(envenomList,"darkshade")
elseif not tAffs.weariness then
  table.insert(envenomList,"vernalius")
elseif not tAffs.clumsiness then
  table.insert(envenomList,"xentio")
elseif not tAffs.nausea then
  table.insert(envenomList,"euphorbia")
elseif not tAffs.addiction then
  table.insert(envenomList,"vardrax")
else
  table.insert(envenomList,"aconite")
end


--Set Venom Two Table
envenomListTwo = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and envenomList[1] ~= "curare" then
    table.insert(envenomListTwo,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and envenomList[1] ~= "vernalius" then
    table.insert(envenomListTwo,"vernalius") 
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and envenomList[1] ~= "voyria" then
    table.insert(envenomListTwo,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and envenomList[1] ~= "aconite" then
    table.insert(envenomListTwo,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and envenomList[1] ~= "eurypteria" then
   table.insert(envenomListTwo,"eurypteria") 
  end
elseif hardlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare") 
elseif softlock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and envenomList[1] ~= "curare" then
    table.insert(envenomListTwo,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and envenomList[1] ~= "vernalius" then
    table.insert(envenomListTwo,"vernalius") 
  --elseif getLockingAffliction(target) == "haemophilia" then
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and envenomList[1] ~= "voyria" then
    table.insert(envenomListTwo,"voyria") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and envenomList[1] ~= "aconite" then
    table.insert(envenomListTwo,"aconite")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and envenomList[1] ~= "eurypteria" then
   table.insert(envenomListTwo,"eurypteria") 
  end
elseif softlock == true and not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and envenomList[1] ~= "slike" then
  table.insert(envenomListTwo,"slike") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko") 
elseif not tAffs.slickness and tAffs.asthma and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.prone and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif not tAffs.paralysis and envenomList[1] ~= "curare" then
  table.insert(envenomListTwo,"curare")
elseif not tAffs.asthma and envenomList[1] ~= "kalmia" then
  table.insert(envenomListTwo,"kalmia")
elseif not tAffs.weariness and envenomList[1] ~= "vernalius" then
  table.insert(envenomListTwo,"vernalius")
elseif not tAffs.darkshade and envenomList[1] ~= "darkshade" then
  table.insert(envenomListTwo,"darkshade")
elseif not tAffs.clumsiness and envenomList[1] ~= "xentio" then
  table.insert(envenomListTwo,"xentio")
elseif not tAffs.nausea and envenomList[1] ~= "euphorbia" then
  table.insert(envenomListTwo,"euphorbia")
elseif not tAffs.addiction and envenomList[1] ~= "vardrax" then
  table.insert(envenomListTwo,"vardrax")
elseif envenomList[1] ~= "aconite" then
  table.insert(envenomListTwo,"aconite")
end





serp_groupattack()
end












function serp_lockattack()
if not php then php = 100 end
if not pm then pm = 100 end
partyrelay = partyrelay or true



--Set Attacks
local atk = combatQueue()

if tAffs.hypnotised == true and serpentsuggest == true and tAffs.hypnoseal == false then
  atk = atk.. "wield left dirk;wield right shield;purge;order adder kill " ..target..";seal " ..target.. " 1;"
elseif tAffs.rebounding and tAffs.shield then
  atk = atk.. " wield left dirk;wield right lash;purge;order adder kill " ..target..";flay " ..target.. " shield " ..envenomListTwo[1]
elseif tAffs.rebounding then
  atk = atk.. " wield left dirk;wield right lash;purge;order adder kill " ..target..";flay " ..target.. " rebounding " ..envenomListTwo[1]
elseif tAffs.shield then 
  table.insert(envenomListTwo,"curare")
  atk = atk.. "wield left dirk;wield right lash;purge;order adder kill " ..target..";flay " ..target.. " shield " ..envenomListTwo[1]
elseif tAffs.snapped == true then
 atk = atk.. " wield left dirk;wield right shield;purge;order adder kill " ..target..";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]
elseif tAffs.hypnoseal == true then
  atk = atk.. "wield left dirk;wield right shield;purge;order adder kill " ..target..";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]
elseif tAffs.hypnotised == true and serpentsuggest == false then
  atk = atk.. "wield left dirk;wield right shield;purge;order adder kill " ..target..";suggest " ..target.. " impatience"
elseif tAffs.hypnotising == true then
  atk = atk.. "wield left dirk;wield right shield;purge;order adder kill " ..target..";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]
elseif tAffs.hypnotised == false and tAffs.hypnotising == false and tAffs.hypnoseal == false then
  atk = atk.. "wield left dirk;wield right shield;purge;order adder kill " ..target..";hypnotise " ..target.. ";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]
else
  atk = atk.. " wield left dirk;wield right shield;purge;order adder kill " ..target..";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]

end


if table.contains(ataxia.playersHere, target) then
send("queue addclear freestand " ..atk)
end

end



function serp_lockattack2()
if not php then php = 100 end
if not pm then pm = 100 end
partyrelay = partyrelay or true

local atk = combatQueue()

if tAffs.hypnotised == true and serpentsuggest == true and tAffs.hypnoseal == false then
  atk = atk.. "wield left dirk;wield right shield;purge;order adder kill " ..target..";seal " ..target.. " 1;"
elseif tAffs.rebounding and tAffs.shield then
   table.insert(envenomListTwo,"curare")
  atk = atk.. " wield left dirk;wield right lash;purge;order adder kill " ..target..";flay " ..target.. " shield " ..envenomListTwo[1]
elseif tAffs.rebounding then
  table.insert(envenomListTwo,"curare")
  atk = atk.. " wield left dirk;wield right lash;purge;order adder kill " ..target..";flay " ..target.. " rebounding " ..envenomListTwo[1]
elseif tAffs.shield then 
   table.insert(envenomListTwo,"curare")
  atk = atk.. "wield left dirk;wield right lash;purge;order adder kill " ..target..";flay " ..target.. " shield " ..envenomListTwo[1]
elseif tAffs.snapped == true then
 atk = atk.. " wield left dirk;wield right shield;purge;order adder kill " ..target..";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]
elseif incommingsnakeprone == true and not tAffs.slickness and not tAffs.paralysis then
 table.insert(envenomList,"slike")
 table.insert(envenomListTwo,"curare")
  atk = atk.. "wield left dirk;wield right shield;purge;order adder kill " ..target..";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]
elseif tpinshot == false and tlightwall == false then
  atk = atk.. " remove bow;wield bow;purge;order adder kill " ..target..";pinshot " ..target.. ";conjure lightwall " ..random_direction
elseif tpinshot == false and tlightwall == true then
  atk = atk.. " remove bow;wield bow;purge;order adder kill " ..target..";pinshot " ..target
elseif tAffs.hypnoseal == true then
  atk = atk.. "wield left dirk;wield right shield;purge;order adder kill " ..target..";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]
elseif tAffs.hypnotised == true and serpentsuggest == false then
  atk = atk.. "wield left dirk;wield right shield;purge;order adder kill " ..target..";suggest " ..target.. " hypochondria;suggest " ..target.. " impatience"
elseif tAffs.hypnotising == true then
  atk = atk.. "wield left dirk;wield right shield;purge;order adder kill " ..target..";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]
elseif tAffs.hypnotised == false and tAffs.hypnotising == false and tAffs.hypnoseal == false then
  atk = atk.. "wield left dirk;wield right shield;purge;order adder kill " ..target..";hypnotise " ..target.. ";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]
else
  atk = atk.. " wield left dirk;wield right shield;purge;order adder kill " ..target..";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]

end

if table.contains(ataxia.playersHere, target) then
send("queue addclear freestand " ..atk)
end

end


function serp_groupattack()
if not php then php = 100 end
if not pm then pm = 100 end
partyrelay = partyrelay or true



--Set Attacks
local atk = combatQueue()

if tAffs.rebounding and tAffs.shield then
  atk = atk.. " wield left dirk;wield right lash;purge;order adder kill " ..target..";flay " ..target.. " shield " ..envenomListTwo[1]
elseif tAffs.rebounding then
  atk = atk.. " wield left dirk;wield right lash;purge;order adder kill " ..target..";flay " ..target.. " rebounding " ..envenomListTwo[1]
elseif tAffs.shield then 
  table.insert(envenomListTwo,"curare")
  atk = atk.. "wield left dirk;wield right lash;purge;order adder kill " ..target..";flay " ..target.. " shield " ..envenomListTwo[1]
else
  atk = atk.. " wield left dirk;wield right shield;purge;order adder kill " ..target..";doublestab " ..target.. " " ..envenomList[1].. " " ..envenomListTwo[1]
end


if table.contains(ataxia.playersHere, target) then
send("queue addclear freestand " ..atk)
end

end

</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Shikudo Script - Levi</name>
									<packageName>Shikudo Script</packageName>
									<script></script>
									<eventHandlerList />
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Shikudo</name>
										<packageName></packageName>
										<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>Shikudo</name>
											<packageName></packageName>
											<script>function AtaxiaGMCPParse(stat)
  --Because they sometimes pass goofy stuff
  --in the 'charstats' sub-table of vitals,
  --we need a way to parse that. Forrrrr example,
  --bleed. It gets passed as Bleed: # in charstats[1],
  --buuuut it might not ALWAYS be charstats[1], or
  --maybe it isn't there at all. Stupid. But here's
  --my solution.
  
  local stat = stat:title()..": "
  local toRet = false
  for _, v in pairs(gmcp.Char.Vitals.charstats) do
    if string.find(v, stat) then
      toRet = v:gsub(stat, "")
      toRet = toRet:gsub("%%", "")
      --sometimes we want the STRING, like morph: jaguar &lt;-- want jaguar,
      --this will skip if there isn't a valid tonumber.
      if tonumber(toRet) then
        toRet = tonumber(toRet)
      end
    end
  end
  
  return toRet
end

</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Shikudo R2</name>
											<packageName></packageName>
											<script>---what is my shikudo stance
shikudostance = shikudostance or ""

--what is my katachain

katachain= 0

--target shield = false



--Make sure to set this in triggers when people parry!
tpla = false
tpll = false
tph = false
tpto = false
tpra = false
tprl = false

-- Set the Kick in the Shikudo Combo per stance
function kickshikudoattack()
kicked = kicked or ""

-- Rain Stance
if shikudostance == "rain" then

 if tpla == false then
 kicked = "frontkick left"
 else
   kicked = "frontkick right"
   end
end

-- Oak Stance
if shikudostance == "oak" then
 if tph == false then
  kicked = "risingkick head"
 else
  kicked = "risingkick torso"
 end
end

--Willow Stance
if shikudostance == "willow" then
 if tpll == false then
  kicked = "flashheel left"
 else
  kicked = "flashheel right"
 end
end

--Gaital Stance
if shikudostance == "gaital" then
  if tAffs.prone then
    kicked = "spinkick"
  elseif tpll == false then
  kicked = "flashheel left"
 else
  kicked = "flashheel right"
  end
end

--Maelstrom Stance
if shikudostance == "maelstrom" then
if tph == false then
  kicked = "risingkick head"
 else
  kicked = "risingkick torso"
 end
 
 --Tykonos
 if shikudostance == "tykonos" then
if tph == false then
  kicked = "risingkick head"
 else
  kicked = "risingkick torso"
 end
end
end
  

-- Set Staff Attack Number One or First Arm Strike
function shikudostaffstrike()
staff = staff or ""

-- Rain Stance
 if shikudostance == "rain" then
 if tAffs.asthma and tpto == false then
  staff = "ruku torso"
 elseif tAffs.weariness and tpll == false then
  staff = "kuro left"
 elseif tAffs.weariness and tpll == true then
  staff = "kuro right"
  
 elseif tAffs.lethargy and tpll == false then
  staff = "kuro left"
 elseif tAffs.lethargy and tpll == true then
  staff = "kuro right"
  
 elseif tAffs.clumsiness and tpla == true then
  staff = "ruku right"
 elseif tAffs.clumsiness and tpla == false then
  staff = "ruku left"
  
 elseif tAffs.healthleech and tpla == false then
  staff = "ruku left"
 elseif tAffs.healthleech  and tpla == true then
  staff = "ruku right"
  
 elseif tAffs.dizziness then
  staff = "hiru"
  
 elseif tAffs.slickness and tpto == false then
  staff = "ruku torso"
 
 else
  staff = "kuro left"
   end
 end
 
 
 if shikudostance == "oak" then
  if tAffs.paralysis then
   staff = "nervestrike"
   
  elseif tAffs.asthma then
   staff = "livestrike"
  
   elseif tAffs.slickness and tpto == false then
   staff = "ruku torso"
   
  elseif tAffs.weariness and tpll == false then
   staff = "kuro left"
  elseif tAffs.weariness and tpll == true then
   staff = "kuro right"
  
  elseif tAffs.lethargy and tpll == false then
   staff = "kuro left"
  elseif tAffs.lethargy and tpll == true then
   staff = "kuro right"
   
  elseif tAffs.clumsiness and tpla == true then
   staff = "ruku right"
  elseif tAffs.clumsiness and tpla == false then
   staff = "ruku left"
      
  elseif tAffs.healthleech and tpla == false then
   staff = "ruku left"
  elseif tAffs.healthleech and tpla == true then
   staff = "ruku right"
  else
   staff = "ruku torso"
  end
 end
 
 if shikudostance == "willow" then
  if tAffs.anorexia  then
   staff = "hiraku"
  elseif tAffs.anorexia then
   staff = "hiraku"
  else
   staff = "hiru"
  end
 end
 
 if shikudostance == "gaital" then
  if tAffs.slickness and tpto == false then
   staff = "ruku torso"
   
  elseif tAffs.weariness and tpll == false then
   staff = "kuro left"
  elseif tAffs.weariness and tpll == true then
   staff = "kuro right"
  
  elseif tAffs.lethargy and tpll == false then
   staff = "kuro left"
  elseif tAffs.lethargy and tpll == true then
   staff = "kuro right"
  elseif tAffs.clumsiness and tpla == true then
   staff = "ruku right"
  elseif tAffs.clumsiness and tpla == false then
   staff = "ruku left"
    
  
  elseif tAffs.healthleech and tpla == false then
   staff = "ruku left"
  elseif tAffs.healthleech and tpla == true then
   staff = "ruku right"
  else
   staff = "needle"
   end
  end
  
 if shikudostance == "maelstrom" then
  if tAffs.asthma then
   staff = "livestrike"
  elseif tAffs.addiction then
   staff = "jinzuku"
  elseif tAffs.slickness then
   staff = "ruku torso"
  elseif tAffs.clumsiness and tpla == true then
   staff = "ruku right"
  elseif tAffs.clumsiness and tpla == false then
   staff = "ruku left"
  elseif tAffs.healthleech and tpla == false then
   staff = "ruku left"
  elseif tAffs.healthleech and tpla == true then
   staff = "ruku right"
  else
   staff = "jinzuku"
  end
 end
end



-- Set Second Staff Attack or Second Arm Balance
function shikudostafftwo()
stafftwo = stafftwo or ""

--Rain Stance
 if shikudostance == "rain" then
 
if tAffs.clumsiness and (staff ~= "ruku right" or staff ~= "ruku left") and tpla == true then
   stafftwo = "ruku right"
  elseif tAffs.clumsiness and (staff ~= "ruku right" or staff ~= "ruku left") and tpla == false then
   stafftwo = "ruku left"
  
  elseif tAffs.lethargy and tpll == false then
   stafftwo = "kuro left"
  elseif tAffs.lethargy and tpll == true then
   stafftwo = "kuro right"
  
  elseif tAffs.healthleech and tpla == false then
   stafftwo = "ruku left"
  elseif tAffs.healthleech and tpla == true then
   stafftwo = "ruku right"
   
elseif tAffs.weariness and (staff ~= "kuro right" or staff ~= "kuro left") and tpll == false then
   stafftwo = "kuro left"
elseif tAffs.weariness and (staff ~= "kuro right" or staff ~= "kuro left") and tpll == true then
   stafftwo = "kuro right"
elseif tAffs.dizziness and staff ~= "hiru" then
   stafftwo = "hiru"
  
elseif tAffs.slickness and staff ~= "ruku torso" and tpto == false then
   stafftwo = "ruku torso"
else
   stafftwo = "ruku torso"
   end
  end
  
if shikudostance == "oak" then
     
  if tAffs.paralysis and staff ~= "nervestrike" then
   stafftwo = "nervestrike"
elseif tAffs.asthma and staff ~= "livestrike" then
   stafftwo = "livestrike"
  
elseif tAffs.slickness and tpto == false and staff ~= "ruku torso" then
   stafftwo = "ruku torso"
   
elseif tAffs.weariness and (staff ~= "kuro right" or staff ~= "kuro left") and tpll == false then
   stafftwo = "kuro left"
elseif tAffs.weariness and (staff ~= "kuro right" or staff ~= "kuro left") and tpll == true then
   stafftwo = "kuro right"

elseif tAffs.lethargy and tpll == false then
   stafftwo = "kuro left"
elseif tAffs.lethargy and tpll == true then
   stafftwo = "kuro right"
   
elseif tAffs.clumsiness and (staff ~= "ruku right" or staff ~= "ruku left") and tpla == true then
   stafftwo = "ruku right"
elseif tAffs.clumsiness and (staff ~= "ruku right" or staff ~= "ruku left") and tpla == false then
   stafftwo = "ruku left"
    
elseif tAffs.healthleech and tpla == false then
   stafftwo = "ruku left"
elseif tAffs.healthleech and tpla == true then
   stafftwo = "ruku right"
 
else
   stafftwo = "ruku torso"
  end
 end
 
if shikudostance == "willow" then
  if tAffs.anorexia and staff ~= "hiraku" then
   stafftwo = "hiraku"
  elseif staff ~= "hiru" then
   stafftwo = "hiru"
  end
 end
 
if shikudostance == "gaital" then
if tAffs.slickness and tpto == false and staff ~= "ruku torso" then
   stafftwo = "ruku torso"
  elseif tAffs.lethargy and tpll == false then
   stafftwo = "kuro left"
  elseif tAffs.lethargy and tpll == true then
   stafftwo = "kuro right"   
elseif tAffs.clumsiness and (staff ~= "ruku right" or staff ~= "ruku left") and tpla == true then
   stafftwo = "ruku right"
elseif tAffs.clumsiness and (staff ~= "ruku right" or staff ~= "ruku left") and tpla == false then
   stafftwo = "ruku left"
    
  
  elseif tAffs.healthleech and tpla == false then
   stafftwo = "ruku left"
  elseif tAffs.healthleech and tpla == true then
   stafftwo = "ruku right"
   
elseif tAffs.weariness and (staff ~= "kuro right" or staff ~= "kuro left") and tpll == false then
   stafftwo = "kuro left"
elseif tAffs.weariness and (staff ~= "kuro right" or staff ~= "kuro left") and tpll == true then
   stafftwo = "kuro right"
else
   stafftwo = "needle"
   end
 end
  
 if shikudostance == "maelstrom" then
  if tAffs.asthma and staff ~= "livestrike" then
   stafftwo = "livestrike"
  elseif tAffs.addiction and staff ~= "jinzuku" then
   stafftwo = "jinzuku"
  elseif tAffs.slickness and staff ~= "ruku torso" then
   stafftwo = "ruku torso"
   
  elseif tAffs.healthleech and tpla == false then
   stafftwo = "ruku left"
  elseif tAffs.healthleech and tpla == true then
   stafftwo = "ruku right"
   
elseif tAffs.clumsiness and (staff ~= "ruku right" or staff ~= "ruku left") and tpla == true then
   stafftwo = "ruku right"
elseif tAffs.clumsiness and (staff ~= "ruku right" or staff ~= "ruku left") and tpla == false then
   stafftwo = "ruku left"
  else
   stafftwo = "jinzuku"
  end
 end

end
end



</script>
											<eventHandlerList />
										</Script>
										<Script isActive="no" isFolder="no">
											<name>Dispatch Dat Hoe</name>
											<packageName></packageName>
											<script>function dispatchdatass()
-- If using Romaen's Limb Counter then the limb prep will be if lb[target].hits["right leg"] &gt;= 90
-- Lowest Damage Point is 10.1 damage per limb

-- For dispatch we will need prone, level 2 head and needle. So at the very least it would be break right leg in oak, switch to gaital, Break second leg/prone/, Spinkick break head/needle, dispatch

--All variables for Dispatch are true
sform = ""

if affstrack.score.prone &gt;= 100 and (lb[target].hits["head"] &gt;= 100) and tneedle &gt;= 50 then
tdispatch = true
--Target is prone, but head is not broke nor crushedthroat, this needs to be done in gaital form and parry doesn't matter because of prone
elseif affstrack.score.prone &gt;= 100 and (lb[target].hits["head"] &lt; 100) and tneedle &lt;= 50 then
aneedle = true
aspinkick = true
-- We broke left level 2 before
akuroright = true
sform = "gaital"
--If Target is NOT prone, but both legs and head are prepped and parry doesn't matter due to sweep. This has to be done in Gaital form as Oak form doesn't have a prone ability
elseif affstrack.score.prone&lt;100 and (lb[target].hits["right leg"] &gt;= 90 or lb[target].hits["left leg"] &gt;= 90 and lb[target].hits["head"] &gt;= 90) then
asweep = true
-- Break Left First
aflashheelleft = true
sform = "gaital"
elseif (lb[target].hits["right leg"] &lt;= 89 and lb[target].hits["left leg"] &lt;= 89 and lb[target].hits["head"] &lt;= 90) then


  end
end

-- We may want to just manual the prep 
-- without a target parrying
-- Spinkick gives 40 percent limb damage to head when on ground -- only need to prep head to 60 before spinkick

-- Willow gives me 3 full combos - at the end 61.8 Head and 42 Left Leg | combo totto flashheel left hiru hiraku x 3 | transition at 9 to rain

-- Rain gives me 8 Full combos (if you want) - at the end Head 97.2 and Left Leg 94.5 and right leg 60
-- combo totto flashheel left hiru  x 1 for Head
-- combo aegoth frontkick left kuro left kuro left
-- combo aegoth frontkick left kuro right kuro right x 3</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Levi Dispatch</name>
											<packageName></packageName>
											<script>function levishikudodispatch()
--Get Stance
shikudostance = string.match(gmcp.Char.Vitals.charstats[4],"Form\: (%w+)")
--Get Kata Chain
katachain = tonumber(string.match(gmcp.Char.Vitals.charstats[5],"Kata\: (%d+)"))

--Call Other Functions
kickshikudoattack()
shikudostaffstrike()
shikudostafftwo()

-- If using Romaen's Limb Counter then the limb prep will be if lb[target].hits["right leg"] &gt;= 90
-- Lowest Damage Point is 10.1 damage per limb

-- For dispatch we will need prone, level 2 head and needle. So at the very least it would be break right leg in Oak, switch to Gaital, Break second leg/prone/, Spinkick break head/needle, dispatch
-- Only use spinkick as a level 2 to level 3 break due to balance
if tAffs.shield then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " shatter " ..kicked.. " ;assess " ..target)
--All variables for Dispatch are true
-- We have to check the number for level 3 Head break
elseif shikudostance == "Gaital" and tAffs.prone and (lb[target].hits["head"] &gt;= 100 or tAffs.damagedhead) and tneedle &gt;= 50 then
send("queue addclear free stand;stand;wield staff489282;dispatch " ..target)
--Target is prone, but head is not broke nor crushedthroat, this needs to be done in Gaital form and parry doesn't matter because of prone
-- Needle is 18 Head Damage for me
elseif shikudostance == "Gaital" and tAffs.prone and (lb[target].hits["head"] &gt;= 70 ) and tneedle &lt;= 50 then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " needle needle spinkick ;assess " ..target)

-- If target is prone and one leg is level 2. The other limb is prepped and head is prepped
elseif shikudostance == "Gaital" and tAffs.prone and (lb[target].hits["right leg"] &gt;= 89 and lb[target].hits["left leg"] &lt;= 100) and (lb[target].hits["head"] &gt;= 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " needle kuro right flashheel right ;assess " ..target)
elseif shikudostance == "Gaital" and tAffs.prone and (lb[target].hits["left leg"] &gt;= 89 and lb[target].hits["right leg"] &lt;= 100) and (lb[target].hits["head"] &gt;= 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " needle kuro left flashheel left ;assess " ..target)

--If Target is NOT prone, one leg is broke and one is prepped legs and head are prepped and parry doesn't matter due to sweep. This has to be done in Gaital form as Oak form doesn't have a prone ability
elseif shikudostance == "Gaital" and not tAffs.prone and (lb[target].hits["left leg"] &gt;= 100 and lb[target].hits["right leg"] &gt;= 89 ) and (lb[target].hits["head"] &gt;= 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " sweep flashheel right ;assess " ..target)
--If Target is NOT prone, but both legs and head are prepped and parry doesn't matter due to sweep. This has to be done in Gaital form as Oak form doesn't have a prone ability
elseif shikudostance == "Gaital" and not tAffs.prone and (lb[target].hits["left leg"] &gt;= 89 and lb[target].hits["right leg"] &gt;= 89 ) and (lb[target].hits["head"] &gt;= 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " sweep flashheel right ;assess " ..target)
-- IF Oak Stance and all limbs are prepped and kata is higher than 5 then transition
elseif shikudostance == "Oak" and (lb[target].hits["left leg"] &gt;= 89 and lb[target].hits["right leg"] &gt;= 89 ) and (lb[target].hits["head"] &gt;= 89) and katachain &gt;= 5 then
send("queue addclear free stand;stand;wield staff489282;transition to the Gaital form;combo " ..target.. " sweep flashheel left ;assess " ..target)
-- If Oak Stance and we will need a limb but have to transition
elseif shikudostance == "Oak" and (lb[target].hits["left leg"] &gt;= 89 and lb[target].hits["right leg"] &gt;= 89 ) and (lb[target].hits["head"] &lt;= 89) and katachain &gt;= 10 then
send("queue addclear free stand;stand;wield staff489282;transition to the Gaital form;combo " ..target.. " needle ruku left flashheel left ;assess " ..target)

-- Nervestrike is head damage
elseif shikudostance == "Oak" and (lb[target].hits["left leg"] &gt;= 89 and lb[target].hits["right leg"] &lt;= 77) and (lb[target].hits["head"] &lt; 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " kuro right kuro right risingkick head;assess " ..target)
elseif shikudostance == "Oak" and (lb[target].hits["left leg"] &lt;= 77 and lb[target].hits["right leg"] &gt;= 89) and (lb[target].hits["head"] &lt; 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " kuro left kuro left risingkick head;assess " ..target)
elseif shikudostance == "Oak" and (lb[target].hits["left leg"] &gt;= 89 and lb[target].hits["right leg"] &lt;= 80) and (lb[target].hits["head"] &gt;= 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " livestrike kuro right risingkick torso;assess " ..target)
elseif shikudostance == "Oak" and (lb[target].hits["left leg"] &lt;= 80 and lb[target].hits["right leg"] &gt;= 89) and (lb[target].hits["head"] &gt;= 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " livestrike kuro left risingkick torso;assess " ..target)
elseif shikudostance == "Oak" and (lb[target].hits["left leg"] &gt;= 89 and lb[target].hits["right leg"] &gt;= 89) and (lb[target].hits["head"] &lt;= 70) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " nervestrike ruku torso risingkick head;assess " ..target)
elseif shikudostance == "Oak" and (lb[target].hits["left leg"] &lt; 89 and lb[target].hits["right leg"] &lt; 89) and (lb[target].hits["head"] &lt; 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " kuro right kuro left risingkick head;assess " ..target)
elseif shikudostance == "Oak" and (lb[target].hits["head"] &lt;= 50) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " livestrike livestrike risingkick head;assess " ..target)
elseif shikudostance == "Oak" and (lb[target].hits["head"] &lt;= 88) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " livestrike nervestrike risingkick torso;assess " ..target)
-- If Rain stance and not prepped and at 24 kata
elseif shikudostance == "Rain" and (lb[target].hits["left leg"] &lt;= 89 or lb[target].hits["right leg"] &lt;= 89) and (lb[target].hits["head"] &lt;= 89) and katachain &gt;= 22 then
send("queue addclear free stand;stand;wield staff489282;transition to the Oak form;combo " ..target.. " nervestrike nervestrike risingkick head ;assess " ..target)
--if Rain Stance and all everything is met and kata at 5
elseif shikudostance == "Rain" and (lb[target].hits["left leg"] &gt;= 89 and lb[target].hits["right leg"] &gt;= 89) and (lb[target].hits["head"] &gt;= 89) and katachain &gt;= 5 then
send("queue addclear free stand;stand;wield staff489282;transition to the Oak form;combo " ..target.. " livestrike livestrike risingkick torso ;assess " ..target)
--if Rain Stance Legs and Head Not Prepped Do it
elseif shikudostance == "Rain" and (lb[target].hits["left leg"] &gt;= 89 and lb[target].hits["right leg"] &lt;= 70) and (lb[target].hits["head"] &lt; 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " frontkick left kuro right kuro right ;assess " ..target)
elseif shikudostance == "Rain" and (lb[target].hits["left leg"] &lt;= 75 and lb[target].hits["right leg"] &gt;= 89) and (lb[target].hits["head"] &lt; 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " frontkick right kuro left kuro left;assess " ..target)
elseif shikudostance == "Rain" and (lb[target].hits["left leg"] &gt;= 89 and lb[target].hits["right leg"] &lt;= 80) and (lb[target].hits["head"] &gt;= 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " frontkick left ruku torso kuro right;assess " ..target)
elseif shikudostance == "Rain" and (lb[target].hits["left leg"] &lt;= 80 and lb[target].hits["right leg"] &gt;= 89) and (lb[target].hits["head"] &gt;= 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " frontkick left ruku torso kuro left;assess " ..target)
elseif shikudostance == "Rain" and (lb[target].hits["left leg"] &gt;= 89 and lb[target].hits["right leg"] &gt;= 89) and (lb[target].hits["head"] &lt;= 70) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " frontkick left hiru hiru ;assess " ..target)
elseif shikudostance == "Rain" and (lb[target].hits["left leg"] &lt; 89 and lb[target].hits["right leg"] &lt; 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " frontkick left kuro right kuro left ;assess " ..target)
elseif shikudostance == "Rain" and (lb[target].hits["head"] &lt; 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " frontkick left hiru hiru;assess " ..target)


-- If Willow Stance and at 10 or above kata
elseif shikudostance == "Willow" and (lb[target].hits["left leg"] &lt; 89) and (lb[target].hits["right leg"] &lt; 89) and (lb[target].hits["head"] &lt; 89) and katachain &gt;= 10 then
send("queue addclear free stand;stand;wield staff489282;transition to the Rain form;combo " ..target.. " kuro right kuro left frontkick left;assess " ..target)
elseif shikudostance == "Willow" and (lb[target].hits["left leg"] &lt; 89) and (lb[target].hits["right leg"] &lt; 89) and (lb[target].hits["head"] &gt; 89) and katachain &gt;= 10 then
send("queue addclear free stand;stand;wield staff489282;transition to the Rain form;combo " ..target.. " kuro right kuro left frontkick left;assess " ..target)
elseif shikudostance == "Willow" and (lb[target].hits["left leg"] &lt; 89) and (lb[target].hits["right leg"] &lt; 89) and katachain &gt;= 10 then
send("queue addclear free stand;stand;wield staff489282;transition to the Rain form;combo " ..target.. " kuro right kuro left frontkick left;assess " ..target)
elseif shikudostance == "Willow" and (lb[target].hits["left leg"] &gt; 89) and (lb[target].hits["right leg"] &gt; 89) and (lb[target].hits["head"] &gt; 70) and katachain &gt;= 10 then
send("queue addclear free stand;stand;wield staff489282;transition to the Rain form;combo " ..target.. " hiru hiru frontkick left;assess " ..target)
elseif shikudostance == "Willow" and  katachain &gt;= 10 then
send("queue addclear free stand;stand;wield staff489282;transition to the Rain form;combo " ..target.. " ruku left ruku left frontkick left;assess " ..target)
--If Willow Stance
elseif shikudostance == "Willow" and (lb[target].hits["left leg"] &lt; 60) and (lb[target].hits["right leg"]) &lt; 60 and (lb[target].hits["head"] &gt; 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " dart right dart right flashheel left;assess " ..target)
elseif shikudostance == "Willow" and (lb[target].hits["left leg"] &lt; 62) and (lb[target].hits["right leg"]) &gt; 89 and (lb[target].hits["head"] &gt; 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " dart left dart left flashheel left;assess " ..target)
elseif shikudostance == "Willow" and (lb[target].hits["left leg"] &gt; 89) and (lb[target].hits["right leg"]) &lt; 62 and (lb[target].hits["head"] &gt; 89) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " dart right dart right flashheel right;assess " ..target)
elseif shikudostance == "Willow" and (lb[target].hits["left leg"] &gt; 89) and (lb[target].hits["right leg"]) &lt; 70 and (lb[target].hits["head"] &lt; 70) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " hiru hiraku flashheel right;assess " ..target)
elseif shikudostance == "Willow" and (lb[target].hits["left leg"] &lt; 70) and (lb[target].hits["right leg"]) &gt; 89 and (lb[target].hits["head"] &lt; 70) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " hiru hiraku flashheel left;assess " ..target)
elseif shikudostance == "Willow" and (lb[target].hits["left leg"] &lt; 88) and (lb[target].hits["right leg"]) &lt; 88 and (lb[target].hits["head"] &lt; 88) then
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " hiru hiraku flashheel left;assess " ..target)

-- Else attack light where I can
else
send("queue addclear free stand;stand;wield staff489282;combo " ..target.. " " ..kicked.. " " ..staff.. " light " ..stafftwo.. " light;assess " ..target)

end

end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Shikudo Needle Logic</name>
											<packageName></packageName>
											<script>function levishikudoneedle()
--Get Stance
--ataxia.vitals.form
--Get Kata Chain
--ataxia.vitals.kata

--Set Target Limb Parry
ataxiaTemp.parriedLimb = ataxiaTemp.parriedLimb or "none"


--ataxia_resetLimbTable()
 -- ataxiaTables.limbData

shikDart = ataxiaTables.limbData.shikDart
shikFlashheel = ataxiaTables.limbData.shikFlashheel
shikFrontkick = ataxiaTables.limbData.shikFrontkick
shikHiraku = ataxiaTables.limbData.shikHiraku
shikHiru = ataxiaTables.limbData.shikHiru
shikJinzuku = ataxiaTables.limbData.shikJinzuku
shikKuro = ataxiaTables.limbData.shikKuro
shikLivestrike = ataxiaTables.limbData.shikLivestrike
shikNeedle = ataxiaTables.limbData.shikNeedle
shikNervestrike = ataxiaTables.limbData.shikNervestrike
shikRisingkick = ataxiaTables.limbData.shikRisingkick
shikRuku = ataxiaTables.limbData.shikRuku
shikSpinkickHead = ataxiaTables.limbData.shikSpinkickHead
shikSpinkickTorso = ataxiaTables.limbData.shikSpinkickTorso
shikThrust = ataxiaTables.limbData.shikThrust

-- Set Prepped
  --Head Staff
if lb[target].hits["head"] + shikNervestrike &gt;= 100 and not tAffs.damagedhead then 
shikNervestrikeprepped_head = true else
shikNervestrikeprepped_head = false
end
if lb[target].hits["head"] + shikNervestrike + shikRisingkick &gt;= 100 and not tAffs.damagedhead then 
shikNervestrike2prepped_head = true else
shikNervestrike2prepped_head = false
end
if lb[target].hits["head"] + shikRisingkick &gt;= 100 and not tAffs.damagedhead then 
shikRisingkickprepped_head = true else
shikRisingkickprepped_head = false
end
if lb[target].hits["head"] + shikNeedle &gt;= 100 and not tAffs.damagedhead then 
shikNeedleprepped_head = true else
shikNeedleprepped_head = false
end
if lb[target].hits["head"] + shikNeedle + shikNeedle &gt;= 100 and not tAffs.damagedhead then 
shikNeedle2prepped_head = true else
shikNeedle2prepped_head = false
end
if lb[target].hits["head"] + shikHiru &gt;= 100 and not tAffs.damagedhead then 
shikHiruprepped_head = true else
shiHiruprepped_head = false
end
if lb[target].hits["head"] + shikHiru + shikHiru &gt;= 100 and not tAffs.damagedhead then 
shikHiru2prepped_head = true else
shiHiru2prepped_head = false
end
if lb[target].hits["head"] + shikHiru + shikHiraku &gt;= 100 and not tAffs.damagedhead then 
shikHiru3prepped_head = true else
shiHiru3prepped_head = false
end
if lb[target].hits["head"] + shikHiraku &gt;= 100 and not tAffs.damagedhead then 
shikHirakuprepped_head = true else
shikHirakuprepped_head = false
end
if lb[target].hits["head"] + shikHiraku + shikHiraku &gt;= 100 and not tAffs.damagedhead then 
shikHiraku2prepped_head = true else
shikHiraku2prepped_head = false
end
if lb[target].hits["head"] + shikHiru + shikHiraku &gt;= 100 and not tAffs.damagedhead then 
shikHiraku3prepped_head = true else
shikHiraku3prepped_head = false
end

--Torso
if lb[target].hits["torso"] + shikRuku &gt;= 100 and not tAffs.mildtramua then 
shikRukuprepped_torso = true else
shikRukuprepped_torso = false
end
if lb[target].hits["torso"] + shikRuku + shikRuku &gt;= 100 and not tAffs.mildtramua then 
shikRuku2prepped_torso = true else
shikRuku2prepped_torso = false
end

if lb[target].hits["torso"] + shikSpinkickTorso &gt;= 100 and not tAffs.mildtramua then 
shikSpinkickTorsoprepped_torso = true else
shikSpinkickTorsoprepped_torso = false
end
if lb[target].hits["torso"] + shikLivestrike &gt;= 100 and not tAffs.mildtramua then 
shikLivestrikeprepped_torso = true else
shikLivestrikeprepped_torso = false
end
if lb[target].hits["torso"] + shikLivestrike + shikLivestrike &gt;= 100 and not tAffs.mildtramua then 
shikLivestrike2prepped_torso = true else
shikLivestrike2prepped_torso = false
end

if lb[target].hits["torso"] + shikJinzuku &gt;= 100 and not tAffs.mildtramua then 
shikJinzukuprepped_torso = true else
shikJinzukuprepped_torso = false
end
if lb[target].hits["torso"] + shikJinzuku + shikJinzuku &gt;= 100 and not tAffs.mildtramua then 
shikJinzuku2prepped_torso = true else
shikJinzuku2prepped_torso = false
end

if lb[target].hits["torso"] + shikJinzuku + shikLivestrike &gt;= 100 and not tAffs.mildtramua then 
shikJinzuku3prepped_torso = true else
shikJinzuku3prepped_torso = false
end

--Left Leg
if lb[target].hits["left leg"] + shikKuro &gt;= 100 and not tAffs.damagedleftleg then 
shikKuroprepped_leftleg = true else
shikKuroprepped_leftleg = false
end
if lb[target].hits["left leg"] + shikKuro + shikKuro &gt;= 100 and not tAffs.damagedleftleg then 
shikKuro2prepped_leftleg = true else
shikKuro2prepped_leftleg = false
end
if lb[target].hits["left leg"] + shikFlashheel &gt;= 100 and not tAffs.damagedleftleg then 
shikFlashheelprepped_leftleg = true else
shikFlashheelprepped_leftleg = false
end

if lb[target].hits["left leg"] + shikFlashheel + shikKuro &gt;= 100 and not tAffs.damagedleftleg then 
shikFlashheelprepped_leftleg = true else
shikFlashheelprepped_leftleg = false
end

--Right Leg
if lb[target].hits["right leg"] + shikKuro &gt;= 100 and not tAffs.damagedrightleg then 
shikKuroprepped_rightleg = true else
shikKuroprepped_rightleg = false
end

if lb[target].hits["right leg"] + shikKuro + shikKuro &gt;= 100 and not tAffs.damagedrightleg then 
shikKuro2prepped_rightleg = true else
shikKuro2prepped_rightleg = false
end

if lb[target].hits["right leg"] + shikFlashheel &gt;= 100 and not tAffs.damagedrightleg then 
shikFlashheelprepped_rightleg = true else
shikFlashheelprepped_rightleg = false
end

--Left Arm
if lb[target].hits["left arm"] + shikFrontkick &gt;= 100 and not tAffs.damagedleftarm then 
shikFrontkickprepped_leftarm = true else
shikFrontkickprepped_leftarm = false
end
if lb[target].hits["left arm"] + shikRuku &gt;= 100 and not tAffs.damagedleftarm then 
shikRukuprepped_leftarm = true else
shikRukuprepped_leftarm = false
end

if lb[target].hits["left arm"] + shikRuku + shikFrontkick &gt;= 100 and not tAffs.damagedleftarm then 
shikRuku3prepped_leftarm = true else
shikRuku3prepped_leftarm = false
end

if lb[target].hits["left arm"] + shikRuku + shikRuku &gt;= 100 and not tAffs.damagedleftarm then 
shikRuku2prepped_leftarm = true else
shikRuku2prepped_leftarm = false
end

--Right Arm
if lb[target].hits["right arm"] + shikFrontkick &gt;= 100 and not tAffs.damagedrightarm then 
shikFrontkickprepped_rightarm = true else
shikFrontkickprepped_rightarm = false
end
if lb[target].hits["right arm"] + shikRuku &gt;= 100 and not tAffs.damagedrightarm then 
shikRukuprepped_rightarm = true else
shikRukuprepped_rightarm = false
end

if lb[target].hits["right arm"] + shikRuku + shikFrontkick &gt;= 100 and not tAffs.damagedrightarm then 
shikRuku3prepped_rightarm = true else
shikRuku3prepped_rightarm = false
end

if lb[target].hits["right arm"] + shikRuku + shikRuku &gt;= 100 and not tAffs.damagedrightarm then 
shikRuku2prepped_rightarm = true else
shikRuku2prepped_rightarm = false
end


--Set Kicked Table
shikudokick = {}

if ataxia.vitals.form == "Rain" then
  if tAffs.prone and tAffs.damagedrightleg or lb[target].hits["right leg"] &gt;= 100 and not tAffs.damageleftleg or lb[target].hits["left leg"] &gt;= 100 then
    table.insert(shikudokick, "frontkick left")
  elseif tAffs.prone and tAffs.damagedleftleg or lb[target].hits["left leg"] &gt;= 100 and not tAffs.damagerightleg or lb[target].hits["right leg"] &gt;= 100 then
    table.insert(shikudokick, "frontkick right")
  elseif shikRuku3prepped_leftarm and ataxiaTemp.parriedLimb ~= "left arm" then
    table.insert(shikudokick, "frontkick left")
  elseif shikRuku3prepped_rightarm and ataxiaTemp.parriedLimb ~= "right arm" then
    table.insert(shikudokick, "frontkick right")
  elseif shikFrontkickprepped_leftarm and not shikFrontkickprepped_rightarm and ataxiaTemp.parriedLimb ~= "right arm" then
    table.insert(shikudokick, "frontkick right")
  elseif not shikFrontkickprepped_leftarm and shikFrontkickprepped_rightarm and ataxiaTemp.parriedLimb ~= "left arm" then
    table.insert(shikudokick, "frontkick left")
  elseif not shikFrontkickprepped_leftarm and ataxiaTemp.parriedLimb ~= "left arm" then
    table.insert(shikudokick, "frontkick left")
  elseif not shikFrontkickprepped_rightarm and ataxiaTemp.parriedLimb ~= "right arm" then
    table.insert(shikudokick, "frontkick right")
  end
elseif ataxia.vitals.form == "Oak" then
  if shikNervestrike2prepped_head and ataxiaTemp.parriedLimb ~= "head" then
    table.insert(shikudokick, "risingkick head")
  elseif shikRisingkickprepped_head and ataxiaTemp.parriedLimb ~= "torso" then
    table.insert(shikudokick, "risingkick torso")
  elseif not shikRisingkickprepped_head and ataxiaTemp.parriedLimb ~= "head" then
    table.insert(shikudokick, "risingkick head")
  end
elseif ataxia.vitals.form == "Gaital" then
  if tAffs.prone and (lb[target].hits["head"] &gt;= 100 or tAffs.damagedhead) then
    table.insert(shikudokick, "spinkick")
  elseif tAffs.prone and shikFlashheelprepped_rightleg and tAffs.damagedleftleg or lb[target].hits["left leg"] &gt;= 100 then
    table.insert(shikudokick, "flashheel right")
  elseif tAffs.prone and shikFlashheelprepped_leftleg and tAffs.damagedrightleg or lb[target].hits["right leg"] &gt;= 100 then
    table.insert(shikudokick, "flashheel left")
  elseif not tAffs.prone and shikFlashheelprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" and shikFlashheelprepped_leftleg and shikRukuprepped_rightarm and shikRukuprepped_leftarm  then
    table.insert(shikudokick, "flashheel right")
  elseif not tAffs.prone and shikFlashheelprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" and shikFlashheelprepped_rightleg and shikRukuprepped_rightarm and shikRukuprepped_leftarm  then
    table.insert(shikudokick, "flashheel left")
  else
    table.insert(shikudokick, "dawnkick")
  end
elseif ataxia.vitals.form == "Maelstrom" then
  if php &lt;= 40 then 
    table.insert(shikudokick, "crescent")
  elseif shikRisingkickprepped_head and ataxiaTemp.parriedLimb ~= "torso" then
    table.insert(shikudokick, "risingkick torso")
  elseif not shikRisingkickprepped_head and ataxiaTemp.parriedLimb ~= "head" then
    table.insert(shikudokick, "risingkick head")
  end
elseif ataxia.vitals.form == "Willow" then
  if shikFlashheelprepped_leftleg and not shikFlashheelprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" then
    table.insert(shikudokick, "flashheel right")
  elseif not shikFlashheelprepped_leftleg and shikFlashheelprepped_rightleg and ataxiaTemp.parriedLimb ~= "left leg" then
    table.insert(shikudokick, "flashheel left")
  elseif not shikFlashheelprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" then
    table.insert(shikudokick, "flashheel left")
  elseif not shikFlashheelprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" then
    table.insert(shikudokick, "flashheel right")
  end
elseif ataxia.vitals.form == "Tykonos" then
  table.insert(shikudokick, "risingkick torso")
end


--Set Staff One Table
shikudostaffone = {}

if ataxia.vitals.form == "Rain" then
  if not shikKuro2prepped_leftleg and shikKuro2prepped_rightleg and ataxiaTemp.parriedLimb ~= "left leg" then
    table.insert(shikudostafftwo, "kuro left")
  elseif shikKuro2prepped_leftleg and not shikKuro2prepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" then
    table.insert(shikudostafftwo, "kuro right")
  elseif not shikKuroprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" then
    table.insert(shikudostaffone, "kuro left")
  elseif not shikKuroprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" then
    table.insert(shikudostaffone, "kuro right")
  elseif not shikHiruprepped_head and ataxiaTemp.parriedLimb ~= "head" then
    table.insert(shikudostaffone, "hiru")
  elseif not shikRukuprepped_rightarm and ataxiaTemp.parriedLimb ~= "right arm" and not shikFrontkickprepped_rightarm then
    table.insert(shikudostaffone, "ruku right")
  elseif not shikRukuprepped_leftarm and ataxiaTemp.parriedLimb ~= "left arm" and not shikFrontkickprepped_leftarm then
    table.insert(shikudostaffone, "ruku left")
  else
    table.insert(shikudostaffone, "ruku torso")
  end
elseif ataxia.vitals.form == "Gaital" then
  if (lb[target].hits["head"] &gt;= 100 or tAffs.damagedhead) and not tAffs.prone then
    table.insert(shikudostaffone, "sweep")
  elseif tAffs.prone and (lb[target].hits["head"] &gt;= 100 or tAffs.damagedhead or tAffs.mangledhead) and not tAffs.crushedthroat then
    table.insert(shikudostaffone, "needle")
  elseif tAffs.prone and tAffs.damagedrightleg and tAffs.damageleftleg and shikRukuprepped_rightarm and not tAffs.damagedrightarm then
    table.insert(shikudostaffone, "ruku right")
  elseif tAffs.prone and tAffs.damagedrightleg and tAffs.damageleftleg and shikRukuprepped_leftarm and not tAffs.damagedleftarm then
    table.insert(shikudostaffone, "ruku left")
  elseif not tAffs.prone and shikFlashheelprepped_leftleg and shikFlashheelprepped_rightleg and shikRukuprepped_rightarm and shikRukuprepped_leftarm  then 
    table.insert(shikudostaffone, "sweep")
  elseif not tAffs.prone and shikFlashheelprepped_rightleg  and shikFlashheelprepped_leftleg and shikRukuprepped_rightarm and shikRukuprepped_leftarm  then
    table.insert(shikudostaffone, "sweep")
  elseif shikNeedle2prepped_head then
    table.insert(shikudostaffone, "needle")
  elseif shikNeedleprepped_head then
    table.insert(shikudostaffone, "needle")
  elseif tAffs.prone and (lb[target].hits["head"] &gt;= 100 or tAffs.damagedhead) and tAffs.crushedthroat then
    table.insert(shikudostaffone, "ruku torso")
  end
elseif ataxia.vitals.form == "Maelstrom" then
  if php &lt;= 40 then
    table.insert(shikudostaffone, "sweep")
  elseif not shikRukuprepped_rightarm and ataxiaTemp.parriedLimb ~= "right arm" then
    table.insert(shikudostaffone, "ruku right")
  elseif not shikRukuprepped_rightarm and ataxiaTemp.parriedLimb ~= "left arm" then
    table.insert(shikudostaffone, "ruku left")
  elseif not tAffs.asthma then
    table.insert(shikudostaffone, "livestrike")
  elseif not tAffs.slickness then
    table.insert(shikudostaffone, "ruku torso")
  elseif not tAffs.addiction then
    table.insert(shikudostaffone, "jinzuku")
  else
    table.insert(shikudostaffone, "sweep")
  end
elseif ataxia.vitals.form == "Oak" then
  if shikKuro2prepped_leftleg and not shikKuro2prepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" then
    table.insert(shikudostaffone, "kuro right")
  elseif not shikKuro2prepped_leftleg and not shikKuro2prepped_rightleg and ataxiaTemp.parriedLimb ~= "left leg" then
    table.insert(shikudostaffone, "kuro left")
  elseif shikNervestrike2prepped_head and ataxiaTemp.parriedLimb ~= "head" then
    table.insert(shikudostaffone, "livestrike")
  elseif not shikKuroprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" then
    table.insert(shikudostaffone, "kuro left")
  elseif not shikKuroprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" then
    table.insert(shikudostaffone, "kuro right")
  elseif not shikNervestrike2prepped_head and ataxiaTemp.parriedLimb ~= "head" then
    table.insert(shikudostaffone, "nervestrike")
  elseif not shikRukuprepped_rightarm and ataxiaTemp.parriedLimb ~= "right arm" then
    table.insert(shikudostaffone, "ruku right")
  elseif not shikRukuprepped_leftarm and ataxiaTemp.parriedLimb ~= "left arm" then
    table.insert(shikudostaffone, "ruku left")
  else 
    table.insert(shikudostaffone, "livestrike")
  end
elseif ataxia.vitals.form == "Willow" then
  if not tAffs.prone and shikFlashheelprepped_leftleg and shikFlashheelprepped_rightleg and shikRukuprepped_rightarm and shikRukuprepped_leftarm  then 
    table.insert(shikudostaffone, "sweep")
  elseif not tAffs.prone and shikFlashheelprepped_rightleg and shikFlashheelprepped_leftleg and shikRukuprepped_rightarm and shikRukuprepped_leftarm  then
    table.insert(shikudostaffone, "sweep")
  elseif shikHiruprepped_head then
    table.insert(shikudostaffone, "dart torso")
  elseif not shikHiruprepped_head then
    table.insert(shikudostaffone, "hiru")
  else 
    table.insert(shikudostaffone, "sweep")
  end
end


--Set Staff Two Table
shikudostafftwo = {}

if ataxia.vitals.form == "Rain" then
  if not shikKuro2prepped_leftleg and shikKuro2prepped_rightleg and ataxiaTemp.parriedLimb ~= "left leg" and shikudostaffone[1] ~= "kuro right" then
    table.insert(shikudostafftwo, "kuro left")
  elseif shikKuro2prepped_leftleg and not shikKuro2prepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" and shikudostaffone[1] ~= "kuro right" then
    table.insert(shikudostafftwo, "kuro right")
  elseif not shikKuroprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" and shikudostaffone[1] ~= "kuro left" then
    table.insert(shikudostafftwo, "kuro left")
  elseif not shikKuroprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" and shikudostaffone[1] ~= "kuro right" then
    table.insert(shikudostafftwo, "kuro right")
  elseif not shikHiruprepped_head and ataxiaTemp.parriedLimb ~= "head" and shikudostaffone[1] ~= "hiru" then
    table.insert(shikudostafftwo, "hiru")
  elseif not shikRukuprepped_rightarm and ataxiaTemp.parriedLimb ~= "right arm" and not shikFrontkickprepped_rightarm then
    table.insert(shikudostafftwo, "ruku right")
  elseif not shikRukuprepped_leftarm and ataxiaTemp.parriedLimb ~= "left arm" and not shikFrontkickprepped_leftarm then
    table.insert(shikudostafftwo, "ruku left")
  else
    table.insert(shikudostafftwo, "ruku torso")
  end
elseif ataxia.vitals.form == "Gaital" then
  if (lb[target].hits["head"] &gt;= 100 or tAffs.damagedhead) and not tAffs.prone then
    table.insert(shikudostafftwo, "sweep")
  elseif tAffs.prone and (lb[target].hits["head"] &gt;= 100 or tAffs.damagedhead or tAffs.mangledhead) and not tAffs.crushedthroat and shikudostaffone[1] ~= "needle" then
    table.insert(shikudostafftwo, "needle")
  elseif tAffs.prone and tAffs.damagedrightleg and tAffs.damageleftleg and shikRukuprepped_rightarm and not tAffs.damagedrightarm and shikudostaffone[1] ~= "ruku right" then
    table.insert(shikudostafftwo, "ruku right")
  elseif tAffs.prone and tAffs.damagedrightleg and tAffs.damageleftleg and shikRukuprepped_leftarm and not tAffs.damagedleftarm and shikudostaffone[1] ~= "ruku left" then
    table.insert(shikudostafftwo, "ruku left")
  elseif not tAffs.prone and shikFlashheelprepped_leftleg and shikFlashheelprepped_rightleg and shikRukuprepped_rightarm and shikRukuprepped_leftarm  then 
    table.insert(shikudostafftwo, "sweep")
  elseif not tAffs.prone and shikFlashheelprepped_rightleg  and shikFlashheelprepped_leftleg and shikRukuprepped_rightarm and shikRukuprepped_leftarm  then
    table.insert(shikudostafftwo, "sweep")
  elseif shikNeedle2prepped_head and shikudostaffone[1] ~= "needle" then
    table.insert(shikudostafftwo, "needle")
  elseif shikNeedleprepped_head then
    table.insert(shikudostafftwo, "needle")
  elseif tAffs.prone and (lb[target].hits["head"] &gt;= 100 or tAffs.damagedhead) and tAffs.crushedthroat then
    table.insert(shikudostafftwo, "ruku torso")
  end
elseif ataxia.vitals.form == "Maelstrom" then
  if php &lt;= 40 then
    table.insert(shikudostafftwo, "sweep")
  elseif not shikRuku2prepped_rightarm and ataxiaTemp.parriedLimb ~= "right arm" then
    table.insert(shikudostafftwo, "ruku right")
  elseif shikRuku2prepped_rightarm and ataxiaTemp.parriedLimb ~= "left arm" and shikudostaffone[1] ~= "ruku left" then
    table.insert(shikudostafftwo, "ruku left")
  elseif shikRukuprepped_rightarm and ataxiaTemp.parriedLimb ~= "right arm" and shikudostaffone[1] ~= "ruku right" then
    table.insert(shikudostafftwo, "ruku right")
  elseif not shikRukuprepped_rightarm and ataxiaTemp.parriedLimb ~= "left arm" then
    table.insert(shikudostafftwo, "ruku left")
  elseif not tAffs.asthma and shikudostaffone[1] ~= "livestrike" then
    table.insert(shikudostafftwo, "livestrike")
  elseif not tAffs.slickness then
    table.insert(shikudostafftwo, "ruku torso")
  elseif not tAffs.addiction and shikudostaffone[1] ~= "jinzuku" then
    table.insert(shikudostafftwo, "jinzuku")
  else
    table.insert(shikudostafftwo, "jinzuku")
  end
elseif ataxia.vitals.form == "Oak" then
  if shikKuro2prepped_leftleg and not shikKuro2prepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" and shikudostaffone[1] ~= "kuro right" then
    table.insert(shikudostafftwo, "kuro right")
  elseif not shikKuro2prepped_leftleg and not shikKuro2prepped_rightleg and ataxiaTemp.parriedLimb ~= "left leg" and shikudostaffone[1] ~= "kuro left" then
    table.insert(shikudostafftwo, "kuro left")
  elseif not shikKuroprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" then
    table.insert(shikudostafftwo, "kuro left")
  elseif not shikKuroprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" then
    table.insert(shikudostafftwo, "kuro right")
  elseif shikNervestrike2prepped_head and ataxiaTemp.parriedLimb ~= "head" and shikudostaffone[1] ~= "livestrike" then
    table.insert(shikudostafftwo, "livestrike")
  elseif not shikNervestrike2prepped_head and ataxiaTemp.parriedLimb ~= "head" and shikudostaffone[1] ~= "nervestrike" then
    table.insert(shikudostafftwo, "nervestrike")
  elseif not shikRuku2prepped_rightarm and ataxiaTemp.parriedLimb ~= "right arm" then
    table.insert(shikudostafftwo, "ruku right")
  elseif not shikRuku2prepped_leftarm and ataxiaTemp.parriedLimb ~= "left arm" then
    table.insert(shikudostafftwo, "ruku left")
  elseif not shikRukuprepped_rightarm and ataxiaTemp.parriedLimb ~= "right arm" and shikudostaffone[1] ~= "ruku right" then
    table.insert(shikudostafftwo, "ruku right")
  elseif not shikRukuprepped_leftarm and ataxiaTemp.parriedLimb ~= "left arm" and shikudostaffone[1] ~= "ruku left" then
    table.insert(shikudostafftwo, "ruku left")
  else 
    table.insert(shikudostafftwo, "livestrike")
  end
elseif ataxia.vitals.form == "Willow" then
  if not tAffs.prone and shikFlashheelprepped_leftleg and shikFlashheelprepped_rightleg and shikRukuprepped_rightarm and shikRukuprepped_leftarm  then 
    table.insert(shikudostafftwo, "sweep")
  elseif not tAffs.prone and shikFlashheelprepped_rightleg and shikFlashheelprepped_leftleg and shikRukuprepped_rightarm and shikRukuprepped_leftarm  then
    table.insert(shikudostafftwo, "sweep")
  elseif shikHirakuprepped_head then
    table.insert(shikudostafftwo, "dart torso")
  elseif not shikHirakuprepped_head and shikudostaffone[1] ~= "hiraku" then
    table.insert(shikudostafftwo, "hiraku")
  else 
    table.insert(shikudostafftwo, "dart torso")
  end
end

levishikudoneedleattack()
end


function levishikudoneedleattack()
local atk = combatQueue()

if tAffs.shield then
  atk = atk.."wield staff489282;combo " ..target.. " shatter " ..shikudokick[1].. " " ..shikudostaffone[1]
elseif not tAffs.prone and shikFlashheelprepped_leftleg and shikFlashheelprepped_rightleg and shikRukuprepped_rightarm and shikRukuprepped_leftarm and ataxia.vitals.form == "Oak" and ataxia.vitals.kata &gt;= 2 then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1].. ";transition to the gaital form "  

elseif ataxia.vitals.kata == 21 and ataxia.vitals.form == "Gaital" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1].. ";transition to the willow form "  
elseif ataxia.vitals.kata &gt;= 19 and ataxia.vitals.form == "Gaital" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1].. ";transition to the willow form " 
elseif ataxia.vitals.kata &lt; 19 and ataxia.vitals.form == "Gaital" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1]


elseif ataxia.vitals.kata == 21 and ataxia.vitals.form == "Rain" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1].. ";transition to the oak form "  
elseif ataxia.vitals.kata &gt;= 19 and ataxia.vitals.form == "Rain" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1].. ";transition to the oak form " 
elseif ataxia.vitals.kata &lt; 19 and ataxia.vitals.form == "Rain" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1]

elseif ataxia.vitals.kata == 9 and ataxia.vitals.form == "Oak" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1].. ";transition to the willow form "  
elseif ataxia.vitals.kata &gt;= 8 and ataxia.vitals.form == "Oak" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1].. ";transition to the willow form " 
elseif ataxia.vitals.kata &lt; 8 and ataxia.vitals.form == "Oak" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1]

elseif ataxia.vitals.kata == 9 and ataxia.vitals.form == "Willow" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1].. ";transition to the rain form "  
elseif ataxia.vitals.kata &gt;= 8 and ataxia.vitals.form == "Willow" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1].. ";transition to the rain form " 
elseif ataxia.vitals.kata &lt; 8 and ataxia.vitals.form == "Willow" then
  atk = atk.."wield staff489282;combo " ..target.. " " ..shikudokick[1].. " " ..shikudostaffone[1].. " " ..shikudostafftwo[1]
end

if table.contains(ataxia.playersHere, target) then
send("queue addclear free " ..atk)
end



end







</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Bard</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>LeviBard</name>
										<packageName></packageName>
										<script>function levibardone()
local atk = combatQueue()
local sp = ataxia.settings.separator

bardtempostance = bardtempostance or "none"
bardsunset = bardsunset or false
bardsunrise = bardsunrise or false
bladefinale = bladefinale or false
bardtemposequence = bardtemposequence or 0

--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--Rapier Damage Capture
rapierdamage = ataxiaTables.limbData.bardRapier

if checkAffList({"paralysis", "asthma", "weariness",  "clumsiness", "impatience", "addiction", "nausea","generosity", "heathleech", "confusion", "recklessness", "diminished", "haemophilia", "sensitivity"},3) then
  bardflick = true
else
  bardflick = false
end

--Prep Function
if lb[target].hits["head"] + rapierdamage &gt;= 100 and not tAffs.damagedhead then 
bprepped_head = true else
bprepped_head = false
end
if lb[target].hits["torso"] + rapierdamage &gt;= 100 and not tAffs.mildtrauma then 
bprepped_torso = true else
bprepped_torso = false
end
if lb[target].hits["left leg"] + rapierdamage &gt;= 100 and not tAffs.damagedleftleg then 
bprepped_leftleg = true else
bprepped_leftleg = false
end
if lb[target].hits["right leg"] + rapierdamage &gt;= 100 and not tAffs.damagedrightleg then 
bprepped_rightleg = true else
bprepped_rightleg = false
end
if lb[target].hits["right arm"] + rapierdamage &gt;= 100 and not tAffs.damagedrightarm then 
bprepped_rightarm = true else
bprepped_rightarm = false
end
if lb[target].hits["left arm"] + rapierdamage &gt;= 100 and not tAffs.damagedleftarm then 
bprepped_leftarm = true else
bprepped_leftarm = false
end




envenomList = {}
bardrefrain = {}
if not tAffs.paralysis then
  table.insert(bardrefrain,"paean")
elseif not tAffs.asthma then
  table.insert(bardrefrain,"ode")
elseif not tAffs.slickness then
  table.insert(bardrefrain,"ghazal")
elseif not tAffs.lethargy then
  table.insert(bardrefrain,"elegy")
elseif not tAffs.sensitivity then
  table.insert(bardrefrain,"prosodion")
elseif not tAffs.dizziness then
  table.insert(bardrefrain,"bhajan")
elseif not tAffs.addiction then
  table.insert(bardrefrain,"gusheh")
else 
  table.insert(bardrefrain,"paean")
end 

if tAffs.shield or tAffs.rebounding then
  atk = atk.."blade punctuate " ..target.. " " ..bardrefrain[1]
elseif bladefinale == true then
  atk = atk.."blade flick " ..target.. ";finale " ..target
elseif bardsunset == true then
  atk = atk.."wield right fang;wipe fang;envenom fang with slike;jab " ..target
elseif bprepped_head == true and bprepped_leftarm == true and (tAffs.mildtramua and tAffs.damagedleftleg) or bardsunrise == true then
  atk = atk.."blade sunset " ..target.. " left paean"
elseif bprepped_head == true and bprepped_rightarm == true and (tAffs.mildtramua and tAffs.damagedrightleg) or bardsunrise == true then
  atk = atk.."blade sunset " ..target.. " right paean"

elseif bprepped_head == true and bprepped_rightarm == true and bprepped_torso == true and bprepped_leftleg == true then
  atk = atk.."blade sunrise " ..target.. " left " ..bardrefrain[1]
elseif bprepped_head == true and bprepped_leftarm == true and bprepped_torso == true and bprepped_leftleg == true then
  atk = atk.."blade sunrise " ..target.. " left " ..bardrefrain[1]
elseif bprepped_head == true and bprepped_rightarm == true and bprepped_torso == true and bprepped_rightleg == true then
  atk = atk.."blade sunrise " ..target.. " right " ..bardrefrain[1]
elseif bprepped_head == true and bprepped_leftarm == true and bprepped_torso == true and bprepped_rightleg == true then
  atk = atk.."blade sunrise " ..target.. " right " ..bardrefrain[1]

elseif tAffs.crescendo == 0 or tAffs.crescendo == false then
  atk = atk.."blade flick " ..target.. " " ..bardrefrain[1] 
  
elseif bprepped_head == true and bprepped_rightarm == true and bprepped_torso == true and bprepped_leftleg == false then
  atk = atk.."blade heelsnap " ..target.. " left " ..bardrefrain[1]
elseif bprepped_head == true and bprepped_leftarm == true and bprepped_torso == true and bprepped_leftleg == false then
  atk = atk.."blade heelsnap " ..target.. " left " ..bardrefrain[1]
elseif bprepped_head == true and bprepped_rightarm == true and bprepped_torso == true and bprepped_rightleg == false then
  atk = atk.."blade heelsnap " ..target.. " right " ..bardrefrain[1]
elseif bprepped_head == true and bprepped_leftarm == true and bprepped_torso == true and bprepped_rightleg == false then
  atk = atk.."blade heelsnap " ..target.. " right " ..bardrefrain[1]

elseif bprepped_head == true and bprepped_leftarm == true and bprepped_torso == false then
  atk = atk.."blade jab " ..target.. " torso " ..bardrefrain[1]
elseif bprepped_head == true and bprepped_rightarm == true and bprepped_torso == false then
  atk = atk.."blade jab " ..target.. " torso " ..bardrefrain[1]
  
 
elseif bprepped_head == true and bprepped_leftarm == false then
  atk = atk.."blade highsun " ..target.. " left arm " ..bardrefrain[1]
elseif bprepped_head == true and bprepped_rightarm == false then
  atk = atk.."blade highsun " ..target.. " right arm " ..bardrefrain[1]
  
elseif tAffs.crescendo == 0 or tAffs.crescendo == false then
  atk = atk.."blade flick " ..target.. " " ..bardrefrain[1]
elseif bprepped_head == false and not tAffs.damagedhead then
  atk = atk.."blade highsun " ..target.. " head " ..bardrefrain[1]
elseif bprepped_leftarm == false and not tAffs.damagedleftarm then
  atk = atk.."blade highsun " ..target.. " left arm " ..bardrefrain[1]
elseif bprepped_rightarm == false and not tAffs.damagedrightarm then
  atk = atk.."blade highsun " ..target.. " right arm " ..bardrefrain[1]
elseif bprepped_torso == false and not tAffs.mildtraumna then 
  atk = atk.."blade jab " ..target.. " torso " ..bardrefrain[1]
elseif bprepped_leftleg == false and not tAffs.damagedleftleg then
  atk = atk.."blade heelsnap " ..target.. " left " ..bardrefrain[1]
elseif bprepped_rightleg == false and not tAffs.damagedrightleg then 
  atk = atk.."blade heelsnap " ..target.. " left " ..bardrefrain[1]
end
  
 
if bardsunset == false then
send("queue addclearfull freestand wield left lyre;wield right rapier;" ..atk)
elseif bardsunset == true then
table.insert(envenomList,"slike")
send("queue addclearfull freestand " ..atk)
end

--End Function  
end


function levibardtwo()
local atk = combatQueue()
local sp = ataxia.settings.separator


bardtempostance = bardtempostance or "none"
bardsunset = bardsunset or false
bardsunrise = bardsunrise or false
bladefinale = bladefinale or false
bardtemposequence = bardtemposequence or 0

--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--Rapier Damage Capture
rapierdamage = ataxiaTables.limbData.bardRapier

if checkAffList({"paralysis", "asthma", "weariness",  "clumsiness", "impatience", "addiction", "nausea","generosity", "heathleech", "confusion", "recklessness", "diminished", "haemophilia", "sensitivity"},3) then
  bardflick = true
else
  bardflick = false
end

--Prep Function
if lb[target].hits["head"] + rapierdamage &gt;= 100 and not tAffs.damagedhead then 
bprepped_head = true else
bprepped_head = false
end
if lb[target].hits["torso"] + rapierdamage &gt;= 100 and not tAffs.mildtrauma then 
bprepped_torso = true else
bprepped_torso = false
end
if lb[target].hits["left leg"] + rapierdamage &gt;= 100 and not tAffs.damagedleftleg then 
bprepped_leftleg = true else
bprepped_leftleg = false
end
if lb[target].hits["right leg"] + rapierdamage &gt;= 100 and not tAffs.damagedrightleg then 
bprepped_rightleg = true else
bprepped_rightleg = false
end
if lb[target].hits["right arm"] + rapierdamage &gt;= 100 and not tAffs.damagedrightarm then 
bprepped_rightarm = true else
bprepped_rightarm = false
end
if lb[target].hits["left arm"] + rapierdamage &gt;= 100 and not tAffs.damagedleftarm then 
bprepped_leftarm = true else
bprepped_leftarm = false
end




envenomList = {}
bardrefrain = {}
if not tAffs.paralysis then
  table.insert(bardrefrain,"paean")
elseif not tAffs.asthma then
  table.insert(bardrefrain,"ode")
elseif not tAffs.slickness then
  table.insert(bardrefrain,"ghazal")
elseif not tAffs.lethargy then
  table.insert(bardrefrain,"elegy")
elseif not tAffs.sensitivity then
  table.insert(bardrefrain,"prosodion")
elseif not tAffs.dizziness then
  table.insert(bardrefrain,"bhajan")
elseif not tAffs.addiction then
  table.insert(bardrefrain,"gusheh")
else 
  table.insert(bardrefrain,"paean")
end 

if tAffs.shield or tAffs.rebounding then
  atk = atk.."blade punctuate " ..target.. " " ..bardrefrain[1]

  
elseif bprepped_torso == true and bardsunset == true and bardtempo == "back" then
  atk = atk.."blade jab " ..target.. " torso " ..bardrefrain[1]

elseif bprepped_head == true and bprepped_rightarm == true and bprepped_torso == true then
  if bardtempo == "back" and (bardtempostance == "Adagio" and bardtemposequence &lt;= 1) or (bardtempostance == "Moderato" and bardtemposequence == 0) then 
    atk = atk.."blade sunset " ..target.. " right bhajan"
  elseif bardtempo == "side" and (bardtempostance == "Adagio" and bardtemposequence == 3) or (bardtempostance == "Moderato" and bardtemposequence == 1) or (bardtempostance == "Allegro" and bardtemposequence == 0) then 
    atk = atk.."blade sunset " ..target.. " right bhajan"
  else
    atk = atk.."blade flick " ..target.. " " ..bardrefrain[1]
  end
elseif bprepped_head == true and bprepped_leftarm == true and bprepped_torso == true  then
  if bardtempo == "back" and (bardtempostance == "Adagio" and bardtemposequence &lt;= 1) or (bardtempostance == "Moderato" and bardtemposequence == 0) then 
    atk = atk.."blade sunset " ..target.. " left bhajan"
  elseif bardtempo == "side" and (bardtempostance == "Adagio" and bardtemposequence == 3) or (bardtempostance == "Moderato" and bardtemposequence == 1) or (bardtempostance == "Allegro" and bardtemposequence == 0) then 
    atk = atk.."blade sunset " ..target.. " left bhajan"
  else
    atk = atk.."blade flick " ..target.. " " ..bardrefrain[1]
  end
elseif bladefinale == true then
  atk = atk..";finale " ..target

elseif bprepped_head == true and bprepped_leftarm == true and bprepped_torso == false then
  atk = atk.."blade jab " ..target.. " torso " ..bardrefrain[1]
elseif bprepped_head == true and bprepped_rightarm == true and bprepped_torso == false then
  atk = atk.."blade jab " ..target.. " torso " ..bardrefrain[1]
  
 
elseif bprepped_head == true and bprepped_leftarm == false then
  atk = atk.."blade highsun " ..target.. " left arm " ..bardrefrain[1]
elseif bprepped_head == true and bprepped_rightarm == false then
  atk = atk.."blade highsun " ..target.. " right arm " ..bardrefrain[1]

elseif tAffs.crescendo == 0 or tAffs.crescendo == false then
  atk = atk.."blade flick " ..target.. " " ..bardrefrain[1]
elseif bprepped_head == false and not tAffs.damagedhead then
  atk = atk.."blade highsun " ..target.. " head " ..bardrefrain[1]
elseif bprepped_leftarm == false and not tAffs.damagedleftarm then
  atk = atk.."blade highsun " ..target.. " left arm " ..bardrefrain[1]
elseif bprepped_rightarm == false and not tAffs.damagedrightarm then
  atk = atk.."blade highsun " ..target.. " right arm " ..bardrefrain[1]
elseif bprepped_torso == false and not tAffs.mildtraumna then 
  atk = atk.."blade jab " ..target.. " torso " ..bardrefrain[1]
end
  
 
send("queue addclearfull freestand wield left lyre;wield right rapier;" ..atk)



--End Function  
end</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Psion</name>
									<packageName></packageName>
									<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external scripts --
-------------------------------------------------
</script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Levi Psion Logic</name>
										<packageName></packageName>
										<script>function levipsionmind()
local atk = combatQueue()
local sp = ataxia.settings.separator
php = php or 100
pm = pm or 100
tAffs.criticalspirit = tAffs.criticalspirit or false
tAffs.criticalmind = tAffs.criticalmind or false
tAffs.criticalbody = tAffs.criticalbody or false
pdeconstruct = pdeconstruct or false
psionweaves = ataxiaTables.limbData.psionweaves
psionweaves2 = ataxiaTables.limbData.psionweaves + ataxiaTables.limbData.psionweaves
lightbind = lightbind or false

--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--Check for Psi Blast Criteria
if checkAffList({"impatience", "stupidity", "blackout", "dizziness", "epilepsy", "unweavingmind" },3) then
  tpsiblast = true
else
  tpsiblast = false
end

-- Set Invert
mindinvert = mindinvert or false
bodyinvert = bodyinvert or false
spiritinvert = spiritinvert or false
inverted = inverted or false


--Deconstruct
if tAffs.criticalspirit == true and tAffs.criticalbody == true and tAffs.criticalmind == true then
pdeconstruct = true
elseif tAffs.criticalbody == true and tAffs.criticalmind == true then
pdeconstruct = true
elseif tAffs.criticalbody == true and tAffs.criticalspirit == true then
pdeconstruct = true
elseif tAffs.criticalspirit == true and tAffs.criticalmind == true then
pdeconstruct = true
end




--Prep Limb

if lb[target].hits["head"] + psionweaves2 &gt;= 100 then
  pprepped2_head = true
else
  pprepped2_head = false
end

if lb[target].hits["head"] + psionweaves &gt;= 100 then
  pprepped_head = true
else 
  pprepped_head = false
end
if lb[target].hits["left arm"] + psionweaves &gt;= 100 then
  pprepped_leftarm = true
else 
  pprepped_leftarm = false
end
if lb[target].hits["right arm"] + psionweaves &gt;= 100 then
  pprepped_rightarm = true
else 
  pprepped_rightarm = false
end
if lb[target].hits["right leg"] + psionweaves &gt;= 100 then
  pprepped_rightleg = true
else 
  pprepped_rightleg = false
end
if lb[target].hits["left leg"] + psionweaves &gt;= 100 then
  pprepped_leftleg = true
else 
  pprepped_leftleg = false
end

--Table for Prepare
psionprepare = {}
if tAffs.mindravaged and not tAffs.haemophilia then
  table.insert(psionprepare,"laceration")
elseif not tAffs.paralysis then
  table.insert(psionprepare,"disruption")
elseif not tAffs.haemophilia then
  table.insert(psionprepare,"laceration")
elseif not tAffs.asthma then
  table.insert(psionprepare,"vapours")
else
  table.insert(psionprepare,"rattle")
end


--Table for Weave
--overhand - if prone then impatient . if head broken impatience, if not prone, stupidity, 
--Backhand -- stupdity/dizziness - if prone , knock focus balance
--puncture -- weariness - arm
--sever - clumsiness - arm
--deathblow - asthma - head - prone - bleeding
--hamstring - legs - prone if broken legs


psionweave = {}
if not tAffs.mindravaged then --1
  if pdeconstruct == true then --2
     table.insert(psionweave,"deconstruct")
  elseif tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and tAffs.impatience and not tAffs.stupidity or not tAffs.dizziness then
    table.insert(psionweave,"backhand")
  elseif pprepped_head == true and not tAffs.damagedhead and tAffs.impatience and tAffs.stupidity and tAffs.dizziness and not tAffs.asthma and psionprepare[1] ~= "vapours"  then
    table.insert(psionweave,"deathblow")
  elseif pprepped2_head == true and not tAffs.asthma then
    table.insert(psionweave,"deathblow")
  elseif not tAffs.impatience and tAffs.prone then
    table.insert(psionweave,"overhand")
  elseif tAffs.impatience and tAffs.prone and not tAffs.stupidity or not tAffs.dizziness then
    table.insert(psionweave,"backhand")
  elseif tAffs.impatience and not tAffs.stupidity or not tAffs.dizziness then
    table.insert(psionweave,"backhand")
  elseif tAffs.unweavingmind and tAffs.unweavingbody and not tAffs.unweavingspirit and tAffs.asthma then
    table.insert(psionweave,"unweave spirit")
  elseif tAffs.unweavingmind and tAffs.unweavingbody then
    if ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then --3
      if not tAffs.weariness then --4
        table.insert(psionweave,"puncture")
      elseif not tAffs.clumsiness then
        table.insert(psionweave,"sever")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      end -- End 4
    elseif ataxiaNDB_getClass(target) ~= "Priest" or ataxiaNDB_getClass(target) ~= "Occultist" or ataxiaNDB_getClass(target) ~= "Pariah" then--3
      if not tAffs.clumsiness then --5
        table.insert(psionweave,"sever")
      elseif not tAffs.weariness then
        table.insert(psionweave,"puncture")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      end -- End 5
    end -- End 3
  elseif not tAffs.unweavingbody then
    table.insert(psionweave,"unweave body")
  elseif not tAffs.unweavingmind then
    table.insert(psionweave,"unweave mind")
  else
    table.insert(psionweave,"unweave mind")
  end -- End 2
elseif tAffs.mindravaged then
   if pdeconstruct == true then -- 6
     table.insert(psionweave,"deconstruct")
  elseif tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and tAffs.impatience and not tAffs.stupidity or not tAffs.dizziness then
    table.insert(psionweave,"backhand")
  elseif pprepped_head == true and not tAffs.damagedhead and tAffs.impatience and tAffs.stupidity and tAffs.dizziness and not tAffs.asthma and psionprepare[1] ~= "vapours"  then
    table.insert(psionweave,"deathblow")
  elseif not tAffs.impatience and tAffs.prone then
    table.insert(psionweave,"overhand")
  elseif tAffs.impatience and tAffs.prone and not tAffs.stupidity or not tAffs.dizziness then
    table.insert(psionweave,"backhand")
 
  elseif tAffs.unweavingmind and tAffs.unweavingbody then
    if ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then --7
      if not tAffs.weariness then --8
        table.insert(psionweave,"puncture")
      elseif not tAffs.clumsiness then
        table.insert(psionweave,"sever")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      end -- End 8
    elseif ataxiaNDB_getClass(target) ~= "Priest" or ataxiaNDB_getClass(target) ~= "Occultist" or ataxiaNDB_getClass(target) ~= "Pariah" then
      if not tAffs.clumsiness then -- 9
        table.insert(psionweave,"sever")
      elseif not tAffs.weariness then
        table.insert(psionweave,"puncture")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      end -- End 9
    end -- End 7
  elseif tAffs.unweavingmind and not tAffs.unweavingbody then
    table.insert(psionweave,"unweave body")
  elseif not tAffs.unweavingmind then
    table.insert(psionweave,"unweave mind")
  else
    table.insert(psionweave,"unweave mind")
  end -- End 6
end -- End 0

--Table Transcend
psiontranscend = {}
if pm &lt;= 30 then
  table.insert(psiontranscend,"excise")
elseif tpsiblast == true and not tAffs.mindravaged then
  table.insert(psiontranscend,"blast")
elseif not tAffs.muddled then
  table.insert(psiontranscend,"muddle")
else
  table.insert(psiontranscend,"shatter")
end

---ATTACK LOGIC---
if tAffs.shield then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave cleave " ..target
elseif pm &lt;= 30  then 
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";psi excise " ..target
elseif psionweave[1] == "unweave mind" then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave unweave " ..target.. " mind"
elseif psionweave[1] == "unweave body" then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave unweave " ..target.. " body"
elseif psionweave[1] == "unweave spirit" then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave unweave " ..target.. " spirit"
else
 atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave " ..psionweave[1].. " " ..target
end

-- ATTACK--
if lightbind == true then
send("queue addclearfull freestand wield right shield; " ..atk..";assess " ..target..";contemplate " ..target)
elseif lightbind == false then
send("queue addclearfull freestand wield right shield; " ..atk.." ;enact lightbind " ..target.. ";assess " ..target..";contemplate " ..target)
end
--LOS Destruction

--enact wrath - eq speed up and rupture - below half health


--enact rupture - 4 attacks bleeding


--enact wavesurge

-- PSI TRANSCEND



--End Function
end 


function levipsionflurry()
local atk = combatQueue()
local sp = ataxia.settings.separator
php = php or 100
pm = pm or 100
tAffs.criticalspirit = tAffs.criticalspirit or false
tAffs.criticalmind = tAffs.criticalmind or false
tAffs.criticalbody = tAffs.criticalbody or false
pdeconstruct = pdeconstruct or false
psionweaves = ataxiaTables.limbData.psionweaves

--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()


-- Set Invert
mindinvert = mindinvert or false
bodyinvert = bodyinvert or false
spiritinvert = spiritinvert or false
inverted = inverted or false


--Check for Psi Blast Criteria
if checkAffList({"impatience", "stupidity", "blackout", "dizziness", "epilepsy", "unweavingmind" },3) then
  tpsiblast = true
else
  tpsiblast = false
end

--Deconstruct
if tAffs.criticalspirit == true and tAffs.criticalbody == true and tAffs.criticalmind == true then
pdeconstruct = true
elseif tAffs.criticalbody == true and tAffs.criticalmind == true then
pdeconstruct = true
elseif tAffs.criticalbody == true and tAffs.criticalspirit == true then
pdeconstruct = true
elseif tAffs.criticalspirit == true and tAffs.criticalmind == true then
pdeconstruct = true
end




--Prep Limb

if lb[target].hits["head"] + psionweaves &gt;= 100 then
  pprepped_head = true
else 
  pprepped_head = false
end
if lb[target].hits["left arm"] + psionweaves &gt;= 100 then
  pprepped_leftarm = true
else 
  pprepped_leftarm = false
end
if lb[target].hits["right arm"] + psionweaves &gt;= 100 then
  pprepped_rightarm = true
else 
  pprepped_rightarm = false
end
if lb[target].hits["right leg"] + psionweaves &gt;= 100 then
  pprepped_rightleg = true
else 
  pprepped_rightleg = false
end
if lb[target].hits["left leg"] + psionweaves &gt;= 100 then
  pprepped_leftleg = true
else 
  pprepped_leftleg = false
end

--Table for Prepare
psionprepare = {}
if tAffs.mindravaged and not tAffs.haemophilia then
  table.insert(psionprepare,"laceration")
elseif tAffs.impatience and not tAffs.epilepsy then
  table.insert(psionprepare,"rattle")
elseif not tAffs.paralysis then
  table.insert(psionprepare,"disruption")
elseif not tAffs.haemophilia then
  table.insert(psionprepare,"laceration")
elseif not tAffs.asthma then
  table.insert(psionprepare,"vapours")
else
  table.insert(psionprepare,"rattle")
end


--Table for Weave
--overhand - if prone then impatient . if head broken impatience, if not prone, stupidity, 
--Backhand -- stupdity/dizziness - if prone , knock focus balance
--puncture -- weariness - arm
--sever - clumsiness - arm
--deathblow - asthma - head - prone - bleeding
--hamstring - legs - prone if broken legs


psionweave = {}
if not tAffs.mindravaged then --1
  if pdeconstruct == true then --2
     table.insert(psionweave,"deconstruct")
  elseif inverted == true then
    table.insert(psionweave,"flurry")
  elseif tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and tAffs.impatience and tAffs.stupidity and tAffs.dizziness and not tAffs.asthma and psionprepare[1] ~= "vapours"  then
    table.insert(psionweave,"deathblow")
  elseif not tAffs.impatience and tAffs.prone then
    table.insert(psionweave,"overhand")
  elseif tAffs.unweavingmind and tAffs.unweavingbody then
    if ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then --3
      if not tAffs.weariness then --4
        table.insert(psionweave,"puncture")
      elseif not tAffs.clumsiness then
        table.insert(psionweave,"sever")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      end -- End 4
    elseif ataxiaNDB_getClass(target) ~= "Priest" or ataxiaNDB_getClass(target) ~= "Occultist" or ataxiaNDB_getClass(target) ~= "Pariah" then--3
      if not tAffs.clumsiness then --5
        table.insert(psionweave,"sever")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      elseif not tAffs.weariness then
        table.insert(psionweave,"puncture")
      end -- End 5
    end -- End 3
  elseif tAffs.unweavingmind and not tAffs.unweavingbody then
    table.insert(psionweave,"unweave body")
  elseif not tAffs.unweavingmind then
    table.insert(psionweave,"unweave mind")
  else
    table.insert(psionweave,"unweave mind")
  end -- End 2
elseif tAffs.mindravaged then
   if pdeconstruct == true then -- 6
     table.insert(psionweave,"deconstruct")
  elseif inverted == true then
    table.insert(psionweave,"flurry")
  elseif tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and tAffs.impatience and tAffs.stupidity and tAffs.dizziness and not tAffs.asthma and psionprepare[1] ~= "vapours"  then
    table.insert(psionweave,"deathblow")
  elseif not tAffs.impatience and tAffs.prone then
    table.insert(psionweave,"overhand")
elseif tAffs.unweavingbody then
    if ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then --7
      if not tAffs.weariness then --8
        table.insert(psionweave,"puncture")
      elseif not tAffs.clumsiness then
        table.insert(psionweave,"sever")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      end -- End 8
    elseif ataxiaNDB_getClass(target) ~= "Priest" or ataxiaNDB_getClass(target) ~= "Occultist" or ataxiaNDB_getClass(target) ~= "Pariah" then
      if not tAffs.clumsiness then -- 9
        table.insert(psionweave,"sever")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      elseif not tAffs.weariness then
        table.insert(psionweave,"puncture")
      end -- End 9
    end -- End 7
  elseif tAffs.unweavingmind and not tAffs.unweavingbody then
    table.insert(psionweave,"unweave body")
  elseif not tAffs.unweavingmind then
    table.insert(psionweave,"unweave mind")

  end -- End 6
end -- End 0

--Table Transcend
psiontranscend = {}
if pm &lt;= 30 then
  table.insert(psiontranscend,"excise")
elseif tpsiblast == true and not tAffs.mindravaged then
  table.insert(psiontranscend,"blast")
elseif not tAffs.muddled then
  table.insert(psiontranscend,"muddle")
else
  table.insert(psiontranscend,"shatter")
end

---ATTACK LOGIC---
if tAffs.shield then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave cleave " ..target
elseif pm &lt;= 30  then 
  atk = atk.." psi excise " ..target
elseif inverted == true and tAffs.unweavingspirit or tAffs.criticalspirit then
  atk = atk.."psi transcend shatter " ..target.. ";weave prepare " ..psionprepare[1]..";weave flurry " ..target
elseif tAffs.criticalmind and not tAffs.criticalspirit and inverted == false then
  atk = atk.."weave prepare " ..psionprepare[1]..";weave invert " ..target.. " mind spirit"
elseif tAffs.criticalbody and not tAffs.criticalspirit and inverted == false then
  atk = atk.."weave prepare " ..psionprepare[1]..";weave invert " ..target.. " body spirit"

elseif psionweave[1] == "unweave mind" then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave unweave " ..target.. " mind"
elseif psionweave[1] == "unweave body" then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave unweave " ..target.. " body"
elseif psionweave[1] == "unweave spirit" then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave unweave " ..target.. " spirit"
else
 atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave " ..psionweave[1].. " " ..target
end

-- ATTACK--
if lightbind == true then
send("queue addclearfull freestand wield right shield; " ..atk..";assess " ..target..";contemplate " ..target)
elseif lightbind == false then
send("queue addclearfull freestand wield right shield; " ..atk.." ;enact lightbind " ..target..";assess " ..target..";contemplate " ..target)
end
--LOS Destruction
--enact wrath - eq speed up and rupture - below half health
--enact rupture - 4 attacks bleeding
--enact wavesurge

--End Function
end 

function levipsionmind()
local atk = combatQueue()
local sp = ataxia.settings.separator
php = php or 100
pm = pm or 100
tAffs.criticalspirit = tAffs.criticalspirit or false
tAffs.criticalmind = tAffs.criticalmind or false
tAffs.criticalbody = tAffs.criticalbody or false
pdeconstruct = pdeconstruct or false
psionweaves = ataxiaTables.limbData.psionweaves

--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--Check for Psi Blast Criteria
if checkAffList({"impatience", "stupidity", "blackout", "dizziness", "epilepsy", "unweavingmind" },3) then
  tpsiblast = true
else
  tpsiblast = false
end

-- Set Invert
mindinvert = mindinvert or false
bodyinvert = bodyinvert or false
spiritinvert = spiritinvert or false
inverted = inverted or false


--Deconstruct
if tAffs.criticalspirit == true and tAffs.criticalbody == true and tAffs.criticalmind == true then
pdeconstruct = true
elseif tAffs.criticalbody == true and tAffs.criticalmind == true then
pdeconstruct = true
elseif tAffs.criticalbody == true and tAffs.criticalspirit == true then
pdeconstruct = true
elseif tAffs.criticalspirit == true and tAffs.criticalmind == true then
pdeconstruct = true
end




--Prep Limb

if lb[target].hits["head"] + psionweaves &gt;= 100 then
  pprepped_head = true
else 
  pprepped_head = false
end
if lb[target].hits["left arm"] + psionweaves &gt;= 100 then
  pprepped_leftarm = true
else 
  pprepped_leftarm = false
end
if lb[target].hits["right arm"] + psionweaves &gt;= 100 then
  pprepped_rightarm = true
else 
  pprepped_rightarm = false
end
if lb[target].hits["right leg"] + psionweaves &gt;= 100 then
  pprepped_rightleg = true
else 
  pprepped_rightleg = false
end
if lb[target].hits["left leg"] + psionweaves &gt;= 100 then
  pprepped_leftleg = true
else 
  pprepped_leftleg = false
end

--Table for Prepare
psionprepare = {}
if tAffs.mindravaged and not tAffs.haemophilia then
  table.insert(psionprepare,"laceration")
elseif not tAffs.paralysis then
  table.insert(psionprepare,"disruption")
elseif not tAffs.haemophilia then
  table.insert(psionprepare,"laceration")
elseif not tAffs.asthma then
  table.insert(psionprepare,"vapours")
else
  table.insert(psionprepare,"rattle")
end


--Table for Weave
--overhand - if prone then impatient . if head broken impatience, if not prone, stupidity, 
--Backhand -- stupdity/dizziness - if prone , knock focus balance
--puncture -- weariness - arm
--sever - clumsiness - arm
--deathblow - asthma - head - prone - bleeding
--hamstring - legs - prone if broken legs


psionweave = {}
if not tAffs.mindravaged then --1
  if pdeconstruct == true then --2
     table.insert(psionweave,"deconstruct")
  elseif tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and tAffs.impatience and not tAffs.stupidity or not tAffs.dizziness then
    table.insert(psionweave,"backhand")
  elseif pprepped_head == true and not tAffs.damagedhead and tAffs.impatience and tAffs.stupidity and tAffs.dizziness and not tAffs.asthma and psionprepare[1] ~= "vapours"  then
    table.insert(psionweave,"deathblow")
  elseif not tAffs.impatience and tAffs.prone then
    table.insert(psionweave,"overhand")
  elseif tAffs.impatience and tAffs.prone and not tAffs.stupidity or not tAffs.dizziness then
    table.insert(psionweave,"backhand")
  elseif tAffs.unweavingmind and tAffs.unweavingbody then
    if ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then --3
      if not tAffs.weariness then --4
        table.insert(psionweave,"puncture")
      elseif not tAffs.clumsiness then
        table.insert(psionweave,"sever")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      end -- End 4
    elseif ataxiaNDB_getClass(target) ~= "Priest" or ataxiaNDB_getClass(target) ~= "Occultist" or ataxiaNDB_getClass(target) ~= "Pariah" then--3
      if not tAffs.clumsiness then --5
        table.insert(psionweave,"sever")
      elseif not tAffs.weariness then
        table.insert(psionweave,"puncture")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      end -- End 5
    end -- End 3
  elseif not tAffs.unweavingbody then
    table.insert(psionweave,"unweave body")
  elseif not tAffs.unweavingmind then
    table.insert(psionweave,"unweave mind")
  else
    table.insert(psionweave,"unweave mind")
  end -- End 2
elseif tAffs.mindravaged then
   if pdeconstruct == true then -- 6
     table.insert(psionweave,"deconstruct")
  elseif tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and not tAffs.impatience then
    table.insert(psionweave,"overhand")
  elseif pprepped_head == true and not tAffs.damagedhead and tAffs.impatience and not tAffs.stupidity or not tAffs.dizziness then
    table.insert(psionweave,"backhand")
  elseif pprepped_head == true and not tAffs.damagedhead and tAffs.impatience and tAffs.stupidity and tAffs.dizziness and not tAffs.asthma and psionprepare[1] ~= "vapours"  then
    table.insert(psionweave,"deathblow")
  elseif not tAffs.impatience and tAffs.prone then
    table.insert(psionweave,"overhand")
  elseif tAffs.impatience and tAffs.prone and not tAffs.stupidity or not tAffs.dizziness then
    table.insert(psionweave,"backhand")
 
  elseif tAffs.unweavingmind and tAffs.unweavingbody then
    if ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then --7
      if not tAffs.weariness then --8
        table.insert(psionweave,"puncture")
      elseif not tAffs.clumsiness then
        table.insert(psionweave,"sever")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      end -- End 8
    elseif ataxiaNDB_getClass(target) ~= "Priest" or ataxiaNDB_getClass(target) ~= "Occultist" or ataxiaNDB_getClass(target) ~= "Pariah" then
      if not tAffs.clumsiness then -- 9
        table.insert(psionweave,"sever")
      elseif not tAffs.weariness then
        table.insert(psionweave,"puncture")
      elseif not tAffs.asthma and psionprepare[1] ~= "vapours" then
        table.insert(psionweave,"deathblow")
      end -- End 9
    end -- End 7
  elseif tAffs.unweavingmind and not tAffs.unweavingbody then
    table.insert(psionweave,"unweave body")
  elseif not tAffs.unweavingmind then
    table.insert(psionweave,"unweave mind")
  else
    table.insert(psionweave,"unweave mind")
  end -- End 6
end -- End 0

--Table Transcend
psiontranscend = {}
if pm &lt;= 30 then
  table.insert(psiontranscend,"excise")
elseif tpsiblast == true and not tAffs.mindravaged then
  table.insert(psiontranscend,"blast")
elseif not tAffs.muddled then
  table.insert(psiontranscend,"muddle")
else
  table.insert(psiontranscend,"shatter")
end

---ATTACK LOGIC---
if tAffs.shield then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave cleave " ..target
elseif pm &lt;= 30  then 
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";psi excise " ..target
elseif psionweave[1] == "unweave mind" then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave unweave " ..target.. " mind"
elseif psionweave[1] == "unweave body" then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave unweave " ..target.. " body"
elseif psionweave[1] == "unweave spirit" then
  atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave unweave " ..target.. " spirit"
else
 atk = atk.."psi transcend " ..psiontranscend[1].. " " ..target.. ";weave prepare " ..psionprepare[1]..";weave " ..psionweave[1].. " " ..target
end

-- ATTACK--
if lightbind == true then
send("queue addclearfull freestand wield right shield; " ..atk..";assess " ..target..";contemplate " ..target)
elseif lightbind == false then
send("queue addclearfull freestand wield right shield; " ..atk.." ;enact lightbind " ..target..";assess " ..target..";contemplate " ..target)
end
--LOS Destruction

--enact wrath - eq speed up and rupture - below half health


--enact rupture - 4 attacks bleeding


--enact wavesurge

-- PSI TRANSCEND



--End Function
end 

</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Global Script</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Global</name>
										<packageName></packageName>
										<script>-- this should be in login
tparrying = tparrying or "head"
ltarget = ltarget or "torso"
envenom1 = envenom1 or nil
taffenvenom1 = taffenvenom1 or nil
preport1 = preport1 or ""
envenom2 = evenom2 or nil
taffenvenom2 = taffenvenom2 or nil
omount = omount or ""
engaged = engaged or false
need_raze = false
need_bisect = false
if not php then php = 100 end
if not pm then pm = 100 end
partyrelay = partyrelay or true
if tAffs.rebounding or tAffs.shield then
need_raze = true
  else
need_raze = false
  end
need_dwcempower = true
need_falcon = true
inc_imp = false
timpale = false
rtiwaz = false</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Windows</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Limb Counter Window</name>
										<packageName></packageName>
										<script>tarcLabel = Geyser.Label:new({
  name = "tarcLabel",
  x = "0%", y = "-50%",
  width = "14%", height = "30.4%",
})

tarcLabel:setStyleSheet([[
  border: 1px solid #404040;
]])

tarc = Geyser.MiniConsole:new({
  name='tarc',
  color='black',
  x='16', y='20',
  width = '100%-20', height = '100%-30',
  fontSize = 12,
  font = "Bitstream Vera Sans Mono",
  autoWrap = true
}, tarcLabel)

function tarc.write()
  tarc:clear()
  
  --if target and target ~= "" and target ~= "None" and target ~= "none" and lb[target] then
  if target and target ~= "" and target ~= "None" and target ~= "none" then
   tarc:cecho("   Target: " .. target .. "\n\n")
    if ataxiaBasher.enabled then
      tarc:cecho("   Mob Health: " .. gmcp.IRE.Target.Info.hpperc .. "\n")
      tarc:cecho("   BattleR:    " ..ataxia.vitals.rage.. "\n")
      tarc:cecho("   Our Health: "..ataxia.vitals.hp..  "\n")
      tarc:cecho("   Our Willpo: "..ataxia.vitals.wp..  "\n")
      tarc:cecho("   Our Endur:  "..ataxia.vitals.ep..  "\n")
      tarc:cecho("   Our EXP:    "..ataxia.vitals.xp..  "\n")
      if gmcp.Char.Status.class == "Magi" or gmcp.Char.Status.class == "Blue Dragon" then
      tarc:cecho("   Our Willpow: "..ataxia.vitals.wp..  "\n")
      elseif gmcp.Char.Status.class == "Shaman" then
      tarc:cecho("   Our SwiftC: " ..curseCharge.."\n")     
      elseif gmcp.Char.Status.class == "Pariah" then
      tarc:cecho("Our Epitaph Number: "..ataxia.vitals.epitaph..  "\n")
      end
    end
  
   else 
    tarc:cecho("   Target: Sartan\n\n")
   end
   if ataxiaNDB.players[target] then
    tarc:cecho("   Limb Counter\n")
    for _, ln in ipairs({"head", "torso", "left arm", "right arm", "left leg", "right leg"}) do 
      tarc:cecho(string.format("%11s", ln) .. ": " .. lb[target].hits[ln] .. "\n")
    end
    end
    if gmcp.Char.Status.class == "Monk" then
    tarc:cecho("          Kai: " ..ataxia.vitals.class)
    tarc:cecho("\n         Kata: " ..katachain.. "")
      if ataxia.vitals.form then
        tarc:cecho("\n       Stance: " ..ataxia.vitals.form.. "\n")
      else
        tarc:cecho("\n       Stance: " ..ataxia.vitals.stance.. "\n")
      end
    end
    if gmcp.Char.Status.class == "Blademaster" then
    tarc:cecho("     Shin: " ..bmshin.. "\n\n")
    end
    if (gmcp.Char.Status.class == "Runewarden" or gmcp.Char.Status.class == "Infernal") and gmcp.Char.Vitals.charstats[3] == "Spec: Dual Blunt" or gmcp.Char.Vitals.charstats[4] == "Spec: Dual Blunt"  then 
    tarc:cecho("\n      Momentum: " ..mymomentum.. "\n\n")
    end
    --if ataxiaNDB.players[target] then
     --tarc:cecho(" Self Limb Counter\n")
      --for _, y in ipairs({"head", "torso", "left arm", "right arm", "left leg", "right leg"}) do 
       --tarc:cecho(string.format("%11s", y) .. ": " .. slc.percentages[y] .. "\n")
      
      --end
    --end
          
end</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Mage</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Resonance</name>
										<packageName></packageName>
										<script>magi = {

staff = "staff569815",
keep_firestorm = true,
immolation_windup = false,
calcifying_head = false,
calcify_resto = false,
firestorm = false,
convergence = false,
auto_focus = false,
    resonance = {
        ["earth"] = 0,
        ["water"] = 0,
        ["air"] = 0,
        ["fire"] = 0
    }
}
function get_resonance()
  for k, v in pairs(gmcp.Char.Vitals.charstats) do
    if string.match(v, "rair") then
      if v:split(":")[2]:trim():lower() == "major" then
        magi.resonance.air = 3
      elseif v:split(":")[2]:trim():lower() == "moderate" then
        magi.resonance.air = 2
      elseif v:split(":")[2]:trim():lower() == "minor" then
        magi.resonance.air = 1
      else
        magi.resonance.air = 0
      end
    end
    if string.match(v, "rfire") then
      if v:split(":")[2]:trim():lower() == "major" then
        magi.resonance.fire = 3
      elseif v:split(":")[2]:trim():lower() == "moderate" then
        magi.resonance.fire = 2
      elseif v:split(":")[2]:trim():lower() == "minor" then
        magi.resonance.fire = 1
      else
        magi.resonance.fire = 0
      end
    end
    if string.match(v, "rearth") then
      if v:split(":")[2]:trim():lower() == "major" then
        magi.resonance.earth = 3
      elseif v:split(":")[2]:trim():lower() == "moderate" then
        magi.resonance.earth = 2
      elseif v:split(":")[2]:trim():lower() == "minor" then
        magi.resonance.earth = 1
      else
        magi.resonance.earth = 0
      end
    end
    if string.match(v, "rwater") then
      if v:split(":")[2]:trim():lower() == "major" then
        magi.resonance.water = 3
      elseif v:split(":")[2]:trim():lower() == "moderate" then
        magi.resonance.water = 2
      elseif v:split(":")[2]:trim():lower() == "minor" then
        magi.resonance.water = 1
      else
        magi.resonance.water = 0
      end
    end
  end
end

registerAnonymousEventHandler("gmcp.Char.Vitals", "get_resonance")</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Logic</name>
										<packageName></packageName>
										<script>targetlostfrost = false --tAffs.nocaloric
timmolation = false
magi.firestorm = false
tAffs.burns = 0
tburns = 0


function MagiMain()

    local sep = ";"
    local str = ""

    str = "stand;wield staff569815 shield;"


    if tAffs.shield then
        str = str..sep.."cast erode at " ..target.. " shield"
        elseif tburns &gt;= 2 and tAffs.conflagration
            then if targetHealth &lt;= 25 then
            str = str..sep.."cast stormhammer at " ..target
            --str = str..sep.."elemental destroy " ..target
        else 
            if magi.resonance.fire == 0 then
            str = str..sep.."cast firelash at " ..target
        elseif magi.resonance.fire == 3 then
            str = str..sep.."cast emanation at " ..target.. " fire"
        else
            str = str..sep.."cast magma at " ..target
            end
        end
        
   elseif not tAffs.waterbond and not tAffs.blistered and timmolation == false and not tAffs.paralysis and not tAffs.anorexia and not magi.calcifying_head then
         
      if magi.resonance.fire == 2 then
        str = str..sep.."cast fulminate at " ..target
      else
        str = str..sep.."staffcast horripilation " ..target
      end
      
  elseif not tAffs.scalded then
      str = str..sep.."cast magma at " ..target

  elseif magi.calcify_resto then
     if magi.resonance.fire == 3 then
      str = str..sep.."cast emanation at " ..target.. " fire"
      else
          if targetlostfrost == true  then
            if magi.resonance.water == 0 then
              str = str..sep.."cast dehydrate at " ..target
            elseif magi.resonance.earth == 1 then
             str = str..sep.."cast magma at " ..target
           elseif magi.resonance.air &lt; 3 then
             str = str..sep.."cast fulminate at " ..target
            end
         else
            if magi.resonance.fire == 0 then
              str = str..sep.."cast firelash at " ..target
           elseif magi.resonance.fire == 3 then
              str = str..sep.."cast emanation at " ..target.. " fire"
           else
              str = str..sep.."cast magma at " ..target
        end
     end
end

  elseif magi.firestorm == false then
    if magi.resonance.air &gt;= 2 and magi.resonance.fire &gt;= 2 then
       str = str..sep.."cast firestorm"
    else
       str = str..sep.."cast fulminate at " ..target
    end
    
  elseif magi.resonance.earth == 2 and not magi.shalestorm then
    str = str..sep.."cast shalestorm at " ..target
    
  elseif tburns &gt;= 2 then
    if magi.resonance.fire &gt;= 2 and magi.resonance.air &gt;= 2 then
      str = str..sep.."cast conflagrate at " ..target
    else
      str = str..sep.."cast fulminate at " ..target
    end
    
  elseif magi.resonance.earth &gt;= 3 and not magi.calcifying_head then
    if timmolation == false then
      str = str..sep.. "staffcast scintilla at " ..target
    else
      str = str..sep.."cast emanation at " ..target.. " earth"
    end
    
  elseif magi.resonance.earth &lt; 3 then
    if not tAffs.clumsiness then
      str = str..sep.."cast bombard at " ..target
    else
      str = str..sep.."cast mudslide at " ..target
    end
    
  elseif magi.resonance.air &lt; 3 then
    str = str..sep.."cast fulminate at " ..target
  else
    str = str..sep.."cast emanation at " ..target.. " air"
  end
    send("queue addclear freestand " ..str.. ";assess " ..target)
  end

function isFocusLocked()
    if tAffs.asthma and tAffs.slickness and tAffs.anorexia then
      return true
    else
      return false
    end
  end

function MagiLock()
    local sep = ";"
    local str = ""

    str = "stand;wield staff569815 shield;"


  if tAffs.shield then
        str = str..sep.."cast erode at " ..target.. " shield"
  end
    
  if targetHealth &lt;= 30 then 
    str = str..sep.."cast stormhammer at " ..target
    end
        
  if not tAffs.waterbond and not tAffs.blistered and timmolation == false and not tAffs.paralysis and not tAffs.anorexia and not tAffs.asthma then
            if magi.resonance.fire == 2 then
            str = str..sep.."cast fulminate at " ..target
            else
            str = str..sep.."staff cast horripilation at " ..target
      end
      
  elseif tAffs.fronze then
      if tAffs.hypothermia or isFocusLocked() or targetHealth &lt; 60 then
            str = str..sep.."cast glaciate at " ..target
            else
            str = str..sep.."cast hypothermia at " ..target
            end
      
  elseif isFocusLocked() then
      if not tAffs.paralysis then
               if magi.resonance.earth == 1 then
            str = str..sep.."cast mudslide at " ..target
               else
            str = str..sep.."cast fulminate at " ..target
               end
      elseif not tAffs.prone then
         str = str..sep.."vibe destabilise disorientation"
         else
         str = str..sep.."cast mudslide at " ..target
      end
  elseif magi.resonance.air == 3 then
        str = str..sep.."cast emanation at " ..target.. " air"
      elseif magi.resonance.water == 2 and tAffs.asthma and magi.resonance.water == 2 then
        str = str..sep.."cast mudslide at " ..target
      --elseif magi.resonance.earth &gt;= 2 and not magi.shalestorm and not tarAff["kalmia"] then
      --  addToCommand("cast shalestorm at &amp;tar")
      elseif magi.resonance.earth == 3 then
        str = str..sep.."cast emanation at " ..target.. " earth"
      elseif magi.resonance.water &lt; 2 then
        str = str..sep.."cast dehydrate at " ..target
      elseif magi.resonance.earth == 1 and magi.resonance.air == 0 then
        str = str..sep.."cast bombard at " ..target
      elseif magi.resonance.earth &lt; 1 then
        str = str..sep.."cast magma at " ..target
      elseif magi.resonance.air &lt; 3 then
        if magi.resonance.earth == 1 then
          str = str..sep.."cast bombard at " ..target
        else
         str = str..sep.."cast fulminate at " ..target
        end    
  end
  send("queue addclear freestand " ..str.. ";assess " ..target) 
end  </script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Magi Levi Logic 2</name>
										<packageName></packageName>
										<script>tarAblaze = 0 --tAffs.burns?
targetlostfrost = false --tAffs.nocaloric
twaterbond = false
timmolation = false
magi.firestorm = false
tAffs.burns = 0





--Air:
--Minor resonance: gives asthma.
--Moderate resonance: gives sensitivity.
--Major resonance: gives healthleech.

--Earth:
--Minor resonance: breaks a random limb (it will always pick an unbroken limb).
--Moderate resonance: stuns the target for a short time and gives paralysis.
--Major resonance: gives cracked ribs (it does not increase the number of cracked ribs a target has - only ever gives the base affliction).

--Fire:
--Minor resonance: both strips and gives an effect which prevents the raising of the temperance defence.
--Moderate resonance: scalds the target. If the target is already scalded, sets the target ablaze and deals some damage.
--Major resonance: gives the blistered affliction. If they're already blistered, gives a stack of the ablaze affliction.

--Water:
--Minor resonance: gives the frostbite affliction. If it is already present, does some damage.
--Moderate resonance: gives the stuttering affliction and deals some cold damage.
-- Major resonance: gives the anorexia affliction.


function MagiWaterFocus()
get_resonance() --Use this in Aliases

local atk = combatQueue()

if php &lt;= 25 and ataxiaNDB.players[target].city == "Mhaldor" then
  send("Stormhammer") 
elseif php &lt;= 25 then
  atk = "cast stormhammer at " ..target
end

--if not tAffs.waterbond or not tAffs.blistered then
 -- atk = " staffcast horripilation at " ..target
--end

if tAffs.frozen and tAffs.hypothermia then
    atk = " cast glaciate at " ..target
  elseif tAffs.frozen and not tAffs.hypothermia then
    atk = " cast hypothermia at " ..target
  elseif tAffs.shivering and tAffs.nausea and not tAffs.frozen then
    atk = " cast dehydrate at " ..target
  elseif tAffs.shivering then
   atk = "cast dehydrate at " ..target 
  elseif magi.resonance.water == 0 and magi.resonance.fire == 2 and magi.resonance.earth &lt;= 1 then
    atk = "cast dehydrate at " ..target 
  elseif magi.resonance.water == 3 and magi.resonance.fire == 2 and magi.resonance.earth &lt;= 1 then
    atk = "cast emanation at " ..target.. " water"
  elseif tAffs.calcifiedskull and magi.resonance.water == 3 and magi.resonance.earth == 1 then
    atk = "cast dehydrate at " ..target 
  elseif tAffs.calcifiedskull and magi.resonance.water == 3 and magi.resonance.earth == 0 then
    atk = "cast mudslide at " ..target 
  --CalcifySkull - Take that Restoration
  elseif tAffs.scalded and magi.resonance.water == 3 and magi.resonance.earth == 3 and timmolation == false then
    atk = "staff cast scintilla at " ..target
  elseif not tAffs.scalded and magi.resonance.water == 3 and magi.resonance.earth == 3 and timmolation == false and magi.resonance.fire &lt; 1 then
    atk = "cast magma at" ..target
  elseif not tAffs.scalded and magi.resonance.water == 3 and magi.resonance.earth == 3 and timmolation == false and magi.resonance.fire &gt; 1 then
    atk = "cast fulminate at" ..target
  elseif magi.resonance.water == 3 and magi.resonance.earth == 3 then
    atk = "cast emanation at " ..target.. " earth"
  --Cracked Ribs and Asthma
  elseif magi.resonance.water == 3 and magi.resonance.earth == 2 then
    atk = "cast bombard at " ..target
  -- Prone | Slickness | Paralysis | Anorexia | Fulminated 
  elseif magi.resonance.water == 2 and magi.resonance.earth == 1 and magi.resonance.air == 1 then
    atk = "cast mudslide at " ..target
  -- Prone | Slickness | Break Random Limb | Stuttering 
  elseif magi.resonance.water == 2 and magi.resonance.earth == 1 and magi.resonance.fire == 1 then
    atk = "cast fulminate at " ..target
  elseif magi.resonance.water == 1 and magi.resonance.earth == 0 then
    atk = "cast mudslide at " ..target
  elseif magi.resonance.water == 0 then
    atk = "cast dehydrate at " ..target
  else 
    atk = "highfive " ..target
    
end

  
  
--ATTACK
if tAffs.shield then
send("queue addclear freestand wield shield;wield staff569815; cast erode at " ..target.. " ;assess " ..target)
else
send("queue addclear freestand wield shield;wield staff569815; " ..atk.. " ;assess " ..target)
end

end

function MagiFireNew()
get_resonance() 
local atk = combatQueue()


  --If target has a shield, remove it
  if tAffs.shield then
   atk = atk.." cast erode at " .. target .. " shield"
  -- If target has 25 percent health, Stormhammer
  elseif php &lt;= 25 and ataxiaNDB.players[target].city ~= "Mhaldor" then
    atk = atk.." cast stormhammer at " .. target
  -- If burning is 2 or greater and conflagrate is true than stack burning
  elseif tburns &gt;= 2 and tAffs.conflagrate then
        --If I have ashbeast and target is 40 percent or below, kill
      if php &lt;= 40 and ashbeast == true and ataxiaNDB.players[target].city ~= "Mhaldor" then
       atk = atk.." elemental destroy " .. target
        -- If fire is 0 than Firelash to get Fire up
      elseif magi.resonance.fire == 0 then
        atk = atk.." cast firelash at " .. target
        -- If fire is 3 than emanation for 2 burning
      elseif magi.resonance.fire == 3 then
        atk = atk.." cast emanation at " .. target .. " fire"
        -- If target has weariness than cast dehydrate at them for burning
      elseif tAffs.weariness then
        atk = atk.." cast dehydrate at " ..target 
        --If none of the above are true than magma 
      else
       atk = atk.." cast magma at " .. target
      end
  --if I have burning at 2 and fire and air at 2 than conflagrate
  elseif tburns &gt;= 2 and not tAffs.conflagrate and magi.resonance.fire &gt;= 2 and magi.resonance.air &gt;= 2 then
      atk = atk.." cast conflagrate at " ..target
  --if I dont cast fulminate to get air and fire
  elseif tburns &gt;= 2 and not tAffs.conflagrate and magi.resonance.fire &lt; 2 and magi.resonance.air &lt; 2 then
      atk = atk.." cast fulminate at " ..target
  --if I dont have magi.firestorm than get it
  elseif not magi.firestorm then
    if magi.resonance.air &gt;= 2 and magi.resonance.fire &gt;= 2 then
      atk = atk.." cast firestorm"
    else
      atk = atk.." cast fulminate at " .. target
    end
  -- Get burning on target
  --Get scalded
  elseif not tAffs.scalded then
    atk = atk.." cast magma at " ..target
  elseif magi.resonance.fire == 3 then
    atk = atk.." cast emanation at " ..target.. " fire"
  elseif tAffs.healthleech or tAffs.clumsiness or tAffs.asthma or tAffs.sensitivity then
    atk = atk.." cast dehydrate at " ..target
  -- Stack Burning with Dehydrate
  elseif tAffs.weariness then
    atk = atk.." cast dehydrate at " ..target
  elseif magi.resonance.air == 3 then
    atk = atk.." cast emanation at " ..target.. " air"
  elseif magi.resonance.earth == 2 and not magi.shalestorm then
    atk = atk.." cast shalestorm at " ..target
  elseif magi.resonance.earth == 1 then
    atk = atk.." cast bombard at " ..target
  elseif magi.resonance.earth == 0 then
    atk = atk.."cast mudslide at " ..target
  elseif tburns &lt; 2 then
    atk = atk.."cast fulminate at " ..target
  
end  
 
 
 --ATTACK
if tAffs.shield then
  send("queue addclear freestand wield right shield;wield left staff569815; cast erode at " ..target.. " ;assess " ..target)
else
  send("queue addclear freestand wield right shield;wield left staff569815; " ..atk.. " ;assess " ..target)
end
end



function MagiSalveFocus()
getLockingAffliction()
checkTargetLocks()
get_resonance() --Use this in Aliases

local atk = combatQueue()

if checkAffList({"asthma", "clumsiness", "healthleech", "sensitivity"},2) then
	local	tkelpstack = true
  else
  tkelpstack = false
end




--if not tAffs.waterbond or not tAffs.blistered then
 -- atk = " staffcast horripilation at " ..target
--end

 --If target has a shield, remove it
  if tAffs.shield then
   atk = atk.." cast erode at " .. target .. " shield"
  -- If target has 25 percent health, Stormhammer
  elseif php &lt;= 25 and ataxiaNDB.players[target].city ~= "Mhaldor" then
    atk = atk.." cast stormhammer at " .. target
  -- If burning is 2 or greater and conflagrate is true than stack burning
  elseif tburns &gt;= 2 and tAffs.conflagrate then
        --If I have ashbeast and target is 40 percent or below, kill
      if php &lt;= 40 and ashbeast == true and ataxiaNDB.players[target].city ~= "Mhaldor" then
       atk = atk.." elemental destroy " .. target
        -- If fire is 0 than Firelash to get Fire up
      elseif magi.resonance.fire == 0 then
        atk = atk.." cast firelash at " .. target
        -- If fire is 3 than emanation for 2 burning
      elseif magi.resonance.fire == 3 then
        atk = atk.." cast emanation at " .. target .. " fire"
        -- If target has weariness than cast dehydrate at them for burning
      elseif tAffs.weariness then
        atk = atk.." cast dehydrate at " ..target 
        --If none of the above are true than magma 
      else
       atk = atk.." cast magma at " .. target
      end
  --if I have burning at 2 and fire and air at 2 than conflagrate
  elseif tburns &gt;= 2 and not tAffs.conflagrate and magi.resonance.fire &gt;= 2 and magi.resonance.air &gt;= 2 then
      atk = atk.." cast conflagrate at " ..target
  --if I dont cast fulminate to get air and fire
  elseif tburns &gt;= 2 and not tAffs.conflagrate and magi.resonance.fire &lt; 2 and magi.resonance.air &lt; 2 then
      atk = atk.." cast fulminate at " ..target 
  elseif tkelpstack == true then
    atk = atk.. "cast dehydrate at " ..target
  elseif tAffs.calcifiedskull and magi.resonance.fire == 3 and tfirelash == false then
    atk = atk.. "cast emanation at " ..target.. " fire"
  --Conflag
  elseif tAffs.calcifiedskull and tfirelash == true then
    atk = atl.. "cast conflagerate at " ..target
  --Get Ablaze Two
  elseif tAffs.calcifiedskull then
    atk = atk.. "cast firelash at " ..target 
  --CalcifySkull - Take that Restoration
  elseif magi.resonance.earth == 3 and tAffs.scalded and timmolation == true then
    atk = atk.. "cast emanation at " ..target.. " earth"
  elseif tAffs.scalded and magi.resonance.earth == 3 and timmolation == false then
    atk = atk.. "staff cast scintilla at " ..target
  elseif not tAffs.scalded and magi.resonance.earth == 3 and timmolation == false and magi.resonance.fire &gt; 2 then
    atk = atk.. "cast magma at" ..target
  elseif not tAffs.scalded and magi.resonance.earth == 3 and timmolation == false and magi.resonance.fire == 1 then
    atk = atk.. "cast dehydrate at" ..target
  elseif not tAffs.scalded and magi.resonance.earth == 3 and timmolation == false and magi.resonance.fire &gt; 1 then
    atk = atk.. "cast fulminate at" ..target
  elseif magi.resonance.earth == 2 and magi.resonance.water == 1 then
     atk = atk.. "cast bombard at" ..target
  elseif magi.resonance.earth == 1 and magi.resonance.fire == 3 and magi.resonance.water == 0 then
     atk = atk.. "cast mudslide at" ..target
  elseif magi.resonance.earth == 0 and magi.resonance.fire == 2 and magi.firestormm == true then
    atk = atk.. "cast magma at" ..target
 elseif not magi.firestorm then
    if magi.resonance.air &gt;= 2 and magi.resonance.fire &gt;= 2 then
      atk = atk.." cast firestorm"
    else
      atk = atk.." cast fulminate at " .. target
    end
  
  else 
    atk = atk.. "highfive " ..target
    
end

  
  
--ATTACK
if tAffs.shield then
send("queue addclear freestand wield shield;wield staff569815; cast erode at " ..target.. " ;assess " ..target)
else
send("queue addclear freestand wield shield;wield staff569815; " ..atk.. " ;assess " ..target)
end

end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Mizik Bullshit</name>
										<packageName></packageName>
										<script>function MagiFire()
  local actions = {}
  local addAction = function(action)
    table.insert(actions, action)
  end

  if not Legacy.Curing.Affs.retardation then
    addAction("stand")
    addAction("get body from vault zephariel")
    addAction("wield shield442968 staff324970")
  end
  
  --If target has a shield, remove it
  if ak.defs.shield then
    addAction("cast erode at " .. target .. " shield")
  -- If target has 25 percent health, Stormhammer
  elseif targetHealth &lt;= 25 then
    addAction("cast stormhammer at " .. target)
  -- If burning is 2 or greater and conflagrate is true than stack burning
  elseif affstrack.score.aflame &gt;= 200 and affstrack.score.conflagrate == 100 then
        --If I have ashbeast and target is 40 percent or below, kill
      if targetHealth &lt;= 40 and ashbeast == true then
        addAction("elemental destroy " .. target)
        -- If fire is 0 than Firelash to get Fire up
      elseif magi.resonance.fire == 0 then
        addAction("cast firelash at " .. target)
        -- If fire is 3 than emanation for 2 burning
      elseif magi.resonance.fire == 3 then
        addAction("cast emanation at " .. target .. " fire")
        -- If target has weariness than cast dehydrate at them for burning
      elseif affstrack.score.weariness &gt; 67 then
        addAction("cast dehydrate at " ..target)  
        --If none of the above are true than magma 
      else
        addAction("cast magma at " .. target)
      end
  --if I have burning at 2 and fire and air at 2 than conflagrate
  elseif affstrack.score.aflame &gt;= 200 and affstrack.score.conflagrate &lt; 100 and magi.resonance.fire &gt;= 2 and magi.resonance.air &gt;= 2 then
    addAction("cast conflagrate at " ..target)
  --if I dont cast fulminate to get air and fire
  elseif affstrack.score.aflame &gt;= 200 and affstrack.score.conflagrate &lt; 100 and magi.resonance.fire &lt; 2 and magi.resonance.air &lt; 2 then
    addAction("cast fulminate at " ..target)
  --if I dont have magi.firestorm than get it
  elseif not magi.firestorm then
    if magi.resonance.air &gt;= 2 and magi.resonance.fire &gt;= 2 then
      addAction("cast firestorm")
    else
      addAction("cast fulminate at " .. target)
    end
  -- Get burning on target
  --Get scalded
  elseif affstrack.score.scalded &lt; 100 then
    addAction("cast magma at " ..target)
  -- Stack Burning with Dehydrate
  elseif affstrack.score.aflame &lt; 200 then
    addAction("cast dehydrate at " ..target)
  
end  
 
 
  local commandSequence = table.concat(actions, "|")
  if Legacy.Curing.Affs.retardation then
    send(commandSequence, false)
  else
    send("queue addclear free " .. commandSequence .. "|assess " .. target)
  end
end
</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>DRAGON</name>
									<packageName></packageName>
									<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external scripts --
-------------------------------------------------
</script>
									<eventHandlerList />
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>RAGEBLADE</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>PRIOS</name>
											<packageName></packageName>
											<script>function rageprios()

ragevenom ={}


if not tAffs.paralysis then
   table.insert( ragevenom, "curare" )
end


if not tAffs.slickness and tAffs.asthma then
   table.insert( ragevenom, "gecko" )
end
if not tAffs.asthma then
    table.insert( ragevenom, "kalmia" )
end





if not tAffs.anorexia and tAffs.impatience and tAffs.slickness then
    table.insert( ragevenom, "slike" )
end

if not tAffs.stupidity
and tAffs.impatience then
    table.insert( ragevenom, "aconite" )
    
end

if tAffs.paralysis and tAffs.asthma and tAffs.slickness and tAffs. impatience and tAffs.anorexia then 
 table.insert( ragevenom, "voyria" )
 end

dragoncurse ={}

if not tAffs.paralysis and ragevenom[1] ~= "curare" then
    table.insert( dragoncurse, "paralysis" )
end

if not tAffs.impatience then
    table.insert( dragoncurse, "impatience" )
end


if not tAffs.asthma and ragevenom[1] ~= "kalmia" then
    table.insert( dragoncurse, "asthma" )
end

if not tAffs.weariness then
    table.insert( dragoncurse, "weariness" )
end

if not tAffs.stupidity and ragevenom[1] ~= "aconite" then
    table.insert( dragoncurse, "stupidity" )
end
if not tAffs.recklessness then
    table.insert( dragoncurse, "recklessness" )
end




ragedragon()

end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>ATTACK</name>
											<packageName></packageName>
											<script>function ragedragon()
local atk = combatQueue()

if tAffs.shield then

   atk = atk.."wield shield rageblade;tailsmash "..target
 

elseif tAffs.rebounding then

   atk = atk.."wield shield rageblade;rend "..target.." "..ragevenom[1]..";dragoncurse "..target.." "..dragoncurse[1].." 1;breathgust "..target
 
 else

atk = atk.."wield shield rageblade;jab "..target.." "..ragevenom[1]..";dragoncurse "..target.." "..dragoncurse[1].." 1"



end
send("queue addclear free "..atk)

end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>ATTACK LIMB</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>REND</name>
											<packageName></packageName>
											<script>function dragonrend()
local atk = combatQueue()

if tAff.shield then

   atk = atk.."wield shield;tailsmash "..target
 

else

atk = atk.."wield shield;rend left leg "..target

end

send("queue addclear free "..atk)

end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<Script isActive="yes" isFolder="no">
										<name>Dragon Logic</name>
										<packageName></packageName>
										<script>--07:11:06:721
--07:11:08:707 

function levidragongroup()
local atk = combatQueue()
curses = {}
venoms = {}
--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()


--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
	local	treelock = true
  else
  treelock = false
	
	end
  
--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false
 
--Target 
dragonrenddamage = ataxiaTables.limbData.dragonRend
 
 
if lb[target].hits["head"] + dragonrenddamage &gt;= 100 and not tAffs.damagedhead then 
mprepped_head = true else
mprepped_head = false
end

if lb[target].hits["torso"] + dragonrenddamage &gt;= 100 and not tAffs.damagedtorso then 
mprepped_torso = true else
mprepped_torso = false
end


if lb[target].hits["left leg"] + dragonrenddamage &gt;= 100 and not tAffs.damagedleftleg then 
mprepped_leftleg = true else
mprepped_leftleg = false
end


if lb[target].hits["right leg"] + dragonrenddamage &gt;= 100 and not tAffs.damagedrightleg then 
mprepped_rightleg = true else
mprepped_rightleg = false
end


if lb[target].hits["right arm"] + dragonrenddamage &gt;= 100 and not tAffs.damagedrightarm then 
mprepped_rightarm = true else
mprepped_rightarm = false
end


if lb[target].hits["left arm"] + dragonrenddamage &gt;= 100 and not tAffs.damagedleftarm then 
mprepped_leftarm = true else
mprepped_leftarm = false
end



--Dragon Curse
if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(curses,"paralysis") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(curses,"weariness")
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(curses,"stupidity")
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(curses,"recklessness")
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(curses,"paralysis")
elseif softlock == true and not tAffs.paralysis then
  table.insert(curses,"paralysis")
elseif softlock == true and tAffs.paralysis and not tAffs.impatience then
  table.insert(curses,"impatience")
elseif not tAffs.impatience then
  table.insert(curses,"impatience")
elseif tAffs.impatience then
  if not tAffs.paralysis then
   table.insert(curses,"paralysis")
  elseif not tAffs.asthma then
    table.insert(curses,"asthma")
  elseif not tAffs.weariness then
    table.insert(curses,"weariness")
  elseif not tAffs.stupidity then
    table.insert(curses,"stupidity")
  elseif not tAffs.sensitivity then
    table.insert(curses,"sensitivity")
  else
    table.insert(curses,"recklessness")
  
  end
end

--Venom
if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and curses[1] ~= "paralysis" then
    table.insert(venoms,"curare") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and curses[1] ~= "weariness" then
    table.insert(venoms,"vernalius")
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(venoms,"voyria")
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and curses[1] ~= "stupidity" then
    table.insert(venoms,"aconite")
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and curses[1] ~= "recklessness" then
    table.insert(venoms,"eurypteria")
  end
elseif hardlock == true and not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(venoms,"curare")
elseif softlock == true and not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(venoms,"curare")
elseif not tAffs.paralysis and curses[1] ~= "paralysis" then
  table.insert(venoms,"curare")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
    table.insert(venoms,"slike")
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience then
    table.insert(venoms,"gecko")
elseif tAffs.impatience and not tAffs.stupidity and curses[1] ~= "stupidity" then
  table.insert(venoms,"aconite")
elseif tAffs.impatience and not tAffs.asthma and curses[1] ~= "asthma" then
    table.insert(venoms,"kalmia")
elseif not tAffs.asthma and curses[1] ~= "asthma" then
    table.insert(venoms,"kalmia")
elseif not tAffs.clumsiness then
    table.insert(venoms,"xentio")
elseif not tAffs.weariness and curses[1] ~= "weariness" then
    table.insert(venoms,"vernalius")
end




--Logic
if tAffs.shield then
	atk = atk.."dragoncurse " ..target.. " "..curses[1].. " 2.4;tailsmash " ..target
elseif tAffs.prone and tAffs.damagedleftleg or tAffs.brokenleftleg or lb[target].hits["left leg"] &gt;= 100 and tAffs.damagedrightleg or tAffs.brokenrightleg or lb[target].hits["right leg"] &gt;= 100 then
  atk = atk.."wield shield;dragoncurse " ..target.. " sensitivity 1;bite " ..target
elseif mprepped_rightleg and tAffs.damagedleftleg or lb[target].hits["left leg"] &gt;= 100 and not tAffs.damagedrightleg then
  atk = atk.."wield shield;dragoncurse " ..target.. " "..curses[1].. " 2.4;rend " ..target.. " right leg " ..venoms[1].. ";breathgust "..target
elseif mprepped_leftleg and tAffs.damagedrightleg or lb[target].hits["right leg"] &gt;= 100 and not tAffs.damagedleftleg then
  atk = atk.."wield shield;dragoncurse " ..target.. " "..curses[1].. " 2.4;rend " ..target.. " left leg " ..venoms[1].. ";breathgust "..target
elseif mprepped_leftleg and mprepped_rightleg and tAffs.mildtrauma or lb[target].hits["torso"] &gt;= 100 and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.."wield shield;dragoncurse " ..target.. " "..curses[1].. " 2.4;rend " ..target.. " right leg " ..venoms[1].. ";breathgust "..target
elseif mprepped_leftleg and mprepped_rightleg and tAffs.mildtrauma or lb[target].hits["torso"] &gt;= 100 and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.."wield shield;dragoncurse " ..target.. " "..curses[1].. " 2.4;rend " ..target.. " left leg " ..venoms[1].. ";breathgust "..target

elseif mprepped_leftleg and mprepped_rightleg and mprepped_torso and ataxiaTemp.parriedLimb ~= "torso" then
  atk = atk.."wield shield;dragoncurse " ..target.. " "..curses[1].. " 2.4;rend " ..target.. " torso " ..venoms[1].. ";breathgust "..target
elseif not mprepped_torso and ataxiaTemp.parriedLimb ~= "torso" then
  atk = atk.."wield shield;dragoncurse " ..target.. " "..curses[1].. " 2.4;rend " ..target.. " torso " ..venoms[1].. ";breathgust "..target
elseif not mprepped_rightleg and ataxiaTemp.parriedLimb ~= "right leg" then
  atk = atk.."wield shield;dragoncurse " ..target.. " "..curses[1].. " 2.4;rend " ..target.. " right leg " ..venoms[1].. ";breathgust "..target
elseif not mprepped_leftleg and ataxiaTemp.parriedLimb ~= "left leg" then
  atk = atk.."wield shield;dragoncurse " ..target.. " "..curses[1].. " 2.4;rend " ..target.. " left leg " ..venoms[1].. ";breathgust "..target
else
  atk = atk.."wield shield;dragoncurse " ..target.. " "..curses[1].. " 2;rend " ..target.. " " ..venoms[1].. ";breathgust "..target
  
end
  
  
--Attack
if not ataxia.afflictions.aeon then
	send("queue addclear freestand " ..atk)
end


end</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Defence</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Pre Apply</name>
										<packageName></packageName>
										<script>function getdirectionn()
random_direction = nil
for k, v in pairs(gmcp.Room.Info.exits) do
  random_direction = k
  break
end
end

function lpreapply()
getdirectionn() --random_direction for tumble

--Druid/Infernal 4 Limb Prep
if slc.percentages["left arm"] &gt;= 90 and slc.percentages["left leg"] &gt;= 90 and slc.percentages["right leg"] &gt;= 90 and slc.percentages["right arm"] &gt;= 90 and slc.percentages["left arm"] &lt; 100 and slc.percentages["left leg"] &lt; 100 and slc.percentages["right leg"] &lt; 100 and slc.percentages["right arm"] &lt; 100 and mypreapply == false then
  send("curing queue insert 1 restoration to legs")
  ataxia_boxEcho("WE ARE PREAPPLYING", "yellow")
  autotumbler = autotumbler or true
  if autotumbler == true then
    send("tumble " ..random_direction)
    
  end
  
end

--Double Leg Break
if slc.percentages["left leg"] &gt;= 95 and slc.percentages["right leg"] &gt;= 95 and slc.percentages["left leg"] &lt; 100 and slc.percentages["right leg"] &lt; 100  and mypreapply == false then
  send("curing queue insert 1 restoration to legs")
  ataxia_boxEcho("WE ARE PREAPPLYING", "yellow")
  
  autotumbler = autotumbler or true
  if autotumbler == true then
    send("tumble " ..random_direction)
  
  end

end

if slc.percentages["left leg"] &gt;= 86 and slc.percentages["right leg"] &gt;= 86 and slc.percentages["left leg"] &lt; 100 and slc.percentages["right leg"] &lt; 100  and mypreapply == false then
  send("curing queue insert 1 restoration to legs")
  ataxia_boxEcho("WE ARE PREAPPLYING", "yellow")
  autotumbler = autotumbler or true
  if autotumbler == true then
    send("tumble " ..random_direction)
  end
 

end





end</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>limb.1.2</name>
									<packageName>limb.1.2</packageName>
									<script></script>
									<eventHandlerList />
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Limb</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>limb init</name>
											<packageName></packageName>
											<script>lb = lb or {}

function lb.initTarget(name)
  name = name:lower():title()
  
  lb[name] = lb[name] or {}
  lb[name].t = lb[name].t or {}
  lb[name].hits = lb[name].hits or {
    head = 0,
    torso = 0,
    ["left arm"] = 0,
    ["right arm"] = 0,
    ["left leg"] = 0,
    ["right leg"] = 0,
  }
  
  raiseEvent("limb hits updated", name, "all")
end

function lb.echo(str)
  cecho("&lt;turquoise&gt;[Limb]: &lt;white&gt;" .. str .. "\n")
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>limb management</name>
											<packageName></packageName>
											<script>function lb.addHit(name, ltar, amount)
  name = name:lower():title()
  if not lb[name] then lb.initTarget(name) end
  if not lb[name].hits[ltar] then 
    cecho("&lt;red&gt;(!) Limb not found: " .. tostring(ltar) .. ".\n")
    return
  end
  lb[name].hits[ltar] = lb[name].hits[ltar] + amount
  if lb[name].t[ltar] then killTimer(lb[name].t[ltar]) end
  lb[name].t[ltar] = tempTimer(180, [[
    lb.resetLimb("]] .. name .. [[", "]] .. ltar .. [[")
    lb["]] .. name .. [["].t["]] .. ltar .. [["] = nil
  ]])
  cecho(" " .. ((lb[name].hits[ltar] &gt; 100 and "&lt;firebrick&gt;") or "&lt;ansi_yellow&gt;") .. "("
            .. ((lb[name].hits[ltar] &gt; 100 and "&lt;orange_red&gt;") or "&lt;yellow&gt;") .. lb[name].hits[ltar] .. "%"
            .. ((lb[name].hits[ltar] &gt; 100 and "&lt;firebrick&gt;") or "&lt;ansi_yellow&gt;") .. ")")    
  
if lb[name].hits[ltar] &lt; 100 and (lb[name].hits[ltar] + mylimbattackpercentage) &gt;= 100 then
singleHitPrepped = true
elseif lb[name].hits[ltar] &lt; 100 and (lb[name].hits[ltar] + mylimbattackpercentage) &lt; 100 then
singleHitPrepped = false
elseif lb[name].hits[ltar] &lt; 100 and (lb[name].hits[ltar] + 2*mylimbattackpercentage) &gt; 100 then 
dualHitPrepped = true
elseif lb[name].hits[ltar] &lt; 100 and (lb[name].hits[ltar] + 2*mylimbattackpercentage) &lt; 100 then 
dualHitPrepped = false
end
  
  raiseEvent("limb hits updated", name, ltar, amount)
  


end

function lb.resetLimb(name, ltar)
  name = name:lower():title()
  if not lb[name].hits[ltar] then
    cecho("&lt;red&gt;(!) Limb not found: " .. tostring(ltar) .. ".\n")
    return
  end
  lb[name].hits[ltar] = 0
  lb.echo("Reset " .. name .. ((name:sub(-1) == "s" and "'") or "'s") .. " " .. ltar .. ".")
end

function lb.salve(name, area)
  lb[name].t.cure = tempTimer(3.7, [[
    local convert = {
      head = {"head"},
      torso = {"torso"},
      arms = {[1] = "left arm", [2] = "right arm"},
      legs = {[1] = "left leg", [2] = "right leg"},
    }
    if not convert["]] .. area .. [["] then return end
    for _, ltar in ipairs(convert["]] .. area .. [["]) do 
      if lb["]] .. name .. [["].hits[ltar] &gt;= 100 then 
        if lb["]] .. name .. [["].t.cure then killTimer(lb["]] .. name .. [["].t.cure) end
        lb.resetLimb("]] .. name .. [[", ltar, true)
        if lb["]] .. name .. [["].t[ltar] then
          killTimer(lb["]] .. name .. [["].t[ltar])
          lb["]] .. name .. [["].t[ltar] = nil
        end
        lb["]] .. name .. [["].t.cure = nil
        break
      end
    end
  ]])
end

function lb.resetAll(name)
  for _, v in ipairs({"head", "torso", "left arm", "right arm", "left leg", "right leg"}) do 
    if lb[name] then
      if lb[name].hits[v] &gt; 0 then 
        lb.resetLimb(name, v)
      end
      if lb[name].t[v] then 
        killTimer(lb[name].t[v])
        lb[name].t[v] = nil
      end
    end
  end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>limb prompt</name>
											<packageName></packageName>
											<script>function lb.prompt()
  if not lb[target] then return "" end
  local ret = {}
  -- CHANGE ORDER BELOW! CHANGE ORDER BELOW! CHANGE ORDER BELOW! CHANGE ORDER BELOW! CHANGE ORDER BELOW! CHANGE ORDER BELOW! --
  for _, v in ipairs({"head", "torso", "left arm", "right arm", "left leg", "right leg"}) do 
  -----------------------------------------------------------------------------------------------------------------------------
    table.insert(ret, ((lb[target].hits[v] &gt; 100 and "&lt;red&gt;") or ((lb[target].hits[v] &gt; 0 and "&lt;orange&gt;") or "&lt;grey&gt;")) .. lb[target].hits[v])
  end
  return "&lt;DimGrey&gt;[" .. table.concat(ret, "&lt;DimGrey&gt;|") .. "&lt;DimGrey&gt;]"
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>AzzysEnemyManagement</name>
									<packageName>AzzysEnemyManagement</packageName>
									<script></script>
									<eventHandlerList />
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Enemy Management</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>init table</name>
											<packageName></packageName>
											<script>dembaddies = {}
dembaddies.enemies = {}
dembaddies.priorityenemies = {}</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>add dem baddies</name>
											<packageName></packageName>
											<script>

function EnemyCity(person, city)
   local possibleenemies = db:fetch(ndb.db.people, {db:eq(ndb.db.people.city, city)})
   for i,d in ipairs(possibleenemies) do
    if possibleenemies[i].name == person and possibleenemies[i].city == city then
      table.insert(dembaddies.enemies, person)
    end
   end
   --display(dembaddies.enemies)
end

function SetAndReportEnemies()
  send("unenemy all")
  for i,d in ipairs(dembaddies.enemies) do
    enemystring = enemystring .. d .. ", "
    send("enemy "..d)
  end
  send("pt Enemies"..enemystring)
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>target swapping</name>
											<packageName></packageName>
											<script>function TargetSwapForward()
  if targetindex &lt; table.maxn(dembaddies.enemies) then 
    targetindex = targetindex + 1
    expandAlias("t "..dembaddies.enemies[targetindex])
  else
    expandAlias("t "..dembaddies.enemies[targetindex])
  end 
end

function TargetSwapBackwards()
  if targetindex &gt; 1 then 
    targetindex = targetindex - 1
    expandAlias("t "..dembaddies.enemies[targetindex])
  else
    expandAlias("t "..dembaddies.enemies[targetindex])
  end 
end

function PrioTargetSwapForward()
  if priotargetindex &lt; table.maxn(priorityTargets) then 
    priotargetindex = priotargetindex + 1
    expandAlias("t "..priorityTargets[priotargetindex])
  else
    expandAlias("t "..priorityTargets[priotargetindex])
  end 
end

function PrioTargetSwapBackwards()
  if priotargetindex &gt; 1 then 
    priotargetindex = priotargetindex - 1
    expandAlias("t "..priorityTargets[priotargetindex])
  else
    expandAlias("t "..priorityTargets[priotargetindex])
  end 
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>set priority targets</name>
											<packageName></packageName>
											<script>function SetPriorityTargets(targetlist)
  priorityTargets = {}
  priorityTargets = targetlist
  reportstring = ""
  for i,d in ipairs(priorityTargets) do
    reportstring = reportstring .. d:title() .. ", "
    namecheck = priorityTargets[i]
    send("enemy "..namecheck)
    for x,y in ipairs(dembaddies.enemies) do
      if namecheck:title() == y:title() then
        table.remove(dembaddies.enemies, x)
      end
    end
  end
  
  send("pt Priority target list: "..reportstring)
  
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>SHAMAN</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>CLUMSY PRIOS</name>
										<packageName></packageName>
										<script>function clumsyprios()
getLockingAffliction()
curses = {}

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
	local	hardlock = true
   hardlock = false
  end
	
if checkAffList({"healthleech", "asthma", "weariness", "sensitivity", "clumsiness", "hypochondria", "parasite", "rebbies"},3) then
		kelpstack = true
  else
  kelpstack = false

	end
if checkAffList({"addiction", "nausea", "lethargy", "scytherus", "darkshade", "haemophilia", "flushings", "unweavingbody"},3) then
		ginstack = true
  else
  ginstack = false

	end

	if hardlock and haveAff("paralysis") then
	local	truelock = true
 truelock = false
	
	end
  swiftness = swiftness or false
 
  if ataxiaTemp.dollFashions and ataxiaTemp.dollFashions &gt; 0 and ataxiaTemp.dollFashions &lt; 55 then
rending = true
else
rending = false
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end

if tAffs.slickness and not tAffs.anorexia and tAffs.impatience then
    table.insert(curses,"anorexia")
end


if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end

if kelpstack and not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end


if not tAffs.clumsiness and ataxiaTemp.relapseAff ~= "clumsiness" then
    table.insert(curses,"clumsy")
end

if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end

if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end



if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end










if getLockingAffliction() ~= "confusion" and getLockingAffliction() ~= "weariness" and getLockingAffliction() ~= "plague" and
 not tAffs[getLockingAffliction()] and ataxiaTemp.relapseAff ~= getLockingAffliction()
then    table.insert(curses,getLockingAffliction())
end

if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end



if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end



if not tAffs.dizziness  and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.dementia  and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo  and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end



if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end



if not tAffs.masochism and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end







if swiftness == false then
attack()
elseif swiftness == true then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>ATTACK</name>
										<packageName></packageName>
										<script>function attack()
coagprios()
local atk = combatQueue()
ataxia_lockBreak()

ataxiaTemp.dollFashions = ataxiaTemp.dollFashions or 0
if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
	local	hardlock = true
   hardlock = false
	

	end

	if hardlock and haveAff("paralysis") then
	local	truelock = true
 truelock = false
	
	end

rending = false


if ataxiaTemp.dollFashions and ataxiaTemp.dollFashions &gt; 20 and not tAffs.paralysis and curses[1] == "paralysis" then
 doll_para = true
else doll_para = false
end

if ataxia.afflictions.clumsiness and ataxiaTemp.dollFashions &lt;= 20 then
 doll_fashion = true
else doll_fashion = false
end

if ataxiaTemp.dollFashions &gt; 0 and rending and tAffs.manaleech then
need_soulrend = true
else need_soulrend = false
end

if ataxiaTemp.dollFashions &gt; 0 and rending and manapercent and manapercent &lt;= 76 then
need_soulrend2 = true
else need_soulrend2 = false
end



if getTzantzaAffs() &gt;= 5 and ataxiaTemp.dollFashions &gt; 30 then
 bind_tzantza = true 
else bind_tzantza = false
end


if tAffs.paralysis and tAffs.asthma and tAffs.impatience and 
not tAffs.weariness and getLockingAffliction() == "weariness" then
 need_blight = true
else need_blight = false

end

if getTzantzaAffs() &gt;= 5 and ataxiaTemp.canJinx then
jinx_tzantza = true
else
jinx_tzantza = false
end

if ataxiaTemp.canJinx and not tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
jinx_anoimp = true
else jinx_anoimp = false
end

if ataxiaTemp.canJinx and not tAffs.impatience and not tAffs.asthma then
jinx_impasthma = true
else jinx_impasthma = false
end


if ataxiaTemp.canJinx and kelpstack and not tAffs.impatience and not tAffs.stupidity then
jinx_impstu = true
else jinx_impstu = false
end

if ataxiaTemp.canJinx and tAffs.slickness and not tAffs.paralysis and not tAffs.anorexia and tAffs.impatience then
jinx_anopar = true
else jinx_anopar = false
end

if ataxiaTemp.canJinx and not tAffs.paralysis and not tAffs.haemophilia then
jinx_haepar = true
else jinx_haepar = false
end



if ataxiaTemp.canJinx and not tAffs.asthma and not tAffs.manaleech and rending then
jinx_astmana = true
else jinx_astmana = false
end


if truelock and ataxiaTemp.canJinx then
 need_prone = true
else need_prone = false
end

if ataxiaTemp.dollFashions &gt; 20 and tAffs.paralysis and tAffs.impatience and kelpstack and tAffs[getLockingAffliction()] and not tAffs.anorexia and not tAffs.slickness then
    need_imbibe = true
    else need_imbibe = false
end

if ataxiaTemp.dollFashions &gt; 20 and not tBals.tree and tAffs[getLockingAffliction()] and not tAffs.asthma and not tAffs.slicknesssay  and tAffs.impatience then
    need_imbibe2 = true
    else need_imbibe2 = false
end

if ataxiaTemp.dollFashions &gt; 20 and tAffs[getLockingAffliction()] and not tAffs.asthma and not tAffs.slickness and tAffs.paralysis and tAffs.impatience then
    need_imbibe2 = true
    else need_imbibe2 = false
end

if not ataxiaTemp.coagulate and shaman.spiritisbound("aspar") and tAffs.haemophilia and tAffs.impatience and kelpstack2 and tAffs.bleed &gt;= 100 and not tAffs.anorexia and not tAffs.slickness and (not tBals.tree or tAffs.paralysis) then
   need_coagulate = true
    else need_coagulate = false
end

if not ataxiaTemp.coagulate and tAffs.haemophilia and shaman.spiritisbound("aspar") and tAffs.bleed &gt;= 100 and kelpstack and not tAffs.anorexia and not tAffs.slickness and (not tBals.tree or tAffs.paralysis) and tAffs.impatience then
   need_coagulate2 = true
    else need_coagulate2 = false
end

if not ataxiaTemp.coagulate and ginstack and shaman.spiritisbound("aspar") and not tAffs.anorexia and not tAffs.slickness and (not tBals.tree or tAffs.paralysis) and tAffs.impatience and tAffs.asthma then
   need_coagulate_basic = true
    else need_coagulate_basic = false
end



if not tAffs.haemophilia and tAffs.paralysis and not ataxiaTemp.bloodlet and curses[1] ~= "haemophilia" then
    need_bloodlet = true
    else need_bloodlet = false
    end
   
if tAffs.impatience and shaman.spiritisbound("syvis") and not ataxiaTemp.relapse and not tAffs[getLockingAffliction()] and getLockingAffliction() ~= "weariness" and getLockingAffliction() ~= "confusion" and getLockingAffliction() ~= "plague" then
   need_relapse = true 
    else need_relapse = false
    end




if tAffs.curseward then

    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach"
elseif jinx_tzantza then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx amnesia tzantza "..target


elseif need_imbibe then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke soulscourge vodun imbibe gecko"

elseif need_imbibe2 then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." asthma invoke soulscourge vodun imbibe gecko"


elseif bind_tzantza then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." tzantza invoke soulscourge vodun bind"

elseif need_coagulate_basic then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke coagulation slickness"


elseif need_coagulate then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke coagulation slickness"
    
    elseif need_coagulate_basic then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke coagulation slickness"
    
    elseif need_coagulate2 then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke coagulation slickness"


elseif jinx_anopar then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx anorexia paralysis "..target
   

elseif jinx_anoimp then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx anorexia impatience "..target
   
   elseif jinx_asthma then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx impatience asthma "..target

   
elseif jinx_impstu then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx impatience stupid "..target

elseif jinx_anostu then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx anorexia stupid "..target

elseif jinx_clupar then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx clumsy paralysis "..target

   elseif jinx_astmana then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx asthma manaleech "..target

elseif jinx_astclu then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx asthma clumsy "..target
elseif jinx_astwea then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx asthma weariness "..target
elseif need_soulrend2 then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke soulrend "..target
elseif need_soulrend then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke soulrend "..target

elseif need_blight then
    
  atk = atk.."wield shield doll {"..target.."};vodun status;blight "..target.." weariness"



elseif need_bloodlet then
  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke bloodlet "..target
elseif need_relapse then

  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..getLockingAffliction().." invoke relapse "..getLockingAffliction()

elseif doll_para then
    atk = atk.."wield shield doll {"..target.."};vodun status;vodun paralyse"
elseif doll_fashion then
   if tAffs.manaleech then

  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach invoke soulrend"
else


atk = atk.."wield shield doll {"..target.."};vodun status;fashion doll of "..target

end

elseif curseCharge &gt; 1 then
    atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse "..target.." "..curses[1]
elseif curseCharge &lt;= 1 then
   atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse"


elseif need_prone then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx sleep sleep "..target

end

if not ataxia_needLockBreak() then
if not tzantzacurse then
send("queue addclear free "..atk)
elseif tzantzacurse then
send("none")

end
end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>BASIC LOCK PRIOS</name>
										<packageName></packageName>
										<script>function haemprios()

getLockingAffliction()
curses = {}

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
	local	hardlock = true
   hardlock = false
	

	end
  
if checkAffList({"healthleech", "asthma", "weariness", "sensitivity", "clumsiness", "hypochondria", "parasite", "rebbies"},3) then
		kelpstack = true
  else
  kelpstack = false

	end
  
if checkAffList({"healthleech", "asthma", "weariness", "sensitivity", "clumsiness", "hypochondria", "parasite", "rebbies"},2) then
		kelpstack2 = true
  else
  kelpstack2 = false

	end
if checkAffList({"addiction", "nausea", "lethargy", "scytherus", "darkshade", "haemophilia", "flushings", "unweavingbody"},3) then
		ginstack = true
  else
  ginstack = false

	end

	if tAffs.paralysis and tAffs.impatience and tAffs.anorexia and tAffs.slickness then
		truelock = true
 truelock = false
	
	end
  swiftness = swiftness or false
 
  if ataxiaTemp.dollFashions and ataxiaTemp.dollFashions &gt; 0 and ataxiaTemp.dollFashions &lt; 55 then
rending = true
else
rending = false
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end

if tAffs.slickness and not tAffs.anorexia and tAffs.impatience then
    table.insert(curses,"anorexia")
end


if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end

if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end

if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end



if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" and ginstack == false then
    table.insert(curses,"addiction")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" and ginstack == false then
    table.insert(curses,"vomiting")
end





if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end

if not tAffs.clumsiness and ataxiaTemp.relapseAff ~= "clumsiness" then
    table.insert(curses,"clumsy")
end

if getLockingAffliction() ~= "confusion" and getLockingAffliction() ~= "weariness" and getLockingAffliction() ~= "plague" and
 not tAffs[getLockingAffliction()] and ataxiaTemp.relapseAff ~= getLockingAffliction()
then    table.insert(curses,getLockingAffliction())
end

if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end








if not tAffs.dizziness  and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.dementia  and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo  and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end



if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end



if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.masochism and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end







if swiftness == false then
attack()
elseif swiftness == true then
attackswift()
end
end


</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>DAMAGE PRIOS</name>
										<packageName></packageName>
										<script>function damageprios()

curses = {}
secondcurse = {}



if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
	local	hardlock = true
   hardlock = false
	

	end
  
if checkAffList({"healthleech", "asthma", "weariness", "sensitivity", "clumsiness", "hypochondria", "parasite", "rebbies"},3) then
		kelpstack = true
  else
  kelpstack = false

	end
if checkAffList({"addiction", "nausea", "lethargy", "scytherus", "darkshade", "haemophilia", "flushings", "unweavingbody"},3) then
		ginstack = true
  else
  ginstack = false

	end

	if hardlock and haveAff("paralysis") then
	local	truelock = true
 truelock = false
	
	end
  swiftness = swiftness or false
  

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end


if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end


if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end


if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end

if not tAffs.sensitivity and ataxiaTemp.relapseAff ~= "sensitivity" then
    table.insert(curses,"sensitivity")
end

if not tAffs.clumsiness and ataxiaTemp.relapseAff ~= "clumsy" then
    table.insert(curses,"clumsy")
end

if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end





if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end



if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end


if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end

if not tAffs.dizziness and tBals.focus == false and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.dementia and tBals.focus == false and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo and tBals.focus == false and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end





if not tAffs.masochism and tBals.focus == false and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end

if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end




if not swiftness then
attackdamage()
elseif swiftness then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SWIFT</name>
										<packageName></packageName>
										<script>function attackswift()

local atk = combatQueue()

ataxia_lockBreak()


if getTzantzaAffs() &gt;= 5 and ataxiaTemp.canJinx then
jinx_tzantza = true 
else jinx_tzantza = false
end

if getTzantzaAffs() &gt;= 6 then
need_tzantza = true
else need_tzantza = false

end

if tAffs.paralysis and tAffs.impatience and tAffs.asthma and tAffs.anorexia and tAffs.slickness and ataxiaTemp.canJinx then
need_prone = true
else need_prone = false
end

if tAffs.impatience and tAffs.asthma and tAffs.weariness and tAffs.bleed &gt;= 200 and not tAffs.anorexia and not tAffs.slickness then
    need_coagulate = true
    else need_coagulate = false
end

if not tAffs.haemophilia and ataxiaTemp.bloodlet == false then
    need_bloodlet = true
    else need_bloodlet = false
    end
   




if tAffs.curseward then

    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach"

elseif jinx_tzantza then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx amnesia tzantza "..target

elseif need_tzantza and curseCharge &gt; 1 then
     atk = atk.."stand;wield shield doll {"..target.."};vodun status;swiftcurse "..target.." tzantza"

elseif need_tzantza and curseCharge &lt;= 1 then
     atk = atk.."stand;wield shield doll {"..target.."};vodun status;curse "..target.." tzantza"

elseif need_prone then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx sleep sleep "..target
elseif curseCharge &gt; 1 then
    atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse "..target.." "..curses[1]
elseif curseCharge &lt;= 1 then
   atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse"


end


if not ataxia_needLockBreak() then
if not tzantzacurse then
send("queue addclear free "..atk)
elseif tzantzacurse then
send("none")

end
end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>TZANTZA ATTACK</name>
										<packageName></packageName>
										<script>function tzantzaattack()

local atk = combatQueue()
ataxiaTemp.dollFashions = ataxiaTemp.dollFashions or 0
ataxia_lockBreak()




if getTzantzaAffs() &gt;= tonumber(dotzantza)  and ataxiaTemp.dollFashions &gt; 30 then
bind_tzantza = true 
else bind_tzantza = false
end

if ataxia.afflictions.clumsiness and ataxiaTemp.dollFashions &gt; 10 and not tAffs.paralysis and curses[1] == "paralyse" then
local doll_para = true
else doll_para = false
end


if tAffs.paralysis and tAffs.impatience and tAffs.asthma and tAffs.anorexia and tAffs.slickness and ataxiaTemp.canJinx then
need_prone = true
else need_prone = false
end

if ataxiaTemp.dollFashions &gt; 20 and tAffs.impatience and tAffs.asthma and tAffs.weariness and tAffs.bleed &gt;= 200 and not tAffs.anorexia and not tAffs.slickness then
    need_imbibe = true
    else need_imbibe = false
end

if tAffs.haemophilia and tAffs.impatience and tAffs.asthma and tAffs.weariness and tAffs.bleed &gt;= 150 and not tAffs.anorexia and not tAffs.slickness then
    need_coagulate = true
    else need_coagulate = false
end

if not tAffs.haemophilia and ataxiaTemp.bloodlet == false and not tBals.plant then
    need_bloodlet = true
    else need_bloodlet = false
    end
   
if not ataxiaTemp.relapse and not tAffs.impatience and curses[1] ~= "amnesia" then
    need_relapse = true 
    else need_relapse = false
    end




if tAffs.curseward then

    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach"
elseif need_imbibe then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke soulscourge vodun imbibe gecko"
elseif need_blight then

  atk = atk.."wield shield doll {"..target.."};vodun status;blight "..target.." weariness"


elseif bind_tzantza then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke soulscourge vodun bind"

elseif need_coagulate then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke coagulation slickness"
elseif need_bloodlet then
  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke bloodlet "..target
elseif need_relapse then

  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke relapse "..curses[1]

elseif ataxiaTemp.canJinx then
    atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx "..curses[1].." "..curses[2].." "..target

elseif doll_para then
    atk = atk.."wield shield doll {"..target.."};vodun status;vodun paralyse"
elseif curseCharge &gt; 1 then
    atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse "..target.." "..curses[1]
elseif curseCharge &lt;= 1 then
   atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse"


elseif need_prone then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx sleep sleep "..target

end

if not ataxia_needLockBreak() then
if not tzantzacurse then
send("queue addclear free "..atk)
elseif tzantzacurse then
send("none")

end
end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>TZANTZA PRIOS</name>
										<packageName></packageName>
										<script>function tzantzaprios()

curses = {}

swiftness = swiftness or false
  
dotzantza = tonumber(dotzantza) or 5



if getTzantzaAffs() &gt;= tonumber(dotzantza) then
    table.insert(curses,"tzantza")
end

if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end
if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end



if not tAffs.vertigo  and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end

if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end

if not tAffs.dizziness and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "reckless" then
table.insert(curses,"reckless")
end

if not tAffs.epilepsy and ataxiaTemp.relapseAff ~= "epilepsy" then
    table.insert(curses,"epilepsy")
end

if not tAffs.dementia and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end





if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end








if not tAffs.masochism and tBals.focus == false and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
    
    
end










if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.addiction and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end






if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end

if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end


if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end


if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end




if not swiftness then
attack()
elseif swiftness then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>DOLL PRIOS</name>
										<packageName></packageName>
										<script>function dollprios()

curses = {}
secondcurse = {}



if tAffs.curseward then
    table.insert(curses,"breach")
end



if tAffs.asthma and not tAffs.manaleech then
   table.insert(curses,"manaleech")
end


if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end

if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end


if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end


if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end










if not tAffs.clumsiness and ataxiaTemp.relapseAff ~= "clumsiness" then
    table.insert(curses,"clumsy")
    
end



if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end






if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end













if not tAffs.dementia  and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo  and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end


if not tAffs.dizziness and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end

if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.masochism  and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end


if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end




if not swiftness then
attackdol()
elseif swiftness then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>DOLL ATTACK</name>
										<packageName></packageName>
										<script>function attackdol()
ataxia_lockBreak()
local atk = combatQueue()

ataxiaTemp.dollFashions = ataxiaTemp.dollFashions or 0
if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
	local	hardlock = true
   hardlock = false
	

	end

	if hardlock and haveAff("paralysis") then
	local	truelock = true
 truelock = false
	
	end


rending = true

if ataxiaTemp.dollFashions and ataxiaTemp.dollFashions &gt; 20 and not tAffs.paralysis and curses[1] == "paralysis" then
 doll_para = true
else doll_para = false
end

if ataxia.afflictions.clumsiness and ataxiaTemp.dollFashions &lt;= 20 then
 doll_fashion = true
else doll_fashion = false
end

if ataxiaTemp.dollFashions &gt; 0 and rending and tAffs.manaleech then
need_soulrend = true
else need_soulrend = false
end

if ataxiaTemp.dollFashions &gt; 0 and rending and manapercent and manapercent &lt;= 76 then
need_soulrend2 = true
else need_soulrend2 = false
end



if getTzantzaAffs() &gt;= 5 and ataxiaTemp.dollFashions &gt; 30 then
 bind_tzantza = true 
else bind_tzantza = false
end


if tAffs.paralysis and tAffs.asthma and tAffs.impatience and 
not tAffs.weariness and getLockingAffliction() == "weariness" then
 need_blight = true
else need_blight = false

end

if shaman.spiritisbound("marak") and getTzantzaAffs() &gt;= 5 and ataxiaTemp.canJinx then
jinx_tzantza = true
else
jinx_tzantza = false
end

if ataxiaTemp.canJinx and not tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
jinx_anoimp = true
else jinx_anoimp = false
end

if ataxiaTemp.canJinx and not tAffs.impatience and not tAffs.asthma then
jinx_impasthma = true
else jinx_impasthma = false
end


if ataxiaTemp.canJinx and tAffs.paralysis and tAffs.asthma and not tAffs.impatience and not tAffs.stupidity then
jinx_impstu = true
else jinx_impstu = false
end



if ataxiaTemp.canJinx and not tAffs.paralysis and not tAffs.haemophilia then
jinx_haepar = true
else jinx_haepar = false
end



if ataxiaTemp.canJinx and not tAffs.asthma and not tAffs.manaleech and rending then
jinx_astmana = true
else jinx_astmana = false
end


if truelock and ataxiaTemp.canJinx then
 need_prone = true
else need_prone = false
end

if ataxiaTemp.dollFashions &gt; 20 and tAffs.paralysis and tAffs.impatience and tAffs.asthma and tAffs[getLockingAffliction()] and not tAffs.anorexia and not tAffs.slickness then
    need_imbibe = true
    else need_imbibe = false
end

if ataxiaTemp.dollFashions &gt; 20 and not tBals.tree and tAffs[getLockingAffliction()] and not tAffs.asthma and not tAffs.slickness  and tAffs.impatience then
    need_imbibe2 = true
    else need_imbibe2 = false
end

if ataxiaTemp.dollFashions &gt; 20 and tAffs[getLockingAffliction()] and not tAffs.asthma and not tAffs.slickness and tAffs.paralysis and tAffs.impatience then
    need_imbibe2 = true
    else need_imbibe2 = false
end

if not tBals.tree and tAffs[getLockingAffliction()] and tAffs.haemophilia and tAffs.impatience and tAffs.asthma and tAffs.bleed &gt;= 100 and not tAffs.anorexia and not tAffs.slickness then
   need_coagulate = true
    else need_coagulate = false
end

if not tBals.tree and tAffs[getLockingAffliction()] and tAffs.haemophilia and not tAffs.impatience and tAffs.asthma and tAffs.bleed &gt;= 100 and not tAffs.paralysis and not tAffs.slickness then
   need_coagulate2 = true
    else need_coagulate2 = false
end

if not tAffs.haemophilia and tAffs.paralysis and not ataxiaTemp.bloodlet then
    need_bloodlet = true
    else need_bloodlet = false
    end
   
if shaman.spiritisbound("syvis") and not ataxiaTemp.relapse and not tAffs[getLockingAffliction()] and getLockingAffliction() ~= "weariness" and getLockingAffliction() ~= "confusion" and getLockingAffliction() ~= "plague" then
   need_relapse = true 
    else need_relapse = false
    end




if tAffs.curseward then

    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach"
elseif jinx_tzantza then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx amnesia tzantza "..target


elseif need_imbibe then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke soulscourge vodun imbibe gecko"

elseif need_imbibe2 then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." asthma invoke soulscourge vodun imbibe gecko"


elseif bind_tzantza then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." tzantza invoke soulscourge vodun bind"

elseif need_coagulate then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke coagulation slickness"

elseif need_coagulate2 then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." paralysis invoke coagulation slickness"

elseif jinx_anoimp then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx anorexia impatience "..target
   
   elseif jinx_asthma then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx impatience asthma "..target

   
elseif jinx_impstu then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx impatience stupid "..target

elseif jinx_anostu then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx anorexia stupid "..target

elseif jinx_clupar then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx clumsy paralysis "..target

   elseif jinx_astmana then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx asthma manaleech "..target

elseif jinx_astclu then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx asthma clumsy "..target
elseif jinx_astwea then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx asthma weariness "..target
elseif need_soulrend2 then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke soulrend "..target
elseif need_soulrend then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke soulrend "..target

elseif need_blight then
    
  atk = atk.."wield shield doll {"..target.."};vodun status;blight "..target.." weariness"



elseif need_bloodlet then
  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke bloodlet "..target
elseif need_relapse then

  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..getLockingAffliction().." invoke relapse "..getLockingAffliction()

elseif doll_para then
    atk = atk.."wield shield doll {"..target.."};vodun status;vodun paralyse"
elseif doll_fashion then
   if tAffs.manaleech then

  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach invoke soulrend"
else


atk = atk.."wield shield doll {"..target.."};vodun status;fashion doll of "..target

end

elseif curseCharge &gt; 1 then
    atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse "..target.." "..curses[1]
elseif curseCharge &lt;= 1 then
   atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse"


elseif need_prone then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx sleep sleep "..target

end


if not ataxia_needLockBreak() then
if not tzantzacurse then
send("queue addclear free "..atk)
elseif tzantzacurse then
send("none")

end
end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>DAMAGE ATTACK</name>
										<packageName></packageName>
										<script>function attackdamage()

local atk = combatQueue()
ataxia_lockBreak()



if getTzantzaAffs() &gt;= 5 and ataxiaTemp.canJinx then
jinx_tzantza = true 
else jinx_tzantza = false
end

if getTzantzaAffs() &gt;= 6 then
need_tzantza = true
else need_tzantza = false

end

if ataxia.afflictions.clumsiness and ataxiaTemp.dollFashions &gt; 10 and not tAffs.paralysis and curses[1] == "paralyse" then
local doll_para = true
else doll_para = false
end




if tAffs.bleed and tAffs.bleed &gt;= 500 and kelpstack and tAffs.haemophilia and tAffs.sensitivity and ataxiaTemp.dollFashions &gt;= 2 then
need_inflamedoll = true
else need_inflamedoll = false
end


if tAffs.paralysis and tAffs.impatience and tAffs.asthma and tAffs.anorexia and tAffs.slickness and ataxiaTemp.canJinx then
need_prone = true
else need_prone = false
end

if ataxiaTemp.dollFashions &gt; 20 and tAffs.impatience and tAffs.asthma and tAffs.weariness and tAffs.bleed &gt;= 150 and not tAffs.anorexia and not tAffs.slickness then
    need_imbibe = true
    else need_imbibe = false
end

if not ataxiaTemp.coagulate and shaman.spiritisbound("aspar") and tAffs.haemophilia and tAffs.bleed &gt;= 100 and not tAffs.anorexia and not tAffs.slickness then
   need_coagulate = true
    else need_coagulate = false
end

if not tAffs.haemophilia and ataxiaTemp.bloodlet == false then
    need_bloodlet = true
    else need_bloodlet = false
    end

if shaman.spiritisbound("syvis") and not ataxiaTemp.relapse and not tAffs.sensitivity then
    need_relapse = true 
    else need_relapse = false
    end

   


if need_imbibe then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke soulscourge vodun imbibe gecko"

elseif need_coagulate then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke coagulation slickness"
elseif need_relapse then
  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke relapse "..curses[1]

elseif need_bloodlet then
  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke bloodlet "..target

elseif ataxiaTemp.canJinx then
    atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx "..curses[1].." "..curses[2].." "..target
    elseif doll_para then
    atk = atk.."wield shield doll {"..target.."};vodun status;vodun paralyse"
elseif curseCharge &gt; 1 then
    atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse "..target.." "..curses[1]
elseif curseCharge &lt;= 1 then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;swiftcurse"

end


if need_inflame then
    atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse "..target.." inflame"
end
if need_inflamedoll then
    atk = atk.."stand;wield shield doll {"..target.."};vodun status;curse "..target.." inflame invoke soulscourge vodun throttle"
end
if need_prone then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx sleep sleep "..target
end
if jinx_tzantza then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx amnesia tzantza "..target
   end
if need_tzantza and curseCharge &gt; 1 then
     atk = atk.."stand;wield shield doll {"..target.."};vodun status;swiftcurse "..target.." tzantza"
end
if need_tzantza and curseCharge &lt;= 1 then
     atk = atk.."stand;wield shield doll {"..target.."};vodun status;curse "..target.." tzantza"
end



if not tzantzacurse then
send("queue addclear free "..atk)

end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SLOW LOCK PRIOS</name>
										<packageName></packageName>
										<script>function slowprios()

curses = {}
secondcurse = {}



if tAffs.curseward then
    table.insert(curses,"breach")
end





if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end

if getLockingAffliction() ~= "confusion" and
 not tAffs[getLockingAffliction()] and ataxiaTemp.relapseAff ~= getLockingAffliction()
then    table.insert(curses,getLockingAffliction())
end

if not tAffs.anorexia and ataxiaTemp.relapseAff ~= "anorexia" then
    table.insert(curses,"anorexia")
end

if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end






if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end



if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end





if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end



if not tAffs.dizziness  and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.dementia and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end


if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end

if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.masochism and tBals.focus == false and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end

if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end




if not swiftness then
attackslow()
elseif swiftness then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SLOW LOCK ATTACK</name>
										<packageName></packageName>
										<script>function attackslow()

local atk = combatQueue()
ataxia_lockBreak()

if tAffs.aeon then tAffs.nospeed = true end


if getTzantzaAffs() &gt;= 5 and ataxiaTemp.canJinx then
jinx_tzantza = true 
else jinx_tzantza = false
end

if getTzantzaAffs() &gt;= 6 then
need_tzantza = true
else need_tzantza = false

end

if tAffs.aeon then
need_prone = true

elseif not tAffs.prone and tAffs.paralysis and tAffs.impatience and tAffs.asthma and tAffs.anorexia and tAffs.slickness and ataxiaTemp.canJinx then
need_prone = true
else need_prone = false
end



if ataxiaTemp.dollFashions &gt; 24 and not tBals.tree and not tAffs.aeon then
speed_strip = true
else speed_strip = false
end

if ataxiaTemp.dollFashions &gt; 24 and tBals.tree and not tAffs.aeon and not tAffs.paralysis and (not tAffs.brokenleftarm and not tAffs.brokenrightarm)  then 
force_tree = true
else force_tree = false
end

if not ataxiaTemp.relapse
and ataxiaTemp.dollFashions &gt;= 21 and tAffs.nospeed 
and not tBals.tree and not ataxiaTemp.relapseAff then
relapse_asthma = true
else 
relapse_asthma = false
end

if not tAffs.aeon and ataxiaTemp.dollFashions &gt;= 21 and tAffs.nospeed and ataxiaTemp.relapseAff == "asthma" then
vodun_slow = true
else 
vodun_slow = false
end

if tAffs.aeon and tAffs.curseward and not tAffs.asthma then
breach_asthma = true
else 
breach_asthma = false
end

if tAffs.aeon and tAffs.curseward and tAffs.asthma and not tAffs.anorexia then
breach_ano = true
else 
breach_ano = false
end



if ataxiaTemp.dollFashions &gt; 20 and tAffs.impatience and tAffs.asthma and tAffs.anorexia and not tAffs.slickness then
    need_imbibe = true
    else need_imbibe = false
end

if tAffs.impatience and tAffs.asthma and tAffs.weariness and tAffs.bleed &gt;= 200 and not tAffs.anorexia and not tAffs.slickness then
    need_coagulate = true
    else need_coagulate = false
end

if not tAffs.haemophilia and ataxiaTemp.bloodlet == false then
    need_bloodlet = true
    else need_bloodlet = false
    end
   





if breach_asthma then
atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach invoke soulscourge vodun imbibe kalmia"

elseif breach_asthma then
atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach invoke soulscourge vodun imbibe slike"



elseif need_imbibe then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." weariness invoke soulscourge vodun imbibe gecko"



elseif vodun_slow then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun slow"


elseif relapse_asthma then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;blight "..target.." asthma invoke relapse asthma"


elseif speed_strip then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun slow"


elseif force_tree then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun command touch tree"


elseif need_prone and ataxiaTemp.canJinx then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx sleep sleep "..target
   
   
elseif need_coagulate then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke coagulation slickness"
elseif need_bloodlet and ataxiaTemp.dollFashions &lt; 20 then
  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke bloodlet "..target

elseif ataxiaTemp.canJinx then
    atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx "..curses[1].." "..curses[2].." "..target
elseif curseCharge &gt; 1 then
    atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse "..target.." "..curses[1]
elseif curseCharge &lt;= 1 then
   atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse"

end
if jinx_tzantza then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx amnesia tzantza "..target
   end
if need_tzantza and curseCharge &gt; 1 then
     atk = atk.."stand;wield shield doll {"..target.."};vodun status;swiftcurse "..target.." tzantza"
end
if need_tzantza and curseCharge &lt;= 1 then
     atk = atk.."stand;wield shield doll {"..target.."};vodun status;curse "..target.." tzantza"
end

if not ataxia_needLockBreak() then
if not tzantzacurse then
send("queue addclear free "..atk)
elseif tzantzacurse then
send("none")

end
end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SALVE LOCK PRIOS</name>
										<packageName></packageName>
										<script>function salveprios()

curses = {}
secondcurse = {}

--tAffs[getLockingAffliction()]
 lockaff = getLockingAffliction() 
 


if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end


if not tAffs.anorexia and ataxiaTemp.relapseAff ~= "anorexia" then
    table.insert(curses,"anorexia")
end

if getLockingAffliction() ~= "confusion" and
 not tAffs[getLockingAffliction()] and ataxiaTemp.relapseAff ~= getLockingAffliction()
then    table.insert(curses,getLockingAffliction())
end

if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end

if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end

if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end








if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end






if not tAffs.dizziness and tBals.focus == false and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.dementia and tBals.focus == false and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo and tBals.focus == false and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end

if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end

if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end

if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.masochism and tBals.focus == false and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end






if not swiftness then
attacksalve()
elseif swiftness then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SALVE LOCK ATTACK</name>
										<packageName></packageName>
										<script>function attacksalve()

local atk = combatQueue()
go_cripple = go_cripple or false
ataxia_lockBreak()

if ataxia.afflictions.clumsiness and ataxiaTemp.dollFashions &gt; 10 and not tAffs.paralysis and curses[1] == "paralyse" then
local doll_para = true
else doll_para = false
end







if ataxiaTemp.dollFashions &gt;= 49 and not go_cripple
and not tAffs.prone
 then

 force_restoration = true
else force_restoration = false
end

if ataxiaTemp.dollFashions &gt;= 48 and go_cripple and
not tAffs.prone and not tAffs.brokenleftleg and not tAffs.brokenrightleg then


 need_cripple = true
else need_cripple = false
end

if tAffs.prone and not tAffs.brokenleftarm and not tAffs.brokenrightarm and tBals.tree then
force_tree = true
else force_tree = false
end


if ataxiaTemp.dollFashions &gt;= 41  and not need_cripple and tAffs.prone and
not tAffs.damagedrightleg  then
mangle_rightleg = true
else mangle_rightleg = false
end

if ataxiaTemp.dollFashions &gt;= 34  and not need_cripple and tAffs.prone and not tAffs.damagedleftleg then
mangle_leftleg = true
else mangle_leftleg = false
end


if not ataxiaTemp.relapse
and (tAffs.damagedrightleg or tAffs.damagedleftleg) and tAffs.prone then

relapse_lockaff = true
else relapse_lockaff = false
end

if ataxiaTemp.relapse
 and tAffs.prone 
and not ataxiaTemp.canJinx then

 need_jinx = true
else need_jinx = false
end

if not tAffs.impatience and not tAffs.anorexia
and not ataxiaTemp.canJinx then

 need_jinx = true
else need_jinx = false
end

if ataxiaTemp.tarTumble and tAffs.prone and (tAffs.damagedrightleg or tAffs.damagedleftleg) and not tAffs.agoraphobia then
cancle_tumble_out = true
else cancle_tumble_out = false
end

if ataxiaTemp.tarTumble and tAffs.prone and (tAffs.damagedrightleg or tAffs.damagedleftleg) and not tAffs.claustrophobia then
cancle_tumble_in = true
else cancle_tumble_in = false
end

if ataxiaTemp.dollFashions &gt;= 20 and
tAffs.impatience and tAffs.asthma and not tAffs.anorexia
 then
 ano_gecko = true
else ano_gecko = false

end

if ataxiaTemp.dollFashions &gt;= 20 and
tAffs.impatience and
tAffs.anorexia  then

 asthma_gecko = true
else asthma_gecko = false
end

if getTzantzaAffs() &gt;= 5 and ataxiaTemp.canJinx then
jinx_tzantza = true 
else jinx_tzantza = false
end

if getTzantzaAffs() &gt;= 6 then
need_tzantza = true
else need_tzantza = false

end

if tAffs.aeon then
 need_prone = true

elseif not tAffs.prone and tAffs.paralysis and tAffs.impatience and tAffs.asthma and tAffs.anorexia and tAffs.slickness and ataxiaTemp.canJinx then
need_prone = true
else need_prone = false
end




if ataxiaTemp.dollFashions &gt; 20 and tAffs.impatience and tAffs.asthma and tAffs.weariness and tAffs.bleed &gt;= 100 and not tAffs.anorexia and not tAffs.slickness then
    need_imbibe = true
    else need_imbibe = false
end

if tAffs.impatience and tAffs.asthma and tAffs.bleed &gt;= 100 and not tAffs.anorexia and not tAffs.slickness then
   need_coagulate = true
    else need_coagulate = false
end

if not tAffs.haemophilia and ataxiaTemp.bloodlet == false then
   need_bloodlet = true
    else need_bloodlet = false
    end
   




if tAffs.curseward then

    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach"

elseif need_imbibe then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke soulscourge vodun imbibe gecko"

elseif force_tree then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun command touch tree"

elseif force_restoration then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun command apply restoration to torso"


elseif need_cripple then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun cripple"
  
  elseif ano_gecko then
atk = atk.."stand;wield shield doll {"..target.."};curse "..target.." anorexia invoke soulscourge vodun imbibe gecko"

elseif asthma_gecko then
atk = atk.."stand;wield shield doll {"..target.."};curse "..target.." asthma invoke soulscourge vodun imbibe gecko"



elseif mangle_rightleg then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun mangle right leg"
  elseif mangle_leftleg then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun mangle left leg"


elseif relapse_lockaff then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;curse "..target.." "..getLockingAffliction().." invoke relapse "..getLockingAffliction()

elseif need_jinx then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;curse "..target.." breach"




elseif need_prone and ataxiaTemp.canJinx then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx sleep sleep "..target
   
   
elseif need_coagulate then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke coagulation slickness"
elseif need_bloodlet and ataxiaTemp.dollFashions &lt; 20 then
  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke bloodlet "..target

elseif ataxiaTemp.canJinx then
    atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx "..curses[1].." "..curses[2].." "..target
    elseif doll_para then
    atk = atk.."wield shield doll {"..target.."};vodun status;vodun paralyse"
elseif curseCharge &gt; 1 then
    atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse "..target.." "..curses[1]
elseif curseCharge &lt;= 1 then
   atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse"

end
if not tzantzacurse then
send("queue addclear free "..atk)
elseif tzantzacurse then
send("none")

end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>GOLDENSEAL PRIOS</name>
										<packageName></packageName>
										<script>function goldenprios()

curses = {}


if tAffs.curseward then
    table.insert(curses,"breach")
end


if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end

if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end


if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end

if not tAffs.dizziness and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.epilepsy and ataxiaTemp.relapseAff ~= "epilepsy" then
    table.insert(curses,"epilepsy")
end

if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end




if not tAffs.dementia and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo  and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end




if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end




if not tAffs.masochism and tBals.focus == false and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
    
    
end


if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end

if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end


if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end


if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end




if not swiftness then
attack()
elseif swiftness then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>GINSENG STACK</name>
										<packageName></packageName>
										<script>function ginsengprios()

curses = {}


if tAffs.curseward then
    table.insert(curses,"breach")
end

if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end

if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end

if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end

if not tAffs.clumsiness and ataxiaTemp.relapseAff ~= "clumsiness" then
    table.insert(curses,"clumsy")
end



if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end



if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end

if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end



if not tAffs.dizziness and tBals.focus == false and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.dementia and tBals.focus == false and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo and tBals.focus == false and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end

if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end



if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.masochism and tBals.focus == false and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end

if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end




if not swiftness then
ginsengattack()
elseif swiftness then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>KILL TIMERS</name>
										<packageName></packageName>
										<script>function killcurses()
disableTimer("DOL")
disableTimer("HAE")
disableTimer("SAL")
disableTimer("CLU")
disableTimer("SLO")
disableTimer("STU")
disableTimer("GIN")
disableTimer("TZA")
disableTimer("GOL")

end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>STUPID PRIOS</name>
										<packageName></packageName>
										<script>function stupidprios()

curses = {}
secondcurse = {}



rending = false

if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end


if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end




if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end

if getLockingAffliction() ~= "confusion" and getLockingAffliction() ~= "weariness" and
 not tAffs[getLockingAffliction()] and ataxiaTemp.relapseAff ~= getLockingAffliction()
then    table.insert(curses,getLockingAffliction())
end



if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end

if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end


if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.vertigo and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end

if not tAffs.dizziness and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end








if not tAffs.dementia and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end



if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end


if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end



if not tAffs.masochism  and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end






if not swiftness then
attack()
elseif swiftness then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>RIFTLOCK PRIOS</name>
										<packageName></packageName>
										<script>function riftprios()

curses = {}
secondcurse = {}



rending = false

if tAffs.impatience and tAffs.asthma and not tAffs.anorexia and tAffs.paralysis and tAffs.haemophilia and shaman.spiritisbound("aspar") then
    table.insert(curses,"anorexia")
end

if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end

if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end


if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end


if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end








if getLockingAffliction() ~= "confusion" and getLockingAffliction() ~= "weariness" and getLockingAffliction() ~= "plague"  and
 not tAffs[getLockingAffliction()] and ataxiaTemp.relapseAff ~= getLockingAffliction()
then    table.insert(curses,getLockingAffliction())
end

if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end

if not tAffs.vertigo and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end

if not tAffs.dizziness and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end








if not tAffs.dementia and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end



if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end

if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end



if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end



if not tAffs.masochism  and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end






if not swiftness then
attack()
elseif swiftness then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SALVE ILLUSION</name>
										<packageName></packageName>
										<script>function attacksalveillusion()

local atk = combatQueue()
go_cripple = go_cripple or false

if ataxia.afflictions.clumsiness and ataxiaTemp.dollFashions &gt; 10 and not tAffs.paralysis and curses[1] == "paralyse" then
local doll_para = true
else doll_para = false
end







if ataxiaTemp.dollFashions &gt;= 49 and not go_cripple
and not tAffs.prone
 then

 force_restoration = true
else force_restoration = false
end

if ataxiaTemp.dollFashions &gt;= 48 and go_cripple and
not tAffs.prone and not tAffs.brokenleftleg and not tAffs.brokenrightleg then


 need_cripple = true
else need_cripple = false
end

if tAffs.prone and not tAffs.brokenleftarm and not tAffs.brokenrightarm and tBals.tree then
force_tree = true
else force_tree = false
end


if ataxiaTemp.dollFashions &gt;= 41  and not need_cripple and tAffs.prone and
not tAffs.damagedrightleg  then
mangle_rightleg = true
else mangle_rightleg = false
end

if ataxiaTemp.dollFashions &gt;= 34  and not need_cripple and tAffs.prone and not tAffs.damagedleftleg then
mangle_leftleg = true
else mangle_leftleg = false
end


if not ataxiaTemp.relapse
and (tAffs.damagedrightleg or tAffs.damagedleftleg) and tAffs.prone then

relapse_lockaff = true
else relapse_lockaff = false
end

if ataxiaTemp.relapse
 and tAffs.prone
and not ataxiaTemp.canJinx then

 need_jinx = true
else need_jinx = false
end

if not tAffs.impatience and not tAffs.anorexia 
and not ataxiaTemp.canJinx then

 need_jinx = true
else need_jinx = false
end

if ataxiaTemp.tarTumble and tAffs.prone and (tAffs.damagedrightleg or tAffs.damagedleftleg) and not tAffs.agoraphobia then
cancle_tumble_out = true
else cancle_tumble_out = false
end

if ataxiaTemp.tarTumble and tAffs.prone and (tAffs.damagedrightleg or tAffs.damagedleftleg) and not tAffs.claustrophobia then
cancle_tumble_in = true
else cancle_tumble_in = false
end

if ataxiaTemp.dollFashions &gt;= 20 and
tAffs.impatience and tAffs.asthma and not tAffs.anorexia
 then
 ano_gecko = true
else ano_gecko = false

end

if ataxiaTemp.dollFashions &gt;= 20 and
tAffs.impatience and
tAffs.anorexia  then

 asthma_gecko = true
else asthma_gecko = false
end

if getTzantzaAffs() &gt;= 5 and ataxiaTemp.canJinx then
jinx_tzantza = true 
else jinx_tzantza = false
end

if getTzantzaAffs() &gt;= 6 then
need_tzantza = true
else need_tzantza = false

end

if tAffs.aeon then
 need_prone = true

elseif not tAffs.prone and tAffs.paralysis and tAffs.impatience and tAffs.asthma and tAffs.anorexia and tAffs.slickness and ataxiaTemp.canJinx then
need_prone = true
else need_prone = false
end




if ataxiaTemp.dollFashions &gt; 20 and tAffs.impatience and tAffs.asthma and tAffs.weariness and tAffs.bleed &gt;= 100 and not tAffs.anorexia and not tAffs.slickness then
    need_imbibe = true
    else need_imbibe = false
end

if tAffs.impatience and tAffs.asthma and tAffs.bleed &gt;= 100 and not tAffs.anorexia and not tAffs.slickness then
   need_coagulate = true
    else need_coagulate = false
end

if not tAffs.haemophilia and ataxiaTemp.bloodlet == false then
   need_bloodlet = true
    else need_bloodlet = false
    end
   




if need_imbibe then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke soulscourge vodun imbibe gecko"

elseif force_tree then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun command touch tree"

elseif force_restoration then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun command apply restoration to torso"


elseif need_cripple then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun cripple"
  
  elseif ano_gecko then
atk = atk.."stand;wield shield doll {"..target.."};curse "..target.." anorexia invoke soulscourge vodun imbibe gecko"

elseif asthma_gecko then
atk = atk.."stand;wield shield doll {"..target.."};curse "..target.." asthma invoke soulscourge vodun imbibe gecko"



elseif mangle_rightleg then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun mangle right leg"
  elseif mangle_leftleg then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun mangle left leg"


elseif relapse_lockaff then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;curse "..target.." "..getLockingAffliction().." invoke relapse "..getLockingAffliction()

elseif need_jinx then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;curse "..target.." breach"




elseif need_prone and ataxiaTemp.canJinx then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx sleep sleep "..target
   
   
elseif need_coagulate then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke coagulation slickness"
elseif need_bloodlet and ataxiaTemp.dollFashions &lt; 20 then
  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke bloodlet "..target

elseif ataxiaTemp.canJinx then
    atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx "..curses[1].." "..curses[2].." "..target
    elseif doll_para then
    atk = atk.."wield shield doll {"..target.."};vodun status;vodun paralyse"
elseif curseCharge &gt; 1 then
    atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse "..target.." "..curses[1]
elseif curseCharge &lt;= 1 then
   atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse"

end
if not tzantzacurse then
send("queue addclear free "..atk)
elseif tzantzacurse then
send("none")

end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>ILLUSION PRIOS</name>
										<packageName></packageName>
										<script>function salvepriosillusion()

curses = {}
secondcurse = {}

--tAffs[getLockingAffliction()]
 lockaff = getLockingAffliction() 
 


if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end


if not tAffs.anorexia and ataxiaTemp.relapseAff ~= "anorexia" then
    table.insert(curses,"anorexia")
end

if getLockingAffliction() ~= "confusion" and
 not tAffs[lockaff] and ataxiaTemp.relapseAff ~= getLockingAffliction()
then    table.insert(curses,getLockingAffliction())
end

if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end

if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end

if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end








if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end






if not tAffs.dizziness and tBals.focus == false and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.dementia and tBals.focus == false and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo and tBals.focus == false and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end

if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end

if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end

if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.masochism and tBals.focus == false and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end






if not swiftness then
attacksalveillusion()
elseif swiftness then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>COAGULATE PRIOS</name>
										<packageName></packageName>
										<script>function coagprios()

cursescoag = {}


if not tAffs.slickness and tAffs.asthma and tAffs.impatience and curses[1] == "anorexia" then
    table.insert(cursescoag,"slickness")
end






end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SALVELOCKWEARY PRIOS</name>
										<packageName></packageName>
										<script>function salvepriosweary()

curses = {}
secondcurse = {}

--tAffs[getLockingAffliction()]
 lockaff = getLockingAffliction() 
 


if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end


if not tAffs.anorexia and ataxiaTemp.relapseAff ~= "anorexia" then
    table.insert(curses,"anorexia")
end

if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end
if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end

if not tAffs.voyria and ataxiaTemp.relapseAff ~= "plague" then
    table.insert(curses,"plague")
end

if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end








if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end






if not tAffs.dizziness and tBals.focus == false and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.dementia and tBals.focus == false and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo and tBals.focus == false and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end



if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end

if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.masochism and tBals.focus == false and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end

if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end






if not swiftness then
attacksalveweary()
elseif swiftness then
attackswift()
end
end

</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>SALVE LOCK WEARY</name>
										<packageName></packageName>
										<script>function attacksalveweary()

local atk = combatQueue()
go_cripple = go_cripple or false

if ataxia.afflictions.clumsiness and ataxiaTemp.dollFashions &gt; 10 and not tAffs.paralysis and curses[1] == "paralyse" then
local doll_para = true
else doll_para = false
end







if ataxiaTemp.dollFashions &gt;= 49 and not go_cripple
and not tAffs.prone
 then

 force_restoration = true
else force_restoration = false
end

if ataxiaTemp.dollFashions &gt;= 48 and go_cripple and
not tAffs.prone and not tAffs.brokenleftleg and not tAffs.brokenrightleg then


 need_cripple = true
else need_cripple = false
end

if tAffs.prone and not tAffs.brokenleftarm and not tAffs.brokenrightarm and tBals.tree then
force_tree = true
else force_tree = false
end


if ataxiaTemp.dollFashions &gt;= 41  and not need_cripple and tAffs.prone and
not tAffs.damagedrightleg  then
mangle_rightleg = true
else mangle_rightleg = false
end

if ataxiaTemp.dollFashions &gt;= 34  and not need_cripple and tAffs.prone and not tAffs.damagedleftleg then
mangle_leftleg = true
else mangle_leftleg = false
end


if not ataxiaTemp.relapse
and (tAffs.damagedrightleg or tAffs.damagedleftleg) and tAffs.prone then

relapse_lockaff = true
else relapse_lockaff = false
end

if ataxiaTemp.relapse
 and tAffs.prone 
and not ataxiaTemp.canJinx then

 need_jinx = true
else need_jinx = false
end

if not tAffs.impatience and not tAffs.anorexia
and not ataxiaTemp.canJinx then

 need_jinx = true
else need_jinx = false
end

if ataxiaTemp.tarTumble and tAffs.prone and (tAffs.damagedrightleg or tAffs.damagedleftleg) and not tAffs.agoraphobia then
cancle_tumble_out = true
else cancle_tumble_out = false
end

if ataxiaTemp.tarTumble and tAffs.prone and (tAffs.damagedrightleg or tAffs.damagedleftleg) and not tAffs.claustrophobia then
cancle_tumble_in = true
else cancle_tumble_in = false
end

if ataxiaTemp.dollFashions &gt;= 20 and
tAffs.impatience and tAffs.asthma and not tAffs.anorexia
 then
 ano_gecko = true
else ano_gecko = false

end

if ataxiaTemp.dollFashions &gt;= 20 and
tAffs.impatience and
tAffs.anorexia  then

 asthma_gecko = true
else asthma_gecko = false
end

if getTzantzaAffs() &gt;= 5 and ataxiaTemp.canJinx then
jinx_tzantza = true 
else jinx_tzantza = false
end

if getTzantzaAffs() &gt;= 6 then
need_tzantza = true
else need_tzantza = false

end

if tAffs.aeon then
 need_prone = true

elseif not tAffs.prone and tAffs.paralysis and tAffs.impatience and tAffs.asthma and tAffs.anorexia and tAffs.slickness and ataxiaTemp.canJinx then
need_prone = true
else need_prone = false
end




if ataxiaTemp.dollFashions &gt; 20 and tAffs.impatience and tAffs.asthma and tAffs.weariness and tAffs.bleed &gt;= 100 and not tAffs.anorexia and not tAffs.slickness then
    need_imbibe = true
    else need_imbibe = false
end

if tAffs.impatience and tAffs.asthma and tAffs.bleed &gt;= 100 and not tAffs.anorexia and not tAffs.slickness then
   need_coagulate = true
    else need_coagulate = false
end

if not tAffs.haemophilia and ataxiaTemp.bloodlet == false then
   need_bloodlet = true
    else need_bloodlet = false
    end
   




if tAffs.curseward then

    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach"

elseif need_imbibe then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke soulscourge vodun imbibe gecko"

elseif force_tree then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun command touch tree"

elseif force_restoration then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun command apply restoration to torso"


elseif need_cripple then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun cripple"
  
  elseif ano_gecko then
atk = atk.."stand;wield shield doll {"..target.."};curse "..target.." anorexia invoke soulscourge vodun imbibe gecko"

elseif asthma_gecko then
atk = atk.."stand;wield shield doll {"..target.."};curse "..target.." asthma invoke soulscourge vodun imbibe gecko"



elseif mangle_rightleg then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun mangle right leg"
  elseif mangle_leftleg then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;vodun mangle left leg"


elseif relapse_lockaff then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;curse "..target.." weariness invoke relapse weariness"

elseif need_jinx then
  atk = atk.."stand;wield shield doll {"..target.."};vodun status;curse "..target.." breach"




elseif need_prone and ataxiaTemp.canJinx then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx sleep sleep "..target
   
   
elseif need_coagulate then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke coagulation slickness"
elseif need_bloodlet and ataxiaTemp.dollFashions &lt; 20 then
  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke bloodlet "..target

elseif ataxiaTemp.canJinx then
    atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx "..curses[1].." "..curses[2].." "..target
    elseif doll_para then
    atk = atk.."wield shield doll {"..target.."};vodun status;vodun paralyse"
elseif curseCharge &gt; 1 then
    atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse "..target.." "..curses[1]
elseif curseCharge &lt;= 1 then
   atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse"

end
if not tzantzacurse then
send("queue addclear free "..atk)
elseif tzantzacurse then
send("none")

end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>BLIGHT WEARINESS</name>
										<packageName></packageName>
										<script>function attackblightweary()
coagprios()
local atk = combatQueue()

ataxiaTemp.dollFashions = ataxiaTemp.dollFashions or 0
if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
	local	hardlock = true
   hardlock = false
	

	end

	if hardlock and haveAff("paralysis") then
	local	truelock = true
 truelock = false
	
	end

rending = false


if ataxiaTemp.dollFashions and ataxiaTemp.dollFashions &gt; 20 and not tAffs.paralysis and curses[1] == "paralysis" then
 doll_para = true
else doll_para = false
end

if ataxia.afflictions.clumsiness and ataxiaTemp.dollFashions &lt;= 20 then
 doll_fashion = true
else doll_fashion = false
end

if ataxiaTemp.dollFashions &gt; 0 and rending and tAffs.manaleech then
need_soulrend = true
else need_soulrend = false
end

if ataxiaTemp.dollFashions &gt; 0 and rending and manapercent and manapercent &lt;= 76 then
need_soulrend2 = true
else need_soulrend2 = false
end



if getTzantzaAffs() &gt;= 5 and ataxiaTemp.dollFashions &gt; 30 then
 bind_tzantza = true 
else bind_tzantza = false
end


if tAffs.paralysis and tAffs.asthma and tAffs.impatience and 
not tAffs.weariness and getLockingAffliction() == "weariness" then
 need_blight = true
else need_blight = false

end

if getTzantzaAffs() &gt;= 5 and ataxiaTemp.canJinx then
jinx_tzantza = true
else
jinx_tzantza = false
end

if ataxiaTemp.canJinx and not tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
jinx_anoimp = true
else jinx_anoimp = false
end

if not tAffs.weariness and tAffs.paralysis then
need_blight = true
else need_blight = false
end

if ataxiaTemp.canJinx and not tAffs.impatience and not tAffs.asthma then
jinx_impasthma = true
else jinx_impasthma = false
end


if ataxiaTemp.canJinx and tAffs.paralysis and tAffs.asthma and not tAffs.impatience and not tAffs.stupidity then
jinx_impstu = true
else jinx_impstu = false
end

if ataxiaTemp.canJinx and tAffs.slickness then
jinx_anopar = true
else jinx_anopar = false
end

if ataxiaTemp.canJinx and not tAffs.paralysis and not tAffs.haemophilia then
jinx_haepar = true
else jinx_haepar = false
end



if ataxiaTemp.canJinx and not tAffs.asthma and not tAffs.manaleech and rending then
jinx_astmana = true
else jinx_astmana = false
end


if truelock and ataxiaTemp.canJinx then
 need_prone = true
else need_prone = false
end

if ataxiaTemp.dollFashions &gt; 20 and tAffs.paralysis and tAffs.impatience and tAffs.asthma and tAffs[getLockingAffliction()] and not tAffs.anorexia and not tAffs.slickness then
    need_imbibe = true
    else need_imbibe = false
end

if ataxiaTemp.dollFashions &gt; 20 and not tBals.tree and tAffs[getLockingAffliction()] and not tAffs.asthma and not tAffs.slickness  and tAffs.impatience then
    need_imbibe2 = true
    else need_imbibe2 = false
end

if ataxiaTemp.dollFashions &gt; 20 and tAffs[getLockingAffliction()] and not tAffs.asthma and not tAffs.slickness and tAffs.paralysis and tAffs.impatience then
    need_imbibe2 = true
    else need_imbibe2 = false
end

if not ataxiaTemp.coagulate and not tBals.tree and shaman.spiritisbound("aspar") and tAffs[getLockingAffliction()] and tAffs.haemophilia and tAffs.impatience and tAffs.asthma and tAffs.bleed &gt;= 100 and not tAffs.anorexia and not tAffs.slickness then
   need_coagulate = true
    else need_coagulate = false
end

if not ataxiaTemp.coagulate and tAffs.haemophilia and shaman.spiritisbound("aspar") and tAffs.bleed &gt;= 100 and tAffs.asthma and not tAffs.anorexia and not tAffs.slickness and tAffs.paralysis and curses[1] ~= "impatience" then
   need_coagulate = true
    else need_coagulate = false
end

if not ataxiaTemp.coagulate and tAffs.haemophilia and tAffs.bleed &gt;= 100 and shaman.spiritisbound("aspar") and curses[1] == "anorexia" then
   need_coagulate_basic = true
    else need_coagulate_basic = false
end

if not ataxiaTemp.coagulate and tAffs[getLockingAffliction()] and tAffs.haemophilia and not tAffs.impatience and tAffs.asthma and tAffs.bleed &gt;= 100 and not tAffs.paralysis and not tAffs.slickness then
   need_coagulate2 = true
    else need_coagulate2 = false
end

if not tAffs.haemophilia and tAffs.paralysis and not ataxiaTemp.bloodlet and curses[1] ~= "haemophilia" then
    need_bloodlet = true
    else need_bloodlet = false
    end
   
if tAffs.impatience and shaman.spiritisbound("syvis") and not ataxiaTemp.relapse and not tAffs[getLockingAffliction()] and getLockingAffliction() ~= "weariness" and getLockingAffliction() ~= "confusion" and getLockingAffliction() ~= "plague" then
   need_relapse = true 
    else need_relapse = false
    end




if tAffs.curseward then

    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach"
elseif jinx_tzantza then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx amnesia tzantza "..target


elseif need_imbibe then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." anorexia invoke soulscourge vodun imbibe gecko"

elseif need_imbibe2 then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." asthma invoke soulscourge vodun imbibe gecko"


elseif bind_tzantza then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." tzantza invoke soulscourge vodun bind"

elseif need_coagulate_basic then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke coagulation "..cursescoag[1]


elseif need_coagulate then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke coagulation slickness"

elseif need_coagulate2 then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." paralysis invoke coagulation slickness"

elseif jinx_anopar then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx anorexia paralysis "..target
   

elseif jinx_anoimp then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx anorexia impatience "..target
   
   elseif jinx_asthma then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx impatience asthma "..target

   
elseif jinx_impstu then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx impatience stupid "..target

elseif jinx_anostu then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx anorexia stupid "..target

elseif jinx_clupar then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx clumsy paralysis "..target

   elseif jinx_astmana then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx asthma manaleech "..target

elseif jinx_astclu then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx asthma clumsy "..target
elseif jinx_astwea then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx asthma weariness "..target
elseif need_soulrend2 then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke soulrend "..target
elseif need_soulrend then
    atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke soulrend "..target

elseif need_blight then
    
  atk = atk.."wield shield doll {"..target.."};vodun status;blight "..target.." weariness"



elseif need_bloodlet then
  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..curses[1].." invoke bloodlet "..target
elseif need_relapse then

  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." "..getLockingAffliction().." invoke relapse "..getLockingAffliction()

elseif doll_para then
    atk = atk.."wield shield doll {"..target.."};vodun status;vodun paralyse"
elseif doll_fashion then
   if tAffs.manaleech then

  atk = atk.."wield shield doll {"..target.."};vodun status;curse "..target.." breach invoke soulrend"
else


atk = atk.."wield shield doll {"..target.."};vodun status;fashion doll of "..target

end

elseif curseCharge &gt; 1 then
    atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse "..target.." "..curses[1]
elseif curseCharge &lt;= 1 then
   atk = atk.."wield shield doll {"..target.."};vodun status;swiftcurse"


elseif need_prone then
   atk = atk.."stand;wield shield doll {"..target.."};vodun status;jinx sleep sleep "..target

end


if not tzantzacurse then
send("queue addclear free "..atk)
elseif tzantzacurse then
send("none")

end
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>WEARY PRIOS</name>
										<packageName></packageName>
										<script>function weariprios()

getLockingAffliction()
curses = {}

if checkAffList({"anorexia", "asthma", "slickness", "bloodfire"},3) then
	local	softlock = true
  else
  softlock = false
	
	end
	if softlock and checkAffList({"impatience", "sandfever"},1) then
	local	hardlock = true
   hardlock = false
	

	end

	if hardlock and haveAff("paralysis") then
	local	truelock = true
 truelock = false
	
	end
  swiftness = swiftness or false
 
  if ataxiaTemp.dollFashions and ataxiaTemp.dollFashions &gt; 0 and ataxiaTemp.dollFashions &lt; 55 then
rending = true
else
rending = false
end

if truelock and not tAffs.voyria  then

    table.insert(curses,"plague")
end

if tAffs.slickness and not tAffs.anorexia and tAffs.impatience then
    table.insert(curses,"anorexia")
end

if  tAffs.asthma and not tAffs.anorexia and tAffs.impatience then
    table.insert(curses,"anorexia")
end

if not tAffs.paralysis and ataxiaTemp.relapseAff ~= "paralysis" then
    table.insert(curses,"paralysis")
end
if not tAffs.haemophilia and ataxiaTemp.relapseAff ~= "haemophilia" then
    table.insert(curses,"haemophilia")
end



if not tAffs.impatience and ataxiaTemp.relapseAff ~= "impatience" then
    table.insert(curses,"impatience")
end



if not tAffs.asthma and ataxiaTemp.relapseAff ~= "asthma" then
    table.insert(curses,"asthma")
end

if not tAffs.asthma and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end



if not tAffs.healthleech and ataxiaTemp.relapseAff ~= "healthleech" then
    table.insert(curses,"healthleech")
end

if not tAffs.clumsiness and ataxiaTemp.relapseAff ~= "clumsiness" then
    table.insert(curses,"clumsy")
end

if getLockingAffliction() ~= "confusion" and getLockingAffliction() ~= "weariness" and getLockingAffliction() ~= "plague" and
 not tAffs[getLockingAffliction()] and ataxiaTemp.relapseAff ~= getLockingAffliction()
then    table.insert(curses,getLockingAffliction())
end

if not tAffs.stupidity and ataxiaTemp.relapseAff ~= "stupid" then
    table.insert(curses,"stupid")
end



if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end




if not tAffs.dizziness  and ataxiaTemp.relapseAff ~= "dizzy" then
    table.insert(curses,"dizzy")
end

if not tAffs.dementia  and ataxiaTemp.relapseAff ~= "dementia" then
    table.insert(curses,"dementia")
end

if not tAffs.vertigo  and ataxiaTemp.relapseAff ~= "vertigo" then
    table.insert(curses,"vertigo")
end

if not tAffs.weariness and ataxiaTemp.relapseAff ~= "weariness" then
    table.insert(curses,"weariness")
end

if not tAffs.addiction and ataxiaTemp.relapseAff ~= "addiction" then
    table.insert(curses,"addiction")
end

if not tAffs.nausea and ataxiaTemp.relapseAff ~= "nausea" then
    table.insert(curses,"vomiting")
end

if not tAffs.recklessness and ataxiaTemp.relapseAff ~= "recklessness" then
table.insert(curses,"reckless")
end

if not tAffs.masochism and ataxiaTemp.relapseAff ~= "masochism" then
    table.insert(curses,"masochism")
end







if swiftness == false then
attackblightweary()
elseif swiftness == true then
attackswift()
end
end


</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>Levi Shaman</name>
										<packageName></packageName>
										<script>function levishamanlock()
--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--tBals.plant
--tBals.tree
--tAffs.hypnoseal
--snapTarget
--tAffs.snapped
--tAffs.hypnotising

--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
  local	treelock = true
else
  treelock = false
end

--Define Kelp Stack
if checkAffList({"hypochondria", "parasite", "weariness",  "asthma", "healthleech", "clumsiness", "sensitivity"},3) then
  tAffs.kelpstack = true
else
  tAffs.kelpstack = false
end

--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false

--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--tBals.plant
--tBals.tree


--Tree lock because I am too lazy to put into checkTargetLocks function
if checkAffList({"anorexia", "asthma", "slickness", "paralysis"},4) then
  local	treelock = true
else
  treelock = false
end

--Define Tzantza
if checkAffList({"agoraphobia", "confusion", "claustrophobia",  "amnesia", "dementia", "impatience", "dizziness","paranoia", "stupidity", "addiction",  "epilepsy", "dementia", "vertigo ", "masochism","recklessness"},4) then
  tAffs.tzanstack = true
else
  tAffs.tzanstack = false
end    
     
if checkAffList({"agoraphobia", "confusion", "claustrophobia",  "amnesia", "dementia", "impatience", "dizziness","paranoia", "stupidity", "addiction",  "epilepsy", "dementia", "vertigo ", "masochism","recklessness"},5) then
  tAffs.tzanstack2 = true
else
  tAffs.tzanstack2 = false
end        

if checkAffList({"agoraphobia", "confusion", "claustrophobia",  "amnesia", "dementia", "impatience", "dizziness","paranoia", "stupidity", "addiction",  "epilepsy", "dementia", "vertigo ", "masochism","recklessness"},6) then
  tAffs.tzanstackinstant = true
else
  tAffs.tzanstackinstant = false
end      
          
       
           


--Define Kelp Stack
if checkAffList({"hypochondria", "parasite", "weariness",  "asthma", "healthleech", "clumsiness", "sensitivity"},3) then
  tAffs.kelpstack = true
else
  tAffs.kelpstack = false
end

--Get Anti-Active Cure
tstopcuring = getLockingAffliction(target) or nil
--Anti-Tumble - Confusion might not stop it...
ataxiaTemp.tarTumble = ataxiaTemp.tarTumble or false

envenomList = {}

if tAffs.curseward then
  table.insert(envenomList,"breach") 
elseif truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis then
    table.insert(envenomList,"paralyse") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness then
    table.insert(envenomList,"weariness") 
  elseif getLockingAffliction(target) == "haemophilia" then
	  table.insert(envenomList,"haemophilia") 
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague then
    table.insert(envenomList,"plague") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity then
    table.insert(envenomList,"stupid")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness then
    table.insert(envenomList,"reckless")
  else
    table.insert(envenomList,"plague")   
  end
elseif hardlock == true and not tAffs.paralysis then
  table.insert(envenomList,"paralyse") 
elseif softlock == true and not tAffs.paralysis then
  table.insert(envenomList,"paralyse") 
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness then
  table.insert(envenomList,"anorexia")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness then
  table.insert(envenomList,"anorexia")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia then
  table.insert(envenomList,"anorexia") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience then
  table.insert(envenomList,"gecko") 
elseif not tAffs.slickness and tAffs.asthma then
  table.insert(envenomList,"gecko")
elseif ataxiaNDB_getClass(target) == "Priest" or ataxiaNDB_getClass(target) == "Occultist" or ataxiaNDB_getClass(target) == "Pariah" then
  if not tAffs.weariness then
    table.insert(envenomList,"weariness")
  elseif not tAffs.asthma then
    table.insert(envenomList,"asthma")
  elseif not tAffs.nausea then
    table.insert(envenomList,"vomiting")
  elseif not tAffs.darkshade then
    table.insert(envenomList,"darkshade")
  elseif not tAffs.addiction then
    table.insert(envenomList,"addiction")
  else
    table.insert(envenomList,"stupid")
  end
elseif not tAffs.clumsiness then
  table.insert(envenomList,"clumsy")
elseif not tAffs.impatience then
  table.insert(envenomList,"impatience")
elseif not tAffs.asthma then
  table.insert(envenomList,"asthma")
elseif not tAffs.weariness then
  table.insert(envenomList,"weariness")
elseif not tAffs.nausea then
  table.insert(envenomList,"vomiting")
elseif not tAffs.addiction then
  table.insert(envenomList,"addiction")
else
  table.insert(envenomList,"stupid")
end



--Set Venom Two Table
envenomListTwo = {}

if truelock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and envenomList[1] ~= "paralyse" then
    table.insert(envenomListTwo,"paralyse") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and envenomList[1] ~= "weariness" then
    table.insert(envenomListTwo,"weariness") 
  elseif getLockingAffliction(target) == "haemophilia" and not tAffs.haemophilia and envenomList[1] ~= "haemophilia" then
	table.insert(envenomList,"haemophilia") 
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and envenomList[1] ~= "plague" then
    table.insert(envenomListTwo,"plague") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and envenomList[1] ~= "stupid" then
    table.insert(envenomListTwo,"stupid")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and envenomList[1] ~= "reckless" then
   table.insert(envenomListTwo,"reckless") 
  end
elseif hardlock == true and not tAffs.paralysis and envenomList[1] ~= "paralyse" then
  table.insert(envenomListTwo,"paralyse") 
elseif softlock == true then
  if getLockingAffliction(target) == "paralyse" and not tAffs.paralysis and envenomList[1] ~= "paralyse" then
    table.insert(envenomListTwo,"paralyse") 
  elseif getLockingAffliction(target) == "weariness" and not tAffs.weariness and envenomList[1] ~= "weariness" then
    table.insert(envenomListTwo,"weariness") 
  elseif getLockingAffliction(target) == "haemophilia" and not tAffs.haemophilia and envenomList[1] ~= "haemophilia" then
	table.insert(envenomList,"haemophilia") 
  elseif getLockingAffliction(target) == "plague" and not tAffs.plague and envenomList[1] ~= "plague" then
    table.insert(envenomListTwo,"plague") 
  elseif getLockingAffliction(target) == "stupid" and not tAffs.stupidity and envenomList[1] ~= "stupid" then
    table.insert(envenomListTwo,"stupid")  
  elseif getLockingAffliction(target) == "reckless" and not tAffs.recklessness and envenomList[1] ~= "reckless" then
   table.insert(envenomListTwo,"reckless") 
  end
elseif softlock == true and not tAffs.paralysis and envenomList[1] ~= "paralyse" then
  table.insert(envenomListTwo,"paralyse")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and tAffs.slickness and envenomList[1] ~= "anorexia" then
  table.insert(envenomListTwo,"anorexia")
elseif tAffs.asthma and tAffs.impatience and tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.asthma and tAffs.impatience and not tAffs.anorexia and not tAffs.slickness and envenomList[1] ~= "anorexia" then
  table.insert(envenomListTwo,"anorexia")
elseif tAffs.slickness and tAffs.asthma and tAffs.impatience and not tAffs.anorexia and envenomList[1] ~= "anorexia" then
  table.insert(envenomListTwo,"anorexia") 
elseif not tAffs.slickness and tAffs.asthma and tAffs.impatience and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko") 
elseif not tAffs.slickness and tAffs.asthma and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif tAffs.prone and not tAffs.slickness and envenomList[1] ~= "gecko" then
  table.insert(envenomListTwo,"gecko")
elseif not tAffs.paralysis and envenomList[1] ~= "paralyse" then
  table.insert(envenomListTwo,"paralyse")
elseif not tAffs.asthma and envenomList[1] ~= "asthma" then
  table.insert(envenomListTwo,"asthma")
elseif not tAffs.weariness and envenomList[1] ~= "weariness" then
  table.insert(envenomListTwo,"weariness")
elseif not tAffs.clumsiness and envenomList[1] ~= "clumsy" then
  table.insert(envenomListTwo,"clumsy")
elseif not tAffs.nausea and envenomList[1] ~= "euphorbia" then
  table.insert(envenomListTwo,"euphorbia")
elseif not tAffs.addiction and envenomList[1] ~= "addiction" then
  table.insert(envenomListTwo,"addiction")
elseif envenomList[1] ~= "stupid" then
  table.insert(envenomListTwo,"stupid")
end

if ataxiaTemp.canJinx == true then
atk = atk.."wield left shield;wield right doll {"..target.."};vodun status;jinx " ..envenomList[1].. " " ..envenomListTwo[1].. " " ..target
end

end













</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Pariah</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>Pariah Logic</name>
										<packageName></packageName>
										<script>function levipariahlatencytest()
local atk = combatQueue()
local sp = ataxia.settings.separator
local e = ataxia.vitals.epitaph
local plagues = {"mycalium", "rebbies", "sandfever", "flushings", "pyramides" }
local tp = false
taccelerates = taccelerates or 0
--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--Define Kelp Stack
if checkAffList({"paralysis", "asthma", "epilepsy",  "clumsiness", "impatience", "addiction", "relapsing"},3) then
  tAffs.logostack = true
else
  tAffs.logostack = false
end
--Define Plague Stack
if checkAffList({"mycalium", "rebbies", "sandfever", "flushings", "pyramides" },2) then
  plaguestackone = true
else
  plaguestackone = false
end

--Define Plague Stack
if checkAffList({"mycalium", "rebbies", "sandfever", "flushings", "pyramides" },3) then
  tlatency = true
else
  tlatency = false
end


--Nest/Scales/Skein/Sun + Burrow/Serpent + Burrow/ Nest/ Scales/ Standfever Sting + Skein/ Rebbies + Sun/Sandfever + Serpent/ Nest/ Flushings Sting + Bear/ Flushing Burrow + Jackal / Flushings Burrow + Serpent / Rebbies + Nest/ Pyramides + Bear / Flushing + Scarab / Latency + Scorpion / Serpent + Accelerate / Nest + Accelerate

logographtrace = {}
if tAffs.shield then
  table.insert(logographtrace,"fissure")
elseif not pariah.lastLogograph then
  table.insert(logographtrace,"serpent")
-- NEST
elseif pariah.lastLogograph == "nest" then
  if tAffs.impatience or tAffs.sandfever then
    table.insert(logographtrace,"bear")
  elseif tAffs.flushings then
    table.insert(logographtrace,"bear")
  elseif tAffs.clumsiness and not tAffs.haemophilia then
    table.insert(logographtrace,"bear")
  elseif not tAffs.impatience then
    table.insert(logographtrace,"scales")
  elseif not tAffs.clumsiness then
    table.insert(logographtrace,"scales")
  end
elseif pariah.lastLogograph == "scales" then
   table.insert(logographtrace,"skein")
--SKEIN
elseif pariah.lastLogograph == "skein" then
  if tAffs.impatience or tAffs.sandfever and not tAffs.epilepsy then
    table.insert(logographtrace,"sun")
  elseif tAffs.flushings and not tAffs.addiction then
    table.insert(logographtrace,"scarab")
  elseif tAffs.addiction then
    table.insert(logographtrace,"sun")
  elseif not tAffs.epilepsy then
    table.insert(logographtrace,"sun")
  else
    table.insert(logographtrace,"scarab")
  end
--SERPENT
elseif pariah.lastLogograph == "serpent" then
  if tAffs.weariness and not tAffs.impatience then
    table.insert(logographtrace,"skein")
  else
   table.insert(logographtrace,"nest")
  end
--BEAR
elseif pariah.lastLogograph == "bear" then
  if not tAffs.asthma then
   table.insert(logographtrace,"jackal")
  elseif tAffs.flushings and not tAffs.addiction then
    table.insert(logographtrace,"scarab")
  else
   table.insert(logographtrace,"jackal")
  end
elseif pariah.lastLogograph == "sun" or pariah.lastLogograph == "scorpion" or pariah.lastLogograph == "jackel" then
   table.insert(logographtrace,"serpent")
else 
  table.insert(logographtrace,"serpent")
end 

myheartbeats = {}

if e == 0 then
  table.insert(myheartbeats, "5")
elseif e == 1 then
  table.insert(myheartbeats, "3")
elseif e == 2 then
  table.insert(myheartbeats, "1")
elseif e &gt;= 3 then
   table.insert(myheartbeats, "0")
end

myswarmsting = {}
if not tAffs.pyramides and not tAffs.burrow then
  table.insert(myswarmsting, "pyramides")
elseif not tAffs.sandfever and not tAffs.impatience then
  table.insert(myswarmsting, "sandfever")
elseif not tAffs.rebbies then
  table.insert(myswarmsting, "rebbies")
elseif not tAffs.flushings then
  table.insert(myswarmsting, "flushings")
elseif not tAffs.mycalium then
  table.insert(myswarmsting, "mycalium")
else
  table.insert(myswarmsting, "mycalium")
end

--Nest/Scales/Skein/Sun + Burrow/Serpent + Burrow/ Nest/ Scales/ Standfever Sting + Skien/ Rebbies + Sun/Sandfever + Paralysis/ Nest/ Flushings Sting + Bear/ Flushing Burrow + Jackal / Flushings Burrow + Serpent / Rebbies + Nest/ Pyramides + Bear / Flushing + Scarab / Latency + Scorpion / Serpent + Accelerate / Nest + Accelerate


--ATTACK
  if haveAff("shield") then
    if tAffs.voyria and taccelerates &lt; 2 then
      atk = atk..";trace fissure " ..target.. ";blood accelerate " ..target
    elseif e &gt;= 2 and pariah.expose then
      atk = atk.."swarm sting " ..myswarmsting[1].. " " ..target.. ";trace fissure " ..target
    elseif e &lt;= 1 then
      atk = atk..";trace fissure " ..target
    end
  elseif not pariah.bladePrepared then
    atk = atk.."crux ensorcell " ..target
  elseif taccelerates &gt;= 2 then
    atk = atk..";trace " ..logographtrace[1].. " " ..target
  elseif tAffs.voyria then
    atk = atk..";trace " ..logographtrace[1].. " " ..target.. ";blood accelerate " ..target
  elseif pariah.latency and not tAffs.voyria and pariah.lastLogograph == "scorpion" then
    atk = atk.."trace serpent " ..target.. ";crux transpose voyria;blood accelerate " ..target
  elseif haveAff("burrow") and tlatency == true and pariah.expose and e &gt;= 4 then
    atk = atk.."swarm latency pyramides;trace scorpion " ..target
  
  elseif e &gt;= 3 and pariah.expose then
        if not haveAff("burrow") then
          atk = atk.."swarm burrow pyramides " ..target.. ";trace " ..logographtrace[1].. " " ..target
        elseif haveAff("burrow") and not pariah.infest then
          atk = atk.."swarm infest pyramides " ..target.. ";trace " ..logographtrace[1].. " " ..target
        else
          atk = atk.."swarm sting " ..myswarmsting[1].. " " ..target.. ";trace " ..logographtrace[1].. " " ..target
        end
  elseif e &lt;= 2 then
    if myheartbeats[1] ~= "0" then
      atk = atk..";trace " ..logographtrace[1].. " " ..target.. " " ..myheartbeats[1].. " heartbeats"
    else
      atk = atk.."swarm sting " ..myswarmsting[1].. " " ..target.. ";trace " ..logographtrace[1].. " " ..target
    end
  end  
  
  
 

send("queue addclearfull freestand wield left knife;unwield right;" ..atk)


--End Function  
end


function levipariahscourgetest()
local atk = combatQueue()
local sp = ataxia.settings.separator
local e = ataxia.vitals.epitaph
local plagues = {"mycalium", "rebbies", "sandfever", "flushings", "pyramides" }
local tp = false
taccelerates = taccelerates or 0
--Get Targets Anti Active Cure
getLockingAffliction()

--Get Target Lock Status
checkTargetLocks()

--Define Kelp Stack
if checkAffList({"paralysis", "asthma", "epilepsy",  "clumsiness", "impatience", "addiction", "relapsing","haemophilia"},3) then
  tAffs.logostack = true
else
  tAffs.logostack = false
end
--Define Plague Stack
if checkAffList({"mycalium", "rebbies", "sandfever", "flushings", "pyramides" },2) then
  plaguestackone = true
else
  plaguestackone = false
end

--Define Plague Stack
if checkAffList({"mycalium", "rebbies", "sandfever", "flushings", "pyramides" },3) then
  tlatency = true
else
  tlatency = false
end


--Nest/Scales/Skein/Sun + Burrow/Serpent + Burrow/ Nest/ Scales/ Standfever Sting + Skein/ Rebbies + Sun/Sandfever + Serpent/ Nest/ Flushings Sting + Bear/ Flushing Burrow + Jackal / Flushings Burrow + Serpent / Rebbies + Nest/ Pyramides + Bear / Flushing + Scarab / Latency + Scorpion / Serpent + Accelerate / Nest + Accelerate

logographtrace = {}
if tAffs.shield then
  table.insert(logographtrace,"fissure")
elseif not pariah.lastLogograph then
  table.insert(logographtrace,"bear")
-- NEST
elseif pariah.lastLogograph == "nest" then
  if tAffs.impatience or tAffs.sandfever then
    table.insert(logographtrace,"bear")
  elseif tAffs.flushings then
    table.insert(logographtrace,"bear")
  elseif tAffs.clumsiness and not tAffs.haemophilia then
    table.insert(logographtrace,"bear")
  elseif not tAffs.haemophilia then
    table.insert(logographtrace,"bear")
  elseif tAffs.haemophilia then
    table.insert(logographtrace,"bear")
  elseif not tAffs.impatience then
    table.insert(logographtrace,"scales")
  elseif not tAffs.clumsiness then
    table.insert(logographtrace,"scales")
  end
elseif pariah.lastLogograph == "scales" then
   table.insert(logographtrace,"skein")
--SKEIN
elseif pariah.lastLogograph == "skein" then
  if tAffs.impatience or tAffs.sandfever and not tAffs.epilepsy then
    table.insert(logographtrace,"sun")
  elseif tAffs.flushings and not tAffs.addiction then
    table.insert(logographtrace,"scarab")
  elseif tAffs.addiction then
    table.insert(logographtrace,"sun")
  elseif not tAffs.epilepsy then
    table.insert(logographtrace,"sun")
  else
    table.insert(logographtrace,"scarab")
  end
--SERPENT
elseif pariah.lastLogograph == "serpent" then
  if tAffs.weariness and not tAffs.impatience then
    table.insert(logographtrace,"skein")
  else
   table.insert(logographtrace,"nest")
  end
--BEAR
elseif pariah.lastLogograph == "bear" then
  if tAffs.flushings and not tAffs.addiction then
    table.insert(logographtrace,"scarab")
  elseif not tAffs.asthma then
   table.insert(logographtrace,"jackal")
  else
   table.insert(logographtrace,"scarab")
  end
elseif pariah.lastLogograph == "sun" or pariah.lastLogograph == "scorpion" or pariah.lastLogograph == "jackel" then
   table.insert(logographtrace,"serpent")
else 
   table.insert(logographtrace,"serpent")
end 

myheartbeats = {}

if e == 0 then
  table.insert(myheartbeats, "5")
elseif e == 1 then
  table.insert(myheartbeats, "3")
elseif e == 2 then
  table.insert(myheartbeats, "1")
elseif e &gt;= 3 then
   table.insert(myheartbeats, "0")
end

myswarmsting = {}
if not tAffs.pyramides and not tAffs.burrow then
  table.insert(myswarmsting, "pyramides")
elseif not tAffs.flushings then
  table.insert(myswarmsting, "flushings")
elseif not tAffs.mycalium then
  table.insert(myswarmsting, "mycalium")
elseif not tAffs.rebbies then
  table.insert(myswarmsting, "rebbies")
elseif not tAffs.sandfever and not tAffs.impatience then
  table.insert(myswarmsting, "sandfever")

else
  table.insert(myswarmsting, "pyramides")
end

--Nest/Scales/Skein/Sun + Burrow/Serpent + Burrow/ Nest/ Scales/ Standfever Sting + Skien/ Rebbies + Sun/Sandfever + Paralysis/ Nest/ Flushings Sting + Bear/ Flushing Burrow + Jackal / Flushings Burrow + Serpent / Rebbies + Nest/ Pyramides + Bear / Flushing + Scarab / Latency + Scorpion / Serpent + Accelerate / Nest + Accelerate


--ATTACK
  if haveAff("shield") then
    if tAffs.voyria and taccelerates &lt; 2 then
      atk = atk..";trace fissure " ..target.. ";blood accelerate " ..target
    elseif e &gt;= 2 and pariah.expose then
      atk = atk.."swarm sting " ..myswarmsting[1].. " " ..target.. ";trace fissure " ..target
    elseif e &lt;= 1 then
      atk = atk..";trace fissure " ..target
    end
  elseif not pariah.bladePrepared then
    atk = atk.."crux ensorcell " ..target
  elseif taccelerates &gt;= 2 then
    atk = atk..";trace " ..logographtrace[1].. " " ..target
  elseif tAffs.voyria then
    atk = atk..";trace " ..logographtrace[1].. " " ..target.. ";blood accelerate " ..target
  elseif pariah.latency and not tAffs.voyria and pariah.lastLogograph == "scorpion" then
    atk = atk.."trace serpent " ..target.. ";crux transpose voyria;blood accelerate " ..target
  elseif tAffs.bleed &gt;= 200 and tAffs.scytherus and tAffs.haemophilia and tAffs.pyramides and haveAff("burrow") then
    atk = atk.."swarm scourge pyramides " ..target.. ";trace " ..logographtrace[1].. " " ..target
  --elseif haveAff("burrow") and tlatency == true and pariah.expose and e &gt;= 4 then
   -- atk = atk.."swarm latency pyramides;trace scorpion " ..target  
  elseif e &gt;= 3 and pariah.expose then
        if not haveAff("burrow") then
          atk = atk.."swarm burrow pyramides " ..target.. ";trace " ..logographtrace[1].. " " ..target
        elseif haveAff("burrow") and tAffs.bleed &gt;= 200 then
          atk = atk.."swarm sting " ..myswarmsting[1].. " " ..target.. ";trace scorpion " ..target
        elseif haveAff("burrow") and not pariah.infest then
          atk = atk.."swarm infest pyramides " ..target.. ";trace " ..logographtrace[1].. " " ..target
        else
          atk = atk.."swarm sting " ..myswarmsting[1].. " " ..target.. ";trace " ..logographtrace[1].. " " ..target
        end
  elseif e &lt;= 2 then
    if myheartbeats[1] ~= "0" then
      atk = atk..";trace " ..logographtrace[1].. " " ..target.. " " ..myheartbeats[1].. " heartbeats"
    else
      atk = atk.."swarm sting " ..myswarmsting[1].. " " ..target.. ";trace " ..logographtrace[1].. " " ..target
    end
  end  
  
  
 

send("queue addclearfull freestand wield left knife;unwield right;" ..atk)


--End Function  
end
</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
							</ScriptGroup>
							<ScriptGroup isActive="yes" isFolder="yes">
								<name>ZulahGUI - Saonji Edit</name>
								<packageName>ZulahGUI - Saonji Edit</packageName>
								<script></script>
								<eventHandlerList />
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>zGUI Redux</name>
									<packageName></packageName>
									<script>-------------------------------------------------
-- Zulah GUI build 
-- 21/04/2021
-- 4.0 - Forked by Saonji/Pyori.
-- Full credit to Zulah, with his permission to use it.
-- Note: saving if UserWindow won't bring back as UserWindow if reloading
-- by Edru 7th October 2020
-------------------------------------------------
zgui = zgui or {}
zgui.modules = zgui.modules or {}
zCore = zCore or {}
zgui.styles = {  
    ["greygroove"] = "background-color:rgba(0,0,0,0%); border: 5px groove grey;",
    ["greengroove"] = "background-color:rgba(0,0,0,100%); border: 5px groove green;",
    
    ["dimgreyinset"] = "background-color:rgba(20,20,20,100%); border: 5px inset dimgray;",
    ["greyinset"] = "background-color:rgba(0,0,0,100%); border: 10px inset grey;",
    ["greeninset"] = "background-color:rgba(0,0,0,100%); border: 5px inset green;",
    ["chaosinset"] = "background-color:rgba(0,40,100,100%); border: 5px inset purple;",
    ["chaosincet"] = "background-color:rgba(0,40,100,100%); border: 5px inset yellow;",
    
    ["greydouble"] = "background-color:rgba(0,0,0,0%); border: 5px double grey;",
    ["greendouble"] = "background-color:rgba(0,0,0,50%); border: 5px double green;",    
    ["golddouble"] = "background-color:rgba(0,0,0,50%); border: 5px double gold;",
    
    ["darkmode"] = "background-color:rgba(5,5,5,100%); border: 2px groove rgba(10,10,10,100%);",
}

-- Changes
-- Room Windows use the same format that Ataxia's GUI does.
-- Aff window uses the same as the prompt tag.
-- Titles are removed by default; you can enable them by removing the -- in their scripts.
-- Added a number of new modules over the default zgui, as well as removed a few.</script>
									<eventHandlerList />
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Extra Code</name>
										<packageName>convertToUserWindow</packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>convertAdj.Init</name>
											<packageName></packageName>
											<script>-- convert Adjustable.Containers to UserWindows and back
-- v0.1
-- Note: saving if UserWindow won't bring back as UserWindow if reloading
-- by Edru 7th October 2020

convertAdj = convertAdj or {}
function Adjustable.Container:onDoubleClick()
  self.isUserWindow = self.isUserWindow or false
  if not self.isUserWindow then
    self.userwindow = self.userwindow or Geyser.UserWindow:new({name = self.name.."userWindow"})
    self.userwindow:show()
    self.userwindow:setTitle(self.name)
    self.userwindow:move(self:get_x(), self:get_y())
    self.userwindow:resize(self:get_width(), self:get_height())
    self:changeContainer(self.userwindow)
    self:move(0,0)
    self:resize("100%", "100%")
    self:lockContainer("standard")
  else
    registerAnonymousEventHandler("sysWindowMousePressEvent", "convertAdj.sendToPosition", true)
    convertAdj.container = self
    self.userwindow:hide_impl()
  end
  self.isUserWindow = self.isUserWindow == false and true or false 
end

function convertAdj.Init()
  Adjustable.Container:doAll(function(self) self.adjLabel:setDoubleClickCallback(function(event) self:onDoubleClick() end)end)
  local newWrapper = Adjustable.Container.new
  local saveWrapper = Adjustable.Container.save
  
  function Adjustable.Container:new(cons, container)
    local me = newWrapper(self, cons, container)
    me.adjLabel:setDoubleClickCallback(function(event) me:onDoubleClick() end)
    return me
  end
  
  function Adjustable.Container:save(slot, dir)
    if self.isUserWindow then
      local tempWindowName = self.windowname
      self.windowname = "main"
      self:setAbsolute(true, true)
      self:unlockContainer()
      saveWrapper(self, slot, dir)
      self:lockContainer()
      self.windowname = tempWindowName
      self:setPercent(true, true)
    else
      saveWrapper(self, slot, dir)
    end
    return true
  end
  
end

function convertAdj.sendToPosition(event, button, x, y, windowname)
    local self = convertAdj.container
    local newContainer = Geyser
    if windowname ~= "main" then
        newContainer = Geyser.windowList[windowname.."Container"].windowList[windowname]
    end
    self:resize(self:get_width(), self:get_height())
    self:move(x, y)
    self:changeContainer(Geyser)
    self:setPercent(true, true)
    self:unlockContainer()
    self:show()
    convertAdj.container = nil
end</script>
											<eventHandlerList>
												<string>sysLoadEvent</string>
												<string>sysInstall</string>
											</eventHandlerList>
										</Script>
									</ScriptGroup>
									<Script isActive="yes" isFolder="no">
										<name>EDIT ME: Startup Main</name>
										<packageName></packageName>
										<script>-------------------------------------------------
-- Zulah GUI build 
-- 11/4/20
-- v3.2.2
-- convert Adjustable.Containers to UserWindows and back
-- v0.1
-- Note: saving if UserWindow won't bring back as UserWindow if reloading
-- by Edru 7th October 2020
-------------------------------------------------

function zgui.zStartup() 
 if not zgui.running then
  zgui.running = true
--------------------------------------------------------------------
-- Change the Font Size of each window on startup to fit your screen size better if needed
  zgui.chatSize = 9
  zgui.loggerSize = 8
  zgui.promptSize = 8
  zgui.goldSize = 8
  zgui.defenceSize = 8
  zgui.afflictionSize = 8
  zgui.targetAffsSize = 9
  zgui.targetListSize = 8
  zgui.enemySize = 8
  zgui.allySize = 8
  zgui.roomDenizensSize = 7
  zgui.roomItemsSize = 7
  zgui.roomPlayersSize = 10
  zgui.mapSize = 8
  zgui.bashWindowSize = 7
  zgui.statsWindowSize = 8
  zgui.roomInfoSize = 8
--------------------------------------------------------------------
  setBorderColor("0","0","0")  -- Change this if you attach windows to side borders and want to color the background of those borders
                               -- setBorderColor("218","218","218") -- Mudlet Default Menu Grey
                               -- setBorderColor("RED","GREEN","BLUE")
--------------------------------------------------------------------       
-- Which Style To Start With?  
  if not zgui.useStyle then zgui.useStyle = "darkmode" end                        
  for k,v in pairs(zgui.styles) do
    if zgui.useStyle == k then
      zgui.adjLabelstyle = v
    end
  end   
----------------------------------------------------------------------------------------------------------------------------------------

    sendGMCP([[Core.Supports.Add ["Comm.Channel 1"] ]])
    sendGMCP('Core.Supports.Add ["IRE.Tasks 1"]')
    sendGMCP('Core.Supports.Add ["IRE.Time 1"]')
    sendGMCP('Core.Supports.Add ["IRE.Misc 1"]')
    sendGMCP('Core.Supports.Add ["IRE.Display 1"]')
    sendGMCP('Core.Supports.Add ["IRE.Sound 1"]')
    
    --If you want to enable one of these modules, simply remove the -- at the start.
    --Use zgui afterwards to redraw the gui, this does not require restarting.
    --A few modules have been removed entirely from Zulah's release, as I found these unnecessary.
    
    if not table.contains(zgui.modules, "buildChat") then table.insert(zgui.modules, "buildChat") end
    if not table.contains(zgui.modules, "buildMap") then  table.insert(zgui.modules, "buildMap") end  
    --if not table.contains(zgui.modules, "buildExp") then table.insert(zgui.modules, "buildExp") end
    --if not table.contains(zgui.modules, "buildLog") then table.insert(zgui.modules, "buildLog") end
    --if not table.contains(zgui.modules, "buildPrompt") then table.insert(zgui.modules, "buildPrompt") end
    --if not table.contains(zgui.modules, "buildAlly") then table.insert(zgui.modules, "buildAlly") end
    --if not table.contains(zgui.modules, "buildEnemy") then table.insert(zgui.modules, "buildEnemy") end
    --if not table.contains(zgui.modules, "buildBashWindow") then table.insert(zgui.modules, "buildBashWindow") end
    --if not table.contains(zgui.modules, "buildAffs") then table.insert(zgui.modules, "buildAffs") end
    --if not table.contains(zgui.modules, "buildAffLock") then table.insert(zgui.modules, "buildAffLock") end
    if not table.contains(zgui.modules, "buildTarAffs") then table.insert(zgui.modules, "buildTarAffs") end
    if not table.contains(zgui.modules, "buildRoomPlayers") then table.insert(zgui.modules, "buildRoomPlayers") end
    if not table.contains(zgui.modules, "buildRoomDenizens") then table.insert(zgui.modules, "buildRoomDenizens") end
    --if not table.contains(zgui.modules, "buildStatsWindow") then table.insert(zgui.modules, "buildStatsWindow") end
    --if not table.contains(zgui.modules, "buildRoomInfo") then table.insert(zgui.modules, "buildRoomInfo") end
    
    for i=1, #zgui.modules, 1 do
      zgui[zgui.modules[i]]()
    end
    ------------------------------------------------------------------------
    zgui.debug = false
    zgui.trueTime = 0

	  zgui.vitals = {
 		  h = 5000,
 		  m = 5000,
 		  maxh = 5000,
 	 	  maxm = 5000,
  		oh = 5000, --old health
  		om = 5000, --old mana
 	  	xp = 0,
   		oxp = 0, --old xp
	  }
    zgui.myTargetList = zgui.myTargetList or {} 
	  zgui.allies = zgui.allies or {}
	  zgui.enemies = zgui.enemies or {}
  
    send("ql")    
    send("allies")
    send("enemies")
    ------------------------------------------------------------------------
    setAppStyleSheet([[
		  QScrollBar:vertical {background: #000;}
		  QScrollBar::handle:vertical {background-color: #07f; min-height: 50px;}
		  QScrollBar::add-line:vertical, QScrollBar::sub-line:vertical {background: none; height: 0px;}
		  QScrollBar::add-page:vertical, QScrollBar::sub-page:vertical {background: none;}
		  QMenuBar {background-color: #000; color: #07f;}
		  QMenuBar::item:selected {background-color: #000; color: #0ff}
	 ]])
 end
end

registerAnonymousEventHandler("gmcp.Char", "zgui.zStartup")</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>EDIT ME: zGUI Defences</name>
										<packageName></packageName>
										<script>function zgui.setupDefences()
-------------------------------------------------------------
	zgui.defs = zgui.defs or {}
	zgui.defs.classless = {
		["basic"] = {
			"insomnia",
			"cloak",
			"mindseye",	
			"selfishness"},
		["combat"] = {
			"selfishness",
			"insomnia",
			"blindness",
			"cloak",
			"mindseye",				
			"thirdeye",
			"deafness",
			"deathsight",
			"alertness",
			"kola",
			"skywatch",
			"groundwatch",
			"levitating",
			"temperance",
			"insulation",
			"poisonresist",
			"speed",
			"nightsight"},
	}
-------------------------------------------------------------
	zgui.defs.class = {
		["none"] = {},
    ["Alchemist"] = {},
    ["Apostate"] = {},
		["Bard"] = {
			"tune",
			"lay"},        
		["Blademaster"] = {
			"shinbinding",
			"shintrance",
			"shinclarity",
			"mindnet",
			"twoartsstance",
			"weathering",
			"toughness"},
    ["Depthswalker"] = {},
    ["Druid"] = {},
    ["Infernal"] = {},
    ["Jester"] = {},
		["Magi"] = {
			"stoneskin",
			"stonefist",
			"chargeshield",
			"diamondskin"},                	
		["Monk"] = {                   
			"kaitrance",
			"vitality",
			"mindnet",
			"splitmind",
			"weathering",
			"toughness",
			"regeneration",
			"boostedregeneration",
			"vitality",
			"resistance",
			"constitution"},              
    ["Occultist"] = {},
    ["Paladin"] = {},
    ["Priest"] = {},
    ["Psion"] = {},
    ["Runewarden"] = {},
    ["Sentinel"] = {},         
		["Serpent"] = {
			"hiding",
			"shroud",
			"scales",
			"pacing",
			"lipreading",
			"ghost",
			"secondsight"},
    ["Shaman"] = {},
    ["Sylvan"] = {},         
	}
	
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>EDIT ME: Restyle GUI Colors</name>
										<packageName></packageName>
										<script>function zgui.restyle()
  zgui.styles = {  
     -- https://doc.qt.io/qt-5/stylesheet-reference.html (more info)                      
                                     --rgba(RED, GREEN, BLUE, Transparency)
    ["greygroove"] = "background-color:rgba(0,0,0,0%); border: 5px groove grey;",
    ["greengroove"] = "background-color:rgba(0,0,0,100%); border: 5px groove green;",
    
    ["dimgreyinset"] = "background-color:rgba(20,20,20,100%); border: 5px inset dimgray;",
    ["greyinset"] = "background-color:rgba(0,0,0,100%); border: 10px inset grey;",
    ["greeninset"] = "background-color:rgba(0,0,0,100%); border: 5px inset green;",
    ["chaosinset"] = "background-color:rgba(0,40,100,100%); border: 5px inset purple;",
    ["chaosincet"] = "background-color:rgba(0,40,100,100%); border: 5px inset yellow;",
    
    ["greydouble"] = "background-color:rgba(0,0,0,0%); border: 5px double grey;",
    ["greendouble"] = "background-color:rgba(0,0,0,50%); border: 5px double green;",    
    ["golddouble"] = "background-color:rgba(0,0,0,50%); border: 5px double gold;",
    
    ["darkmode"] = "background-color:rgba(5,5,5,100%); border: 2px groove rgba(10,10,10,100%);",
}

--------------------------------------------------------------------
-- Which Style To Start With?  
  if not zgui.useStyle then 
  
  zgui.useStyle = "darkmode" end
  
----------------------------------------------------------------------------------------------------------------------------------------
  setBorderColor("0","0","0")  -- Change this if you attach windows to side borders and want to color the background of those borders
                               -- setBorderColor("218","218","218") -- Mudlet Default Menu Grey
                               -- setBorderColor("RED","GREEN","BLUE")
                               
                               
----------------------------------------------------------------------------------------------------------------------------------------                               
  for k,v in pairs(zgui.styles) do
    if zgui.useStyle == k then
      zgui.adjLabelstyle = v
    end
  end   
  
  for i=1, #zgui.modules, 1 do
    zgui[zgui.modules[i]]()
  end  
----------------------------------------------------------------------------------------------------------------------------------------
end</script>
										<eventHandlerList />
									</Script>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Logger</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>buildLog</name>
											<packageName></packageName>
											<script>function zgui.buildLog()
  zgui.loggerSize = zgui.loggerSize or 9
  zgui.logger = {}

  --Create the main Adjustable
  zgui.logger.window = Adjustable.Container:new({
    name = "zgui.logger.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.logger.window:changeMenuStyle("dark")

  --Create the log container
  zgui.logger.container = Geyser.Container:new({
    name = "zgui.logger.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.logger.window)  

  --Create the Logger Console
  zgui.logger.console = Geyser.MiniConsole:new({
    name = "logDisplay",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.logger.container)

  setFontSize("logDisplay", zgui.loggerSize)
  --zgui.logger.window:setTitle("Log","gray")
  zgui.logger.window:show()  
  
  if not table.contains(zgui.modules, "buildLog") then
    table.insert(zgui.modules, "buildLog")
  end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>zgui.stats()</name>
											<packageName></packageName>
											<script>function zgui.stats()
  if gmcp.Char then
  zgui.vitals.h = tonumber(gmcp.Char.Vitals.hp)
  zgui.vitals.m = tonumber(gmcp.Char.Vitals.mp)
  zgui.vitals.e = tonumber(gmcp.Char.Vitals.ep)
  zgui.vitals.w = tonumber(gmcp.Char.Vitals.wp)

  zgui.vitals.maxh = tonumber(gmcp.Char.Vitals.maxhp)
  zgui.vitals.maxm = tonumber(gmcp.Char.Vitals.maxmp)
  zgui.vitals.maxe = tonumber(gmcp.Char.Vitals.maxep)
  zgui.vitals.maxw = tonumber(gmcp.Char.Vitals.maxwp)
	
	----------------------------------------------------------
	zgui.statChange() -- If you want to see health and Mana changes in Log window

  zgui.vitals.oh = zgui.vitals.h
  zgui.vitals.om = zgui.vitals.m	
  end
end

registerAnonymousEventHandler("gmcp.Char.Vitals", "zgui.stats")</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>zgui.sendLogger</name>
											<packageName></packageName>
											<script>function zgui.sendLogger(colorCode, logMessage)
  zgui.trueTime = string.cut(getTime(true, "hh:mm:ss:zzz"), 11)
	cecho("logDisplay", "&lt;gold&gt;"..zgui.trueTime)
	cecho("logDisplay", "&lt;"..colorCode.."&gt;-- "..logMessage.."\n")
	deleteLine()
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>zgui.statChange()</name>
											<packageName></packageName>
											<script>function zgui.statChange()
  zgui.trueTime = string.cut(getTime(true, "hh:mm:ss:zzz"), 11)
	local changeAmount = 0
	local sendThisString = ""
  zgui.tempOh = zgui.tempOh or 0
  if zgui.vitals.oh then
    if zgui.vitals.oh &gt; 0 then
      zgui.tempOh = zgui.vitals.oh
    end
  end
  if not zgui.vitals.h then
--BLACKOUT Most likely, don't even try.
  else
  if not zgui.vitals.oh then
    zgui.vitals.oh = 0
  end
	if (zgui.vitals.oh + 100) &lt; zgui.vitals.h then
		changeAmount = zgui.vitals.h - zgui.vitals.oh
		sendThisString = changeAmount.." Health Gain"
		cecho("logDisplay", "&lt;green&gt;"..zgui.trueTime)
		cecho("logDisplay", "&lt;green&gt;   "..sendThisString.."\n")
	elseif zgui.vitals.oh &gt; (zgui.vitals.h + 100) then
		changeAmount = zgui.vitals.oh - zgui.vitals.h
		sendThisString = changeAmount.." Health Loss"
		cecho("logDisplay", "&lt;red&gt;"..zgui.trueTime)
		cecho("logDisplay", "&lt;red&gt;   "..sendThisString.."\n")
	end
  if not zgui.vitals.om then
    zgui.vitals.om = 0
  end
	if (zgui.vitals.om + 100) &lt; zgui.vitals.m then
		changeAmount = zgui.vitals.m - zgui.vitals.om
		sendThisString = changeAmount.." Mana Gain"
		cecho("logDisplay", "&lt;blue&gt;"..zgui.trueTime)
		cecho("logDisplay", "&lt;blue&gt;   "..sendThisString.."\n")
	elseif zgui.vitals.om &gt; (zgui.vitals.m + 100) then
		changeAmount = zgui.vitals.om - zgui.vitals.m
		sendThisString = changeAmount.." Mana Loss"
		cecho("logDisplay", "&lt;red&gt;"..zgui.trueTime)
		cecho("logDisplay", "&lt;red&gt;   "..sendThisString.."\n")
	end
	end
  
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Build Windows</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>buildBashWindow</name>
											<packageName></packageName>
											<script>function zgui.buildBashWindow()
  zgui.bashWindowSize = zgui.bashWindowSize or 7
  zgui.bwindow = {}

  --Create the enemy Adjustable
  zgui.bwindow.window = Adjustable.Container:new({
    name = "zgui.bwindow.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.bwindow.window:changeMenuStyle("dark")

  --Create the enemy container
  zgui.bwindow.container = Geyser.Container:new({
    name = "zgui.bwindow.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.bwindow.window)  

  --Create the enemy Console
  zgui.bwindow.console = Geyser.MiniConsole:new({
    name = "bashDisplay",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.bwindow.container) 

  setFontSize("bashDisplay", zgui.bashWindowSize)
  --zgui.bwindow.window:setTitle("Basher Window","gray")
  zgui.bwindow.window:show()
  
  if not table.contains(zgui.modules, "buildBashWindow") then
    table.insert(zgui.modules, "buildBashWindow")
  end  
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildCape</name>
											<packageName></packageName>
											<script>function zgui.buildCape()
  zgui.cape = {}
  zgui.cape.count = 0
  --Create the cape Adjustable
  zgui.cape.window = Adjustable.Container:new({
    name = "zgui.cape.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = "background-color:rgba(50,50,50,0%);",
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 5,
    buttonsize = 10,          
  },main)
  zgui.cape.window:changeMenuStyle("dark")

  --Create the cape container
  zgui.cape.container = Geyser.Container:new({
    name = "zgui.cape.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.cape.window)  

  --Create the cape Gauge
  zgui.cape.capebar = Geyser.Gauge:new({
    name="capeDisplay",
    x="2%", y="2%",
    width="96%", height="96%",
  },zgui.cape.container) 
  zgui.cape.capebar:setValue(math.random(1,100),100)

	zgui.cape.capebar.front:setStyleSheet([[
		background-color: QLinearGradient( x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #621616, stop: 0.1 #640a0a, stop: 0.49 #8a0000, stop: 0.5 #560000, stop: 1 #260000);
		border-top: 1px DimGrey solid;
		border-left: 1px DimGrey solid;
		border-bottom: 1px DimGrey solid;
		border-radius: 7;
		padding: 3px;
	]])
	
	zgui.cape.capebar.back:setStyleSheet([[
		background-color: QLinearGradient( x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #555555, stop: 0.1 #555555, stop: 0.49 #333333, stop: 0.5 #333333, stop: 1 #555555);
		border-width: 1px;
		border-color: DimGrey;
		border-style: solid;
		border-radius: 7;
		padding: 3px;
	]])
  
  setFontSize("capeDisplay", 9)
  --zgui.cape.window:setTitle("Deathcape","gray")
  zgui.cape.window:show()
  zgui.clearCape()
  
  if not table.contains(zgui.modules, "buildCape") then
    table.insert(zgui.modules, "buildCape")
  end 
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildTarAffs</name>
											<packageName></packageName>
											<script>function zgui.buildTarAffs()
  zgui.targetAffsSize = zgui.targetAffsSize or 9
  zgui.targetaffliction = {}

  --Create the affliction Adjustable
  zgui.targetaffliction.window = Adjustable.Container:new({
    name = "zgui.targetaffliction.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.targetaffliction.window:changeMenuStyle("dark")

  --Create the targetaffliction container
  zgui.targetaffliction.container = Geyser.Container:new({
    name = "zgui.targetaffliction.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.targetaffliction.window)  

  --Create the targetaffliction Console
  zgui.targetaffliction.console = Geyser.MiniConsole:new({
    name = "targetafflictionDisplay",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.targetaffliction.container) 

  setFontSize("targetafflictionDisplay", zgui.targetAffsSize)
  --zgui.targetaffliction.window:setTitle("Target Affs","gray")
  zgui.targetaffliction.window:show()
  
  if not table.contains(zgui.modules, "buildTarAffs") then
    table.insert(zgui.modules, "buildTarAffs")
  end  
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildRoomPlayers</name>
											<packageName></packageName>
											<script>function zgui.buildRoomPlayers()
  zgui.roomPlayersSize = zgui.roomPlayersSize or 9
  zgui.roomPlayers = {}

  --Create the roomPlayers Adjustable
  zgui.roomPlayers.window = Adjustable.Container:new({
    name = "zgui.roomPlayers.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 9,
    buttonsize = 14,          
  },main)
  zgui.roomPlayers.window:changeMenuStyle("dark")

  --Create the roomPlayers container
  zgui.roomPlayers.container = Geyser.Container:new({
    name = "zgui.roomPlayers.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.roomPlayers.window)  

  --Create the roomPlayers Console
  zgui.roomPlayers.console = Geyser.MiniConsole:new({
    name = "roomPlayersDisplay",
    x = 0, y = 0,
    autoWrap = true,
    width = "80%",
    height = "100%",
    color="black",
  },zgui.roomPlayers.container) 

  setFontSize("roomPlayersDisplay", zgui.roomPlayersSize)
  --zgui.roomPlayers.window:setTitle("Players","gray")
  zgui.roomPlayers.window:show()
  
  if not table.contains(zgui.modules, "buildRoomPlayers") then
    table.insert(zgui.modules, "buildRoomPlayers")
  end  
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildRoomDenizens</name>
											<packageName></packageName>
											<script>function zgui.buildRoomDenizens()
  zgui.roomDenizensSize = zgui.roomDenizensSize or 6
  zgui.roomDenizens = {}

  --Create the roomDenizens Adjustable
  zgui.roomDenizens.window = Adjustable.Container:new({
    name = "zgui.roomDenizens.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.roomDenizens.window:changeMenuStyle("dark")

  --Create the roomDenizens container
  zgui.roomDenizens.container = Geyser.Container:new({
    name = "zgui.roomDenizens.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.roomDenizens.window)  

  --Create the roomDenizens Console
  zgui.roomDenizens.console = Geyser.MiniConsole:new({
    name = "roomDenizensDisplay",
    x = 0, y = 0,
    autoWrap = false,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.roomDenizens.container) 

  setFontSize("roomDenizensDisplay", zgui.roomDenizensSize)
  --zgui.roomDenizens.window:setTitle("Denizens","gray")
  zgui.roomDenizens.window:show()
  
  if not table.contains(zgui.modules, "buildRoomDenizens") then
    table.insert(zgui.modules, "buildRoomDenizens")
  end  
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildAffLock</name>
											<packageName></packageName>
											<script>function zgui.buildAffLock()
  zgui.afflictionlock = {}

  --Create the afflictionlock Adjustable
  zgui.afflictionlock.window = Adjustable.Container:new({
    name = "zgui.afflictionlock.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.afflictionlock.window:changeMenuStyle("dark")

  --Create the afflictionlock container
  zgui.afflictionlock.container = Geyser.Container:new({
    name = "zgui.afflictionlock.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.afflictionlock.window)  

  --zgui.afflictionlock.window:setTitle("Lock Out","gray")
  zgui.afflictionlock.window:show()

	zgui.afflictionlock.bg = Geyser.Label:new({
		name = "afflictionlockBG",
		color = "black",
		x = 0,	y = 0,
		width = 0,	height = 0
	}, zgui.afflictionlock.container)
  setBackgroundColor("afflictionlockBG", 0, 0, 0, 255)

---------------------------------------------------------------------------

	zgui.afflictionlock.pronLabel = Geyser.Label:new({
		name = "pronAff",
		x = "1%", y = "2%",
		width = "98%", height = "18%",
	}, zgui.afflictionlock.container)
	setBackgroundColor("pronAff", 80, 0, 0, 255)
	zgui.afflictionlock.pronLabel:echo("&lt;center&gt;Prone")	

	zgui.afflictionlock.paraLabel = Geyser.Label:new({
		name = "paraAff",
		x = "1%", y = "22%",
		width = "18%", height = "70%",
	}, zgui.afflictionlock.container)
	setBackgroundColor("paraAff", 80, 0, 0, 255)
	zgui.afflictionlock.paraLabel:echo("&lt;center&gt;Para")

	zgui.afflictionlock.impaLabel = Geyser.Label:new({
		name = "impaAff",
		x = "21%", y = "22%",
		width = "18%", height = "70%",
	}, zgui.afflictionlock.container)
	setBackgroundColor("impaAff", 80, 0, 0, 255)
	zgui.afflictionlock.impaLabel:echo("&lt;center&gt;Imp")
	
	zgui.afflictionlock.asthLabel = Geyser.Label:new({
		name = "asthAff",
		x = "41%", y = "22%",
		width = "18%", height = "70%",
	}, zgui.afflictionlock.container)
	setBackgroundColor("asthAff", 80, 0, 0, 255)
	zgui.afflictionlock.asthLabel:echo("&lt;center&gt;Ast")
	
	zgui.afflictionlock.anorLabel = Geyser.Label:new({
		name = "anorAff",
		x = "61%", y = "22%",
		width = "18%", height = "70%",
	}, zgui.afflictionlock.container)
	setBackgroundColor("anorAff", 80, 0, 0, 255)
	zgui.afflictionlock.anorLabel:echo("&lt;center&gt;Ano")
	
	zgui.afflictionlock.slicLabel = Geyser.Label:new({
		name = "slicAff",
		x = "81%", y = "22%",
		width = "18%", height = "70%",
	}, zgui.afflictionlock.container)
	setBackgroundColor("slicAff", 80, 0, 0, 255)
	zgui.afflictionlock.slicLabel:echo("&lt;center&gt;Sli")
  
  if not table.contains(zgui.modules, "buildAffLock") then
    table.insert(zgui.modules, "buildAffLock")
  end  
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildAffs</name>
											<packageName></packageName>
											<script>function zgui.buildAffs()
  zgui.afflictionSize = zgui.afflictionSize or 9
  zgui.affliction = {}

  --Create the affliction Adjustable
  zgui.affliction.window = Adjustable.Container:new({
    name = "zgui.affliction.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.affliction.window:changeMenuStyle("dark")

  --Create the affliction container
  zgui.affliction.container = Geyser.Container:new({
    name = "zgui.affliction.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.affliction.window)  

  --Create the affliction Console
  zgui.affliction.console = Geyser.MiniConsole:new({
    name = "afflictionDisplay",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.affliction.container) 

  setFontSize("afflictionDisplay", zgui.afflictionSize)
  --zgui.affliction.window:setTitle("Afflictions","gray")
  zgui.affliction.window:show()
  
  if not table.contains(zgui.modules, "buildAffs") then
    table.insert(zgui.modules, "buildAffs")
  end  
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildEnemy</name>
											<packageName></packageName>
											<script>function zgui.buildEnemy()
  zgui.enemySize = zgui.enemySize or 9
  zgui.enemy = {}

  --Create the enemy Adjustable
  zgui.enemy.window = Adjustable.Container:new({
    name = "zgui.enemy.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.enemy.window:changeMenuStyle("dark")

  --Create the enemy container
  zgui.enemy.container = Geyser.Container:new({
    name = "zgui.enemy.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.enemy.window)  

  --Create the enemy Console
  zgui.enemy.console = Geyser.MiniConsole:new({
    name = "enemyDisplay",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.enemy.container) 

  setFontSize("enemyDisplay", zgui.enemySize)
  --zgui.enemy.window:setTitle("Enemies","gray")
  zgui.enemy.window:show()
  
  if not table.contains(zgui.modules, "buildEnemy") then
    table.insert(zgui.modules, "buildEnemy")
  end  
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildAlly</name>
											<packageName></packageName>
											<script>function zgui.buildAlly()
  zgui.allySize = zgui.allySize or 9
  zgui.ally = {}

  --Create the ally Adjustable
  zgui.ally.window = Adjustable.Container:new({
    name = "zgui.ally.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.ally.window:changeMenuStyle("dark")

  --Create the ally container
  zgui.ally.container = Geyser.Container:new({
    name = "zgui.ally.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.ally.window)  

  --Create the ally Console
  zgui.ally.console = Geyser.MiniConsole:new({
    name = "allyDisplay",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.ally.container) 

  setFontSize("allyDisplay", zgui.allySize)
  --zgui.ally.window:setTitle("Allies","gray")
  zgui.ally.window:show()
  
  if not table.contains(zgui.modules, "buildAlly") then
    table.insert(zgui.modules, "buildAlly")
  end  
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildPrompt</name>
											<packageName></packageName>
											<script>function zgui.buildPrompt()
  zgui.promptSize = zgui.promptSize or 9
  zgui.prompt = {}
  
  --Create the prompt Adjustable
  zgui.prompt.window = Adjustable.Container:new({
    name = "zgui.prompt.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",        
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,
  },main)
  zgui.prompt.window:changeMenuStyle("dark")

  --Create the prompt container
  zgui.prompt.container = Geyser.Container:new({
    name = "zgui.prompt.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.prompt.window)  

  --Create the prompt Console
  zgui.prompt.console = Geyser.MiniConsole:new({
    name = "myPrompt",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.prompt.container) 
 
  setFontSize("myPrompt", zgui.promptSize)
  --zgui.prompt.window:setTitle("Prompt","gray")
  zgui.prompt.window:show()  
  
  if not table.contains(zgui.modules, "buildPrompt") then
    table.insert(zgui.modules, "buildPrompt")
  end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildMap</name>
											<packageName></packageName>
											<script>function zgui.buildMap()
  zgui.mapSize = zgui.mapSize or 9
  zgui.map = {}
  zgui.map.tabs = {"Wilderness","Ocean","Mapper"}
  zgui.map.color1 = "rgb(218,218,218)"
  zgui.map.color2 = "rgb(0,0,0)"
  zgui.map.color3 = "rgb(150,150,150)"
  zgui.map.width = "100%"
  zgui.map.height = "100%"
  zgui.map.current = zgui.map.tabs[3]

  --Create the Adjustable container
  --Our tabbed window will need a container. This will be the bottom layer. Containers are invisible so no need to set a stylesheet. 
  zgui.map.window = Adjustable.Container:new({
    name = "zgui.map.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.map.window:changeMenuStyle("dark")

  --Create the main container
  zgui.map.container = Geyser.Container:new({
    name = "zgui.map.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.map.window)
  
 --Create an HBox
 --All of our tabs will be evenly spaced. So we'll create an HBox to sit at the top of our container. 
 zgui.map.header = Geyser.HBox:new({
    name = "zgui.map.header",
    x = 0, y = 0,
    width = "100%",
    height = "0%",
  },zgui.map.container)  
  setBackgroundColor("zgui.map.header", 0,0,0,255) 
  
  --Create a label
  --This label will serve as a container for each window. It sits right underneath the HBox we just created for the tabs. 
  zgui.map.footer = Geyser.Label:new({
    name = "zgui.map.footer",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
  },zgui.map.container)
  
  --Each window actually has two labels. One for the light blue background, and another for the dark blue center. This will create that dark blue center.
  zgui.map.center = Geyser.Label:new({
    name = "zgui.map.center",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
  },zgui.map.footer)

    zgui.map.Mapper = Geyser.Label:new({
      name = "zgui.map.Mapper",
      x = 0, y = 0,
      width = "100%",
      height = "100%",
    },zgui.map.footer)
    zgui.map["Mappercenter"] = Geyser.Label:new({
      name = "zgui.map.Mappercenter",
      x = 0, y = 0,
      width = "100%",
      height = "100%",
      bgColor = "black",
    },zgui.map.Mapper)
    zgui.map.Mapper:hide()

    zgui.map.Wilderness = Geyser.Label:new({
      name = "zgui.map.Wilderness",
        x = 0, y = 0,
      width = "100%",
      height = "100%",
    },zgui.map.footer)
    zgui.map["Wildernesscenter"] = Geyser.Label:new({
      name = "zgui.map.Wildernesscenter",
      x = 0, y = 0,
      width = "100%",
      height = "100%",
      bgColor = "black",
    },zgui.map.Wilderness)
    zgui.map.Wilderness:hide()  
    
    zgui.map.Ocean = Geyser.Label:new({
      name = "zgui.map.Ocean",
      x = 0, y = 0,
      width = "100%",
      height = "100%",
      bgColor = "black",
    },zgui.map.footer)
    zgui.map["Oceancenter"] = Geyser.Label:new({
      name = "zgui.map.Oceancenter",
      x = 0, y = 0,
      width = "100%",
      height = "100%",
    },zgui.map.Ocean)
    zgui.map.Ocean:hide()     
  
  zgui.map.mapperWindow = Geyser.Mapper:new({
    name = "Mapper",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
  },zgui.map.Mappercenter)
  showWindow("Mapper")
  
  zgui.map.oceanWindow = Geyser.MiniConsole:new({
    name = "Ocean",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
  },zgui.map.Oceancenter)  
  setBackgroundColor("Ocean", 0,0,0,255)
  hideWindow("Ocean")
 
  zgui.map.wildernessWindow = Geyser.MiniConsole:new({
    name = "Wilderness",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
  },zgui.map.Wildernesscenter)  
  setBackgroundColor("Wilderness", 0,0,0,255)  
  hideWindow("Wilderness")

  setFontSize("Ocean", zgui.mapSize)
  setFontSize("Wilderness", zgui.mapSize)
  --zgui.map.window:setTitle("Map","gray")
  zgui.map.window:show()  
  
  if not table.contains(zgui.modules, "buildMap") then
    table.insert(zgui.modules, "buildMap")
  end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildChat</name>
											<packageName></packageName>
											<script>function zgui.buildChat()
  zgui.chatSize = zgui.chatSize or 9
  zgui.chat = {}
  zgui.chat.tabs = {"All","City","House","Order","Party","Clans","Tells","Market","Misc"}
  zgui.chat.color1 = "rgb(15,15,15)"
  zgui.chat.color2 = "rgb(0,0,0)"
  zgui.chat.color3 = "rgb(25,25,25)"
  zgui.chat.width = "100%"
  zgui.chat.height = "100%"
  zgui.chat.current = zgui.chat.tabs[1]
  zgui.chat.useCmdLine = false

  --Create the main container
  --Our tabbed window will need a container. This will be the bottom layer. Containers are invisible so no need to set a stylesheet. 
  zgui.chat.window = Adjustable.Container:new({
    name = "zgui.chat.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.chat.window:changeMenuStyle("dark")

  --Create the main container
  --Our tabbed window will need a container. This will be the bottom layer. Containers are invisible so no need to set a stylesheet. 
  zgui.chat.container = Geyser.Container:new({
    name = "zgui.chat.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.chat.window)
  
 --Create an HBox
 --All of our tabs will be evenly spaced. So we'll create an HBox to sit at the top of our container. 
 zgui.chat.header = Geyser.HBox:new({
    name = "zgui.chat.header",
    x = 0, y = 0,
    width = "100%",
    height = "8%",
  },zgui.chat.container)  
  
  --Create a label
  --This label will serve as a container for each window. It sits right underneath the HBox we just created for the tabs. 
  zgui.chat.footer = Geyser.Label:new({
    name = "zgui.chat.footer",
    x = 0, y = "8%",
    width = "100%",
    height = "92%",
  },zgui.chat.container)
  
  --Each window actually has two labels.
  zgui.chat.center = Geyser.Label:new({
    name = "zgui.chat.center",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
  },zgui.chat.footer)
  --zgui.chat.center:setBackgroundImage(getMudletHomeDir()..[[\Zulah GUI 3.2\Artwork\Wallpapers\slate.jpg]], "center")

  zgui.chat.click = function(tab)
    zgui.chat[zgui.chat.current.."tab"]:setStyleSheet([[
      background-color: ]]..zgui.chat.color1..[[;
      color: DimGrey;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      margin-right: 1px;
      margin-left: 1px;
    ]])
    zgui.chat[zgui.chat.current]:hide()
    zgui.chat.current = tab
    zgui.chat[zgui.chat.current]:show()
    zgui.chat[zgui.chat.current.."tab"]:setStyleSheet([[
      background-color: ]]..zgui.chat.color3..[[;
      color: NavajoWhite;
      border-top-left-radius: 15px;
      border-top-right-radius: 15px;
      margin-right: 2px;
      margin-left: 2px;
    ]])  
  end
  
  for k,v in pairs(zgui.chat.tabs) do
    zgui.chat[v.."tab"] = Geyser.Label:new({
      name = "zgui.chat."..v.."tab",
      fgColor = "white",
    },zgui.chat.header)
    
    zgui.chat[v.."tab"]:setStyleSheet([[
      background-color: ]]..zgui.chat.color1..[[;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
      margin-right: 1px;
      margin-left: 1px;
    ]])
    
    zgui.chat[v.."tab"]:echo("&lt;center&gt;"..v)
    zgui.chat[v.."tab"]:setClickCallback("zgui.chat.click",v)

    zgui.chat[v] = Geyser.Label:new({
      name = "zgui.chat."..v,
      x = 0, y = 0,
      width = "100%",
      height = "100%",
    },zgui.chat.footer)

    zgui.chat[v.."center"] = Geyser.Label:new({
      name = "zgui.chat."..v.."center",
      x = 0, y = 0,
      width = "100%",
      height = "100%",
    },zgui.chat[v])
  
    zgui.chat[v]:hide()
  end
  
--  -- Setup a command line prompt for the chat windows
--  zgui.chat.cmd = Geyser.CommandLine:new({
--    name = "zgui.chat.cmd", 
--    x = 0, y = "100%-40px", 
--    width = "100%", height = 40,
--    stylesheet = "border: 1px solid silver;"
--  },zgui.chat.footer)
  
  -- Create each channel window
  zgui.chat.allchat = Geyser.MiniConsole:new({
    name = "All",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.chat.Allcenter)     
  hideWindow("All")
  --zgui.chat.allchat:setBackgroundImage(getMudletHomeDir()..[[\Zulah GUI 3.2\Artwork\Wallpapers\slate.jpg]], "center")

  zgui.chat.citychat = Geyser.MiniConsole:new({
    name = "City",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.chat.Citycenter)     
  hideWindow("City")
  --zgui.chat.citychat:setBackgroundImage(getMudletHomeDir()..[[\Zulah GUI 3.2\Artwork\Wallpapers\slate.jpg]], "center")
  
  zgui.chat.housechat = Geyser.MiniConsole:new({
    name = "House",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.chat.Housecenter)       
  hideWindow("House")
  --zgui.chat.housechat:setBackgroundImage(getMudletHomeDir()..[[\Zulah GUI 3.2\Artwork\Wallpapers\slate.jpg]], "center")
  
  zgui.chat.orderchat = Geyser.MiniConsole:new({
    name = "Order",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.chat.Ordercenter)       
  hideWindow("Order")
  --zgui.chat.orderchat:setBackgroundImage(getMudletHomeDir()..[[\Zulah GUI 3.2\Artwork\Wallpapers\slate.jpg]], "center")

  zgui.chat.partychat = Geyser.MiniConsole:new({
    name = "Party",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.chat.Partycenter)       
  hideWindow("Party")
  --zgui.chat.partychat:setBackgroundImage(getMudletHomeDir()..[[\Zulah GUI 3.2\Artwork\Wallpapers\slate.jpg]], "center")

  zgui.chat.clanschat = Geyser.MiniConsole:new({
    name = "Clans",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.chat.Clanscenter)       
  hideWindow("Clans")
  --zgui.chat.clanschat:setBackgroundImage(getMudletHomeDir()..[[\Zulah GUI 3.2\Artwork\Wallpapers\slate.jpg]], "center")
  
  zgui.chat.tellschat = Geyser.MiniConsole:new({
    name = "Tells",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.chat.Tellscenter)         
  hideWindow("Tells")
  --zgui.chat.tellschat:setBackgroundImage(getMudletHomeDir()..[[\Zulah GUI 3.2\Artwork\Wallpapers\slate.jpg]], "center")
  
  zgui.chat.marketchat = Geyser.MiniConsole:new({
    name = "Market",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.chat.Marketcenter)     
  hideWindow("Market")
  --zgui.chat.marketchat:setBackgroundImage(getMudletHomeDir()..[[\Zulah GUI 3.2\Artwork\Wallpapers\slate.jpg]], "center")
  
  zgui.chat.miscchat = Geyser.MiniConsole:new({
    name = "Misc",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.chat.Misccenter)     
  hideWindow("Misc")
  --zgui.chat.miscchat:setBackgroundImage(getMudletHomeDir()..[[\Zulah GUI 3.2\Artwork\Wallpapers\slate.jpg]], "center")
  
  setFontSize("All", zgui.chatSize)
  setFontSize("City", zgui.chatSize)
  setFontSize("House", zgui.chatSize)
  setFontSize("Order", zgui.chatSize)
  setFontSize("Party", zgui.chatSize)
  setFontSize("Clans", zgui.chatSize)
  setFontSize("Tells", zgui.chatSize)
  setFontSize("Market", zgui.chatSize)
  setFontSize("Misc", zgui.chatSize)
  --zgui.chat.window:setTitle("Chat","gray")
  zgui.chat.window:show()
  
  if not table.contains(zgui.modules, "buildChat") then
    table.insert(zgui.modules, "buildChat")
  end
end

</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Chat Cmd Prompt</name>
											<packageName></packageName>
											<script>function zgui.chatSend(channel, text)
  send(channel.." "..text)
end

zgui.chat.citychat:setCmdAction(zgui.chatSend, "ct")
zgui.chat.housechat:setCmdAction(zgui.chatSend, "ht")
zgui.chat.orderchat:setCmdAction(zgui.chatSend, "ot")
zgui.chat.partychat:setCmdAction(zgui.chatSend, "pt")
zgui.chat.marketchat:setCmdAction(zgui.chatSend, "market")</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildStatsWindow</name>
											<packageName></packageName>
											<script>function zgui.buildStatsWindow()
  zgui.statsWindowSize = zgui.statsWindowSize or 8
  zgui.statwindow = {}

  --Create the enemy Adjustable
  zgui.statwindow.window = Adjustable.Container:new({
    name = "zgui.statwindow.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 3px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.statwindow.window:changeMenuStyle("dark")

  --Create the enemy container
  zgui.statwindow.container = Geyser.Container:new({
    name = "zgui.bwindow.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.statwindow.window)  

  --Create the enemy Console
  zgui.statwindow.console = Geyser.MiniConsole:new({
    name = "statsDisplay",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.statwindow.container) 

  setFontSize("statsDisplay", zgui.statsWindowSize)
  --zgui.statwindow.window:setTitle("Stats Window","gray")
  zgui.statwindow.window:show()
  
  if not table.contains(zgui.modules, "buildStatsWindow") then
    table.insert(zgui.modules, "buildStatsWindow")
  end  
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>buildRoomInfo</name>
											<packageName></packageName>
											<script>function zgui.buildRoomInfo()
  zgui.roomInfoSize = zgui.roomInfoSize or 8
  zgui.rinfWindow = {}

  --Create the enemy Adjustable
  zgui.rinfWindow.window = Adjustable.Container:new({
    name = "zgui.rinfWindow.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 3px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.rinfWindow.window:changeMenuStyle("dark")

  --Create the enemy container
  zgui.rinfWindow.container = Geyser.Container:new({
    name = "zgui.bwindow.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.rinfWindow.window)  

  --Create the enemy Console
  zgui.rinfWindow.console = Geyser.MiniConsole:new({
    name = "roomInfoDisplay",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.rinfWindow.container) 

  setFontSize("roomInfoDisplay", zgui.roomInfoSize)
  --zgui.rinfWindow.window:setTitle("Stats Window","gray")
  zgui.rinfWindow.window:show()
  
  if not table.contains(zgui.modules, "buildRoomInfo") then
    table.insert(zgui.modules, "buildRoomInfo")
  end  
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Defences</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>buildDefs</name>
											<packageName></packageName>
											<script>function zgui.buildDefence()
  zgui.defenceSize = zgui.defenceSize or 9
  zgui.defence = {}

  --Create the defence Adjustable
  zgui.defence.window = Adjustable.Container:new({
    name = "zgui.defence.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.defence.window:changeMenuStyle("dark")

  --Create the defence container
  zgui.defence.container = Geyser.Container:new({
    name = "zgui.defence.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.defence.window)  

  --Create the defence Console
  zgui.defence.console = Geyser.MiniConsole:new({
    name = "defenceDisplay",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.defence.container) 

  setFontSize("defenceDisplay", zgui.defenceSize)
  zgui.defence.window:setTitle("Defences","gray")
  zgui.defence.window:show()
  
  if not table.contains(zgui.modules, "Defence") then
    table.insert(zgui.modules, "Defence")
  end  
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>showDefs</name>
											<packageName></packageName>
											<script>function zgui.showDefs()
  if zgui.defence then
  ----------------------------------------
  -- Player Defences		
	clearWindow("defenceDisplay")
	if table.size(gmcp_defs) &gt; 0 then
		--for i=1, table.size(gmcp_defs), 1 do
		--	cecho("defenceDisplay", "&lt;green&gt; - &lt;grey&gt;"..gmcp_defs[i].."\n")
		--end  
  
		local missingDefs = false
		for i=1, table.size(zgui.defs.classless.combat), 1 do
			if not table.contains(gmcp_defs, zgui.defs.classless.combat[i]) then
				setBackgroundColor("defenceDisplay",40,10,10,255)	
				missingDefs = true
				cecho("defenceDisplay", "&lt;red&gt;Missing:\n")
				break
			end
		end

		if not missingDefs then
			if zgui.defs.class[gmcp.Char.Status.class] then
			for i=1, table.size(zgui.defs.class[gmcp.Char.Status.class]), 1 do
				if not table.contains(gmcp_defs, zgui.defs.class[gmcp.Char.Status.class][i]) then
					setBackgroundColor("defenceDisplay",40,10,10,255)	
					missingDefs = true
					cecho("defenceDisplay", "&lt;red&gt;Missing:\n")
					break
				end
			end		
			end
		end
		
		if not missingDefs then
			setBackgroundColor("defenceDisplay", 0, 0, 0,255)	
		end	
		
		if zgui.defs.class[gmcp.Char.Status.class] then	
		for i=1, table.size(zgui.defs.class[gmcp.Char.Status.class]), 1 do
			if not table.contains(gmcp_defs, zgui.defs.class[gmcp.Char.Status.class][i]) then
				cecho("defenceDisplay", "&lt;red&gt; - &lt;red&gt;"..zgui.defs.class[gmcp.Char.Status.class][i].."\n")
			end		
		end
		end
			
		for i=1, table.size(zgui.defs.classless.combat), 1 do
			if not table.contains(gmcp_defs, zgui.defs.classless.combat[i]) then
				cecho("defenceDisplay", "&lt;red&gt; - &lt;red&gt;"..zgui.defs.classless.combat[i].."\n")
			end
		end

	end	

	if table.contains(gmcp_defs, "prismatic") then
		setBackgroundColor("defenceDisplay",10,40,20,255)
	end
  end
end</script>
											<eventHandlerList />
										</Script>
										<ScriptGroup isActive="yes" isFolder="yes">
											<name>GMCP Def Functions</name>
											<packageName></packageName>
											<script></script>
											<eventHandlerList />
											<Script isActive="yes" isFolder="no">
												<name>GMCP DEFS</name>
												<packageName></packageName>
												<script>gmcp_defs = gmcp_defs or {}
 
function gmcp_def_event_list(event)
    local def = ""
    if gmcp.Char.Defences.List then
        gmcp_defs = {}
        for k, v in pairs(gmcp.Char.Defences.List) do
            def = gmcp_def_parse(v.name)
            gmcp_defs[#gmcp_defs+1] = def
        end
    end
    zgui.showDefs()
end
 
registerAnonymousEventHandler("gmcp.Char.Defences.List", "gmcp_def_event_list")
 
function gmcp_def_event_add(event)
    local gmcp_limbs = {"parry right leg", "parry left leg", "parry left arm", "parry right arm", "parry head", "parry torso", "parry right", "parry left", "parry centre"}
    local def = ""
    if gmcp.Char.Defences.Add then
        def = gmcp.Char.Defences.Add.name
        def = gmcp_def_parse(def)
        if table.contains(gmcp_limbs, def) then
            for k,v in pairs(gmcp_limbs) do
                if table.contains(gmcp_defs, v) then
                    table.remove(gmcp_defs, table.index_of(gmcp_defs, v))
                end
            end
        end
        if string.match(def, "shield") then
            --cecho("DEF|&lt;green&gt; " ..string.upper(def).."\n")
            raiseEvent("got def", def)
        end
        gmcp_defs[#gmcp_defs+1] = def
    end
    zgui.showDefs()
end
 
registerAnonymousEventHandler("gmcp.Char.Defences.Add", "gmcp_def_event_add")
 
function gmcp_def_event_remove(event)
    local def = ""
    if gmcp.Char.Defences.Remove then
        def = gmcp.Char.Defences.Remove[1]
        def = gmcp_def_parse(def)
        if string.match(def, "shield") then
            --cecho("DEF|&lt;red&gt; " ..string.upper(def).."\n")
            raiseEvent("lost def", def)
        end
        if table.contains(gmcp_defs, def) then
            table.remove(gmcp_defs, table.index_of(gmcp_defs, def))
        end
    end
    zgui.showDefs()
end
 
registerAnonymousEventHandler("gmcp.Char.Defences.Remove", "gmcp_def_event_remove")
 
function gmcp_def_parse(def)
    local base_def = nil
    local limb = nil
    limb = string.match(def, "%a+ %((.-)%)")
    if limb then
        base_def = string.match(def, "(%a+) %(.-%)")
        if base_def == "parrying" or base_def == "guarding" or base_def == "clawparrying" then
            return "parry "..limb
        else
            return def
        end
    else
        return def
    end
end</script>
												<eventHandlerList />
											</Script>
										</ScriptGroup>
									</ScriptGroup>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>Update Windows</name>
										<packageName></packageName>
										<script></script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>showChat</name>
											<packageName></packageName>
											<script>function zgui.showChat()
  local shortName = ""
  local chatWindow = false
	local ofr, ofg, ofb = getFgColor()
	local obr, obg, obb = getBgColor()  
  local text = ansi2decho(gmcp.Comm.Channel.Text.text)
  local person = gmcp.Comm.Channel.Text.talker:title()
  
  for k,v in pairs(gmcp.Comm.Channel.List) do
    shortName = gmcp.Comm.Channel.List[k].command
  end
  local chatChannels = {
      ["says"] = "All",
      ["armytell"] = "City",
      ["yell"] = "Misc",
      ["shout"] = "Misc",
      ["ct"] = "City",
      ["newbie"] = "Misc",
      ["market"] = "Market", 
      ["ht"] = "House",
      ["hts"] = "House",
      ["hnt"] = "House",
      ["clt"] = "Clans",
      ["party"] = "Party",
      ["tell"] = "Tells",
      ["ot"] = "Order",
    }

  for chan, wind in pairs(chatChannels) do
    if string.starts(gmcp.Comm.Channel.Start, chan) then
      chatWindow = wind 
      break
    end
  end
  if not chatWindow then chatWindow = "Misc" end

	
	if person == "The guardian spirit of the totem" then 
		only_to_misc = false
		return
	end
  local report = false
  
  if ataxiaNDB_Exists(person) or table.contains(ataxiaNDB.divine, person) or gmcp.Comm.Channel.Start == "shout" or person == "You" then
    report = true
  end
  
  
  if person == gmcp.Char.Status.name or person == "You" then
    decho(chatWindow, text.."\n")
    if chatWindow ~= "All" then
		  decho("All", text.."\n")
    end
	elseif report then    
		if gmcp.Comm.Channel.Start == "shout" then
      cecho(chatWindow, "&lt;cyan&gt; "..person.."&lt;red&gt;: ")
		end	
		decho(chatWindow, text.."\n")
	
		if not only_to_misc and chatWindow ~= "All" then
			if gmcp.Comm.Channel.Start == "shout" then
				cecho("All", "&lt;cyan&gt; "..gmcp.Comm.Channel.Text.talker.."&lt;red&gt;: ")
			end			
			decho("All", text.."\n")
		end

    if string.find(gmcp.Comm.Channel.Start:lower(), "tell") and not string.find(gmcp.Comm.Channel.Start:lower(), "army") and not muteList[person] and person ~= "You" then 
        ataxiaBasher_alert("Normal") 
    end    

	end
	only_to_misc = false	

  enableTrigger("Ataxia Chat Capture")
end

registerAnonymousEventHandler("gmcp.Comm.Channel.Start", "zgui.showChat")</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>wildMoved</name>
											<packageName></packageName>
											<script>function zgui.wildMoved()
  --Update Window On Movement  
  clearWindow("Wilderness") 
  clearWindow("Ocean")
end
-------------------------------------------------------------------
registerAnonymousEventHandler("gmcp.Room.Info", "zgui.wildMoved")</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>sendPrompt</name>
											<packageName></packageName>
											<script>function zgui.sendPrompt()

end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>showAllies</name>
											<packageName></packageName>
											<script>function zgui.showAllies()
  clearWindow("allyDisplay")
	for i=1, table.size(zgui.allies), 1 do
		cecho("allyDisplay", "&lt;white&gt;"..i.."- &lt;gray&gt;"..zgui.allies[i].."\n")
	end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>showEnemies</name>
											<packageName></packageName>
											<script>function zgui.showEnemies()
  clearWindow("enemyDisplay")
	for i=1, table.size(zgui.enemies), 1 do
		cecho("enemyDisplay", "&lt;white&gt;"..i.."- &lt;gray&gt;"..zgui.enemies[i].."\n")
	end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>showAffs</name>
											<packageName></packageName>
											<script>function zgui.showAffs()
  if zgui.afflictionlock then
  	setBackgroundColor("pronAff", 0, 20, 0, 255)
	  setBackgroundColor("paraAff", 0, 20, 0, 255)
	  setBackgroundColor("impaAff", 0, 20, 0, 255)
	  setBackgroundColor("asthAff", 0, 20, 0, 255)
	  setBackgroundColor("anorAff", 0, 20, 0, 255)
	  setBackgroundColor("slicAff", 0, 20, 0, 255)
		if affed("prone") then setBackgroundColor("pronAff", 255, 0, 0, 255) end
		if affed("paralysis") then setBackgroundColor("paraAff", 255, 0, 0, 255) end
		if affed("impatience") then setBackgroundColor("impaAff", 255, 0, 0, 255) end
		if affed("asthma") then setBackgroundColor("asthAff", 255, 0, 0, 255) end
		if affed("anorexia") then setBackgroundColor("anorAff", 255, 0, 0, 255) end
		if affed("slickness") then setBackgroundColor("slicAff", 255, 0, 0, 255) end
  end
  
  if zgui.affliction then
    clearUserWindow("afflictionDisplay")
    cecho("afflictionDisplay", ataxia_promptAffs())
  end
end

function zgui.showTarAffs()
if type(target) ~= "number" then
	local ignoreAffs = {"curseward", "blindness", "deafness", "rebounding", "shield"}
	local str = "&lt;a_brown&gt;[&lt;NavajoWhite&gt;"..target:title().."&lt;a_brown&gt;]: "
	for aff, boo in pairs(tAffs) do
		if boo ~= false and not table.contains(ignoreAffs, aff) then
			if affs_to_colour[aff] then
				str = str.."&lt;"..affs_to_colour[aff][1].."&gt;"..affs_to_colour[aff][2].." "
			else
				str = str.."&lt;DimGrey&gt;"..string.sub(aff, 1, 3).." "
			end	
		end
	end
	clearUserWindow("targetafflictionDisplay")
  cecho("targetafflictionDisplay", str)
end
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>showCape</name>
											<packageName></packageName>
											<script>function zgui.showCape()
  -- update the bar
  if zgui.cape.watch &lt; 240 then
    zgui.cape.capebar:setValue((240-zgui.cape.watch), 240)
    if zgui.cape.count &gt; 49 then
      zgui.cape.capebar.back:setStyleSheet([[
		    border-width: 2px;
		    border-color: darkred;
		    border-style: solid;
		    border-radius: 7;
		    padding: 3px;
	    ]])
      zgui.cape.capebar:echo("&lt;center&gt;FULL - "..(240-zgui.cape.watch).." seconds")
    else
      zgui.cape.capebar.back:setStyleSheet([[
	  	  background-color: QLinearGradient( x1: 0, y1: 0, x2: 0, y2: 1, stop: 0 #555555, stop: 0.1 #555555, stop: 0.49 #333333, stop: 0.5 #333333, stop: 1 #555555);
		    border-width: 1px;
		    border-color: black;
		    border-style: solid;
		    border-radius: 7;
		    padding: 3px;
	    ]])
      zgui.cape.capebar:echo("&lt;center&gt;"..zgui.cape.count.."/50 - "..(240-zgui.cape.watch).." seconds")
    end
  elseif zgui.cape.watch == 220 then
    cecho(" == WARNING: 20 SECONDS LEFT ON CAPE ==")  
    zgui.cape.capebar:setValue((240-zgui.cape.watch), 240)
    zgui.cape.capebar:echo("&lt;center&gt;"..zgui.cape.count.."/50 - "..(240-zgui.cape.watch).." seconds")
  else
    zgui.clearCape()   
  end
end

function zgui.renewCape()
  zgui.cape.watch = 0
  if not zgui.cape.count then zgui.cape.count = 0 end
  zgui.cape.count = zgui.cape.count + 1
  if zgui.cape.count &gt; 50 then zgui.cape.count = 50 end
  zgui.showCape()
  enableTimer("Deathcape Timer")
end

function zgui.clearCape()
  zgui.cape.watch = 0
  zgui.cape.count = 0
  zgui.cape.capebar:setValue(0, 240)
  disableTimer("Deathcape Timer")
    zgui.cape.capebar:echo("")
    zgui.cape.capebar.back:setStyleSheet([[
		  background-color:rgba(20,20,20,50%);
		  border-width: 1px;
		  border-color: black;
		  border-style: solid;
		  border-radius: 7;
		  padding: 3px;
	  ]])    
end

registerAnonymousEventHandler("You Died", "zgui.clearCape")
registerAnonymousEventHandler("You Starbursted", "zgui.clearCape")</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>showRoomInfo</name>
											<packageName></packageName>
											<script>function zgui.showRoomInfo()
  clearUserWindow("roomInfoDisplay")
  local areaName, roomName = mmp.cleanAreaName(gmcp.Room.Info.area), mmp.cleanroomname(gmcp.Room.Info.name)
  cecho("roomInfoDisplay", " &lt;NavajoWhite&gt;"..roomName:title().." - "..areaName.." &lt;DodgerBlue&gt;(v&lt;NavajoWhite&gt;"..gmcp.Room.Info.num.."&lt;DodgerBlue&gt;)")
  cecho("roomInfoDisplay", "\n&lt;brown&gt;  [&lt;orange&gt;"..room_exitstr.."&lt;brown&gt;]\n")
  --Indoors Display 
    cecho("roomInfoDisplay", (table.contains(gmcp.Room.Info.details, "indoors") and " &lt;cadet_blue&gt;[indoors]" or "&lt;chat_bg&gt;[indoors]"))  
  --Monolith Display
    cecho("roomInfoDisplay", (ataxiaTemp.monolith and " &lt;LightSkyBlue&gt;[mono]" or " &lt;chat_bg&gt;[mono]"))
  --Lightwall Display 
    cecho("roomInfoDisplay", (ataxia.lightwall and " &lt;orange&gt;[light]" or " &lt;chat_bg&gt;[light]"))
end</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Room Items</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>buildRoomItems</name>
										<packageName></packageName>
										<script>function zgui.buildRoomitems()
  zgui.roomItemsSize = zgui.roomItemsSize or 9
  zgui.roomitems = {}

  --Create the roomitems Adjustable
  zgui.roomitems.window = Adjustable.Container:new({
    name = "zgui.roomitems.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.roomitems.window:changeMenuStyle("dark")

  --Create the roomitems container
  zgui.roomitems.container = Geyser.Container:new({
    name = "zgui.roomitems.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.roomitems.window)  

  --Create the roomitems Console
  zgui.roomitems.console = Geyser.MiniConsole:new({
    name = "roomItemsDisplay",
    x = 0, y = 0,
    autoWrap = true,
    width = "100%",
    height = "100%",
    color="black",
  },zgui.roomitems.container) 

  setFontSize("roomItemsDisplay", zgui.roomItemsSize)
  zgui.roomitems.window:setTitle("Items","gray")
  zgui.roomitems.window:show()
  
  if not table.contains(zgui.modules, "Roomitems") then
    table.insert(zgui.modules, "Roomitems")
  end  
end</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>showRoomItems</name>
										<packageName></packageName>
										<script>function zgui.showRoomItems()
  clearWindow("roomItemsDisplay")
  if zgui.roomGetItemList then
    for k,v in pairs(zgui.roomGetItemList) do
      cecho("roomItemsDisplay", " &lt;gold&gt;"..zgui.roomGetItemList[k].."\n")
    end
  end  
  if zgui.roomItemList then
    for k,v in pairs(zgui.roomItemList) do
      cecho("roomItemsDisplay", " &lt;grey&gt;"..zgui.roomItemList[k].."\n")
    end
  end    
end

--new Items list on moving rooms
function zgui.updateroomitems()
  zgui.roomGetItemList = {}
  zgui.roomItemList = {}
  zgui.roomDenizenList = {}
  for k,v in pairs(gmcp.Char.Items.List.items) do
    if v.attrib == "m" then
      if not table.contains(zgui.roomDenizenList, v.id) then
        zgui.roomDenizenList[v.id] = v.name
      end
    elseif v.attrib == "t" then
      if not table.contains(zgui.roomGetItemList, v.id) then
        zgui.roomGetItemList[v.id] = v.name
      end   
    else
      if not table.contains(zgui.roomItemList, v.id) then
        zgui.roomItemList[v.id] = v.name
      end           
    end
  end -- for
  zgui.showRoomItems()
  
end

registerAnonymousEventHandler("gmcp.Char.Items.List", "zgui.updateroomitems")

--item added to room
function zgui.addroomitem()
  --check if item was added to room
  if gmcp.Char.Items.Add.location == "room" then
    --check if item is already in roomitems table
    if gmcp.Char.Items.Add.item.attrib == "m" then
      if not table.contains(zgui.roomDenizenList, gmcp.Char.Items.Add.item.id) then
        zgui.roomDenizenList[gmcp.Char.Items.Add.item.id] = gmcp.Char.Items.Add.item.name
      end
    elseif gmcp.Char.Items.Add.item.attrib == "t" then
      if not table.contains(zgui.roomGetItemList, gmcp.Char.Items.Add.item.id) then
        zgui.roomGetItemList[gmcp.Char.Items.Add.item.id] = gmcp.Char.Items.Add.item.name
      end   
    else
      if not table.contains(zgui.roomItemList, gmcp.Char.Items.Add.item.id) then
        zgui.roomItemList[gmcp.Char.Items.Add.item.id] = gmcp.Char.Items.Add.item.name
      end  
    end
  end
  zgui.showRoomItems()
  
end

--manually add item to room
function zgui.manualAddItem(id, name)
  if not table.contains(zgui.roomItemList, id) then
    zgui.roomItemList[id] = name
  end      
  zgui.showRoomItems()     
end

registerAnonymousEventHandler("gmcp.Char.Items.Add", "zgui.addroomitem")

--item removed from room
function zgui.removeroomitem()
  if gmcp.Char.Items.Remove.location == "room" then
    if table.contains(zgui.roomGetItemList, gmcp.Char.Items.Remove.item.id) then   
      zgui.roomGetItemList[gmcp.Char.Items.Remove.item.id] = nil
    elseif table.contains(zgui.roomDenizenList, gmcp.Char.Items.Remove.item.id) then   
      zgui.roomDenizenList[gmcp.Char.Items.Remove.item.id] = nil
    elseif table.contains(zgui.roomItemList, gmcp.Char.Items.Remove.item.id) then   
      zgui.roomItemList[gmcp.Char.Items.Remove.item.id] = nil
    end
  end
  zgui.showRoomItems()
 
end

--manually remove person leaving room from people_here
function zgui.manualRemoveItem(id)
  if table.contains(zgui.roomItemList, id) then
    zgui.roomItemList[id] = nil
  elseif table.contains(zgui.roomDenizenList, id) then   
    zgui.roomDenizenList[id] = nil
  elseif table.contains(zgui.roomItemList, id) then   
    zgui.roomItemList[id] = nil 
  end
  zgui.showRoomItems()
 
end

registerAnonymousEventHandler("gmcp.Char.Items.Remove", "zgui.removeroomitem")</script>
										<eventHandlerList />
									</Script>
								</ScriptGroup>
								<ScriptGroup isActive="yes" isFolder="yes">
									<name>Mapper</name>
									<packageName></packageName>
									<script></script>
									<eventHandlerList />
									<Script isActive="yes" isFolder="no">
										<name>wildMoved</name>
										<packageName></packageName>
										<script>function zgui.wildMoved()
  --Update Window On Movement  
  clearWindow("Wilderness") 
  clearWindow("Ocean")
  WildernessCoords()
end
-------------------------------------------------------------------
registerAnonymousEventHandler("gmcp.Room.Info", "zgui.wildMoved")</script>
										<eventHandlerList />
									</Script>
									<Script isActive="yes" isFolder="no">
										<name>buildMap</name>
										<packageName></packageName>
										<script>function zgui.buildMap()
  zgui.mapSize = zgui.mapSize or 9
  zgui.map = {}
  zgui.map.tabs = {"Wilderness","Ocean","Mapper"}
  zgui.map.color1 = "rgb(218,218,218)"
  zgui.map.color2 = "rgb(0,0,0)"
  zgui.map.color3 = "rgb(150,150,150)"
  zgui.map.width = "100%"
  zgui.map.height = "100%"
  zgui.map.current = zgui.map.tabs[3]

  --Create the Adjustable container
  --Our tabbed window will need a container. This will be the bottom layer. Containers are invisible so no need to set a stylesheet. 
  zgui.map.window = Adjustable.Container:new({
    name = "zgui.map.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = zgui.adjLabelstyle,
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)
  zgui.map.window:changeMenuStyle("dark")

  --Create the main container
  zgui.map.container = Geyser.Container:new({
    name = "zgui.map.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zgui.map.window)
  
 --Create an HBox
 --All of our tabs will be evenly spaced. So we'll create an HBox to sit at the top of our container. 
 zgui.map.header = Geyser.HBox:new({
    name = "zgui.map.header",
    x = 0, y = 0,
    width = "100%",
    height = "0%",
  },zgui.map.container)  
  setBackgroundColor("zgui.map.header", 0,0,0,255) 
  
  --Create a label
  --This label will serve as a container for each window. It sits right underneath the HBox we just created for the tabs. 
  zgui.map.footer = Geyser.Label:new({
    name = "zgui.map.footer",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
  },zgui.map.container)
  
  --Each window actually has two labels. One for the light blue background, and another for the dark blue center. This will create that dark blue center.
  zgui.map.center = Geyser.Label:new({
    name = "zgui.map.center",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
  },zgui.map.footer)

    zgui.map.Mapper = Geyser.Label:new({
      name = "zgui.map.Mapper",
      x = 0, y = 0,
      width = "100%",
      height = "100%",
    },zgui.map.footer)
    zgui.map["Mappercenter"] = Geyser.Label:new({
      name = "zgui.map.Mappercenter",
      x = 0, y = 0,
      width = "100%",
      height = "100%",
      bgColor = "black",
    },zgui.map.Mapper)
    zgui.map.Mapper:hide()

    zgui.map.Wilderness = Geyser.Label:new({
      name = "zgui.map.Wilderness",
        x = 0, y = 0,
      width = "100%",
      height = "100%",
    },zgui.map.footer)
    zgui.map["Wildernesscenter"] = Geyser.Label:new({
      name = "zgui.map.Wildernesscenter",
      x = 0, y = 0,
      width = "100%",
      height = "100%",
      bgColor = "black",
    },zgui.map.Wilderness)
    zgui.map.Wilderness:hide()  
    
    zgui.map.Ocean = Geyser.Label:new({
      name = "zgui.map.Ocean",
      x = 0, y = 0,
      width = "100%",
      height = "100%",
      bgColor = "black",
    },zgui.map.footer)
    zgui.map["Oceancenter"] = Geyser.Label:new({
      name = "zgui.map.Oceancenter",
      x = 0, y = 0,
      width = "100%",
      height = "100%",
    },zgui.map.Ocean)
    zgui.map.Ocean:hide()     
  
  zgui.map.mapperWindow = Geyser.Mapper:new({
    name = "Mapper",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
  },zgui.map.Mappercenter)
  showWindow("Mapper")
  
  zgui.map.oceanWindow = Geyser.MiniConsole:new({
    name = "Ocean",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
  },zgui.map.Oceancenter)  
  setBackgroundColor("Ocean", 0,0,0,255)
  hideWindow("Ocean")
 
  zgui.map.wildernessWindow = Geyser.MiniConsole:new({
    name = "Wilderness",
    x = 0, y = 0,
    width = "100%",
    height = "100%",
  },zgui.map.Wildernesscenter)  
  setBackgroundColor("Wilderness", 0,0,0,255)  
  hideWindow("Wilderness")

  setFontSize("Ocean", zgui.mapSize)
  setFontSize("Wilderness", zgui.mapSize)
  zgui.map.window:setTitle("Map","gray")
  zgui.map.window:show()  
  
  if not table.contains(zgui.modules, "Map") then
    table.insert(zgui.modules, "Map")
  end
end</script>
										<eventHandlerList />
									</Script>
									<ScriptGroup isActive="yes" isFolder="yes">
										<name>WildWalker</name>
										<packageName></packageName>
										<script>wildernessLocations = wildernessLocations or {}</script>
										<eventHandlerList />
										<Script isActive="yes" isFolder="no">
											<name>WildernessCoords</name>
											<packageName></packageName>
											<script>function WildernessCoords(...)
 local displayRoomsWithin = 100
 if gmcp.Room.Info.ohmap and gmcp.Room.Info.environment ~= "Vessel" then
    local posx,posy,chunkx,chunky,x,y = translateWilderness()
    cecho("Wilderness", "&lt;gray&gt;-----[ Wilderness Coords ]----")
    cecho("Wilderness", "\n&lt;gray&gt;-- &lt;ansiLightBlack&gt;Chunk: &lt;ansiLightRed&gt;"..chunk)
--    cehco("\n&lt;ansiLightBlack&gt;Cx:&lt;ansiLightRed&gt;" .. chunkx .. " &lt;ansiLightBlack&gt;Cy:&lt;ansiLightRed&gt;".. chunky)
--    cecho("\n&lt;ansiLightBlack&gt;X:&lt;ansiLightRed&gt;"..x .. "&lt;ansiLightBlack&gt; Y:&lt;ansiLightRed&gt;"..y)
    cecho("Wilderness", " : &lt;ansiLightBlack&gt;X:&lt;ansiLightRed&gt;".. posx .. "&lt;ansiLightBlack&gt; Y:&lt;ansiLightRed&gt;"..posy.." &lt;gray&gt;--".."\n")
    --cecho("\n&lt;ansiGreen&gt;------------------------")
    for k,v in pairsByKeys(wildernessExits) do
    local dir,dash = directionsTo(k)
    local color = "&lt;ansiWhite&gt;"
      if dir == "enter" then dir = "&lt;ansiGreen&gt;all around you!" else dir = "to the " .. dir end
      if k == wildernessWhere then color = "&lt;ansiLightRed&gt;" end
      if k == wildernessWhere or (math.abs(posx-v.x)&lt;displayRoomsWithin  and 
                                  math.abs(posy-v.y)&lt;displayRoomsWithin) then
        cecho("\n".. color.. v.name .. " is " .. dir .. "")
      end -- if
    end-- for
  end-- if
end-- func

function translateWilderness(num)
  local info = gmcp.Room.Info
  local num = num or info.num
  local posx,posy,chunkx,chunky,x,y
  if info.ohmap then
    --wilderness rooms always have 6 digits for x and y, but can have
    --1, 2, or theoretically 3 digits for their chunk number
    chunk,x,y = string.match(num, "(.?.?.)(...)(...)")
    --4 chunks per row, so let's change the chunk number into a chunk position instead
    chunkx = chunk%4
    chunky = math.ceil(chunk/4)
    --set an actual x/y grid position based on our chunk and our current x/y
    posx = (chunkx-1)*250 + x 
    posy = ((chunky-1)*250 + y)*-1 --invert our y so grid math works right,
                                   --because Achaea y pos is top to bottom
  end
  return posx, posy, chunkx, chunky, x*1, y*1
end

local firstSpace, secondSpace = 25,30 </script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Wilderness Walking Brains</name>
											<packageName></packageName>
											<script>function travelTo(where,dash) -- Tries to get where we are going. Does a decent job.
  local dash = dash or ""
  local dir, num = directionsTo(where:lower())
  if dir == false then
    return false
  elseif dir == "enter" then
    send("enter",false)
  end
  num = num or ""
  dir = closestDir(dir)
  send(dash .. " " .. dir .. " " .. num,false)
end

function closestDir(dir) -- gives us the closest dir in case of impassable exits
  local rexits = gmcp.Room.Info.exits
  if (rexits[translateDir[dir]] or dir == "enter") then return dir end
  local dir = translateDir[dir]
  local compass = {"n","ne","e","se","s","sw","w","nw"}
  local translateDir = {
    north = "n", northeast = "ne", east = "e", southeast = "se", 
    south = "s", southwest = "sw", west = "w", northwest = "nw" } 
  local untranslateDir = { 
    nw = "northwest", w = "west", se = "southeast", s = "south",
    sw = "southwest", ne = "northeast", e = "east", n = "north" }
  local exit
  --populate possible exits
  local want = table.index_of(compass,dir)
  
  for i = 1,4 do
    local ccw, cw = 0,0
    --these circle past the respective ends to the next exit on the circle
    if want-i &lt; 1 then
      ccw = 8
    end
    if want+i &gt; 8 then
      cw = 8
    end
    -- check if the exit exists, use it if it does
    exit = rexits[compass[want-i+ccw]] and compass[want-i+ccw]
    if exit then break end
    exit = rexits[compass[want+i-cw]] and compass[want+i-cw]
    if exit then break end 
  end
  
  return untranslateDir[exit]
  
end

function directionsTo(where)
  local going
  if wildernessExits[where] then
    going = wildernessExits[where]
  else
    echo("Don't know how to get there\n")
    return false
  end
  local x,y = translateWilderness()
  local riseDist,runDist
  riseDist = going.y-y
  runDist = going.x-x
  local rise,run = riserun(riseDist,runDist)
  riseDist = math.abs(riseDist)
  runDist = math.abs(runDist)
  currentHead = math.max(riseDist,runDist)
  local directionToGo = ""
  --More precise directional code
  if rise == 0 then
      if run &gt; 0 then -- directly east or west of us (or at us)
        directionToGo = "east"
      elseif run &lt; 0 then
        directionToGo = "west"
	  else
	    return "enter"
      end
  elseif run == 0 then
      if rise &gt; 0 then --directly north or south of us
        directionToGo = "north"
      elseif rise &lt; 0 then
        directionToGo = "south"
	else
	  cecho("&lt;red&gt;UNTRAPPED DIRECTION run 0")
      end
  -- if it's negative, it's southeast or northwest
  elseif rise/run &lt; -2 then -- at an angle, but a steep one
    if rise &lt; 0 then
      directionToGo = "south" -- south-southeast
    elseif run &lt; 0 then
      directionToGo = "north" -- north-northwest
	else
	  cecho("&lt;red&gt;UNTRAPPED DIRECTION &lt; -2")
    end
  elseif rise/run &lt; -0.5 then -- at a normal angle
    if rise &lt; 0 then
      directionToGo = "southeast"
    elseif run &lt; 0 then
      directionToGo = "northwest"
	else
	  cecho("&lt;red&gt;UNTRAPPED DIRECTION &lt; -0.5")
    end
  elseif rise/run &lt; 0 then -- at an angle, but a shallow one
      if rise &lt; 0 then
      directionToGo = "east" -- east-southeast
    elseif run &lt; 0 then
      directionToGo = "west" -- west-northwest
	else
	  cecho("&lt;red&gt;UNTRAPPED DIRECTION &lt; 0")
    end
  -- if it's positive, it's southwest or northeast
  elseif rise/run &gt; 2 then -- steep angle
    if rise &lt; 0 then
      directionToGo = "south" -- south-southwest
    elseif rise &gt; 0 then
      directionToGo = "north" -- north-northeast
	else
	  cecho("&lt;red&gt;UNTRAPPED DIRECTION &gt; 2")
    end  
  elseif rise/run &gt; 0.5 then -- normal angle
    if rise &lt; 0 then
      directionToGo = "southwest"
    elseif rise &gt; 0 then
      directionToGo = "northeast"
	else
	  cecho("&lt;red&gt;UNTRAPPED DIRECTION &gt; 0.5")
    end  
  elseif rise/run &gt; 0 then -- shallow angle
    if rise &lt; 0 then
      directionToGo = "west" -- west-southwest
    elseif rise &gt; 0 then
      directionToGo = "east" -- east-northeast
	else
	  cecho("&lt;red&gt;UNTRAPPED DIRECTION &gt; 0")
    end  
  else
    cecho("&lt;red&gt;UNTRAPPED DIRECTION")
  end
  --[[ old directional code
  --north south
  if y &lt; going.y then
    directionToGo = directionToGo .. "north"
  elseif y &gt; going.y then
    directionToGo = directionToGo .. "south"
  end
  --east west
  if x &gt; going.x then
    directionToGo = directionToGo .. "west"
  elseif x &lt; going.x then
    directionToGo = directionToGo .. "east"
  end  --]]
  return directionToGo, currentHead
end
</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Wilderness Exits</name>
											<packageName></packageName>
											<script>wildernessExits = wildernessExits or {
aaleneast =                {name="The Aalen Forest (east)",       x = 427,  y = -700},
aalennorth =               {name="The Aalen Forest (north)",      x = 383,  y = -656},
aalensouth =               {name="The Aalen Forest (south)",      x = 401,  y = -750},
aalenwest =                {name="The Aalen Forest (west)",       x = 372,  y = -710},
aranriod =                 {name="The Village of Aran'riod",      x = 419,  y = -315},
ashtan =                   {name="Ashtan",                        x = 373,  y = -518},
baltoackeast =             {name="Bataoac, the Northern Giant (right leg)",x = 365,  y = -186},
baltoacwest =              {name="Bataoac, the Northern Giant (left leg)",x = 361,  y = -186},
cormorantrock =            {name="Cormorant Rock",                x = 396,  y = -486},
cyrene =                   {name="Cyrene",                        x = 475,  y = -782},
dardanicplainseast =       {name="Dardanic Plains (east)",        x = 520,  y = -405},
dardanicplainsnorth =      {name="Dardanic Plains (north)",       x = 450,  y = -420},
dardanicplainssouth =      {name="Dardanic Plains (south)",       x = 513,  y = -448},
dardanicplainssoutheast =  {name="Dardanic Plains (southeast)",   x = 560,  y = -451},
dardanicplainssouthwest =  {name="Dardanic Plains (southwest)",   x = 497,  y = -456},
dardanicplainswest =       {name="Dardanic Plains (west)",        x = 423,  y = -421},
deloseast =                {name="Delos (east)",                  x = 617,  y = -629},
deloswest =                {name="Delos (west)",                  x = 612,  y = -629},
digsiteblood =             {name="The Digsite of Blood",          x = 522,  y = -797},
digsiteequilibrium =       {name="The Digsite of Equilibrium",    x = 615,  y = -463},
digsitemind =              {name="The Digsite of the Mind",       x = 438,  y = -503},
digsitepain =              {name="Digsite of Pain",               x = 340,  y = -686},
digsitesoul =              {name="Digsite of the Soul",           x = 568,  y = -147},
digsitewealth =            {name="The Digsite of Wealth",         x = 498,  y = -864},
dreamspear =               {name="Dreamspear",                    x = 268,  y = -290},
eleusis =                  {name="Eleusis",                       x = 620,  y = -605},
falaqtor =                 {name="The Tower of Falaq'tor",        x = 575,  y = -152},
fissure =                  {name="The Fissure of Echoes",         x = 557,  y = -198},
harae =                    {name="The Isle of Harae",             x = 283,  y = -619},
hashan =                   {name="Hashan",                        x = 642,  y = -511},
hriddan =                  {name="Hriddan Settlement",            x = 278,  y = -202},
hthrak =                   {name="Vents of Hthrak",               x = 422,  y = -168},
inbhirness =               {name="Inbhir Ness",                   x = 262,  y = -331},
isaia =                    {name="Isaia",                         x = 263,  y = -189},
istareast =                {name="Istar Jungle (east)",           x = 458,  y = -191},
istarwest =                {name="Istar Jungle (west)",           x = 438,  y = -204},
kamleikan =                {name="The Village of Kamleikan",      x = 387,  y = -278},
mhaldor =                  {name="Mhaldor Harbour",               x = 218,  y = -568},
moghedu =                  {name="Moghedu",                       x = 528,  y = -771},
muurn =                    {name="Muurn River Valley Harbour",    x = 394,  y = -772},
newhope =                  {name="Isle of New Hope",              x = 623,  y = -818},
nithmia =                  {name="The Northern Ithmia",           x = 603,  y = -561},
northerntundra =           {name="Northern Tundra",               x = 356,  y = -147},
northreacheast =           {name="Northreach (east)",             x = 434,  y = -327},
northreachharbour =        {name="Northreach Forest Harbour",     x = 410,  y = -426},
northreachlake =           {name="Northreach Lake",               x = 465,  y = -326},
northreachnorth =          {name="Northreach (north)",            x = 403,  y = -334},
northreachwest =           {name="Northreach (west)",             x = 380,  y = -352},
phereklos =                {name="The ruins of Phereklos",        x = 387,  y = -370},
rheodad =                  {name="Rheodad",                       x = 268,  y = -372},
rheodadharbour =           {name="Rheodad Harbour",               x = 243,  y = -444},
riagath =                  {name="The Caverns of Riagath",        x = 409,  y = -221},
ripariumharbour =          {name="Riparium Harbour",              x = 717,  y = -622},
saoghal =                  {name="Saoghal Valley",                x = 248,  y = -311},
sealioncove =              {name="Sea Lion Cove",                 x = 514,  y = -842},
shallam =                  {name="Shallam",                       x = 642,  y = -758},
shallamharbour =           {name="The Harbour of Shallam",        x = 641,  y = -762},
shastaan =                 {name="Shastaan",                      x = 696,  y = -719},
shastaanharbour =          {name="Shastaan Harbour",              x = 705,  y = -717},
tasurke =                  {name="Tasur'ke",                      x = 684,  y = -504},
tasurkeharbour =           {name="Tasur'ke Harbour",              x = 685,  y = -500},
tasurkehouse =             {name="A private house in Tasur'ke",   x = 680,  y = -484},
tenwat =                   {name="Tenwat Prison",                 x = 556,  y = -277},
thera =                    {name="New Thera",                     x = 387,  y = -560},
thraasi =                  {name="Thraasi Harbour",               x = 326,  y = -652},
tomacula =                 {name="The Village of Tomacula",       x = 490,  y = -601},
valho =                    {name="Valho Coast",                   x = 640,  y = -211},
wegava =                   {name="Wegava Valley",                 x = 485,  y = -299},
} </script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Wilderness Exit Utilities</name>
											<packageName></packageName>
											<script>local firstSpace, secondSpace = 25,30 

function makeWildExit(name,fullname,num)
  local first,second = firstSpace,secondSpace
  local blank1 = string.rep(" ", first-#name)
  local blank2 = string.rep(" ", second-#fullname)
  local x,y = translateWilderness(num)
  local s1 = string.rep(" ", 5-#(""..x))
--  echo(string.format([[%s =%s{name="%s",%sx = %s,%sy = %s},]].."\n",name:lower(),blank1,fullname,blank2,x,s1,y))
  wildernessExits[name] = {name = fullname, x = x, y = y}
  reDrawWildernessExitTable()
end

function reDrawWildernessExitTable()
  -- Just used for pretifying the table, makes it easier to change spacing and such.
  local first,second = firstSpace,secondSpace
  echo "wildernessExits = wildernessExits or {\n"
  for k,v in pairsByKeys(wildernessExits) do
    local name, fullname = k, v.name 
    local x,y = v.x,v.y
    local blank1 = string.rep(" ", first-#name)
    local blank2 = string.rep(" ", second-#fullname)
    local s1 = string.rep(" ", 5-#(""..x))
    echo(string.format([[%s =%s{name="%s",%sx = %s,%sy = %s},]].."\n",name,blank1,fullname,blank2,x,s1,y))
  end
  echo("} \n \n ")
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>rise and run</name>
											<packageName></packageName>
											<script>local function gcd(a, b)
    repeat
        if a == 0 or b == 0 then return 0 end
        a, b = b, a % b
    until b == 0
    return a
end

function riserun(numerator, denominator)
    local conumerator = 1
    local codenominator = 1

    if numerator &lt; 0 then
        conumerator = -1
        numerator = -numerator
    end

    if denominator&lt; 0 then
        codenominator = -1
        denominator= -denominator
    end
    local n = gcd(numerator, denominator)
    -- don't do div/0 math
    if numerator ~= 0 then numerator = numerator/n end
    if denominator ~= 0 then denominator = denominator/n end
    -- if 1 is 0 then the rise or run of the other is 1
    if (numerator == 0 or denominator == 0) and not (numerator == 0 and denominator == 0) then
      if numerator == 0 then denominator = 1 end
      if denominator == 0 then numerator = 1 end
      
    end

    return conumerator * numerator, codenominator * denominator
end
</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>Foray Exits</name>
											<packageName></packageName>
											<script>forayExits = {
arankesh = { jaru = {x = 478, y = -287}, 
 },
mirrortower = {
tenwat = {},
morindar = {},
phereklos = {},
shamtota = {},
},
sevet = {
shalakhulia = {}
},


}
</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>pairsByKeys</name>
											<packageName></packageName>
											<script>function pairsByKeys(t, f)
  local a = {}
  for n in pairs(t) do
    table.insert(a, n)
  end
  table.sort(a, f)
  local i = 0
  -- iterator variable
  local iter =
    function()
      -- iterator function
      i = i + 1
      if a[i] == nil then
        return nil
      else
        return a[i], t[a[i]]
      end
    end
  return iter
end</script>
											<eventHandlerList />
										</Script>
										<Script isActive="yes" isFolder="no">
											<name>New script</name>
											<packageName></packageName>
											<script>
wildernessLocations["riagath"] = {["x"] = 409, ["y"] = 221, ["vnum"] = 2159221}
 
wildernessLocations["northreachnorth"] = {["x"] = 434, ["y"] = 327, ["vnum"] = 6153084}
wildernessLocations["northreachwest"] = {["x"] = 403, ["y"] = 334, ["vnum"] = 6184077}
wildernessLocations["northreachwestwest"] = {["x"] = 380, ["y"] = 352, ["vnum"] = 6130102}
 
--wildernessLocations["northreachwest"] = {["x"] = 434, ["y"] = 327}
--wildernessLocations["northreachnorth"] = {["x"] = 403, ["y"] = 334, ["vnum"] = 6184077}
wildernessLocations["aran'riod"]  = {["x"] = 419, ["y"] = 315, ["vnum"] = 6169065}
wildernessLocations["morindar"]   = {["x"] = 470, ["y"] = 260, ["vnum"] = 6220010}
wildernessLocations["fissure"]    = {["x"] = 557, ["y"] = 198, ["vnum"] = 3057198}
wildernessLocations["wegava"]     = {["x"] = 485, ["y"] = 299, ["vnum"] = 6235049}
wildernessLocations["saoghal"]    = {["x"] = 248, ["y"] = 311, ["vnum"] = 5248061}
wildernessLocations["dreamspear"] = {["x"] = 268, ["y"] = 290, ["vnum"] = 6018040}
wildernessLocations["pash"] =       {["x"] = 642, ["y"] = 758, ["vnum"] = 15142008}
wildernessLocations["rheodad"] =    {["x"] = 268, ["y"] = 372, ["vnum"] = 6018122}
wildernessLocations["moghedu"] =    {["x"] = 528, ["y"] = 771, ["vnum"] = 15028021}
wildernessLocations["dunvalley"] =  {["x"] = 437, ["y"] = 678, ["vnum"] = 10187178}
wildernessLocations["aalenforesteast"] = {["x"] = 427, ["y"] = 700, ["vnum"] = 10177200}
wildernessLocations["aalenforestwest"] = {["x"] = 372, ["y"] = 710, ["vnum"] = 10122210}
wildernessLocations["aalenforestnorth"] = {["x"] = 383, ["y"] = 656, ["vnum"] = 10133156}
wildernessLocations["easternithmia"] = {["x"] = 620, ["y"] = 605, ["vnum"] = 11120105}
 
--harbours
wildernessLocations["phereklos"] =  {["x"] = 387, ["y"] = 370, ["vnum"] = 6137120}
 
--digsites
wildernessLocations["digsitesoul"] = {["x"] = 568, ["y"] = 147, ["vnum"] = 3068147}  -- Northern Tip of Glacier north of Fissure
wildernessLocations["digsiterage"] = {["x"] = 527, ["y"] = 740, ["vnum"] = 11027240}  -- Middle of Mhojave
 
--Other
wildernessLocations["tenwat"] = {["x"] = 556, ["y"] = 277, ["vnum"] = 7056027}
 
--Harbours
wildernessLocations["valhoharbour"] = {["x"] = 640, ["y"] = 211, ["vnum"] = 3140211}</script>
											<eventHandlerList />
										</Script>
									</ScriptGroup>
								</ScriptGroup>
							</ScriptGroup>
							<ScriptGroup isActive="yes" isFolder="yes">
								<name>Algedonic Defense 1.0</name>
								<packageName></packageName>
								<script>--Algedonic.AffCount = Algedonic.Count_My_affs()  
--Algedonic.Stack_My_Affs(false, aff)
--Algedonic.Prioritize()

-- Add the above to the functions gotAff() and lostAff() at the bottom.  Add only the FIRST line to afflictionList() at the end



Algedonic = Algedonic or {}

Algedonic.whatcures = {
    ["kelp"] = {"asthma", "clumsiness", "hypochondria", "sensitivity", "weariness", "healthleech", "parasite", "rebbies"},
    ["lobelia"] = {"agoraphobia", "guilt", "spiritburn", "tenderskin", "claustrophobia", "loneliness", "masochism", "recklessness", "vertigo"},
    ["ash"] = {"confusion", "dementia", "hallucinations", "hypersomnia", "paranoia"},
    ["bellwort"] = {"retribution","timeloop", "peace","justice","lovers","generosity","dminished"},
    ["goldenseal"] = {"dizziness", "epilepsy", "impatience", "shyness", "stupidity", "depression", "shadowmadness", "mycalium", "sandfever", "horror", "fulminated",},
    ["bloodroot"] = {"paralysis", "slickness", "pyramides"},
    ["ginseng"] = {"addiction", "darkshade", "haemophilia", "lethargy", "nausea", "scytherus", "flushings"},
    ["pear"] = {"pressure"},
  }

  Algedonic.mystack = Algedonic.mystack or {
    ["kelp"] = 0,
    ["lobelia"] = 0,
    ["ash"] = 0,
    ["bellwort"] = 0,
    ["goldenseal"] = 0,
    ["bloodroot"] = 0,
    ["ginseng"] = 0,
  }

  Algedonic.AffCount = Algedonic.AffCount or 0

function Algedonic.Stack_My_Affs(adding, aff)
    local stack = "default"
    for i, j in pairs(Algedonic.whatcures) do 
      if table.contains(j, aff) then
        stack = i
        break
      end
    end
    if stack == "default" then return end
    if adding == true then
      Algedonic.mystack[stack] = Algedonic.mystack[stack] + 1
    else
      Algedonic.mystack[stack] = Algedonic.mystack[stack] - 1
    end
  end

  function Algedonic.Echo(thing)
    cecho("\n&lt;ansi_light_cyan&gt;[Levi]: &lt;white&gt;"..thing)
end

function Algedonic.Prioritize()
    local targetclass = ataxiaNDB_getClass(target)
    if targetclass == "Apostate" then
        Algedonic.AntiApostate()
    elseif targetclass == "Alchemist" then
        Algedonic.AntiAlchemist()
    elseif targetclass == "Bard" then
        Algedonic.AntiBard()
    elseif targetclass == "Blademaster" then
        Algedonic.Blademaster()
    elseif targetclass == "Serpent" then
        Algedonic.AntiSerpent()
    elseif targetclass == "Shaman" then
        Algedonic.AntiShaman()
    elseif targetclass == "Magi" then
        Algedonic.AntiMagi()
    elseif targetclass == "Sylvan" then
        Algedonic.AntiSylvan()
    elseif targetclass == "Unnameable" then
        Algedonic.AntiUnnameable()
    elseif targetclass == "Psion" then
        Algedonic.AntiPsion()
    elseif targetclass == "Priest" then
        Algedonic.AntiPriest()
    elseif targetclass == "Sentinel" then
        Algedonic.AntiSentinel()
    elseif targetclass == "Pariah" then
        Algedonic.AntiPariah()
    elseif targetclass == "Occultist" then
      Algedonic.AntiOccultist()
    elseif targetclass == "Druid" then
        Algedonic.AntiDruid()
    elseif targetclass == "Depthswalker" then
        Algedonic.AntiDepthswalker()
    elseif targetclass == "Airlord" then
        Algedonic.AntiAirlord()
    elseif targetclass == "Waterlord" then
        Algedonic.AntiWaterlord()
    elseif targetclass == "Firelord" then
        Algedonic.AntiFirelord()
    end
end

function Algedonic.ClassSwap()
    local targetclass = ataxiaNDB_getClass(target)
    if targetclass == "Apostate" then
        Algedonic.ApostateSwap()
    elseif targetclass == "Alchemist" then
        Algedonic.AlchemistSwap()
    elseif targetclass == "Bard" then
        Algedonic.AntiBard()    
    elseif targetclass == "Blademaster" then
        Algedonic.Blademaster()
    elseif targetclass == "Depthswalker" then
        Algedonic.Depthswalker() 
    elseif targetclass == "Pariah" then
        Algedonic.AntiPariah()    
    --etc
    end
end

function Algedonic.Count_My_Affs()
    local count = 0
    for _, v in pairs(ataxia.afflictions) do
        if v then
            count = count + 1
        end
    end
    return count
end</script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>Anti Priorities</name>
									<packageName></packageName>
									<script>--These are just examples, some are good, some are bad!

function Algedonic.AntiAirlord()
   if ataxia.afflictions.pressure ~= nil then
    if ataxia.afflictions.pressure &gt;= 3 then
      send("curing prioaff pressure")
    end
   end
end
function Algedonic.AntiAlchemist()
  if ataxia.afflictions.temperedsanguine ~= nil and ataxia.afflictions.temperedsanguine &gt;= 5 then
  Algedonic.Echo("Clearing free &lt;red&gt;YOU SHOULD RUN BEFORE BLEEDING INTO AURIFY&lt;white&gt;.")
  elseif ataxia.afflictions.temperedphlegmatic &gt;= 6 and ataxia.afflictions.impatience then
    Algedonic.Echo("Clearing free &lt;red&gt;YOUR ABOUT TO GET LOCKED - WEARINESS LETHARGY ANOREXIA SLICKNESS INCOMMING &lt;white&gt;.")
    send("curing prioaff impatience")
  elseif ataxia.afflictions.temperedphlegmatic &gt;= 6 and not ataxia.afflictions.impatience and ataxia.afflictions.asthma then
    send("curing prioaff asthma")
  elseif not ataxia.afflictions.paralysis then
    if Algedonic.mystack["goldenseal"] == 1 and ataxia.afflictions.impatience then
      send("curing prioaff impatience")
    elseif Algedonic.mystack["goldenseal"] &gt;= 2 and ataxia.afflictions.impatience and ataxia.afflictions.asthma then
      send("curing prioaff asthma")
    elseif ataxia.afflictions.slickness and ataxia.afflictions.asthma then
      send("curing prioaff asthma")
    end
  end
    --Your conditions here
    --Temperedphlegmatic.
--2 for lethargy, 4 adds anorexia, 6 adds slick, 8 adds weary


end

function Algedonic.AntiApostate()
  
  --Fitness Classes
  local myclass = ataxiaTemp.class
      if ataxia.afflictions.impatience and ataxia.afflictions.paralysis and ataxia.afflictions.anorexia and ataxia.afflictions.slickness and not ataxia.afflictions.asthma then
        send("curing prioaff impatience")
        send("curseward")
      elseif Algedonic.mystack["kelp"] &gt;= 3 and ataxia.afflictions.asthma and not ataxia.afflictions.paralysis then
        Algedonic.Echo("Digging for &lt;green&gt;asthma&lt;white&gt;! Be ready to hit &lt;orange&gt;FITNESS!")
        send("curing prioaff asthma")
      elseif ataxia.afflictions.asthma and ataxia.afflictions.manaleech then
        send("curing prioaff asthma")  
        
      end
    

end
function Algedonic.AntiBard()
      if ataxia.afflictions.crescendo &gt;= 4 then
      send("curing prioaff crescendo")
      end
end


function Algedonic.Blademaster()
end

function Algedonic.AntiDruid()
    --Your conditions here
end
function Algedonic.AntiDepthswalker()

  if ataxia.afflictions.timeloop and not ataxia.afflictions.paralysis then
    send("curing prioaff timeloop")
  elseif ataxia.afflictions.timeloop and ataxia.afflictions.paralysis then
    send("curing prioaff paralysis")
  elseif ataxia.afflictions.hypochondria and not ataxia.afflictions.paralysis then
    send("curing prioaff hypochondria")
  elseif ataxia.afflictions.depression and not ataxia.afflictions.timeloop and not ataxia.afflictions.hypochondria then
    send("curing prioaff depression")

  end
end

function Algedonic.AntiMagi()
  if ataxia.afflictions.fulminated and ataxia.afflictions.slickness and not ataxia.afflictions.anorexia then
    send("focus")
  elseif ataxia.afflictions.fulminated and not ataxia.afflictions.paralysis and not ataxia.afflictions.asthma then
    send("curing prioaff fulminated")
  elseif ataxia.afflictions.fulminated and ataxia.afflictions.paralysis and Algedonic.mystack["goldenseal"] &gt;= 1 then
    send("focus")
  elseif ataxia.afflictions.asthma and not ataxia.afflictions.paralysis then
    send("curing prioaff asthma")
  elseif not ataxia.afflictions.asthma and not ataxia.afflictions.paralysis and ataxia.afflictions.healthleech then
    send("curing prioaff healthleech")
  end
    --Your conditions here
end
  
function Algedonic.AntiPariah()
--Haemo&gt;flushings&gt;Pyramides &gt; sandfever &gt;  &gt; rebbies &gt; mycalium  
  --Stop Lock?-- Lock Is Pyramides/Flushings/Rebbies then they will Sting Sandfever (Impatience)/Trace Jackel for Asthma
  --So generally, it will go swarm latency/scorpion(scytherus), next balance sting(prob pyramides if you don't have it)/serpent(para/voyria this balance)/ blood accelerate, next balance blood accelerate
  if ataxia.afflictions.voyria then
    stoplatency = true
  elseif ataxia.afflictions.pyramides and ataxia.afflictions.flushings and ataxia.afflictions.rebbies then
    if Algedonic.mystack["kelp"] &lt;= 1 then
      send("curing prioaff rebbies")
    elseif Algedonic.mystack["ginseng"] &lt;= 1 then
      send("curing prioaff flushings")
    else
      send("curing prioaff pyramides")
    end
  elseif ataxia.afflictions.sandfever and ataxia.afflictions.asthma then
    send("curing prioaff sandfever")
  --Stop Scourge Kill - Needs Pramides, Scytherus, Haemophilia and Bleed &gt;= 200
  elseif ataxia.vitals.bleed &gt;= 190 and ataxia.afflictions.haemophilia then
    -- Put this in the combatQueue() function that if this is true then shield
    stopscourge = true
    --Need to shield and cure ginseng
    send("curing queue insert 1 ginseng")
    
  elseif ataxia.afflictions.pyramides and ataxia.afflictions.haemophilia and ataxia.vitals.bleed &gt; 140 then
      send("curing prioaff haemophilia")
  --Stop Voyria Kill YOU HAVE TO RUN AT 3 PLAGUES
  elseif not ataxia.afflictions.paralysis and not ataxia.afflictions.haemophilia and ataxia.afflictions.scytherus then
    send("curing prioaff scytherus")
  
  end
end

function Algedonic.AntiPsion()

if ataxia.afflictions.unweavingbody ~= nil and ataxia.afflictions.unweavingmind ~= nil then
  if ataxia.afflictions.unweavingbody &gt;= 2 and ataxia.afflictions.unweavingmind &lt; 2 then
    send("curing prioaff unweavingbody")
  elseif ataxia.afflictions.unweavingbody &lt; 2 and ataxia.afflictions.unweavingmind &gt; 2 then
    send("curing prioaff unweavingmind")
  end
elseif ataxia.afflictions.unweavingspirit ~= nil then
  if ataxia.afflictions.unweavingspirit &gt;= 2 and ataxia.afflictions.asthma then
  send("curing prioaff asthma")
  end
end

end

function Algedonic.AntiSentinel()
if ataxia.afflictions.slickness and ataxia.afflictions.paralysis and not ataxia.afflictions.asthma then
  send("endure")
  send("curing prioaff paralysis")
elseif tAffs.prone then
  if ataxia.afflictions.asthma and Algedonic.mystack["kelp"] &gt;= 3 then
    send("curing prioaff asthma")
  elseif ataxia.afflictions.impatience then
    send("curing prioaff impatience")
  end
--Prevent Getting Asthma from Badger
elseif ataxia.vitals.bleed &gt;= 150 then
    send("curing prioaff haemophilia")
end

if ataxia.afflictions.damagedleftarm or ataxia.afflictions.damagedrightarm and not ataxia.afflictions.prone then
    expandAlias("goto 11090")
    preventriftlock = true
    
    ataxia_boxEcho("TOUCH SHIELD TOUCH SHIELD - RIFT LOCK - RIFT LOCK -", "a_darkred")
end
end


function Algedonic.AntiSerpent()
    --Fitness Classes
local myclass = ataxiaTemp.class

      if ataxia.afflictions.prone and ataxia.afflictions.paralysis and ataxia.afflictions.slickness then
        send("endure")
        send("curing prioaff paralysis")
      elseif ataxia.afflictions.asthma and ataxia.afflictions.impatience and ataxia.afflictions.slickness and ataxia.afflictions.anorexia then
        send("touch tree")
      elseif ataxia.afflictions.impatience then
        Algedonic.Echo("Clearing free &lt;gold&gt;impatience &lt;white&gt;stack.")
        send("curing prioaff impatience")
      end
   


end


function Algedonic.AntiShaman()
local myclass = ataxiaTemp.class
    --Prevent Tza Instant Kill
  if Algedonic.mystack["goldenseal"] &gt;= 3 and not ataxia.afflictions.paralysis then
      if ataxia.afflictions.impatience then
          send("curing prioaff impatience")
   
      elseif not ataxia.afflictions.impatience and ataxia.afflictions.stupidity then
          send("curing prioaff stupidity")
      elseif not ataxia.afflictions.impatience and not ataxia.afflictions.stupidity and ataxia.afflictions.dizziness then
          send("curing prioaff dizziness")
      end
  elseif ataxia.afflictions.impatience and ataxia.afflictions.stupidity and ataxia.afflictions.dizziness and ataxia.afflictions.epilepsy then
    send("curing prioaff impatience")
  elseif ataxia.afflictions.impatience and ataxia.afflictions.stupidity and ataxia.afflictions.dizziness or ataxia.afflictions.epilepsy then
    send("curing prioaff impatience")  
  -- Prevent Lock
  elseif Algedonic.mystack["kelp"] &gt;= 3 and ataxia.afflictions.asthma and not ataxia.afflictions.impatience and not ataxia.afflictions.paralysis then
        send("curing prioaff asthma")
 
  
  
    
  elseif ataxia.afflictions.asthma and ataxia.afflictions.impatience and not ataxia.afflictions.paralysis then
        send("curing prioaff impatience")
  -- Prevent Coag if we can
  elseif ataxia.afflictions.haemophilia and ataxia.vitals.bleed &gt; 100 and not ataxia.afflictions.paralysis then
        send("curing prioaff haemophilia")
    
  end

end


function Algedonic.AntiSylvan()

ataxiaTemp.heartseedMode = true
--Algedonic.Echo("&lt;gold&gt;Sylvan Heartseed Mode is ON &lt;white&gt;.")

end


function Algedonic.AntiUnnameable()
if ataxia.afflictions.damageleftleg or ataxia.afflictions.damagedrightleg or ataxia.afflictions.damagedleftarm or ataxia.afflictions.damagedrightarm or ataxia.afflictions.damagedhead then  
  if ataxia.afflictions.horror == 5 then
  send("curing prioaff horror (5)")
  elseif ataxia.afflictions.horror == 4 then
  send("curing prioaff horror (4)")
    end
  end
end

function Algedonic.AntiPriest()
--Cure Guilty Tenderskin and Spiritburn over everything

--If they inflict Paralysis you will be slow down but they won't win either...
if ataxia.afflictions.guilt then
  send("curing prioaff guilt")
elseif ataxia.afflictions.tenderskin then
  send("curing prioaff tenderskin")
elseif ataxia.afflictions.spiritburn then
  send("curing prioaff spiritburn")
end

end

function Algedonic.AntiOccultist()
  if ataxia.afflictions.asthma and ataxia.afflictions.aeon then
    send("curing prioaff asthma")
  elseif ataxia.afflictions.asthma and not ataxia.afflictions.paralysis then
    send("curing prioaff asthma")
  elseif not ataxia.afflictions.asthma and not ataxia.afflictions.paralysis and ataxia.afflictions.whisperingmadness then
    send("curing prioaff whisperingmadness")
  end
end
   
</script>
									<eventHandlerList />
								</Script>
							</ScriptGroup>
							<ScriptGroup isActive="yes" isFolder="yes">
								<name>slc</name>
								<packageName></packageName>
								<script></script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>functions</name>
									<packageName></packageName>
									<script>registerAnonymousEventHandler("gmcp.Char.Vitals","slc_displayLC")

slc_displayLC = function()

if not slc.percentages then slc_init() end 

   	local head_color = "&lt;green&gt;"     
  	local left_leg = "&lt;green&gt;"
  	local right_leg = "&lt;green&gt;"
  	local left_arm = "&lt;green&gt;"
  	local right_arm = "&lt;green&gt;"
  	local torso_color = "&lt;green&gt;"
  	                      
  	for x, y in ipairs({"left arm","right arm","left leg","right leg","head","torso"}) do
  		if y == "head" then
    		if     slc.percentages[y] &gt;= 75 then head_color = "&lt;red&gt;"
    		elseif slc.percentages[y] &gt;= 66 then head_color = "&lt;orange&gt;"
    		elseif slc.percentages[y] &gt;= 33 then head_color = "&lt;yellow&gt;"
  			end
    	end
  		if y == "left leg" then
    		if     slc.percentages[y] &gt;= 75 then left_leg = "&lt;red&gt;"
    		elseif slc.percentages[y] &gt;= 66 then left_leg = "&lt;orange&gt;"
    		elseif slc.percentages[y] &gt;= 33 then left_leg = "&lt;yellow&gt;"
    		end
  		end
  		if y == "right leg" then
    		if     slc.percentages[y] &gt;= 75 then right_leg = "&lt;red&gt;"
    		elseif slc.percentages[y] &gt;= 66 then right_leg = "&lt;orange&gt;"
    		elseif slc.percentages[y] &gt;= 33 then right_leg = "&lt;yellow&gt;"
    		end
  		end
  		if y == "left arm" then
    		if     slc.percentages[y] &gt;= 75 then left_arm = "&lt;red&gt;"
    		elseif slc.percentages[y] &gt;= 66 then left_arm = "&lt;orange&gt;"
    		elseif slc.percentages[y] &gt;= 33 then left_arm = "&lt;yellow&gt;"
    		end
  		end
  		if y == "right arm" then
    		if     slc.percentages[y] &gt;= 75 then right_arm = "&lt;red&gt;"
    		elseif slc.percentages[y] &gt;= 66 then right_arm = "&lt;orange&gt;"
    		elseif slc.percentages[y] &gt;= 33 then right_arm = "&lt;yellow&gt;"
    		end
  		end
  		if y == "torso" then
    		if     slc.percentages[y] &gt;= 75 then torso_color = "&lt;red&gt;"
    		elseif slc.percentages[y] &gt;= 66 then torso_color = "&lt;orange&gt;"
    		elseif slc.percentages[y] &gt;= 33 then torso_color = "&lt;yellow&gt;"
    		end
  		end										
  	end
  
	--clearUserWindow("slc_LimbcounterDisp")
  --cecho("slc_LimbcounterDisp", "&lt;white&gt;     &lt;green&gt;SLC&lt;white&gt;\n")
  --cecho("slc_LimbcounterDisp", "&lt;white&gt;      "..head_color..""..round(slc.percentages["head"]).."&lt;white&gt;")
  --cecho("slc_LimbcounterDisp","  &lt;gray&gt;      ^")
  --cecho("slc_LimbcounterDisp", "&lt;white&gt;  "..left_arm..""..round(slc.percentages["left arm"]).."&lt;white&gt; &lt;gray&gt;&lt; &lt;white&gt;"..torso_color..""..round(slc.percentages["torso"]).."&lt;white&gt; &lt;gray&gt;&gt; &lt;white&gt;"..right_arm..""..round(slc.percentages["right arm"]).."&lt;white&gt;") 
  --cecho("slc_LimbcounterDisp","&lt;gray&gt;    v   v")
  --cecho("slc_LimbcounterDisp","  &lt;white&gt; "..left_leg..""..round(slc.percentages["left leg"]).."&lt;white&gt;     "..right_leg..""..round(slc.percentages["right leg"]).."&lt;white&gt;")
  

end

function SLC_connects(limb,attack)
		slc_last_attack = attack

		if slc.attacks[attack] == nil then
			--cecho("&lt;red&gt;Error: &lt;white&gt; Bad input to SLC_Connects (attack) : "..attack..".  Using \"other\"")
			attack = "other"
		end
--==change: added attack_mod==--
        local attack_mod = 1.00
        if attack=="tekurakick" then
           attack="tekura"
        elseif attack == "legslash" or attack == "compassslash" or attack == "armslash" then
           attack_mod = slc_stance_mod()
        end
--------------------------------
		slc.hitcount[limb] = slc.hitcount[limb] + 1
		slc.percentages[limb] = slc.percentages[limb] + 100/slc.attacks[attack]
		
--==Change: Added last_attack and attack modifiers==--
		    if slc.last_attack == "tekurakick" then
                slc.hitcount[limb] = slc.hitcount[limb] + .334
                slc.percentages[limb] = slc.percentages[limb] + (100/slc.attacks[attack])/3
        end
        if attack == "legslash" then
                if limb == "right leg" then    
                        slc.hitcount["left leg"] = slc.hitcount["left leg"] + slc.bm_ratio * attack_mod
                        slc.percentages["left leg"] = slc.percentages["left leg"] + 100/slc.attacks[attack]*slc.bm_ratio * attack_mod
                else
                        slc.hitcount["right leg"] = slc.hitcount["right leg"] + (slc.bm_ratio * attack_mod)
                        slc.percentages["right leg"] = slc.percentages["right leg"] + 100/slc.attacks[attack]*slc.bm_ratio * attack_mod
                end
        elseif attack == "armslash" then
                if limb == "right arm" then    
                        slc.hitcount["left arm"] = slc.hitcount["left arm"] + slc.bm_ratio * attack_mod
                        slc.percentages["left arm"] = slc.percentages["left arm"] + 100/slc.attacks[attack]*slc.bm_ratio * attack_mod
                else
                        slc.hitcount["right arm"] = slc.hitcount["right arm"] + slc.bm_ratio * attack_mod
                        slc.percentages["right arm"] = slc.percentages["right arm"] + 100/slc.attacks[attack]*slc.bm_ratio * attack_mod
                end
        elseif attack == "centreslash" then
                if limb == "torso" then
                        slc.hitcount["head"] = slc.hitcount["head"] + slc.bm_ratio * attack_mod
                        slc.percentages["head"] = slc.percentages["head"] + 100/slc.attacks[attack]*slc.bm_ratio * attack_mod
                else
                        slc.hitcount["torso"] = slc.hitcount["torso"] + slc.bm_ratio * attack_mod
                        slc.percentages["torso"] = slc.percentages["torso"] + 100/slc.attacks[attack]*slc.bm_ratio * attack_mod
                end
        end
--------------------------------------------------------
		local limb_color = "white:black"
		if     slc.hitcount[limb] &gt;= slc.attacks[attack]-1 then limb_color = "white:red"
		elseif slc.percentages[limb] &gt;= 66 then limb_color = "orange"
		elseif slc.percentages[limb] &gt;= 33 then limb_color = "yellow"
		end

		--slc_evaluate()
		--SLC_display()
end

--==change: added stance and stance_mod==--
slc_stance = function(stance)
        if slc.bm_stance ~= stance then
                local old = slc.bm_stance
                slc.bm_stance = stance
              --  cecho("&lt;white&gt;BM stance changed from &lt;cyan&gt;"..old.." &lt;white&gt;to &lt;red&gt;"..stance.."&lt;white&gt;.")
        end
end
 
slc_stance_mod = function ()
        return slc.bm_stance_modifiers[slc.bm_stance]
end
-------------------------------------------

function slc_evaluate()



end

function SLC_broke(limb)
	slc.percentages[limb] = 100
	if slc.hitcount[limb] ~= slc.attacks[slc_last_attack] then
		slc.attacks[slc_last_attack] = slc.hitcount[limb]
		for x, y in ipairs({"left arm","right arm","left leg","right leg","head","torso"}) do
			slc.percentages[y] = slc.hitcount[y]*100/slc.attacks[slc_last_attack]
		end
	--	cecho("&lt;blue&gt;(&lt;white&gt;SLC&lt;blue&gt;) &lt;white&gt;"..slc_last_attack:upper().." hits needed to break set to "..slc.hitcount[limb]..".")
	--	cecho("&lt;blue&gt;(&lt;white&gt;SLC&lt;blue&gt;) &lt;white&gt;Limb percentages adjusted to reflect new count")
		--SLC_longdisplay()
	end
	--slc_evaluate()
end


function SLC_display()
	if slc.display == "short" then
		--cecho(""..SLC_shortdisplay())
	elseif slc.display == "long" then
		--cecho(""..SLC_longdisplay())
	end
		--	slc_displayLC()
end

function SLC_force_display()
	if slc.display == "short" then
		cecho("\n"..SLC_shortdisplay())
	else
		cecho("\n"..SLC_longdisplay())
	end
		--slc_displayLC()
end

function SLC_shortdisplay() -- RETURNS A STRING
	local out = "&lt;blue&gt;("
	
		for x, y in ipairs({"left arm","right arm","left leg","right leg","head","torso"}) do
		local limb_color = "white"
		if     slc.percentages[y] &gt;= 75 then limb_color = "red"
		elseif slc.percentages[y] &gt;= 66 then limb_color = "orange"
		elseif slc.percentages[y] &gt;= 33 then limb_color = "yellow"
		end
		out = out.." &lt;"..limb_color.."&gt;"..round(slc.percentages[y]).."%"
		if x == 2 or x == 4 then echo(" ") end
	end

	out = out.."&lt;blue&gt; )"

	return out
end

function SLC_longdisplay() -- RETURNS A STRING
	clearWindow("lCount.middle")
	--local out = "&lt;blue&gt;( "
	local out = "     "

	for x, y in ipairs({"left arm","right arm","left leg","right leg","head","torso"}) do
		if     x == 1 then out = out.."&lt;magenta&gt;["
		elseif x == 2 then out = out.."&lt;magenta&gt; | "
		elseif x == 3 then out = out.."&lt;magenta&gt; ]   &lt;yellow&gt;["
		elseif x == 4 then out = out.."&lt;yellow&gt; | "
		elseif x == 5 then out = out.."&lt;yellow&gt; ]   &lt;white&gt;["
		elseif x == 6 then out = out.."&lt;white&gt; ] &lt;green&gt; [\["
		end


		local limb_color = "white"
		if     slc.percentages[y] &gt;= 75 then limb_color = "red"
		elseif slc.percentages[y] &gt;= 66 then limb_color = "orange"
		elseif slc.percentages[y] &gt;= 33 then limb_color = "yellow"
		end

		out = out.." &lt;"..limb_color.."&gt;"..round(slc.percentages[y]).."%"
		
	end

	out = out.."&lt;green&gt; ]\]"

	--lCount.middle:cecho(out)
	cecho(out)
	return out

end

function SLC_blocked(line)
	if string.starts(line, "You move inside ") or 
		string.starts(line, "You parry the attack with a deft manoeuvre.") or 
		string.starts(line, "One of your reflections has been destroyed!") or
		string.starts(line, "You twist your body out of harm's way.") or
		string.starts(line, "You dodge nimbly out of the way.") or
		string.starts(line, "You quickly jump back, avoiding the attack.")
	then return true
	else return false
	end
end

function slc_reset()
	slc_init()
	--cecho("&lt;blue&gt;(&lt;white&gt;SLC&lt;blue&gt;) &lt;white&gt;Limb damage reset.")
	--SLC_longdisplay()
end

function SLC_set_attack(attack,n)

if slc.attacks[attack] == nil then
	cecho("&lt;blue&gt;(&lt;white&gt;SLC&lt;blue&gt;) Bad attack type: "..matches[2]:upper())
	cecho("&lt;white Valid attack types: Tekura DSL Rend Thornrend Maul Throwingaxe Staffstraike Smite Crush Other")
else
	slc.attacks[attack] = n
	for x, y in ipairs({"left arm","right arm","left leg","right leg","head","torso"}) do
			slc.percentages[y] = slc.hitcount[y]*100/slc.attacks[slc_last_attack]
	end
	--cecho("&lt;blue&gt;(&lt;white&gt;SLC&lt;blue&gt;) Number of hits needed for &lt;white&gt;"..attack:title().." &lt;blue&gt;set to &lt;white&gt;"..n.."&lt;blue&gt;.")
	--cecho("&lt;blue&gt;(&lt;white&gt;SLC&lt;blue&gt;)&lt;white&gt; Current limbs adjusted for change.")
end

end

function round(num)
   return math.floor(num+0.5)
end

function slc_test()
	slc_reset()
	slc_last_attack = "dsl"
	slc.hitcount.head = 3
	slc.hitcount["right leg"] = 10
	slc.hitcount["left leg"] = 7
	slc.hitcount["right arm"] = 8
	slc.percentages.head = 21
	slc.percentages["right leg"] = 70
	slc.percentages["left leg"] = 49
	slc.percentages["right arm"] = 56
	--SLC_longdisplay()
	--slc_displayLC()
	SLC_broke("right leg")
end

</script>
									<eventHandlerList />
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>slc_variables</name>
									<packageName></packageName>
									<script>function slc_init()            --  use 'cres' when you finish making changes.

slc =
	{
		["display"] = "long",      -- short | long | off
		["server_curing"] = true,  -- true | false
--==change: added bm_ratio+stance+stance_modifiers==--
    ["bm_ratio"] = 0.77,                  -- ratio for leg/arm/centre slash for alternate limbs (Testing in progress!)
    ["bm_stance"] = "Sanya",              -- which stance SLC assumes BMs use.  Sayna covers all the most common stances.
    ["bm_stance_modifiers"] = 
		{
        ["Thyr"] =  1.00,
        ["Mir"] =   1.00,
        ["Sanya"] = 1.00,
        ["Arash"] = 1.30,
				--["Arash"] = 1.37,
        ["Doya"] =  1.25,
				--["Doya"] =  1.33,
        ["Unstanced"] = 1.10
    },
		["underhand_weapon"] = "blade",
		["overhand_weapon"]  = "blade",
------------------------------------------------------
--==changed: * below are what was added==--
		["attacks"] = 
		{
			["tekura"] = 5,       -- Default number of hits to break limbs *
      ["tekurakick"] = 4.5,           -- Default number of hits to break limbs *
      ["tekurapunch"] = 5,            -- Default number of hits to break limbs *
			["axekick"] = 3,
                                      -- Tekura and Weaponry skills will require adjusting *
      ["dsl"] = 14,                   -- DSL includes bard jab (they usually use low str, high speed rapiers) *
      ["hew"] = 6,
      ["pulverise"] = 4, -- *
      ["underhand_hammer"] = 4, -- *
      ["underhand_blade"] = 6, -- *
      ["overhand_hammer"] = 4, -- *
      ["overhand_blade"] = 6, -- *
      ["whirl_mstar"] = 7, -- *
      ["whirl_flail"] = 5, -- *
      ["snb_rend"] = 7, -- *
      ["snb_slice"] = 11, -- *
      ["rend"] = 4, -- dragon rend *
			["thornrend"] = 4,
			["maul"] = 4,
			["hydra"] = 4,
			["lacerate"] = 7,
			["gouge"] = 7,
			["throwingaxe"] = 7,
			["doublestrike"] = 7,
			["staffstrike"] = 11,
			["smite"] = 4,
			["crush"] = 4,
			["other"] = 4,
      ["tremolo"] = 1.8, -- *
      ["vibrato"] = 1, -- *
      ["armslash"] = 9, -- *
      ["legslash"] = 9, -- *
      ["centreslash"] = 9, -- *
      ["compassslash"] = 9, -- *
      ["drawslash"] = 10, -- *
			["acciacurato"] = 2.8, --slc.attacks.acciacurato = slc.attacks.dsl * 0.4 -- *
			
			["thrust"] = 6,
			["dart"] = 10,
			["flashheel"] = 10,
			["risingkick"] = 10,
			["frontkick"] = 10,
			["hiraku"] = 11,
			["hiru"] = 9,
			["ruku"] = 10,
			["kuro"] = 10,
			["livestrike"] = 6,
			["nervestrike"] = 6,
			["needle"] = 6,
			["spinkick_torso"] = 8,
			["spinkick_head"] = 3,
			["jinzuku"] = 10,
			
		},
		["hitcount"] = 
		{
			["head"] = 0,
			["torso"] = 0,
			["left arm"] = 0,
			["right arm"] = 0,
			["left leg"] = 0,
			["right leg"] = 0,
		},

		["percentages"] = 
		{
			["head"] = 0,
			["torso"] = 0,
			["left arm"] = 0,
			["right arm"] = 0,
			["left leg"] = 0,
			["right leg"] = 0,
		},

		
	}
end</script>
									<eventHandlerList />
								</Script>
							</ScriptGroup>
						</ScriptGroup>
					</ScriptGroup>
				</ScriptGroup>
				<ScriptGroup isActive="yes" isFolder="yes">
					<name>mudlet-mapper_24</name>
					<packageName>mudlet-mapper_24</packageName>
					<script></script>
					<eventHandlerList />
					<ScriptGroup isActive="yes" isFolder="yes">
						<name>Mudlet Mapper</name>
						<packageName></packageName>
						<script>mudlet = mudlet or {}; mudlet.mapper_script = true</script>
						<eventHandlerList />
						<Script isActive="yes" isFolder="no">
							<name>Load settings</name>
							<packageName></packageName>
							<script>-- mmp = mudlet mapper namespace
mmp =
  mmp or
  {
    paused = false,
    autowalking = false,
    currentroom = 0,
    currentroomname = "(unknown)",
    firstRun = true,
    specials = {},
    ferry_rooms = {},
  }
mmp.speedWalkWatch = createStopWatch()
-- speedWalkPath and speedWalkDir populated by Mudlet from getPath() and gotoRoom()
speedWalkPath = speedWalkPath or {}
speedWalkDir = speedWalkDir or {}

-- actually used by the mapper for walking
mmp.speedWalkCounter = 0
mmp.speedWalk = mmp.speedWalk or {}
mmp.speedWalkPath = mmp.speedWalkPath or {}
mmp.speedWalkDir = mmp.speedWalkDir or {}
mmp.lagtable =
  {
    [1] = {description = "Normal, default level.", time = 0.5},
    [2] = {description = "Decent, but slightly laggy.", time = 1},
    [3] = {description = "Noticeably laggy with occasional spikes.", time = 2},
    [4] = {description = "Bad. Terrible. Terribad.", time = 5},
    [5] = {description = "Carrier Pigeon", time = 10},
  }
local newversion = "24.1.1"
if mmp.version and mmp.version ~= newversion then
  if not mmp.game then
    mmp.echo("Mapper script updated - Thanks! I don't know what game are you connected to, though - so please reconnect, if you could.")
  else
    mmp.echo("Mapper script updated - thanks! You don't need to restart.")
  end
end
mmp.version = newversion

function mmp.startup()
  if not mmp.firstRun then
    return
  end
  local private_settings = {}

  --General settings

  private_settings["echocolour"] = mmp.createOption("cyan", mmp.changeEchoColour, {"string"}, "Set the color for room number echos?", function(newSetting) return color_table[newSetting] ~= nil end)
  private_settings["crowdmap"] = mmp.createOption(false, mmp.changeMapSource, {"boolean"}, "Use a crowd-sourced map instead of games default?", nil, {achaea = true, starmourn = true, lusternia = true, stickmud = true, ashyria = true, asteria = true, imperian = true, aetolia = true})
  private_settings["showcmds"] = mmp.createOption(true, mmp.changeBoolFunc, {"boolean"}, "Show walking commands?")
  private_settings["laglevel"] = mmp.createOption(1, mmp.changeLaglevel, {"number"}, "How laggy is your connection, (fast 1&lt;-&gt;5 slow)?", mmp.verifyLaglevel)
  private_settings["slowwalk"] = mmp.createOption(false, mmp.setSlowWalk, {"boolean"}, "Walk slowly instead of as quick as possible?")
  private_settings["updatemap"] = mmp.createOption(true, mmp.changeUpdateMap, {"boolean"}, "Check for new maps from your MUD?")
  private_settings["waterwalk"] = mmp.createOption(true, mmp.setWaterWalk, {"boolean"}, "Have waterwalk (don't avoid water)?", nil, {achaea = true})

  --Settings that lock things

  private_settings["lockpathways"] = mmp.createOption(true, mmp.lockPathways, {"boolean"}, "Lock pathway exits?", nil, {lusternia = true})
  private_settings["locksewers"] = mmp.createOption(false, mmp.lockSewers, {"boolean"}, "Lock all sewers?", nil, {achaea = true})
  private_settings["lockspecials"] = mmp.createOption(false, mmp.lockSpecials, {"boolean"}, "Lock all special exits?")
  private_settings["lockwormholes"] = mmp.createOption(true, mmp.lockWormholes, {"boolean"}, "Lock all wormholes?", nil, {achaea = true, imperian = true, aetolia = true})

  --Sprint movement

  private_settings["dash"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Dash?", nil, {achaea = true, imperian = true, aetolia = true})
  private_settings["sprint"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Sprint?")
  private_settings["gallop"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Gallop?")
  private_settings["runaway"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Jester Runaway?", nil, {achaea = true})

  --Achaea wings and things

  private_settings["winglanguage"] = mmp.createOption("", mmp.setWingsLanguage, {"string"}, "Speak non-default language for wings:", nil, {achaea = true})
  private_settings["pebble"] = mmp.createOption(false, mmp.lockPebble, {"boolean"}, "Make use of your enchanted pebble?", nil, {achaea = true})
  private_settings["removewings"] = mmp.createOption(true, mmp.setWingsRemoval, {"boolean"}, "Remove Wings after using them?", nil, {achaea = true, imperian = true})
  private_settings["harness"] = mmp.createOption(false, mmp.setHarness, {"boolean"}, "Use Stratospheric Harness?", nil, {achaea = true})
  private_settings["duantahar"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Chenubian Wings?", nil, {achaea = true})
  private_settings["duanatharan"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Atavian Wings?", nil, {achaea = true, aetolia = true})
  private_settings["duanathar"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Eagle Wings?", nil, {achaea = true, aetolia = true})
  private_settings["duanatharic"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Island Wings?", nil, {achaea = true})
  private_settings["soar"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Aero Soar?", nil, {achaea = true})
  private_settings["shackle"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Take off shackle?", nil, {achaea = true})
  private_settings["universe"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Universe Tarot?", nil, {achaea = true})
  private_settings["gare"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Gare?", nil, {achaea = true})

  --aet wings and things
  private_settings["voltda"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use dark amulet?", nil, {aetolia = true})
  private_settings["voltdaran"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use midnight amulet?", nil, {aetolia = true})
  
  --Wings pathfinding improvements

  private_settings["betterwings"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Better Wings pathfinding?", nil, {achaea = true})

  --Achaea Orb of Confinement

  private_settings["orbashtan"] = mmp.createOption(false, function() mmp.setOrb("ashtan") end, {"boolean"}, "Orb of Confinement active in Ashtan?", nil, {achaea = true})
  private_settings["orbcyrene"] = mmp.createOption(false, function() mmp.setOrb("cyrene") end, {"boolean"}, "Orb of Confinement active in Cyrene?", nil, {achaea = true})
  private_settings["orbeleusis"] = mmp.createOption(false, function() mmp.setOrb("eleusis") end, {"boolean"}, "Orb of Confinement active in Eleusis?", nil, {achaea = true})
  private_settings["orbhashan"] = mmp.createOption(false, function() mmp.setOrb("hashan") end, {"boolean"}, "Orb of Confinement active in Hashan?", nil, {achaea = true})
  private_settings["orbmhaldor"] = mmp.createOption(false, function() mmp.setOrb("mhaldor") end, {"boolean"}, "Orb of Confinement active in Mhaldor?", nil, {achaea = true})
  private_settings["orbtargossas"] = mmp.createOption(false, function() mmp.setOrb("targossas") end, {"boolean"}, "Orb of Confinement active in Targossas?", nil, {achaea = true})

  --Imperian wings

  private_settings["shekinah"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Seraphim Wings?", nil, {imperian = true})
  private_settings["suriel"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use Orphanim Wings?", nil, {imperian = true})

  --Lusternia bixes

  private_settings["torus"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Torus?", nil, {lusternia = true})
  private_settings["prism"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your transplanar prism?", nil, {lusternia = true})
  private_settings["cubix"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Cubix?", nil, {lusternia = true})
  private_settings["medallion"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Medallion?", nil, {lusternia = true})

  --Lusternia Bubblixes
  private_settings["twist"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Mt. Dio Bix?", nil, {lusternia = true})
  private_settings["figurine"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Icewynd Bix?", nil, {lusternia = true})
  private_settings["periscope"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Aquagoria Bix?", nil, {lusternia = true})
  private_settings["pebble"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Lyraa Bix?", nil, {lusternia = true})
  private_settings["shard"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Xion Bix?", nil, {lusternia = true})
  private_settings["tibia"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Cankermore Bix?", nil, {lusternia = true})
  private_settings["mud"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Mucklemarsh Bix?", nil, {lusternia = true})
  private_settings["cookie"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Crumkindivia Bix?", nil, {lusternia = true})
  private_settings["icicle"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Frosticia Bix?", nil, {lusternia = true})
  private_settings["screwdriver"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Facility Bix?", nil, {lusternia = true})
  private_settings["snowglobe"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Tree of Trees Bix?", nil, {lusternia = true})
  private_settings["head"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Bottledowns Bix?", nil, {lusternia = true})
  private_settings["wheel"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Dramube Bix?", nil, {lusternia = true})

  --lusternia athergoop setButtons

  private_settings["buttons"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of Aethergoop Buttons?", nil, {lusternia = true})

  --Lusternia Curio collections

  private_settings["bonecurio"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Bone curios?", nil, {lusternia = true})
  private_settings["facecurio"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Face curios?", nil, {lusternia = true})
  private_settings["feathercurio"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Feather curios?", nil, {lusternia = true})
  private_settings["figurecurio"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Figure curios?", nil, {lusternia = true})
  private_settings["flowercurio"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Flower curios?", nil, {lusternia = true})
  private_settings["fluttercurio"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Flutter curios?", nil, {lusternia = true})
  private_settings["toolcurio"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Tool curios?", nil, {lusternia = true})
  private_settings["vernalcurio"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Vernal curios?", nil, {lusternia = true})
  private_settings["utensilcurio"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Utensil curios?", nil, {lusternia = true})
  private_settings["toycurio"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Toy curios?", nil, {lusternia = true})
  private_settings["soullesscurio"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Soulless curios?", nil, {lusternia = true})

  --Lusternia epic quest bixes

  private_settings["fingerblade"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Fingerblade?", nil, {lusternia = true})
  private_settings["blossom"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Flame of dae'Seren?", nil, {lusternia = true})
  private_settings["belt"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Belt?", nil, {lusternia = true})
  private_settings["mandala"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Mandala?", nil, {lusternia = true})
  private_settings["mantle"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Mantle?", nil, {lusternia = true})
  private_settings["key"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Make use of your Key?", nil, {lusternia = true})

  --Lusternia other travel things
  private_settings["compass"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Use the Compass of the Basin?", nil, {lusternia = true})
  private_settings["astrojump"] = mmp.createOption(false, mmp.astroboots, {"boolean"}, "Use Astral Jumping boots?", nil, {lusternia = true})


  --I have no idea what this does tbh

  private_settings["caravan"] = mmp.createOption(false, mmp.changeBoolFunc, {"boolean"}, "Walk caravans?", nil, {imperian = true})



  mmp.settings = mmp.createOptionsTable(private_settings)
  mmp.settings.disp = mmp.echo
  mmp.game = false
  mmp.settings.dispOption =
    function(opt, val)
      cecho(
        "&lt;green&gt;" ..
        val.use ..
        "&lt;white&gt; (" ..
        opt ..
        ") " ..
        string.rep(" ", 50 - val.use:len() - opt:len()) ..
        tostring(val.value) ..
        "\n"
      )
    end
  mmp.settings.dispDefaultWriteError =
    function()
      mmp.echo("Please use the mconfig alias to set options!")
    end
  raiseEvent("mmp areas changed")
  mmp.firstRun = false
  mmp.echon("Mudlet Mapper script for IREs (" .. tostring(mmp.version) .. ") loaded! (")
  echoLink(
    "homepage",
    "(openUrl or openURL)'http://wiki.mudlet.org/w/IRE_mapping_script'",
    "Clicky clicky to read up on what's this about"
  )
  echo(")\n")
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Create Option Table</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
local spairs = spairs or function(tbl, order)
  local keys = table.keys(tbl)
  if order then
    table.sort(keys, function(a,b) return order(tbl, a, b) end)
  else
    table.sort(keys)
  end

  local i = 0
  return function()
    i = i + 1
    if keys[i] then
      return keys[i], tbl[keys[i]]
    end
  end
end


function mmp.createOption(startingValue, onChangeFunc, allowedVarTypes, use, checkOption, games)
	if allowedVarTypes then -- make sure our starting Value follows type rules
		if not table.contains(allowedVarTypes, type(startingValue)) then
			echo("Starting type is not of allowed type!\n")
			display(allowedVarTypes)
			echo("type: " .. type(startingValue) .. "\n")
			return
		end
	end

	local option = {
		value = startingValue,
		onChange = onChangeFunc,
		allowedVarTypes = allowedVarTypes,
		use = use or "",
		games = games,
		checkOption = checkOption or function() return true end
	}

	return option
end

function mmp.createOptionsTable(defaultTable)
	local index = {} -- index to store the default table at in our proxy table


	local proxyTable = {} -- This is the table that is returned to the user

	proxyTable.disp = echo

	proxyTable.dispDefaultWriteError = function()
		echo("Can't overwrite default options. Please use the SetOption function to change the value\n")
	end

	proxyTable.dispOption = function(opt, val)
		if not opt or not val then return end
		echo("Name: " .. string.title(opt) .. string.rep(" ", 10 - string.len(opt)))
		echo("Val: " .. tostring(val.value))
		echo(string.rep(" ", 10 - string.len(tostring(val.value))) ..  "- " .. val.use .. "\n")
	end

	function proxyTable:showAllOptions(game)
		proxyTable.disp("Available options: \n")
		for k, v in spairs(self[index]) do
			if not game or not v.games or v.games[game] then
				self.dispOption(k, v)
			end
		end
		echo("\n")
		for k, v in spairs(self["_customOptions"]) do
			self.dispOption(k, v)
		end

	end

	function proxyTable:getAllOptions()
		local t = {}
		for k, v in pairs(self[index]) do
			t[k] = v.value
		end

		return t
	end

   function proxyTable:setOption(option, value, silent)
		if self[option] == nil then
			proxyTable.disp("No such option!\n")
			return
		end

		-- otherwise, set the option
		if self["_customOptions"][option] then
			if not (table.contains(self["_customOptions"][option].allowedVarTypes, type(value)) and self["_customOptions"][option].checkOption(value)) then
				proxyTable.disp("You can't set '" .. option .. "' to that!\n")
				return
			end
			self["_customOptions"][option].value = value
			if self["_customOptions"][option].onChange then
				self["_customOptions"][option].onChange(option, value)
			end
		else
			if not (table.contains(self[index][option].allowedVarTypes, type(value)) and self[index][option].checkOption(value)) then
				proxyTable.disp("You can't set '" .. option .. "' to that!\n")
				return
			end
			rawset(self[index][option], "value", value)
			local opt = rawget(self[index], option)
			if opt.onChange  and not silent then opt.onChange(option, value) end
		end
		if mmp and mmp.clearpathcache then mmp.clearpathcache() end
	end


	proxyTable._customOptions = {}

	local mt = {
		__index = function(t, k)
			local custOp = rawget(t, "_customOptions")
			if custOp[k] then
			 	local opt = custOp[k]
				if opt then return opt.value else return nil end
			else
				local opt = t[index][k]
				if opt then return opt.value else return nil end
			end
		end,

		__newindex = function (t, k, v)
			if t[index][k] then
				proxyTable.dispDefaultWriteError()
			else
				t["_customOptions"][k] = v
			end
		end
	}


	proxyTable[index] = defaultTable

	setmetatable(proxyTable, mt)

	return proxyTable

end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>mmp.speedwalking</name>
							<packageName></packageName>
							<script>function mmp.gotoRoom(where, dashtype, gotoType)
  mmp.speedWalk.type = gotoType or "room"
  if not where or not tonumber(where) then
    mmp.echo("Where do you want to go to?")
    return
  end
  if tonumber(where) == mmp.currentroom then
    mmp.echo("We're already at " .. where .. "!")
    raiseEvent("mmapper arrived")
    return
  end
  -- allow mapper 'addons' to link their own exits in
  raiseEvent("mmp link externals")
  -- if getPath worked, then the dirs and room #'s tables were populated for us
  if not mmp.getPath(mmp.currentroom, tonumber(where)) then
    mmp.echo("Don't know how to get there (" .. tostring(where) .. ") from here :(")
    mmp.speedWalkPath = {}
    mmp.speedWalkDir = {}
    mmp.speedWalkCounter = 0
    raiseEvent("mmapper failed path")
    if mmp.settings.shackle then
      expandAlias("wear shackle")
    end
    -- allow mapper 'addons' to unlink their special exits
    raiseEvent("mmp clear externals")
    return
  end
  doSpeedWalk(dashtype)
  -- allow mapper 'addons' to unlink their special exits
  raiseEvent("mmp clear externals")
end

function mmp.gotoArea(where, number, dashtype, exact)
  mmp.speedWalk.type = "area"
  if not where or type(where) ~= "string" then
    mmp.echo("Where do you want to go to?")
    return
  end
  local where = where:lower()
  number = tonumber(number)
  local tmp = getRoomUserData(1, "gotoMapping")
  if not tmp or tmp == '' then
    tmp = "[]"
  end
  local temp, maptable = yajl.to_value(tmp), {}
  for k, v in pairs(temp) do
    maptable[k:lower()] = v
  end
  local destinationRoom = maptable[where]
  if destinationRoom then
    mmp.gotoRoom(destinationRoom, dashtype)
    return
  end
  local areaid, msg, multiples = mmp.findAreaID(where, exact)
  if areaid then
    mmp.gotoAreaID(areaid)
  elseif not areaid and #multiples &gt; 0 then
    if number and number &lt;= #multiples then
      mmp.gotoArea(multiples[number], nil, dashtype, true)
      return
    end
    mmp.echo("Which area would you like to go to?")
    fg("DimGrey")
    for key, areaname in ipairs(multiples) do
      echo("  ")
      echoLink(
        key .. ") ",
        'mmp.gotoArea("' ..
        areaname ..
        '", nil, ' ..
        (dashtype and '"' .. dashtype .. '"' or "nil") ..
        ', true)',
        "Click to go to " .. areaname,
        true
      )
      setUnderline(true)
      echoLink(
        areaname,
        'mmp.gotoArea("' ..
        areaname ..
        '", nil, ' ..
        (dashtype and '"' .. dashtype .. '"' or "nil") ..
        ', true)',
        "Click to go to " .. areaname,
        true
      )
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
    return
  else
    mmp.echo(string.format("Don't know of any area named '%s'.", where))
    return
  end
end

--- DOES NOT ACCOUNT FOR CHANGING THE MAP YET (within a profile load), because we don't know when it happens
local getpathcache = {}
--setmetatable(getpathcache, {__mode = "kv"}) -- weak keys/values = it'll periodically get cleaned up by gc

function mmp.getPath(from, to)
  assert(tonumber(from) and tonumber(to), "mmp.getPath: both from and to have to be room IDs")
  local key = string.format("%s_%s", from, to)
  local resulttbl = getpathcache[key]
  -- not in cache?
  if not resulttbl then
    mmp.computeGetPath = mmp.computeGetPath or createStopWatch()
    startStopWatch(mmp.computeGetPath)
    local boolean = getPath(from, to)
    if mmp.debug then
      mmp.echo(
        "a new getPath() from " ..
        from ..
        " to " ..
        to ..
        " took " ..
        stopStopWatch(mmp.computeGetPath) ..
        "s."
      )
    end
    -- save it into the cache &amp; send away
    getpathcache[key] = {boolean, speedWalkDir, speedWalkPath}
    return boolean
  end
  -- or if it is, retrieve &amp; send away
  speedWalkDir = resulttbl[2]
  speedWalkPath = resulttbl[3]
  return resulttbl[1]
end

function mmp.clearpathcache()
  if mmp.debug then
    mmp.echo("path cache cleared")
  end
  getpathcache = {}
end

registerAnonymousEventHandler("mmapper updated map","mmp.clearpathcache")

function mmp.showpathcache()
  return getpathcache
end

function mmp.setmovetimer(time, ignoreLatency)
  if mmp.movetimer then
    killTimer(mmp.movetimer)
  end
  if mmp.settings.slowwalk and not mmp.hasty then
    return
  end
  local laglevel = mmp.settings.laglevel or 1
  time = time or mmp.lagtable[laglevel].time
  local latency = ignoreLatency and 0 or getNetworkLatency()
  if mmp.debug then
    mmp.echo(f'setting move timer according to time {time} and latency {latency}')
  end
  mmp.movetimer =
    tempTimer(
      latency + time,
      function()
        if mmp.debug then
          mmp.echo('move timer fired')
        end
        mmp.movetimer = false
        mmp.move()
      end
    )
end

-- moves to the next room we need to.

function mmp.move()
  if mmp.paused or not mmp.autowalking or mmp.movetimer or not mmp.canmove() then
    return
  end
  -- sometimes it's 0 - default to 1
  if mmp.speedWalkCounter == 0 then
    mmp.speedWalkCounter = 1
  end
  local cmd
  if mmp.settings["caravan"] then
    cmd = "lead caravan " .. mmp.speedWalkDir[mmp.speedWalkCounter]
  else
    cmd = mmp.speedWalkDir[mmp.speedWalkCounter]
  end
  cmd = cmd or ''
  -- timeout before loadstring, so it can set its own if it would like to.
  mmp.setmovetimer()
  if string.starts(cmd, "script:") then
    cmd = string.gsub(cmd, "script:", "")
    loadstring(cmd)()
    if mmp.settings.showcmds and not mmp.hasty then
      cecho(
        string.format(
          "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;%s&lt;red&gt;)",
          #mmp.speedWalkDir - mmp.speedWalkCounter + 1,
          "&lt;script&gt;"
        )
      )
    end
    mmp.hasty = false
  else
    send(cmd, false)
    if mmp.settings.showcmds and not mmp.hasty then
      cecho(
        string.format(
          "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;%s&lt;red&gt;)",
          #mmp.speedWalkDir - mmp.speedWalkCounter + 1,
          cmd
        )
      )
    end
    mmp.hasty = false
  end
end

function mmp.swim()
  -- not going anywhere? don't do anything
  if not mmp.speedWalkDir[mmp.speedWalkCounter] then
    return
  end
  send(
    "swim " ..
    mmp.speedWalkDir[mmp.speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
      "runaway ", ""
    ),
    false
  )
  if mmp.settings.showcmds then
    cecho(
      string.format(
        "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;swim %s&lt;red&gt;)",
        #mmp.speedWalkDir - mmp.speedWalkCounter + 1,
        mmp.speedWalkDir[mmp.speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
          "runaway ", ""
        )
      )
    )
  end
  mmp.hasty = true
  mmp.setmovetimer(2.5)
end

function mmp.enterGrate()
  -- not going anywhere? don't do anything
  if not mmp.speedWalkDir[mmp.speedWalkCounter] then
    return
  end
  send("enter grate " .. mmp.speedWalkDir[mmp.speedWalkCounter], false)
  if mmp.settings.showcmds then
    cecho(
      string.format(
        "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;enter grate %s&lt;red&gt;)",
        #mmp.speedWalkDir - mmp.speedWalkCounter + 1,
        mmp.speedWalkDir[mmp.speedWalkCounter]
      )
    )
  end
  mmp.hasty = true
  mmp.setmovetimer(2.5)
end

function mmp.openDoor()
  -- not going anywhere? don't do anything
  if not mmp.speedWalkDir[mmp.speedWalkCounter] then
    return
  end
  if mmp.game == "asteria" or mmp.game == "ashyria" then
   send(
    "open " ..
    mmp.speedWalkDir[mmp.speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
      "runaway ", ""
    ),
    false
  )
  if mmp.settings.showcmds then
    cecho(
      string.format(
        "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;open %s&lt;red&gt;)",
        #mmp.speedWalkDir - mmp.speedWalkCounter + 1,
        mmp.speedWalkDir[mmp.speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
          "runaway ", ""
        )
      )
    )
  end
else
  send(
    "open door " ..
    mmp.speedWalkDir[mmp.speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
      "runaway ", ""
    ),
    false
  )
  if mmp.settings.showcmds then
    cecho(
      string.format(
        "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;open door %s&lt;red&gt;)",
        #mmp.speedWalkDir - mmp.speedWalkCounter + 1,
        mmp.speedWalkDir[mmp.speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
          "runaway ", ""
        )
      )
    )
  end
end
  mmp.hasty = true
  mmp.setmovetimer(getNetworkLatency())
end

function mmp.unlockDoor()
  -- not going anywhere? don't do anything
  if not mmp.speedWalkDir[mmp.speedWalkCounter] then
    return
  end
  send(
    "unlock door " ..
    mmp.speedWalkDir[mmp.speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
      "runaway ", ""
    ),
    false
  )
  if mmp.settings.showcmds then
    cecho(
      string.format(
        "&lt;red&gt;(&lt;maroon&gt;%d - &lt;dark_slate_grey&gt;unlock door %s&lt;red&gt;)",
        #mmp.speedWalkDir - mmp.speedWalkCounter,
        mmp.speedWalkDir[mmp.speedWalkCounter]:gsub("sprint ", ""):gsub("dash ", ""):gsub("gallop ", ""):gsub(
          "runaway ", ""
        )
      )
    )
  end
  mmp.hasty = true
  mmp.setmovetimer(getNetworkLatency())
end

function mmp.customwalkdelay(delay)
  mmp.setmovetimer(getNetworkLatency() + delay)
end

function mmp.stop()
  mmp.speedWalkPath = {}
  mmp.speedWalkDir = {}
  mmp.speedWalkCounter = 0
  stopStopWatch(mmp.speedWalkWatch)
  --if mmp.movetimer then killTimer( mmp.movetimer ) end
  mmp.autowalking = false
  -- clear all the temps we've got
  for trigger, ID in pairs(mmp.specials) do
    killTrigger(ID)
  end
  mmp.specials = {}
  mmp.echo("Stopped walking.")
  raiseEvent("mmapper stopped")
  if mmp.settings.shackle then
    expandAlias("wear shackle")
  end
end

-- Aetolia and Lusternia support showing balances in GMCP. This is easy to support, so we do!
-- if we can't move, setup a polling timer to prompt walking when we can again.
-- popular systems that expose balance &amp; equilibrium values can be added here as well, perhaps though a similarly-named function.

function mmp.canmove(fromtimer)
  if mmp.mapperCanMove and mmp.mapperCanMove() then
    if fromtimer then
      mmp.move()
    else
      return true
    end
  elseif mmp.mapperCanMove then
    tempTimer(0.2, [[mmp.canmove(true)]])
    return false
  end
  if not gmcp.Char then
    return true
  end
  -- Achaea
  -- Lusternia
 if
    (
      gmcp.Char and mmp.game ~= "ashyria" and
      (not gmcp.Char.Vitals.bal or gmcp.Char.Vitals.bal == "1") and
      (not gmcp.Char.Vitals.eq or gmcp.Char.Vitals.eq == "1") and
      (not gmcp.Char.Vitals.balance or gmcp.Char.Vitals.balance == "1") and
      (not gmcp.Char.Vitals.equilibrium or gmcp.Char.Vitals.equilibrium == "1") and
      (not gmcp.Char.Vitals.right_arm or gmcp.Char.Vitals.right_arm == "1") and
      (not gmcp.Char.Vitals.left_arm or gmcp.Char.Vitals.left_arm == "1") and
      (not gmcp.Char.Vitals.right_leg or gmcp.Char.Vitals.right_leg == "1") and
      (not gmcp.Char.Vitals.left_leg or gmcp.Char.Vitals.left_leg == "1") and
      (not gmcp.Char.Vitals.psisuper or gmcp.Char.Vitals.psisuper ~= "0") and
      (not gmcp.Char.Vitals.psisub or gmcp.Char.Vitals.psisub ~= "0") and
      (not gmcp.Char.Vitals.psiid or gmcp.Char.Vitals.psiid ~= "0") and
      (not gmcp.Char.Balance or gmcp.Char.Balance.List.balance == "1") and
      (not gmcp.Char.Balance or gmcp.Char.Balance.List.equilibrium == "1") and
      (not gmcp.Char.Balance or gmcp.Char.Balance.List.rarm == "1") and
      (not gmcp.Char.Balance or gmcp.Char.Balance.List.larm == "1") and
      (not gmcp.Char.Balance or gmcp.Char.Balance.List.legs == "1") and
      (not gmcp.Char.Vitals.prone or (gmcp.Char.Vitals.prone == "0" or gmcp.Char.Vitals.prone == 0)
    ))
  then
    if fromtimer then
      mmp.move()
    else
      return true
    end
  else
    tempTimer(0.2, [[mmp.canmove(true)]])
    return false
  end
end

local oldnum

function mmp.speedwalking(event, num)
  local num = tonumber(num) or tonumber(gmcp.Room.Info.num)
  if num ~= mmp.currentroom then
    mmp.previousroom = mmp.currentroom
  end
  mmp.currentroom = num
  mmp.currentroomname = getRoomName(num)
  -- Try to track if we're flying or not, for Imperian wings
  -- This is to avoid being "off path" if we FLY due to wings.
  local madeflight = false
  if gmcp.Room then
    local flying = false
    if string.find(gmcp.Room.Info.name, "^flying above") then
      flying = true
    end
    if mmp.flying and not flying then
      -- We were flying, and now we are not. Gravity!
      mmp.flying = false
    elseif not mmp.flying and flying then
      -- We were not flying and now we are.
      madeflight = true
      mmp.flying = true
    elseif not flying then
      mmp.flying = false
    end
  else
    mmp.flying = false
  end
  -- track if we're inside or outside, if possible
  if gmcp.Room then
    local areaID = getRoomArea(mmp.currentroom)
    if
      mmp.inside and
      not (
        table.contains(gmcp.Room.Info.details, "indoors") or
        table.contains(gmcp.Room.Info.details, "considered indoors")
      ) and
      not mmp.orbed()
    then
      mmp.inside = false
      raiseEvent("mmapper went outside")
    elseif
      not mmp.inside and
      (
        table.contains(gmcp.Room.Info.details, "indoors") or
        table.contains(gmcp.Room.Info.details, "considered indoors") or
        mmp.orbed()
      )
    then
      mmp.inside = true
      raiseEvent("mmapper went inside")
    end
    if
      #table.n_union(
        mmp.getareacontinents(getRoomArea(mmp.previousroom)),
        mmp.getareacontinents(getRoomArea(num))
      ) ~= #mmp.getareacontinents(getRoomArea(num))
    then
      raiseEvent("mmapper changed continent")
    end
    -- the event could cancel speedwalking - in this case quit
    if mmp.ignore_speedwalking then
      mmp.ignore_speedwalking = nil
      return
    end
  end
  if oldnum == num then
    return
  else
    oldnum = num
  end
  if not mmp.autowalking then
    return
  end
  if mmp.movetimer then
    killTimer(mmp.movetimer)
    mmp.movetimer = false
  end
  if num == mmp.speedWalkPath[#mmp.speedWalkPath] then
    local walktime = stopStopWatch(mmp.speedWalkWatch)
    mmp.echo(string.format("We've arrived! Took us %.1fs.\n", walktime))
    raiseEvent("mmapper arrived")
    if mmp.settings.shackle then
      expandAlias("wear shackle")
    end
    mmp.speedWalkPath = {}
    mmp.speedWalkDir = {}
    mmp.speedWalkCounter = 0
    mmp.autowalking = false
  elseif mmp.speedWalkPath[mmp.speedWalkCounter] == num then
    mmp.speedWalkCounter = mmp.speedWalkCounter + 1
    tempPromptTrigger(mmp.move, 1)
  elseif mmp.game == "imperian" and madeflight then
    mmp.echo("We began flying!")
    tempPromptTrigger(mmp.move, 1)
  elseif
    #mmp.speedWalkPath &gt; 0 and
    not mmp.ferry_rooms[num] and
    not (gmcp.Room.Info.details and table.contains(gmcp.Room.Info.details, "ferry"))
  then
    -- ended up somewhere we didn't want to be, and this isn't a ferry room?
    speedWalkMoved = false
    -- re-calculate path then
    mmp.echo("Ended up off the path, recalculating a new path...")
    local destination = mmp.speedWalkPath[#mmp.speedWalkPath]
    if not mmp.getPath(num, destination) then
      mmp.echo(
        string.format(
          "Don't know how to get to %d (%s) anymore :( Move into a room we know of to continue",
          destination,
          getRoomName(destination)
        )
      )
    else
      mmp.gotoRoom(destination)
    end
  end
end

-- doSpeedWalk is used by the mudlet mapping script and should not be changed
function doSpeedWalk(dashtype)
  mmp.speedWalkDir = mmp.deepcopy(speedWalkDir)
  mmp.speedWalkPath = mmp.deepcopy(speedWalkPath)
  speedWalkDir, speedWalkPath = {}, {}
  resetStopWatch(mmp.speedWalkWatch)
  startStopWatch(mmp.speedWalkWatch)
  if
    mmp.settings["gallop"] or
    mmp.settings["dash"] or
    mmp.settings.sprint or
    mmp.settings.runaway or
    dashtype
  then
    mmp.fixPath(
      mmp.currentroom,
      mmp.speedWalkPath[#mmp.speedWalkPath],
      (mmp.settings["gallop"] and "gallop") or
      (mmp.settings["dash"] and "dash") or
      (mmp.settings.sprint and "sprint") or
      (mmp.settings.runaway and "runaway") or
      dashtype
    )
  end
  mmp.fixSpecialExits(mmp.speedWalkDir)
  if #mmp.speedWalkPath == 0 then
    mmp.autowalking = false
    mmp.echo("Couldn't find a path to the destination :(")
    raiseEvent("mmapper failed path")
    if mmp.settings.shackle then
      expandAlias("wear shackle")
    end
    return
  end
  -- this is a fix: convert nums to actual numbers
  for i = 1, #mmp.speedWalkPath do
    mmp.speedWalkPath[i] = tonumber(mmp.speedWalkPath[i])
  end
  mmp.autowalking = true
  raiseEvent("s")
  if mmp.settings.shackle then
    expandAlias("remove shackle")
  end
  if not mmp.paused then
    mmp.echon("Starting speedwalk from " .. (atcp.RoomNum or gmcp.Room.Info.num) .. " to ")
    cechoLink(
      "&lt;" .. mmp.settings.echocolour .. "&gt;" .. mmp.speedWalkPath[#mmp.speedWalkPath],
      'mmp.gotoRoom "' .. mmp.speedWalkPath[#mmp.speedWalkPath] .. '"',
      'Go to ' .. mmp.speedWalkPath[#mmp.speedWalkPath],
      true
    )
    echo(": ")
    mmp.speedWalkCounter = 1
    if mmp.canmove() then
      mmp.hasty = true
      mmp.setmovetimer(0.1, true)
    else
      echo("(when we get balance back / aren't hindered)")
    end
  else
    mmp.echo(
      "Will go to " ..
      mmp.speedWalkPath[#mmp.speedWalkPath] ..
      " as soon as the mapper is unpaused."
    )
  end
end

function mmp.failpath()
  if mmp.movetimer then
    local walktime = stopStopWatch(mmp.speedWalkWatch)
    mmp.echo(string.format("Can't continue further! Took us %.1fs to get here.\n", walktime))
  end
  mmp.autowalking = false
  if mmp.settings.shackle then
    expandAlias("wear shackle")
  end
  mmp.speedWalkPath = {}
  mmp.speedWalkDir = {}
  mmp.speedWalkCounter = 0
  if mmp.movetimer then
    killTimer(mmp.movetimer)
    mmp.movetimer = nil
  end
  raiseEvent("mmapper failed path")
end

function mmp.changeBoolFunc(name, option)
  local en
  en = option and "will now use" or "will no longer use"
  mmp.echo("&lt;green&gt;Okay, the mapper " .. en .. " &lt;white&gt;" .. name .. "&lt;green&gt;!")
end

function mmp.fixPath(rFrom, rTo, dashtype)
  local currentPath, currentIds = {}, {}
  local dRef = {["n"] = "north", ["e"] = "east", ["s"] = "south", ["w"] = "west"}
  if not getPath(rFrom, rTo) then
    return false
  end
  -- Logic: Look for a direction repeated at least two times.
  -- count the number of times it repeats, then look that many rooms ahead.
  -- if that room also contains the direction we're headed, just travel that many directions.
  -- otherwise, dash.
  local repCount = 1
  local index = 1
  local dashExaust = false
  while mmp.speedWalkDir[index] do
    if not table.contains(getSpecialExits(mmp.speedWalkPath[index]), mmp.speedWalkDir[index]) then
      dashExaust = false
      repCount = 1
      while mmp.speedWalkDir[index + repCount] == mmp.speedWalkDir[index] do
        repCount = repCount + 1
        if repCount == 11 then
          dashExaust = true
          break
        end
      end
      if repCount &gt; 1 then
        -- Found direction repetition. Calculate dash path.
        local exits = getRoomExits(mmp.speedWalkPath[index + (repCount - 1)])
        local pname = ""
        for word in mmp.speedWalkDir[index]:gmatch("%w") do
          pname = pname .. (dRef[word] or word)
        end
        if not exits[pname] or dashExaust then
          -- Final room in this direction does not continue, dash!
          table.insert(currentPath, string.format("%s %s", dashtype, mmp.speedWalkDir[index]))
          currentIds[#currentIds + 1] = mmp.speedWalkPath[index + repCount - 1]
        else
          -- Final room in this direction continues onwards, don't dash unless on achaea
          if mmp.game == "achaea" then
            table.insert(
              currentPath, string.format("%s %s %s", dashtype, mmp.speedWalkDir[index], repCount)
            )
            currentIds[#currentIds + 1] = mmp.speedWalkPath[index + repCount - 1]
          else
            for i = 1, repCount do
              table.insert(currentPath, mmp.speedWalkDir[index])
              currentIds[#currentIds + 1] = mmp.speedWalkPath[index + i - 1]
            end
          end
        end
        index = index + repCount
      else
        -- No repetition, just add the direction.
        table.insert(currentPath, mmp.speedWalkDir[index])
        currentIds[#currentIds + 1] = mmp.speedWalkPath[index]
        index = index + 1
      end
    else
      -- Special exit, skip over this step
      table.insert(currentPath, mmp.speedWalkDir[index])
      currentIds[#currentIds + 1] = mmp.speedWalkPath[index]
      index = index + 1
    end
  end
  mmp.speedWalkDir = currentPath
  mmp.speedWalkPath = currentIds
  return true
end

-- a certain version of the mapper gave us special exits prepended with 0 or 1 in the command
-- depending on if it was locked. Need to remove these before we can use them

function mmp.fixSpecialExits(directions)
  for i = 1, #directions do
    if directions[i]:match("^%d") then
      directions[i] = directions[i]:sub(2)
    end
  end
end

-- cleanup function to remove the temp special exit we made

function mmp.clearspecials(deleterooms)
  local t = getSpecialExits(mmp.currentroom)
  for connectingroom, exits in pairs(t) do
    if table.contains(deleterooms, connectingroom) then
      -- delete the special exits linking to this room
      for command, locked in pairs(exits) do
        removeSpecialExit(mmp.currentroom, command)
      end
    end
  end
end

function mmp.getShortestOfMultipleRooms(possibleRooms)
  local shortestWeight, closestRoom = 10000000, 0
  local checkedsofar, outoftime = 0, false
  local getStopWatchTime, tonumber = getStopWatchTime, tonumber

  -- allocate only 500ms to finding the shortest path, or more if we failed to find anything
  mmp.computeShortestWatch = mmp.computeShortestWatch or createStopWatch()
  startStopWatch(mmp.computeShortestWatch)
  raiseEvent("mmp link externals")

  -- mmp.echo(string.format("Have %s rooms nodes, %ss taken so far...", table.size(possibleRooms), getStopWatchTime(mmp.computeShortestWatch)))
  for _, id in pairs(possibleRooms) do
    local possible, thisWeight = getPath(mmp.currentroom, tonumber(id))
    if possible and thisWeight &lt; shortestWeight then
      shortestWeight = thisWeight
      closestRoom = tonumber(id)
    end
    checkedsofar = checkedsofar + 1
    if (getStopWatchTime(mmp.computeShortestWatch) &gt;= .5) then
      outoftime = true
      break
    end

    -- mmp.echo(string.format("pathed from %s to %s, running time so far: %s", mmp.currentroom, id, getStopWatchTime(mmp.computeShortestWatch)))
  end
  --mmp.echo(string.format("total time took: %s", getStopWatchTime(mmp.computeShortestWatch)))
  stopStopWatch(mmp.computeShortestWatch)
  return closestRoom, outoftime, checkedsofar
end

function mmp.gotoAreaID(areaid, number, dashtype)
  if not areaid or not tonumber(areaid) then
    mmp.echo("To where do you want to go?")
    return
  end
  areaid = tonumber(areaid)
  if not mmp.areatabler[areaid] then
    mmp.echo("Invalid area ID selected")
    return
  end
  local possibleRooms, shortestBorder = {}, 0
  for id,_ in pairs(mmp.getAreaBorders(areaid)) do
    possibleRooms[#possibleRooms+1] = id
  end
  shortestBorder, outoftime, checkedsofar = mmp.getShortestOfMultipleRooms(possibleRooms)
  if shortestBorder == 0 then
    if outoftime then
      mmp.echo(
        string.format(
          "I checked %d of the %d possible exits \"%s\" has, but none of the ways there worked and it was taking too long :( try doing this again?",
          checkedsofar,
          table.size(possibleRooms),
          getRoomAreaName(areaid)
        )
      )
    else
      mmp.echo(
        "Checked " ..
        table.size(possibleRooms) ..
        " exits in that area, and none of them worked :( I Don't know how to get you there."
      )
    end
    mmp.speedWalkPath = {}
    mmp.speedWalkDir = {}
    mmp.speedWalkCounter = 0
    raiseEvent("mmapper failed path")
    raiseEvent("mmp clear externals")
    return
  end
  raiseEvent("mmp clear externals")
  mmp.gotoRoom(shortestBorder, dashtype, "area")
end

function mmp.gotoFeature(partialFeatureName, dashtype)
  local mapFeatures = mmp.getMapFeatures()
  local feature
  if mapFeatures[partialFeatureName:lower()] then
    feature = partialFeatureName:lower()
  else
    for key in pairs(mapFeatures) do
      if key:find(partialFeatureName:lower()) then
        feature = key
        break
      end
    end
  end
  if not feature then
    mmp.echo("No feature like " .. partialFeatureName .. " found.")
    return
  end
  local possibleRooms = searchRoomUserData("feature-" .. feature, "true")
  closestFeature, outoftime, checkedsofar = mmp.getShortestOfMultipleRooms(possibleRooms)
  if closestFeature == 0 then
    if outoftime then
      mmp.echo(
        string.format(
          "I checked %d of the %d possible features \"%s\" has, but none of the ways there worked and it was taking too long :( try doing this again?",
          checkedsofar,
          table.size(possibleRooms),
          partialFeatureName
        )
      )
    else
      mmp.echo(
        "Checked " ..
        table.size(possibleRooms) ..
        " rooms with that feature, and none of them worked :( I Don't know how to get you there."
      )
    end
    mmp.speedWalkPath = {}
    mmp.speedWalkDir = {}
    mmp.speedWalkCounter = 0
    raiseEvent("mmapper failed path")
    raiseEvent("mmp clear externals")
    return
  end
  raiseEvent("mmp clear externals")
  mmp.gotoRoom(closestFeature, dashtype, "room")
end</script>
							<eventHandlerList>
								<string>RoomNum</string>
								<string>gmcp.Room.Info</string>
							</eventHandlerList>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>mmp.wentOutside</name>
							<packageName></packageName>
							<script>--genericized version of the went_outside event handlers.
--when you go outside, it sees if a shorter path can be found using external links. If so, routes you on the new path instead.
function mmp.wentOutside()
  if
    not mmp.autowalking or
    (mmp.currentroom == mmp.speedWalkPath[#mmp.speedWalkPath]) or
    table.contains(gmcp.Room.Info.details, "indoors") or
    table.contains(gmcp.Room.Info.details, "considered indoors") or
    mmp.orbed(mmp.currentroom)
  then
    return
  end
  -- repath, maybe that'll allow us to use wings now.
  local previousDirection = mmp.speedWalkDir[mmp.speedWalkCounter + 1]
  if mmp.speedWalk.type == "room" then
    raiseEvent("mmp link externals")
    mmp.getPath(mmp.currentroom, mmp.speedWalkPath[#mmp.speedWalkPath])
    raiseEvent("mmp clear externals")
    -- don't need to check return value since that fact shouldnt've changed
  else
    mmp.gotoAreaID(getRoomArea(mmp.speedWalkPath[#mmp.speedWalkPath]))
  end
  -- if our path didn't change, re-instate it as it was (since the new path starts from this room that we checked at)
  if speedWalkDir[1] ~= previousDirection then
    mmp.speedWalkCounter = 0
    mmp.echo("We got outside - going to shortcut with travel device.")
    if mmp.speedWalk.type == "room" then
      mmp.gotoRoom(mmp.speedWalkPath[#mmp.speedWalkPath])
    else
      mmp.gotoAreaID(getRoomArea(mmp.speedWalkPath[#mmp.speedWalkPath]))
    end
    mmp.ignore_speedwalking = true
  end
end</script>
							<eventHandlerList>
								<string>mmapper went outside</string>
								<string>mmapper changed continent</string>
							</eventHandlerList>
						</Script>
						<ScriptGroup isActive="yes" isFolder="yes">
							<name>Wings and other fast travel</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>Wings functions</name>
								<packageName></packageName>
								<script>local exitsCreated = exitsCreated or {}

function mmp.tempSpecialExit(start, destination, command, weight)
  if type(destination) == "string" then
    -- no start room given, so shift all arguments one to the right
    start, destination, command, weight = mmp.currentroom, start, destination, command
  end
  table.insert(exitsCreated, {room = start, command = command})
  addSpecialExit(start, destination, command)
  if weight then
    setExitWeight(start, command, weight)
  end
end

function mmp.removeWings()
  --remove all special exits that were created by addWings, then resets the table.
  for _, exit in ipairs(exitsCreated) do
    removeSpecialExit(exit.room, exit.command)
  end
  exitsCreated = {}
end

registerAnonymousEventHandler("mmp clear externals", "mmp.removeWings")</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Achaea</name>
								<packageName></packageName>
								<script>registerAnonymousEventHandler("mmp link externals", "mmp.addWingsAchaea")



function mmp.addWingsAchaea()
  --Trimmed down version of the original function, meant to only be used for wings. (Where the command varies based on several MCONFIGS)

  local function getcmd(word)
    return
      mmp.settings.removewings and
      string.format(
        [[script:sendAll("wear wings", "say *%s %s", "remove wings", false)]],
        (mmp.settings.winglanguage and mmp.settings.winglanguage or ""),
        word
      ) or
      string.format(
        [[script:send("say *%s %s", false)]],
        (mmp.settings.winglanguage and mmp.settings.winglanguage or ""),
        word
      )
  end

  --Achaea stuff!
  if mmp.game ~= "achaea" then
    return
  end
  local area = getRoomArea(mmp.currentroom)
  --WINGS!
  if
    (mmp.settings.duanathar or mmp.settings.duanatharan or mmp.settings.duantahar) and
    not mmp.inside
  then
    --Sarapis wings.
    if mmp.oncontinent(area, "Main") then
      if mmp.settings.duanatharan then
        mmp.tempSpecialExit(4882, getcmd("duanatharan"))
        mmp.tempSpecialExit(3885, getcmd("duanathar"))
      elseif mmp.settings.duantahar then
        mmp.tempSpecialExit(42319, getcmd("duanathar"))
        mmp.tempSpecialExit(4882, getcmd("duanatharan"))
      else
        mmp.tempSpecialExit(3885, getcmd("duanathar"))
      end
      --Meropis Wings
    elseif mmp.oncontinent(area, "Meropis") then
      if mmp.settings.duanatharan then
        mmp.tempSpecialExit(51603, getcmd("duanatharan"))
        mmp.tempSpecialExit(51188, getcmd("duanathar"))
      elseif mmp.settings.duantahar then
        mmp.tempSpecialExit(42319, getcmd("duanathar"))
        mmp.tempSpecialExit(51603, getcmd("duanatharan"))
      else
        mmp.tempSpecialExit(51188, getcmd("duanathar"))
      end
    end
  end
  --Island wings.
  if mmp.settings.duanatharic and not mmp.inside then
    if
      mmp.oncontinent(area, "Main") or
      mmp.oncontinent(area, "Arcadia") or
      mmp.oncontinent(area, "Outer") or
      mmp.oncontinent(area, "Meropis") or
      mmp.oncontinent(area, "Island") or
      mmp.oncontinent(area, "North")
    then
      mmp.tempSpecialExit(47571, getcmd("duanatharic"))
    end
  end
  -- Stratospheric Harness support -- PapaGuacamole
  if mmp.settings.harness and not mmp.inside then
    -- eastern isles
    if mmp.oncontinent(area, "Eastern_Isles") then
      mmp.tempSpecialExit(54231, "Shake Harness")
      -- northern isles
    elseif mmp.oncontinent(area, "Northen_Isles") then
      mmp.tempSpecialExit(48719, "Shake Harness")
      -- western isles
    elseif mmp.oncontinent(area, "Western_Isles") then
      mmp.tempSpecialExit(54632, "Shake Harness")
    end
  end
  -- Air Elemental Aero Soar
  if mmp.settings.soar and not mmp.inside then
    --Sarapis soar.
    if mmp.oncontinent(area, "Main") then
      if
        gmcp.Char.Status.class == "air Elemental Lord" or
        gmcp.Char.Status.class == "air Elemental Lady"
      then
        mmp.tempSpecialExit(4882, "aero soar high", 10)
        -- duanatharan
        mmp.tempSpecialExit(3885, "aero soar low", 10)
        -- duanathar
        mmp.tempSpecialExit(54173, "aero soar stratosphere", 10)
        -- Stratosphere!
      end
      --Meropis soar
    elseif mmp.oncontinent(area, "Meropis") then
      if
        gmcp.Char.Status.class == "air Elemental Lord" or
        gmcp.Char.Status.class == "air Elemental Lady"
      then
        mmp.tempSpecialExit(51603, "aero soar high", 10)
        -- duanatharan
        mmp.tempSpecialExit(51188, "aero soar low", 10)
        -- duanathar
        mmp.tempSpecialExit(54173, "aero soar stratosphere", 10)
        -- Stratosphere!
      end
    end
  end
  --universe tarot
  if mmp.settings.universe and mmp.oncontinent(area, "Main") then
    local tarotLocations =
      {
        azdun = 1772,
        blackrock = 10573,
        bitterfork = 25093,
        genji = 10091,
        manusha = 8730,
        newthera = 20386,
        caerwitrin = 17678,
        shastaan = 2855,
        mannaseh = 1745,
        manara = 9124,
        brasslantern = 30383,
        mhojave = 39103,
        thraasi = 35703,
        newhope = 25581,
      }
    for village, roomnum in pairs(tarotLocations) do
      mmp.tempSpecialExit(
        roomnum,
        [=[script:
        mmp.customwalkdelay(4.5)
        send("fling universe at ground",false)
        tempTimer(4,[[send("touch ]=] ..
        village ..
        [=[",false)]])
        ]=],
        10
      )
    end
  end
  --gare
  if mmp.settings.gare and gmcp.Char and string.match(gmcp.Char.Status.race, "Dragon") then
    if
      mmp.oncontinent(area, "Main") or
      mmp.oncontinent(area, "Meropis") or
      mmp.oncontinent(area, "Island") or
      mmp.oncontinent(area, "North") or
      mmp.oncontinent(area, "Arcadia")
    then
      mmp.tempSpecialExit(
        12695,
        [=[script:
        mmp.customwalkdelay(4.5)
        send("pierce the veil",false)
        ]=],
        20
      )
    end
  end
  mmp.clearpathcache()
end</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Achaea betterWings</name>
								<packageName></packageName>
								<script>--builds a table based on current orb settings, then returns a function which can be used to quickly check that table.

local function orbedBlackList()
  local bannedAreas = {}
  local areaTable = mmp.getAchaeaOrbTable()
  for org, areas in pairs(areaTable) do
    for _, area in pairs(areas) do
      bannedAreas[area] = mmp.settings["orb" .. org]
    end
  end
  return
    function(roomId)
      return not bannedAreas[getRoomArea(roomId)]
    end
end

--searches for closest room that meets requirements.
--does stuff to handle weighted rooms, locked rooms, special exits.

local function closestOutdoors(startRoom)
--visited is rooms which have already been found by the search.
  local visited = {[startRoom] = true}
  --checking is the rooms that it is currently checking to see if they meet the desired conditions.
  local checking = {[startRoom] = true}
  --nextCheck is a list of rooms which will be checked once the algorithm is finished with the rooms in checking.
  local nextCheck = {}
  --weightedRooms contains rooms with greater than 1 weight, so that they can be handled differently.
  local weightedRooms = {}
  local orbed = orbedBlackList()

  --functions for handling weighted rooms.
  local function addWeighted(room, weight)
    if not weightedRooms[room] or weight &lt; weightedRooms[room] then
      weightedRooms[room] = weight
    end
  end

  --this function subtracts 1 from every room weight in the weighted room list.
  --if they hit zero then it will add them to the checking table and removes them from weightedRooms

  local function reduceWeights()
    --display(weightedRooms)
    local toDelete = {}
    for room, weight in pairs(weightedRooms) do
      weightedRooms[room] = weightedRooms[room] - 1
      if weightedRooms[room] &lt;= 0 then
        if not visited[room] then
          checking[room] = true
          visited[room] = true
        end
        toDelete[room] = true
      end
    end
    --cleans up the weighted stuff.
    for room, _ in pairs(toDelete) do
      weightedRooms[room] = nil
    end
  end

  local stopwatch = createStopWatch()
  startStopWatch(stopwatch)
  --only willing to search for 500ms. Will abort in longer cases,
  while getStopWatchTime(stopwatch) &lt; .5 do
    for room, val in pairs(checking) do
      --if these conditions are met, returns a roomid and exits out.
      --probably doesn't work great on weird planes, as when off plane, the room returned may not work for wings.
      if getRoomUserData(room, "outdoors") == "y" and orbed(room) then
        return room
      end
      local weights = getExitWeights(room)
      --loops through all exits in the room, doing stuff.
      for direction, destRoom in pairs(getRoomExits(room)) do
        if not mmp.hasExitLock(room, direction) and not visited[destRoom] then
          --if the exit+roomweight is higher than 1 (the default, for 1 room weight + 0 exit weight), then do a room weight subroutine
          if
            (((weights[direction] or 0) + getRoomWeight(destRoom)) &gt; 1) and not roomLocked(destRoom)
          then
            addWeighted(destRoom, (weights[direction] or 0) + getRoomWeight(destRoom))
          else
            --add it to visited, so it doesn't double back on it in the future.
            visited[destRoom] = true
            --if it's not locked, add it to nextCheck, which are the rooms that it searches through next cycle.
            --if it is locked, just ignore it.
            if not roomLocked(destRoom) then
              nextCheck[destRoom] = true
            end
          end
        end
      end
      --same as above loop, but for specialExits
      for destRoom, specialExits in pairs(getSpecialExits(room)) do
        for specialExit, locked in pairs(specialExits) do
          if locked == "0" and not visited[destRoom] then
            if
              (((weights[direction] or 0) + getRoomWeight(destRoom)) &gt; 1) and
              not roomLocked(destRoom)
            then
              addWeighted(destRoom, (weights[direction] or 0) + getRoomWeight(destRoom))
            else
              visited[destRoom] = true
            end
            if not roomLocked(destRoom) then
              nextCheck[destRoom] = true
            end
          end
        end
      end
    end
    --replaces checking with the next set of rooms to check, and clears nextCheck.
    checking, nextCheck = nextCheck, {}
    reduceWeights()
    --if no rooms on checking and weightedRooms, exits out.
    --If no rooms in checking but there are rooms in weightedRooms, it will iterate down the weights until something is in checking.
    if not next(checking) then
      if next(weightedRooms) then
        while next(weightedRooms) and not next(checking) do
          reduceWeights()
        end
      else
        return
      end
    end
  end
end

--does the actual linking and stuff. Mostly copied over from the main wings script.
--however, half of the checks have been removed because they were already done in the process
--of searching for a valid outdoors room.

local function linkWingsRemote(room)
  local function getcmd(word)
    return
      mmp.settings.removewings and
      string.format(
        [[script:sendAll("wear wings", "say *%s %s", "remove wings", false)]],
        (mmp.settings.winglanguage and mmp.settings.winglanguage or ""),
        word
      ) or
      string.format(
        [[script:send("say *%s %s", false)]],
        (mmp.settings.winglanguage and mmp.settings.winglanguage or ""),
        word
      )
  end

  --decided to pull this out and set it as a local variable instead of calling it 20x throughout the script.
  local area = getRoomArea(room)
  --sarapis wings
  if (mmp.settings.duanathar or mmp.settings.duanatharan or mmp.settings.duantahar) then
    if mmp.oncontinent(area, "Main") then
      if mmp.settings.duanatharan then
        mmp.tempSpecialExit(room, 4882, getcmd("duanatharan"))
        mmp.tempSpecialExit(room, 3885, getcmd("duanathar"))
      elseif mmp.settings.duantahar then
        mmp.tempSpecialExit(room, 42319, getcmd("duanathar"))
        mmp.tempSpecialExit(room, 4882, getcmd("duanatharan"))
      else
        mmp.tempSpecialExit(room, 3885, getcmd("duanathar"))
      end
      --Meropis Wings
    elseif mmp.oncontinent(area, "Meropis") then
      if mmp.settings.duanatharan then
        mmp.tempSpecialExit(room, 51603, getcmd("duanatharan"))
        mmp.tempSpecialExit(room, 51188, getcmd("duanathar"))
      elseif mmp.settings.duantahar then
        mmp.tempSpecialExit(room, 42319, getcmd("duanathar"))
        mmp.tempSpecialExit(room, 51603, getcmd("duanatharan"))
      else
        mmp.tempSpecialExit(room, 51188, getcmd("duanathar"))
      end
    end
  end
  --island wings
  if
    mmp.settings.duanatharic and
    (
      mmp.oncontinent(area, "Main") or
      mmp.oncontinent(area, "Arcadia") or
      mmp.oncontinent(area, "Outer") or
      mmp.oncontinent(area, "Meropis") or
      mmp.oncontinent(area, "Island") or
      mmp.oncontinent(area, "North")
    )
  then
    mmp.tempSpecialExit(room, 47571, getcmd("duanatharic"))
  end
  if mmp.settings.harness then
    -- eastern isles
    if mmp.oncontinent(area, "Eastern_Isles") then
      mmp.tempSpecialExit(room, 54231, "Shake Harness")
      -- northern isles
    elseif mmp.oncontinent(area, "Northen_Isles") then
      mmp.tempSpecialExit(room, 48719, "Shake Harness")
      -- western isles
    elseif mmp.oncontinent(area, "Western_Isles") then
      mmp.tempSpecialExit(room, 54632, "Shake Harness")
    end
  end
  if mmp.settings.soar then
    --Sarapis soar.
    if mmp.oncontinent(area, "Main") then
      if
        gmcp.Char.Status.class == "air Elemental Lord" or
        gmcp.Char.Status.class == "air Elemental Lady"
      then
        mmp.tempSpecialExit(room, 4882, "aero soar high", 10)
        -- duanatharan
        mmp.tempSpecialExit(room, 3885, "aero soar low", 10)
        -- duanathar
        mmp.tempSpecialExit(room, 54173, "aero soar stratosphere", 10)
        -- Stratosphere!
      end
      --Meropis soar
    elseif mmp.oncontinent(area, "Meropis") then
      if
        gmcp.Char.Status.class == "air Elemental Lord" or
        gmcp.Char.Status.class == "air Elemental Lady"
      then
        mmp.tempSpecialExit(room, 51603, "aero soar high", 10)
        -- duanatharan
        mmp.tempSpecialExit(room, 51188, "aero soar low", 10)
        -- duanathar
        mmp.tempSpecialExit(room, 54173, "aero soar stratosphere", 10)
        -- Stratosphere!
      end
    end
  end
  mmp.clearpathcache()
end

--is called when you do pathfinding.

function mmp.achaeaBetterWings()
  --if you're not on achaea, or the crowdmap is not enabled, or the room you're in is flagged as outdoors, exit out.
  if
    (mmp.game ~= "achaea") or
    (not mmp.settings.betterwings) or
    (not mmp.settings.crowdmap) or
    (getRoomUserData(mmp.currentroom, "outdoors") == "y" and orbedBlackList()(mmp.currentroom))
  then
    return
  end
  --if none of the shortcut items are enabled, return.
  if
    not (
      mmp.settings.duanathar or
      mmp.settings.duantahar or
      mmp.settings.duanatharan or
      mmp.settings.soar or
      mmp.settings.harness or
      mmp.settings.duanatharic
    )
  then
    return
  end
  --find closest room, if that function returned something useful, call above function to create temporary remote special exits depending on settings.
  local closestRoom = closestOutdoors(mmp.currentroom)
  if closestRoom then
    if mmp.debug then
      mmp.echo("Closest outdoors room found at "..closestRoom)
    end
    linkWingsRemote(closestRoom)
  end
end

registerAnonymousEventHandler("mmp link externals", "mmp.achaeaBetterWings")</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Lusternia</name>
								<packageName></packageName>
								<script>registerAnonymousEventHandler("mmp link externals", "mmp.addWingsLusternia")

function mmp.addWingsLusternia()
  if mmp.game ~= "lusternia" then
    return
  end
  --items that use standard bix rules
  if mmp.usebix() then
    --cubix and things
    if mmp.settings.medallion then
      mmp.tempSpecialExit(13367, "touch medallion")
    end
    if mmp.settings.cubix then
      mmp.tempSpecialExit(6184, "touch cubix")
    end
    if mmp.settings.torus and mmp.usebix() then
      mmp.tempSpecialExit(28548, "touch torus")
    end
    --epic quest items
    if mmp.settings.fingerblade then
      mmp.tempSpecialExit(18777, "touch fingerblade")
    end
    if mmp.settings.blossom then
      mmp.tempSpecialExit(18730, "touch blossom")
    end
    if mmp.settings.mandala then
      mmp.tempSpecialExit(19563, "touch mandala")
    end
    if mmp.settings.belt then
      mmp.tempSpecialExit(19627, "touch enlightened")
    end
    if mmp.settings.mantle then
      mmp.tempSpecialExit(18762, "touch starlight")
    end
    if mmp.settings.key then
      mmp.tempSpecialExit(18732, "touch key")
    end
  end
  --things which use prism rules
  if mmp.useprism() then
    if mmp.settings.prism then
      mmp.tempSpecialExit(6182, "touch prism")
    end
    --curio collections
    if mmp.settings.bonecurio then
      mmp.tempSpecialExit(28613, "curio collection activate bone")
    end
    if mmp.settings.flowercurio then
      mmp.tempSpecialExit(28624, "curio collection activate flower")
    end
    if mmp.settings.utensilcurio then
      mmp.tempSpecialExit(28617, "curio collection activate utensil")
    end
    if mmp.settings.fluttercurio then
      mmp.tempSpecialExit(28622, "curio collection activate flutter")
    end
    if mmp.settings.toolcurio then
      mmp.tempSpecialExit(28586, "curio collection activate tool")
    end
    if mmp.settings.facecurio then
      mmp.tempSpecialExit(28433, "curio collection activate face")
    end
    if mmp.settings.toycurio then
      mmp.tempSpecialExit(21548, "curio collection activate toy")
    end
    if mmp.settings.feathercurio then
      mmp.tempSpecialExit(28591, "curio collection activate feather")
    end
    if mmp.settings.figurecurio then
      mmp.tempSpecialExit(28312, "curio collection activate figure")
    end
    if mmp.settings.vernalcurio then
      mmp.tempSpecialExit(29908, "curio collection activate vernal")
    end
    if mmp.settings.soullesscurio then
      mmp.tempSpecialExit(29909, "curio collection activate soulless")
    end
  end
  --all the bubblixes!
  local bubblixes =
    {
      {
        setting = "figurine",
        item = "icebix",
        room = 23187,
        areas = {"Northern Icewynd Mountains", "Southern Icewynd Mountains"},
      },
      {setting = "twist", item = "diobix", room = 18203, areas = {"Mount Dio"}},
      {setting = "snowglobe", item = "treebix", room = 10992, areas = {"the Great Spirit Tree"}},
      {setting = "periscope", item = "aquabix", room = 36073, areas = {"Aquagoria"}},
      {setting = "pebble", item = "lyraabix", room = 33825, areas = {"Lyraa Ey Rielys"}},
      {setting = "shard", item = "xionbix", room = 12652, areas = {"the Workshop of Xion"}},
      {setting = "cookie", item = "crumbix", room = 9888, areas = {"Crumkindivia"}},
      {setting = "wheel", item = "drambix", room = 10509, areas = {"the Dramube Triangle"}},
      {setting = "head", item = "bottlebix", room = 11811, areas = {"the Bubble of Bottledowns"}},
      {setting = "icicle", item = "frostbix", room = 10457, areas = {"Frosticia"}},
      {setting = "screwdriver", item = "facbix", room = 10185, areas = {"the Facility"}},
      {setting = "mud", item = "mucklebix", room = 9985, areas = {"Mucklemarsh"}},
      {
        setting = "tibia",
        item = "cankerbix",
        room = 11600,
        areas = {"the Cankermore Battlegrounds"},
      },
    }
  local shortcutCreated = false
  for _, bubblix in pairs(bubblixes) do
    if mmp.settings[bubblix.setting] then
      local command = "touch " .. bubblix.item
      if not shortcutCreated then
        --for the first bubblix in the list, let it be used as a shortcut to aetherplex.
        mmp.tempSpecialExit(bubblix.room, 6831, command)
        shortcutCreated = true
      end
      --for every bix, create an exit from outside aetherplex to the bubble.
      mmp.tempSpecialExit(148, bubblix.room, command)
      if mmp.usebubblix() then
        if table.contains(bubblix.areas, gmcp.Room.Info.area) then
          mmp.tempSpecialExit(mmp.currentroom, 6831, command)
        elseif not table.contains(gmcp.Room.Info.details, "an Aetherbubble") then
          mmp.tempSpecialExit(mmp.currentroom, bubblix.room, command)
        end
      end
    end
  end
  --one use button travel!
  if mmp.settings.buttons then
    local colors =
      {
        blue = 36073,
        brown = 11811,
        black = 11600,
        yellow = 9888,
        red = 10509,
        steel = 10185,
        white = 10457,
        purple = 47812,
        green = 9985,
        crystal = 12652,
        wooden = 10992,
      }
    local exitScript = [[script:sendAll("outr %sbutton", "touch %sbutton", false)]]
    if
      table.contains(gmcp.Room.Info.details, "the Prime Material Plane") and
      table.contains(gmcp.Room.Info.details, "outdoors")
    then
      for color, room in pairs(colors) do
        mmp.tempSpecialExit(mmp.currentroom, room, exitScript:format(color, color), 20)
      end
    else
      for color, room in pairs(colors) do
        mmp.tempSpecialExit(148, room, exitScript:format(color, color), 20)
      end
    end
  end
  --basin of life specific travel devices
  if mmp.settings.compass then
    local startingRoom = mmp.lusterniaInBasin() and mmp.currentroom or 148
    local compassPoints =
      {
        north = 21695,
        northeast = 10742,
        northwest = 6546,
        east = 9789,
        southeast = 14998,
        south = 10670,
        southwest = 19613,
        west = 20037,
      }
    for direction, destinationRoom in pairs(compassPoints) do
      mmp.tempSpecialExit(startingRoom, destinationRoom, "Touch compass " .. direction, 40)
    end
  end
  mmp.clearpathcache()
end</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Imperian</name>
								<packageName></packageName>
								<script>registerAnonymousEventHandler("mmp link externals", "mmp.addWingsImperian")
mmp.imperian = mmp.imperian or {}

function mmp.addWingsImperian()
  local function getcmd(word)
    return
      mmp.settings.removewings and
      [[script:if mmp.flying then sendAll("queue eqbal wear wings","queue eqbal say ]] ..
      word ..
      [[","queue eqbal remove wings",false) else sendAll("wear wings","fly",false) end]] or
      [[script:if mmp.flying then sendAll("queue eqbal say ]] ..
      word ..
      [[",false) else sendAll("fly",false) end]]
  end

  if
    (mmp.settings.shekinah or mmp.settings.suriel) and
    gmcp.Room and
    not table.contains(gmcp.Room.Info.details, "indoors") and
    not table.contains(gmcp.Room.Info.details, "considered indoors") and
    table.contains(mmp.imperian.wingAbleAreas, getRoomArea(mmp.currentroom))
  then
    if mmp.settings.shekinah then
      -- Seraphim wings - "Say shekinah"
      local weight = 15
      if mmp.flying then
        weight = 1
      end
      mmp.tempSpecialExit(4882, getcmd("shekinah"), weight)
    elseif mmp.settings.suriel then
      -- Using Orphanim wings, SURIEL works, takes you to 3885
      local weight = 15
      if mmp.flying == "1" then
        weight = 1
      end
      mmp.tempSpecialExit(3885, getcmd("suriel"), weight)
      -- clear cache so mmp.getPath accounts for the new way
    end
  end
  mmp.clearpathcache()
end

mmp.imperian.wingAbleAreas =
  {
    45,
    35,
    15,
    56,
    101,
    123,
    36,
    110,
    18,
    75,
    172,
    9,
    66,
    148,
    113,
    175,
    188,
    244,
    88,
    171,
    118,
    295,
    167,
    25,
    139,
    70,
    132,
    28,
    135,
    174,
    8,
    275,
    107,
    53,
    112,
    185,
    158,
    164,
    299,
    74,
    351,
    16,
    63,
    269,
    77,
    85,
    142,
    328,
    318,
    46,
    95,
    17,
    329,
    33,
    96,
    82,
    47,
    144,
    121,
    3,
    68,
    51,
    134,
    1,
    319,
    11,
    19,
    129,
    146,
    65,
    324,
    325,
    125,
    191,
    163,
    30,
    54,
    292,
    290,
    7,
    136,
    267,
    335,
    102,
    43,
    89,
    20,
    169,
    49,
    147,
    196,
    301,
    252,
    99,
    145,
    195,
    130,
    42,
    270,
    166,
    128,
    168,
    34,
    223,
    170,
    22,
    27,
    138,
    115,
    337,
    44,
    6,
    161,
    32,
    92,
    83,
    294,
    104,
    69,
    23,
    155,
    350,
    48,
    57,
    150,
    97,
    341,
    105,
    340,
    5,
    194,
    338,
    327,
    271,
    323,
    322,
    79,
    122,
    62,
    131,
    176,
    133,
    310,
    307,
    120,
    137,
    13,
    76,
    160,
    60,
    304,
    94,
    306,
    303,
    81,
    291,
    276,
    302,
    149,
    297,
    179,
    272,
    41,
    293,
    289,
    91,
    159,
    71,
    157,
    298,
    266,
    208,
    109,
    80,
    14,
    2,
    186,
    12,
    178,
    52,
    124,
    274,
    141,
    343,
    177,
    67,
    103,
    111,
    72,
    268,
    87,
    117,
    21,
    353,
    253,
    93,
    308,
    40,
    248,
    243,
    4,
    153,
    212,
    116,
    84,
    197,
    61,
    78,
    184,
    173,
    31,
    98,
    114,
    162,
    50,
    37,
    140,
    73,
    127,
    156,
    90,
    100,
    143,
    309,
    126,
  }</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Aetolia</name>
								<packageName></packageName>
								<script>registerAnonymousEventHandler("mmp link externals", "mmp.addWingsAetolia")



function mmp.addWingsAetolia()
  if mmp.game ~= "aetolia" then return end
  
  --Check plane / continent
  if mmp.aetoliaPlane == "the Prime Material Plane" and mmp.aetoliaContinent == "the Continent of Sapience" and
  --health check
  tonumber(gmcp.Char.Vitals.hp)/tonumber(gmcp.Char.Vitals.maxhp)&gt;.95 and 
  --mana check
  tonumber(gmcp.Char.Vitals.mp)/tonumber(gmcp.Char.Vitals.maxmp)&gt;.95 then
  
      --eagle wings
      if mmp.settings.duanathar or mmp.settings.duanatharan then
        mmp.tempSpecialExit(3885, "say duanathar")
      end
      --atavian wings
      if mmp.settings.duanatharan then
        mmp.tempSpecialExit(4882, "say duanatharan")
      end
      
      if mmp.settings.voltda or mmp.settings.voltdaran then
        mmp.tempSpecialExit(19911,"say voltda")
      end
      
      if mmp.settings.voltdaran then
        mmp.tempSpecialExit(19912,"say voltdaran")
      end
      
      
  
  end
end</script>
								<eventHandlerList />
							</Script>
						</ScriptGroup>
						<Script isActive="yes" isFolder="no">
							<name>Utilities</name>
							<packageName></packageName>
							<script>-- functions internal to the mapper

function mmp.highlight_unfinished_rooms()
	if not mmp.areatable then return end
	for a,b in pairs (mmp.areatable) do
		local roomList = getAreaRooms(b) or {}
		for c,d in pairs (roomList) do
			if (getRoomName(d) == "") then
				local fgr,fgg,fgb = unpack(color_table.red)
				local bgr,bgg,bgb = unpack(color_table.blue)
				highlightRoom(d, fgr,fgg,fgb,bgr,bgg,bgb, 1, 100, 100)
			end
		end
	end
end

function mmp.usebix()
	if mmp.game ~= "lusternia" then return end

	if (table.contains(gmcp.Room.Info.details, "the Prime Material Plane") or
		table.contains(gmcp.Room.Info.details, "the Ethereal Plane") or
		table.contains(gmcp.Room.Info.details, "the Water Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Air Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Fire Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Earth Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "Celestia, Plane of Light") or
		table.contains(gmcp.Room.Info.details, "the Tainted Plane of Nil") or
		table.contains(gmcp.Room.Info.details, "the Cosmic Plane of Continuum") or
		table.contains(gmcp.Room.Info.details, "the Cosmic Plane of Vortex") or
		table.contains(gmcp.Room.Info.details, "the Astral Plane")) and
        gmcp.Room.Info.area ~= "the City of Climanti" and
		table.contains(gmcp.Room.Info.details, "outdoors") then
		return true
	end
	return false
end

function mmp.useprism()
	if mmp.game ~= "lusternia" then return end
	if (table.contains(gmcp.Room.Info.details, "the Prime Material Plane") or
	table.contains(gmcp.Room.Info.details, "the Ethereal Plane") or
	table.contains(gmcp.Room.Info.details, "the Water Elemental Plane") or
	table.contains(gmcp.Room.Info.details, "the Air Elemental Plane") or
	table.contains(gmcp.Room.Info.details, "the Fire Elemental Plane") or
	table.contains(gmcp.Room.Info.details, "the Earth Elemental Plane")) and
    gmcp.Room.Info.area ~= "the City of Climanti" and
	table.contains(gmcp.Room.Info.details, "outdoors") then
		return true
	end
	return false
end
function mmp.usebubblix()
	if mmp.game ~= "lusternia" then return end

	if ((table.contains(gmcp.Room.Info.details, "the Prime Material Plane") or
		table.contains(gmcp.Room.Info.details, "the Ethereal Plane") or
		table.contains(gmcp.Room.Info.details, "the Water Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Air Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Fire Elemental Plane") or
		table.contains(gmcp.Room.Info.details, "the Earth Elemental Plane")) and
        gmcp.Room.Info.area ~= "the City of Climanti" and
		table.contains(gmcp.Room.Info.details, "outdoors")) or
		table.contains(gmcp.Room.Info.details, "an Aetherbubble") then
		return true
	end
	return false
end</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>Locating &amp; echoing functions</name>
								<packageName></packageName>
								<script>function mmp.filterRooms(rooms, area)
  local unassignedRooms = {}
  local areaRooms = {}
  for roomnum, roomname in pairs(rooms) do
    local roomarea = getRoomUserData(roomnum, "Game Area")
    if roomarea == "" then
      unassignedRooms[roomnum] = roomname
    elseif roomarea == area then
      areaRooms[roomnum] = roomname
    end
  end
  return next(areaRooms) and areaRooms or unassignedRooms
end

-- for a given room name, we'll echo all the vnums

function mmp.echonums(roomname, area)
  local t = mmp.searchRoomExact(roomname)
  if area then
    t = mmp.filterRooms(t, area)
  end
  if not next(t) then
    echo("?")
    return nil
  end
  -- transform the kv table into a table of tables for cleaner code.
  -- + perhaps Mudlet in future will give this us anyway, sorted by relevancy
  local dt = {}
  for roomid, room in pairs(t) do
    dt[#dt + 1] = {name = room, id = roomid}
  end
  -- we can have nothing if we asked for exact match
  if not dt[1] then
    echo("?---")
    return
  end
  -- display first three ids. Can't really nicely table.concat them.
  cechoLink(
    "&lt;" .. mmp.settings.echocolour .. "&gt;" .. dt[1].id,
    'mmp.gotoRoom(' .. dt[1].id .. ')',
    string.format("Go to %s (%s)", dt[1].id, dt[1].name),
    true
  )
  if not dt[2] then
    return
  end
  echo(", ")
  cechoLink(
    "&lt;" .. mmp.settings.echocolour .. "&gt;" .. dt[2].id,
    'mmp.gotoRoom(' .. dt[2].id .. ')',
    string.format("Go to %s (%s)", dt[2].id, dt[2].name),
    true
  )
  if not dt[3] then
    return
  end
  echo(", ")
  cechoLink(
    "&lt;" .. mmp.settings.echocolour .. "&gt;" .. dt[3].id,
    'mmp.gotoRoom(' .. dt[3].id .. ')',
    string.format("Go to %s (%s)", dt[3].id, dt[3].name),
    true
  )
  if not dt[4] then
    return
  end
  echo(", ...")
end

function mmp.roomEcho(query)
  local result = mmp.searchRoom(query)
  if not tonumber(select(2, next(result))) then
    for roomid, roomname in pairs(result) do
      roomid = tonumber(roomid)
      cecho("&lt;DarkSlateGrey&gt; (")
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho("&lt;DarkSlateGrey&gt;)")
    end
  else
    for roomname, roomid in pairs(result) do
      roomid = tonumber(roomid)
      cecho("&lt;DarkSlateGrey&gt; (")
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho("&lt;DarkSlateGrey&gt;)")
    end
  end
end

function mmp.locateAndEcho(room, person, area)
  local t = mmp.searchRoomExact(room)
  if area then
    t = mmp.filterRooms(t, area)
  end
  echo("  (")
  mmp.echonums(room, area)
  echo(")")
  -- lowercase results
  for k, v in pairs(t) do
    if tonumber(k) then
      t[k] = v:lower()
    else
      t[k:lower()] = v
    end
  end
  if not (t[room:lower()] or table.contains(t, room:lower())) then
    return
  end
  echo("\n")
  if table.size(t) == 1 then
    local k, v = next(t)
    cecho(
      "&lt;red&gt;From your knowledge, that room is in &lt;orange_red&gt;" ..
      mmp.cleanAreaName(mmp.areatabler[getRoomArea(type(k) == "number" and k or v)] or "?") ..
      "&lt;red&gt;."
    )
  else
    local k, v = next(t)
    local areas = {}
    if type(k) == "number" then
      for k, _ in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    else
      for _, k in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    end
    local flattened_areas = {}
    for k, _ in pairs(areas) do
      if k ~= "" then
        flattened_areas[#flattened_areas + 1] = mmp.cleanAreaName(k)
      end
    end
    cecho(
      "&lt;red&gt;From your knowledge, that room might be in &lt;orange_red&gt;" ..
      table.concat(flattened_areas, ", or ") ..
      "&lt;red&gt;."
    )
  end
  if person then
    mmp.pdb[person] = room
    mmp.pdb_lastupdate[person] = true
    raiseEvent("mmapper updated pdb")
  end
end

function mmp.locateAndEchoSide(room, person)
  local t = mmp.searchRoomExact(room)
  echo("  (")
  mmp.echonums(room)
  echo(")")
  -- lowercase results
  for k, v in pairs(t) do
    if tonumber(k) then
      t[k] = v:lower()
    else
      t[k:lower()] = v
    end
  end
  if not (t[room:lower()] or table.contains(t, room:lower())) then
    return
  end
  --echo"\n"
  if table.size(t) == 1 then
    local k, v = next(t)
    cecho(
      "&lt;red&gt;  (" ..
      mmp.cleanAreaName(mmp.areatabler[getRoomArea(type(k) == "number" and k or v)] or "?") ..
      ")"
    )
  else
    local k, v = next(t)
    local areas = {}
    if type(k) == "number" then
      for k, _ in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    else
      for _, k in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    end
    local flattened_areas = {}
    for k, _ in pairs(areas) do
      if k ~= "" then
        flattened_areas[#flattened_areas + 1] = mmp.cleanAreaName(k)
      end
    end
    cecho("&lt;red&gt; (" .. table.concat(flattened_areas, ", ") .. ")")
  end
  if person then
    mmp.pdb[person] = room
    mmp.pdb_lastupdate[person] = true
    raiseEvent("mmapper updated pdb")
  end
end

function mmp.locateAndEchoInternal(room, person)
  local t = mmp.searchRoomExact(room)
  -- lowercase results
  for k, v in pairs(t) do
    if tonumber(k) then
      t[k] = v:lower()
    else
      t[k:lower()] = v
    end
  end
  if not (t[room:lower()] or table.contains(t, room:lower())) then
    return
  end
  --echo"\n"
  if table.size(t) == 1 then
    local k, v = next(t)
    cecho(
      "&lt;red&gt; in " ..
      mmp.cleanAreaName(mmp.areatabler[getRoomArea(type(k) == "number" and k or v)] or "?") ..
      "."
    )
  else
    local k, v = next(t)
    local areas = {}
    if type(k) == "number" then
      for k, _ in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    else
      for _, k in pairs(t) do
        areas[mmp.areatabler[getRoomArea(k)] or "?"] = true
      end
    end
    local flattened_areas = {}
    for k, _ in pairs(areas) do
      if k ~= "" then
        flattened_areas[#flattened_areas + 1] = mmp.cleanAreaName(k)
      end
    end
    cecho("&lt;red&gt; in " .. table.concat(flattened_areas, ", ") .. ".")
  end
  echo("  (")
  mmp.echonums(room, true)
  echo(")")
  if person then
    mmp.pdb[person] = room
    mmp.pdb_lastupdate[person] = true
    raiseEvent("mmapper updated pdb")
  end
end</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Aliases</name>
								<packageName></packageName>
								<script>function mmp.roomWhoFind(query)
  if query:ends('.') then
    query = query:sub(1, -2)
  end
  local result = mmp.searchRoomExact(query)
  if type(result) == "string" or not next(result) then
    cecho("&lt;CadetBlue&gt;  You have no recollection of any room with that name.")
    return
  end
  if not tonumber(select(2, next(result))) then
    -- old style
    for roomid, roomname in pairs(result) do
      roomid = tonumber(roomid)
      cecho(string.format("  &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt; (", tostring(roomname)))
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho(
        string.format(
          "&lt;DarkSlateGrey&gt;) &lt;white&gt;%s&lt;DarkSlateGrey&gt;.\n",
          tostring(mmp.areatabler[getRoomArea(roomid)])
        )
      )
    end
  else
    -- new style
    for roomname, roomid in pairs(result) do
      roomid = tonumber(roomid)
      cecho(string.format("  &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt; (", tostring(roomname)))
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho(
        string.format(
          "&lt;DarkSlateGrey&gt;) &lt;white&gt;%s&lt;DarkSlateGrey&gt;.\n",
          tostring(mmp.areatabler[getRoomArea(roomid)])
        )
      )
    end
  end
end

function mmp.roomFind(query, lines)
  if query:ends('.') then
    query = query:sub(1, -2)
  end
  local defaultLine = 30 -- this could this to a setting instead of a static number
  local result = mmp.searchRoom(query)
  if lines == 'all' then
    lines = table.size(result)
  end
  lines = (lines ~= '') and tonumber(lines) or defaultLine

  --create a new table (roomsTable) with keys and add areas to the table
  local roomsTable = {}
  for k, v in pairs(result) do
    --not all rooms have an area associated with it in mmp.areatabler so need to either remove those or add one
    local a = mmp.areatabler[getRoomArea(k)] or "unknown"
    roomsTable[#roomsTable + 1] = {num = k, area = a, name = v}
  end
  --sort roomsTable by area name
  table.sort(
    roomsTable,
    function(a, b)
      return a.area &lt; b.area
    end
  )
  --start displaying info
  if type(result) == "string" or not next(result) then
    cecho("&lt;grey&gt;You have no recollection of any room with that name.")
    return
  end
  cecho("&lt;DarkSlateGrey&gt;You know the following relevant rooms:\n")

  local function showmeropis(roomid)
    if mmp.game ~= "achaea" then
      return ''
    end
    return mmp.oncontinent(getRoomArea(roomid), "Main") and '' or ' (Meropis)'
  end

  local i = 1
  if not tonumber(select(2, next(result))) then
    cecho(string.format("&lt;white&gt; %-10s%-40s%s\n", "ROOM ID", "ROOM NAME", "ROOM AREA"))
    for _, v in ipairs(roomsTable) do
      if i &gt; lines then
        break
      end
      roomid = tonumber(v.num)
      roomname = v.name
      roomarea = v.area
      cechoLink(
        string.format("&lt;" .. mmp.settings.echocolour .. "&gt; %-10s", roomid),
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho(string.format("&lt;LightSlateGray&gt;%-40s", string.sub(tostring(roomname), 1, 39)))
      cechoLink(
        string.format(
          "&lt;DarkSlateGrey&gt;%s%s&lt;DarkSlateGrey&gt;\n",
          mmp.cleanAreaName(tostring(mmp.areatabler[getRoomArea(roomid)])),
          showmeropis(roomid)
        ),
        [[mmp.echoPath(mmp.currentroom, ]] .. roomid .. [[)]],
        "Display directions from here to " .. roomname,
        true
      )
      resetFormat()
      i = i + 1
    end
  else
    -- new style
    --- not sure what this new area code is but it doesn't seem to fire
    for roomname, roomid in pairs(result) do
      roomid = tonumber(roomid)
      cecho(string.format("  &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt; (", tostring(roomname)))
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho(
        string.format(
          "&lt;DarkSlateGrey&gt;) in &lt;LightSlateGray&gt;%s%s&lt;DarkSlateGrey&gt;.",
          mmp.cleanAreaName(tostring(mmp.areatabler[getRoomArea(roomid)])),
          showmeropis(roomid)
        )
      )
      fg("DarkSlateGrey")
      echoLink(
        " &gt; Show path\n",
        [[mmp.echoPath(mmp.currentroom, ]] .. roomid .. [[)]],
        "Display directions from here to " .. roomname,
        true
      )
      resetFormat()
    end
  end
  if table.size(result) &lt;= lines then
    cecho(string.format("&lt;DarkSlateGrey&gt;%d rooms found.\n", table.size(result)))
  else
    lastRoomQuery = query
    cechoLink(
      string.format(
        "&lt;DarkSlateGrey&gt;%d of %d rooms shown. Click to see all rooms.\n", lines, table.size(result)
      ),
      'mmp.roomFind(lastRoomQuery, "all")',
      string.format("Show all %d rooms.", table.size(result)),
      true
    )
  end
end

function mmp.echoRoomList(areaname, exact)
  local areaid, msg, multiples = mmp.findAreaID(areaname, exact)
  if areaid then
    local roomlist, endresult = getAreaRooms(areaid) or {}, {}
    -- obtain a room list for each of the room IDs we got
    local getRoomName = getRoomName
    for _, id in pairs(roomlist) do
      endresult[id] = getRoomName(id)
    end
    -- sort room IDs so we can display them in order
    table.sort(roomlist)
    -- now display something half-decent looking
    cecho(
      string.format(
        "&lt;DarkSlateGrey&gt;List of all rooms in &lt;grey&gt;%s&lt;DarkSlateGrey&gt; (areaid &lt;grey&gt;%s&lt;DarkSlateGrey&gt; - &lt;grey&gt;%d&lt;DarkSlateGrey&gt; rooms):\n",
        msg,
        areaid,
        table.size(endresult)
      )
    )
    local echoLink, sformat, fg, echo = echoLink, string.format, fg, cecho
    -- use pairs, as we can have gaps between room IDs
    for _, roomid in pairs(roomlist) do
      local roomname = endresult[roomid]
      fg("blue")
      cechoLink(
        "&lt;" .. mmp.settings.echocolour .. "&gt;" .. sformat("%6s", roomid),
        'mmp.gotoRoom(' .. roomid .. ')',
        string.format("Go to %s (%s)", roomid, tostring(roomname)),
        true
      )
      cecho(string.format("&lt;DarkSlateGrey&gt;: &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt;.\n", roomname))
    end
  elseif not id and #multiples &gt; 0 then
    mmp.echo("For which area would you want to list rooms for?")
    fg("DimGrey")
    for _, areaname in ipairs(multiples) do
      echo("  ");
      setUnderline(true)
      echoLink(
        areaname,
        'mmp.echoRoomList("' .. areaname .. '", true)',
        "Click to view the room list for " .. areaname,
        true
      )
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
  else
    mmp.echo(string.format("Don't know of any area named '%s'.", areaname))
  end
end

function mmp.echoAreaList()
  local list = getAreaTable()
  local ids, rlist = {}, {}
  local totalroomcount = 0
  for area, id in pairs(list) do
    if id ~= 0 then
      ids[#ids + 1] = id;
      rlist[id] = area
    end
  end
  table.sort(ids)
  -- count the amount of rooms in an area, taking care to count the room in the 0th
  -- index as well if there is one
  -- saves the total room count on the side as well

  local function countrooms(areaid)
    local allrooms = getAreaRooms(areaid) or {}
    local areac = (#allrooms or 0) + (allrooms[0] and 1 or 0)
    totalroomcount = totalroomcount + areac
    return areac
  end

  cecho(string.format("&lt;DarkSlateGrey&gt;List of all areas we know of (click to view room list):\n"))
  local getAreaRooms, cecho, fg, echoLink, format, rep =
    getAreaRooms, cecho, fg, echoLink, string.format, string.rep
  for _, id in pairs(ids) do
    cecho(format("&lt;" .. mmp.settings.echocolour .. "&gt;%s%d ", rep(" ", (7 - #tostring(id))), id))
    -- +1 because getAreaRooms starts counting at 0
    fg("DarkSlateGrey")
    echoLink(
      rlist[id] .. (" "):rep(40 - #rlist[id]) .. "(" .. mmp.comma_value(countrooms(id)) .. " rooms)",
      'mmp.echoRoomList("' .. rlist[id] .. '", true)',
      "View the room list for " .. rlist[id],
      true
    )
    echo("\n")
  end
  cecho(
    string.format(
      "&lt;DarkSlateGrey&gt;Total amount of rooms in this map: %s\n", mmp.comma_value(totalroomcount)
    )
  )
end

function mmp.clearLabels(areaid)
  local function clearlabels(areaid)
    local t = getMapLabels(areaid)
    if type(t) ~= "table" then
      return
    end
    for labelid, _ in pairs(t) do
      deleteMapLabel(areaid, labelid)
    end
  end

  if areaid == "map" then
    for areaid in pairs(mmp.areatabler) do
      clearlabels(areaid)
    end
    mmp.echo("Cleared labels in all of the map.")
    return
  end
  clearlabels(areaid)
  mmp.echo(string.format("Cleared all labels in '%s'.", mmp.areatabler[areaid]))
end

function mmp.deleteArea(name, exact)
  local id, fname, ma = mmp.findAreaID(name, exact)
  if id then
    mmp.doareadelete(id)
  elseif next(ma) then
    mmp.echo("Which one of these specifically would you like to delete?")
    fg("DimGrey")
    for _, name in ipairs(ma) do
      echo("  ")
      setUnderline(true)
      echoLink(name, [[mmp.deleteArea("]] .. name .. [[", true)]], "Delete " .. name, true)
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
  else
    mmp.echo("Don't know of that area.")
  end
  raiseEvent("mmp areas changed")
end

-- the function actually doing area deletion

function mmp.doareadelete(areaid)
  mmp.deletingarea = {}
  local t = mmp.deletingarea
  local rooms = getAreaRooms(areaid)
  t.roomcount = table.size(rooms)
  t.roombatches = {}
  t.currentbatch = 1
  t.areaid = areaid
  t.areaname = getAreaTableSwap()[areaid]
  -- delete the area right away if there's nothing in it
  if t.roomcount == 0 then
    deleteArea(t.areaid)
    mmp.echo("All done! The area was already gone/empty.")
  end
  local rooms_per_batch = 100
  -- split up rooms into tables of tables, to be deleted in batches so
  -- that our print statements in between get a chance to be processed
  for batch = 1, t.roomcount, 100 do
    t.roombatches[#t.roombatches + 1] = {}
    local onebatch = t.roombatches[#t.roombatches]
    for inbatch = 1, 100 do
      onebatch[#onebatch + 1] = rooms[batch + inbatch]
    end
  end

  function mmp.deletenextbatch()
    local t = mmp.deletingarea
    if not t then
      return
    end
    local currentbatch = t.roombatches[t.currentbatchi]
    if currentbatch == nil then
      deleteArea(t.areaid)
      mmp.echo("All done! Deleted the '" .. t.areaname .. "' area.")
      mmp.deletingarea = nil
      centerview(mmp.currentroom)
      return
    end
    local deleteRoom = deleteRoom
    for i = 1, #currentbatch do
      deleteRoom(currentbatch[i])
    end
    mmp.echo(
      string.format(
        "Deleted %d batch%s so far, %d left to go - %.2f%% done out of %d needed",
        t.currentbatchi,
        (t.currentbatchi == 1 and '' or 'es'),
        #t.roombatches - t.currentbatchi,
        (100 / #t.roombatches) * t.currentbatchi,
        #t.roombatches
      )
    )
    t.currentbatchi = t.currentbatchi + 1
    tempTimer(0.010, mmp.deletenextbatch)
  end

  t.currentbatchi = 1
  mmp.echo("Prepped room batches, starting deletion...")
  tempTimer(0.010, mmp.deletenextbatch)
end

function mmp.renameArea(name, exact)
  if not (mmp.currentroom or getRoomArea(mmp.currentroom)) then
    mmp.echo("Don't know what area are we in at the moment, to rename it.")
  else
    setAreaName(getRoomArea(mmp.currentroom), name)
    mmp.echo(
      string.format(
        "Renamed %s to %s (%d).",
        mmp.areatabler[getRoomArea(mmp.currentroom)],
        name,
        getRoomArea(mmp.currentroom)
      )
    )
    centerview(mmp.currentroom)
  end
  raiseEvent("mmp areas changed")
end

function mmp.roomArea(otherroom, name, exact)
  local id, fname, ma
  if tonumber(name) then
    id = tonumber(name);
    fname = mmp.areatabler[id]
  else
    id, fname, ma = mmp.findAreaID(name, exact)
  end
  if otherroom ~= "" and not mmp.roomexists(otherroom) then
    mmp.echo("Room id " .. otherroom .. " doesn't seem to exist.")
    return
  elseif otherroom == "" and not mmp.roomexists(mmp.currentroom) then
    mmp.echo("Don't know where we are at the moment.")
    return
  end
  otherroom = otherroom ~= "" and otherroom or mmp.currentroom
  if id then
    setRoomArea(otherroom, id)
    mmp.echo(
      string.format(
        "Moved %s to %s (%d).",
        (getRoomName(otherroom) ~= "" and getRoomName(otherroom) or "''"),
        fname,
        id
      )
    )
    centerview(otherroom)
  elseif next(ma) then
    mmp.echo("Into which area exactly would you like to move the room?")
    fg("DimGrey")
    for _, name in ipairs(ma) do
      echo("  ")
      setUnderline(true)
      echoLink(
        name, [[mmp.roomArea('', "]] .. name .. [[", true)]], "Move the room to " .. name, true
      )
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
  else
    mmp.echo("Don't know of that area.")
  end
end

function mmp.getAreaBorders(areaid)
  if mmp.debug then
    mmp.getAreaBordersTimer = mmp.getAreaBordersTimer or createStopWatch()
    startStopWatch(mmp.getAreaBordersTimer)
  end
  -- make sure we have all exits into the area.
  raiseEvent("mmp link externals")
  local roomlist, endresult = getAreaRooms(areaid), {}
  -- sometimes getAreaRooms can give us no result :(
  if not roomlist then
    mmp.echo(
      "Sorry, seems we can't go there - getAreaRooms(" ..
      areaid ..
      ") didn't give us any results (Mudlet problem - redownloading the map might help fix it)"
    )
    return
  end
  if table.is_empty(roomlist) then
    mmp.echo(
      "Sorry, seems we can't go there - " .. getRoomAreaName(areaid) .. " has no rooms in it."
    )
    return
  end
  -- make a key-value list of room IDs
  local reverselist = {}
  for i = 0, #roomlist do
    reverselist[roomlist[i]] = true
  end
  local getRoomName, contains, pairs = getRoomName, table.contains, pairs
  if getAllRoomEntrances then
    for i = 0, #roomlist do
      local id = roomlist[i]
      local entrancesFrom = getAllRoomEntrances(id)
      for remoteRoomIndex = 1, #entrancesFrom do
        if not reverselist[entrancesFrom[remoteRoomIndex]] then
          endresult[id] = getRoomName(id)
        end
      end
    end
  else
    local getRoomExits, getSpecialExitsSwap = getRoomExits, getSpecialExitsSwap
    -- obtain a room list for each of the room IDs we got
    --for _, id in pairs(roomlist) do
    for i = 0, #roomlist do
      local id = roomlist[i]
      local exits = getRoomExits(id)
      for _, to in pairs(exits) do
        if not reverselist[to] then
          endresult[id] = getRoomName(id)
        end
      end
      local specialexits = getSpecialExitsSwap(id)
      for _, to in pairs(specialexits) do
        if not reverselist[to] then
          endresult[id] = getRoomName(id)
        end
      end
    end
  end
  if mmp.debug then
    mmp.echo(
      "mmp.getAreaBordersTimer() on areaid " ..
      areaid ..
      " took " ..
      stopStopWatch(mmp.getAreaBordersTimer) ..
      "s to run. Returned " ..
      table.size(endresult) ..
      " results."
    )
  end
  -- clean up external exits
  raiseEvent("mmp clear externals")
  return endresult
end

function mmp.viewArea(where, exact)
  if not where or not type(where) == "string" then
    mmp.echo("Which area would you like to view?")
    return
  end
  local areaid, msg, multiples = mmp.findAreaID(where, exact)
  if areaid then
    -- center on the first room ID, which typically is the start of an area
    local rooms = getAreaRooms(areaid) or {}
    if not rooms[1] then
      mmp.echo("The area has no rooms in it.")
    else
      centerview(rooms[1])
    end
  elseif not areaid and #multiples &gt; 0 then
    mmp.echo("Which area would you like to view exactly?")
    fg("DimGrey")
    for _, areaname in ipairs(multiples) do
      echo("  ");
      setUnderline(true)
      echoLink(
        areaname, 'mmp.viewArea("' .. areaname .. '", true)', "Click to view " .. areaname, true
      )
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
    return
  else
    mmp.echo(string.format("Don't know of any area named '%s'.", where))
    return
  end
end

-- room label the room I'm in
-- room label 342 this is a label in room 342
-- room label green this is a green label where I'm at
-- room label green black this is a green to black label where I'm at
-- room label 34 green black this is a green to black label at room 34
-- how it works: split input string into tokens by space, then determine
-- what to do by checking first few tokens, and finally call the local
-- function with the proper arguments

function mmp.roomLabel(input)
  if not createMapLabel then
    mmp.echo(
      "Your Mudlet doesn't support createMapLabel() yet - please update to 2.0-test3 or better."
    )
    return
  end
  local tk = input:split(" ")
  local room, fg, bg, message = mmp.currentroom, "yellow", "red", "Some room label"
  -- input always have to be something, so tk[1] at least always exists
  if tonumber(tk[1]) then
    room = tonumber(table.remove(tk, 1))
    -- remove the number, so we're left with the colors or msg
  end
  -- next: is this a foreground color?
  if tk[1] and color_table[tk[1]] then
    fg = table.remove(tk, 1)
  end
  -- next: is this a background color?
  if tk[1] and color_table[tk[1]] then
    bg = table.remove(tk, 1)
  end
  -- the rest would be our message
  if tk[1] then
    message = table.concat(tk, " ")
  end
  -- if we haven't provided a room ID and we don't know where we are yet, we can't make a label
  if not room then
    mmp.echo("We don't know where we are to make a label here.")
    return
  end
  local x, y, z = getRoomCoordinates(room)
  local f1, f2, f3 = unpack(color_table[fg])
  local b1, b2, b3 = unpack(color_table[bg])
  -- finally: do it :)
  local lid = createMapLabel(getRoomArea(room), message, x, y, z, f1, f2, f3, b1, b2, b3)
  mmp.echo(
    string.format(
      "Created new label #%d '%s' in %s.", lid, message, getRoomAreaName(getRoomArea(room))
    )
  )
end

function mmp.areaLabels(where, exact)
  if not getMapLabels then
    mmp.echo(
      "Your Mudlet doesn't support getMapLabels() yet - please update to 2.0-test3 or better."
    )
    return
  end
  if (not where or not type(where) == "string") and not mmp.currentroom then
    mmp.echo("For which area would you like to view labels?")
    return
  end
  if not where then
    exact = true
    where = getRoomAreaName(getRoomArea(mmp.currentroom))
  end
  local areaid, msg, multiples = mmp.findAreaID(where, exact)
  if areaid then
    local t = getMapLabels(areaid)
    if type(t) ~= "table" or not next(t) then
      mmp.echo(string.format("'%s' doesn't seem to have any labels.", getRoomAreaName(areaid)))
      return
    end
    mmp.echo(string.format("Area labels for '%s'", getRoomAreaName(areaid)))
    for labelid, labeltext in pairs(t) do
      fg("DimGrey")
      echo(string.format("  %d) %s (", labelid, labeltext))
      fg("orange_red")
      setUnderline(true)
      echoLink(
        'delete',
        string.format(
          'deleteMapLabel(%d, %d); mmp.echo("Deleted label #' .. labelid .. '")', areaid, labelid
        ),
        "Delete label #" .. labelid .. " from " .. getRoomAreaName(areaid)
      )
      setUnderline(false)
      echo(")\n")
    end
    resetFormat()
  elseif not areaid and #multiples &gt; 0 then
    mmp.echo("Which area would you like to view exactly?")
    fg("DimGrey")
    for _, areaname in ipairs(multiples) do
      echo("  ");
      setUnderline(true)
      echoLink(
        areaname,
        'mmp.areaLabels("' .. areaname .. '", true)',
        "Click to view labels in " .. areaname,
        true
      )
      setUnderline(false)
      echo("\n")
    end
    resetFormat()
    return
  else
    mmp.echo(string.format("Don't know of any area named '%s'.", where))
    return
  end
end

function mmp.echoPath(from, to)
  assert(tonumber(from) and tonumber(to), "mmp.getPath: both from and to have to be room IDs")
  if mmp.getPath(from, to) then
    mmp.echo(
      "&lt;white&gt;Directions from &lt;yellow&gt;" ..
      string.upper(searchRoom(from)) ..
      " &lt;white&gt;to &lt;yellow&gt;" ..
      string.upper(searchRoom(to)) ..
      "&lt;white&gt;:"
    )
    mmp.echo(table.concat(speedWalkDir, ", "))
    return mmp.speedWalkDir
  else
    mmp.echo(
      "&lt;white&gt;I can't find a way from &lt;yellow&gt;" ..
      string.upper(searchRoom(from)) ..
      " &lt;white&gt;to &lt;yellow&gt;" ..
      string.upper(searchRoom(to)) ..
      "&lt;white&gt;"
    )
  end
end

function mmp.listSpecialExits(filter)
  local c = 0
  mmp.echo("Listing special exits...")
  for area, areaname in pairs(mmp.areatabler) do
    local rooms = getAreaRooms(area) or {}
    for i = 0, #rooms do
      local exits = getSpecialExits(rooms[i] or 0)
      if exits and next(exits) then
        for exit, cmd in pairs(exits) do
          if type(cmd) == "table" then
            cmd = next(cmd)
          end
          if cmd:match("^%d") then
            cmd = cmd:sub(2)
          end
          if not filter or cmd:lower():find(filter, 1, true) then
            if getRoomArea(exit) ~= area then
              cecho(
                string.format(
                  "&lt;dark_slate_grey&gt;%s &lt;LightSlateGray&gt;(%d, in %s)&lt;dark_slate_grey&gt; &lt;MediumSlateBlue&gt;-&gt; &lt;coral&gt;%s -&lt;MediumSlateBlue&gt;&gt;&lt;dark_slate_grey&gt; %s &lt;LightSlateGray&gt;(%d, in %s)\n",
                  getRoomName(rooms[i]),
                  rooms[i],
                  areaname,
                  cmd,
                  getRoomName(exit),
                  exit,
                  mmp.areatabler[getRoomArea(exit)] or '?'
                )
              )
            else
              cecho(
                string.format(
                  "&lt;dark_slate_grey&gt;%s &lt;LightSlateGray&gt;(%d)&lt;dark_slate_grey&gt; &lt;MediumSlateBlue&gt;-&gt; &lt;coral&gt;%s &lt;MediumSlateBlue&gt;-&gt;&lt;dark_slate_grey&gt; %s &lt;LightSlateGray&gt;(%d)&lt;dark_slate_grey&gt; in %s\n",
                  getRoomName(rooms[i]),
                  rooms[i],
                  cmd,
                  getRoomName(exit),
                  exit,
                  areaname
                )
              )
            end
            c = c + 1
          end
        end
      end
    end
  end
  mmp.echo(
    string.format(
      "%d exits listed%s.", c, (not filter and '' or ", with for the filter '" .. filter .. "'")
    )
  )
end

function mmp.delSpecialExits(filter)
  local c = 0
  for area, areaname in pairs(mmp.areatabler) do
    local rooms = getAreaRooms(area) or {}
    for i = 0, #rooms do
      local exits = getSpecialExits(rooms[i] or 0)
      if exits and next(exits) then
        for exit, cmd in pairs(exits) do
          if type(cmd) == "table" then
            cmd = next(cmd)
          end
          if cmd:match("^%d") then
            cmd = cmd:sub(2)
          end
          if not filter or cmd:lower():find(filter, 1, true) then
            local rid, action
            local originalExits = {}
            local e = getSpecialExits(rooms[i])
            for t, n in pairs(e) do
              rid = tonumber(t)
              for a, l in pairs(n) do
                action = tostring(a)
              end
              if not action:find(filter, 1, true) then
                originalExits[rid] = action
              end
            end
            clearSpecialExits(rooms[i])
            for rid, act in pairs(originalExits) do
              addSpecialExit(rooms[i], tonumber(rid), tostring(act))
            end
            c = c + 1
          end
        end
      end
    end
  end
  mmp.echo(
    string.format(
      "%d exits deleted%s.", c, (not filter and '' or ", with for the filter '" .. filter .. "'")
    )
  )
end</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Directions-translating functions</name>
								<packageName></packageName>
								<script>-- translates n to north and so forth
local temp = {
    n = "north",
    e = "east",
    s = "south",
    w = "west",
    ne = "northeast",
    se = "southeast",
    sw = "southwest",
    nw = "northwest",
    u = "up",
    d = "down",
    i = "in",
    o = "out",
    ["in"] = "in"
}
local anytolongmap = {}
for s, l in pairs(temp) do anytolongmap[l] = l; anytolongmap[s] = l end
function mmp.anytolong(exit)

  return anytolongmap[exit]
end

function mmp.anytoshort(exit)
  local t = {
    n = "north",
    e = "east",
    s = "south",
    w = "west",
    ne = "northeast",
    se = "southeast",
    sw = "southwest",
    nw = "northwest",
    u = "up",
    d = "down",
    ["in"] = "in",
    out = "out"
  }
  local rt = {}
  for s,l in pairs(t) do
    rt[l] = s; rt[s] = s
  end

  return rt[exit]
end


function mmp.ranytolong(exit)
  local t = {
    n = "south",
    north = "south",
    e = "west",
    east = "west",
    s = "north",
    south = "north",
    w = "east",
    west = "east",
    ne = "southwest",
    northeast = "southwest",
    se = "northwest",
    southeast = "northwest",
    sw = "northeast",
    southwest = "northeast",
    nw = "southeast",
    northwest = "southeast",
    u = "down",
    up = "down",
    d = "up",
    down = "up",
    i = "out",
    ["in"] = "out",
    o = "in",
    out = "in"
  }

  return t[exit]
end

-- returns nil or the room number relative to this one
function mmp.relativeroom(from, dir)
  if not mmp.roomexists(from) then return end

  local exits = getRoomExits(tonumber(from))
  return exits[mmp.anytolong(dir)]
end
</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mconfig settings functions</name>
								<packageName></packageName>
								<script>function mmp.doLock(what, lock, filter)
  if what then mmp.echo(string.format("%s all %s...", (lock and "Locking" or "Unlocking"), what)) end
  local c = 0

  local getAreaRooms, getSpecialExits, lockSpecialExit, next = getAreaRooms, getSpecialExits, lockSpecialExit, next
  for _, area in pairs(getAreaTable()) do
    local rooms = getAreaRooms(area) or {}
    for i = 0, #rooms do
      local exits = getSpecialExits(rooms[i] or 0)

       if exits and next(exits) then
         for exit, cmd in pairs(exits) do
           if type(cmd) == "table" then cmd = next(cmd) end

           if (not filter and not (cmd:lower():find("pathfind", 1, true) or cmd:lower():find("worm warp", 1, true) or cmd:lower():find("enter grate", 1, true))) or (filter and cmd:lower():find(filter, 1, true)) then
             lockSpecialExit(rooms[i], exit, cmd, lock)
             c = c + 1
           end
         end
       end
    end
  end

  if what then mmp.echo(string.format("%s %s known %s.", (lock and "Locked" or "Unlocked"), c, what)) end
  return c
end

function mmp.changeEchoColour()
    mmp.echo("Now displaying echos in &lt;"..mmp.settings.echocolour.."&gt;"..mmp.settings.echocolour )
end

function mmp.changeLaglevel()
    local laglevel = mmp.settings.laglevel
    local laginfo = mmp.lagtable[laglevel]
    mmp.echo(string.format("Lag level set to [%d]: %s (%ss timer)", laglevel, laginfo.description, tostring(laginfo.time)))
end

function mmp.verifyLaglevel(value)
  if mmp.lagtable[value] then return true end
  return false
end

function mmp.lockPathways()
  local lock = mmp.settings.lockpathways and true or false
  mmp.doLock("pathways", lock, "pathfind")
end

function mmp.lockSewers()
  local lock = mmp.settings.locksewers and true or false
  return mmp.doLock("sewer grates", lock, "enter grate")
end

function mmp.lockWormholes()
  local lock = mmp.settings.lockwormholes and true or false
  return mmp.doLock("wormholes", lock, "worm warp")
end
tempTimer(0, function() if mmp.firstRun then mmp.lockWormholes() end end)

function mmp.lockPebble()
  local disabled = (not mmp.settings.pebble) and true or false
  mmp.doLock(nil, disabled, "touch 116998")
  mmp.doLock(nil, disabled, "touch 277930")

  mmp.echo(string.format("Use of pebble %s.", disabled and "disabled" or "enabled"))
end

function mmp.lockSpecials()
  local lock = mmp.settings.lockspecials and true or false
  mmp.doLock("special exits", lock)
end


function mmp.changeMapSource()
  local use = mmp.settings.crowdmap and true or false
  if use and not (mmp.game == "achaea" or mmp.game == "starmourn" or mmp.game == "lusternia" or mmp.game == "stickmud" or mmp.game == "ashyria" or mmp.game == "asteria" or mmp.game == "imperian" or mmp.game == "aetolia") then
    mmp.echo("Sorry - the crowdsourced map is only available for use in Achaea, Starmourn, Lusternia, StickMUD, Ashyria and Asteria. If you'd like to help start one for your game, please post at http://forums.mudlet.org/viewtopic.php?f=13&amp;t=1696. If you are playing one of the games, then it is likely that you just downloaded the script - and it doesn't know what you are playing. Reconnect and it'll know.")
    mmp.settings.crowdmap = false
  elseif use and not loadMap then
   mmp.echo("Sorry - your Mudlet is too old and can't load maps. Please update: http://forums.mudlet.org/viewtopic.php?f=5&amp;t=1874")
   mmp.settings.crowdmap = false
  elseif use then
    mmp.echo("Will use the crowdsourced map for updates instead!")
    mmp.checkforupdate()
  else
    mmp.echo("Will use the default game map for updates.")
  end
end

function mmp.setWingsLanguage()
  mmp.echo("Alright, will say Duanathar and Duanathar in "..mmp.settings.winglanguage:title()..".")
end

function mmp.setWingsRemoval()
  mmp.echo("Okay - "..(mmp.settings.removewings and "will" or "won't").." remove wings after using them.")
end

function mmp.setSlowWalk()
  if mmp.settings.slowwalk then
    mmp.echo("Will walk 'slowly' - that is, only try to move in a direction once per room, and move again once we've arrived. This will make us better walkers when it's very laggy, as we won't spam directions unnecessarily and miss certain turns - but it does mean that if we fail to move for some reason, we won't retry again either at all.")
  else
    mmp.echo("Will walk as quick as we can!")
  end
end

function mmp.disableWaterWalk()
  local c = 0
  local getRoomEnv, setRoomWeight = getRoomEnv, setRoomWeight
  for roomid, roomname in pairs(getRooms()) do
    if mmp.waterenvs[getRoomEnv(roomid)] then
      setRoomWeight(roomid, 3)
      c = c + 1
    end
  end

  return c
end

function mmp.enableWaterWalk()
  local c = 0
  local getRoomEnv, setRoomWeight = getRoomEnv, setRoomWeight
  for roomid, roomname in pairs(getRooms()) do
    if mmp.waterenvs[getRoomEnv(roomid)] then
      setRoomWeight(roomid, 1)
      c = c + 1
    end
  end

  return c
end

function mmp.setWaterWalk()
  if mmp.settings.waterwalk then
    mmp.echo("Enabled waterwalk for "..mmp.enableWaterWalk().." rooms - so we'll be treating land and water rooms the same now in terms of traverse speed over them.")
  else
    mmp.echo("Disabled waterwalk for "..mmp.disableWaterWalk().." rooms - so we'll be preferring land rooms over water ones wherever it's quicker.")
  end
end

function mmp.setOrb(city)
  if mmp.settings["orb"..city:lower()] then
    mmp.echo("&lt;green&gt;Okay, we won't use wings in &lt;white&gt;" .. city:title().."&lt;green&gt;!")
  else
    mmp.echo("&lt;green&gt;Okay, we will use wings in &lt;white&gt;" .. city:title().."&lt;green&gt;!")
  end
end
</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>API</name>
								<packageName></packageName>
								<script>-------------------------------------------------
-- This script lists some of the API functions available from the IRE mudlet-mapper
-- not all functions that are available are included here, however.

function mmp.echo(what)
  what = what or ""
  moveCursorEnd("main") if getCurrentLine() ~= "" then echo"\n" end
  decho("&lt;112,229,0&gt;(&lt;73,149,0&gt;mapper&lt;112,229,0&gt;): &lt;255,255,255&gt;")
  cecho(tostring(what))
  echo("\n")
end

function mmp.echon(what)
  moveCursorEnd("main") if getCurrentLine() ~= "" then echo"\n" end
  decho("&lt;112,229,0&gt;(&lt;73,149,0&gt;mapper&lt;112,229,0&gt;): &lt;255,255,255&gt;")
  cecho(tostring(what))
end

function mmp.deleteLineP()
  deleteLine()
  tempLineTrigger(1,1,[[
    if isPrompt() then deleteLine() end
  ]])
end

function mmp.pause(what)
  assert(what == nil or what == "on" or what == "off", "mmp.pause wants 'on', 'off' or nothing as an argument")

  if what == "on" or (what == nil and not mmp.paused) then
    mmp.paused = true
  elseif  what == "off" or (what == nil and mmp.paused) then
    mmp.paused = false
  end

  mmp.echo("Speedwalking " .. (mmp.paused and "paused" or "unpaused") .. ".")
  if not mmp.paused then mmp.move() end
end

function mmp.mapLook(roomid, delay)
  centerview(roomid)
  if mmp.maplooktimer then killTimer(mmp.maplooktimer) end
  mmp.maplooktimer = tempTimer(tonumber(delay) or 4, [[centerview(mmp.currentroom); mmp.maplooktimer = nil]])
end

function mmp.getnums(roomname, exact)
  if tonumber(roomname) then return {roomname} end

  local t = (not exact and mmp.searchRoom or mmp.searchRoomExact)(roomname)

  if not t or not next(t) then
    return nil end

  local result = {}

  if not tonumber(select(2, next(t))) then
    for roomid,_ in pairs(t) do
      if roomid ~= 0 then result[#result+1] = tonumber(roomid) end
    end
  else
    for _,roomid in pairs(t) do
      if roomid ~= 0 then result[#result+1] = tonumber(roomid) end
    end
  end

  return result
end

-- searchRoom with a cache!
local cache = {}
setmetatable(cache, {__mode = "kv"}) -- weak keys/values = it'll periodically get cleaned up by gc

function mmp.searchRoom(what)
  local result = cache[what]
  if not result then
    result = searchRoom(what)
    local realResult = {}
    for key, value in pairs(type(result) == "table" and result or {}) do
        -- both ways, because searchRoom can return either id-room name or the reverse
        if type(key) == "string" then
          realResult[key:ends(" (road)") and key:sub(1, -8) or key] = value
        else
          realResult[key] = value:ends(" (road)") and value:sub(1, -8) or value
        end
    end
    cache[what] = realResult
    result = realResult
  end
  return result
end

local function endswith(s, suffix)
    return s:sub(#s - #suffix + 1) == suffix
end

function mmp.searchRoomExact(what)
  if type(what) ~= 'string' then return end

  local roomTable = mmp.searchRoom(what)
  local realResult = {}
  what = what:lower()
  for key, value in pairs (roomTable) do
    if type(key) == "string" and (key:lower() == what or (endswith(key, '.') and key:sub(1, -2) == what)) then
        realResult[key:ends(" (road)") and key:sub(1, -8) or key] = value
    elseif type(value) == "string" and (value:lower() == what or (endswith(value, '.') and value:sub(1, -2) == what)) then
        realResult[key] = value:ends(" (road)") and value:sub(1, -8) or value
    end
  end
  if (table.is_empty(realResult)) then
    return roomTable
  else
    return realResult
  end
end

function mmp.findAreaID(areaname, exact)
  local areaname = areaname:lower()
  local list = getAreaTable()

  -- iterate over the list of areas, matching them with substring match.
  -- if we get match a single area, then return it's ID, otherwise return
  -- 'false' and a message that there are than one are matches
  local returnid, fullareaname, multipleareas = nil, nil, {}
  for area, id in pairs(list) do
    if (not exact and area:lower():find(areaname, 1, true)) or (exact and areaname == area:lower()) then
      returnid = id; fullareaname = area; multipleareas[#multipleareas+1] = area
    end
  end

  if #multipleareas == 1 then
    return returnid, fullareaname
  else
    return nil, nil, multipleareas
  end
end

function mmp.roomexists(num)
  if not num then return false end
  if roomExists then return roomExists(num) end

  local s,m = pcall(getRoomArea, tonumber(num))
  return (s and true or false)
end

function mmp.getcontinents()
  local tmp = getRoomUserData(1, "areaContinents")
  if tmp == "" then return {} end

  return yajl.to_value(tmp)
end

-- patches welcome to finish this function.
function mmp.removecontinent(area, continent)
  local continents = mmp.getcontinents()

  if not next(continents) then return nil, "no continents are known" end
  if not continents[continent] then return nil, "no such continent is recorded" end

  local index = mmp.indexof_valueonly(continents[continent], area)
  if not index then return nil, "this area is not on that continent" end
  table.remove(continents[continent], index)
  local tmp = yajl.to_string(continents)
  setRoomUserData(1, "areaContinents", tmp)
  return true
end

function mmp.addcontinent(areaid, continent)
  local continents = mmp.getcontinents()

  if not next(continents) then return nil, "no continents are known" end
  if not continents[continent] then continents[continent] = {} end

  local index = mmp.indexof_valueonly(continents[continent], areaid)
  if index then return nil, "this area is already on that continent" end
  continents[continent][#continents[continent] + 1] = areaid
  local tmp = yajl.to_string(continents)
  setRoomUserData(1, "areaContinents", tmp)
  return true
end

function mmp.indexof_valueonly(data, value)
  for i = 1, #data do
    if data[i] == value then return i end
  end

  return false
end

-- checks if given area ID is on the given continent. Returns true only if certainly knows
function mmp.oncontinent(areaid, continent)
  local continents = mmp.getcontinents()
  if not continents[continent] then return nil, "no such continent is recorded" end

  return mmp.indexof_valueonly(continents[continent], areaid)
end

function mmp.getareacontinents(areaid)
  local areaContinents = {}
  for continentName, areas in pairs(mmp.getcontinents()) do
    if mmp.indexof_valueonly(areas, areaid) then
      areaContinents[#areaContinents + 1] = continentName
    end
  end
  return areaContinents
end

-- accepts areaname or ID
function mmp.cleanAreaName(area)
  local areaname = type(area) == "number" and mmp.areatabler[area] or area
  if not areaname then return area end

  -- strip , the
  areaname = areaname:gsub(", the$", '')

  -- strip , the Type of
  areaname = areaname:gsub(", the %w+ of$", '')

  -- strip , the Type of (important)
  areaname = areaname:gsub(", the %w+ of %((.+)%)$", " (%1)")

  -- strip , the (important)
  areaname = areaname:gsub(", the %((.+)%)$", " (%1)")

  return areaname
end

-- if this room is in a unique area, report it. Otherwise gives nil
function mmp.getexactarea(roomname)
  local rooms = mmp.searchRoomExact(roomname)

  if not rooms or not next(rooms) then return nil end

  local areaid
  for roomid, roomname in pairs(rooms) do

    local caid = getRoomArea(roomid)
    if areaid and areaid ~= caid then return nil end
    areaid = caid
  end

  if areaid then return mmp.areatabler[areaid] end
end

-- returns the area name of a room or ?
function mmp.getAreaName(roomid)
   return mmp.areatabler[getRoomArea(roomid)] or '?'
end

-- removes extra prefixes and suffixes that are not part of the actual room name
function mmp.cleanroomname(roomname)
  local starts, ends = string.starts, string.ends

  if starts(roomname, "Flying above ") then
    roomname = string.sub(roomname, -(#roomname-13))
  end
  if starts(roomname, "In the trees above ") then
    roomname = string.sub(roomname, -(#roomname-19))
  end
  if starts(roomname, "The ruins of ") then
    roomname = string.sub(roomname, -(#roomname-13))
  end
  if ends(roomname, ".") then
    roomname = string.sub(roomname, 1, (#roomname-1))
  end
  if ends(roomname, " (road)") then
    roomname = string.sub(roomname, 1, (#roomname-7))
  end
  if ends(roomname, " (indoors)") then
    roomname = string.sub(roomname, 1, (#roomname-10))
  end
  if ends(roomname, " (indoor road)") then
    roomname = string.sub(roomname, 1, (#roomname-14))
  end

  return roomname
end</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmp.roomLook</name>
								<packageName></packageName>
								<script>function mmp.roomLook(input)
  -- we can do a report with a number

  local function handle_number(num)
    -- compile all available data
    if not mmp.roomexists(num) then
      mmp.echo(num .. " doesn't seem to exist.")
      return
    end
    local s, areanum = pcall(getRoomArea, num)
    if not s then
      mmp.echo(areanum);
      return ;
    end
    local exits = getRoomExits(num)
    local name = getRoomName(num)
    local islocked = roomLocked(num)
    local weight = (getRoomWeight(num) and getRoomWeight(num) or "?")
    -- getRoomWeight is buggy in one of the versions, is actually linked to setRoomWeight and thus returns nil
    local exitweights = (getExitWeights and getExitWeights(num) or {})
    local coords = {getRoomCoordinates(num)}
    local specexits = getSpecialExits(num)
    local env = getRoomEnv(num)
    local envname = (mmp.envidsr and mmp.envidsr[env]) or "?"
    -- generate a report
    mmp.echo(
      string.format(
        "Room: %s #: %d area: %s (%d)", name, num, tostring(mmp.areatabler[areanum]), areanum
      )
    )
    mmp.echo(
      string.format(
        "Coordinates: x:%d, y:%d, z:%d, locked: %s, weight: %s",
        coords[1],
        coords[2],
        coords[3],
        (islocked and "yep" or "nope"),
        tostring(weight)
      )
    )
    mmp.echo(
      string.format(
        "Environment: %s (%d)%s",
        tostring(envname),
        env,
        (getRoomUserData(num, "indoors") ~= '' and ", indoors" or '')
      )
    )
    mmp.echo(string.format("Exits (%d):", table.size(exits)))
    for exit, leadsto in pairs(exits) do
      echo(
        string.format(
          "  %s -&gt; %s (%d)%s%s\n",
          exit,
          getRoomName(leadsto),
          leadsto,
          (
            (getRoomArea(leadsto) or "?") == areanum and
            "" or
            " (in " ..
            (mmp.areatabler[getRoomArea(leadsto)] or "?") ..
            ")"
          ),
          (
            (not exitweights[mmp.anytoshort(exit)] or exitweights[mmp.anytoshort(exit)] == 0) and
            "" or
            " (weight: " ..
            exitweights[mmp.anytoshort(exit)] ..
            ")"
          )
        )
      )
    end
    -- display special exits if we got any
    if next(specexits) then
      mmp.echo(string.format("Special exits (%d):", table.size(specexits)))
      for leadsto, command in pairs(specexits) do
        if type(command) == "string" then
          echo(string.format("  %s -&gt; %s (%d)\n", command, getRoomName(leadsto), leadsto))
        else
          -- new format - exit name, command
          for cmd, locked in pairs(command) do
            if locked == '1' then
              cecho(
                string.format(
                  "&lt;DarkSlateGrey&gt;  %s -&gt; %s (%d) (locked)\n", cmd, getRoomName(leadsto), leadsto
                )
              )
            else
              echo(string.format("  %s -&gt; %s (%d)\n", cmd, getRoomName(leadsto), leadsto))
            end
          end
        end
      end
    end
    local message = "This room has the feature '%s'."
    for _, mapFeature in pairs(mmp.getRoomMapFeatures(num)) do
      mmp.echo(string.format(message, mapFeature))
    end
    -- actions we can do. This will be a short menu of sorts for actions
    mmp.echo("Stuff you can do:")
    echo("  ")
    echo("Clear all labels ")
    setUnderline(true)
    echoLink("(in area)", 'mmp.clearLabels(' .. areanum .. ')', '', true)
    setUnderline(false)
    echo(" ")
    setUnderline(true)
    echoLink(
      "(whole map)",
      [[
    if not mmp.clearinglabels then
      mmp.echo("Are you sure you want to clear all of your labels on this map? If yes, click the link again.")
      mmp.clearinglabels = true
    else
      mmp.clearLabels("map")
      mmp.clearinglabels = nil
    end
    ]],
      '',
      true
    )
    setUnderline(false)
    echo("\n")
    echo("  ")
    setUnderline(true)
    echoLink(
      "Check for mapper &amp; map updates", 'mmp.echo("Checking...") mmp.checkforupdate()', '', true
    )
    setUnderline(false)
    echo(" ")
    setUnderline(true)
    echoLink(
      "(force map)",
      [[
      if io.exists(getMudletHomeDir().."/map downloads/current") then
        local s,m = os.remove(getMudletHomeDir().."/map downloads/current")
        if not s then mmp.echo("Couldn't delete '"..getMudletHomeDir().."/map downloads/current' file: "..tostring(m)..".") end
      end
      mmp.echo("Re-downloading the latest crowdmap...")
      mmp.checkforupdate()
    ]],
      "Re-download the map regardless if you have latest",
      true
    )
    setUnderline(false)
    echo("\n")
  end

  -- see if we can do anything with the name

  local function handle_name(name)
    local result = mmp.searchRoom(name)
    if type(result) == "string" then
      cecho("&lt;grey&gt;You have no recollection of any room with that name.")
      return
    end
    -- if we got one result, then act on it
    if table.size(result) == 1 then
      if type(next(result)) == "number" then
        handle_number(next(result))
      else
        handle_number(select(2, next(result)))
      end
      return
    end
    -- if not, then ask the user to clarify which one would they want
    mmp.echo("Which room specifically would you like to look up?")
    if not select(2, next(result)) or not tonumber(select(2, next(result))) then
      for roomid, roomname in pairs(result) do
        roomid = tonumber(roomid)
        cecho(string.format("  &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt; (", tostring(roomname)))
        cechoLink(
          "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
          'mmp.roomLook(' .. roomid .. ')',
          string.format("View room details for %s (%s)", roomid, tostring(roomname)),
          true
        )
        cecho(
          string.format(
            "&lt;DarkSlateGrey&gt;) in the &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt;.\n",
            tostring(mmp.areatabler[getRoomArea(roomid)])
          )
        )
      end
    else
      for roomname, roomid in pairs(result) do
        roomid = tonumber(roomid)
        cecho(string.format("  &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt; (", tostring(roomname)))
        cechoLink(
          "&lt;" .. mmp.settings.echocolour .. "&gt;" .. roomid,
          'mmp.roomLook(' .. roomid .. ')',
          string.format("View room details for %s (%s)", roomid, tostring(roomname)),
          true
        )
        cecho(
          string.format(
            "&lt;DarkSlateGrey&gt;) in the &lt;LightSlateGray&gt;%s&lt;DarkSlateGrey&gt;.\n",
            tostring(mmp.areatabler[getRoomArea(roomid)])
          )
        )
      end
    end
  end

  if not input then
    if not mmp.roomexists(mmp.currentroom) then
      mmp.echo(mmp.currentroom .. " doesn't seem to be mapped yet.")
      mmp.echo("Stuff you can do:")
      echo("  ")
      echoLink("Check for all updates", 'mmp.echo("Checking...") mmp.checkforupdate()', '')
      echo(" ")
      echoLink(
        "(force map)",
        [[
      local s,m = os.remove(getMudletHomeDir().."/map downloads/current")
        if io.exists(getMudletHomeDir().."/map downloads/current") then
          local s,m = os.remove(getMudletHomeDir().."/map downloads/current")
          if not s then mmp.echo("Couldn't delete '"..getMudletHomeDir().."/map downloads/current' file: "..tostring(m)..".") end
        end
        mmp.echo("Re-downloading the latest map...")
        mmp.checkforupdate()
      ]],
        "Re-download the map regardless if you have latest"
      )
      echo("\n")
      mmp.echo(string.format("version %s.", tostring(mmp.version)))
      return
    else
      input = mmp.currentroom
    end
  end
  if tonumber(input) then
    handle_number(tonumber(input))
  else
    handle_name(input)
  end
  mmp.echo(string.format("version %s.", tostring(mmp.version)))
end</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmp.ferriesfix</name>
								<packageName></packageName>
								<script>function mmp.ferriesfix()
  if table.is_empty(mmp.ferry_rooms) then
    local tmp = getRoomUserData(1, "ferry rooms")
    if tmp ~= "" then
      for _, i in ipairs(yajl.to_value(tmp)) do
        mmp.ferry_rooms[i] = true
      end
    end
  end
end</script>
								<eventHandlerList>
									<string>mmapper updated map</string>
									<string>sysConnectionEvent</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmp.wormholesfix</name>
								<packageName></packageName>
								<script>function mmp.wormholesfix()
  local c = 0
  local weight = 10
  for _, area in pairs(getAreaTable()) do
    local rooms = getAreaRooms(area) or {}
    for i = 0, #rooms do
      local exits = getSpecialExits(rooms[i] or 0)

       if exits and next(exits) then
         for exit, cmd in pairs(exits) do
           if type(cmd) == "table" then cmd = next(cmd) end

           if (cmd:lower():find("worm warp", 1, true)) then
				setExitWeight(rooms[i], cmd, weight)
             c = c + 1
           end
         end
       end
    end
  end

  if c &gt; 0 then mmp.echo(string.format("%s wormholes weighted to %s (so we don't take them over too short distances).", c, weight)) end
end</script>
								<eventHandlerList>
									<string>mmapper updated map</string>
									<string>sysMapDownloadEvent</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmp.clearlastupdate</name>
								<packageName></packageName>
								<script>function mmp.clearlastupdate()
  -- reset mmp.pdb_lastupdate on the prompt
  enableTrigger"Mudlet Mapper prompt trigger"
end</script>
								<eventHandlerList>
									<string>mmapper updated pdb</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Third-party functions</name>
								<packageName></packageName>
								<script>-- from: http://lua-users.org/wiki/CopyTable
local function deepcopy(orig)
    local orig_type = type(orig)
    local copy
    if orig_type == 'table' then
        copy = {}
        for orig_key, orig_value in next, orig, nil do
            copy[deepcopy(orig_key)] = deepcopy(orig_value)
        end
        setmetatable(copy, deepcopy(getmetatable(orig)))
    else -- number, string, boolean, etc
        copy = orig
    end
    return copy
end

mmp.deepcopy = deepcopy</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmp.regenerateAreas</name>
								<packageName></packageName>
								<script>function mmp.regenerateAreas()
  -- cached data
  mmp.areatable = getAreaTable() -- this translates an area name to an ID
  mmp.areatabler = {} -- this translates an ID to an area name

  local t = getAreaTable()
  for k,v in pairs(t) do
    mmp.areatabler[tonumber(v)] = k
  end

  mmp.clearpathcache()
end</script>
								<eventHandlerList>
									<string>mmp areas changed</string>
									<string>mmapper map reloaded</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmp.relockAreas</name>
								<packageName></packageName>
								<script>function mmp.relockAreas()
	local getAreaRooms, lockRoom, lockedareas = getAreaRooms, lockRoom, mmp.locked

	for areaid, areaname in pairs(getAreaTableSwap()) do
		if lockedareas[areaid] then
			local rooms = getAreaRooms(areaid) or {}
			for _, roomid in pairs(rooms) do
				lockRoom(roomid, true)
			end
		else
			local rooms = getAreaRooms(areaid) or {}
			for _, roomid in pairs(rooms) do
				lockRoom(roomid, false)
			end
		end
	end

	-- make sure area with ID 0 is locked - this was causing crashing issues
	local rooms = getAreaRooms(0) or {}
	for _, roomid in pairs(rooms) do
		lockRoom(roomid, true)
	end
end</script>
								<eventHandlerList>
									<string>mmapper map reloaded</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Fix setExit</name>
								<packageName></packageName>
								<script>do
local oldsetExit = setExit

local exitmap = {
  n = 1,
  north = 1,
  ne = 2,
  northeast = 2,
  nw = 3,
  northwest = 3,
  e = 4,
  east = 4,
  w = 5,
  west = 5,
  s = 6,
  south = 6,
  se = 7,
  southeast = 7,
  sw = 8,
  southwest = 8,
  u = 9,
  up = 9,
  d = 10,
  down = 10,
  ["in"] = 11,
  out = 12
}

function mmp.setExit(from, to, direction)
  if type(direction) == "string" and not exitmap[direction] then return false end

  return oldsetExit(from, to, type(direction) == "string" and exitmap[direction] or direction)
end
end</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Fix exit locking funcs</name>
								<packageName></packageName>
								<script>do
local oldlockExit = lockExit
local oldhasExitLock = hasExitLock

local exitmap = {
  n = 1,
  north = 1,
  ne = 2,
  northeast = 2,
  nw = 3,
  northwest = 3,
  e = 4,
  east = 4,
  w = 5,
  west = 5,
  s = 6,
  south = 6,
  se = 7,
  southeast = 7,
  sw = 8,
  southwest = 8,
  u = 9,
  up = 9,
  d = 10,
  down = 10,
  ["in"] = 11,
  out = 12
}

function mmp.lockExit(from, direction, status)
  if type(direction) == "string" and not exitmap[direction] then return false end

  return oldlockExit(from, type(direction) == "string" and exitmap[direction] or direction, status)
end

function mmp.hasExitLock(from, direction)
  if type(direction) == "string" and not exitmap[direction] then return false end

  return oldhasExitLock(from, type(direction) == "string" and exitmap[direction] or direction)
end
end</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Assorted small utilities</name>
								<packageName></packageName>
								<script>function mmp.comma_value(n) -- credit http://richard.warburton.it
	local left,num,right = string.match(n,'^([^%d]*%d)(%d*)(.-)$')
	return left..(num:reverse():gsub('(%d%d%d)','%1,'):reverse())..right
end</script>
								<eventHandlerList />
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Defense tracking</name>
								<packageName></packageName>
								<script>mmp.defs = {current = {}}
mmp.defs.add =
  function()
    local def = gmcp.Char.Defences.Add.name
    if not mmp.defs.current[def] then
      mmp.defs.current[def] = true
      raiseEvent("mmp got def", def)
    end
  end
mmp.defs.remove =
  function()
    for _, def in ipairs(gmcp.Char.Defences.Remove) do
      mmp.defs.current[def] = nil
      raiseEvent("mmp lost def", def)
    end
  end
mmp.defs.list =
  function()
    local newDefs = {}
    local addedDefs, lostDefs = {}, {}
    for _, v in ipairs(gmcp.Char.Defences.List) do
      newDefs[v.name] = true
      if not mmp.defs.current[v.name] then
        addedDefs[#addedDefs + 1] = v.name
      end
    end
    for def in pairs(mmp.defs.current) do
      if not newDefs[def] then
        lostDefs[#lostDefs + 1] = def
      end
    end
    mmp.defs.current = newDefs
    for _, def in pairs(lostDefs) do
      raiseEvent("mmp lost def", def)
    end
    for _, def in ipairs(addedDefs) do
      raiseEvent("mmp got def", def)
    end
  end
-- EVENT HANDLERS
registerAnonymousEventHandler("gmcp.Char.Defences.Add", "mmp.defs.add")
registerAnonymousEventHandler("gmcp.Char.Defences.Remove", "mmp.defs.remove")
registerAnonymousEventHandler("gmcp.Char.Defences.List", "mmp.defs.list")</script>
								<eventHandlerList />
							</Script>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Person tracking</name>
							<packageName></packageName>
							<script>--[[
mmp will have 2 person tracking databases:
- mmp.pdb  =  used to store the last known location of a person
- mmp.pdb_lastupdate  =  used to store the output of the last locating command

Both databases work with the person's name as key and the location name as value.

]]
mmp.pdb = mmp.pdb or {}
mmp.pdb_lastupdate = mmp.pdb_lastupdate or {}

function mmp.is_here(who)
  return (mmp.pdb[who] and mmp.pdb[who] == mmp.currentroomname) and true or false
end</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Lock Area</name>
							<packageName></packageName>
							<script>-- Lock Area

mmp.locked = mmp.locked or {}
mmp.lastLockSearch = mmp.lastLockSearch or nil

function mmp.doLockArea(search)
	local areaList
	if search ~= nil then
		local r = rex.new(string.lower(search))
		mmp.lastLockSearch = search
		for name, id in pairs(getAreaTable()) do
			if r:match(string.lower(name)) then
				areaList = areaList or {}
				areaList[name] = id
			end
		end
		if areaList == nil then
			mmp.echo("'" .. search .. "' did not match any known areas!")
			return
		end
	else
		mmp.lastLockSearch = nil
		areaList = getAreaTable()
	end

	for name, id in pairs(areaList) do
		mmp.echon(name .. string.rep(" ", 40 - string.len(name)))
		if not mmp.locked[id] then
			setFgColor(0, 200, 0)
			setUnderline(true)
			echoLink("Lock!", [[mmp.lockArea( ']] .. name:gsub("'", [[\']]) .. [[', true )]], "Click to lock area '" .. name .. "'", true)
		else
			setFgColor(200, 0, 0)
			setUnderline(true)
			echoLink("Unlock!", [[mmp.lockArea( ']] .. name:gsub("'", [[\']]) .. [[', false )]], "Click to unlock area '" .. name .. "'", true)
		end
	end

	if not search then
		echo"\n\n" mmp.echo("Use &lt;green&gt;arealock &lt;area&gt;&lt;white&gt; to filter areas.")
	end
end

function mmp.lockArea(name, lock, dontreshow)
	local areas = getAreaTable()
	local rooms = getAreaRooms(areas[name]) or {}
    local lockRoom = lockRoom
    local count = 0
	for _, room in pairs(rooms) do
		lockRoom(room, lock)
        count = count + 1
	end

	mmp.locked[areas[name]] = lock and true or nil
	mmp.echo(string.format("Area '%s' %slocked! All %s room%s within it.", name, (lock and '' or 'un'), count, (count == 1 and '' or 's')))

	if not dontreshow then mmp.doLockArea(mmp.lastLockSearch) end
end


</script>
							<eventHandlerList />
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>Center view via GMCP</name>
							<packageName></packageName>
							<script></script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>mmp.centerRoominfo</name>
								<packageName></packageName>
								<script>function mmp.centerRoominfo()
  -- lusternia has gmcp.Room.Players before gmcp.Room.Info is created
  if gmcp.Room.Info then centerview(gmcp.Room.Info.num) end
end</script>
								<eventHandlerList>
									<string>gmcp.Room</string>
								</eventHandlerList>
							</Script>
						</Script>
						<ScriptGroup isActive="yes" isFolder="yes">
							<name>mm Mapping</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>mmp.mappingNewroom</name>
								<packageName></packageName>
								<script>--mmp.mappingNewroom

local function makeroom(oldid, newid, x, y, z)
  assert(x and y and z, "makeroom: need all 3 coordinates")
  addRoom(newid)
  setRoomCoordinates(newid, x, y, z)
  setRoomArea(newid, getRoomArea(oldid))
  local fgr, fgg, fgb = unpack(color_table.red)
  local bgr, bgg, bgb = unpack(color_table.blue)
  highlightRoom(newid, fgr, fgg, fgb, bgr, bgg, bgb, 1, 100, 100)
  if mmp.envids[gmcp.Room.Info.environment] then
    setRoomEnv(newid, mmp.envids[gmcp.Room.Info.environment])
  else
    setRoomEnv(newid, getRoomEnv(oldid))
  end
  return string.format("Created new room %d at %dx,%dy,%dz.", newid, x, y, z)
end

-- gives the reverse shifted coordinates, ie asking for the sw exit + coords will give the coords at ne

local function getshiftedcoords(original, ox, oy, oz)
  local x, y, z
  local has = table.contains
  -- reverse the exit
  w = mmp.ranytolong(original)
  if has({"west", "left", "w", "l"}, w) then
    x = (x or ox) - 1
    y = (y or oy)
    z = (z or oz)
  elseif has({"east", "right", "e", "r"}, w) then
    x = (x or ox) + 1
    y = (y or oy)
    z = (z or oz)
  elseif has({"north", "top", "n", "t"}, w) then
    x = (x or ox)
    y = (y or oy) + 1
    z = (z or oz)
  elseif has({"south", "bottom", "s", "b"}, w) then
    x = (x or ox)
    y = (y or oy) - 1
    z = (z or oz)
  elseif has({"northwest", "topleft", "nw", "tl"}, w) then
    x = (x or ox) - 1
    y = (y or oy) + 1
    z = (z or oz)
  elseif has({"northeast", "topright", "ne", "tr"}, w) then
    x = (x or ox) + 1
    y = (y or oy) + 1
    z = (z or oz)
  elseif has({"southeast", "bottomright", "se", "br"}, w) then
    x = (x or ox) + 1
    y = (y or oy) - 1
    z = (z or oz)
  elseif has({"southwest", "bottomleft", "sw", "bl"}, w) then
    x = (x or ox) - 1
    y = (y or oy) - 1
    z = (z or oz)
  elseif has({"up", "u"}, w) then
    x = (x or ox)
    y = (y or oy)
    z = (z or oz) + 1
  elseif has({"down", "d"}, w) then
    x = (x or ox)
    y = (y or oy)
    z = (z or oz) - 1
  elseif has({"in", "i"}, w) then
    x = (x or ox)
    y = (y or oy)
    z = (z or oz) - 1
  elseif has({"out", "o"}, w) then
    x = (x or ox)
    y = (y or oy)
    z = (z or oz) + 1
  else
    mmp.echo(
      "Don't know where to shift the coordinates for a " ..
      tostring(w) ..
      " (" ..
      tostring(original) ..
      ") exit."
    )
  end
  return x, y, z
end

function mmp.mappingNewroom(_, num)
  local s, m =
    xpcall(
      function()
        if not mmp.editing then
          return
        end
        if not gmcp.Room then
          mmp.echo(
            "You need to have GMCP turned on (see preferences on a recent Mudlet) for mapping stuff."
          )
          return
        end
        -- wilderness mapping right now is UNFINISHED! It does not handle the grid breakup. So, please don't try it, and please won't whine about it.

        local function inwilderness()
          return (gmcp.Room.Info.coords == "" and gmcp.Room.Info.area == "")
        end

        local getRoomName, getRoomCoordinates, getRoomsByPosition =
          getRoomName, getRoomCoordinates, getRoomsByPosition
        local num = tonumber(num) or tonumber(gmcp.Room.Info.num)
        local currentexits = gmcp.Room.Info.exits
        local s = ""
        if not mmp.roomexists(num) then
          -- see if we can create and link this room with an existing one
          -- wilderness and non-wilderness rooms require different methods of calculating relative coordinates
          if not inwilderness() then
            for exit, id in pairs(currentexits) do
              if mmp.roomexists(id) then
                s = makeroom(id, num, getshiftedcoords(exit, getRoomCoordinates(id)))
              end
            end
          else
            local x, y = tostring(num):match(".-(%d%d%d)(%d%d%d)$")
            -- Achaea's coordinates seem to be in the 4th quadrant, while Mudlets 0,0 is in the middle of the map. Invert y so going north-south looks alright
            s = makeroom(mmp.previousroom, num, x, y * -1, 0)
          end
        end
        -- if we created it, and some data could be filled in
        if mmp.roomexists(num) then
          -- cleanup the room name
          local rootroomname = mmp.cleanroomname(gmcp.Room.Info.name)
          -- match exact case, so mappers alertness' works properly
          if getRoomName(num) ~= rootroomname then
            setRoomName(num, rootroomname)
            unHighlightRoom(num)
            s = s .. (#s &gt; 0 and " " or "") .. "Updated room name to '" .. rootroomname .. "'."
          end
          -- autolink exits
          if not inwilderness() then
            local x = getRoomExits(num) or {}
            -- check for missing exits
            for exit, id in pairs(currentexits) do
              if id == 0 then
                s =
                  s ..
                  (#s &gt; 0 and " " or "") ..
                  "Can't link to the " ..
                  exit ..
                  ", it leads to a room with ID 0 (and that's not supported yet)."
              else
                if not x[mmp.anytolong(exit)] then
                  if not mmp.roomexists(id) then
                    s =
                      makeroom(
                        num, id, getshiftedcoords(mmp.ranytolong(exit), getRoomCoordinates(num))
                      )
                  end
                  if mmp.setExit(num, id, exit) then
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      "Added missing exit " ..
                      exit ..
                      " to " ..
                      (getRoomName(id) ~= "" and getRoomName(id) or "''") ..
                      " (" ..
                      id ..
                      ")."
                  else
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      string.format(
                        "Failed to link %d with %d via %s exit for some reason :/", num, id, exit
                      )
                  end
                end
              end
            end
          else
            local function getshiftedcoords(direction, ox, oy, oz)
              if direction == 'n' then
                return ox, oy + 1, oz
              elseif direction == 'e' then
                return ox + 1, oy, oz
              elseif direction == 's' then
                return ox, oy - 1, oz
              elseif direction == 'w' then
                return ox - 1, oy, oz
              elseif direction == 'ne' then
                return ox + 1, oy + 1, oz
              elseif direction == 'se' then
                return ox + 1, oy - 1, oz
              elseif direction == 'sw' then
                return ox - 1, oy - 1, oz
              elseif direction == 'nw' then
                return ox - 1, oy + 1, oz
              else
                error("getshiftedcoords: direction " .. direction .. " isn't supported yet.")
              end
            end

            local x, y, z = getRoomCoordinates(num)
            local currentexits = getRoomExits(num) or {}
            for _, exit in ipairs({'n', 'e', 's', 'w', 'ne', 'se', 'sw', 'nw'}) do
              local roomatdir =
                getRoomsByPosition(getRoomArea(num), getshiftedcoords(exit, x, y, z))
              if roomatdir[0] then
                local id = roomatdir[0]
                if not currentexits[mmp.anytolong(exit)] then
                  if mmp.setExit(num, id, exit) then
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      "Added missing exit " ..
                      exit ..
                      " to " ..
                      (getRoomName(id) ~= "" and getRoomName(id) or "''") ..
                      " (" ..
                      id ..
                      ")."
                  else
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      string.format(
                        "Failed to link %d with %d via %s exit for some reason :/", num, id, exit
                      )
                  end
                  local exit = mmp.anytoshort(mmp.ranytolong(exit))
                  if mmp.setExit(id, num, exit) then
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      "Added missing exit " ..
                      exit ..
                      " to " ..
                      (getRoomName(id) ~= "" and getRoomName(id) or "''") ..
                      " (" ..
                      id ..
                      ")."
                  else
                    s =
                      s ..
                      (#s &gt; 0 and " " or "") ..
                      string.format(
                        "Failed to link %d with %d via %s exit for some reason :/", num, id, exit
                      )
                  end
                end
              end
            end
          end
          -- check for unexisting exits
          if mmp.settings["autoclear"] then
            for exit, id in pairs(getRoomExits(num)) do
              if not currentexits[mmp.anytoshort(exit)] then
                mmp.setExit(num, -1, exit)
                s =
                  s ..
                  (#s &gt; 0 and " " or "") ..
                  exit ..
                  " exit to " ..
                  id ..
                  " doesn't actually exist, removed it."
              end
            end
          end
          -- check for environment update, if we have environments mapped out
          if
            mmp.envids[gmcp.Room.Info.environment] and
            mmp.envids[gmcp.Room.Info.environment] ~= getRoomEnv(num)
          then
            setRoomEnv(num, mmp.envids[gmcp.Room.Info.environment])
            s =
              s ..
              (#s &gt; 0 and " " or "") ..
              "Updated environment name to " ..
              gmcp.Room.Info.environment ..
              "."
          end
          -- check indoors status
          if mmp.game ~= "asteria" or mmp.game ~= "ashyria" then
            local indoors = table.contains(gmcp.Room.Info.details, "indoors")
            if indoors and (getRoomUserData(num, "indoors") == '' or getRoomUserData(num,"outdoors") ~= '') then
            setRoomUserData(num, "indoors", "y")
            clearRoomUserDataItem(num, "outdoors")
            s = s .. (#s &gt; 0 and " " or "") .. "Updated room to be indoors."
          elseif not indoors and (getRoomUserData(num, "indoors") ~= '' or getRoomUserData(num, "outdoors") == '') then
            clearRoomUserDataItem(num, "indoors")
            setRoomUserData(num, "outdoors", "y")
            s = s .. (#s &gt; 0 and " " or "") .. "Updated room to be outdoors."
          end
        end

          -- check server area name (Achaea only for now)
          if mmp.game == "achaea" then
            local serverArea = gmcp.Room.Info.area
            if serverArea ~= getRoomUserData(num, "Game Area") then
              setRoomUserData(num, "Game Area", serverArea)
              s = s .. (#s &gt; 0 and " " or "") .. "Updated game area to " .. serverArea .. "."
            end
          end
          -- check for wilderness exits
          if getRoomChar(num) ~= "W" and table.contains(gmcp.Room.Info.details, "wilderness") then
            setRoomChar(num, "W")
            s = s .. (#s &gt; 0 and " " or "") .. "Added the wilderness mark."
          end
        end
        if #s &gt; 0 then
          mmp.echo(s)
          centerview(mmp.currentroom)
        end
      end,
      function(error)
        mmp.echo("Oops! Had a small problem (" .. error .. ").")
        echo("  ")
        echoLink(
          "view steps",
          'echo[[' .. debug.traceback() .. ']]',
          "View steps of code that led up to it"
        )
      end
    )
  if not s then
    mmp.echo(m)
  end
end</script>
								<eventHandlerList>
									<string>gmcp.Room.Info</string>
									<string>RoomNum</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmp.saveOptions</name>
								<packageName></packageName>
								<script>function mmp.saveOptions()
	local saveTable = {
		locked_areas = mmp.locked,
		options = mmp.settings:getAllOptions()
	}
  local _sep
	if string.char(getMudletHomeDir():byte()) == "/" then _sep = "/" else  _sep = "\\" end
	local saveFile = getMudletHomeDir() ..  _sep .. "mapper.options.lua"

	table.save(saveFile, saveTable)
end</script>
								<eventHandlerList>
									<string>sysExitEvent</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>mmp.loadOptions</name>
								<packageName></packageName>
								<script>function mmp.loadOptions()
	local loadTable = mmp.loadLocks()

	if loadTable.options then
		for k, v in pairs(loadTable.options) do
			mmp.settings:setOption(k, v, true)
		end
	end
end

function mmp.loadLocks()
	local loadTable = {}
  local _sep
	if string.char(getMudletHomeDir():byte()) == "/" then _sep = "/" else  _sep = "\\" end
	local loadFile = getMudletHomeDir() ..  _sep .. "mapper.options.lua"

    if io.exists(loadFile) then table.load(loadFile, loadTable) end

	if loadTable.locked_areas then
		mmp.locked = loadTable.locked_areas
	end

    local lockRoom, getAreaRooms = lockRoom, getAreaRooms
	for area in pairs(mmp.locked) do
		local rooms = getAreaRooms(area)
		for _, roomid in pairs(rooms or {}) do
			lockRoom(roomid, true)
		end
	end

	return loadTable
end</script>
								<eventHandlerList>
									<string>sysLoadEvent</string>
								</eventHandlerList>
							</Script>
						</ScriptGroup>
						<ScriptGroup isActive="yes" isFolder="yes">
							<name>Game-specific</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>Achaea</name>
								<packageName></packageName>
								<script></script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>mmp.registerAchaeasEnvData</name>
									<packageName></packageName>
									<script>function mmp.registerAchaeasEnvData(_, game)
  if game ~= "Achaea" then
    return
  end
  mmp.envids =
    {
      ["Constructed underground"] = 2,
      ["Crimson Sea"] = 45,
      ["Deep Ocean"] = 24,
      ["Deep Ocean floor"] = 30,
      ["Dwarven city"] = 18,
      ["Lava Fields"] = 39,
      ["Magma Caves"] = 31,
      ["Natural underground"] = 3,
      ["Ocean floor"] = 34,
      ["Planar Highway"] = 42,
      ["Sanguine River"] = 44,
      ["Tsol'aa city"] = 19,
      ["Vast Ocean"] = 40,
      Abstract = 37,
      Agrarian = 48,
      Ausafoss = 47,
      Beach = 5,
      Blighted = 29,
      Catacombs = 14,
      Chaos = 38,
      Desert = 6,
      Earthen = 43,
      Flames = 49,
      Forest = 4,
      Freshwater = 22,
      Garden = 21,
      Grasslands = 7,
      Hills = 9,
      Jungle = 17,
      Mountains = 14,
      Nothing = 0,
      Ocean = 20,
      Path = 11,
      Polar = 27,
      Reef = 25,
      River = 10,
      Road = 12,
      Ruins = 32,
      Sewer = 23,
      Skies = 10,
      Storm = 50,
      Swamp = 15,
      Trees = 28,
      Tundra = 16,
      Urban = 8,
      Valley = 13,
      Vessel = 36,
      Viscera = 46,
      Wastelands = 41,
      Water = 30,
    }
  mmp.waterenvs = {}
  local waterids =
    {"Freshwater", "Ocean", "River", "Deep Ocean", "Water", "Reef", "Ocean floor", "Vast Ocean"}
  for i = 1, #waterids do
    mmp.waterenvs[mmp.envids[waterids[i]]] = true
  end
  mmp.envidsr = {}
  for name, id in pairs(mmp.envids) do
    mmp.envidsr[id] = name
  end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>mmp.achaeaGaiaWhirlpoolReset</name>
									<packageName></packageName>
									<script>function mmp.achaeaGaiaWhirlpoolReset(event, game)
	if game == "Achaea" then
		mmp.whirlString = 'script: send("enter whirlpool") if tempWhirlTrigger then killTrigger(tempWhirlTrigger) tempWhirlTrigger = nil end if tempWhirlTimer then killTimer(killWhirlTimer) tempWhirlTimer = nil end tempWhirlTrigger = tempTrigger("What do you wish to enter?", [[if tempWhirlTimer then killTimer(tempWhirlTimer) tempWhirlTimer = nil end mmp.echo("Whirlpool not found here. Trying another room.") local x = {45817, 45780, 45903, 45868, 46254, 45866} if tempWhirlTrigger then killTrigger(tempWhirlTrigger) tempWhirlTrigger = nil end clearSpecialExits(]]..mmp.currentroom..[[) local y = table.index_of(x, ]]..mmp.currentroom..[[) + 1 if y &gt; #x then y = 1 end addSpecialExit(x[y], 793, mmp.whirlString) mmp.clearpathcache() mmp.gotoRoom(mmp.speedWalkPath[#mmp.speedWalkPath]) mmp.echo("Moved whirlpool to "..x[y]..".")]]) tempWhirlTimer = tempTimer(1, [[if tempWhirlTrigger then killTrigger(tempWhirlTrigger) tempWhirlTrigger = nil end if tempWhirlTimer then killTimer(tempWhirlTimer) tempWhirlTimer = nil end]])'
		local x = {45817, 45780, 45903, 45868, 46254, 45866}
		for i, v in ipairs(x) do clearSpecialExits(v) end
		addSpecialExit(45868, 793, mmp.whirlString)
	end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>Shackle handling</name>
									<packageName></packageName>
									<script>local density = false
--Wear shackle function

function mmp.wearShackle()
  if mmp.settings.shackle and density then
    send("wear shackle")
  end
end

function mmp.unwearShackle()
  if mmp.settings.shackle and mmp.defs.current.density then
    density = true
    send("remove shackle")
  elseif not mmp.defs.current.density then
    density = false
  end
end

--Event Handlers
registerAnonymousEventHandler("mmapper failed path", "mmp.wearShackle")
registerAnonymousEventHandler("mmapper stopped", "mmp.wearShackle")
registerAnonymousEventHandler("mmapper arrived", "mmp.wearShackle")
registerAnonymousEventHandler("started speedwalk", "mmp.unwearShackle")</script>
									<eventHandlerList />
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>mmp Achaea Orb of Confinement</name>
									<packageName></packageName>
									<script>--returns a table depending on current crowdmap settings. Functionized so that these tables will only have to be stored in one location.
function mmp.getAchaeaOrbTable()
  return
  --first table is areas in each org for the crowdmap, second is for the game provided map.
    mmp.settings.crowdmap and
    {
      ashtan = {49, 53},
      cyrene = {57, 59, 62, 63, 68, 70},
      eleusis = {51},
      hashan = {55, 56, 267},
      mhaldor = {44, 40, 48},
      targossas = {368},
    } or
    {
      ashtan = {49, 53, 54, 60},
      cyrene = {57, 62, 67, 174, 189, 292, 293, 294},
      eleusis = {51},
      hashan = {55, 56},
      mhaldor = {44, 48, 295, 296, 297},
      targossas = {271, 277, 298, 299, 300},
    }
end

--roomID is optional, if not it will default to current room. Returns true if you're in an area covered by the orb of confinement.
function mmp.orbed(roomID)
  if mmp.game ~= "achaea" then
    return false
  end
  local orbTable = mmp.getAchaeaOrbTable()
  --first table is the areas in the city for the crowdmap, second is for the game provided map.
  local areaID = getRoomArea(roomID or mmp.currentroom)
  for city, areaTable in pairs(orbTable) do
    if table.contains(areaTable, areaID) then
      return mmp.settings["orb" .. city]
    end
  end
  return false
end</script>
									<eventHandlerList />
								</Script>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Aetolia</name>
								<packageName></packageName>
								<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>mmp.registerAetoliasEnvData</name>
									<packageName></packageName>
									<script>function mmp.registerAetoliasEnvData(_, game)
  if game ~= "Aetolia" then return end

  mmp.envids =
  {
    ["a bridge"]                = 55,
    ["Airship wreckage"]        = 62,
    ["camp site"]               = 57,
    ["Constructed underground"] = 2,
    ["Deep ocean"]              = 24,
    ["lifeless sands"]          = 54,
    ["logged forest"]           = 56,
    ["Natural underground"]     = 3,
    ["Tsol'aa city"]            = 19,
    ["Underwater city"]         = 28,
    ["within a tree"]           = 36,
    Beach                       = 5,
    Canyon                      = 34,
    Castle                      = 61,
    Cavern                      = 69,
    Chaos                       = 1,
    Crater                      = 37,
    Desert                      = 6,
    Ethereal                    = 67,
    Forest                      = 4,
    Freshwater                  = 22,
    Garden                      = 21,
    Grasslands                  = 7,
    Graveyard                   = 31,
    grotto                      = 70,
    Hills                       = 9,
    Ice                         = 30,
    Jungle                      = 17,
    lava                        = 39,
    Mines                       = 32,
    Mountains                   = 14,
    Ocean                       = 20,
    Onboard                     = 33,
    Path                        = 11,
    Reef                        = 25,
    River                       = 10,
    Road                        = 12,
    Ruins                       = 26,
    Sewer                       = 23,
    Shadows                     = 58,
    Swamp                       = 15,
    Temple                      = 29,
    Tundra                      = 16,
    Urban                       = 8,
    Valley                      = 13,
    Village                     = 27,
  }

  mmp.waterenvs = {}
  local waterids = { "River", "Freshwater", "Deep ocean", "Reef", "Underwater city" }
  for i = 1, #waterids do mmp.waterenvs[mmp.envids[waterids[i]]] = true end

  mmp.envidsr = {};
  for name, id in pairs(mmp.envids) do mmp.envidsr[id] = name end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>mmp.aetContinentCheck</name>
									<packageName></packageName>
									<script>local oldArea = oldArea or ""
function mmp.aetContinentCheck()
  if mmp.game ~= "aetolia" then return end
  
  if oldArea ~= gmcp.Room.Info.area then
    oldArea = gmcp.Room.Info.area
    enableTrigger("Aetolia Gag Survey")
    send("survey",false)
    tempTimer(5,function() disableTrigger("Aetolia Gag Survey") end)
  end
end</script>
									<eventHandlerList>
										<string>gmcp.Room.Info</string>
									</eventHandlerList>
								</Script>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Ashyria</name>
								<packageName></packageName>
								<script></script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>mmp.asteriaStopSpeedwalkForWrongDir</name>
									<packageName></packageName>
									<script>function mmp.ashyriaStopSpeedwalkForWrongDir()
  if mmp.game and mmp.game ~= "ashyria" then
    return
  end
  if #mmp.speedWalkPath &gt; 0 then
    echo("Can't go \"" .. gmcp.Room.WrongDir .. "\". Stopping speedwalk.")
    mmp.stop()
  end
end</script>
									<eventHandlerList>
										<string>gmcp.Room.WrongDir</string>
									</eventHandlerList>
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>mmp.registerAshyriaEnvData</name>
									<packageName></packageName>
									<script>function mmp.registerAshyriaEnvData(_, game)
  if game ~= "ashyria" then
    return
  end
  mmp.envids =
    {
      Air = 20,
      Airship = 21,
      Badland = 22,
      Beach = 23,
      Carriage = 24,
      Cave = 25,
      City = 26,
      Coast = 27,
      Default = 28,
      Desert = 29,
      Field = 30,
      Forest = 31,
      Ghetto = 32,
      Hills = 33,
      Home = 34,
      Inn = 35,
      Inside = 36,
      Marsh = 37,
      Mountain = 38,
      Road = 39,
      Ship = 40,
      Shop = 41,
      Temple = 42,
      Tundra = 43,
      Underwater = 44,
      Vehicle = 45,
      Water = 46,
    }
  mmp.waterenvs = {}
  mmp.envidsr = {}
  for name, id in pairs(mmp.envids) do
    mmp.envidsr[id] = name
  end


mmp.colorcodes = {}
mmp.colorcodes[20] = {176, 224, 230, 255}
mmp.colorcodes[21] = {160, 82, 45, 255}
mmp.colorcodes[22] = {205, 133, 63, 255}
mmp.colorcodes[23] = {218, 165, 32, 255}
mmp.colorcodes[24] = {132, 112, 255, 255}
mmp.colorcodes[25] = {47, 79, 79, 255}
mmp.colorcodes[26] = {190, 190, 190, 255}
mmp.colorcodes[27] = {210, 180, 140, 255}
mmp.colorcodes[28] = {255, 69, 0, 255}
mmp.colorcodes[29] = {255, 215, 0, 255}
mmp.colorcodes[30] = {127, 255, 0, 255}
mmp.colorcodes[31] = {0, 100, 0, 255}
mmp.colorcodes[32] = {184, 134, 11, 255}
mmp.colorcodes[33] = {50, 205, 50, 255}
mmp.colorcodes[34] = {102, 205, 170, 255}
mmp.colorcodes[35] = {0, 128, 128, 255}
mmp.colorcodes[36] = {255, 250, 205, 255}
mmp.colorcodes[37] = {107, 142, 35, 255}
mmp.colorcodes[38] = {139, 69, 19, 255}
mmp.colorcodes[39] = {112, 128, 144, 255}
mmp.colorcodes[40] = {265, 42, 42, 255}
mmp.colorcodes[41] = {0, 190, 255, 255}
mmp.colorcodes[42] = {138, 43, 226, 255}
mmp.colorcodes[43] = {255, 250, 250, 255}
mmp.colorcodes[44] = {65, 105, 225, 255}
mmp.colorcodes[45] = {90, 158, 160, 255}
mmp.colorcodes[46] = {30, 144, 255, 255}

function mmp.setAshyriaColorcodes()
  for id, rgba in pairs(mmp.colorcodes) do
    setCustomEnvColor(id, rgba[1], rgba[2], rgba[3], rgba[4])
  end
 end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>mmp.ashyriaCanMove</name>
									<packageName></packageName>
									<script>-- Asteria's GMCP butts heads with existing GMCP 'able' checks in the speedwalking script. This works around it.

function mmp.ashyriaCanMove(_, game)
  if game ~= "ashyria" then
    return
  end

function mmp.mapperCanMove()
    return gmcp.Char and gmcp.Char.Balance and gmcp.Char.Balance.balance == 0
  end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Asteria</name>
								<packageName></packageName>
								<script></script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>mmp.asteriaStopSpeedwalkForWrongDir</name>
									<packageName></packageName>
									<script>function mmp.asteriaStopSpeedwalkForWrongDir()
  if mmp.game and mmp.game ~= "asteria" then
    return
  end
  if #mmp.speedWalkPath &gt; 0 then
    echo("Can't go \"" .. gmcp.Room.WrongDir .. "\". Stopping speedwalk.")
    mmp.stop()
  end
end</script>
									<eventHandlerList>
										<string>gmcp.Room.WrongDir</string>
									</eventHandlerList>
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>mmp.registerAsteriasEnvData</name>
									<packageName></packageName>
									<script>function mmp.registerAsteriasEnvData(_, game)
  if game ~= "Asteria" then
    return
  end
  mmp.envids =
    {
      Air = 20,
      Airship = 21,
      Badland = 22,
      Beach = 23,
      Carriage = 24,
      Cave = 25,
      City = 26,
      Coast = 27,
      Default = 28,
      Desert = 29,
      Field = 30,
      Forest = 31,
      Ghetto = 32,
      Hills = 33,
      Home = 34,
      Inn = 35,
      Inside = 36,
      Marsh = 37,
      Mountain = 38,
      Road = 39,
      Ship = 40,
      Shop = 41,
      Temple = 42,
      Tundra = 43,
      Underwater = 44,
      Vehicle = 45,
      Water = 46,
    }
  mmp.waterenvs = {}
  mmp.envidsr = {}
  for name, id in pairs(mmp.envids) do
    mmp.envidsr[id] = name
  end


mmp.colorcodes = {}
mmp.colorcodes[20] = {176, 224, 230, 255}
mmp.colorcodes[21] = {160, 82, 45, 255}
mmp.colorcodes[22] = {205, 133, 63, 255}
mmp.colorcodes[23] = {218, 165, 32, 255}
mmp.colorcodes[24] = {132, 112, 255, 255}
mmp.colorcodes[25] = {47, 79, 79, 255}
mmp.colorcodes[26] = {190, 190, 190, 255}
mmp.colorcodes[27] = {210, 180, 140, 255}
mmp.colorcodes[28] = {255, 69, 0, 255}
mmp.colorcodes[29] = {255, 215, 0, 255}
mmp.colorcodes[30] = {127, 255, 0, 255}
mmp.colorcodes[31] = {0, 100, 0, 255}
mmp.colorcodes[32] = {184, 134, 11, 255}
mmp.colorcodes[33] = {50, 205, 50, 255}
mmp.colorcodes[34] = {102, 205, 170, 255}
mmp.colorcodes[35] = {0, 128, 128, 255}
mmp.colorcodes[36] = {255, 250, 205, 255}
mmp.colorcodes[37] = {107, 142, 35, 255}
mmp.colorcodes[38] = {139, 69, 19, 255}
mmp.colorcodes[39] = {112, 128, 144, 255}
mmp.colorcodes[40] = {265, 42, 42, 255}
mmp.colorcodes[41] = {0, 190, 255, 255}
mmp.colorcodes[42] = {138, 43, 226, 255}
mmp.colorcodes[43] = {255, 250, 250, 255}
mmp.colorcodes[44] = {65, 105, 225, 255}
mmp.colorcodes[45] = {90, 158, 160, 255}
mmp.colorcodes[46] = {30, 144, 255, 255}

function mmp.setAsteriaColorcodes()
  for id, rgba in pairs(mmp.colorcodes) do
    setCustomEnvColor(id, rgba[1], rgba[2], rgba[3], rgba[4])
  end
 end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>mmp.asteriaCanMove</name>
									<packageName></packageName>
									<script>-- Asteria's GMCP butts heads with existing GMCP 'able' checks in the speedwalking script. This works around it.

function mmp.asteriaCanMove(_, game)
  if game ~= "Asteria" then
    return
  end

function mmp.mapperCanMove()
    return gmcp.Char and gmcp.Char.Balance and gmcp.Char.Balance.balance == 0
  end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Dragonswords</name>
								<packageName></packageName>
								<script></script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>mmp.dragonswordsStopSpeedwalkForWrongDir</name>
									<packageName></packageName>
									<script>function mmp.dragonswordsStopSpeedwalkForWrongDir()
  if mmp.game and mmp.game ~= "dragonswords" then
    return
  end
  if #mmp.speedWalkPath &gt; 0 then
    echo("The way \"" .. gmcp.Room.WrongDir .. "\" is blocked. Stopping speedwalk.")
    mmp.stop()
  end
end</script>
									<eventHandlerList>
										<string>gmcp.Room.WrongDir</string>
									</eventHandlerList>
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>mmp.registerDragonswordsEnvData</name>
									<packageName></packageName>
									<script>function mmp.registerDragonswordsEnvData(_, game)
  if game ~= "dragonswords" then
    return
  end
  mmp.envids =
    {
      ["inside"] = 1,
        ["city"] = 2,
        ["field"] = 3,
        ["forest"] = 4,
        ["hills"] = 5,
        ["mountain"] = 6,
        ["swim"] = 7,
        ["noswim"] = 8,
        ["underwater"] = 9,
        ["air"] = 10,
        ["desert"] = 11,
        ["river"] = 12,
        ["oceanfloor"] = 13,
        ["underground"] = 14,
        ["jungle"] = 15,
        ["swamp"] = 16,
        ["tundra"] = 17,
        ["ice"] = 18,
        ["ocean"] = 19,
        ["lava"] = 20,
        ["shore"] = 21,
        ["tree"] = 22,
        ["stone"] = 23,
        ["quicksand"] = 24,
        ["wall"] = 25,
        ["glacier"] = 26,
        ["exit"] = 27,
        ["trail"] = 28,
        ["badlands"] = 29,
        ["grassland"] = 30,
        ["scrub"] = 31,
        ["barren"] = 32,
        ["bridge"] = 33,
        ["road"] = 34,
    }
  mmp.waterenvs = {}
  mmp.envidsr = {}
  for name, id in pairs(mmp.envids) do
    mmp.envidsr[id] = name
  end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Lusternia</name>
								<packageName></packageName>
								<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>mmp.registerLusterniasEnvData</name>
									<packageName></packageName>
									<script>function mmp.registerLusterniasEnvData(_, game)
  if game ~= "Lusternia" then return end

  mmp.envids =
  {
    ["constructed underground"] = 2,
    ["deep ocean"]              = 24,
    ["natural underground"]     = 3,
    ["constructed underwater"]  = 41,
    aether                      = 36,
    astral                      = 35,
    beach                       = 5,
    chaos                       = 39,
    clouds                      = 37,
    concordance                 = 38,
    darkness                    = 1,
    desert                      = 6,
    divine                      = 33,
    farmlands                   = 30,
    flesh                       = 18,
    forest                      = 4,
    freshwater                  = 22,
    garden                      = 21,
    grasslands                  = 7,
    hills                       = 9,
    jungle                      = 17,
    mountains                   = 14,
    netherworld                 = 34,
    ocean                       = 20,
    path                        = 11,
    polar                       = 27,
    reef                        = 25,
    river                       = 10,
    road                        = 12,
    ruins                       = 19,
    sewer                       = 23,
    swamp                       = 15,
    trees                       = 28,
    tundra                      = 16,
    urban                       = 8,
    valley                      = 13,
    volcanic                    = 32,
    wasteland                   = 29,
    badlands                    = 40,
    wetlands                    = 31,
  }

  mmp.waterenvs = {}
  local waterids = { "river", "ocean", "freshwater", "deep ocean" }
  for i = 1, #waterids do mmp.waterenvs[mmp.envids[waterids[i]]] = true end

  mmp.envidsr = {};
  for name, id in pairs(mmp.envids) do mmp.envidsr[id] = name end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>Astral utilities</name>
									<packageName></packageName>
									<script>local astralExits =
  {
    {5079, 5175, "n"},
    {5072, 5065, "w"},
    {5088, 5132, "e"},
    {5145, 5176, "s"},
    {5138, 5146, "e"},
    {5158, 5192, "s"},
    {5152, 5041, "e"},
    {5031, 5042, "e"},
    {5022, 5131, "n"},
    {5116, 5198, "w"},
    {5130, 5096, "e"},
    {5089, 5058, "n"},
    {5102, 5115, "e"},
    {5111, 5159, "e"},
    {5103, 5071, "n"},
    {5059, 5053, "w"},
    {5187, 5169, "w"},
    {5190, 5204, "e"},
    {5065, 5072, "e"},
    {45333, 5093, "u"},
    {45334, 5113, "u"},
    {45356, 5075, "u"},
    {45335, 5171, "u"},
    {45357, 5066, "u"},
    {45329, 5156, "u"},
    {45330, 5201, "u"},
    {45331, 5121, "u"},
    {45324, 5055, "u"},
    {45354, 5177, "u"},
    {45325, 5024, "u"},
    {45355, 5133, "u"},
  }
local mirror =
  {
    n = "s",
    ne = "sw",
    e = "w",
    se = "nw",
    s = "n",
    sw = "ne",
    w = "e",
    nw = "se",
    u = "d",
    d = "u",
    out = "in",
    ["in"] = "out",
  }

function mmp.astroboots()
  if mmp.game ~= "lusternia" then
    return
  end
  local option = mmp.settings.astrojump
  mmp.echo("&lt;green&gt;" .. (option and "Set up" or "Removed") .. " &lt;white&gt;Astrojump &lt;green&gt;exits")
  local exitString = [[script:if gmcp.Room.Info.exits.%s then send("%s", false) else send("astrojump", false) end]]
  for k, v in pairs(astralExits) do
    if option then
      addSpecialExit(v[1], v[2], string.format(exitString, v[3], v[3]))
      addSpecialExit(v[2], v[1], string.format(exitString, mirror[v[3]], mirror[v[3]]))
    else
      removeSpecialExit(v[1], "astrojump")
      removeSpecialExit(v[2], "astrojump")
      removeSpecialExit(v[1], string.format(exitString, v[3], v[3]))
      removeSpecialExit(v[2], string.format(exitString, mirror[v[3]], mirror[v[3]]))
    end
  end
end

function mmp.wildnodes(create)
  if mmp.game ~= "lusternia" then
    return
  end
  for k, v in pairs(astralExits) do
    if create then
      mmp.setExit(v[1], v[2], v[3])
      mmp.setExit(v[2], v[1], mirrorExits[v[3]])
    else
      mmp.setExit(v[1], -1, v[3])
      mmp.setExit(v[2], -1, mirrorExits[v[3]])
    end
  end
end</script>
									<eventHandlerList />
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>Transverse and pathfind</name>
									<packageName></packageName>
									<script>local planes =
  {
    ["the Prime Material Plane"] = "prime",
    ["the Ethereal Plane"] = "ethereal",
    ["the Water Elemental Plane"] = "elemental",
    ["the Earth Elemental Plane"] = "elemental",
    ["the Air Elemental Plane"] = "elemental",
    ["the Fire Elemental Plane"] = "elemental",
    ["Celestia, Plane of Light"] = "cosmic",
    ["the Cosmic Plane of Vortex"] = "cosmic",
    ["the Cosmic Plane of Continuum"] = "cosmic",
    ["the Tainted Plane of Nil"] = "cosmic",
    ["the Astral Plane"] = "astral",
  }

function mmp.transverse(_, command)
  command = command:lower()
  if command:sub(0, 11) == "transverse " or command == "pathfind" then
    transverseCMD = command
    transversedFrom = gmcp.Room.Info.num
    lastPlane = planes[gmcp.Room.Info.details[1]]
    validTransverse = true
  end
end

registerAnonymousEventHandler("sysDataSendRequest", "mmp.transverse")

function mmp.registerTransverseExit()
  if transversedFrom ~= gmcp.Room.Info.num then
    addSpecialExit(transversedFrom, gmcp.Room.Info.num, transverseCMD)
    setExitWeight(transversedFrom, transverseCMD, 20)
    if lastPlane then
      addSpecialExit(gmcp.Room.Info.num, transversedFrom, "transverse " .. lastPlane)
      setExitWeight(gmcp.Room.Info.num, "transverse " .. lastPlane, 20)
    end
    validTransverse = false
  end
end

function mmp.clearTransverse()
  local otherSide = 0
  for room, command in pairs(getSpecialExits(gmcp.Room.Info.num)) do
    if next(command) == transverseCMD then
      otherSide = room
    end
  end
  for room, command in pairs(getSpecialExits(otherSide) or {}) do
    if room == gmcp.Room.Info.num and string.sub(next(command), 0, 11) == "transverse " then
      removeSpecialExit(otherSide, next(command))
    end
  end
  removeSpecialExit(gmcp.Room.Info.num, transverseCMD)
  if mmp.autowalking then
    mmp.autowalking = false
    mmp.gotoRoom(string.split(next(mmp.showpathcache()), "_")[2])
  end
end

function mmp.registerPathfind()
  addSpecialExit(transversedFrom, gmcp.Room.Info.num, "pathfind")
  setExitWeight(transversedFrom, "pathfind", 15)
  addSpecialExit(gmcp.Room.Info.num, transversedFrom, "pathfind")
  setExitWeight(gmcp.Room.Info.num, "pathfind", 15)
  validTransverse = false
end

function mmp.clearPathfind()
  local otherSide = 0
  for room, command in pairs(getSpecialExits(gmcp.Room.Info.num)) do
    if next(command) == "pathfind" then
      otherSide = room
    end
  end
  for room, command in pairs(getSpecialExits(otherSide) or {}) do
    if room == gmcp.Room.Info.num and next(command) == "pathfind" then
      removeSpecialExit(otherSide, next(command))
    end
  end
  removeSpecialExit(gmcp.Room.Info.num, "pathfind")
  if mmp.autowalking then
    mmp.autowalking = false
    mmp.gotoRoom(string.split(next(mmp.showpathcache()), "_")[2])
  end
end

function mmp.lockpaths(lock)
  local count = 0
  for area, areaname in pairs(mmp.areatabler) do
    local rooms = getAreaRooms(area) or {}
    for i = 0, #rooms do
      local exits = getSpecialExits(rooms[i] or 0)
      for room, command in pairs(exits or {}) do
        if next(command) == "pathfind" then
          count = count + 1
          lockSpecialExit(rooms[i], room, "pathfind", lock)
        end
      end
    end
  end
  mmp.echo((lock and "Locked " or "Unlocked ") .. count .. " pathfinding exits.")
end</script>
									<eventHandlerList />
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>Lusternia basin areas</name>
									<packageName></packageName>
									<script>local basinAreas =
  {
    ["Ackleberry Highway"] = true,
    ["Alabaster Road"] = true,
    ["Avechna's Peak"] = true,
    ["Avechna's Teeth"] = true,
    ["Balach Swamp"] = true,
    ["Bondero Bay"] = true,
    ["Caoimhe Dell"] = true,
    ["Cay of Cloadahi"] = true,
    ["Emerald Road"] = true,
    ["Epicure's Alley"] = true,
    ["Glomdoring Forest"] = true,
    ["Great Southern Highway"] = true,
    ["Highwater Keep"] = true,
    ["Irshaw Heights"] = true,
    ["Mornhai Sanctuary"] = true,
    ["Mount Krog"] = true,
    ["Mount Wend"] = true,
    ["Mount Zoaka"] = true,
    ["Old Imperial Road"] = true,
    ["Snow Valley"] = true,
    ["Spectre Isle"] = true,
    ["St. Gathlyn's Orphanage for the Dispossessed"] = true,
    ["The Emerald Enclave"] = true,
    ["Tolborolla Valley"] = true,
    ["Verasavir Valley"] = true,
    ["Waste Storage Facility"] = true,
    ["Wyrden Isle"] = true,
    ["the Base of Operations"] = true,
    ["the Blasted Land"] = true,
    ["the Carai Caroo"] = true,
    ["the Caverns of Muhanlesh"] = true,
    ["the Caves of Hhuhur"] = true,
    ["the Chancel of Clangoran Mysteries"] = true,
    ["the City of Gaudiguch"] = true,
    ["the City of Hallifax"] = true,
    ["the City of Magnagora"] = true,
    ["the City of New Celest"] = true,
    ["the Clarramore Cloud Gardens"] = true,
    ["the Crimson Lady"] = true,
    ["the Divine Luck Club"] = true,
    ["the Dracnari Nomad Camp"] = true,
    ["the Empress' Last Breath"] = true,
    ["the Estengare River"] = true,
    ["the Feyranti Estate"] = true,
    ["the Floating Island of the Forgotten"] = true,
    ["the Gloriana River"] = true,
    ["the Grand Junction Bazaar"] = true,
    ["the Grey Moors"] = true,
    ["the Hifarae Hills"] = true,
    ["the Inner Sea"] = true,
    ["the Isle of Itecia"] = true,
    ["the Isle of Nyalia"] = true,
    ["the Isle of Olimsito"] = true,
    ["the Isle of Vesucia"] = true,
    ["the Kelpie Maiden"] = true,
    ["the Kiakodan Nature Reserve"] = true,
    ["the Lucidian Mesa Compound"] = true,
    ["the Meliashmora of Imperial Secrets"] = true,
    ["the New Celest sewer system"] = true,
    ["the Northern Mountains"] = true,
    ["the Oleanvir Valley"] = true,
    ["the Presidio of the Damned"] = true,
    ["the Razine Mountain Range"] = true,
    ["the Rhizoda Mangrove"] = true,
    ["the Ruins of Shallach"] = true,
    ["the Scorpion Caverns"] = true,
    ["the Sea of Despair"] = true,
    ["the Serenwilde Forest"] = true,
    ["the Shallach River"] = true,
    ["the Shallamurine Cathedral"] = true,
    ["the Skarch Desert"] = true,
    ["the Southern Mountains"] = true,
    ["the Tainted Broadcast Centre"] = true,
    ["the Tar Pits"] = true,
    ["the Tosha Monastery"] = true,
    ["the Transcendental Fulcrux"] = true,
    ["the Triple Junction Inn"] = true,
    ["the Upper Peaks of the Razines"] = true,
    ["the Upper Peaks of the Southern Mountains"] = true,
    ["the Village of Acknor"] = true,
    ["the Village of Angkrag"] = true,
    ["the Village of Dairuchi"] = true,
    ["the Village of Delport"] = true,
    ["the Village of Duum"] = true,
    ["the Village of Estelbar"] = true,
    ["the Village of Paavik"] = true,
    ["the Village of Rikenfriez"] = true,
    ["the Village of Rockholm"] = true,
    ["the Village of Shanthmark"] = true,
    ["the Village of Southgard"] = true,
    ["the Village of Stewartsville"] = true,
    ["the Village of Talthos"] = true,
    ["the i'Xiia Asylum"] = true,
    ["the sewers of Magnagora"] = true,
  }

function mmp.lusterniaInBasin()
  return basinAreas[gmcp.Room.Info.area] or false
end</script>
									<eventHandlerList />
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>mmp.lusterniaMapUpdated</name>
									<packageName></packageName>
									<script>function mmp.lusterniaMapUpdated()
  if mmp.game == "lusternia" then
    mmp.lockPathways()
    mmp.astroboots()
  end
end</script>
									<eventHandlerList>
										<string>mmapper updated map</string>
										<string>sysMapDownloadEvent</string>
									</eventHandlerList>
								</Script>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Imperian</name>
								<packageName></packageName>
								<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>mmp.registerImperiansEnvData</name>
									<packageName></packageName>
									<script>function mmp.registerImperiansEnvData(_, game)
  if game ~= "Imperian" then return end
  mmp.envids =
  {
    ["a sheltered dell"]        = 68,
    ["Arcane Temple"]           = 66,
    ["Blackened Lands"]         = 58,
    ["Blackstone Dungeon"]      = 65,
    ["Blackstone Keep"]         = 62,
    ["Constructed underground"] = 2,
    ["Dark Forest"]             = 1,
    ["Deep Ocean"]              = 24,
    ["Desert Ruins"]            = 38,
    ["Dwarven city"]            = 18,
    ["Forestal Council"]        = 44,
    ["Frozen Bog"]              = 76,
    ["Lake of Fire"]            = 56,
    ["Natural underground"]     = 3,
    ["Noble Bar"]               = 53,
    ["Noble Chambers"]          = 51,
    ["Rocky Shore"]             = 77,
    ["Sylayan city"]            = 19,
    ["Tainted Underground"]     = 35,
    ["Tainted Water"]           = 39,
    ["Underground Lake"]        = 36,
    ["Vast Ocean"]              = 26,
    ["Wetlands Village"]        = 64,
    ["within a tent"]           = 69,
    Academia                    = 42,
    Acropolis                   = 33,
    Beach                       = 5,
    Blighted                    = 74,
    bog                         = 73,
    Catacombs                   = 63,
    Church                      = 54,
    Cliffs                      = 67,
    Crags                       = 32,
    Desert                      = 6,
    Docks                       = 30,
    Farmland                    = 41,
    Forest                      = 4,
    Freshwater                  = 22,
    Garden                      = 21,
    garrison                    = 71,
    Grasslands                  = 7,
    Graveyard                   = 46,
    Hills                       = 9,
    Jungle                      = 17,
    Mountains                   = 14,
    Nobility                    = 50,
    Ocean                       = 20,
    Path                        = 11,
    Polar                       = 27,
    Pond                        = 49,
    pyramid                     = 72,
    quarry                      = 70,
    River                       = 10,
    Road                        = 12,
    Ruins                       = 37,
    Scrublands                  = 78,
    Sewer                       = 23,
    Swamp                       = 15,
    Temple                      = 57,
    Tower                       = 79,
    transportation              = 48,
    Tundra                      = 16,
    Underworld                  = 28,
    Urban                       = 8,
    Valley                      = 13,
    Villa                       = 75,
    Village                     = 47,
    Village                     = 55,
    Volcano                     = 59,
    Warrens                     = 31,
  }

  mmp.waterenvs = {}
  local waterids = { "River", "Ocean", "Deep Ocean", "Vast Ocean", "Underground Lake", "Tainted Water", "Lake of Fire" }
  for i = 1, #waterids do mmp.waterenvs[mmp.envids[waterids[i]]] = true end

  mmp.envidsr = {};
  for name, id in pairs(mmp.envids) do mmp.envidsr[id] = name end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Starmourn</name>
								<packageName></packageName>
								<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>Lifts</name>
									<packageName></packageName>
									<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
function mmp.liftFloor(roomname,floornum,currentfloor) --string,int,bool
	if not mmp.autowalking then
		return
	end

	--get room name of next in speedwalkpath
	if not mmp.speedWalkCounter then
    mmp.speedWalkCounter = 1
  end
	local destRoomName = getRoomName(mmp.speedWalkPath[mmp.speedWalkCounter])
	if roomname == nil then roomname = destRoomName end

	if roomname == destRoomName then
		if currentfloor then
			send("EXIT LIFT",false) --Lift is on correct floor, can EXIT LIFT
			if mmp.liftTimer then killTimer(mmp.liftTimer) end
		else
			mmp.customwalkdelay(2) --Lift is on incorrect floor arbitrary wait for next trigger line
			if mmp.liftTimer then killTimer(mmp.liftTimer) end
			mmp.liftTimer = tempTimer(1, function() send("KEY LIFT ".. floornum,false) end )	--wait one second before requesting the correct floor (allows other users to enter/exit)
		end
	end
end</script>
									<eventHandlerList />
								</Script>
								<Script isActive="yes" isFolder="no">
									<name>mmp.registerStarmournsEnvData</name>
									<packageName></packageName>
									<script>function mmp.registerStarmournsEnvData(_, game)
  if game ~= "Starmourn" then
    return
  end
  mmp.envids =
    {
      ["airlock"] = 55,
      ["alleyway"] = 47,
      ["armory"] = 82,
      ["badlands"] = 45,
      ["barracks"] = 77,
      ["bathroom"] = 71,
      ["beach"] = 51,
      ["bedroom"] = 66,
      ["bridge"] = 18,
      ["building"] = 5,
      ["campsite"] = 65,
      ["canal"] = 85,
      ["cantina"] = 62,
      ["canyon"] = 31,
      ["cargo bay"] = 13,
      ["catwalk"] = 23,
      ["cave"] = 37,
      ["commandpost"] = 80,
      ["corral"] = 34,
      ["deep space"] = 11,
      ["desert"] = 7,
      ["duct"] = 22,
      ["engine room"] = 44,
      ["factory"] = 32,
      ["farmland"] = 28,
      ["firingrange"] = 83,
      ["forest"] = 8,
      ["garden"] = 12,
      ["gym"] = 60,
      ["hallway"] = 58,
      ["hangar"] = 26,
      ["hangar"] = 79,
      ["hydroponics"] = 61,
      ["icyforest"] = 52,
      ["jungle"] = 19,
      ["junkyard"] = 48,
      ["lake"] = 49,
      ["lava fields"] = 56,
      ["lava"] = 57,
      ["meadow"] = 30,
      ["medical facility"] = 17,
      ["medical facility"] = 27,
      ["messhall"] = 78,
      ["militarybase"] = 76,
      ["militaryroad"] = 81,
      ["mine"] = 3,
      ["mountain"] = 1,
      ["obstaclecourse"] = 84,
      ["ocean"] = 6,
      ["office"] = 15,
      ["pier/dock"] = 38,
      ["pond"] = 64,
      ["pool"] = 14,
      ["prison"] = 59,
      ["residence"] = 63,
      ["river"] = 50,
      ["road"] = 29,
      ["ruin"] = 42,
      ["sewer"] = 40,
      ["shop"] = 67,
      ["slum"] = 69,
      ["slumbuilding"] = 73,
      ["slumstreet"] = 70,
      ["slumtoilet"] = 72,
      ["spacecraft"] = 9,
      ["spaceport"] = 39,
      ["stateroom"] = 43,
      ["stream"] = 35,
      ["street"] = 2,
      ["swamp"] = 20,
      ["temple"] = 54,
      ["transport"] = 16,
      ["treehouse"] = 36,
      ["treetops"] = 53,
      ["tundra"] = 10,
      ["underground"] = 86,
      ["underwater"] = 87,
      ["urban"] = 4,
      ["urbanunderground"] = 46,
      ["ventilation shaft"] = 21,
      ["verdantcliffs"] = 75,
    }
  mmp.waterenvs = {}
  mmp.envidsr = {}
  for name, id in pairs(mmp.envids) do
    mmp.envidsr[id] = name
  end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Lithmeria</name>
								<packageName></packageName>
								<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>mmp.registerLithmeriasEnvData</name>
									<packageName></packageName>
									<script>function mmp.registerLithmeriasEnvData(_, game)
  if game ~= "Lithmeria" then return end

  mmp.envids =
  {
    ["deep water"] = 4,
    beach          = 11,
    bridge         = 6,
    building       = 13,
    cliffs         = 1,
    desert         = 11,
    forest         = 2,
    highway        = 6,
    jungle         = 10,
    mountain       = 1,
    ocean          = 4,
    path           = 6,
    plains         = 3,
    river          = 4,
    road           = 6,
    shallowwater   = 4,
    swamp          = 2,
    tundra         = 7,
    underground    = 8,
    urban          = 8,
    water          = 4,
  }

  for name, number in pairs(mmp.envids) do
    mmp.envids[name] = number+256 -- adjust for in-built colors
  end

  mmp.waterenvs = {}
  local waterids = { "shallowwater", "river", "water", "deep water", "ocean" }
  for i = 1, #waterids do mmp.waterenvs[mmp.envids[waterids[i]]] = true end

  mmp.envidsr = {};
  for name, id in pairs(mmp.envids) do mmp.envidsr[id] = name end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>StickMUD</name>
								<packageName></packageName>
								<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external scripts --
-------------------------------------------------
</script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>mmp.stickmudStopSpeedwalkForWrongDir</name>
									<packageName></packageName>
									<script>function mmp.stickmudStopSpeedwalkForWrongDir()
  if mmp.game and mmp.game ~= "stickmud" then
    return
  end
  if #mmp.speedWalkPath &gt; 0 then
    echo("The way \"" .. gmcp.Room.WrongDir .. "\" is blocked. Stopping speedwalk.")
    mmp.stop()
  end
end</script>
									<eventHandlerList>
										<string>gmcp.Room.WrongDir</string>
									</eventHandlerList>
								</Script>
							</Script>
						</ScriptGroup>
						<ScriptGroup isActive="yes" isFolder="yes">
							<name>Test / one-time things</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
							<eventHandlerList />
							<Script isActive="no" isFolder="no">
								<name>mmp.grabEnvid</name>
								<packageName></packageName>
								<script>function mmp.grabEnvid()
  if not mmp.envids[gmcp.Room.Info.environment] then
    mmp.envids[gmcp.Room.Info.environment] = getRoomEnv(mmp.currentroom)
    mmp.echo(string.format("Remembered environment %s as %d", gmcp.Room.Info.environment, mmp.envids[gmcp.Room.Info.environment]))
  end
end

function mmp.getMaxID()
  local roomIDs = {}
  for area, _ in pairs(mmp.areatabler) do
    local ok, t = pcall(getAreaRooms, area)
    if ok then
      for _, id in pairs(t or {}) do
        roomIDs[id] = true
      end
    end
  end

  return table.maxn(roomIDs)
end

function mmp.getUnknownEnvs()
  local maxid, missing = mmp.getMaxID(), {}

  for i = 1, maxid do
    if mmp.roomexists(i) then
      if not table.contains(mmp.envids, getRoomEnv(i)) and not table.contains(missing, getRoomEnv(i)) then
        mmp.echo(string.format("Missing env %d from room %d ('%s' in '%s')",
          tostring(getRoomEnv(i)), i, tostring(getRoomName(i)), tostring(mmp.areatabler[getRoomArea(i)])))
        missing[i] = getRoomEnv(i)
      end
    end
  end
end</script>
								<eventHandlerList>
									<string>gmcp.Room.Info</string>
								</eventHandlerList>
							</Script>
						</ScriptGroup>
						<ScriptGroup isActive="yes" isFolder="yes">
							<name>Check for map updates</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------
</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>mmp.downloadedFile</name>
								<packageName></packageName>
								<script>function mmp.downloadedFile(_, filename)
  if not io.exists(filename) then return end

  -- workaround for https://bugs.launchpad.net/mudlet/+bug/1092769
--  if mmp["downloaded_file_block_"..filename] then return end
--  mmp["downloaded_file_block_"..filename] = tempTimer(5, [[mmp["downloaded_file_block_]]..filename..[["] = nil]])

  if filename == tostring(mmp.mapperfile) then   -- mapper script version
	mmp.checkingupdates = false

    local f, s = io.open(filename)
    if f then s = f:read("*l"):trim(); io.close(f) end

    if s ~= tostring(mmp.version) then
      mmp.newmapperversion = s
      mmp.retrievechangelog()
    end

  elseif filename == tostring(mmp.changelogfile) then   -- changelog for the mapper script
	mmp.checkingupdates = false

    local f, s, changelog = io.open(filename)
    if f then changelog = f:read("*a"); io.close(f) end

    echo("\n")
    mmp.echon("------------------[ Mapper Script Update ]------------------")
    mmp.echon(" The mapper script was updated from &lt;orange&gt;"..tostring(mmp.version).."&lt;reset&gt; -&gt; &lt;green&gt;"..tostring(mmp.newmapperversion).."&lt;reset&gt;!")
    mmp.echon("")
    cechoLink(" Would you like to install the update? &lt;u&gt;&lt;ForestGreen&gt;Click here if so&lt;/u&gt;&lt;reset&gt;.", "mmp.downloadmapperscript()", "Changelog for the latest ("..tostring(mmp.version).." -&gt; "..tostring(mmp.newmapperversion)..") update:\n"..changelog, true)
    echo("\n\n")

  elseif filename == mmp.crowdchangelogfile then   -- changelog for the crowdmap
    local f, s = io.open(filename)
    if f then s = f:read("*a"); io.close(f) end

    -- make environment
    local env = {} -- add functions you know are safe here

    -- run code under environment [Lua 5.1]
    local function run(untrusted_code)
      if untrusted_code:byte(1) == 27 then return nil, "binary bytecode prohibited" end
      local untrusted_function, message = loadstring(untrusted_code)
      if not untrusted_function then return nil, message end
      setfenv(untrusted_function, env)
      return pcall(untrusted_function)
    end

    run(s)

	mmp.crowdchangelog = env.changelog

    echo("\n")
    mmp.echon("------------------[ Map Update ]------------------")
    mmp.echon(" The crowdmap map was updated from &lt;orange&gt;"..(mmp.oldversion or "(none)").." &lt;reset&gt;-&gt; &lt;green&gt;"..tostring(mmp.newversion).."&lt;reset&gt;!")
    mmp.echon(" Want to see the full changelog?")
    cechoLink(" &lt;ForestGreen&gt;Click here&lt;reset&gt;.", "mmp.showcrowdchangelog()", 'View the full changelog for mappers', true)
    mmp.echon(" Latest changes were: &lt;LightSkyBlue&gt;"..tostring(mmp.crowdchangelog and mmp.crowdchangelog[#mmp.crowdchangelog] or '?')..".\n")
    echo("\n\n")
    
    mmp.downloadcrowdmap(mmp.newversion)

  elseif filename == mmp.crowdmapfile then    -- crowdmap map
    mmp.echo("Map downloaded, loading it in...")

    local tmp = getRoomUserData(1, "gotoMapping")
    local oldmaptable = {}

    if tmp ~= "" then
      oldmaptable = yajl.to_value(tmp)
    end

    local ok = loadMap(filename)

    if ok then
      if mmp.game ~= "starmourn" then
        local wc = mmp.lockWormholes()
  	local ws = mmp.lockSewers()
        mmp.lockPebble()
        if mmp.game == "achaea" and wc == 0 and ws == 0 then -- in achaea, using crowdmap, if we didn't get any special exits - it means Mudlet needs to be updated
          mmp.echo("Sorry, it seems your Mudlet isn't compatible with the new crowdmap format - and the map cannot be loaded fully. Please update your Mudlet:\n  http://www.mudlet.org/download/")
          return
        end
      end

      if mmp.settings.waterwalk then mmp.enableWaterWalk() else mmp.disableWaterWalk() end

      mmp.echo("Map loaded fine - enjoy!")

      tmp = getRoomUserData(1, "gotoMapping")
      local newmaptable = {}

      if tmp ~= "" then
        newmaptable = yajl.to_value(tmp)
      end

      for k,v in pairs(oldmaptable) do newmaptable[k] = v end
      setRoomUserData(1, "gotoMapping", yajl.to_string(newmaptable))
      mmp.echo("Marks from the old map migrated successfully.")

      raiseEvent("mmapper updated map")
    else
      mmp.echon("Map failed to load - you need to have the mapper open. Please open it, and then ")
      echoLink("click here", [[
        local tmp = getRoomUserData(1, "gotoMapping")
        local oldmaptable = {}
        if tmp ~= "" then
          oldmaptable = yajl.to_value(tmp)
        end

        local ok = loadMap(']]..filename..[[')
        if ok then
        local wc = mmp.lockWormholes()
	    local ws = mmp.lockSewers()
        mmp.lockPebble()
        if mmp.game == "achaea" and wc == 0 and ws == 0 then -- in achaea, using crowdmap, if we didn't get any special exits - it means Mudlet needs to be updated
          mmp.echo("Sorry, it seems your Mudlet isn't compatible with the new crowdmap format - and the map cannot be loaded fully. Please update your Mudlet:\n  http://www.mudlet.org/download/")
          return
        end

        if mmp.settings.waterwalk then mmp.enableWaterWalk() else mmp.disableWaterWalk() end

        mmp.echo("Map loaded successfully!")

          tmp = getRoomUserData(1, "gotoMapping")
          local newmaptable = {}
          if tmp ~= "" then
            newmaptable = yajl.to_value(tmp)
          end
          for k,v in pairs(oldmaptable) do newmaptable[k] = v end
          setRoomUserData(1, "gotoMapping", yajl.to_string(newmaptable))
          mmp.echo("Marks from the old map migrated successfully.")
          raiseEvent("mmapper updated map")
        else mmp.echo("Nope, didn't work. Open the map and try again?") end
      ]],
      "Click here to try loading the map again")
      echo(" to try loading it in again.\n")
    end

  elseif filename == tostring(mmp.downloadedscript) then   -- new mapper script xml downloaded
	  mmp.checkingupdates = false
    mmp.installMapperScript()
  elseif filename == tostring(mmp.mapfile) then   -- map version #, either IRE's or crowd
	mmp.checkingupdates = false

    local function needupdate(currentmd5, oldmd5)
      if not mmp.settings.crowdmap then
        mmp.echon("The games map was ")
        echoLink("updated", '', "New MD5: "..tostring(currentmd5)..", previous MD5: "..(oldmd5 or "(none)"), true)
        echo(" - you should update yours! Go to Settings -&gt; Mapper tab and click on the 'Download' button there. Once you've updated, ")
        echoLink("click here", "mmp.updatedmap('"..currentmd5.."')", "Click here to quiet the update reminder")
        echo(" to remove the reminder.")
      else
        mmp.newversion, mmp.oldversion = currentmd5, oldmd5
        mmp.retrievecrowdchangelog()
      end
    end

    local f, s = io.open(filename)
    if f then s = f:read("*a"); io.close(f) end
    local currentmd5 = string.match(s, "([a-z0-9]+)  map%.xml")

    -- using crowdsourced map
    if not currentmd5 then
      currentmd5 = s:trim()
    end

	os.remove(filename)

    -- never checked yet?
    if not io.exists(getMudletHomeDir().."/map downloads/current") then needupdate(currentmd5) return end

    -- otherwise read old file and check
    local f, s = io.open(getMudletHomeDir().."/map downloads/current")
    if f then s = f:read("*a"); io.close(f) end

    if s ~= currentmd5 then needupdate(currentmd5, s) end
  end
end</script>
								<eventHandlerList>
									<string>sysDownloadDone</string>
								</eventHandlerList>
							</Script>
							<Script isActive="yes" isFolder="no">
								<name>Check for updates</name>
								<packageName></packageName>
								<script>local downloadfolder = getMudletHomeDir() .. "/map downloads/"

-- this should get called at start and every hour after that

function mmp.checkforupdate()
  if not mmp.game or mmp.checkingupdates then
    return
  end
  local game = mmp.game
  mmp.mapfile = downloadfolder .. "MD5"
  mmp.mapperfile = downloadfolder .. "mapper"
  if not downloadFile then
    mmp.echo("Your version of Mudlet doesn't support downloading files - please upgrade to 2.0+")
  else
    if not lfs.attributes(downloadfolder) then
      if lfs and lfs.mkdir then
        local t, s = lfs.mkdir(downloadfolder)
        if not t and s ~= "File exists" then
          mmp.echo("Couldn't make the '" .. downloadfolder .. "' folder; " .. s)
          return
        end
      else
        mmp.echo(
          "Sorry, but you need LuaFileSystem (lfs) installed, or have the '" ..
          downloadfolder ..
          "' folder exist."
        )
        return
      end
    end
    if mmp.settings.crowdmap then
      if game == "achaea" then
        downloadFile(
          mmp.mapfile, "http://ire-mudlet-mapping.github.io/AchaeaCrowdmap/Map/version.txt"
        )
      elseif game == "starmourn" then
        downloadFile(
          mmp.mapfile, "http://ire-mudlet-mapping.github.io/StarmournCrowdmap/Map/version.txt"
        )
      elseif game == "lusternia" then
        downloadFile(
          mmp.mapfile, "http://ire-mudlet-mapping.github.io/LusterniaCrowdmap/Map/version.txt"
        )
      elseif game == "imperian" then
        downloadFile(
          mmp.mapfile, "http://ire-mudlet-mapping.github.io/ImperianCrowdmap/Map/version.txt"
        )
      elseif game == "aetolia" then
        downloadFile(
          mmp.mapfile, "http://ire-mudlet-mapping.github.io/AetoliaCrowdmap/Map/version.txt"
        )
      elseif game == "asteria" then
        downloadFile(
          mmp.mapfile, "http://asteria-ui.github.io/AsteriaCrowdmap/Map/version.txt"
        )
      elseif game == "ashyria" then
      downloadFile(
        mmp.mapfile, "https://ashyria.github.io/ashyria-crowdmap/Map/version.txt"
      )
      elseif game == "stickmud" then
        downloadFile(
          mmp.mapfile, "http://stickmud.github.io/StickMUDCrowdmap/Map/version.txt"
        )
      end
    elseif mmp.settings.updatemap then
      downloadFile(mmp.mapfile, "http://www." .. game .. ".com/maps/MD5SUM")
    end
    downloadFile(
      mmp.mapperfile, "http://ire-mudlet-mapping.github.io/ire-mapping-script/downloads/version"
    )
    mmp.checkingupdates = true
  end
end

-- called by the user when the map is updated to register the fact that it was

function mmp.updatedmap(currentmd5)
  assert(currentmd5, "need md5 sum to write to file")
  local f, err = io.open(downloadfolder .. "current", "w")
  if not f then
    return mmp.echo("Couldn't write to the update file, because: " .. err)
  end
  f:write(currentmd5)
  f:close()
  local t = {"Go you for updating!", "Thanks for updating the map!", "Alright, map updated!"}
  mmp.echo(t[math.random(1, #t)])
end

-- downloads the latest changelog for the mapper if it was updated

function mmp.retrievechangelog()
  mmp.changelogfile = downloadfolder .. "changelog"
  downloadFile(
    mmp.changelogfile, "http://ire-mudlet-mapping.github.io/ire-mapping-script/downloads/changelog"
  )
end

function mmp.retrievecrowdchangelog()
  mmp.crowdchangelogfile = downloadfolder .. "crowdchangelogfile"
  if mmp.game == "achaea" then
    downloadFile(
      mmp.crowdchangelogfile, "http://ire-mudlet-mapping.github.io/AchaeaCrowdmap/Map/changelog.txt"
    )
  elseif mmp.game == "starmourn" then
    downloadFile(
      mmp.crowdchangelogfile,
      "http://ire-mudlet-mapping.github.io/StarmournCrowdmap/Map/changelog.txt"
    )
  elseif mmp.game == "lusternia" then
    downloadFile(
      mmp.crowdchangelogfile,
      "http://ire-mudlet-mapping.github.io/LusterniaCrowdmap/Map/changelog.txt"
    )
  elseif mmp.game == "imperian" then
    downloadFile(
      mmp.crowdchangelogfile,
      "http://ire-mudlet-mapping.github.io/ImperianCrowdmap/Map/changelog.txt"
    )
  elseif mmp.game == "aetolia" then
    downloadFile(
      mmp.crowdchangelogfile,
      "http://ire-mudlet-mapping.github.io/AetoliaCrowdmap/Map/changelog.txt"
    )
  elseif mmp.game == "asteria" then
    downloadFile(
      mmp.crowdchangelogfile,
      "http://asteria-ui.github.io/AsteriaCrowdmap/Map/changelog.txt"
    )
  elseif mmp.game == "ashyria" then
  downloadFile(
    mmp.crowdchangelogfile,
    "http://ashyria.github.io/ashyria-crowdmap/Map/changelog.txt"
  )
  elseif mmp.game == "stickmud" then
    downloadFile(
      mmp.crowdchangelogfile,
      "http://stickmud.github.io/StickMUDCrowdmap/Map/changelog.txt"
    )
  end
end

-- downloads the public crowdsources map!

function mmp.downloadmapperscript()
  local file =
    getModulePath("mudlet-mapper") or getMudletHomeDir() .. "/map downloads/mudlet-mapper.xml"
  if io.exists(file) then
    local s, m = os.remove(file)
    if not s then
      mmp.echo(
        "Couldn't delete the old xml (located at %s), because of: %s. This might be a problem.",
        file,
        m
      )
    end
  end
  mmp.downloadedscript = file
  downloadFile(
    mmp.downloadedscript,
    "http://ire-mudlet-mapping.github.io/ire-mapping-script/downloads/mudlet-mapper.xml"
  )
  mmp.echo("Okay, downloading the mapper script...")
end

function mmp.downloadcrowdmap(newversion)
  mmp.crowdmapfile = downloadfolder .. "crowdmap"
  local f, err = io.open(downloadfolder .. "current", "w")
  if not f then
    return mmp.echo("Couldn't write to the update file, because: " .. err)
  end
  f:write(newversion)
  f:close()
  if mmp.game == "achaea" then
    downloadFile(mmp.crowdmapfile, "http://ire-mudlet-mapping.github.io/AchaeaCrowdmap/Map/map")
  elseif mmp.game == "starmourn" then
    downloadFile(mmp.crowdmapfile, "http://ire-mudlet-mapping.github.io/StarmournCrowdmap/Map/map")
  elseif mmp.game == "lusternia" then
    downloadFile(mmp.crowdmapfile, "http://ire-mudlet-mapping.github.io/LusterniaCrowdmap/Map/map")
  elseif mmp.game == "imperian" then
    downloadFile(mmp.crowdmapfile, "http://ire-mudlet-mapping.github.io/ImperianCrowdmap/Map/map")
  elseif mmp.game == "aetolia" then
    downloadFile(mmp.crowdmapfile, "http://ire-mudlet-mapping.github.io/AetoliaCrowdmap/Map/map")
  elseif mmp.game == "asteria" then
    downloadFile(mmp.crowdmapfile, "http://asteria-ui.github.io/AsteriaCrowdmap/Map/map")
  elseif mmp.game == "ashyria" then
  downloadFile(mmp.crowdmapfile, "http://ashyria.github.io/ashyria-crowdmap/Map/map")
  elseif mmp.game == "stickmud" then
    downloadFile(mmp.crowdmapfile, "http://stickmud.github.io/StickMUDCrowdmap/Map/map")
  end
  mmp.echo("Downloading the latest crowdmap...")
end

function mmp.showcrowdchangelog()
  mmp.echo("Public map changelog:")
  if not mmp.crowdchangelog then
    mmp.echo("(none yet)")
    return
  end
  for k, v in ipairs(mmp.crowdchangelog) do
    cecho(string.format("  %s) %s\n", k, v:gsub("\t", "     ")))
  end
end

function mmp.installMapperScript()
  local path = getModulePath("mudlet-mapper")
  if not path then
    uninstallPackage("mudlet-mapper")
    tempTimer(1, [[installPackage(mmp.downloadedscript)]])
  else
    reloadModule("mudlet-mapper")
  end
end

</script>
								<eventHandlerList />
								<Script isActive="yes" isFolder="no">
									<name>mmp.checkUpdateStart</name>
									<packageName></packageName>
									<script>function mmp.checkUpdateStart(...)
  if mmp.checkforupdatetimer then killTimer(mmp.checkforupdatetimer) end
  mmp.checkforupdatetimer = tempTimer(math.random(3, 10), mmp.checkforupdate)
end

function mmp.changeUpdateMap()
  if mmp.settings.updatemap then
    mmp.echo("Will check for new map updates from your MUD.")
    enableTimer"Check for updates periodically"
    mmp.checkUpdateStart()
  else
    mmp.echo("Won't check for new map updates from your MUD.")
    disableTimer"Check for updates periodically"
	if mmp.checkforupdatetimer then killTimer("mmp.checkforupdatetimer") end
  end
end</script>
									<eventHandlerList>
										<string>mmp logged in</string>
									</eventHandlerList>
								</Script>
							</Script>
							<Script isActive="no" isFolder="no">
								<name>mmp.seeDownloadErrors</name>
								<packageName></packageName>
								<script>-- this should be off by default
function mmp.seeDownloadErrors(...)
  display{...}
end</script>
								<eventHandlerList>
									<string>sysDownloadError</string>
								</eventHandlerList>
							</Script>
						</ScriptGroup>
						<Script isActive="yes" isFolder="no">
							<name>Initialize</name>
							<packageName></packageName>
							<script>mmp.startup()</script>
							<eventHandlerList />
							<Script isActive="yes" isFolder="no">
								<name>mmp.mapdata_changed</name>
								<packageName></packageName>
								<script>-- aggregates map load and such events into one
function mmp.mapdata_changed()
  raiseEvent("mmapper map reloaded")
end
					</script>
								<eventHandlerList>
									<string>sysMapLoad</string>
									<string>sys2DMapLoad</string>
									<string>sys3DMapLoad</string>
									<string>sysMapDownloadEvent</string>
									<string>mapOpenEvent</string>
								</eventHandlerList>
							</Script>
						</Script>
						<Script isActive="yes" isFolder="no">
							<name>map features</name>
							<packageName></packageName>
							<script>-------------------------------------------------
--         Put your Lua functions here.        --
--                                             --
-- Note that you can also use external Scripts --
-------------------------------------------------

local function loadMapFeatures()
  local mapFeaturesString = getMapUserData("mapFeatures")
  local mapFeatures
  if mapFeaturesString and mapFeaturesString ~= "" then
    mapFeatures = yajl.to_value(mapFeaturesString)
  else
    mapFeatures = {}
  end
  return mapFeatures
end

local function saveMapFeatures(mapFeaturesToSave)
  local mapFeaturesString = yajl.to_string(mapFeaturesToSave)
  setMapUserData("mapFeatures", mapFeaturesString)
end

function mmp.createMapFeature(featureName, roomCharacter)
  if not featureName or featureName == "" then
    mmp.echo("Can't create an empty map feature.")
    return
  end
  if featureName:find("%d") then
    mmp.echo("Map feature names must not contain numbers.")
    return
  end
  roomCharacter = roomCharacter or ""
  if type(roomCharacter) ~= "string" then
    mmp.echo(
      "The new room character must be either a string or nil. " ..
      type(roomCharacter) ..
      " is not allowed."
    )
    return
  end
  local lowerFeatureName = featureName:lower()
  local mapFeatures = loadMapFeatures()
  if not mapFeatures[lowerFeatureName] then
    mapFeatures[lowerFeatureName] = roomCharacter
    saveMapFeatures(mapFeatures)
    mmp.echo(
      "Created map feature '" ..
      featureName ..
      "' with the room character '" ..
      roomCharacter ..
      "'."
    )
  else
    mmp.echo("A map feature with the name '" .. featureName .. "' already exists.")
    return
  end
  return true
end

function mmp.listMapFeatures()
  local mapFeatures = loadMapFeatures()
  mmp.echo("This map has the following features:")
  echo(string.format("    %-25s | %s\n", "feature name", "room character"))
  echo(string.format("    %s\n", string.rep("-", 45)))
  for featureName, roomCharacter in pairs(mapFeatures) do
    echo(string.format("    %-25s | %s\n", featureName, roomCharacter))
  end
  return true
end

function mmp.roomCreateMapFeature(featureName, roomId)
  -- checks for the feature name
  if not featureName then
    mmp.echo("Which feature would you like to create?")
    return
  end
  local lowerFeatureName = featureName:lower()
  local mapFeatures = loadMapFeatures()
  if not mapFeatures[lowerFeatureName] then
    mmp.echo(
      "A feature with name '" ..
      featureName ..
      "' does not exist. You need to use 'feature create' first."
    )
    return
  end
  -- checks for the room ID
  if not roomId then
    if not mmp.currentroom then
      mmp.echo("Don't know where we are at the moment.")
      return
    end
    roomId = mmp.currentroom
  else
    if type(roomId) ~= "number" then
      mmp.echo("Need a room ID as number for creating a map feature on a room.")
      return
    end
  end
  if not getRoomName(roomId) then
    mmp.echo("Room number '" .. roomId .. "' does not exist.")
    return
  end
  -- check if feature already exists
  if table.contains(mmp.getRoomMapFeatures(roomId), lowerFeatureName) then
    mmp.echo("Room '" .. roomId .. "' has already map feature '" .. featureName .. "'.")
    return
  end
  -- create map feature in room
  setRoomUserData(roomId, "feature-" .. lowerFeatureName, "true")
  mmp.echo(string.format("Map feature '%s' created in room number '%d'.", featureName, roomId))
  local featureRoomChar = mapFeatures[lowerFeatureName]
  if featureRoomChar ~= "" then
    setRoomChar(roomId, featureRoomChar)
    mmp.echo("The room now carries the room char '" .. featureRoomChar .. "'.")
  end
  return true
end

function mmp.roomDeleteMapFeature(featureName, roomId)
  -- checks for the feature name
  if not featureName then
    mmp.echo("Which feature would you like to delete?")
    return
  end
  local lowerFeatureName = featureName:lower()
  -- checks for the room ID
  if not roomId then
    if not mmp.currentroom then
      mmp.echo("Don't know where we are at the moment.")
      return
    end
    roomId = mmp.currentroom
  else
    if type(roomId) ~= "number" then
      mmp.echo("Need a room ID as number for deleting a map feature from a room.")
      return
    end
  end
  if not getRoomName(roomId) then
    mmp.echo("Room number '" .. roomId .. "' does not exist.")
    return
  end
  -- check if feature exists
  local roomMapFeatures = mmp.getRoomMapFeatures(roomId)
  if not table.contains(roomMapFeatures, lowerFeatureName) then
    mmp.echo("Room '" .. roomId .. "' doesn't have map feature '" .. featureName .. "'.")
    return
  end
  -- delete map feature from room
  setRoomUserData(roomId, "feature-" .. lowerFeatureName, "")
  mmp.echo(string.format("Map feature '%s' deleted from room number '%d'.", featureName, roomId))
  -- now update room char if needed.
  -- first update current map features of this room
  roomMapFeatures = mmp.getRoomMapFeatures(roomId)
  local mapFeatures = loadMapFeatures()
  -- find out if we need to set a new room character
  if getRoomChar(roomId) == mapFeatures[lowerFeatureName] and getRoomChar(roomId) ~= "" then
    local index, otherRoomMapFeature
    -- find another usable room character
    repeat
      index, otherRoomMapFeature = next(roomMapFeatures, index)
    until not otherRoomMapFeature or mapFeatures[otherRoomMapFeature] ~= ""
    if otherRoomMapFeature then
      -- we found a usable room character, now set it
      local newRoomChar = mapFeatures[otherRoomMapFeature]
      setRoomChar(roomId, newRoomChar)
      mmp.echo("Using '" .. newRoomChar .. "' as new room character.")
    else
      -- we didn't find a usable room character, delete it.
      setRoomChar(roomId, "")
      mmp.echo("Deleted the current room character.")
    end
  end
  return true
end

function mmp.getRoomMapFeatures(roomId)
  -- checks for the room ID
  if not roomId then
    if not mmp.currentroom then
      mmp.echo("Don't know where we are at the moment.")
      return
    end
    roomId = mmp.currentroom
  else
    if type(roomId) ~= "number" then
      mmp.echo("Need a room ID as number for getting all map features of a room.")
      return
    end
  end
  if not getRoomName(roomId) then
    mmp.echo("Room number '" .. roomId .. "' does not exist.")
    return
  end
  local result = {}
  local mapFeatures = loadMapFeatures()
  for mapFeature in pairs(mapFeatures) do
    if getRoomUserData(roomId, "feature-" .. mapFeature) == "true" then
      result[#result + 1] = mapFeature
    end
  end
  return result
end

function mmp.deleteMapFeature(featureName)
  if not featureName or featureName == "" then
    mmp.echo("Which map feature would you like to delete?")
    return
  end
  local lowerFeatureName = featureName:lower()
  local mapFeatures = loadMapFeatures()
  if not mapFeatures[lowerFeatureName] then
    mmp.echo("Map feature '" .. featureName .. "' does not exist.")
    return
  end
  local roomsWithFeature = searchRoomUserData("feature-" .. lowerFeatureName, "true")
  for _, roomId in pairs(roomsWithFeature) do
    local deletionResult = mmp.roomDeleteMapFeature(lowerFeatureName, roomId)
    if not deletionResult then
      mmp.echo(
        "Something went wrong deleting the map feature '" ..
        featureName ..
        "' from all rooms. Deletion incomplete."
      )
      return
    end
  end
  mapFeatures[lowerFeatureName] = nil
  saveMapFeatures(mapFeatures)
  mmp.echo("Deleted map feature '" .. featureName .. "' from map.")
  return true
end

function mmp.getMapFeatures()
  return loadMapFeatures()
end</script>
							<eventHandlerList />
						</Script>
					</ScriptGroup>
				</ScriptGroup>
			</ScriptGroup>
		</ScriptGroup>
	</ScriptPackage>
</MudletPackage>
